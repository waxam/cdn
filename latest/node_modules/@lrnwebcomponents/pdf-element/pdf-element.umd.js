!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@polymer/polymer/polymer-legacy.js"),require("@polymer/paper-card/paper-card.js"),require("@polymer/app-layout/app-toolbar/app-toolbar.js"),require("@polymer/paper-input/paper-input.js"),require("@polymer/iron-input/iron-input.js"),require("@polymer/paper-spinner/paper-spinner.js"),require("@polymer/paper-icon-button/paper-icon-button.js"),require("@lrnwebcomponents/hax-body-behaviors/lib/HAXWiring.js"),require("@lrnwebcomponents/schema-behaviors/schema-behaviors.js"),require("pdfjs-dist/build/pdf.js"),require("pdfjs-dist/build/pdf.worker.js"),require("@polymer/polymer/lib/legacy/polymer.dom.js")):"function"==typeof define&&define.amd?define(["exports","@polymer/polymer/polymer-legacy.js","@polymer/paper-card/paper-card.js","@polymer/app-layout/app-toolbar/app-toolbar.js","@polymer/paper-input/paper-input.js","@polymer/iron-input/iron-input.js","@polymer/paper-spinner/paper-spinner.js","@polymer/paper-icon-button/paper-icon-button.js","@lrnwebcomponents/hax-body-behaviors/lib/HAXWiring.js","@lrnwebcomponents/schema-behaviors/schema-behaviors.js","pdfjs-dist/build/pdf.js","pdfjs-dist/build/pdf.worker.js","@polymer/polymer/lib/legacy/polymer.dom.js"],t):t(e.PdfElement={},e.polymerLegacy_js,null,null,null,null,null,null,null,null,null,null,e.polymer_dom_js)}(this,function(e,t,n,i,o,r,a,s,p,l,c,h,d){"use strict";var u=Math.round,g=function(e){this.element=e,this.reader=d.dom(e.root).querySelector(".pdf-viewer"),this.viewportOut=this.reader.querySelector(".pdf-viewport-out"),this.element=this.reader.querySelector(".pdf-element"),this.container=this.reader.querySelector(".sidebar"),this.toolbar=this.reader.querySelector(".pdf-toolbar"),this.card=d.dom(e.root).querySelector(".style-scope"),this.toolbarHeight=0,this.title=this.toolbar.querySelector(".title"),this.enableTextSelection=e.enableTextSelection,this.fitWidth=e.fitWidth,this.HEIGHT=e.getAttribute("height"),this.WIDTH=e.getAttribute("width"),this.viewport=this.reader.querySelector(".pdf-viewport"),this.enableTextSelection&&(this.textLayerDiv=this.reader.querySelector(".textLayer"),this.textLayerDivStyle=this.textLayerDiv.style),this.spinner=this.reader.querySelector(".spinner"),this.totalPages=this.reader.querySelector("#totalPages"),this.viewportStyle=this.viewport.style,this.viewportOutStyle=this.viewportOut.style,this.ctx=this.viewport.getContext("2d"),this.SRC=e.src,this.pageRendering=!1,this.pageNumPending=null};function m(){var e,t,n=(e=['\n    <style>\n      :host {\n        display: block;\n        width: 100%;\n        height: 100%;\n      }\n\n      app-toolbar.pdf-toolbar {\n        --app-toolbar-background: #323639;\n      }\n\n      .pdf-viewer {\n        text-align: center;\n        border: 1px solid #4d4d4d;\n      }\n\n      .pdf-viewport-out {\n        overflow: auto;\n        background-color: #525659;\n        position: relative;\n        width: 100%;\n        height: 100%;\n      }\n\n      .pdf-viewport {\n        display: block;\n        position: relative;\n        border: 1px solid #eeeeee;\n        transition: all 200ms ease-in-out;\n        width: 100%;\n        height: 100%;\n      }\n\n      .sidebar {\n        background-color: gray;\n        float: left;\n        height: 0px;\n        overflow: scroll;\n        margin-left: -25%;\n        visibility: hidden;\n      }\n\n      .main {\n        margin-left: 0%;\n      }\n\n      .pageselector {\n        width: 3ch;\n        background-color: black;\n        font-size: 17px;\n        background-color: transparent;\n        border: 0px solid;\n      }\n\n      .pageselector:focus {\n        outline: none;\n      }\n\n      #input {\n        -webkit-margin-start: -3px;\n        color: #fff;\n        line-height: 18px;\n        padding: 3px;\n        text-align: end;\n      }\n\n      #input:focus,\n      #input:hover {\n        background-color: rgba(0, 0, 0, 0.5);\n        border-radius: 2px;\n      }\n\n      #slash {\n        padding: 0 3px;\n      }\n\n      paper-spinner {\n        position: absolute;\n        left: 50%;\n      }\n\n      .textLayer {\n        transition: all 200ms ease-in-out;\n      }\n\n      .positionRelative {\n        position: relative;\n      }\n    </style>\n\n    <paper-material elevation="{{elevation}}">\n      <div class="card-content" style="width: {{width}}px">\n        <paper-card class="paperCard" style="width: {{width}}px">\n          <div class="pdf-viewer">\n            <app-toolbar class="pdf-toolbar">\n              <paper-icon-button\n                icon="menu"\n                on-click="sideBar"\n              ></paper-icon-button>\n              <paper-icon-button\n                icon="arrow-back"\n                on-click="showPrev"\n              ></paper-icon-button>\n              <input\n                class="pageselector"\n                id="input"\n                is="iron-input"\n                value="{{currentPage}}"\n                prevent-invalid-input=""\n                allowed-pattern="\\d"\n                on-change="pageNumSearch"\n              />\n              <span id="slash">/</span><span id="totalPages"></span>\n              <paper-icon-button\n                icon="arrow-forward"\n                on-click="showNext"\n              ></paper-icon-button>\n              <span class="title" hidden="{{!showFileName}}">Testing</span>\n              <span class="title" hidden="{{showFileName}}"></span>\n              <span class="pageRendering"></span>\n              <paper-icon-button\n                icon="zoom-in"\n                on-click="zoomIn"\n              ></paper-icon-button>\n              <paper-icon-button\n                icon="zoom-out"\n                on-click="zoomOut"\n              ></paper-icon-button>\n              <paper-icon-button\n                id="zoomIcon"\n                icon="fullscreen"\n                on-click="zoomFit"\n              ></paper-icon-button>\n              <paper-icon-button\n                icon="file-download"\n                hidden$="{{!downloadable}}"\n                on-click="download"\n              ></paper-icon-button>\n            </app-toolbar>\n            <div id="container" class="sidebar" style="width:25%"></div>\n            <div id="main">\n              <div id="test" class="pdf-viewport-out">\n                <canvas class="pdf-viewport"></canvas>\n                <div\n                  id="text-layer"\n                  class="textLayer"\n                  hidden$="{{!enableTextSelection}}"\n                ></div>\n              </div>\n              <paper-spinner\n                class="spinner"\n                hidden$="{{!showSpinner}}"\n              ></paper-spinner>\n            </div>\n          </div>\n        </paper-card>\n      </div>\n    </paper-material>\n  '],(t=['\n    <style>\n      :host {\n        display: block;\n        width: 100%;\n        height: 100%;\n      }\n\n      app-toolbar.pdf-toolbar {\n        --app-toolbar-background: #323639;\n      }\n\n      .pdf-viewer {\n        text-align: center;\n        border: 1px solid #4d4d4d;\n      }\n\n      .pdf-viewport-out {\n        overflow: auto;\n        background-color: #525659;\n        position: relative;\n        width: 100%;\n        height: 100%;\n      }\n\n      .pdf-viewport {\n        display: block;\n        position: relative;\n        border: 1px solid #eeeeee;\n        transition: all 200ms ease-in-out;\n        width: 100%;\n        height: 100%;\n      }\n\n      .sidebar {\n        background-color: gray;\n        float: left;\n        height: 0px;\n        overflow: scroll;\n        margin-left: -25%;\n        visibility: hidden;\n      }\n\n      .main {\n        margin-left: 0%;\n      }\n\n      .pageselector {\n        width: 3ch;\n        background-color: black;\n        font-size: 17px;\n        background-color: transparent;\n        border: 0px solid;\n      }\n\n      .pageselector:focus {\n        outline: none;\n      }\n\n      #input {\n        -webkit-margin-start: -3px;\n        color: #fff;\n        line-height: 18px;\n        padding: 3px;\n        text-align: end;\n      }\n\n      #input:focus,\n      #input:hover {\n        background-color: rgba(0, 0, 0, 0.5);\n        border-radius: 2px;\n      }\n\n      #slash {\n        padding: 0 3px;\n      }\n\n      paper-spinner {\n        position: absolute;\n        left: 50%;\n      }\n\n      .textLayer {\n        transition: all 200ms ease-in-out;\n      }\n\n      .positionRelative {\n        position: relative;\n      }\n    </style>\n\n    <paper-material elevation="{{elevation}}">\n      <div class="card-content" style="width: {{width}}px">\n        <paper-card class="paperCard" style="width: {{width}}px">\n          <div class="pdf-viewer">\n            <app-toolbar class="pdf-toolbar">\n              <paper-icon-button\n                icon="menu"\n                on-click="sideBar"\n              ></paper-icon-button>\n              <paper-icon-button\n                icon="arrow-back"\n                on-click="showPrev"\n              ></paper-icon-button>\n              <input\n                class="pageselector"\n                id="input"\n                is="iron-input"\n                value="{{currentPage}}"\n                prevent-invalid-input=""\n                allowed-pattern="\\\\d"\n                on-change="pageNumSearch"\n              />\n              <span id="slash">/</span><span id="totalPages"></span>\n              <paper-icon-button\n                icon="arrow-forward"\n                on-click="showNext"\n              ></paper-icon-button>\n              <span class="title" hidden="{{!showFileName}}">Testing</span>\n              <span class="title" hidden="{{showFileName}}"></span>\n              <span class="pageRendering"></span>\n              <paper-icon-button\n                icon="zoom-in"\n                on-click="zoomIn"\n              ></paper-icon-button>\n              <paper-icon-button\n                icon="zoom-out"\n                on-click="zoomOut"\n              ></paper-icon-button>\n              <paper-icon-button\n                id="zoomIcon"\n                icon="fullscreen"\n                on-click="zoomFit"\n              ></paper-icon-button>\n              <paper-icon-button\n                icon="file-download"\n                hidden\\$="{{!downloadable}}"\n                on-click="download"\n              ></paper-icon-button>\n            </app-toolbar>\n            <div id="container" class="sidebar" style="width:25%"></div>\n            <div id="main">\n              <div id="test" class="pdf-viewport-out">\n                <canvas class="pdf-viewport"></canvas>\n                <div\n                  id="text-layer"\n                  class="textLayer"\n                  hidden\\$="{{!enableTextSelection}}"\n                ></div>\n              </div>\n              <paper-spinner\n                class="spinner"\n                hidden\\$="{{!showSpinner}}"\n              ></paper-spinner>\n            </div>\n          </div>\n        </paper-card>\n      </div>\n    </paper-material>\n  '])||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return m=function(){return n},n}g.prototype.setSize=function(e,t){this.WIDTH||(this.WIDTH=this.viewportOut.offsetWidth),this.HEIGHT||(this.HEIGHT=this.viewportOut.offsetHeight);this.WIDTH;var n=this.HEIGHT;"height"===e&&(n=t),this.viewportOutStyle.height=n+"px",this.spinner.style.top=(n-this.toolbarHeight)/2+"px"},g.prototype.setSrc=function(e){this.SRC=e},g.prototype.setFitWidth=function(e){this.fitWidth=e},g.prototype.queueRenderPage=function(e){this.pdfExists=!0,this.pageRendering?this.pageNumPending=e:this.renderPDF(e)},g.prototype.loadPDF=function(e){var t=this;this.setSize();var n=this;PDFJS.getDocument(this.SRC).then(function(e){n.PDF=e,n.queueRenderPage(1),n.currentPage=1,n.totalPages.innerHTML=n.PDF.numPages,n.totalPagesNum=n.PDF.numPages,n.currentZoomVal=n.fitZoomVal=n.widthZoomVal=0,n.createDownloadLink()}).catch(function(){t.pdfExists=!1})},g.prototype.renderPages=function(){var e=this;e.viewportOut.innerHTML="",PDFJS.getDocument(this.SRC).then(function(t){e.PDF=t;for(var n=1;n<=e.PDF.numPages;n++)t.getPage(n).then(e.renderPDF(n,null,!0));e.currentPage=1,e.totalPages.innerHTML=e.PDF.numPages,e.totalPagesNum=e.PDF.numPages,e.currentZoomVal||(e.currentZoomVal=e.fitZoomVal=e.widthZoomVal=0),e.createDownloadLink()})},g.prototype.sidebarSetup=function(e){var t=this,n=e.src,i=1,o=0,r=null;function a(s){var p,l=t.container;p=35e-5*(e.sidebarOpen,t.WIDTH);var c=s.getViewport(p),h=document.createElement("div");(s.pageIndex+1).toString(),n.split("/").pop();h.style.backgroundColor="gray";var u=document.querySelector("pdf-element"),g=document.createElement("canvas");h.appendChild(g),l.appendChild(h),d.dom(t.container).childNodes[s.pageIndex].addEventListener("click",function(){var t=s.pageIndex+1;u.sideBarClick(t,e.instance,e)});var m=g.getContext("2d");g.height=c.height,g.width=c.width,s.render({canvasContext:m,viewport:c}),i++,null!==r&&i<=o&&r.getPage(i).then(a)}0!=t.container.innerHTML.length?e.changedSideBar&&(t.container.innerHTML="",PDFJS.getDocument(this.SRC).then(function(e){o=(r=e).numPages;t.container;e.getPage(1).then(a)}),t.setViewportPos(!1)):(t.container.innerHTML="",PDFJS.getDocument(this.SRC).then(function(e){o=(r=e).numPages;t.container;e.getPage(1).then(a)}),t.setViewportPos(!0))},g.prototype.renderPDF=function(e,t,n){var i=this;i.pageRendering=!0,i.spinner.active=!0,this.PDF.getPage(e).then(function(o){var r,a,s,p,l,c=Math.abs,h=Math.sin,d=Math.cos;if(l=o.pageInfo.rotate*Math.PI/180,i.pageW=c(o.view[2]*d(l)+o.view[3]*h(l)),i.pageH=c(o.view[3]*d(l)+o.view[2]*h(l)),(0===i.currentZoomVal||t)&&(r=u(i.WIDTH/i.pageW*100)/100,a=u((i.HEIGHT-i.toolbarHeight)/i.pageH*100)/100,p=Math.min(a,r),i.fitZoomVal=p,i.widthZoomVal=i.WIDTH/i.pageW,i.currentZoomVal=i.fitWidth?i.widthZoomVal:i.fitZoomVal),t)i.zoomPage({target:i.zoomLvl});else{if(p=i.currentZoomVal,s=o.getViewport(p),i.ctx.height=s.height,i.ctx.width=s.width,i.pageW=i.pageW*p,i.pageH=i.pageH*p,i.WIDTH==i.currentWidth||null==i.currentWidth?i.setViewportPos(!1):i.setViewportPos(!0),i.viewport.width=i.pageW,i.viewport.height=i.pageH,i.viewportStyle.width=i.pageW+"px",i.viewportStyle.height=i.pageH+"px",i.enableTextSelection&&(i.textLayerDivStyle.width=i.pageW+"px",i.textLayerDivStyle.height=i.pageH+"px"),i.ctx.clearRect(0,0,i.viewport.width,i.viewport.height),n){var g=document.createElement("div");g.setAttribute("style","position: relative");var m=document.createElement("canvas"),f=document.createElement("div");f.setAttribute("style","left: "+i.viewportStyle.left),f.className="textLayer";var v=m.getContext("2d");f.height=s.height,f.width=s.width,i.viewportOut.appendChild(g),g.appendChild(m),g.appendChild(f),o.render({canvasContext:v,viewport:s}),i.enableTextSelection&&(i.textLayerDiv.innerHTML="",o.getTextContent().then(function(t){PDFJS.renderTextLayer({textContent:t,container:f,pageIndex:e,viewport:s,textDivs:[]})}))}else{o.render({canvasContext:i.ctx,viewport:s}).promise.then(function(){i.pageRendering=!1,i.spinner.active=!1,null!==i.pageNumPending&&(i.renderPDF(i.pageNumPending),i.pageNumPending=null)})}i.enableTextSelection&&(i.textLayerDiv.innerHTML="",o.getTextContent().then(function(t){PDFJS.renderTextLayer({textContent:t,container:i.textLayerDiv,pageIndex:e,viewport:s,textDivs:[]})}))}})},g.prototype.setViewportPos=function(e){var t=Math.floor;this.currentWidth=e?.75*this.WIDTH:this.WIDTH,this.pageW<this.currentWidth?this.viewportStyle.left=(this.currentWidth-this.pageW)/2+"px":this.viewportStyle.left=0,this.pageH<this.HEIGHT?(this.viewportStyle.top=(this.HEIGHT-this.pageH-this.toolbarHeight)/2+"px",this.viewportStyle.topNum=t((this.HEIGHT-this.pageH-this.toolbarHeight)/2)+this.toolbarHeight,this.enableTextSelection&&(this.textLayerDivStyle.topNum=t((this.HEIGHT-this.pageH-this.toolbarHeight)/2)+this.toolbarHeight)):this.viewportStyle.top=0,this.enableTextSelection&&(this.textLayerDivStyle.left=this.viewportStyle.left,this.textLayerDivStyle.top=this.viewportStyle.top)},g.prototype.changePDFSource=function(e){this.setSrc(e),this.loadPDF(1)},g.prototype.zoomInOut=function(e){this.currentZoomVal=u(10*(u(10*this.currentZoomVal)/10+e))/10,this.queueRenderPage(this.currentPage)},g.prototype.zoomIn=function(){this.currentZoomVal=u(10*(u(10*this.currentZoomVal)/10+.1))/10,this.queueRenderPage(this.currentPage)},g.prototype.zoomOut=function(){this.currentZoomVal=u(10*(u(10*this.currentZoomVal)/10-.1))/10,this.queueRenderPage(this.currentPage)},g.prototype.zoomPageFit=function(){this.currentZoomVal=this.fitZoomVal,this.queueRenderPage(this.currentPage)},g.prototype.zoomWidthFit=function(){this.currentZoomVal=this.widthZoomVal,this.queueRenderPage(this.currentPage)},g.prototype.getPageNum=function(){return this.PDF.numPages},g.prototype.createDownloadLink=function(){var e=this;this.PDF.getData().then(function(t){var n=PDFJS.createBlob(t,"application/pdf");e.downloadLink=URL.createObjectURL(n)})},g.prototype.download=function(){var e=document.createElement("a"),t=this.SRC.split("/");e.href=this.downloadLink,e.target="_parent","download"in e&&(e.download=decodeURIComponent(t[t.length-1])),this.reader.appendChild(e),e.click(),e.parentNode.removeChild(e)},window.Reader=g;var f=t.Polymer({_template:t.html(m()),is:"pdf-element",behaviors:[HAXBehaviors.PropertiesBehaviors,SchemaBehaviors.Schema],properties:{src:{type:String,reflectToAttribute:!0},elevation:{type:Number,value:1},downloadable:{type:Boolean,value:!1},showFileName:{type:Boolean,value:!1},showSpinner:{type:Boolean,value:!1},enableTextSelection:{type:Boolean,value:!1},fitWidth:{type:Boolean,value:!1},width:{type:Number,value:500}},attached:function(){this.src=this.getAttribute("src"),this._initializeReader(),this.src&&this.instance.loadPDF(),this._setFitWidth();this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!1,gizmo:{title:"PDF viewer",descrption:"This can nicely present a PDF in a standard inplace, cross browser way.",icon:"image:picture-as-pdf",color:"red",groups:["Presentation","PDF","Data"],handles:[{type:"pdf",url:"src",source:"src"},{type:"document",url:"src",source:"src"}],meta:{author:"LRNWebComponents"}},settings:{quick:[{property:"src",title:"File",description:"The URL for the pdf",inputMethod:"textfield",icon:"link",required:!0}],configure:[{property:"src",title:"Source",description:"The URL for this csv file",inputMethod:"textfield",icon:"link",required:!0},{property:"downloadable",title:"Downloadable",description:"User can download this",inputMethod:"boolean",icon:"file-download"},{property:"enableTextSelection",title:"Text Selection",description:"User can select text in this element.",inputMethod:"boolean",icon:"file-download"},{property:"elevation",title:"Elevation",description:"Visual elevation of the element",inputMethod:"number",icon:"flip-to-front"}],advanced:[]}})},loadPDF:function(){this.getAttribute("src")&&(this.instance.changePDFSource(this.getAttribute("src")),this.currentPage=1,this.totalPages=this.instance.totalPages,this.fileName=this.src.split("/").pop(),this._setFitWidth(),this.$.zoomIcon.icon="fullscreen")},attributeChanged:function(e,t){"src"===e?void 0===this.instance?this._initializeReader():(this.loadPDF(),this.changedSideBar=!0,this.fromChange=!0,this.sideBar()):"fitWidth"===e&&this._setFitWidth()},_initializeReader:function(){this.instance=new Reader(this),null!=this.src&&(this.fileName=this.src.split("/").pop()),this.currentPage=1},_setFitWidth:function(){this.instance.setFitWidth(this.fitWidth)},zoomInOut:function(e){this.instance.currentZoomVal>=2?this.instance.currentZoomVal=2:this.instance.currentZoomVal<=.1?this.instance.currentZoomVal=.1:(this.$.zoomIcon.icon="fullscreen",this.instance.zoomInOut(e))},zoomIn:function(){this.instance.pdfExists&&this.zoomInOut(.1)},zoomOut:function(){this.instance.pdfExists&&this.instance.zoomInOut(-.1)},zoomFit:function(){this.instance.pdfExists&&(this.instance.currentZoomVal==this.instance.widthZoomVal?(this.instance.zoomPageFit(),this.$.zoomIcon.icon="fullscreen"):(this.instance.zoomWidthFit(),this.$.zoomIcon.icon="fullscreen-exit"))},pageNumSearch:function(){var e=parseInt(this.$.input.value);1<=e&&e<=this.instance.totalPagesNum?(this.instance.currentPage=e,this.instance.queueRenderPage(this.instance.currentPage),this.currentPage=e,this.$.input.blur()):(this.$.input.value=this.currentPage,this.$.input.blur())},sideBarClick:function(e,t,n){n.src.split("/").pop();var i=t;n.sidebarOpen=!0,1<=e&&e<=t.totalPagesNum?(i.currentPage=e,i.queueRenderPage(i.currentPage),t.currentPage=e,n.currentPage=e,this.$.input.blur()):(this.$.input.value=i.currentPage,this.$.input.blur())},showPrev:function(){1<this.instance.currentPage&&(this.instance.currentPage--,this.instance.queueRenderPage(this.instance.currentPage),this.currentPage--)},showNext:function(){this.instance.totalPagesNum>this.instance.currentPage&&(this.instance.currentPage++,this.instance.queueRenderPage(this.instance.currentPage),this.currentPage++)},sideBar:function(){this.instance.pdfExists&&(this.fromChange||(this.$.container.style.height=this.$.test.style.height,this.$.container.style.width=this.$.test.style.width,"25%"==this.$.main.style.marginLeft?(this.sidebarOpen=!1,this.instance.setViewportPos(!1),this.$.main.style.marginLeft="0%",this.$.container.style.marginLeft="-25%",this.$.container.style.visibility="hidden"):(this.sidebarOpen=!0,this.$.main.style.marginLeft="25%",this.$.container.style.marginLeft="0%",this.$.container.style.visibility="visible",this.instance.setViewportPos(!0))),this.fromChange=!1,this.instance.sidebarSetup(this),this.changedSideBar=!1)},download:function(){this.instance.pdfExists&&this.instance.download()}});e.PdfElement=f,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=pdf-element.umd.js.map
