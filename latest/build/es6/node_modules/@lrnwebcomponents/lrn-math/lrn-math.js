import{HAXWiring}from"@lrnwebcomponents/hax-body-behaviors/lib/HAXWiring.js";const document=window.document,states={start:1,loading:2,ready:3,typesetting:4,error:5};let mathjaxHub,styleNode,typesets=[],state=states.start,src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js";function getStyleNode(){const a=document.querySelectorAll("style"),b=Array.prototype.filter.call(a,function(c){return c.sheet&&100<c.sheet.cssRules.length&&".mjx-chtml"===c.sheet.cssRules[0].selectorText});styleNode=b[0]}function flush_typesets(){if(typesets.length){const a=[],b=[];typesets.forEach(function(c){const d=document.createElement("script"),e=document.createElement("div");d.type=c[1]?"math/tex; mode=display":"math/tex",d.text=c[0],e.style.position="fixed",e.style.top=0,e.style.left="99999px",e.appendChild(d),document.body.appendChild(e),a.push(d),b.push([e,c[2]])}),typesets=[],state=states.typesetting,mathjaxHub.Queue(["Typeset",mathjaxHub,a]),mathjaxHub.Queue(function(){styleNode||getStyleNode(),b.forEach(function(c){const d=c[0],e="SPAN"===d.firstElementChild.tagName?d.firstElementChild:null;c[1](e,styleNode),document.body.removeChild(d)}),state=states.ready,flush_typesets()})}}function load_library(){state=states.loading,window.MathJax={skipStartupTypeset:!0,showMathMenu:!1,jax:["input/TeX","output/CommonHTML"],TeX:{extensions:["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]},AuthorInit:function(){mathjaxHub=window.MathJax.Hub,mathjaxHub.Register.StartupHook("End",function(){state=states.ready,flush_typesets()})}};var a=document.createElement("script");a.type="text/javascript",a.src=src,a.async=!0,a.onerror=function(){console.warn("Error loading MathJax library "+src),state=states.error,typesets=[]},document.head.appendChild(a)}class MathTexController extends HTMLElement{connectedCallback(){this.hasAttribute("src")&&(src=this.getAttribute("src")),this.hasAttribute("lazy")||load_library()}typeset(a,b,c){state===states.error||(typesets.push([a,b,c]),state===states.start?load_library():state===states.ready&&flush_typesets())}}window.customElements.define("math-tex-controller",MathTexController);const TAG_NAME="lrn-math",CONTROLLER_TAG_NAME="math-tex-controller",mutation_config={childList:!0,characterData:!0,attributes:!0,subtree:!0};let handler;function check_handler(){handler||(handler=document.querySelector(CONTROLLER_TAG_NAME)||document.createElement(CONTROLLER_TAG_NAME),handler&&"function"===typeof handler.typeset?!document.contains(handler)&&document.head.appendChild(handler):(console.warn("no %s element defined; %s element will not work",CONTROLLER_TAG_NAME,TAG_NAME),handler=void 0))}function update(a){const b=a.shadowRoot,c=a.textContent.trim(),d="display"===a.getAttribute("mode"),e=(d?"D":"I")+c;if(e!==a._private.check){for(;b.firstChild;)b.removeChild(b.firstChild);a._private.check=e,c.length&&handler.typeset(c,d,function(f,g){b.appendChild(g.cloneNode(!0)),b.appendChild(f)})}}class MathTex extends HTMLElement{constructor(){super(),this.attachShadow({mode:"open"}),check_handler()}connectedCallback(){const a=this;window.requestAnimationFrame(function(){a._private={check:"",observer:new MutationObserver(function(){update(a)})},update(a),a._private.observer.observe(a,mutation_config)});let c=new HAXWiring;c.setup({canScale:!0,canPosition:!0,canEditSource:!0,gizmo:{title:"Math",description:"Present math in a nice looking way.",icon:"places:all-inclusive",color:"grey",groups:["Content"],handles:[{type:"math",math:"mathText"},{type:"inline",text:"mathText"}],meta:{author:"LRNWebComponents"}},settings:{quick:[],configure:[{slot:"",title:"Math",description:"Math",inputMethod:"code-editor",icon:"editor:format-quote"}],advanced:[]}},"lrn-math",this)}disconnectedCallback(){this._private&&(this._private.observer.disconnect(),delete this._private)}}window.customElements.define("lrn-math",MathTex);