(function(r,n){"object"===typeof exports&&"object"===typeof module?module.exports=n():"function"===typeof define&&define.amd?define("WaveSurfer",[],n):"object"===typeof exports?exports.WaveSurfer=n():r.WaveSurfer=n()})(window,function(){return function(t){function r(s){if(n[s])return n[s].exports;var l=n[s]={i:s,l:!1,exports:{}};return t[s].call(l.exports,l,l.exports,r),l.l=!0,l.exports}var n={};return r.m=t,r.c=n,r.d=function(s,l,d){r.o(s,l)||Object.defineProperty(s,l,{enumerable:!0,get:d})},r.r=function(s){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},r.t=function(s,l){if(1&l&&(s=r(s)),8&l)return s;if(4&l&&"object"===typeof s&&s&&s.__esModule)return s;var d=Object.create(null);if(r.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:s}),2&l&&"string"!=typeof s)for(var u in s)r.d(d,u,function(f){return s[f]}.bind(null,u));return d},r.n=function(s){var l=s&&s.__esModule?function(){return s["default"]}:function(){return s};return r.d(l,"a",l),l},r.o=function(s,l){return Object.prototype.hasOwnProperty.call(s,l)},r.p="",r(r.s="./src/wavesurfer.js")}({"./node_modules/debounce/index.js":function(t){function n(s,l,d){function u(){var w=Date.now()-k;w<l&&0<=w?f=setTimeout(u,l-w):(f=null,!d&&(g=s.apply(v,m),v=m=null))}var f,m,v,k,g;null==l&&(l=100);var P=function(){v=this,m=arguments,k=Date.now();var w=d&&!f;return f||(f=setTimeout(u,l)),w&&(g=s.apply(v,m),v=m=null),g};return P.clear=function(){f&&(clearTimeout(f),f=null)},P.flush=function(){f&&(g=s.apply(v,m),v=m=null,clearTimeout(f),f=null)},P}n.debounce=n,t.exports=n},"./src/drawer.js":function(t,r,n){"use strict";function l(E){return l="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(R){return typeof R}:function(R){return R&&"function"===typeof Symbol&&R.constructor===Symbol&&R!==Symbol.prototype?"symbol":typeof R},l(E)}function d(E,_){if(!(E instanceof _))throw new TypeError("Cannot call a class as a function")}function u(E,_){for(var S,R=0;R<_.length;R++)S=_[R],S.enumerable=S.enumerable||!1,S.configurable=!0,"value"in S&&(S.writable=!0),Object.defineProperty(E,S.key,S)}function f(E,_,R){return _&&u(E.prototype,_),R&&u(E,R),E}function m(E,_){return _&&("object"===l(_)||"function"===typeof _)?_:v(E)}function v(E){if(void 0===E)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return E}function k(E){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(R){return R.__proto__||Object.getPrototypeOf(R)},k(E)}function g(E,_){if("function"!==typeof _&&null!==_)throw new TypeError("Super expression must either be null or a function");E.prototype=Object.create(_&&_.prototype,{constructor:{value:E,writable:!0,configurable:!0}}),_&&P(E,_)}function P(E,_){return P=Object.setPrototypeOf||function(S,A){return S.__proto__=A,S},P(E,_)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var w=function(E){if(E&&E.__esModule)return E;var _={};if(null!=E)for(var R in E)if(Object.prototype.hasOwnProperty.call(E,R)){var S=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(E,R):{};S.get||S.set?Object.defineProperty(_,R,S):_[R]=E[R]}return _.default=E,_}(n("./src/util/index.js")),C=function(E){function _(R,S){var A;return d(this,_),A=m(this,k(_).call(this)),A.container=R,A.params=S,A.width=0,A.height=S.height*A.params.pixelRatio,A.lastPos=0,A.wrapper=null,A}return g(_,E),f(_,[{key:"style",value:function(S,A){return w.style(S,A)}},{key:"createWrapper",value:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()}},{key:"handleEvent",value:function(S,A){A||S.preventDefault();var M,W=S.targetTouches?S.targetTouches[0].clientX:S.clientX,T=this.wrapper.getBoundingClientRect(),O=this.width,D=this.getWidth();return!this.params.fillParent&&O<D?(M=(W-T.left)*(this.params.pixelRatio/O)||0,1<M&&(M=1)):M=(W-T.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,M}},{key:"setupWrapperEvents",value:function(){var S=this;this.wrapper.addEventListener("click",function(A){var W=S.wrapper.offsetHeight-S.wrapper.clientHeight;if(0!=W){var T=S.wrapper.getBoundingClientRect();if(A.clientY>=T.bottom-W)return}S.params.interact&&S.fireEvent("click",A,S.handleEvent(A))}),this.wrapper.addEventListener("scroll",function(A){return S.fireEvent("scroll",A)})}},{key:"drawPeaks",value:function(S,A,W,T){this.setWidth(A)||this.clearWave(),this.params.barWidth?this.drawBars(S,0,W,T):this.drawWave(S,0,W,T)}},{key:"resetScroll",value:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)}},{key:"recenter",value:function(S){var A=this.wrapper.scrollWidth*S;this.recenterOnPosition(A,!0)}},{key:"recenterOnPosition",value:function(S,A){var W=this.wrapper.scrollLeft,T=~~(this.wrapper.clientWidth/2),O=this.wrapper.scrollWidth-this.wrapper.clientWidth,D=S-T,M=D-W;if(0!=O){if(!A&&-T<=M&&M<T){var B=5;M=Math.max(-B,Math.min(B,M)),D=W+M}D=Math.max(0,Math.min(O,D)),D!=W&&(this.wrapper.scrollLeft=D)}}},{key:"getScrollX",value:function(){var S=this.params.pixelRatio,A=Math.round(this.wrapper.scrollLeft*S);if(this.params.scrollParent){var W=~~(this.wrapper.scrollWidth*S-this.getWidth());A=Math.min(W,Math.max(0,A))}return A}},{key:"getWidth",value:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)}},{key:"setWidth",value:function(S){return this.width!=S&&(this.width=S,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}},{key:"setHeight",value:function(S){return S!=this.height&&(this.height=S,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}},{key:"progress",value:function(S){var A=1/this.params.pixelRatio,W=Math.round(S*this.width)*A;if(W<this.lastPos||W-this.lastPos>=A){if(this.lastPos=W,this.params.scrollParent&&this.params.autoCenter){var T=~~(this.wrapper.scrollWidth*S);this.recenterOnPosition(T)}this.updateProgress(W)}}},{key:"destroy",value:function(){this.unAll(),this.wrapper&&(this.wrapper.parentNode==this.container&&this.container.removeChild(this.wrapper),this.wrapper=null)}},{key:"updateCursor",value:function(){}},{key:"updateSize",value:function(){}},{key:"drawBars",value:function(){}},{key:"drawWave",value:function(){}},{key:"clearWave",value:function(){}},{key:"updateProgress",value:function(){}}]),_}(w.Observer);r.default=C,t.exports=r.default},"./src/drawer.multicanvas.js":function(t,r,n){"use strict";function d(R){return d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(A){return typeof A}:function(A){return A&&"function"===typeof Symbol&&A.constructor===Symbol&&A!==Symbol.prototype?"symbol":typeof A},d(R)}function u(R,S){if(!(R instanceof S))throw new TypeError("Cannot call a class as a function")}function f(R,S){for(var W,A=0;A<S.length;A++)W=S[A],W.enumerable=W.enumerable||!1,W.configurable=!0,"value"in W&&(W.writable=!0),Object.defineProperty(R,W.key,W)}function m(R,S,A){return S&&f(R.prototype,S),A&&f(R,A),R}function v(R,S){return S&&("object"===d(S)||"function"===typeof S)?S:k(R)}function k(R){if(void 0===R)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return R}function g(R){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(A){return A.__proto__||Object.getPrototypeOf(A)},g(R)}function P(R,S){if("function"!==typeof S&&null!==S)throw new TypeError("Super expression must either be null or a function");R.prototype=Object.create(S&&S.prototype,{constructor:{value:R,writable:!0,configurable:!0}}),S&&w(R,S)}function w(R,S){return w=Object.setPrototypeOf||function(W,T){return W.__proto__=T,W},w(R,S)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var C=function(R){return R&&R.__esModule?R:{default:R}}(n("./src/drawer.js")),E=function(R){if(R&&R.__esModule)return R;var S={};if(null!=R)for(var A in R)if(Object.prototype.hasOwnProperty.call(R,A)){var W=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(R,A):{};W.get||W.set?Object.defineProperty(S,A,W):S[A]=R[A]}return S.default=R,S}(n("./src/util/index.js")),_=function(R){function S(A,W){var T;return u(this,S),T=v(this,g(S).call(this,A,W)),T.maxCanvasWidth=W.maxCanvasWidth,T.maxCanvasElementWidth=Math.round(W.maxCanvasWidth/W.pixelRatio),T.hasProgressCanvas=W.waveColor!=W.progressColor,T.halfPixel=0.5/W.pixelRatio,T.canvases=[],T.progressWave=null,T}return P(S,R),m(S,[{key:"init",value:function(){this.createWrapper(),this.createElements()}},{key:"createElements",value:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:3,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",pointerEvents:"none"})),this.addCanvas(),this.updateCursor()}},{key:"updateCursor",value:function(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}},{key:"updateSize",value:function(){for(var W=this,T=Math.round(this.width/this.params.pixelRatio),O=Math.ceil(T/this.maxCanvasElementWidth);this.canvases.length<O;)this.addCanvas();for(;this.canvases.length>O;)this.removeCanvas();this.canvases.forEach(function(D,M){var B=W.maxCanvasWidth+2*Math.ceil(W.params.pixelRatio/2);M==W.canvases.length-1&&(B=W.width-W.maxCanvasWidth*(W.canvases.length-1)),W.updateDimensions(D,B,W.height),W.clearWaveForEntry(D)})}},{key:"addCanvas",value:function(){var W={},T=this.maxCanvasElementWidth*this.canvases.length;W.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:2,left:T+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"})),W.waveCtx=W.wave.getContext("2d"),this.hasProgressCanvas&&(W.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:T+"px",top:0,bottom:0,height:"100%"})),W.progressCtx=W.progress.getContext("2d")),this.canvases.push(W)}},{key:"removeCanvas",value:function(){var W=this.canvases.pop();W.wave.parentElement.removeChild(W.wave),this.hasProgressCanvas&&W.progress.parentElement.removeChild(W.progress)}},{key:"updateDimensions",value:function(W,T,O){var D=Math.round(T/this.params.pixelRatio),M=Math.round(this.width/this.params.pixelRatio);W.start=W.waveCtx.canvas.offsetLeft/M||0,W.end=W.start+D/M,W.waveCtx.canvas.width=T,W.waveCtx.canvas.height=O,this.style(W.waveCtx.canvas,{width:D+"px"}),this.style(this.progressWave,{display:"block"}),this.hasProgressCanvas&&(W.progressCtx.canvas.width=T,W.progressCtx.canvas.height=O,this.style(W.progressCtx.canvas,{width:D+"px"}))}},{key:"clearWave",value:function(){var W=this;this.canvases.forEach(function(T){return W.clearWaveForEntry(T)})}},{key:"clearWaveForEntry",value:function(W){W.waveCtx.clearRect(0,0,W.waveCtx.canvas.width,W.waveCtx.canvas.height),this.hasProgressCanvas&&W.progressCtx.clearRect(0,0,W.progressCtx.canvas.width,W.progressCtx.canvas.height)}},{key:"drawBars",value:function(W,T,O,D){var M=this;return this.prepareDraw(W,T,O,D,function(B){var L=B.absmax,N=B.hasMinVals,I=B.height,V=B.offsetY,F=B.halfH,z=B.peaks;if(void 0!==O){var Z,H=N?2:1,q=z.length/H,G=M.params.barWidth*M.params.pixelRatio,X=null===M.params.barGap?Math.max(M.params.pixelRatio,~~(G/2)):Math.max(M.params.pixelRatio,M.params.barGap*M.params.pixelRatio),U=q/M.width;for(Z=O;Z<D;Z+=G+X){var $=z[Math.floor(Z*U*H)]||0,K=Math.round($/L*F);M.fillRect(Z+M.halfPixel,F-K+V,G+M.halfPixel,2*K)}}})}},{key:"drawWave",value:function(W,T,O,D){var M=this;return this.prepareDraw(W,T,O,D,function(B){var L=B.absmax,N=B.hasMinVals,I=B.height,V=B.offsetY,F=B.halfH,z=B.peaks;if(!N){var G,H=[],q=z.length;for(G=0;G<q;G++)H[2*G]=z[G],H[2*G+1]=-z[G];z=H}void 0!==O&&M.drawLine(z,L,F,V,O,D),M.fillRect(0,F+V-M.halfPixel,M.width,M.halfPixel)})}},{key:"drawLine",value:function(W,T,O,D,M,B){var L=this;this.canvases.forEach(function(N){L.setFillStyles(N),L.drawLineToContext(N,N.waveCtx,W,T,O,D,M,B),L.drawLineToContext(N,N.progressCtx,W,T,O,D,M,B)})}},{key:"drawLineToContext",value:function(W,T,O,D,M,B,L,N){if(T){var I=O.length/2,V=this.params.fillParent&&this.width!=I?this.width/I:1,F=Math.round(I*W.start),z=Math.round(I*W.end)+1;if(!(F>N||z<L)){var G,X,H=Math.min(F,L),q=Math.max(z,N);for(T.beginPath(),T.moveTo((H-F)*V+this.halfPixel,M+B),G=H;G<q;G++){var Y=O[2*G]||0,U=Math.round(Y/D*M);T.lineTo((G-F)*V+this.halfPixel,M-U+B)}for(X=q-1;X>=H;X--){var J=O[2*X+1]||0,Q=Math.round(J/D*M);T.lineTo((X-F)*V+this.halfPixel,M-Q+B)}T.closePath(),T.fill()}}}},{key:"fillRect",value:function(W,T,O,D){var L,M=Math.floor(W/this.maxCanvasWidth),B=Math.min(Math.ceil((W+O)/this.maxCanvasWidth)+1,this.canvases.length);for(L=M;L<B;L++){var N=this.canvases[L],I=L*this.maxCanvasWidth,V={x1:Math.max(W,L*this.maxCanvasWidth),y1:T,x2:Math.min(W+O,L*this.maxCanvasWidth+N.waveCtx.canvas.width),y2:T+D};V.x1<V.x2&&(this.setFillStyles(N),this.fillRectToContext(N.waveCtx,V.x1-I,V.y1,V.x2-V.x1,V.y2-V.y1),this.fillRectToContext(N.progressCtx,V.x1-I,V.y1,V.x2-V.x1,V.y2-V.y1))}}},{key:"prepareDraw",value:function(W,T,O,D,M){var B=this;return E.frame(function(){if(W[0]instanceof Array){var L=W;if(B.params.splitChannels)return B.setHeight(L.length*B.params.height*B.params.pixelRatio),L.forEach(function(G,X){return B.prepareDraw(G,X,O,D,M)});W=L[0]}var N=1/B.params.barHeight;if(B.params.normalize){var I=E.max(W),V=E.min(W);N=-V>I?-V:I}var F=[].some.call(W,function(G){return 0>G}),z=B.params.height*B.params.pixelRatio;return M({absmax:N,hasMinVals:F,height:z,offsetY:z*T||0,halfH:z/2,peaks:W})})()}},{key:"fillRectToContext",value:function(W,T,O,D,M){W&&W.fillRect(T,O,D,M)}},{key:"setFillStyles",value:function(W){W.waveCtx.fillStyle=this.params.waveColor,this.hasProgressCanvas&&(W.progressCtx.fillStyle=this.params.progressColor)}},{key:"getImage",value:function(W,T){var O=this.canvases.map(function(D){return D.wave.toDataURL(W,T)});return 1<O.length?O:O[0]}},{key:"updateProgress",value:function(W){this.style(this.progressWave,{width:W+"px"})}}]),S}(C.default);r.default=_,t.exports=r.default},"./src/mediaelement.js":function(t,r,n){"use strict";function d(A){return d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(T){return typeof T}:function(T){return T&&"function"===typeof Symbol&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},d(A)}function u(A,W){if(!(A instanceof W))throw new TypeError("Cannot call a class as a function")}function f(A,W){for(var O,T=0;T<W.length;T++)O=W[T],O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(A,O.key,O)}function m(A,W,T){return W&&f(A.prototype,W),T&&f(A,T),A}function v(A,W){return W&&("object"===d(W)||"function"===typeof W)?W:k(A)}function k(A){if(void 0===A)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A}function g(A,W,T){return g="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(D,M,B){var L=P(D,M);if(L){var N=Object.getOwnPropertyDescriptor(L,M);return N.get?N.get.call(B):N.value}},g(A,W,T||A)}function P(A,W){for(;!Object.prototype.hasOwnProperty.call(A,W)&&(A=w(A),null!==A););return A}function w(A){return w=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)},w(A)}function C(A,W){if("function"!==typeof W&&null!==W)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(W&&W.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),W&&E(A,W)}function E(A,W){return E=Object.setPrototypeOf||function(O,D){return O.__proto__=D,O},E(A,W)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var _=function(A){return A&&A.__esModule?A:{default:A}}(n("./src/webaudio.js")),R=function(A){if(A&&A.__esModule)return A;var W={};if(null!=A)for(var T in A)if(Object.prototype.hasOwnProperty.call(A,T)){var O=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(A,T):{};O.get||O.set?Object.defineProperty(W,T,O):W[T]=A[T]}return W.default=A,W}(n("./src/util/index.js")),S=function(A){function W(T){var O;return u(this,W),O=v(this,w(W).call(this,T)),O.params=T,O.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){},volume:0},O.mediaType=T.mediaType.toLowerCase(),O.elementPosition=T.elementPosition,O.peaks=null,O.playbackRate=1,O.volume=1,O.buffer=null,O.onPlayEnd=null,O}return C(W,A),m(W,[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate),this.createTimer()}},{key:"createTimer",value:function(){var O=this;this.on("play",function M(){if(!O.isPaused()){O.fireEvent("audioprocess",O.getCurrentTime());var B=window.requestAnimationFrame||window.webkitRequestAnimationFrame;B(M)}}),this.on("pause",function(){O.fireEvent("audioprocess",O.getCurrentTime())})}},{key:"load",value:function(O,D,M,B){var L=document.createElement(this.mediaType);L.controls=this.params.mediaControls,L.autoplay=this.params.autoplay||!1,L.preload=null==B?"auto":B,L.src=O,L.style.width="100%";var N=D.querySelector(this.mediaType);N&&D.removeChild(N),D.appendChild(L),this._load(L,M)}},{key:"loadElt",value:function(O,D){O.controls=this.params.mediaControls,O.autoplay=this.params.autoplay||!1,this._load(O,D)}},{key:"_load",value:function(O,D){var M=this;"function"==typeof O.load&&O.load(),O.addEventListener("error",function(){M.fireEvent("error","Error loading media element")}),O.addEventListener("canplay",function(){M.fireEvent("canplay")}),O.addEventListener("ended",function(){M.fireEvent("finish")}),O.addEventListener("play",function(){M.fireEvent("play")}),O.addEventListener("pause",function(){M.fireEvent("pause")}),this.media=O,this.peaks=D,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate),this.setVolume(this.volume)}},{key:"isPaused",value:function(){return!this.media||this.media.paused}},{key:"getDuration",value:function(){if(this.explicitDuration)return this.explicitDuration;var O=(this.buffer||this.media).duration;return O>=Infinity&&(O=this.media.seekable.end(0)),O}},{key:"getCurrentTime",value:function(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function(O){this.playbackRate=O||1,this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function(O){null!=O&&(this.media.currentTime=O),this.clearPlayEnd()}},{key:"play",value:function(O,D){this.seekTo(O);var M=this.media.play();return D&&this.setPlayEnd(D),M}},{key:"pause",value:function(){var O;return this.media&&(O=this.media.pause()),this.clearPlayEnd(),O}},{key:"setPlayEnd",value:function(O){var D=this;this._onPlayEnd=function(M){M>=O&&(D.pause(),D.seekTo(O))},this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function(){this._onPlayEnd&&(this.un("audioprocess",this._onPlayEnd),this._onPlayEnd=null)}},{key:"getPeaks",value:function(O,D,M){return this.buffer?g(w(W.prototype),"getPeaks",this).call(this,O,D,M):this.peaks||[]}},{key:"setSinkId",value:function(O){return O?this.media.setSinkId?this.media.setSinkId(O):Promise.reject(new Error("setSinkId is not supported in your browser")):Promise.reject(new Error("Invalid deviceId: "+O))}},{key:"getVolume",value:function(){return this.volume||this.media.volume}},{key:"setVolume",value:function(O){this.volume=O,this.media.volume=this.volume}},{key:"destroy",value:function(){this.pause(),this.unAll(),this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}]),W}(_.default);r.default=S,t.exports=r.default},"./src/peakcache.js":function(t,r){"use strict";function s(f,m){if(!(f instanceof m))throw new TypeError("Cannot call a class as a function")}function l(f,m){for(var k,v=0;v<m.length;v++)k=m[v],k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(f,k.key,k)}function d(f,m,v){return m&&l(f.prototype,m),v&&l(f,v),f}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var u=function(){function f(){s(this,f),this.clearPeakCache()}return d(f,[{key:"clearPeakCache",value:function(){this.peakCacheRanges=[],this.peakCacheLength=-1}},{key:"addRangeToPeakCache",value:function(v,k,g){v!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=v);for(var P=[],w=0;w<this.peakCacheRanges.length&&this.peakCacheRanges[w]<k;)w++;for(0==w%2&&P.push(k);w<this.peakCacheRanges.length&&this.peakCacheRanges[w]<=g;)P.push(this.peakCacheRanges[w]),w++;0==w%2&&P.push(g),P=P.filter(function(E,_,R){return 0==_?E!=R[_+1]:_==R.length-1?E!=R[_-1]:E!=R[_-1]&&E!=R[_+1]}),this.peakCacheRanges=this.peakCacheRanges.concat(P),this.peakCacheRanges=this.peakCacheRanges.sort(function(E,_){return E-_}).filter(function(E,_,R){return 0==_?E!=R[_+1]:_==R.length-1?E!=R[_-1]:E!=R[_-1]&&E!=R[_+1]});var C=[];for(w=0;w<P.length;w+=2)C.push([P[w],P[w+1]]);return C}},{key:"getCacheRanges",value:function(){var k,v=[];for(k=0;k<this.peakCacheRanges.length;k+=2)v.push([this.peakCacheRanges[k],this.peakCacheRanges[k+1]]);return v}}]),f}();r.default=u,t.exports=r.default},"./src/util/ajax.js":function(t,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(u){var f=new d.default,m=new XMLHttpRequest,v=!1;return m.open(u.method||"GET",u.url,!0),m.responseType=u.responseType||"json",u.xhr&&(u.xhr.requestHeaders&&u.xhr.requestHeaders.forEach(function(k){m.setRequestHeader(k.key,k.value)}),u.xhr.withCredentials&&(m.withCredentials=!0)),m.addEventListener("progress",function(k){f.fireEvent("progress",k),k.lengthComputable&&k.loaded==k.total&&(v=!0)}),m.addEventListener("load",function(k){v||f.fireEvent("progress",k),f.fireEvent("load",k),200==m.status||206==m.status?f.fireEvent("success",m.response,k):f.fireEvent("error",k)}),m.addEventListener("error",function(k){return f.fireEvent("error",k)}),m.send(),f.xhr=m,f};var d=function(u){return u&&u.__esModule?u:{default:u}}(n("./src/util/observer.js"));t.exports=r.default},"./src/util/extend.js":function(t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(l){for(var d=arguments.length,u=Array(1<d?d-1:0),f=1;f<d;f++)u[f-1]=arguments[f];return u.forEach(function(m){Object.keys(m).forEach(function(v){l[v]=m[v]})}),l},t.exports=r.default},"./src/util/frame.js":function(t,r,n){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(u){return function(){for(var f=arguments.length,m=Array(f),v=0;v<f;v++)m[v]=arguments[v];return(0,d.default)(function(){return u.apply(void 0,m)})}};var d=function(u){return u&&u.__esModule?u:{default:u}}(n("./src/util/request-animation-frame.js"));t.exports=r.default},"./src/util/get-id.js":function(t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},t.exports=r.default},"./src/util/index.js":function(t,r,n){"use strict";function s(E){return E&&E.__esModule?E:{default:E}}Object.defineProperty(r,"__esModule",{value:!0}),Object.defineProperty(r,"ajax",{enumerable:!0,get:function(){return l.default}}),Object.defineProperty(r,"getId",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(r,"max",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(r,"min",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(r,"Observer",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(r,"extend",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(r,"style",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(r,"requestAnimationFrame",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(r,"frame",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(r,"debounce",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(r,"preventClick",{enumerable:!0,get:function(){return C.default}});var l=s(n("./src/util/ajax.js")),d=s(n("./src/util/get-id.js")),u=s(n("./src/util/max.js")),f=s(n("./src/util/min.js")),m=s(n("./src/util/observer.js")),v=s(n("./src/util/extend.js")),k=s(n("./src/util/style.js")),g=s(n("./src/util/request-animation-frame.js")),P=s(n("./src/util/frame.js")),w=s(n("./node_modules/debounce/index.js")),C=s(n("./src/util/prevent-click.js"))},"./src/util/max.js":function(t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(l){var d=-Infinity;return Object.keys(l).forEach(function(u){l[u]>d&&(d=l[u])}),d},t.exports=r.default},"./src/util/min.js":function(t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(l){var d=+Infinity;return Object.keys(l).forEach(function(u){l[u]<d&&(d=l[u])}),d},t.exports=r.default},"./src/util/observer.js":function(t,r){"use strict";function s(f,m){if(!(f instanceof m))throw new TypeError("Cannot call a class as a function")}function l(f,m){for(var k,v=0;v<m.length;v++)k=m[v],k.enumerable=k.enumerable||!1,k.configurable=!0,"value"in k&&(k.writable=!0),Object.defineProperty(f,k.key,k)}function d(f,m,v){return m&&l(f.prototype,m),v&&l(f,v),f}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var u=function(){function f(){s(this,f),this.handlers=null}return d(f,[{key:"on",value:function(v,k){var g=this;this.handlers||(this.handlers={});var P=this.handlers[v];return P||(P=this.handlers[v]=[]),P.push(k),{name:v,callback:k,un:function(C,E){return g.un(C,E)}}}},{key:"un",value:function(v,k){if(this.handlers){var P,g=this.handlers[v];if(g)if(k)for(P=g.length-1;0<=P;P--)g[P]==k&&g.splice(P,1);else g.length=0}}},{key:"unAll",value:function(){this.handlers=null}},{key:"once",value:function(v,k){var g=this;return this.on(v,function w(){for(var C=arguments.length,E=Array(C),_=0;_<C;_++)E[_]=arguments[_];k.apply(g,E),setTimeout(function(){g.un(v,w)},0)})}},{key:"fireEvent",value:function(v){for(var k=arguments.length,g=Array(1<k?k-1:0),P=1;P<k;P++)g[P-1]=arguments[P];if(this.handlers){var w=this.handlers[v];w&&w.forEach(function(C){C.apply(void 0,g)})}}}]),f}();r.default=u,t.exports=r.default},"./src/util/prevent-click.js":function(t,r){"use strict";function s(d){d.stopPropagation(),document.body.removeEventListener("click",s,!0)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(){document.body.addEventListener("click",s,!0)},t.exports=r.default},"./src/util/request-animation-frame.js":function(t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var s=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(l){return setTimeout(l,1e3/60)}).bind(window);r.default=s,t.exports=r.default},"./src/util/style.js":function(t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(l,d){return Object.keys(d).forEach(function(u){l.style[u]!==d[u]&&(l.style[u]=d[u])}),l},t.exports=r.default},"./src/wavesurfer.js":function(t,r,n){"use strict";function s(T){return T&&T.__esModule?T:{default:T}}function d(T){return d="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(D){return typeof D}:function(D){return D&&"function"===typeof Symbol&&D.constructor===Symbol&&D!==Symbol.prototype?"symbol":typeof D},d(T)}function u(T,O){return O&&("object"===d(O)||"function"===typeof O)?O:k(T)}function f(T){return f=Object.setPrototypeOf?Object.getPrototypeOf:function(D){return D.__proto__||Object.getPrototypeOf(D)},f(T)}function m(T,O){if("function"!==typeof O&&null!==O)throw new TypeError("Super expression must either be null or a function");T.prototype=Object.create(O&&O.prototype,{constructor:{value:T,writable:!0,configurable:!0}}),O&&v(T,O)}function v(T,O){return v=Object.setPrototypeOf||function(M,B){return M.__proto__=B,M},v(T,O)}function k(T){if(void 0===T)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return T}function g(T,O){if(!(T instanceof O))throw new TypeError("Cannot call a class as a function")}function P(T,O){for(var M,D=0;D<O.length;D++)M=O[D],M.enumerable=M.enumerable||!1,M.configurable=!0,"value"in M&&(M.writable=!0),Object.defineProperty(T,M.key,M)}function w(T,O,D){return O&&P(T.prototype,O),D&&P(T,D),T}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var C=function(T){if(T&&T.__esModule)return T;var O={};if(null!=T)for(var D in T)if(Object.prototype.hasOwnProperty.call(T,D)){var M=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(T,D):{};M.get||M.set?Object.defineProperty(O,D,M):O[D]=T[D]}return O.default=T,O}(n("./src/util/index.js")),E=s(n("./src/drawer.multicanvas.js")),_=s(n("./src/webaudio.js")),R=s(n("./src/mediaelement.js")),S=s(n("./src/peakcache.js")),A=function(){function T(){g(this,T)}return w(T,[{key:"create",value:function(){}}]),w(T,[{key:"init",value:function(){}},{key:"destroy",value:function(){}}]),T}(),W=function(T){function O(D){var M;if(g(this,O),M=u(this,f(O).call(this)),M.defaultParams={audioContext:null,audioRate:1,autoCenter:!0,backend:"WebAudio",barHeight:1,barGap:null,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,loopSelection:!0,maxCanvasWidth:4e3,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,normalize:!1,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"#555",removeMediaElementOnDestroy:!0,renderer:E.default,responsive:!1,scrollParent:!1,skipLength:2,splitChannels:!1,waveColor:"#999",xhr:{}},M.backends={MediaElement:R.default,WebAudio:_.default},M.util=C,M.params=C.extend({},M.defaultParams,D),M.container="string"==typeof D.container?document.querySelector(M.params.container):M.params.container,!M.container)throw new Error("Container element not found");if(M.mediaContainer=null==M.params.mediaContainer?M.container:"string"==typeof M.params.mediaContainer?document.querySelector(M.params.mediaContainer):M.params.mediaContainer,!M.mediaContainer)throw new Error("Media Container element not found");if(1>=M.params.maxCanvasWidth)throw new Error("maxCanvasWidth must be greater than 1");else if(1==M.params.maxCanvasWidth%2)throw new Error("maxCanvasWidth must be an even number");if(M.savedVolume=0,M.isMuted=!1,M.tmpEvents=[],M.currentAjax=null,M.arraybuffer=null,M.drawer=null,M.backend=null,M.peakCache=null,"function"!==typeof M.params.renderer)throw new Error("Renderer parameter is invalid");M.Drawer=M.params.renderer,M.Backend=M.backends[M.params.backend],M.initialisedPluginList={},M.isDestroyed=!1,M.isReady=!1;var B=0;return M._onResize=C.debounce(function(){B==M.drawer.wrapper.clientWidth||M.params.scrollParent||(B=M.drawer.wrapper.clientWidth,M.drawer.fireEvent("redraw"))},"number"===typeof M.params.responsive?M.params.responsive:100),u(M,k(k(M)))}return m(O,T),w(O,null,[{key:"create",value:function(M){var B=new O(M);return B.init()}}]),w(O,[{key:"init",value:function(){return this.registerPlugins(this.params.plugins),this.createDrawer(),this.createBackend(),this.createPeakCache(),this}},{key:"registerPlugins",value:function(M){var B=this;return M.forEach(function(L){return B.addPlugin(L)}),M.forEach(function(L){L.deferInit||B.initPlugin(L.name)}),this.fireEvent("plugins-registered",M),this}},{key:"addPlugin",value:function(M){var B=this;if(!M.name)throw new Error("Plugin does not have a name!");if(!M.instance)throw new Error("Plugin ".concat(M.name," does not have an instance property!"));M.staticProps&&Object.keys(M.staticProps).forEach(function(I){B[I]=M.staticProps[I]});var L=M.instance,N=Object.getOwnPropertyNames(C.Observer.prototype);return N.forEach(function(I){L.prototype[I]=C.Observer.prototype[I]}),this[M.name]=new L(M.params||{},this),this.fireEvent("plugin-added",M.name),this}},{key:"initPlugin",value:function(M){if(!this[M])throw new Error("Plugin ".concat(M," has not been added yet!"));return this.initialisedPluginList[M]&&this.destroyPlugin(M),this[M].init(),this.initialisedPluginList[M]=!0,this.fireEvent("plugin-initialised",M),this}},{key:"destroyPlugin",value:function(M){if(!this[M])throw new Error("Plugin ".concat(M," has not been added yet and cannot be destroyed!"));if(!this.initialisedPluginList[M])throw new Error("Plugin ".concat(M," is not active and cannot be destroyed!"));if("function"!==typeof this[M].destroy)throw new Error("Plugin ".concat(M," does not have a destroy function!"));return this[M].destroy(),delete this.initialisedPluginList[M],this.fireEvent("plugin-destroyed",M),this}},{key:"destroyAllPlugins",value:function(){var M=this;Object.keys(this.initialisedPluginList).forEach(function(B){return M.destroyPlugin(B)})}},{key:"createDrawer",value:function(){var M=this;this.drawer=new this.Drawer(this.container,this.params),this.drawer.init(),this.fireEvent("drawer-created",this.drawer),!1!==this.params.responsive&&(window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0)),this.drawer.on("redraw",function(){M.drawBuffer(),M.drawer.progress(M.backend.getPlayedPercents())}),this.drawer.on("click",function(B,L){setTimeout(function(){return M.seekTo(L)},0)}),this.drawer.on("scroll",function(B){M.params.partialRender&&M.drawBuffer(),M.fireEvent("scroll",B)})}},{key:"createBackend",value:function(){var M=this;this.backend&&this.backend.destroy(),"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend||this.Backend.prototype.supportsWebAudio.call(null)||(this.params.backend="MediaElement"),this.backend=new this.Backend(this.params),this.backend.init(),this.fireEvent("backend-created",this.backend),this.backend.on("finish",function(){return M.fireEvent("finish")}),this.backend.on("play",function(){return M.fireEvent("play")}),this.backend.on("pause",function(){return M.fireEvent("pause")}),this.backend.on("audioprocess",function(B){M.drawer.progress(M.backend.getPlayedPercents()),M.fireEvent("audioprocess",B)})}},{key:"createPeakCache",value:function(){this.params.partialRender&&(this.peakCache=new S.default)}},{key:"getDuration",value:function(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function(M){M>=this.getDuration()?this.seekTo(1):this.seekTo(M/this.getDuration())}},{key:"play",value:function(M,B){var L=this;return this.fireEvent("interaction",function(){return L.play(M,B)}),this.backend.play(M,B)}},{key:"pause",value:function(){if(!this.backend.isPaused())return this.backend.pause()}},{key:"playPause",value:function(){return this.backend.isPaused()?this.play():this.pause()}},{key:"isPlaying",value:function(){return!this.backend.isPaused()}},{key:"skipBackward",value:function(M){this.skip(-M||-this.params.skipLength)}},{key:"skipForward",value:function(M){this.skip(M||this.params.skipLength)}},{key:"skip",value:function(M){var B=this.getDuration()||1,L=this.getCurrentTime()||0;L=Math.max(0,Math.min(B,L+(M||0))),this.seekAndCenter(L/B)}},{key:"seekAndCenter",value:function(M){this.seekTo(M),this.drawer.recenter(M)}},{key:"seekTo",value:function(M){var B=this;if("number"!==typeof M||!isFinite(M)||0>M||1<M)return console.error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!");this.fireEvent("interaction",function(){return B.seekTo(M)});var L=this.backend.isPaused();L||this.backend.pause();var N=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(M*this.getDuration()),this.drawer.progress(M),L||this.backend.play(),this.params.scrollParent=N,this.fireEvent("seek",M)}},{key:"stop",value:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)}},{key:"setSinkId",value:function(M){return this.backend.setSinkId(M)}},{key:"setVolume",value:function(M){this.backend.setVolume(M),this.fireEvent("volume",M)}},{key:"getVolume",value:function(){return this.backend.getVolume()}},{key:"setPlaybackRate",value:function(M){this.backend.setPlaybackRate(M)}},{key:"getPlaybackRate",value:function(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function(){this.setMute(!this.isMuted)}},{key:"setMute",value:function(M){return M===this.isMuted?void this.fireEvent("mute",this.isMuted):void(M?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0,this.fireEvent("volume",0)):(this.backend.setVolume(this.savedVolume),this.isMuted=!1,this.fireEvent("volume",this.savedVolume)),this.fireEvent("mute",this.isMuted))}},{key:"getMute",value:function(){return this.isMuted}},{key:"isReady",value:function(){return this.isReady}},{key:"getFilters",value:function(){return this.backend.filters||[]}},{key:"toggleScroll",value:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()}},{key:"toggleInteraction",value:function(){this.params.interact=!this.params.interact}},{key:"getWaveColor",value:function(){return this.params.waveColor}},{key:"setWaveColor",value:function(M){this.params.waveColor=M,this.drawBuffer()}},{key:"getProgressColor",value:function(){return this.params.progressColor}},{key:"setProgressColor",value:function(M){this.params.progressColor=M,this.drawBuffer()}},{key:"getCursorColor",value:function(){return this.params.cursorColor}},{key:"setCursorColor",value:function(M){this.params.cursorColor=M,this.drawer.updateCursor()}},{key:"getHeight",value:function(){return this.params.height}},{key:"setHeight",value:function(M){this.params.height=M,this.drawer.setHeight(M*this.params.pixelRatio),this.drawBuffer()}},{key:"drawBuffer",value:function(){var M=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),B=this.drawer.getWidth(),L=M,N=this.drawer.getScrollX(),I=Math.max(N+B,L);this.params.fillParent&&(!this.params.scrollParent||M<B)&&(L=B,N=0,I=L);var V;if(this.params.partialRender){var z,F=this.peakCache.addRangeToPeakCache(L,N,I);for(z=0;z<F.length;z++)V=this.backend.getPeaks(L,F[z][0],F[z][1]),this.drawer.drawPeaks(V,L,F[z][0],F[z][1])}else V=this.backend.getPeaks(L,N,I),this.drawer.drawPeaks(V,L,N,I);this.fireEvent("redraw",V,L)}},{key:"zoom",value:function(M){M?(this.params.minPxPerSec=M,this.params.scrollParent=!0):(this.params.minPxPerSec=this.defaultParams.minPxPerSec,this.params.scrollParent=!1),this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",M)}},{key:"loadArrayBuffer",value:function(M){var B=this;this.decodeArrayBuffer(M,function(L){B.isDestroyed||B.loadDecodedBuffer(L)})}},{key:"loadDecodedBuffer",value:function(M){this.backend.load(M),this.drawBuffer(),this.fireEvent("ready"),this.isReady=!0}},{key:"loadBlob",value:function(M){var B=this,L=new FileReader;L.addEventListener("progress",function(N){return B.onProgress(N)}),L.addEventListener("load",function(N){return B.loadArrayBuffer(N.target.result)}),L.addEventListener("error",function(){return B.fireEvent("error","Error reading file")}),L.readAsArrayBuffer(M),this.empty()}},{key:"load",value:function(M,B,L,N){if(this.empty(),L){var I={"Preload is not 'auto', 'none' or 'metadata'":-1===["auto","metadata","none"].indexOf(L),"Peaks are not provided":!B,"Backend is not of type MediaElement":"MediaElement"!==this.params.backend,"Url is not of type string":"string"!==typeof M},V=Object.keys(I).filter(function(F){return I[F]});V.length&&(console.warn("Preload parameter of wavesurfer.load will be ignored because:\n\t- "+V.join("\n\t- ")),L=null)}switch(this.params.backend){case"WebAudio":return this.loadBuffer(M,B,N);case"MediaElement":return this.loadMediaElement(M,B,L,N);}}},{key:"loadBuffer",value:function(M,B,L){var N=this,I=function(F){return F&&N.tmpEvents.push(N.once("ready",F)),N.getArrayBuffer(M,function(z){return N.loadArrayBuffer(z)})};return B?void(this.backend.setPeaks(B,L),this.drawBuffer(),this.tmpEvents.push(this.once("interaction",I))):I()}},{key:"loadMediaElement",value:function(M,B,L,N){var I=this,V=M;if("string"===typeof M)this.backend.load(V,this.mediaContainer,B,L);else{var F=M;this.backend.loadElt(F,B),V=F.src}this.tmpEvents.push(this.backend.once("canplay",function(){I.drawBuffer(),I.fireEvent("ready"),I.isReady=!0}),this.backend.once("error",function(z){return I.fireEvent("error",z)})),B&&this.backend.setPeaks(B,N),(!B||this.params.forceDecode)&&this.backend.supportsWebAudio()&&this.getArrayBuffer(V,function(z){I.decodeArrayBuffer(z,function(H){I.backend.buffer=H,I.backend.setPeaks(null),I.drawBuffer(),I.fireEvent("waveform-ready")})})}},{key:"decodeArrayBuffer",value:function(M,B){var L=this;this.arraybuffer=M,this.backend.decodeArrayBuffer(M,function(N){L.isDestroyed||L.arraybuffer!=M||(B(N),L.arraybuffer=null)},function(){return L.fireEvent("error","Error decoding audiobuffer")})}},{key:"getArrayBuffer",value:function(M,B){var L=this,N=C.ajax({url:M,responseType:"arraybuffer",xhr:this.params.xhr});return this.currentAjax=N,this.tmpEvents.push(N.on("progress",function(I){L.onProgress(I)}),N.on("success",function(I){B(I),L.currentAjax=null}),N.on("error",function(I){L.fireEvent("error","XHR error: "+I.target.statusText),L.currentAjax=null})),N}},{key:"onProgress",value:function(M){var B;B=M.lengthComputable?M.loaded/M.total:M.loaded/(M.loaded+1e6),this.fireEvent("loading",Math.round(100*B),M.target)}},{key:"exportPCM",value:function(M,B,L,N){M=M||1024,N=N||0,B=B||1e4,L=L||!1;var I=this.backend.getPeaks(M,N),V=[].map.call(I,function(z){return Math.round(z*B)/B}),F=JSON.stringify(V);return L||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(F)),F}},{key:"exportImage",value:function(M,B){return M||(M="image/png"),B||(B=1),this.drawer.getImage(M,B)}},{key:"cancelAjax",value:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)}},{key:"clearTmpEvents",value:function(){this.tmpEvents.forEach(function(M){return M.un()})}},{key:"empty",value:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.isReady=!1,this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}},{key:"destroy",value:function(){this.destroyAllPlugins(),this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),!1!==this.params.responsive&&(window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0)),this.backend.destroy(),this.drawer.destroy(),this.isDestroyed=!0,this.isReady=!1,this.arraybuffer=null}}]),O}(C.Observer);r.default=W,W.VERSION="2.1.0",W.util=C,t.exports=r.default},"./src/webaudio.js":function(t,r,n){"use strict";function l(A){return l="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(T){return typeof T}:function(T){return T&&"function"===typeof Symbol&&T.constructor===Symbol&&T!==Symbol.prototype?"symbol":typeof T},l(A)}function d(A,W,T){return W in A?Object.defineProperty(A,W,{value:T,enumerable:!0,configurable:!0,writable:!0}):A[W]=T,A}function u(A,W){if(!(A instanceof W))throw new TypeError("Cannot call a class as a function")}function f(A,W){return W&&("object"===l(W)||"function"===typeof W)?W:m(A)}function m(A){if(void 0===A)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return A}function v(A){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(T){return T.__proto__||Object.getPrototypeOf(T)},v(A)}function k(A,W){for(var O,T=0;T<W.length;T++)O=W[T],O.enumerable=O.enumerable||!1,O.configurable=!0,"value"in O&&(O.writable=!0),Object.defineProperty(A,O.key,O)}function g(A,W,T){return W&&k(A.prototype,W),T&&k(A,T),A}function P(A,W){if("function"!==typeof W&&null!==W)throw new TypeError("Super expression must either be null or a function");A.prototype=Object.create(W&&W.prototype,{constructor:{value:A,writable:!0,configurable:!0}}),W&&w(A,W)}function w(A,W){return w=Object.setPrototypeOf||function(O,D){return O.__proto__=D,O},w(A,W)}Object.defineProperty(r,"__esModule",{value:!0}),r.default=void 0;var C=function(A){if(A&&A.__esModule)return A;var W={};if(null!=A)for(var T in A)if(Object.prototype.hasOwnProperty.call(A,T)){var O=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(A,T):{};O.get||O.set?Object.defineProperty(W,T,O):W[T]=A[T]}return W.default=A,W}(n("./src/util/index.js")),E="playing",_="paused",R="finished",S=function(A){function W(T){var O,D,M;return u(this,W),M=f(this,v(W).call(this)),M.audioContext=null,M.offlineAudioContext=null,M.stateBehaviors=(O={},d(O,E,{init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var L=this.getDuration();return this.getCurrentTime()/L||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}}),d(O,_,{init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var L=this.getDuration();return this.getCurrentTime()/L||0},getCurrentTime:function(){return this.startPosition}}),d(O,R,{init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}}),O),M.params=T,M.ac=T.audioContext||M.getAudioContext(),M.lastPlay=M.ac.currentTime,M.startPosition=0,M.scheduledPause=null,M.states=(D={},d(D,E,Object.create(M.stateBehaviors[E])),d(D,_,Object.create(M.stateBehaviors[_])),d(D,R,Object.create(M.stateBehaviors[R])),D),M.analyser=null,M.buffer=null,M.filters=[],M.gainNode=null,M.mergedPeaks=null,M.offlineAc=null,M.peaks=null,M.playbackRate=1,M.analyser=null,M.scriptNode=null,M.source=null,M.splitPeaks=[],M.state=null,M.explicitDuration=null,M}return P(W,A),g(W,[{key:"supportsWebAudio",value:function(){return!!(window.AudioContext||window.webkitAudioContext)}},{key:"getAudioContext",value:function(){return window.WaveSurferAudioContext||(window.WaveSurferAudioContext=new(window.AudioContext||window.webkitAudioContext)),window.WaveSurferAudioContext}},{key:"getOfflineAudioContext",value:function(O){return window.WaveSurferOfflineAudioContext||(window.WaveSurferOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,O)),window.WaveSurferOfflineAudioContext}}]),g(W,[{key:"init",value:function(){this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(_),this.setPlaybackRate(this.params.audioRate),this.setLength(0)}},{key:"disconnectFilters",value:function(){this.filters&&(this.filters.forEach(function(O){O&&O.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))}},{key:"setState",value:function(O){this.state!==this.states[O]&&(this.state=this.states[O],this.state.init.call(this))}},{key:"setFilter",value:function(){for(var O=arguments.length,D=Array(O),M=0;M<O;M++)D[M]=arguments[M];this.setFilters(D)}},{key:"setFilters",value:function(O){this.disconnectFilters(),O&&O.length&&(this.filters=O,this.analyser.disconnect(),O.reduce(function(D,M){return D.connect(M),M},this.analyser).connect(this.gainNode))}},{key:"createScriptNode",value:function(){this.scriptNode=this.params.audioScriptProcessor?this.params.audioScriptProcessor:this.ac.createScriptProcessor?this.ac.createScriptProcessor(W.scriptBufferSize):this.ac.createJavaScriptNode(W.scriptBufferSize),this.scriptNode.connect(this.ac.destination)}},{key:"addOnAudioProcess",value:function(){var O=this;this.scriptNode.onaudioprocess=function(){var D=O.getCurrentTime();D>=O.getDuration()?(O.setState(R),O.fireEvent("pause")):D>=O.scheduledPause?O.pause():O.state===O.states[E]&&O.fireEvent("audioprocess",D)}}},{key:"removeOnAudioProcess",value:function(){this.scriptNode.onaudioprocess=null}},{key:"createAnalyserNode",value:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)}},{key:"createVolumeNode",value:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)}},{key:"setSinkId",value:function(O){if(O){var D=new window.Audio;if(!D.setSinkId)return Promise.reject(new Error("setSinkId is not supported in your browser"));D.autoplay=!0;var M=this.ac.createMediaStreamDestination();return this.gainNode.disconnect(),this.gainNode.connect(M),D.srcObject=M.stream,D.setSinkId(O)}return Promise.reject(new Error("Invalid deviceId: "+O))}},{key:"setVolume",value:function(O){this.gainNode.gain.setValueAtTime(O,this.ac.currentTime)}},{key:"getVolume",value:function(){return this.gainNode.gain.value}},{key:"decodeArrayBuffer",value:function(O,D,M){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac&&this.ac.sampleRate?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(O,function(B){return D(B)},M)}},{key:"setPeaks",value:function(O,D){this.explicitDuration=D,this.peaks=O}},{key:"setLength",value:function(O){if(!(this.mergedPeaks&&O==2*this.mergedPeaks.length-1+2)){this.splitPeaks=[],this.mergedPeaks=[];var M,D=this.buffer?this.buffer.numberOfChannels:1;for(M=0;M<D;M++)this.splitPeaks[M]=[],this.splitPeaks[M][2*(O-1)]=0,this.splitPeaks[M][2*(O-1)+1]=0;this.mergedPeaks[2*(O-1)]=0,this.mergedPeaks[2*(O-1)+1]=0}}},{key:"getPeaks",value:function(O,D,M){if(this.peaks)return this.peaks;if(D=D||0,M=M||O-1,this.setLength(O),!this.buffer.length){var B=this.createBuffer(1,4096,this.sampleRate);this.buffer=B.buffer}var V,L=this.buffer.length/O,I=this.buffer.numberOfChannels;for(V=0;V<I;V++){var F=this.splitPeaks[V],z=this.buffer.getChannelData(V),H=void 0;for(H=D;H<=M;H++){var q=~~(H*L),X=0,Y=0,U=void 0;for(U=q;U<~~(q+L);U+=~~(L/10)||1){var J=z[U];J>Y&&(Y=J),J<X&&(X=J)}F[2*H]=Y,F[2*H+1]=X,(0==V||Y>this.mergedPeaks[2*H])&&(this.mergedPeaks[2*H]=Y),(0==V||X<this.mergedPeaks[2*H+1])&&(this.mergedPeaks[2*H+1]=X)}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}},{key:"getPlayedPercents",value:function(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function(){this.source&&this.source.disconnect()}},{key:"destroy",value:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&("function"===typeof this.ac.close&&"closed"!=this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:window.WaveSurferAudioContext=null,window.WaveSurferOfflineAudioContext=null)}},{key:"load",value:function(O){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=O,this.createSource()}},{key:"createSource",value:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime),this.source.buffer=this.buffer,this.source.connect(this.analyser)}},{key:"isPaused",value:function(){return this.state!==this.states[E]}},{key:"getDuration",value:function(){return this.buffer?this.buffer.duration:this.explicitDuration?this.explicitDuration:0}},{key:"seekTo",value:function(O,D){if(this.buffer)return this.scheduledPause=null,null==O&&(O=this.getCurrentTime(),O>=this.getDuration()&&(O=0)),null==D&&(D=this.getDuration()),this.startPosition=O,this.lastPlay=this.ac.currentTime,this.state===this.states[R]&&this.setState(_),{start:O,end:D}}},{key:"getPlayedTime",value:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function(O,D){if(this.buffer){this.createSource();var M=this.seekTo(O,D);O=M.start,D=M.end,this.scheduledPause=D,this.source.start(0,O,D-O),"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume(),this.setState(E),this.fireEvent("play")}}},{key:"pause",value:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(_),this.fireEvent("pause")}},{key:"getCurrentTime",value:function(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setPlaybackRate",value:function(O){O=O||1,this.isPaused()?this.playbackRate=O:(this.pause(),this.playbackRate=O,this.play())}}]),W}(C.Observer);r.default=S,S.scriptBufferSize=256,t.exports=r.default}})});