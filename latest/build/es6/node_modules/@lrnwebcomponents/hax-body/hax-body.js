import{html,Polymer}from"@polymer/polymer/polymer-legacy.js";import{dom}from"@polymer/polymer/lib/legacy/polymer.dom.js";import{FlattenedNodesObserver}from"@polymer/polymer/lib/utils/flattened-nodes-observer.js";import{flush}from"@polymer/polymer/lib/utils/flush.js";import*as async from"@polymer/polymer/lib/utils/async.js";import"@polymer/paper-item/paper-item.js";import"@lrnwebcomponents/simple-colors/simple-colors.js";import"@polymer/iron-a11y-keys/iron-a11y-keys.js";import"@lrnwebcomponents/grid-plate/grid-plate.js";import"./lib/hax-text-context.js";import"./lib/hax-ce-context.js";import"./lib/hax-plate-context.js";import"./lib/hax-input-mixer.js";var $_documentContainer=document.createElement("div");$_documentContainer.setAttribute("style","display: none;"),$_documentContainer.innerHTML=`<dom-module id="hax-body">
  <template strip-whitespace="">
    <style include="simple-colors">
      :host {
        display: block;
        min-height: 32px;
        min-width: 32px;
        /*font-family: sans-serif;*/
      }
      :host #bodycontainer ::slotted(.hax-context-menu) {
        padding: 0;
        margin: 0;
        position: absolute;
        visibility: hidden;
        opacity: 0;
        transition: all .3s ease;
        z-index: 100;
        float: left;
        display: block;
      }
      :host #bodycontainer ::slotted(#haxinputmixer) {
        z-index: 10000000;
      }
      :host #bodycontainer ::slotted(.hax-context-visible) {
        visibility: visible;
        opacity: 1;
      }
      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {
        outline: none;
        transition:
          .6s width ease-in-out,
          .6s height ease-in-out,
          .6s margin ease-in-out;
      }
      :host([edit-mode]) #bodycontainer ::slotted(p):empty {
        background: #f8f8f8;
      }
      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]):hover {
        outline: 1px dotted #d3d3d3;
        outline-offset: 2px;
      }
      :host([edit-mode]) #bodycontainer ::slotted(* [data-editable]):hover {
        outline: 1px dotted #d3d3d3;
        outline-offset: 2px;
      }
      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]):before {
        content: '';
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        width: 32px;
        transition: .6s all ease;
      }
      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]):hover:before {
        content: '';
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        width: 32px;
        transition: .6s all ease;
      }
      :host([edit-mode]) #bodycontainer ::slotted(*.hax-active[data-editable]) {
        cursor: text !important;
        outline: 1px dashed #c3c3c3 !important;
        outline-offset: 4px;
      }
      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable] .hax-active) {
        cursor: text !important;
        outline: 1px dashed #c3c3c3 !important;
        outline-offset: 4px;
      }
      :host([edit-mode]) #bodycontainer ::slotted(*.hax-active[data-editable]):before {
        content: '';
        display: block;
        position: absolute;
        top: 0;
        left: 0;
        bottom: 0;
        width: 32px;
        transition: .6s all ease;
      }
      :host([edit-mode]) #bodycontainer ::slotted(code.hax-active[data-editable]) {
        display: block;
      }
      :host([edit-mode]) #bodycontainer ::slotted(hr[data-editable]) {
        height:4px;
        background-color: #EEEEEE;
        padding-top: 8px;
        padding-bottom: 8px;
      }
      /** Fix to support safari as it defaults to none */
      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {
        -webkit-user-select: text;
        cursor:pointer;
      }

      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]::-moz-selection),
      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable] *::-moz-selection) {
        background-color: var(--hax-body-highlight, --paper-yellow-300);
        color: black;
      }
      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]::selection),
      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable] *::selection) {
        background-color: var(--hax-body-highlight, --paper-yellow-300);
        color: black;
      }
      #bodycontainer {
        -webkit-user-select: text;
        user-select: text;
      }

      #contextcontainer {
        display: none;
      }
      :host([edit-mode])[hax-ray-mode] #bodycontainer ::slotted(*[data-editable]) {
        outline: 1px dashed #d3d3d3;
        outline-offset: 4px;
      }
      :host([edit-mode])[hax-ray-mode] #bodycontainer ::slotted(*[data-editable]):before {
        content: attr(data-hax-ray) " " attr(resource) " " attr(typeof) " " attr(property) " " attr(content);
        font-size: 10px;
        font-style: italic;
        left: unset;
        right: unset;
        top: unset;
        background-color: #d3d3d3;
        color: #000000;
        bottom: unset;
        width: auto;
        padding: 8px;
        margin: 0;
        z-index: 1;
        margin: -16px 0 0 0;
        float: left;
        line-height: 2;
      }
    </style>
    <div id="bodycontainer" class="ignore-activation">
      <slot id="body"></slot>
    </div>
    <div id="contextcontainer">
      <hax-text-context id="textcontextmenu" class="hax-context-menu ignore-activation"></hax-text-context>
      <hax-ce-context id="cecontextmenu" class="hax-context-menu ignore-activation"></hax-ce-context>
      <hax-plate-context id="platecontextmenu" class="hax-context-menu ignore-activation"></hax-plate-context>
      <hax-input-mixer id="haxinputmixer" class="hax-context-menu ignore-activation"></hax-input-mixer>
    </div>
    <iron-a11y-keys target="[[activeContainerNode]]" keys="esc" on-keys-pressed="_escKeyPressed" stop-keyboard-event-propagation=""></iron-a11y-keys>
    <iron-a11y-keys target="[[activeContainerNode]]" keys="del backspace" on-keys-pressed="_delKeyPressed"></iron-a11y-keys>
    <iron-a11y-keys target="[[activeContainerNode]]" keys="shift+tab" on-keys-pressed="_tabBackKeyPressed" stop-keyboard-event-propagation=""></iron-a11y-keys>
    <iron-a11y-keys target="[[activeContainerNode]]" keys="tab" on-keys-pressed="_tabKeyPressed" stop-keyboard-event-propagation=""></iron-a11y-keys>
    <iron-a11y-keys target="[[activeContainerNode]]" keys="up" on-keys-pressed="_upKeyPressed" stop-keyboard-event-propagation=""></iron-a11y-keys>
    <iron-a11y-keys target="[[activeContainerNode]]" keys="down" on-keys-pressed="_downKeyPressed" stop-keyboard-event-propagation=""></iron-a11y-keys>

  </template>

  
</dom-module>`,document.head.appendChild($_documentContainer);let HaxBody=Polymer({is:"hax-body",listeners:{focusin:"_focusIn",mousedown:"_focusIn","hax-context-item-selected":"_haxContextOperation","hax-input-mixer-update":"_haxInputMixerOperation","place-holder-replace":"replacePlaceholder"},properties:{editMode:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_editModeChanged"},globalPreferences:{type:Object,value:{},observer:"_globalPreferencesUpdated"},haxRayMode:{type:Boolean,value:!1,reflectToAttribute:!0},activeNode:{type:Object,value:null,notify:!0,observer:"_activeNodeChanged"},activeContainerNode:{type:Object,value:null,notify:!0,observer:"_activeContainerNodeChanged"}},ready:function(){this.polyfillSafe=window.HaxStore.instance.computePolyfillSafe(),this._observer=new FlattenedNodesObserver(this,a=>{flush(),0<a.addedNodes.length&&a.addedNodes.map(b=>{this._haxElementTest(b)&&(this._HTMLPrimativeTest(b)&&(b.contentEditable=this.editMode),b.setAttribute("data-editable",this.editMode),b.setAttribute("data-hax-ray",b.tagName),this.fire("hax-body-tag-added",{node:b}))}),0<a.removedNodes.length&&a.removedNodes.map(b=>{this._haxElementTest(b)&&!b.classList.contains("hax-active")&&this.fire("hax-body-tag-removed",{node:b})})})},attached:function(){this.__tabTrap=!1,this.fire("hax-register-body",this),document.body.addEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),document.body.addEventListener("selectstart",this._selectionChange.bind(this)),document.body.addEventListener("mouseup",this._selectionMouseUp.bind(this)),window.addEventListener("scroll",this._keepContextVisible.bind(this))},detached:function(){document.body.removeEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),document.body.removeEventListener("selectstart",this._selectionChange.bind(this)),document.body.removeEventListener("mouseup",this._selectionMouseUp.bind(this)),window.removeEventListener("scroll",this._keepContextVisible.bind(this))},_keepContextVisible:function(){let b=!1;this.$.textcontextmenu.classList.contains("hax-context-visible")?b=this.$.textcontextmenu:this.$.cecontextmenu.classList.contains("hax-context-visible")&&(b=this.$.cecontextmenu),b&&(this.elementInViewport(b)?(b.classList.remove("hax-context-pin-bottom"),b.classList.remove("hax-context-pin-top")):this.__OffBottom?b.classList.add("hax-context-pin-top"):b.classList.add("hax-context-pin-bottom"))},elementInViewport:function(a){let b=a.offsetTop-32-window.HaxStore.instance.haxPanel.$.drawer.offsetHeight,c=a.offsetLeft,d=a.offsetWidth,f=a.offsetHeight;for(;a.offsetParent;)a=a.offsetParent,b+=a.offsetTop,c+=a.offsetLeft;return this.__OffBottom=b<window.pageYOffset+window.innerHeight,b<window.pageYOffset+window.innerHeight&&c<window.pageXOffset+window.innerWidth&&b+f>window.pageYOffset&&c+d>window.pageXOffset},_selectionChange:function(){window.__startedSelection=!0},_selectionMouseUp:function(){if(window.__startedSelection&&this.editMode)try{let b=window.getSelection(),c=b.getRangeAt(0),d=c.cloneRange();window.__startedSelection=!1,("HAX-BODY"===d.startContainer.parentNode.parentNode.parentElement.tagName||"HAX-BODY"===d.startContainer.parentNode.parentElement.tagName)&&window.HaxStore.write("activePlaceHolder",d,this)}catch(b){}},replacePlaceholder:function(a){if("text"===a.detail){let b=document.createElement("p");this.haxReplaceNode(this.activeNode,b,dom(this.activeNode).parentNode),setTimeout(()=>{window.HaxStore.write("activeNode",b,this),b.focus()},100)}else this.replaceElementWorkflow()},replaceElementWorkflow:function(){let a=window.HaxStore.nodeToHaxElement(this.activeNode,null),b="*",c=!1;"place-holder"===a.tag&&typeof a.properties.type!==typeof void 0&&(b=a.properties.type,c=!0);var d={};if(typeof window.HaxStore.instance.elementList[a.tag]!==typeof void 0&&!1!==window.HaxStore.instance.elementList[a.tag].gizmo&&typeof window.HaxStore.instance.elementList[a.tag].gizmo.handles!==typeof void 0&&0<window.HaxStore.instance.elementList[a.tag].gizmo.handles.length){let k=window.HaxStore.instance.elementList[a.tag].gizmo;for(var f=0;f<k.handles.length;f++)for(var g in k.handles[f])"type"!==g&&typeof a.properties[k.handles[f][g]]!=="undefined"&&(d[g]=a.properties[k.handles[f][g]])}let h=window.HaxStore.guessGizmo(b,d,c);if(0<h.length){let k=this.activeNode.tagName.toLowerCase(),m=k.replace("-"," ");typeof window.HaxStore.instance.elementList[k]!==typeof void 0&&!1!==window.HaxStore.instance.elementList[k].gizmo&&(m=window.HaxStore.instance.elementList[k].gizmo.title),window.HaxStore.instance.haxAppPicker.presentOptions(h,"__convert",`Transform ${m} to..`,"gizmo")}else window.HaxStore.toast("Sorry, this can not be transformed!",5e3)},_globalPreferencesUpdated:function(a){typeof a!==typeof void 0&&null!=a&&(this.haxRayMode=a.haxRayMode)},_haxStorePropertyUpdated:function(a){a.detail&&typeof a.detail.value!==typeof void 0&&a.detail.property&&("object"===typeof a.detail.value&&this.set(a.detail.property,null),this.set(a.detail.property,a.detail.value))},haxClearBody:function(a=!0){let b=!0;a&&(b=prompt("Are you sure you want to delete all content?")),b&&window.HaxStore.wipeSlot(this)},haxInsert:function(a,b,c={}){var d=window.HaxStore.instance.validTagList;if(d.includes(a)){var f=document.createElement(a);f.innerHTML=b;var g=f.cloneNode(!0);for(var h in c){let k=window.HaxStore.camelToDash(h);c.hasOwnProperty(h)&&(!0===c[h]?g.setAttribute(k,c[h]):!1===c[h]?g.removeAttribute(k):null==c[h]||c[h].constructor!==Array||g.properties[h].readOnly?null==c[h]||c[h].constructor!==Object||g.properties[h].readOnly?g.setAttribute(k,c[h]):g.set(k,c[h]):g.set(k,c[h]))}return null!==window.HaxStore.instance.activePlaceHolder&&"undefined"!==typeof window.HaxStore.instance.activePlaceHolder.style?(g.style.width=window.HaxStore.instance.activePlaceHolder.style.width,g.style.float=window.HaxStore.instance.activePlaceHolder.style.float,g.style.margin=window.HaxStore.instance.activePlaceHolder.style.margin,g.style.display=window.HaxStore.instance.activePlaceHolder.style.display,this.haxReplaceNode(window.HaxStore.instance.activePlaceHolder,g,dom(window.HaxStore.instance.activePlaceHolder).parentNode),window.HaxStore.instance.activePlaceHolder=null):null===this.activeContainerNode?dom(this).appendChild(g):"GRID-PLATE"!==g.tagName&&"GRID-PLATE"===this.activeContainerNode.tagName&&this.activeContainerNode!==this.activeNode?(g.setAttribute("slot",this.activeNode.getAttribute("slot")),dom(this.activeContainerNode).insertBefore(g,this.activeNode)):dom(this).insertBefore(g,this.activeContainerNode.nextElementSibling),this.$.textcontextmenu.highlightOps=!1,setTimeout(()=>{window.HaxStore.write("activeContainerNode",g,this),window.HaxStore.write("activeNode",g,this),g.focus(),"function"===typeof g.scrollIntoViewIfNeeded?g.scrollIntoViewIfNeeded(!0):g.scrollIntoView({behavior:"smooth",inline:"center"})},100),!0}return!1},haxToContent:function(){this.hideContextMenus();var a=this.activeNode;window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this);let b=dom(this.$.body).getDistributedNodes();this.globalPreferences.haxDeveloperMode&&console.log(b);for(var c="",d=0,f=b.length;d<f;d++)this._haxElementTest(b[d])?(b[d].removeAttribute("data-editable"),b[d].removeAttribute("data-hax-ray"),b[d].contentEditable=!1,c+=window.HaxStore.haxNodeToContent(b[d]),"grid-plate"===b[d].tagName.toLowerCase()&&this._applyContentEditable(this.editMode,b[d])):8===b[d].nodeType?c+="<!-- "+b[d].textContent+" -->":1!==b[d].nodeType&&"undefined"!==typeof b[d].textContent&&"undefined"!==b[d].textContent&&(c+=b[d].textContent);if(c=c.replace(/\scontenteditable=\"false\"/g,""),c=c.replace(/\sdata-editable=\"true\"/g,""),c=c.replace(/\sdata-editable=\"false\"/g,""),c=c.replace(/\sdata-editable=\""/g,""),c=c.replace(/\sdata-editable/g,""),c=c.replace(/\scontenteditable/g,""),c=c.replace(/\sdraggable/g,""),c=c.replace(/\sdata-draggable/g,""),c=c.replace(/\sdata-hax-ray=\".*?\"/g,""),this.parentNode.tagName){let g=this.parentNode.tagName.toLowerCase(),h="style-scope "+g+" x-scope",k=new RegExp(h,"g");c=c.replace(k,""),h="style-scope "+g,k=new RegExp(h,"g"),c=c.replace(k,""),h="x-scope "+g+"-0",k=new RegExp(h,"g"),c=c.replace(k,"");let m=window.HaxStore.instance.validTagList;for(var d in m.push("hax-preview"),m)h="style-scope "+m[d],k=new RegExp(h,"g"),c=c.replace(k,""),h="x-scope "+m[d]+"-0 ",k=new RegExp(h,"g"),c=c.replace(k,""),h="x-scope "+m[d]+"-0",k=new RegExp(h,"g"),c=c.replace(k,"")}return c=c.replace(/\sclass=\"\"/g,""),c=c.replace(/\sclass=\"\s\"/g,""),this._applyContentEditable(this.editMode),window.HaxStore.write("activeNode",a,this),window.HaxStore.write("activeContainerNode",a,this),c=window.HaxStore.encapScript(c),this.globalPreferences.haxDeveloperMode&&console.log(c),c},haxDuplicateNode:function(a,b=this){this.hideContextMenus();var c=dom(a).cloneNode(!0);return"webview"===c.tagName.toLowerCase()&&window.HaxStore.instance._isSandboxed&&"undefined"!==typeof c.guestinstance&&delete c.guestinstance,null===a?dom(b).appendChild(c):dom(b).insertBefore(c,dom(a).nextSibling),setTimeout(()=>{b===this&&window.HaxStore.write("activeContainerNode",c,this),window.HaxStore.write("activeNode",c,this)},100),!0},hideContextMenus:function(){this._hideContextMenu(this.$.textcontextmenu),this._hideContextMenu(this.$.cecontextmenu),this._hideContextMenu(this.$.platecontextmenu),this._hideContextMenu(this.$.haxinputmixer),this.$.textcontextmenu.highlightOps=!1},positionContextMenus:function(a,b){let c=a.tagName.toLowerCase();window.HaxStore.instance._isSandboxed&&"webview"===c&&(c="iframe");let d=window.HaxStore.instance.elementList[c],f=Math.max(document.documentElement.clientWidth,window.innerWidth||0),g=-39,h=-31;800>f&&(g=0,h=0),typeof d!==typeof void 0&&"P"!==a.tagName?(this.__activeContextType=this.$.cecontextmenu,d.element=a,this.__activeContextType.setHaxProperties(d)):this.__activeContextType=this.$.textcontextmenu,this._positionContextMenu(this.__activeContextType,b,g,-37),this._positionContextMenu(this.$.platecontextmenu,b,h,0,!1),this._HTMLPrimativeTest(a)||a===b?this._HTMLPrimativeTest(b)&&(b.contentEditable=!0):b.contentEditable=!1},haxMoveGridPlate:function(a,b,c){return this.hideContextMenus(),"first"===a?null!==c.previousElementSibling&&dom(this).insertBefore(c,dom(this).firstChild):"up"===a?null!==c.previousElementSibling&&dom(this).insertBefore(c,c.previousElementSibling):"down"===a?null!==c.nextElementSibling&&dom(this).insertBefore(c.nextElementSibling,c):"last"===a?null!==c.nextElementSibling&&dom(this).appendChild(c):void 0,(this.positionContextMenus(b,c),setTimeout(()=>{"function"===typeof c.scrollIntoViewIfNeeded?c.scrollIntoViewIfNeeded(!0):c.scrollIntoView({behavior:"smooth",inline:"center"})},250),!0)},haxReplaceNode:function(a,b,c=this){this.hideContextMenus();try{null!=a.getAttribute("slot")&&b.setAttribute("slot",a.getAttribute("slot")),dom(c).replaceChild(b,a)}catch(d){console.log(d)}return b},haxChangeTagName:function(a,b){this.hideContextMenus();for(var d=document.createElement(b),f=0,g=a.attributes.length;f<g;++f){var h=a.attributes.item(f).nodeName,k=a.attributes.item(f).value;d.setAttribute(h,k)}return d.innerHTML=a.innerHTML,dom(this).replaceChild(d,a),d},haxDeleteNode:function(a,b=this){if(this.hideContextMenus(),null==this.activeContainerNode||null===this.activeContainerNode.previousElementSibling)null!=this.activeContainerNode&&null!==this.activeContainerNode.nextElementSibling?this.activeContainerNode.nextElementSibling.focus():(window.HaxStore.write("activeContainerNode",null,this),window.HaxStore.write("activeNode",null,this));else if(this.activeContainerNode.previousElementSibling.focus(),null!=this.activeContainerNode&&window.HaxStore.instance.isTextElement(this.activeContainerNode)&&""!==dom(this.activeContainerNode).textContent)try{var c=document.createRange(),d=window.getSelection();c.setStart(this.activeContainerNode,1),c.collapse(!0),d.removeAllRanges(),d.addRange(c),this.activeContainerNode.focus()}catch(f){console.log(f)}try{return dom(b).removeChild(a)}catch(f){console.log(f)}},importContent:function(a,b=!0){b&&window.HaxStore.wipeSlot(this,"*"),setTimeout(()=>{a=window.HaxStore.encapScript(a);const c=window.HaxStore.instance.validTagList;let d=document.createElement("div");for(d.insertAdjacentHTML("beforeend",a);null!==d.firstChild;)if(!(typeof d.firstChild.tagName!==typeof void 0&&c.includes(d.firstChild.tagName.toLowerCase())))d.removeChild(d.firstChild);else if(window.HaxStore.instance._isSandboxed&&"iframe"===d.firstChild.tagName.toLowerCase()){for(var f=document.createElement("webview"),g=0,h=d.firstChild.attributes.length;g<h;++g){var k=d.firstChild.attributes.item(g).nodeName,m=d.firstChild.attributes.item(g).value;"height"!==k&&"width"!==k||f.style[k]!=m,f.setAttribute(k,m)}dom(this).appendChild(f)}else dom(this).appendChild(d.firstChild)},200)},_haxContextOperation:function(a){let b=a.detail;var c;switch(b.eventName){case"p":case"h2":case"h3":case"h4":case"h5":case"h6":case"code":case"blockquote":this.$.textcontextmenu.selectedValue=b.eventName,window.HaxStore.write("activeContainerNode",this.haxChangeTagName(this.activeContainerNode,b.eventName),this);break;case"text-align-left":this.activeNode.style.textAlign=null,this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"text-align-right":this.activeNode.style.textAlign="right",this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"grid-plate-convert":this.replaceElementWorkflow();break;case"grid-plate-duplicate":this.activeNode===this.activeContainerNode?this.haxDuplicateNode(this.activeNode):this.haxDuplicateNode(this.activeNode,this.activeContainerNode);break;case"grid-plate-delete":let f=this.activeNode.tagName.toLowerCase(),g=f.replace("-"," ");typeof window.HaxStore.instance.elementList[f]!==typeof void 0&&!1!==window.HaxStore.instance.elementList[f].gizmo&&(g=window.HaxStore.instance.elementList[f].gizmo.title),window.HaxStore.instance.haxAppPicker.presentOptions([{icon:"thumb-up",color:"green",title:"Yes"},{icon:"thumb-down",color:"red",title:"No"}],"",`Remove this \`${g}\`?`,"delete");break;case"grid-plate-first":this.haxMoveGridPlate("first",this.activeNode,this.activeContainerNode);break;case"grid-plate-up":this.haxMoveGridPlate("up",this.activeNode,this.activeContainerNode);break;case"hax-manager-open":window.HaxStore.write("activeHaxElement",{},this),window.HaxStore.instance.haxManager.resetManager(parseInt(b.value)),window.HaxStore.instance.haxManager.toggleDialog();break;case"grid-plate-down":this.haxMoveGridPlate("down",this.activeNode,this.activeContainerNode);break;case"grid-plate-last":this.haxMoveGridPlate("last",this.activeNode,this.activeContainerNode);break;case"close-menu":window.HaxStore.write("activeContainerNode",null,this),window.HaxStore.write("activeNode",null,this);break;case"hax-edit-property":let h=this.$.haxinputmixer;h.label=b.target.label,h.options=b.target.options,h.icon=b.target.icon,h.description=b.target.description,h.required=b.target.required,h.validation=b.target.validation,h.validationType=b.target.validationType,h.inputMethod=b.target.inputMethod,h.value="",typeof b.target.propertyToBind!==typeof void 0&&null!=b.target.propertyToBind&&!1!=b.target.propertyToBind&&(h.propertyToBind=b.target.propertyToBind,h.value=typeof this.activeNode[b.target.propertyToBind]==="undefined"?this.activeNode.getAttribute(b.target.propertyToBind):this.activeNode[b.target.propertyToBind]),this._positionContextMenu(h,this.$.cecontextmenu,-6,-116),h.style.width=null;break;case"hax-align-left":this.activeNode.style.float=null,this.activeNode.style.margin=null,this.activeNode.style.display=null,this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"hax-align-center":this.activeNode.style.float=null,this.activeNode.style.margin="0 auto",this.activeNode.style.display="block",this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"hax-align-right":this.activeNode.style.float="right",this.activeNode.style.margin=null,this.activeNode.style.display=null,this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"hax-size-change":this.activeNode.style.width=b.value+"%",setTimeout(()=>{this.positionContextMenus(this.activeNode,this.activeContainerNode)},1e3);break;case"hax-manager-configure":this._hideContextMenu(this.$.haxinputmixer),window.HaxStore.instance.haxManager.resetManager(),c=window.HaxStore.nodeToHaxElement(window.HaxStore.instance.activeNode),window.HaxStore.write("activeHaxElement",c,this),window.HaxStore.instance.haxManager.editExistingNode=!0,window.HaxStore.instance.haxManager.selectStep("configure"),window.HaxStore.instance.haxManager.toggleDialog(),setTimeout(()=>{window.HaxStore.instance.haxManager.$.preview.$.configurebutton.focus()},100);break;case"hax-manager-configure-container":window.HaxStore.write("activeNode",window.HaxStore.instance.activeContainerNode,this),this._hideContextMenu(this.$.haxinputmixer),window.HaxStore.instance.haxManager.resetManager(),c=window.HaxStore.nodeToHaxElement(window.HaxStore.instance.activeNode),window.HaxStore.write("activeHaxElement",c,this),window.HaxStore.instance.haxManager.editExistingNode=!0,window.HaxStore.instance.haxManager.selectStep("configure"),window.HaxStore.instance.haxManager.toggleDialog(),setTimeout(()=>{window.HaxStore.instance.haxManager.$.preview.$.configurebutton.focus()},100);}},_haxInputMixerOperation:function(a){let b=a.detail.inputMixer;null==b.propertyToBind?null!=b.slotToBind&&(item=document.createElement("span"),item.style.height="inherit",item.innerHTML=b.value,item.slot=b.slotToBind,this.activeNode.appendChild(item)):this.activeNode[b.propertyToBind]=b.value,this._hideContextMenu(this.$.haxinputmixer)},_focusIn:function(a){if(this.editMode&&!this.__tabTrap){var b=dom(a),c=b.localTarget,d=window.HaxStore.instance.validTagList;let f=c,g=null;if(this._haxElementTest(f)&&null!=f.parentNode){for(;"HAX-BODY"!=f.parentNode.tagName;)null===g&&d.includes(f.tagName.toLowerCase())&&"LI"!==f.tagName&&"B"!==f.tagName&&"I"!==f.tagName&&"STRONG"!==f.tagName&&"EM"!==f.tagName&&(g=f),f=f.parentNode;null===g?g=f:window.HaxStore.instance.isGridPlateElement(f)?["UL","OL","LI","P","GRID-PLATE"].includes(f.tagName)&&["UL","OL","LI"].includes(g.tagName)&&(g=f):g=f,this.activeContainerNode!==f&&d.includes(f.tagName.toLowerCase())&&!f.classList.contains("ignore-activation")?(window.HaxStore.write("activeContainerNode",f,this),a.stopPropagation()):f.classList.contains("ignore-activation")&&a.stopPropagation(),this.activeNode!==g&&d.includes(f.tagName.toLowerCase())&&!g.classList.contains("ignore-activation")&&(setTimeout(()=>{window.HaxStore.write("activeNode",g,this)},50),a.stopPropagation())}}else this.__tabTrap=!1},_editModeChanged:function(a,b){typeof b!==typeof void 0&&(this._applyContentEditable(a),!1!==a&&typeof this.activeNode!==typeof void 0&&null!==this.activeNode&&this.positionContextMenus(this.activeNode,this.activeContainerNode)),!1===a&&this.hideContextMenus()},_haxResolvePreviousElement:function(a){for(a=dom(a).previousElementSibling;typeof a.tagName!==typeof void 0&&"HAX-"===a.tagName.substring(0,4);)a=dom(a).previousElementSibling;return a},_haxElementTest:function(a){return typeof a.tagName!=="undefined"&&"HAX-"!==a.tagName.substring(0,4)},_HTMLPrimativeTest:function(a){return typeof a.tagName!=="undefined"&&-1==a.tagName.indexOf("-")},_applyContentEditable:function(a,b=this.$.body){let c=dom(b).getDistributedNodes();0===c.length&&(c=dom(b).getEffectiveChildNodes());for(var d=0,f=c.length;d<f;d++)this._HTMLPrimativeTest(c[d])&&(c[d].contentEditable=a),this._haxElementTest(c[d])&&(a?(c[d].setAttribute("data-editable",a),c[d].setAttribute("data-hax-ray",c[d].tagName)):(c[d].removeAttribute("data-editable"),c[d].removeAttribute("data-hax-ray")))},_activeContainerNodeChanged:function(a){if(this.editMode&&typeof a!==typeof void 0&&null!==a){let c=a.tagName.toLowerCase();"grid-plate"===c&&(a.editMode=this.editMode,this._applyContentEditable(this.editMode,a))}},_activeNodeChanged:function(a,b){if(typeof b!=="undefined"&&null!=b&&b.classList.remove("hax-active"),this.editMode&&typeof a!=="undefined"&&null!==a){let c=a.tagName.toLowerCase();a.classList.add("hax-active"),this.$.textcontextmenu.selectedValue=c,setTimeout(()=>{this.positionContextMenus(a,window.HaxStore.instance.activeContainerNode)},25),"right"==a.style.textAlign?(this.$.textcontextmenu.justifyIcon="editor:format-align-right",this.$.textcontextmenu.justifyValue="text-align-right"):"left"==a.style.textAlign?(this.$.textcontextmenu.justifyIcon="editor:format-align-left",this.$.textcontextmenu.justifyValue="text-align-left"):"left"==a.style.float?(this.$.cecontextmenu.justifyIcon="editor:format-align-left",this.$.cecontextmenu.justifyValue="hax-align-left"):"right"==a.style.float?(this.$.cecontextmenu.justifyIcon="editor:format-align-right",this.$.cecontextmenu.justifyValue="hax-align-right"):"0 auto"==a.style.margin&&(this.$.cecontextmenu.justifyIcon="editor:format-align-center",this.$.cecontextmenu.justifyValue="hax-align-center")}else null===a&&(this.hideContextMenus(),this.$.textcontextmenu.justifyIcon="editor:format-align-left",this.$.textcontextmenu.justifyValue="text-align-left")},_positionContextMenu:function(a,b,c,d,f=!0){try{dom(this).insertBefore(a,b)}catch(h){try{dom(b.parentNode).insertBefore(a,b)}catch(k){}}f&&(a.style.width=b.style.width);let g=b.currentStyle||window.getComputedStyle(b);0==parseInt(g.marginLeft)?c=c+parseInt(b.offsetLeft)-this.offsetLeft:c+=parseInt(g.marginLeft),null!=c&&(a.style["margin-left"]=c+"px"),null!=d&&(a.style["margin-top"]=d+"px"),a.classList.add("hax-context-visible"),async.microTask.run(this._keepContextVisible())},_hideContextMenu:function(a){a.classList.remove("hax-context-visible"),a.classList.remove("hax-context-pin-top"),a.classList.remove("hax-context-pin-bottom"),dom(this.$.contextcontainer).appendChild(a)},_escKeyPressed:function(a){this.editMode&&(a.preventDefault(),a.stopPropagation(),this.$.textcontextmenu.highlightOps?(this.$.textcontextmenu.highlightOps=!1,window.HaxStore.write("activeNode",this.activeContainerNode,this),this.activeContainerNode.focus()):this.activeNode===this.activeContainerNode?(window.HaxStore.write("activeContainerNode",null,this),window.HaxStore.write("activeNode",null,this),document.body.focus()):(window.HaxStore.write("activeNode",this.activeContainerNode,this),this.activeContainerNode.focus()))},_delKeyPressed:function(a){if(this.editMode){const c=dom(this.activeContainerNode).textContent;if(""===c)a.preventDefault(),a.stopPropagation(),this.haxDeleteNode(this.activeContainerNode);else if(window.HaxStore.instance.isTextElement(this._haxResolvePreviousElement(this.activeContainerNode))){var b=window.getSelection();let d=b.getRangeAt(0).cloneRange(),f=d.commonAncestorContainer.tagName;if(typeof f==="undefined"&&(f=d.commonAncestorContainer.parentNode.tagName),0===d.startOffset&&0===d.endOffset&&!["UL","OL","LI"].includes(f)){for(a.preventDefault(),a.stopPropagation();this.activeContainerNode.firstChild;)this._haxResolvePreviousElement(this.activeContainerNode).appendChild(this.activeContainerNode.firstChild);setTimeout(()=>{this.haxDeleteNode(this.activeContainerNode)},100)}}}},_upKeyPressed:function(){if(this.editMode&&""===dom(this.activeContainerNode).textContent){let b=this._haxResolvePreviousElement(this.activeContainerNode);try{b.focus()}catch(c){}}},_downKeyPressed:function(){if(this.editMode&&""===dom(this.activeContainerNode).textContent){let b=dom(this.activeContainerNode);try{b.nextElementSibling.focus()}catch(c){}}},_tabKeyPressed:function(a){if(this.editMode){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();let d=!1,f=this.activeContainerNode;const g=this.activeContainerNode.tagName;try{var b=window.getSelection();let h=b.getRangeAt(0).cloneRange();var c=h.commonAncestorContainer.tagName;if(typeof c==="undefined"&&(c=h.commonAncestorContainer.parentNode.tagName),["UL","OL","LI"].includes(g)||["UL","OL","LI"].includes(c))this.polyfillSafe&&(document.execCommand("indent"),this.__tabTrap=!0);else for(;!d;)null==dom(f).nextSibling?d=!0:"function"===dom(f).nextSibling.focus?(dom(f).nextSibling.focus(),d=!0):f=dom(f).nextSibling}catch(h){}}},_tabBackKeyPressed:function(a){if(this.editMode){a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation();let c=dom(this.activeContainerNode).previousSibling;const d=this.activeContainerNode.tagName;var b=window.getSelection();try{let f=b.getRangeAt(0).cloneRange();if(["UL","OL","LI"].includes(d)||["UL","OL","LI"].includes(f.commonAncestorContainer.parentElement.tagName))this.polyfillSafe&&(document.execCommand("outdent"),this.__tabTrap=!0);else{if(null!=c)for(;null!=c&&!this._haxElementTest(c);)c=dom(c).previousSibling;null!=c&&setTimeout(()=>{c.focus()},100)}}catch(f){}}}});export{HaxBody};