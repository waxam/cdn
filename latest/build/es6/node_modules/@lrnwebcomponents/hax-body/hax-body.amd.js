define(["exports","./node_modules/@polymer/polymer/polymer-legacy.js","./node_modules/@polymer/polymer/lib/legacy/polymer.dom.js","./node_modules/@polymer/polymer/lib/utils/flattened-nodes-observer.js","./node_modules/@polymer/polymer/lib/utils/flush.js","./node_modules/@polymer/polymer/lib/utils/async.js","./node_modules/@polymer/paper-item/paper-item.js","./node_modules/@lrnwebcomponents/simple-colors/simple-colors.js","./node_modules/@polymer/iron-a11y-keys/iron-a11y-keys.js","./node_modules/@lrnwebcomponents/grid-plate/grid-plate.js","./lib/hax-text-context.js","./lib/hax-ce-context.js","./lib/hax-plate-context.js","./lib/hax-input-mixer.js"],function(a,b,c,d,f,g){"use strict";Object.defineProperty(a,"__esModule",{value:!0}),a.HaxBody=void 0,g=babelHelpers.interopRequireWildcard(g);var t=document.createElement("div");t.setAttribute("style","display: none;"),t.innerHTML="<dom-module id=\"hax-body\">\n  <template strip-whitespace=\"\">\n    <style include=\"simple-colors\">\n      :host {\n        display: block;\n        min-height: 32px;\n        min-width: 32px;\n        /*font-family: sans-serif;*/\n      }\n      :host #bodycontainer ::slotted(.hax-context-menu) {\n        padding: 0;\n        margin: 0;\n        position: absolute;\n        visibility: hidden;\n        opacity: 0;\n        transition: all .3s ease;\n        z-index: 100;\n        float: left;\n        display: block;\n      }\n      :host #bodycontainer ::slotted(#haxinputmixer) {\n        z-index: 10000000;\n      }\n      :host #bodycontainer ::slotted(.hax-context-visible) {\n        visibility: visible;\n        opacity: 1;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {\n        outline: none;\n        transition:\n          .6s width ease-in-out,\n          .6s height ease-in-out,\n          .6s margin ease-in-out;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(p):empty {\n        background: #f8f8f8;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]):hover {\n        outline: 1px dotted #d3d3d3;\n        outline-offset: 2px;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(* [data-editable]):hover {\n        outline: 1px dotted #d3d3d3;\n        outline-offset: 2px;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]):before {\n        content: '';\n        display: block;\n        position: absolute;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        width: 32px;\n        transition: .6s all ease;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]):hover:before {\n        content: '';\n        display: block;\n        position: absolute;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        width: 32px;\n        transition: .6s all ease;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*.hax-active[data-editable]) {\n        cursor: text !important;\n        outline: 1px dashed #c3c3c3 !important;\n        outline-offset: 4px;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable] .hax-active) {\n        cursor: text !important;\n        outline: 1px dashed #c3c3c3 !important;\n        outline-offset: 4px;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*.hax-active[data-editable]):before {\n        content: '';\n        display: block;\n        position: absolute;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        width: 32px;\n        transition: .6s all ease;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(code.hax-active[data-editable]) {\n        display: block;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(hr[data-editable]) {\n        height:4px;\n        background-color: #EEEEEE;\n        padding-top: 8px;\n        padding-bottom: 8px;\n      }\n      /** Fix to support safari as it defaults to none */\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {\n        -webkit-user-select: text;\n        cursor:pointer;\n      }\n\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]::-moz-selection),\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable] *::-moz-selection) {\n        background-color: var(--hax-body-highlight, --paper-yellow-300);\n        color: black;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]::selection),\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable] *::selection) {\n        background-color: var(--hax-body-highlight, --paper-yellow-300);\n        color: black;\n      }\n      #bodycontainer {\n        -webkit-user-select: text;\n        user-select: text;\n      }\n\n      #contextcontainer {\n        display: none;\n      }\n      :host([edit-mode])[hax-ray-mode] #bodycontainer ::slotted(*[data-editable]) {\n        outline: 1px dashed #d3d3d3;\n        outline-offset: 4px;\n      }\n      :host([edit-mode])[hax-ray-mode] #bodycontainer ::slotted(*[data-editable]):before {\n        content: attr(data-hax-ray) \" \" attr(resource) \" \" attr(typeof) \" \" attr(property) \" \" attr(content);\n        font-size: 10px;\n        font-style: italic;\n        left: unset;\n        right: unset;\n        top: unset;\n        background-color: #d3d3d3;\n        color: #000000;\n        bottom: unset;\n        width: auto;\n        padding: 8px;\n        margin: 0;\n        z-index: 1;\n        margin: -16px 0 0 0;\n        float: left;\n        line-height: 2;\n      }\n    </style>\n    <div id=\"bodycontainer\" class=\"ignore-activation\">\n      <slot id=\"body\"></slot>\n    </div>\n    <div id=\"contextcontainer\">\n      <hax-text-context id=\"textcontextmenu\" class=\"hax-context-menu ignore-activation\"></hax-text-context>\n      <hax-ce-context id=\"cecontextmenu\" class=\"hax-context-menu ignore-activation\"></hax-ce-context>\n      <hax-plate-context id=\"platecontextmenu\" class=\"hax-context-menu ignore-activation\"></hax-plate-context>\n      <hax-input-mixer id=\"haxinputmixer\" class=\"hax-context-menu ignore-activation\"></hax-input-mixer>\n    </div>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"esc\" on-keys-pressed=\"_escKeyPressed\" stop-keyboard-event-propagation=\"\"></iron-a11y-keys>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"del backspace\" on-keys-pressed=\"_delKeyPressed\"></iron-a11y-keys>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"shift+tab\" on-keys-pressed=\"_tabBackKeyPressed\" stop-keyboard-event-propagation=\"\"></iron-a11y-keys>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"tab\" on-keys-pressed=\"_tabKeyPressed\" stop-keyboard-event-propagation=\"\"></iron-a11y-keys>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"up\" on-keys-pressed=\"_upKeyPressed\" stop-keyboard-event-propagation=\"\"></iron-a11y-keys>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"down\" on-keys-pressed=\"_downKeyPressed\" stop-keyboard-event-propagation=\"\"></iron-a11y-keys>\n\n  </template>\n\n  \n</dom-module>",document.head.appendChild(t);var u=(0,b.Polymer)({is:"hax-body",listeners:{focusin:"_focusIn",mousedown:"_focusIn","hax-context-item-selected":"_haxContextOperation","hax-input-mixer-update":"_haxInputMixerOperation","place-holder-replace":"replacePlaceholder"},properties:{editMode:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_editModeChanged"},globalPreferences:{type:Object,value:{},observer:"_globalPreferencesUpdated"},haxRayMode:{type:Boolean,value:!1,reflectToAttribute:!0},activeNode:{type:Object,value:null,notify:!0,observer:"_activeNodeChanged"},activeContainerNode:{type:Object,value:null,notify:!0,observer:"_activeContainerNodeChanged"}},ready:function(){var x=this;this.polyfillSafe=window.HaxStore.instance.computePolyfillSafe(),this._observer=new d.FlattenedNodesObserver(this,function(y){(0,f.flush)(),0<y.addedNodes.length&&y.addedNodes.map(function(z){x._haxElementTest(z)&&(x._HTMLPrimativeTest(z)&&(z.contentEditable=x.editMode),z.setAttribute("data-editable",x.editMode),z.setAttribute("data-hax-ray",z.tagName),x.fire("hax-body-tag-added",{node:z}))}),0<y.removedNodes.length&&y.removedNodes.map(function(z){x._haxElementTest(z)&&!z.classList.contains("hax-active")&&x.fire("hax-body-tag-removed",{node:z})})})},attached:function(){this.__tabTrap=!1,this.fire("hax-register-body",this),document.body.addEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),document.body.addEventListener("selectstart",this._selectionChange.bind(this)),document.body.addEventListener("mouseup",this._selectionMouseUp.bind(this)),window.addEventListener("scroll",this._keepContextVisible.bind(this))},detached:function(){document.body.removeEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),document.body.removeEventListener("selectstart",this._selectionChange.bind(this)),document.body.removeEventListener("mouseup",this._selectionMouseUp.bind(this)),window.removeEventListener("scroll",this._keepContextVisible.bind(this))},_keepContextVisible:function(){var y=!1;this.$.textcontextmenu.classList.contains("hax-context-visible")?y=this.$.textcontextmenu:this.$.cecontextmenu.classList.contains("hax-context-visible")&&(y=this.$.cecontextmenu),y&&(this.elementInViewport(y)?(y.classList.remove("hax-context-pin-bottom"),y.classList.remove("hax-context-pin-top")):this.__OffBottom?y.classList.add("hax-context-pin-top"):y.classList.add("hax-context-pin-bottom"))},elementInViewport:function(x){for(var y=x.offsetTop-32-window.HaxStore.instance.haxPanel.$.drawer.offsetHeight,z=x.offsetLeft,A=x.offsetWidth,B=x.offsetHeight;x.offsetParent;)x=x.offsetParent,y+=x.offsetTop,z+=x.offsetLeft;return this.__OffBottom=y<window.pageYOffset+window.innerHeight,y<window.pageYOffset+window.innerHeight&&z<window.pageXOffset+window.innerWidth&&y+B>window.pageYOffset&&z+A>window.pageXOffset},_selectionChange:function(){window.__startedSelection=!0},_selectionMouseUp:function(){if(window.__startedSelection&&this.editMode)try{var y=window.getSelection(),z=y.getRangeAt(0),A=z.cloneRange();window.__startedSelection=!1,("HAX-BODY"===A.startContainer.parentNode.parentNode.parentElement.tagName||"HAX-BODY"===A.startContainer.parentNode.parentElement.tagName)&&window.HaxStore.write("activePlaceHolder",A,this)}catch(B){}},replacePlaceholder:function(x){var y=this;if("text"===x.detail){var z=document.createElement("p");this.haxReplaceNode(this.activeNode,z,(0,c.dom)(this.activeNode).parentNode),setTimeout(function(){window.HaxStore.write("activeNode",z,y),z.focus()},100)}else this.replaceElementWorkflow()},replaceElementWorkflow:function(){var x=window.HaxStore.nodeToHaxElement(this.activeNode,null),y="*",z=!1;"place-holder"===x.tag&&babelHelpers.typeof(x.properties.type)!=="undefined"&&(y=x.properties.type,z=!0);var A={};if(babelHelpers.typeof(window.HaxStore.instance.elementList[x.tag])!=="undefined"&&!1!==window.HaxStore.instance.elementList[x.tag].gizmo&&babelHelpers.typeof(window.HaxStore.instance.elementList[x.tag].gizmo.handles)!=="undefined"&&0<window.HaxStore.instance.elementList[x.tag].gizmo.handles.length)for(var B=window.HaxStore.instance.elementList[x.tag].gizmo,C=0;C<B.handles.length;C++)for(var D in B.handles[C])"type"!==D&&babelHelpers.typeof(x.properties[B.handles[C][D]])!=="undefined"&&(A[D]=x.properties[B.handles[C][D]]);var E=window.HaxStore.guessGizmo(y,A,z);if(0<E.length){var F=this.activeNode.tagName.toLowerCase(),G=F.replace("-"," ");babelHelpers.typeof(window.HaxStore.instance.elementList[F])!=="undefined"&&!1!==window.HaxStore.instance.elementList[F].gizmo&&(G=window.HaxStore.instance.elementList[F].gizmo.title),window.HaxStore.instance.haxAppPicker.presentOptions(E,"__convert","Transform ".concat(G," to.."),"gizmo")}else window.HaxStore.toast("Sorry, this can not be transformed!",5e3)},_globalPreferencesUpdated:function(x){babelHelpers.typeof(x)!=="undefined"&&null!=x&&(this.haxRayMode=x.haxRayMode)},_haxStorePropertyUpdated:function(x){x.detail&&babelHelpers.typeof(x.detail.value)!=="undefined"&&x.detail.property&&("object"===babelHelpers.typeof(x.detail.value)&&this.set(x.detail.property,null),this.set(x.detail.property,x.detail.value))},haxClearBody:function(){var x=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!0,y=!0;x&&(y=prompt("Are you sure you want to delete all content?")),y&&window.HaxStore.wipeSlot(this)},haxInsert:function(x,y){var z=this,A=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},B=window.HaxStore.instance.validTagList;if(B.includes(x)){var C=document.createElement(x);C.innerHTML=y;var D=C.cloneNode(!0);for(var E in A){var F=window.HaxStore.camelToDash(E);A.hasOwnProperty(E)&&(!0===A[E]?D.setAttribute(F,A[E]):!1===A[E]?D.removeAttribute(F):null==A[E]||A[E].constructor!==Array||D.properties[E].readOnly?null==A[E]||A[E].constructor!==Object||D.properties[E].readOnly?D.setAttribute(F,A[E]):D.set(F,A[E]):D.set(F,A[E]))}return null!==window.HaxStore.instance.activePlaceHolder&&babelHelpers.typeof(window.HaxStore.instance.activePlaceHolder.style)!=="undefined"?(D.style.width=window.HaxStore.instance.activePlaceHolder.style.width,D.style.float=window.HaxStore.instance.activePlaceHolder.style.float,D.style.margin=window.HaxStore.instance.activePlaceHolder.style.margin,D.style.display=window.HaxStore.instance.activePlaceHolder.style.display,this.haxReplaceNode(window.HaxStore.instance.activePlaceHolder,D,(0,c.dom)(window.HaxStore.instance.activePlaceHolder).parentNode),window.HaxStore.instance.activePlaceHolder=null):null===this.activeContainerNode?(0,c.dom)(this).appendChild(D):"GRID-PLATE"!==D.tagName&&"GRID-PLATE"===this.activeContainerNode.tagName&&this.activeContainerNode!==this.activeNode?(D.setAttribute("slot",this.activeNode.getAttribute("slot")),(0,c.dom)(this.activeContainerNode).insertBefore(D,this.activeNode)):(0,c.dom)(this).insertBefore(D,this.activeContainerNode.nextElementSibling),this.$.textcontextmenu.highlightOps=!1,setTimeout(function(){window.HaxStore.write("activeContainerNode",D,z),window.HaxStore.write("activeNode",D,z),D.focus(),"function"===typeof D.scrollIntoViewIfNeeded?D.scrollIntoViewIfNeeded(!0):D.scrollIntoView({behavior:"smooth",inline:"center"})},100),!0}return!1},haxToContent:function(){this.hideContextMenus();var x=this.activeNode;window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this);var y=(0,c.dom)(this.$.body).getDistributedNodes();this.globalPreferences.haxDeveloperMode&&console.log(y);for(var z="",A=0,B=y.length;A<B;A++)this._haxElementTest(y[A])?(y[A].removeAttribute("data-editable"),y[A].removeAttribute("data-hax-ray"),y[A].contentEditable=!1,z+=window.HaxStore.haxNodeToContent(y[A]),"grid-plate"===y[A].tagName.toLowerCase()&&this._applyContentEditable(this.editMode,y[A])):8===y[A].nodeType?z+="<!-- "+y[A].textContent+" -->":1!==y[A].nodeType&&babelHelpers.typeof(y[A].textContent)!=="undefined"&&"undefined"!==y[A].textContent&&(z+=y[A].textContent);if(z=z.replace(/\scontenteditable=\"false\"/g,""),z=z.replace(/\sdata-editable=\"true\"/g,""),z=z.replace(/\sdata-editable=\"false\"/g,""),z=z.replace(/\sdata-editable=\""/g,""),z=z.replace(/\sdata-editable/g,""),z=z.replace(/\scontenteditable/g,""),z=z.replace(/\sdraggable/g,""),z=z.replace(/\sdata-draggable/g,""),z=z.replace(/\sdata-hax-ray=\".*?\"/g,""),this.parentNode.tagName){var C=this.parentNode.tagName.toLowerCase(),D="style-scope "+C+" x-scope",E=new RegExp(D,"g");z=z.replace(E,""),D="style-scope "+C,E=new RegExp(D,"g"),z=z.replace(E,""),D="x-scope "+C+"-0",E=new RegExp(D,"g"),z=z.replace(E,"");var F=window.HaxStore.instance.validTagList;for(var A in F.push("hax-preview"),F)D="style-scope "+F[A],E=new RegExp(D,"g"),z=z.replace(E,""),D="x-scope "+F[A]+"-0 ",E=new RegExp(D,"g"),z=z.replace(E,""),D="x-scope "+F[A]+"-0",E=new RegExp(D,"g"),z=z.replace(E,"")}return z=z.replace(/\sclass=\"\"/g,""),z=z.replace(/\sclass=\"\s\"/g,""),this._applyContentEditable(this.editMode),window.HaxStore.write("activeNode",x,this),window.HaxStore.write("activeContainerNode",x,this),z=window.HaxStore.encapScript(z),this.globalPreferences.haxDeveloperMode&&console.log(z),z},haxDuplicateNode:function(x){var y=this,z=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this;this.hideContextMenus();var A=(0,c.dom)(x).cloneNode(!0);return"webview"===A.tagName.toLowerCase()&&window.HaxStore.instance._isSandboxed&&babelHelpers.typeof(A.guestinstance)!=="undefined"&&delete A.guestinstance,null===x?(0,c.dom)(z).appendChild(A):(0,c.dom)(z).insertBefore(A,(0,c.dom)(x).nextSibling),setTimeout(function(){z===y&&window.HaxStore.write("activeContainerNode",A,y),window.HaxStore.write("activeNode",A,y)},100),!0},hideContextMenus:function(){this._hideContextMenu(this.$.textcontextmenu),this._hideContextMenu(this.$.cecontextmenu),this._hideContextMenu(this.$.platecontextmenu),this._hideContextMenu(this.$.haxinputmixer),this.$.textcontextmenu.highlightOps=!1},positionContextMenus:function(x,y){var z=x.tagName.toLowerCase();window.HaxStore.instance._isSandboxed&&"webview"===z&&(z="iframe");var A=window.HaxStore.instance.elementList[z],B=Math.max(document.documentElement.clientWidth,window.innerWidth||0),C=-39,D=-31;800>B&&(C=0,D=0),babelHelpers.typeof(A)!=="undefined"&&"P"!==x.tagName?(this.__activeContextType=this.$.cecontextmenu,A.element=x,this.__activeContextType.setHaxProperties(A)):this.__activeContextType=this.$.textcontextmenu,this._positionContextMenu(this.__activeContextType,y,C,-37),this._positionContextMenu(this.$.platecontextmenu,y,D,0,!1),this._HTMLPrimativeTest(x)||x===y?this._HTMLPrimativeTest(y)&&(y.contentEditable=!0):y.contentEditable=!1},haxMoveGridPlate:function(x,y,z){return this.hideContextMenus(),"first"===x?null!==z.previousElementSibling&&(0,c.dom)(this).insertBefore(z,(0,c.dom)(this).firstChild):"up"===x?null!==z.previousElementSibling&&(0,c.dom)(this).insertBefore(z,z.previousElementSibling):"down"===x?null!==z.nextElementSibling&&(0,c.dom)(this).insertBefore(z.nextElementSibling,z):"last"===x?null!==z.nextElementSibling&&(0,c.dom)(this).appendChild(z):void 0,(this.positionContextMenus(y,z),setTimeout(function(){"function"===typeof z.scrollIntoViewIfNeeded?z.scrollIntoViewIfNeeded(!0):z.scrollIntoView({behavior:"smooth",inline:"center"})},250),!0)},haxReplaceNode:function(x,y){var z=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this;this.hideContextMenus();try{null!=x.getAttribute("slot")&&y.setAttribute("slot",x.getAttribute("slot")),(0,c.dom)(z).replaceChild(y,x)}catch(A){console.log(A)}return y},haxChangeTagName:function(x,y){this.hideContextMenus();for(var A=document.createElement(y),B=0,C=x.attributes.length;B<C;++B){var D=x.attributes.item(B).nodeName,E=x.attributes.item(B).value;A.setAttribute(D,E)}return A.innerHTML=x.innerHTML,(0,c.dom)(this).replaceChild(A,x),A},haxDeleteNode:function(x){var y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this;if(this.hideContextMenus(),null==this.activeContainerNode||null===this.activeContainerNode.previousElementSibling)null!=this.activeContainerNode&&null!==this.activeContainerNode.nextElementSibling?this.activeContainerNode.nextElementSibling.focus():(window.HaxStore.write("activeContainerNode",null,this),window.HaxStore.write("activeNode",null,this));else if(this.activeContainerNode.previousElementSibling.focus(),null!=this.activeContainerNode&&window.HaxStore.instance.isTextElement(this.activeContainerNode)&&""!==(0,c.dom)(this.activeContainerNode).textContent)try{var z=document.createRange(),A=window.getSelection();z.setStart(this.activeContainerNode,1),z.collapse(!0),A.removeAllRanges(),A.addRange(z),this.activeContainerNode.focus()}catch(B){console.log(B)}try{return(0,c.dom)(y).removeChild(x)}catch(B){console.log(B)}},importContent:function(x){var y=this,z=1<arguments.length&&void 0!==arguments[1]?arguments[1]:!0;z&&window.HaxStore.wipeSlot(this,"*"),setTimeout(function(){x=window.HaxStore.encapScript(x);var A=window.HaxStore.instance.validTagList,B=document.createElement("div");for(B.insertAdjacentHTML("beforeend",x);null!==B.firstChild;)if(!(babelHelpers.typeof(B.firstChild.tagName)!=="undefined"&&A.includes(B.firstChild.tagName.toLowerCase())))B.removeChild(B.firstChild);else if(window.HaxStore.instance._isSandboxed&&"iframe"===B.firstChild.tagName.toLowerCase()){for(var C=document.createElement("webview"),D=0,E=B.firstChild.attributes.length;D<E;++D){var F=B.firstChild.attributes.item(D).nodeName,G=B.firstChild.attributes.item(D).value;"height"!==F&&"width"!==F||C.style[F]!=G,C.setAttribute(F,G)}(0,c.dom)(y).appendChild(C)}else(0,c.dom)(y).appendChild(B.firstChild)},200)},_haxContextOperation:function(x){var A,y=this,z=x.detail;switch(z.eventName){case"p":case"h2":case"h3":case"h4":case"h5":case"h6":case"code":case"blockquote":this.$.textcontextmenu.selectedValue=z.eventName,window.HaxStore.write("activeContainerNode",this.haxChangeTagName(this.activeContainerNode,z.eventName),this);break;case"text-align-left":this.activeNode.style.textAlign=null,this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"text-align-right":this.activeNode.style.textAlign="right",this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"grid-plate-convert":this.replaceElementWorkflow();break;case"grid-plate-duplicate":this.activeNode===this.activeContainerNode?this.haxDuplicateNode(this.activeNode):this.haxDuplicateNode(this.activeNode,this.activeContainerNode);break;case"grid-plate-delete":var C=this.activeNode.tagName.toLowerCase(),D=C.replace("-"," ");babelHelpers.typeof(window.HaxStore.instance.elementList[C])!=="undefined"&&!1!==window.HaxStore.instance.elementList[C].gizmo&&(D=window.HaxStore.instance.elementList[C].gizmo.title),window.HaxStore.instance.haxAppPicker.presentOptions([{icon:"thumb-up",color:"green",title:"Yes"},{icon:"thumb-down",color:"red",title:"No"}],"","Remove this `".concat(D,"`?"),"delete");break;case"grid-plate-first":this.haxMoveGridPlate("first",this.activeNode,this.activeContainerNode);break;case"grid-plate-up":this.haxMoveGridPlate("up",this.activeNode,this.activeContainerNode);break;case"hax-manager-open":window.HaxStore.write("activeHaxElement",{},this),window.HaxStore.instance.haxManager.resetManager(parseInt(z.value)),window.HaxStore.instance.haxManager.toggleDialog();break;case"grid-plate-down":this.haxMoveGridPlate("down",this.activeNode,this.activeContainerNode);break;case"grid-plate-last":this.haxMoveGridPlate("last",this.activeNode,this.activeContainerNode);break;case"close-menu":window.HaxStore.write("activeContainerNode",null,this),window.HaxStore.write("activeNode",null,this);break;case"hax-edit-property":var E=this.$.haxinputmixer;E.label=z.target.label,E.options=z.target.options,E.icon=z.target.icon,E.description=z.target.description,E.required=z.target.required,E.validation=z.target.validation,E.validationType=z.target.validationType,E.inputMethod=z.target.inputMethod,E.value="",babelHelpers.typeof(z.target.propertyToBind)!=="undefined"&&null!=z.target.propertyToBind&&!1!=z.target.propertyToBind&&(E.propertyToBind=z.target.propertyToBind,E.value=babelHelpers.typeof(this.activeNode[z.target.propertyToBind])==="undefined"?this.activeNode.getAttribute(z.target.propertyToBind):this.activeNode[z.target.propertyToBind]),this._positionContextMenu(E,this.$.cecontextmenu,-6,-116),E.style.width=null;break;case"hax-align-left":this.activeNode.style.float=null,this.activeNode.style.margin=null,this.activeNode.style.display=null,this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"hax-align-center":this.activeNode.style.float=null,this.activeNode.style.margin="0 auto",this.activeNode.style.display="block",this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"hax-align-right":this.activeNode.style.float="right",this.activeNode.style.margin=null,this.activeNode.style.display=null,this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"hax-size-change":this.activeNode.style.width=z.value+"%",setTimeout(function(){y.positionContextMenus(y.activeNode,y.activeContainerNode)},1e3);break;case"hax-manager-configure":this._hideContextMenu(this.$.haxinputmixer),window.HaxStore.instance.haxManager.resetManager(),A=window.HaxStore.nodeToHaxElement(window.HaxStore.instance.activeNode),window.HaxStore.write("activeHaxElement",A,this),window.HaxStore.instance.haxManager.editExistingNode=!0,window.HaxStore.instance.haxManager.selectStep("configure"),window.HaxStore.instance.haxManager.toggleDialog(),setTimeout(function(){window.HaxStore.instance.haxManager.$.preview.$.configurebutton.focus()},100);break;case"hax-manager-configure-container":window.HaxStore.write("activeNode",window.HaxStore.instance.activeContainerNode,this),this._hideContextMenu(this.$.haxinputmixer),window.HaxStore.instance.haxManager.resetManager(),A=window.HaxStore.nodeToHaxElement(window.HaxStore.instance.activeNode),window.HaxStore.write("activeHaxElement",A,this),window.HaxStore.instance.haxManager.editExistingNode=!0,window.HaxStore.instance.haxManager.selectStep("configure"),window.HaxStore.instance.haxManager.toggleDialog(),setTimeout(function(){window.HaxStore.instance.haxManager.$.preview.$.configurebutton.focus()},100);}},_haxInputMixerOperation:function(x){var y=x.detail.inputMixer;null==y.propertyToBind?null!=y.slotToBind&&(item=document.createElement("span"),item.style.height="inherit",item.innerHTML=y.value,item.slot=y.slotToBind,this.activeNode.appendChild(item)):this.activeNode[y.propertyToBind]=y.value,this._hideContextMenu(this.$.haxinputmixer)},_focusIn:function(x){var y=this;if(this.editMode&&!this.__tabTrap){var z=(0,c.dom)(x),A=z.localTarget,B=window.HaxStore.instance.validTagList,C=A,D=null;if(this._haxElementTest(C)&&null!=C.parentNode){for(;"HAX-BODY"!=C.parentNode.tagName;)null===D&&B.includes(C.tagName.toLowerCase())&&"LI"!==C.tagName&&"B"!==C.tagName&&"I"!==C.tagName&&"STRONG"!==C.tagName&&"EM"!==C.tagName&&(D=C),C=C.parentNode;null===D?D=C:window.HaxStore.instance.isGridPlateElement(C)?["UL","OL","LI","P","GRID-PLATE"].includes(C.tagName)&&["UL","OL","LI"].includes(D.tagName)&&(D=C):D=C,this.activeContainerNode!==C&&B.includes(C.tagName.toLowerCase())&&!C.classList.contains("ignore-activation")?(window.HaxStore.write("activeContainerNode",C,this),x.stopPropagation()):C.classList.contains("ignore-activation")&&x.stopPropagation(),this.activeNode!==D&&B.includes(C.tagName.toLowerCase())&&!D.classList.contains("ignore-activation")&&(setTimeout(function(){window.HaxStore.write("activeNode",D,y)},50),x.stopPropagation())}}else this.__tabTrap=!1},_editModeChanged:function(x,y){babelHelpers.typeof(y)!=="undefined"&&(this._applyContentEditable(x),!1!==x&&babelHelpers.typeof(this.activeNode)!=="undefined"&&null!==this.activeNode&&this.positionContextMenus(this.activeNode,this.activeContainerNode)),!1===x&&this.hideContextMenus()},_haxResolvePreviousElement:function(x){for(x=(0,c.dom)(x).previousElementSibling;babelHelpers.typeof(x.tagName)!=="undefined"&&"HAX-"===x.tagName.substring(0,4);)x=(0,c.dom)(x).previousElementSibling;return x},_haxElementTest:function(x){return babelHelpers.typeof(x.tagName)!=="undefined"&&"HAX-"!==x.tagName.substring(0,4)},_HTMLPrimativeTest:function(x){return babelHelpers.typeof(x.tagName)!=="undefined"&&-1==x.tagName.indexOf("-")},_applyContentEditable:function(x){var y=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.$.body,z=(0,c.dom)(y).getDistributedNodes();0===z.length&&(z=(0,c.dom)(y).getEffectiveChildNodes());for(var A=0,B=z.length;A<B;A++)this._HTMLPrimativeTest(z[A])&&(z[A].contentEditable=x),this._haxElementTest(z[A])&&(x?(z[A].setAttribute("data-editable",x),z[A].setAttribute("data-hax-ray",z[A].tagName)):(z[A].removeAttribute("data-editable"),z[A].removeAttribute("data-hax-ray")))},_activeContainerNodeChanged:function(x){if(this.editMode&&babelHelpers.typeof(x)!=="undefined"&&null!==x){var z=x.tagName.toLowerCase();"grid-plate"===z&&(x.editMode=this.editMode,this._applyContentEditable(this.editMode,x))}},_activeNodeChanged:function(x,y){var z=this;if(babelHelpers.typeof(y)!=="undefined"&&null!=y&&y.classList.remove("hax-active"),this.editMode&&babelHelpers.typeof(x)!=="undefined"&&null!==x){var A=x.tagName.toLowerCase();x.classList.add("hax-active"),this.$.textcontextmenu.selectedValue=A,setTimeout(function(){z.positionContextMenus(x,window.HaxStore.instance.activeContainerNode)},25),"right"==x.style.textAlign?(this.$.textcontextmenu.justifyIcon="editor:format-align-right",this.$.textcontextmenu.justifyValue="text-align-right"):"left"==x.style.textAlign?(this.$.textcontextmenu.justifyIcon="editor:format-align-left",this.$.textcontextmenu.justifyValue="text-align-left"):"left"==x.style.float?(this.$.cecontextmenu.justifyIcon="editor:format-align-left",this.$.cecontextmenu.justifyValue="hax-align-left"):"right"==x.style.float?(this.$.cecontextmenu.justifyIcon="editor:format-align-right",this.$.cecontextmenu.justifyValue="hax-align-right"):"0 auto"==x.style.margin&&(this.$.cecontextmenu.justifyIcon="editor:format-align-center",this.$.cecontextmenu.justifyValue="hax-align-center")}else null===x&&(this.hideContextMenus(),this.$.textcontextmenu.justifyIcon="editor:format-align-left",this.$.textcontextmenu.justifyValue="text-align-left")},_positionContextMenu:function(x,y,z,A){var B=4<arguments.length&&void 0!==arguments[4]?arguments[4]:!0;try{(0,c.dom)(this).insertBefore(x,y)}catch(D){try{(0,c.dom)(y.parentNode).insertBefore(x,y)}catch(E){}}B&&(x.style.width=y.style.width);var C=y.currentStyle||window.getComputedStyle(y);0==parseInt(C.marginLeft)?z=z+parseInt(y.offsetLeft)-this.offsetLeft:z+=parseInt(C.marginLeft),null!=z&&(x.style["margin-left"]=z+"px"),null!=A&&(x.style["margin-top"]=A+"px"),x.classList.add("hax-context-visible"),g.microTask.run(this._keepContextVisible())},_hideContextMenu:function(x){x.classList.remove("hax-context-visible"),x.classList.remove("hax-context-pin-top"),x.classList.remove("hax-context-pin-bottom"),(0,c.dom)(this.$.contextcontainer).appendChild(x)},_escKeyPressed:function(x){this.editMode&&(x.preventDefault(),x.stopPropagation(),this.$.textcontextmenu.highlightOps?(this.$.textcontextmenu.highlightOps=!1,window.HaxStore.write("activeNode",this.activeContainerNode,this),this.activeContainerNode.focus()):this.activeNode===this.activeContainerNode?(window.HaxStore.write("activeContainerNode",null,this),window.HaxStore.write("activeNode",null,this),document.body.focus()):(window.HaxStore.write("activeNode",this.activeContainerNode,this),this.activeContainerNode.focus()))},_delKeyPressed:function(x){var y=this;if(this.editMode){var z=(0,c.dom)(this.activeContainerNode).textContent;if(""===z)x.preventDefault(),x.stopPropagation(),this.haxDeleteNode(this.activeContainerNode);else if(window.HaxStore.instance.isTextElement(this._haxResolvePreviousElement(this.activeContainerNode))){var A=window.getSelection(),B=A.getRangeAt(0).cloneRange(),C=B.commonAncestorContainer.tagName;if(babelHelpers.typeof(C)==="undefined"&&(C=B.commonAncestorContainer.parentNode.tagName),0===B.startOffset&&0===B.endOffset&&!["UL","OL","LI"].includes(C)){for(x.preventDefault(),x.stopPropagation();this.activeContainerNode.firstChild;)this._haxResolvePreviousElement(this.activeContainerNode).appendChild(this.activeContainerNode.firstChild);setTimeout(function(){y.haxDeleteNode(y.activeContainerNode)},100)}}}},_upKeyPressed:function(){if(this.editMode&&""===(0,c.dom)(this.activeContainerNode).textContent){var y=this._haxResolvePreviousElement(this.activeContainerNode);try{y.focus()}catch(z){}}},_downKeyPressed:function(){if(this.editMode&&""===(0,c.dom)(this.activeContainerNode).textContent){var y=(0,c.dom)(this.activeContainerNode);try{y.nextElementSibling.focus()}catch(z){}}},_tabKeyPressed:function(x){if(this.editMode){x.preventDefault(),x.stopPropagation(),x.stopImmediatePropagation();var y=!1,z=this.activeContainerNode,A=this.activeContainerNode.tagName;try{var B=window.getSelection(),C=B.getRangeAt(0).cloneRange(),D=C.commonAncestorContainer.tagName;if(babelHelpers.typeof(D)==="undefined"&&(D=C.commonAncestorContainer.parentNode.tagName),["UL","OL","LI"].includes(A)||["UL","OL","LI"].includes(D))this.polyfillSafe&&(document.execCommand("indent"),this.__tabTrap=!0);else for(;!y;)null==(0,c.dom)(z).nextSibling?y=!0:"function"===(0,c.dom)(z).nextSibling.focus?((0,c.dom)(z).nextSibling.focus(),y=!0):z=(0,c.dom)(z).nextSibling}catch(E){}}},_tabBackKeyPressed:function(x){if(this.editMode){x.preventDefault(),x.stopPropagation(),x.stopImmediatePropagation();var y=(0,c.dom)(this.activeContainerNode).previousSibling,z=this.activeContainerNode.tagName,A=window.getSelection();try{var B=A.getRangeAt(0).cloneRange();if(["UL","OL","LI"].includes(z)||["UL","OL","LI"].includes(B.commonAncestorContainer.parentElement.tagName))this.polyfillSafe&&(document.execCommand("outdent"),this.__tabTrap=!0);else{if(null!=y)for(;null!=y&&!this._haxElementTest(y);)y=(0,c.dom)(y).previousSibling;null!=y&&setTimeout(function(){y.focus()},100)}}catch(C){}}}});a.HaxBody=u});