import{html,Polymer}from"@polymer/polymer/polymer-legacy.js";import{dom}from"@polymer/polymer/lib/legacy/polymer.dom.js";import"@polymer/paper-toast/paper-toast.js";import"@lrnwebcomponents/media-behaviors/media-behaviors.js";import"@lrnwebcomponents/hax-body-behaviors/hax-body-behaviors.js";import"@polymer/iron-ajax/iron-ajax.js";import"./hax-app.js";import"./hax-stax.js";import"./hax-stax-browser.js";import"./hax-blox.js";import"./hax-blox-browser.js";window.HaxStore={},window.HaxStore.instance=null,window.HaxStore.requestAvailability=function(){window.HaxStore.instance||(window.HaxStore.instance=document.createElement("hax-store")),document.body.appendChild(window.HaxStore.instance)},Polymer({_template:html`
    <style>
      :host {
        display: none;
      }
    </style>
    <slot></slot>
    <iron-ajax
      id="appstore"
      url="[[appStore.url]]"
      params="[[appStore.params]]"
      method="GET"
      content-type="application/json"
      handle-as="json"
      last-response="{{__appStoreData}}"
    ></iron-ajax>
  `,is:"hax-store",behaviors:[MediaBehaviors.Video,HAXBehaviors.PropertiesBehaviors],observers:["_loadAppStoreData(__appStoreData, haxAutoloader)"],properties:{haxAppPicker:{type:Object},haxStaxPicker:{type:Object},haxManager:{type:Object},haxAutoloader:{type:Object},haxBodies:{type:Array,value:[]},activePlaceHolder:{type:Object,value:null},activeHaxBody:{type:Object},appStore:{type:Object,observer:"_appStoreChanged"},haxToast:{type:Object},haxPanel:{type:Object},haxExport:{type:Object},haxPreferences:{type:Object},activeHaxElement:{type:Object},activeNode:{type:Object},activeContainerNode:{type:Object},editMode:{type:Boolean,value:!1},canSupportUploads:{type:Boolean,value:!1},skipExitTrap:{type:Boolean,value:!1},defaults:{type:Object,value:{image:{src:"stock.jpg",alt:"A beachfront deep in the heart of Alaska."},iframe:{src:"https://www.wikipedia.org/"}}},gizmoList:{type:Array,value:[]},elementList:{type:Object,value:{}},appList:{type:Array,value:[]},staxList:{type:Array,value:[]},bloxList:{type:Array,value:[]},globalPreferences:{type:Object,value:{}},activeApp:{type:Object,value:{}},validTagList:{type:Array,value:["p","div","ol","ul","li","a","strong","kbd","em","i","b","hr","h1","h2","h3","h4","h5","h6","blockquote","code","figure","img","iframe","video","audio","section","grid-plate","template","webview"]},validGizmoTypes:{type:Array,value:["data","video","audio","text","link","file","pdf","image","csv","doc","content","text","inline","*"]},_isSandboxed:{type:Boolean,value:function(){let a=document.createElement("webview");return!("function"!==typeof a.reload)}},__appStoreData:{type:Object}},isTextElement:function(a){return null!=a&&this.validTagList.includes(a.tagName.toLowerCase())&&["p","ol","ul","li","a","h1","h2","h3","h4","h5","h6","blockquote","code","figure"].includes(a.tagName.toLowerCase())},isGridPlateElement:function(a){let b=a.tagName.toLowerCase();return this.validTagList.includes(b)&&["p","ol","ul","li","h1","h2","h3","h4","h5","h6","blockquote","code","figure","grid-plate"].includes(b)},_appStoreChanged:function(a){typeof a!==typeof void 0&&(typeof a.apps===typeof void 0?this.$.appstore.generateRequest():this.__appStoreData=a)},_loadAppStoreData:function(a,b){if(typeof a!==typeof void 0&&null!=a){if(typeof a.autoloader!==typeof void 0)for(var c=0;c<a.autoloader.length;c++){let k=document.createElement(a.autoloader[c]);dom(b).appendChild(k)}if(typeof a.apps!=="undefined")for(var d=a.apps,c=0;c<d.length;c++){let k=document.createElement("hax-app");k.data=d[c],"undefined"!==typeof d[c].connection.operations.add&&async.microTask.run(()=>{window.HaxStore.write("canSupportUploads",!0,this)}),window.HaxStore.instance.appendChild(k)}if("undefined"!==typeof a.stax)for(var f=a.stax,c=0;c<f.length;c++){let k=document.createElement("hax-stax");k.data=f[c],window.HaxStore.instance.appendChild(k)}if("undefined"!==typeof a.blox)for(var h=a.blox,c=0;c<h.length;c++){let k=document.createElement("hax-blox");k.data=h[c],window.HaxStore.instance.appendChild(k)}}},detached:function(){document.body.removeEventListener("hax-register-properties",this._haxStoreRegisterProperties.bind(this)),document.body.removeEventListener("hax-register-app",this._haxStoreRegisterApp.bind(this)),document.body.removeEventListener("hax-register-stax",this._haxStoreRegisterStax.bind(this)),document.body.removeEventListener("hax-register-blox",this._haxStoreRegisterBlox.bind(this)),document.body.removeEventListener("hax-store-write",this._writeHaxStore.bind(this)),document.body.removeEventListener("hax-register-manager",this._haxStoreRegisterManager.bind(this)),document.body.removeEventListener("hax-register-autoloader",this._haxStoreRegisterAutoloader.bind(this)),document.body.removeEventListener("hax-register-body",this._haxStoreRegisterBody.bind(this)),document.body.removeEventListener("hax-register-panel",this._haxStoreRegisterPanel.bind(this)),document.body.removeEventListener("hax-register-app-picker",this._haxStoreRegisterAppPicker.bind(this)),document.body.removeEventListener("hax-register-stax-picker",this._haxStoreRegisterStaxPicker.bind(this)),document.body.removeEventListener("hax-register-blox-picker",this._haxStoreRegisterBloxPicker.bind(this)),document.body.removeEventListener("hax-register-preferences",this._haxStoreRegisterPreferences.bind(this)),document.body.removeEventListener("hax-register-export",this._haxStoreRegisterExport.bind(this)),document.body.removeEventListener("hax-insert-content",this._haxStoreInsertContent.bind(this))},attached:function(){window.onbeforeunload=function(){if(!window.HaxStore.instance.skipExitTrap&&window.HaxStore.instance.editMode)return"Are you sure you want to leave? Your work will not be saved!"},window.addEventListener("paste",a=>{if(this.isTextElement(window.HaxStore.instance.activeNode)&&!this.haxManager.opened){a.preventDefault();let b="";a.clipboardData||a.originalEvent.clipboardData?b=(a.originalEvent||a).clipboardData.getData("text/plain"):window.clipboardData&&(b=window.clipboardData.getData("Text"));let c,d;window.getSelection?(c=window.getSelection(),c.getRangeAt&&c.rangeCount&&(d=c.getRangeAt(0),d.deleteContents(),d.insertNode(document.createTextNode(b)))):document.selection&&document.selection.createRange&&(document.selection.createRange().text=b)}}),window.addEventListener("keypress",a=>{const b=a.key;if(typeof window.HaxStore.instance.activeContainerNode!=="undefined"&&"Enter"===b&&window.HaxStore.instance.editMode&&null!==window.HaxStore.instance.activeNode&&window.HaxStore.instance.activeContainerNode===window.HaxStore.instance.activeNode&&!window.HaxStore.instance.haxAppPicker.opened){const k=window.HaxStore.instance.activeContainerNode.tagName;var c=window.getSelection();const m=c.getRangeAt(0).cloneRange();var d=m.commonAncestorContainer.tagName;if(typeof d==="undefined"&&(d=m.commonAncestorContainer.parentNode.tagName),["P","H1","H2","H3","H4","H5","H6"].includes(k)&&!["UL","OL","LI"].includes(d))if(m.endOffset!==this.activeContainerNode.textContent.length){a.preventDefault(),m.setStart(c.focusNode,m.startOffset);var f=document.createRange().createContextualFragment("<hax-split-point></hax-split-point>");m.insertNode(f);const n=window.HaxStore.instance.activeContainerNode;var h=dom(window.HaxStore.instance.activeContainerNode).querySelector("hax-split-point");if(null!=h)try{this.__splitNode(h,n)}catch(o){}}else a.preventDefault(),window.HaxStore.instance.fire("hax-insert-content",{tag:"p",content:""})}}),this._injectToast(),this._buildPrimitiveDefinitions(),this.fire("hax-store-ready",!0),window.HaxStore.ready=!0},__splitNode:function(a,b){window.HaxStore.write("activeNode",null,this),setTimeout(()=>{var c=b.parentNode,d=this.__getNodeIndex(c,b),f=a.ownerDocument,h=f.createRange();h.setStart(c,d),h.setEndBefore(a);var k=h.extractContents();dom(this.activeHaxBody).insertBefore(k,b),a.parentNode.removeChild(a),window.HaxStore.write("activeNode",b,this)},100)},__getNodeIndex:function(a,b){for(var c=a.childNodes.length;c--&&!(b===a.childNodes[c]););return c},created:function(){window.__startedSelection=!1,null==window.HaxStore.instance&&(window.HaxStore.instance=this),document.body.addEventListener("hax-register-properties",this._haxStoreRegisterProperties.bind(this)),document.body.addEventListener("hax-register-app",this._haxStoreRegisterApp.bind(this)),document.body.addEventListener("hax-register-stax",this._haxStoreRegisterStax.bind(this)),document.body.addEventListener("hax-register-blox",this._haxStoreRegisterBlox.bind(this)),document.body.addEventListener("hax-store-write",this._writeHaxStore.bind(this)),document.body.addEventListener("hax-register-manager",this._haxStoreRegisterManager.bind(this)),document.body.addEventListener("hax-register-autoloader",this._haxStoreRegisterAutoloader.bind(this)),document.body.addEventListener("hax-register-body",this._haxStoreRegisterBody.bind(this)),document.body.addEventListener("hax-register-panel",this._haxStoreRegisterPanel.bind(this)),document.body.addEventListener("hax-register-app-picker",this._haxStoreRegisterAppPicker.bind(this)),document.body.addEventListener("hax-register-stax-picker",this._haxStoreRegisterStaxPicker.bind(this)),document.body.addEventListener("hax-register-blox-picker",this._haxStoreRegisterBloxPicker.bind(this)),document.body.addEventListener("hax-register-preferences",this._haxStoreRegisterPreferences.bind(this)),document.body.addEventListener("hax-register-export",this._haxStoreRegisterExport.bind(this)),document.body.addEventListener("hax-insert-content",this._haxStoreInsertContent.bind(this)),document.body.style.setProperty("--hax-ui-headings","#d4ff77")},_buildPrimitiveDefinitions:function(){if(window.HaxStore.instance._isSandboxed){this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!1,settings:{quick:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],advanced:[]}},"webview")}this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!0,gizmo:{title:"Basic iframe",description:"A basic iframe",icon:"icons:fullscreen",color:"grey",groups:["Content"],handles:[{type:"link",source:"src",height:"height",width:"width"}],meta:{author:"W3C"}},settings:{quick:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"}],advanced:[]}},"iframe");this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!1,gizmo:{title:"Basic image",description:"A basic img tag",icon:"image:image",color:"grey",groups:["Image","Media"],handles:[{type:"link",source:"src"},{type:"image",source:"src",height:"height",width:"width"}],meta:{author:"W3C"}},settings:{quick:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"},{attribute:"alt",title:"Alt text",description:"Useful for screen readers and improved SEO.",inputMethod:"alt",icon:"accessibility"},{attribute:"height",title:"Height",description:"height in pixels of the item",inputMethod:"textfield",icon:"icons:swap-vert"},{attribute:"width",title:"Width",description:"width in pixels of the item",inputMethod:"textfield",icon:"icons:swap-horiz"}],configure:[{attribute:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"},{attribute:"alt",title:"Alt text",description:"Useful for screen readers and improved SEO.",inputMethod:"alt",icon:"accessibility"},{attribute:"height",title:"Height",description:"height in pixels of the item",inputMethod:"textfield",icon:"icons:swap-vert"},{attribute:"width",title:"Width",description:"width in pixels of the item",inputMethod:"textfield",icon:"icons:swap-horiz"}],advanced:[]}},"img");this.setHaxProperties({canScale:!1,canPosition:!1,canEditSource:!1,gizmo:{title:"Basic link",description:"A basic a tag",icon:"icons:link",color:"grey",groups:["Link"],handles:[{type:"link",source:"href",title:"innerText",alt:"title"}],meta:{author:"W3C"}},settings:{quick:[{attribute:"href",title:"Link",description:"The URL for this video.",inputMethod:"textfield",icon:"icons:link",required:!0,validationType:"url"},{attribute:"title",title:"Title text",description:"Useful for screen readers and improved SEO.",inputMethod:"textfield",icon:"icons:accessibility"}],configure:[{attribute:"innerText",title:"Text",description:"Text of the link",inputMethod:"textfield",required:!0},{attribute:"href",title:"Link",description:"The URL for this video.",inputMethod:"textfield",icon:"icons:link",required:!0,validationType:"url"},{attribute:"title",title:"Title text",description:"Useful for screen readers and improved SEO.",inputMethod:"textfield",icon:"icons:accessibility"},{attribute:"target",title:"Target",description:"Where to place the link.",inputMethod:"select",icon:"icons:launch",options:{"":"Same window",_blank:"New window",_top:"Top window",_parent:"Parent window"}}],advanced:[]}},"a");this.setHaxProperties({canScale:!1,canPosition:!1,canEditSource:!0,settings:{quick:[],configure:[],advanced:[]}},"p");this.setHaxProperties({canScale:!0,canPosition:!1,canEditSource:!1,settings:{quick:[],configure:[],advanced:[]}},"hr")},_injectToast:function(){var a=document.createElement("paper-toast");a.id="haxtoast",a.duration=3e3,document.body.appendChild(a),this.haxToast=a},_haxStoreRegisterManager:function(a){a.detail&&typeof this.haxManager===typeof void 0&&(this.haxManager=a.detail)},_haxStoreRegisterAutoloader:function(a){a.detail&&typeof this.haxAutoloader===typeof void 0&&(this.haxAutoloader=a.detail)},_haxStoreRegisterAppPicker:function(a){a.detail&&typeof this.haxAppPicker===typeof void 0&&(this.haxAppPicker=a.detail)},_haxStoreRegisterStaxPicker:function(a){a.detail&&typeof this.haxStaxPicker===typeof void 0&&(this.haxStaxPicker=a.detail)},_haxStoreRegisterBloxPicker:function(a){a.detail&&typeof this.haxBloxPicker===typeof void 0&&(this.haxBloxPicker=a.detail)},closeAllDrawers:function(a=!1){let b=["haxManager","haxBloxPicker","haxStaxPicker","haxPreferences","haxExport"];for(var c in b)a===this[b[c]]?(a.open(),"haxManager"===b[c]?setTimeout(()=>{null!=a.querySelector("#activepage .iron-selected paper-input")&&a.querySelector("#activepage .iron-selected paper-input").focus()},200):setTimeout(()=>{null!=a.querySelector("paper-checkbox,paper-input,textarea,paper-button")&&a.querySelector("paper-checkbox,paper-input,textarea,paper-button").focus()},100)):this[b[c]].close()},_haxStoreInsertContent:function(a){if(a.detail){var b={};if(typeof a.detail.properties!=="undefined"&&(b=a.detail.properties),a.detail.replace&&a.detail.replacement){let c=window.HaxStore.haxElementToNode(a.detail.tag,a.detail.content,b);this.activeNode===this.activeContainerNode?this.activeHaxBody.haxReplaceNode(this.activeNode,c):this.activeHaxBody.haxReplaceNode(this.activeNode,c,this.activeContainerNode)}else if(typeof a.detail.__type!=="undefined"&&"inline"===a.detail.__type){let c=window.HaxStore.haxElementToNode(a.detail.tag,a.detail.content,b);null!==this.activePlaceHolder&&(this.activePlaceHolder.deleteContents(),this.activePlaceHolder.insertNode(c)),this.activePlaceHolder=null}else this.activeHaxBody.haxInsert(a.detail.tag,a.detail.content,b)}},_haxStoreRegisterBody:function(a){a.detail&&(this.haxBodies.push(a.detail),this.activeHaxBody=a.detail,window.HaxStore.write("activeHaxBody",this.activeHaxBody,this),window.HaxStore.write("editMode",this.editMode,this))},_haxStoreRegisterPanel:function(a){a.detail&&typeof this.haxPanel===typeof void 0&&(this.haxPanel=a.detail)},_haxStoreRegisterExport:function(a){a.detail&&typeof this.haxExport===typeof void 0&&(this.haxExport=a.detail)},_haxStoreRegisterPreferences:function(a){a.detail&&typeof this.haxPreferences===typeof void 0&&(this.haxPreferences=a.detail)},computePolyfillSafe:function(){return document.head.createShadowRoot||document.head.attachShadow||(console.log("Shadow DOM missing, can't safely use list operations."),!1)},_writeHaxStore:function(a){a.detail&&typeof a.detail.value!==typeof void 0&&a.detail.property&&a.detail.owner&&(this.set(a.detail.property,a.detail.value),this.fire("hax-store-property-updated",{property:a.detail.property,value:a.detail.value,owner:a.detail.owner}))},_haxStoreRegisterApp:function(a){a.detail&&(a.detail.index=this.appList.length,this.push("appList",a.detail),window.HaxStore.write("appList",this.appList,this),typeof a.target.parentElement!==typeof void 0&&"HAX-STORE"===a.target.parentElement.tagName&&dom(a.target.parentElement).removeChild(a.target))},_haxStoreRegisterStax:function(a){a.detail&&(a.detail.index=this.staxList.length,this.push("staxList",a.detail),window.HaxStore.write("staxList",this.staxList,this),typeof a.target.parentElement!==typeof void 0&&"HAX-STORE"===a.target.parentElement.tagName&&dom(a.target.parentElement).removeChild(a.target))},_haxStoreRegisterBlox:function(a){a.detail&&(a.detail.index=this.bloxList.length,this.push("bloxList",a.detail),window.HaxStore.write("bloxList",this.bloxList,this),typeof a.target.parentElement!==typeof void 0&&"HAX-STORE"===a.target.parentElement.tagName&&dom(a.target.parentElement).removeChild(a.target))},_haxStoreRegisterProperties:function(a){if(a.detail&&a.detail.properties&&a.detail.tag&&typeof this.elementList[a.detail.tag]==="undefined"){let b=a.detail.properties.gizmo;if(b){b.tag=a.detail.tag;let c=this.gizmoList;c.push(b),window.HaxStore.write("gizmoList",c,this),typeof a.target.parentElement!=="undefined"&&"HAX-AUTOLOADER"===a.target.parentElement.tagName&&dom(this.haxAutoloader).removeChild(a.target)}this.set("elementList."+a.detail.tag,a.detail.properties),this.validTagList.find(c=>{return c===a.detail.tag})||this.push("validTagList",a.detail.tag)}}}),window.HaxStore.toArray=a=>{return Object.keys(a).map(function(b){return a[b]})},window.HaxStore.camelToDash=a=>{return a.replace(/\W+/g,"-").replace(/([a-z\d])([A-Z])/g,"$1-$2").toLowerCase()},window.HaxStore.dashToCamel=a=>{return a.replace(/-([a-z])/g,function(b){return b[1].toUpperCase()})},window.HaxStore.htmlToHaxElements=a=>{let b=[];const c=window.HaxStore.instance.validTagList;let d=document.createElement("div");d.innerHTML=a;const f=d.childNodes;for(var h=0;h<f.length;h++)typeof f[h].tagName!=="undefined"&&c.includes(f[h].tagName.toLowerCase())&&b.push(window.HaxStore.nodeToHaxElement(f[h],null));return b},window.HaxStore.nodeToHaxElement=(a,b="insert-element")=>{let c={};if(typeof a.style!=="undefined"&&(c.style=a.getAttribute("style")),(null===c.style||"null"===c.style)&&delete c.style,typeof a.attributes.class!=="undefined"&&(c.class=a.attributes.class.nodeValue.replace("hax-active","")),typeof a.attributes.id!=="undefined"&&(c.id=a.getAttribute("id")),typeof a.properties!=="undefined"){for(var d in a.properties)"class"!=d&&"style"!=d&&a.properties.hasOwnProperty(d)&&void 0!==typeof a[d]&&null!=a[d]&&""!=a[d]?c[d]=a[d]:!1===a[d]&&(c[d]=a[d]);for(var f in a.attributes)if(typeof a.attributes[f].name!=="undefined"&&"class"!=a.attributes[f].name&&"style"!=a.attributes[f].name&&"id"!=a.attributes[f].name&&a.attributes.hasOwnProperty(f)&&void 0!==typeof a.attributes[f].value&&null!=a.attributes[f].value&&""!=a.attributes[f].value&&!a.properties.hasOwnProperty(window.HaxStore.dashToCamel(a.attributes[f].name)))c[window.HaxStore.dashToCamel(a.attributes[f].name)]=a.attributes[f].value;else;}else for(var f in a.attributes)"undefined"!==typeof a.attributes[f].name&&"class"!=a.attributes[f].name&&"style"!=a.attributes[f].name&&"id"!=a.attributes[f].name&&a.attributes.hasOwnProperty(f)&&void 0!==typeof a.attributes[f].value&&null!=a.attributes[f].value&&""!=a.attributes[f].value&&(c[window.HaxStore.dashToCamel(a.attributes[f].name)]=a.attributes[f].value);let h=a.tagName.toLowerCase();window.HaxStore.instance._isSandboxed&&"iframe"===h&&(h="webview");let k=window.HaxStore.getHAXSlot(a);"a"===h?c.innerText=k:("p"===h||"ol"===h||"ul"===h||"div"===h)&&(c.innerHTML=k);let m={tag:h,properties:c,content:k};return null!==b&&(m.eventName=b),m},window.HaxStore.haxElementToNode=(a,b,c)=>{window.HaxStore.instance._isSandboxed&&"iframe"===a&&(a="webview");var d=document.createElement(a);d.innerHTML=b;var f=d.cloneNode(!0);for(var h in c){let k=window.HaxStore.camelToDash(h);c.hasOwnProperty(h)&&(!0===c[h]?f.setAttribute(k,c[h]):!1===c[h]?f.removeAttribute(k):null==c[h]||c[h].constructor!==Array||d.properties[h].readOnly?null==c[h]||c[h].constructor!==Object||d.properties[h].readOnly?f.setAttribute(k,c[h]):f.set(k,c[h]):f.set(k,c[h]))}return f},window.HaxStore.haxNodeToContent=a=>{window.HaxStore.instance.activeHaxBody.globalPreferences.haxDeveloperMode&&console.log(a);let b=Object.getPrototypeOf(a);if(typeof b.preProcessHaxNodeToContent!=="undefined"){let v=a.cloneNode();a=b.preProcessHaxNodeToContent(v)}let c=a.tagName.toLowerCase();window.HaxStore.instance._isSandboxed&&"webview"===c&&(c="iframe");var d="";d+="<"+c;for(var f=window.HaxStore.instance.elementList[c],h={},k=0,m=a.attributes.length;k<m;++k){var n=a.attributes.item(k).nodeName,o=a.attributes.item(k).value;"style"!=n&&(typeof o===typeof Object||o.constructor===Array)?h[n]=JSON.stringify(o).replace(/"/g,"&quot;"):null!=o&&"null"!=o&&(!0===o||"true"===o?h[n]=!0:!1===o||("string"===typeof o&&""!==o?(o=o.replace(/"/g,"&quot;"),h[n]=o):""===o?(""==o&&""!=a.attributes.item(k).value&&(o=a.attributes.item(k).value),h[n]=o):h[n]=o))}if(typeof a.properties!=="undefined")for(var k in a.properties){var n=window.HaxStore.camelToDash(k),o=null;"undefined"!==typeof a[k]&&(o=a[k]),a.properties[k].readOnly||o===a.properties[k].value||(null!=o&&(typeof o===typeof Object||o.constructor===Array)?h[n]=JSON.stringify(o).replace(/"/g,"&quot;"):null!=o&&"null"!=o&&(!0===o||"true"===o?h[n]=!0:!1===o||("string"===typeof o&&""!==o?(o=o.replace(/"/g,"&quot;"),h[n]=o):""===o?""==o&&""!=a.properties[k].value?o=a.properties[k].value:""===o&&""==a.properties[k].value:h[n]=o)))}if("undefined"!==typeof f&&"undefined"!==typeof f.saveOptions.unsetAttributes)for(var q in f.saveOptions.unsetAttributes)delete h[f.saveOptions.unsetAttributes[q]];let r=["inner-text","tabindex","guestinstance"];for(var s in r)"undefined"!==typeof h[r[s]]&&delete h[r[s]];for(var q in"undefined"!==typeof h.id&&""===h.id&&delete h.id,h)d+=!0===h[q]?" "+q:" "+q+"=\""+h[q]+"\"";if(d+=["area","base","br","col","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"].includes(c)?"/>":">",typeof f==="undefined"||!f.saveOptions.wipeSlot){let v=dom(a).getEffectiveChildNodes();if(0<v.length)for(var k=0,u=v.length;k<u;k++)"undefined"===typeof v[k].tagName?8===v[k].nodeType?d+="<!-- "+v[k].textContent+" -->":1!==v[k].nodeType&&"undefined"!==typeof v[k].textContent&&"undefined"!==v[k].textContent&&(d+=v[k].textContent):window.HaxStore.HTMLPrimativeTest(v[k].tagName)||"TEMPLATE"===v[k].tagName?(v[k].setAttribute("data-editable",!1),v[k].removeAttribute("data-hax-ray"),v[k].contentEditable=!1,d+=v[k].outerHTML):d+=window.HaxStore.haxNodeToContent(v[k])}return"span"===c?d+="</"+c+">":"hr"===c||"br"===c||"img"===c||(d+="</"+c+">\n"),window.HaxStore.instance.activeHaxBody.globalPreferences.haxDeveloperMode&&console.log(d),"function"===a.postProcesshaxNodeToContent&&(d=a.postProcesshaxNodeToContent(d)),d},window.HaxStore.HTMLPrimativeTest=a=>{return typeof a.tagName!=="undefined"&&-1==a.tagName.indexOf("-")},window.HaxStore.getHAXSlot=a=>{let b="";var c=dom(a).children;if(0<c.length)for(var d=0,f=c.length;d<f;d++)"undefined"===typeof c[d].tagName?8===c[d].nodeType?b+="<!-- "+c[d].textContent+" -->":1!==c[d].nodeType&&"undefined"!==typeof c[d].textContent&&"undefined"!==c[d].textContent&&(b+=c[d].textContent):b+=0<c[d].tagName.indexOf("-")?"  "+window.HaxStore.haxNodeToContent(c[d])+"\n":"  "+c[d].outerHTML+"\n";return b},window.HaxStore.write=(a,b,c)=>{c.fire("hax-store-write",{property:a,value:b,owner:c})},window.HaxStore.guessGizmoType=a=>{if(typeof a.source!==typeof void 0)return-1==a.source.indexOf(".mp3")?-1!=a.source.indexOf(".png")||-1!=a.source.indexOf(".jpg")||-1!=a.source.indexOf(".jpeg")||-1!=a.source.indexOf(".gif")?"image":-1==a.source.indexOf(".pdf")?-1==a.source.indexOf(".svg")?-1==a.source.indexOf(".csv")?"external"==window.HaxStore.instance.getVideoType(a.source)?"*":"video":"csv":"svg":"pdf":"audio"},window.HaxStore.guessGizmo=(a,b,c=!1)=>{var d=[];if(typeof a!==typeof void 0){var f=window.HaxStore.instance;if(f.validGizmoTypes.includes(a))for(var h in f.gizmoList)for(var k=f.gizmoList[h],m={},n=!1,o=0;o<k.handles.length;o++)if(a===k.handles[o].type||"*"===a&&!n){for(var q in k.handles[o])"type"!==q&&"undefined"!==typeof b[q]&&(n=!0,m[k.handles[o][q]]=b[q]);(n||c)&&d.push(window.HaxStore.haxElementPrototype(k,m,""))}}return d},window.HaxStore.getHaxAppStoreTargets=a=>{let b=window.HaxStore.instance.appList.filter(c=>{if(typeof c.connection.operations.add!==typeof void 0){let d=c.connection.operations.add;if(typeof d.acceptsGizmoTypes!==typeof void 0&&d.acceptsGizmoTypes.includes(a))return!0}return!1});return b},window.HaxStore.haxElementPrototype=(a,b,c="")=>{return{tag:a.tag,properties:b,content:c,gizmo:a}},window.HaxStore.wipeSlot=(a,b="")=>{if("*"===b)for(;null!==dom(a).firstChild;)dom(a).removeChild(dom(a).firstChild);else for(var c in dom(a).childNodes)"undefined"!==typeof dom(a).childNodes[c]&&dom(a).childNodes[c].slot===b&&dom(a).removeChild(dom(a).childNodes[c])},window.HaxStore.encapScript=a=>{return a=a.replace(/<script[\s\S]*?>/gi,"&lt;script&gt;"),a=a.replace(/<\/script>/gi,"&lt;/script&gt;"),a=a.replace(/<style[\s\S]*?>/gi,"&lt;style&gt;"),a=a.replace(/<\/style>/gi,"&lt;/style&gt;"),a=a.replace(/<template[\s\S]*?>[\s\S]*?&lt;script[\s\S]*?&gt;[\s\S]*?&lt;\/script&gt;/gi,function(b){return b=b.replace("&lt;script&gt;","<script>"),b=b.replace("&lt;/script&gt;","</script>"),b=b.replace("&lt;style&gt;","<style>"),b=b.replace("&lt;/style&gt;","</style>"),b}),a},window.HaxStore.toast=(a,b=3e3)=>{window.HaxStore.instance.haxToast.duration=b,window.HaxStore.instance.haxToast.show(a)};