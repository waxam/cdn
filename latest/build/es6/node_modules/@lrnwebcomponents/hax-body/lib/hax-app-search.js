import{html,Polymer}from"@polymer/polymer/polymer-legacy.js";import"@polymer/paper-input/paper-input.js";import"@polymer/paper-card/paper-card.js";import"@polymer/paper-styles/paper-styles.js";import"@polymer/iron-list/iron-list.js";import"@polymer/iron-ajax/iron-ajax.js";import"@lrnwebcomponents/elmsln-loading/elmsln-loading.js";import"@lrnwebcomponents/simple-colors/simple-colors.js";import"./hax-app-search-inputs.js";import"./hax-app-search-result.js";Polymer({_template:html`
    <style is="custom-style">
      :host {
        display: block;
      }
      paper-button.item-wrapper {
        margin: 0;
        padding: 0;
      }
      paper-card {
        padding: 0;
        margin: 8px;
        width: 240px;
        font-size: 12px;
        --paper-card-header: {
          max-height: 160px;
        }
      }
      @media screen and (min-width: 800px) {
        paper-card {
          font-size: 14px;
        }
      }
      #loading[hidden] {
        visibility: hidden !important;
        opacity: 0 !important;
        display: block !important;
      }
      .loading {
        width: calc(100% - 32px);
        z-index: 1000;
        opacity: 0.9;
        text-align: center;
        align-content: space-around;
        justify-content: center;
        position: absolute;
        padding: 0;
        margin: 0;
        display: flex;
        margin: 0 auto;
        visibility: visible;
        transition: visibility 0.5s, opacity 0.5s ease;
      }
      .loading elmsln-loading {
        margin: 0 80px;
        display: inline-flex;
      }
      #loading {
        height: 100%;
        display: flex;
        justify-content: center;
      }
      #loading .loading,
      #loading elmsln-loading {
        display: block;
        height: 80px;
      }
      .card-content {
        padding: 0.16px;
      }
      .card-content p {
        padding: 0;
        margin: 0;
      }
      #itemlist {
        min-height: 150px;
        border: 1px solid #222222;
      }
      hax-app-search-inputs {
        min-height: 150px;
        padding: 16px 16px 0 16px;
        color: #222222;
      }
      hax-app-pagination {
        min-height: 32px;
        font-size: 12.8px;
        display: none;
        justify-content: flex-end;
        justify-content: center;
        color: #222222;
      }
      .loading-text {
        font-size: 32px;
        padding: 16px 0;
        color: var(--simple-colors-light-green-background3);
      }
    </style>

    <iron-ajax
      auto="[[auto]]"
      id="request"
      method="[[method]]"
      url="[[requestEndPoint]]"
      handle-as="json"
      headers="[[headers]]"
      params="[[requestParams]]"
      last-response="{{requestData}}"
      hidden=""
      loading="{{loading}}"
      debounce-duration="250"
    ></iron-ajax>
    <hax-app-search-inputs
      label="[[label]]"
      schema="{{searchSchema}}"
      values="{{searchValues}}"
    ></hax-app-search-inputs>
    <hax-app-pagination
      id="pagerbottom"
      request-data="[[requestData]]"
      pagination="[[pagination]]"
    ></hax-app-pagination>
    <div id="loading" class="loading" hidden\$="[[!loading]]">
      <elmsln-loading
        color="light-green-text text-accent-3"
        size="large"
      ></elmsln-loading>
      <div class="loading-text">Loading content..</div>
    </div>
    <iron-list grid="" id="itemlist" items="[[media]]" as="resultData">
      <template>
        <hax-app-search-result
          result-data="[[resultData]]"
        ></hax-app-search-result>
      </template>
    </iron-list>
  `,is:"hax-app-search",properties:{activeApp:{type:Object,observer:"_resetAppSearch"},auto:{type:Boolean,value:!1},searchSchema:{type:Object,value:{}},searchValues:{type:Object,value:{}},headers:{type:Object,value:{}},method:{type:String,value:"GET"},loading:{type:Boolean,value:!1},requestData:{type:Object,value:{},observer:"_requestDataChanged"},media:{type:Array,value:[],observer:"_mediaChanged"}},_searchValuesEvent:function(a){if(typeof a.detail!==typeof void 0){var b=this.requestParams;for(var c in a.detail)b[c]=a.detail[c];this.set("requestParams",{}),this.set("requestParams",b)}},_resetAppSearch:function(a){if(typeof a!==typeof void 0&&null!==a){let g=a;var c={};this.label=g.details.title,this.auto=!1,this.set("media",[]),typeof g.connection.data!==typeof void 0&&(c=g.connection.data),typeof g.connection.operations.browse.data!==typeof void 0&&(c=Object.assign(c,g.connection.operations.browse.data)),this.set("method",g.connection.operations.browse.method),this.set("headers",{}),typeof g.connection.headers!==typeof void 0&&this.set("headers",g.connection.headers),this.set("requestParams",{}),this.set("requestParams",c);var d=g.connection.protocol+"://"+g.connection.url;"/"!=d.substr(d.length-1)&&(d+="/"),typeof g.connection.operations.browse.endPoint!==typeof void 0&&(d+=g.connection.operations.browse.endPoint),this.set("requestEndPoint",d),this.set("searchSchema",{});var f={properties:{}};typeof g.connection.operations.browse.search!==typeof void 0&&(f.properties=g.connection.operations.browse.search,this.set("searchSchema",f)),this.resultMap=g.connection.operations.browse.resultMap,this.set("pagination",{}),typeof g.connection.operations.browse.pagination!==typeof void 0&&this.set("pagination",g.connection.operations.browse.pagination),this.auto=!(typeof g.connection.auto!=="undefined")||g.connection.auto}},attached:function(){document.body.addEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),document.body.addEventListener("hax-app-search-values-changed",this._searchValuesEvent.bind(this))},detached:function(){document.body.removeEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),document.body.removeEventListener("hax-app-search-values-changed",this._searchValuesEvent.bind(this))},_haxStorePropertyUpdated:function(a){a.detail&&typeof a.detail.value!==typeof void 0&&a.detail.property&&this.set(a.detail.property,a.detail.value)},_requestDataChanged:function(a,b){if({}!=typeof a&&typeof b!=="undefined"){let f=[],g=this.resultMap,h=[];if(typeof this._resolveObjectPath(g.items,a)==="undefined"?null!=a&&(h=a):h=this._resolveObjectPath(g.items,a),null!=h){for(var c=0;c<h.length;c++){if(f[c]={title:this._resolveObjectPath(g.preview.title,h[c]),details:this._resolveObjectPath(g.preview.details,h[c]),type:g.defaultGizmoType,map:{}},"undefined"!==typeof f[c].details&&null!=f[c].details&&(f[c].details=f[c].details.replace(/(<([^>]+)>)/gi,"")),g.preview.id.constructor===Object){let j=this._resolveObjectPath(g.preview.id.property,h[c]);"split"===g.preview.id.op&&(j=j.split(g.preview.id.delimiter),f[c].id=j[g.preview.id.position])}else f[c].id=this._resolveObjectPath(g.preview.id,h[c]);for(var d in f[c].image="undefined"===typeof g.preview.image?"undefined"===typeof g.image?"":g.image:this._resolveObjectPath(g.preview.image,h[c]),g.gizmo)if("_url_source"===d){let j="";j="undefined"===typeof f[c].map.__id?this._resolveObjectPath(g.gizmo.id,h[c]):f[c].map.__id,f[c].map.source=g.gizmo._url_source.replace("<%= id %>",j)}else if(g.gizmo[d].constructor===Object){let j=this._resolveObjectPath(g.gizmo[d].property,h[c]);"split"===g.gizmo[d].op&&(j=j.split(g.gizmo[d].delimiter),f[c].map[d]=j[g.gizmo[d].position],"id"===d&&(f[c].map.__id=f[c].map[d]))}else f[c].map[d]=this._resolveObjectPath(g.gizmo[d],h[c]);"undefined"===typeof f[c].map.url&&"undefined"!==typeof f[c].map.source&&(f[c].map.url=f[c].map.source),"undefined"!==typeof g.gizmo.type&&(f[c].type=this._resolveObjectPath(g.gizmo.type,h[c]))}this.set("media",[]),this.set("media",f)}}},_mediaChanged:function(a,b){typeof b!==typeof void 0&&setTimeout(()=>{this.$.itemlist.fire("iron-resize")},200)},_resolveObjectPath:function(a,b){return a.split(".").reduce(function(c,d){return c?c[d]:null},b||self)}});