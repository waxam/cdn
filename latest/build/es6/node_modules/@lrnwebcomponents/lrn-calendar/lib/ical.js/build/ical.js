"object"===typeof module?ICAL=module.exports:"object"!==typeof ICAL&&(this.ICAL={}),ICAL.foldLength=75,ICAL.newLineChar="\r\n",ICAL.helpers={isStrictlyNaN:function(n){return"number"===typeof n&&isNaN(n)},strictParseInt:function(n){var u=parseInt(n,10);if(ICAL.helpers.isStrictlyNaN(u))throw new Error("Could not extract integer from \""+n+"\"");return u},formatClassType:function(u,l){return"undefined"===typeof u?void 0:u instanceof l?u:new l(u)},unescapedIndexOf:function(n,u,l){for(;-1!==(l=n.indexOf(u,l));)if(0<l&&"\\"===n[l-1])l+=1;else return l;return-1},binsearchInsert:function(n,u,l){if(!n.length)return 0;for(var T,_,c=0,f=n.length-1;c<=f;)if(T=c+Math.floor((f-c)/2),_=l(u,n[T]),0>_)f=T-1;else if(0<_)c=T+1;else break;return 0>_?T:0<_?T+1:T},dumpn:function(){ICAL.debug&&(ICAL.helpers.dumpn="undefined"!==typeof console&&"log"in console?function(u){console.log(u)}:function(u){dump(u+"\n")},ICAL.helpers.dumpn(arguments[0]))},clone:function(n,u){if(!n||"object"!=typeof n)return n;if(n instanceof Date)return new Date(n.getTime());if("clone"in n)return n.clone();if(Array.isArray(n)){for(var l=[],c=0;c<n.length;c++)l.push(u?ICAL.helpers.clone(n[c],!0):n[c]);return l}var f={};for(var T in n)Object.prototype.hasOwnProperty.call(n,T)&&(f[T]=u?ICAL.helpers.clone(n[T],!0):n[T]);return f},foldline:function(u){for(var l="",c=u||"";c.length;)l+=ICAL.newLineChar+" "+c.substr(0,ICAL.foldLength),c=c.substr(ICAL.foldLength);return l.substr(ICAL.newLineChar.length+1)},pad2:function(u){"string"!==typeof u&&("number"===typeof u&&(u=parseInt(u)),u=u+"");var l=u.length;return 0===l?"00":1===l?"0"+u:u},trunc:function(u){return 0>u?Math.ceil(u):Math.floor(u)},inherits:function(n,u,l){function c(){}c.prototype=n.prototype,u.prototype=new c,l&&ICAL.helpers.extend(l,u.prototype)},extend:function(n,u){for(var l in n){var c=Object.getOwnPropertyDescriptor(n,l);c&&!Object.getOwnPropertyDescriptor(u,l)&&Object.defineProperty(u,l,c)}return u}},ICAL.design=function(){"use strict";function n(Q,$){var ee={matches:/.*/,fromICAL:function(te,ae){return l(te,Q,ae)},toICAL:function(te,ae){var ne=$;return ae&&(ne=new RegExp(ne.source+"|"+ae)),te.replace(ne,function(re){return"\\"===re?"\\\\":";"===re?"\\;":","===re?"\\,":"\n"===re?"\\n":re})}};return ee}function u(Q){return"\\\\"===Q?"\\":"\\;"===Q?";":"\\,"===Q?",":"\\n"===Q||"\\N"===Q?"\n":Q}function l(Q,$,ee){return-1===Q.indexOf("\\")?Q:(ee&&($=new RegExp($.source+"|\\\\"+ee)),Q.replace($,u))}var c=/\\\\|\\;|\\,|\\[Nn]/g,f=/\\|;|,|\n/g,T=/\\\\|\\,|\\[Nn]/g,_=/\\|,|\n/g,D={defaultType:"text"},g={defaultType:"text",multiValue:","},O={defaultType:"text",structuredValue:";"},A={defaultType:"integer"},N={defaultType:"date-time",allowedTypes:["date-time","date"]},E={defaultType:"date-time"},I={defaultType:"uri"},C={defaultType:"utc-offset"},S={defaultType:"recur"},P={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]},B={categories:g,url:I,version:D,uid:D},z={boolean:{values:["TRUE","FALSE"],fromICAL:function(Q){return!("TRUE"!==Q)||"FALSE"!==Q&&!1},toICAL:function(Q){return Q?"TRUE":"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(Q){var $=parseFloat(Q);return ICAL.helpers.isStrictlyNaN($)?0:$},toICAL:function(Q){return Q+""}},integer:{fromICAL:function(Q){var $=parseInt(Q);return ICAL.helpers.isStrictlyNaN($)?0:$},toICAL:function(Q){return Q+""}},"utc-offset":{toICAL:function(Q){return 7>Q.length?Q.substr(0,3)+Q.substr(4,2):Q.substr(0,3)+Q.substr(4,2)+Q.substr(7,2)},fromICAL:function(Q){return 6>Q.length?Q.substr(0,3)+":"+Q.substr(3,2):Q.substr(0,3)+":"+Q.substr(3,2)+":"+Q.substr(5,2)},decorate:function(Q){return ICAL.UtcOffset.fromString(Q)},undecorate:function(Q){return Q.toString()}}},M={cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISLANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}},L=ICAL.helpers.extend(z,{text:n(c,f),uri:{},binary:{decorate:function(Q){return ICAL.Binary.fromString(Q)},undecorate:function(Q){return Q.toString()}},"cal-address":{},date:{decorate:function(Q,$){return ICAL.Time.fromDateString(Q,$)},undecorate:function(Q){return Q.toString()},fromICAL:function(Q){return Q.substr(0,4)+"-"+Q.substr(4,2)+"-"+Q.substr(6,2)},toICAL:function(Q){return 11<Q.length?Q:Q.substr(0,4)+Q.substr(5,2)+Q.substr(8,2)}},"date-time":{fromICAL:function(Q){var $=Q.substr(0,4)+"-"+Q.substr(4,2)+"-"+Q.substr(6,2)+"T"+Q.substr(9,2)+":"+Q.substr(11,2)+":"+Q.substr(13,2);return Q[15]&&"Z"===Q[15]&&($+="Z"),$},toICAL:function(Q){if(19>Q.length)return Q;var $=Q.substr(0,4)+Q.substr(5,2)+Q.substr(8,5)+Q.substr(14,2)+Q.substr(17,2);return Q[19]&&"Z"===Q[19]&&($+="Z"),$},decorate:function(Q,$){return ICAL.Time.fromDateTimeString(Q,$)},undecorate:function(Q){return Q.toString()}},duration:{decorate:function(Q){return ICAL.Duration.fromString(Q)},undecorate:function(Q){return Q.toString()}},period:{fromICAL:function(Q){var $=Q.split("/");return $[0]=L["date-time"].fromICAL($[0]),ICAL.Duration.isValueString($[1])||($[1]=L["date-time"].fromICAL($[1])),$},toICAL:function(Q){return Q[0]=L["date-time"].toICAL(Q[0]),ICAL.Duration.isValueString(Q[1])||(Q[1]=L["date-time"].toICAL(Q[1])),Q.join("/")},decorate:function(Q,$){return ICAL.Period.fromJSON(Q,$)},undecorate:function(Q){return Q.toJSON()}},recur:{fromICAL:function(Q){return ICAL.Recur._stringToData(Q,!0)},toICAL:function(Q){var $="";for(var ee in Q)if(Object.prototype.hasOwnProperty.call(Q,ee)){var te=Q[ee];"until"==ee?10<te.length?te=L["date-time"].toICAL(te):te=L.date.toICAL(te):"wkst"==ee?"number"===typeof te&&(te=ICAL.Recur.numericDayToIcalDay(te)):Array.isArray(te)&&(te=te.join(",")),$+=ee.toUpperCase()+"="+te+";"}return $.substr(0,$.length-1)},decorate:function($){return ICAL.Recur.fromData($)},undecorate:function(Q){return Q.toJSON()}},time:{fromICAL:function(Q){if(6>Q.length)return Q;var $=Q.substr(0,2)+":"+Q.substr(2,2)+":"+Q.substr(4,2);return"Z"===Q[6]&&($+="Z"),$},toICAL:function(Q){if(8>Q.length)return Q;var $=Q.substr(0,2)+Q.substr(3,2)+Q.substr(6,2);return"Z"===Q[8]&&($+="Z"),$}}}),R=ICAL.helpers.extend(B,{action:D,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:D,class:D,comment:D,completed:E,contact:D,created:E,description:D,dtend:N,dtstamp:E,dtstart:N,due:N,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:S,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":E,location:D,method:D,organizer:{defaultType:"cal-address"},"percent-complete":A,priority:A,prodid:D,"related-to":D,repeat:A,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function(Q){return-1===Q.indexOf("/")?-1===Q.indexOf("T")?"date":"date-time":"period"}},"recurrence-id":N,resources:g,"request-status":O,rrule:S,sequence:A,status:D,summary:D,transp:D,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:C,tzoffsetto:C,tzurl:I,tzid:D,tzname:D}),w=ICAL.helpers.extend(z,{text:n(T,_),uri:n(T,_),date:{decorate:function(Q){return ICAL.VCardTime.fromDateAndOrTimeString(Q,"date")},undecorate:function(Q){return Q.toString()},fromICAL:function(Q){return 8==Q.length?L.date.fromICAL(Q):"-"==Q[0]&&6==Q.length?Q.substr(0,4)+"-"+Q.substr(4):Q},toICAL:function(Q){return 10==Q.length?L.date.toICAL(Q):"-"==Q[0]&&7==Q.length?Q.substr(0,4)+Q.substr(5):Q}},time:{decorate:function(Q){return ICAL.VCardTime.fromDateAndOrTimeString("T"+Q,"time")},undecorate:function(Q){return Q.toString()},fromICAL:function(Q){var $=w.time._splitZone(Q,!0),ee=$[0],te=$[1];return 6==te.length?te=te.substr(0,2)+":"+te.substr(2,2)+":"+te.substr(4,2):4==te.length&&"-"!=te[0]?te=te.substr(0,2)+":"+te.substr(2,2):5==te.length&&(te=te.substr(0,3)+":"+te.substr(3,2)),5==ee.length&&("-"==ee[0]||"+"==ee[0])&&(ee=ee.substr(0,3)+":"+ee.substr(3)),te+ee},toICAL:function(Q){var $=w.time._splitZone(Q),ee=$[0],te=$[1];return 8==te.length?te=te.substr(0,2)+te.substr(3,2)+te.substr(6,2):5==te.length&&"-"!=te[0]?te=te.substr(0,2)+te.substr(3,2):6==te.length&&(te=te.substr(0,3)+te.substr(4,2)),6==ee.length&&("-"==ee[0]||"+"==ee[0])&&(ee=ee.substr(0,3)+ee.substr(4)),te+ee},_splitZone:function(Q,$){var ne,re,ee=Q.length-1,te=Q.length-($?5:6),ae=Q[te];return"Z"==Q[ee]?(ne=Q[ee],re=Q.substr(0,ee)):6<Q.length&&("-"==ae||"+"==ae)?(ne=Q.substr(te),re=Q.substr(0,te)):(ne="",re=Q),[ne,re]}},"date-time":{decorate:function(Q){return ICAL.VCardTime.fromDateAndOrTimeString(Q,"date-time")},undecorate:function(Q){return Q.toString()},fromICAL:function(Q){return w["date-and-or-time"].fromICAL(Q)},toICAL:function(Q){return w["date-and-or-time"].toICAL(Q)}},"date-and-or-time":{decorate:function(Q){return ICAL.VCardTime.fromDateAndOrTimeString(Q,"date-and-or-time")},undecorate:function(Q){return Q.toString()},fromICAL:function(Q){var $=Q.split("T");return($[0]?w.date.fromICAL($[0]):"")+($[1]?"T"+w.time.fromICAL($[1]):"")},toICAL:function(Q){var $=Q.split("T");return w.date.toICAL($[0])+($[1]?"T"+w.time.toICAL($[1]):"")}},timestamp:L["date-time"],"language-tag":{matches:/^[a-zA-Z0-9\-]+$/}}),V=ICAL.helpers.extend(B,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:P,bday:P,caladruri:I,caluri:I,clientpidmap:O,email:D,fburl:I,fn:D,gender:O,geo:I,impp:I,key:I,kind:D,lang:{defaultType:"language-tag"},logo:I,member:I,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:g,note:D,org:{defaultType:"text",structuredValue:";"},photo:I,related:I,rev:{defaultType:"timestamp"},role:D,sound:I,source:I,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:D,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:D}),H=ICAL.helpers.extend(z,{binary:L.binary,date:w.date,"date-time":w["date-time"],"phone-number":{},uri:L.uri,text:L.text,time:L.time,vcard:L.text,"utc-offset":{toICAL:function(Q){return Q.substr(0,7)},fromICAL:function(Q){return Q.substr(0,7)},decorate:function(Q){return ICAL.UtcOffset.fromString(Q)},undecorate:function(Q){return Q.toString()}}}),K=ICAL.helpers.extend(B,{fn:D,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:g,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(Q){return-1===Q.indexOf("T")?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:D,tel:{defaultType:"phone-number"},email:D,mailer:D,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:D,role:D,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:O,note:g,prodid:D,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function(Q){return-1===Q.indexOf("T")?"date":"date-time"}},"sort-string":D,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:D,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),X={value:L,param:M,property:R},J={value:w,param:{type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},property:V},Z={value:H,param:{type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},property:K},G={defaultSet:X,defaultType:"unknown",components:{vcard:J,vcard3:Z,vevent:X,vtodo:X,vjournal:X,valarm:X,vtimezone:X,daylight:X,standard:X},icalendar:X,vcard:J,vcard3:Z,getDesignSet:function(Q){var $=Q&&Q in G.components;return $?G.components[Q]:G.defaultSet}};return G}(),ICAL.stringify=function(){"use strict";function n(_){"string"==typeof _[0]&&(_=[_]);for(var D=0,g=_.length,O="";D<g;D++)O+=n.component(_[D])+u;return O}var u="\r\n",l="unknown",c=ICAL.design,f=ICAL.helpers;n.component=function(_,D){var g=_[0].toUpperCase(),O="BEGIN:"+g+u,A=_[1],N=0,E=A.length,I=_[0];for("vcard"===I&&0<_[1].length&&("version"!==_[1][0][0]||"4.0"!==_[1][0][3])&&(I="vcard3"),D=D||c.getDesignSet(I);N<E;N++)O+=n.property(A[N],D)+u;for(var C=_[2],S=0,P=C.length;S<P;S++)O+=n.component(C[S],D)+u;return O+="END:"+g,O},n.property=function(_,D,g){var I,O=_[0].toUpperCase(),A=_[0],N=_[1],E=O;for(I in N){var C=N[I];if(N.hasOwnProperty(I)){var S=I in D.param&&D.param[I].multiValue;S&&Array.isArray(C)?(D.param[I].multiValueSeparateDQuote&&(S="\""+S+"\""),C=C.map(n._rfc6868Unescape),C=n.multiValue(C,S,"unknown",null,D)):C=n._rfc6868Unescape(C),E+=";"+I.toUpperCase(),E+="="+n.propertyValue(C)}}if(3===_.length)return E+":";var P=_[2];D||(D=c.defaultSet);var B,S=!1,z=!1,M=!1;return A in D.property?(B=D.property[A],"multiValue"in B&&(S=B.multiValue),"structuredValue"in B&&Array.isArray(_[3])&&(z=B.structuredValue),"defaultType"in B?P===B.defaultType&&(M=!0):P===l&&(M=!0)):P===l&&(M=!0),M||(E+=";VALUE="+P.toUpperCase()),E+=":",E+=S&&z?n.multiValue(_[3],z,P,S,D,z):S?n.multiValue(_.slice(3),S,P,null,D,!1):z?n.multiValue(_[3],z,P,null,D,z):n.value(_[3],P,D,!1),g?E:ICAL.helpers.foldline(E)},n.propertyValue=function(_){return-1===f.unescapedIndexOf(_,",")&&-1===f.unescapedIndexOf(_,":")&&-1===f.unescapedIndexOf(_,";")?_:"\""+_+"\""},n.multiValue=function(_,D,g,O,A,N){for(var E="",I=_.length,C=0;C<I;C++)E+=O&&Array.isArray(_[C])?n.multiValue(_[C],O,g,null,A,N):n.value(_[C],g,A,N),C!==I-1&&(E+=D);return E},n.value=function(_,D,g,O){return D in g.value&&"toICAL"in g.value[D]?g.value[D].toICAL(_,O):_},n._rfc6868Unescape=function(_){return _.replace(/[\n^"]/g,function(D){return T[D]})};var T={'"':"^'","\n":"^n","^":"^^"};return n}(),ICAL.parse=function(){"use strict";function n(E){this.message=E,this.name="ParserError";try{throw new Error}catch(C){if(C.stack){var I=C.stack.split("\n");I.shift(),this.stack=I.join("\n")}}}function u(E){var I={},C=I.component=[];if(I.stack=[C],u._eachLine(E,function(S,P){u._handleContentLine(P,I)}),1<I.stack.length)throw new n("invalid ical body. component began but did not end");return I=null,1==C.length?C[0]:C}var l=/[^ \t]/,f=":",T=";",O=ICAL.design,A=ICAL.helpers;n.prototype=Error.prototype,u.property=function(E,I){var C={component:[[],[]],designSet:I||O.defaultSet};return u._handleContentLine(E,C),C.component[1][0]},u.component=function(E){return u(E)},u.ParserError=n,u._handleContentLine=function(E,I){var P,B,z,M,C=E.indexOf(f),S=E.indexOf(T),L={};-1!==S&&-1!==C&&S>C&&(S=-1);var R;if(-1!==S){if(z=E.substring(0,S).toLowerCase(),R=u._parseParameters(E.substring(S),0,I.designSet),-1==R[2])throw new n("Invalid parameters in '"+E+"'");if(L=R[0],P=R[1].length+R[2]+S,-1!==(B=E.substring(P).indexOf(f)))M=E.substring(P+B+1);else throw new n("Missing parameter value in '"+E+"'")}else if(-1!==C){if(z=E.substring(0,C).toLowerCase(),M=E.substring(C+1),"begin"===z){var w=[M.toLowerCase(),[],[]];return 1===I.stack.length?I.component.push(w):I.component[2].push(w),I.stack.push(I.component),I.component=w,void(I.designSet||(I.designSet=O.getDesignSet(I.component[0])))}if("end"===z)return void(I.component=I.stack.pop())}else throw new n("invalid line (no token \";\" or \":\") \""+E+"\"");var U,W,V=!1,H=!1;z in I.designSet.property&&(W=I.designSet.property[z],"multiValue"in W&&(V=W.multiValue),"structuredValue"in W&&(H=W.structuredValue),M&&"detectType"in W&&(U=W.detectType(M))),U||("value"in L?U=L.value.toLowerCase():W?U=W.defaultType:U="unknown"),delete L.value;var K;V&&H?(M=u._parseMultiValue(M,H,U,[],V,I.designSet,H),K=[z,L,U,M]):V?(K=[z,L,U],u._parseMultiValue(M,V,U,K,null,I.designSet,!1)):H?(M=u._parseMultiValue(M,H,U,[],null,I.designSet,H),K=[z,L,U,M]):(M=u._parseValue(M,U,I.designSet,!1),K=[z,L,U,M]),"vcard"!==I.component[0]||0!==I.component[1].length||"version"===z&&"4.0"===M||(I.designSet=O.getDesignSet("vcard3")),I.component[1].push(K)},u._parseValue=function(E,I,C,S){return I in C.value&&"fromICAL"in C.value[I]?C.value[I].fromICAL(E,S):E},u._parseParameters=function(E,I,C){for(var M,L,R,U,V,H,S=I,P=0,z={},w=-1;!1!==P&&-1!==(P=A.unescapedIndexOf(E,"=",P+1));){if(M=E.substr(S+1,P-S-1),0==M.length)throw new n("Empty parameter name in '"+E+"'");L=M.toLowerCase(),U=L in C.param&&C.param[L].valueType?C.param[L].valueType:"text",L in C.param&&(V=C.param[L].multiValue,C.param[L].multiValueSeparateDQuote&&(H=u._rfc6868Escape("\""+V+"\"")));var W=E[P+1];if("\""===W){if(w=P+2,P=A.unescapedIndexOf(E,"\"",w),V&&-1!=P)for(var K=!0;K;)E[P+1]==V&&"\""==E[P+2]?P=A.unescapedIndexOf(E,"\"",P+3):K=!1;if(-1===P)throw new n("invalid line (no matching double quote) \""+E+"\"");R=E.substr(w,P-w),S=A.unescapedIndexOf(E,T,P),-1===S&&(P=!1)}else{w=P+1;var X=A.unescapedIndexOf(E,T,w),J=A.unescapedIndexOf(E,f,w);-1!==J&&X>J?(X=J,P=!1):-1===X?(X=-1===J?E.length:J,P=!1):(S=X,P=X),R=E.substr(w,X-w)}if(R=u._rfc6868Escape(R),V){var Z=H||V;z[L]=u._parseMultiValue(R,Z,U,[],null,C)}else z[L]=u._parseValue(R,U,C)}return[z,R,w]},u._rfc6868Escape=function(E){return E.replace(/\^['n^]/g,function(I){return N[I]})};var N={"^'":"\"","^n":"\n","^^":"^"};return u._parseMultiValue=function(E,I,C,S,P,B,z){var R,M=0,L=0;if(0===I.length)return E;for(;-1!==(M=A.unescapedIndexOf(E,I,L));)R=E.substr(L,M-L),R=P?u._parseMultiValue(R,P,C,[],null,B,z):u._parseValue(R,C,B,z),S.push(R),L=M+I.length;return R=E.substr(L),R=P?u._parseMultiValue(R,P,C,[],null,B,z):u._parseValue(R,C,B,z),S.push(R),1==S.length?S[0]:S},u._eachLine=function(E,I){var B,z,M,C=E.length,S=E.search(l),P=S;do P=E.indexOf("\n",S)+1,M=1<P&&"\r"===E[P-2]?2:1,0===P&&(P=C,M=0),z=E[S]," "===z||"\t"===z?B+=E.substr(S+1,P-S-(M+1)):(B&&I(null,B),B=E.substr(S,P-S-M)),S=P;while(P!==C);B=B.trim(),B.length&&I(null,B)},u}(),ICAL.Component=function(){"use strict";function n(f,T){"string"===typeof f&&(f=[f,[],[]]),this.jCal=f,this.parent=T||null}var u=1,l=2,c=0;return n.prototype={_hydratedPropertyCount:0,_hydratedComponentCount:0,get name(){return this.jCal[c]},get _designSet(){var f=this.parent&&this.parent._designSet;return f||ICAL.design.getDesignSet(this.name)},_hydrateComponent:function(f){if(this._components||(this._components=[],this._hydratedComponentCount=0),this._components[f])return this._components[f];var T=new n(this.jCal[l][f],this);return this._hydratedComponentCount++,this._components[f]=T},_hydrateProperty:function(f){if(this._properties||(this._properties=[],this._hydratedPropertyCount=0),this._properties[f])return this._properties[f];var T=new ICAL.Property(this.jCal[u][f],this);return this._hydratedPropertyCount++,this._properties[f]=T},getFirstSubcomponent:function(f){if(f){for(var T=0,_=this.jCal[l],D=_.length;T<D;T++)if(_[T][c]===f){var g=this._hydrateComponent(T);return g}}else if(this.jCal[l].length)return this._hydrateComponent(0);return null},getAllSubcomponents:function(f){var T=this.jCal[l].length,_=0;if(f){for(var D=this.jCal[l],g=[];_<T;_++)f===D[_][c]&&g.push(this._hydrateComponent(_));return g}if(!this._components||this._hydratedComponentCount!==T)for(;_<T;_++)this._hydrateComponent(_);return this._components||[]},hasProperty:function(f){for(var T=this.jCal[u],_=T.length,D=0;D<_;D++)if(T[D][c]===f)return!0;return!1},getFirstProperty:function(f){if(f){for(var T=0,_=this.jCal[u],D=_.length;T<D;T++)if(_[T][c]===f){var g=this._hydrateProperty(T);return g}}else if(this.jCal[u].length)return this._hydrateProperty(0);return null},getFirstPropertyValue:function(f){var T=this.getFirstProperty(f);return T?T.getFirstValue():null},getAllProperties:function(f){var T=this.jCal[u].length,_=0;if(f){for(var D=this.jCal[u],g=[];_<T;_++)f===D[_][c]&&g.push(this._hydrateProperty(_));return g}if(!this._properties||this._hydratedPropertyCount!==T)for(;_<T;_++)this._hydrateProperty(_);return this._properties||[]},_removeObjectByIndex:function(f,T,_){if(T=T||[],T[_]){var D=T[_];"parent"in D&&(D.parent=null)}T.splice(_,1),this.jCal[f].splice(_,1)},_removeObject:function(f,T,_){var D=0,g=this.jCal[f],O=g.length,A=this[T];if("string"===typeof _){for(;D<O;D++)if(g[D][c]===_)return this._removeObjectByIndex(f,A,D),!0;}else if(A)for(;D<O;D++)if(A[D]&&A[D]===_)return this._removeObjectByIndex(f,A,D),!0;return!1},_removeAllObjects:function(f,T,_){for(var D=this[T],g=this.jCal[f],O=g.length-1;0<=O;O--)_&&g[O][c]!==_||this._removeObjectByIndex(f,D,O)},addSubcomponent:function(f){this._components||(this._components=[],this._hydratedComponentCount=0),f.parent&&f.parent.removeSubcomponent(f);var T=this.jCal[l].push(f.jCal);return this._components[T-1]=f,this._hydratedComponentCount++,f.parent=this,f},removeSubcomponent:function(f){var T=this._removeObject(l,"_components",f);return T&&this._hydratedComponentCount--,T},removeAllSubcomponents:function(f){var T=this._removeAllObjects(l,"_components",f);return this._hydratedComponentCount=0,T},addProperty:function(f){if(!(f instanceof ICAL.Property))throw new TypeError("must instance of ICAL.Property");this._properties||(this._properties=[],this._hydratedPropertyCount=0),f.parent&&f.parent.removeProperty(f);var T=this.jCal[u].push(f.jCal);return this._properties[T-1]=f,this._hydratedPropertyCount++,f.parent=this,f},addPropertyWithValue:function(f,T){var _=new ICAL.Property(f);return _.setValue(T),this.addProperty(_),_},updatePropertyWithValue:function(f,T){var _=this.getFirstProperty(f);return _?_.setValue(T):_=this.addPropertyWithValue(f,T),_},removeProperty:function(f){var T=this._removeObject(u,"_properties",f);return T&&this._hydratedPropertyCount--,T},removeAllProperties:function(f){var T=this._removeAllObjects(u,"_properties",f);return this._hydratedPropertyCount=0,T},toJSON:function(){return this.jCal},toString:function(){return ICAL.stringify.component(this.jCal,this._designSet)}},n.fromString=function(f){return new n(ICAL.parse.component(f))},n}(),ICAL.Property=function(){"use strict";function n(_,D){this._parent=D||null,"string"===typeof _?(this.jCal=[_,{},T.defaultType],this.jCal[c]=this.getDefaultType()):this.jCal=_,this._updateType()}var u=0,l=1,c=2,f=3,T=ICAL.design;return n.prototype={get type(){return this.jCal[c]},get name(){return this.jCal[u]},get parent(){return this._parent},set parent(_){var D=!this._parent||_&&_._designSet!=this._parent._designSet;return this._parent=_,this.type==T.defaultType&&D&&(this.jCal[c]=this.getDefaultType(),this._updateType()),_},get _designSet(){return this.parent?this.parent._designSet:T.defaultSet},_updateType:function(){var _=this._designSet;if(this.type in _.value){_.value[this.type];this.isDecorated=!!("decorate"in _.value[this.type]),this.name in _.property&&(this.isMultiValue="multiValue"in _.property[this.name],this.isStructuredValue="structuredValue"in _.property[this.name])}},_hydrateValue:function(_){return this._values&&this._values[_]?this._values[_]:this.jCal.length<=f+_?null:this.isDecorated?(this._values||(this._values=[]),this._values[_]=this._decorate(this.jCal[f+_])):this.jCal[f+_]},_decorate:function(_){return this._designSet.value[this.type].decorate(_,this)},_undecorate:function(_){return this._designSet.value[this.type].undecorate(_,this)},_setDecoratedValue:function(_,D){this._values||(this._values=[]),"object"===typeof _&&"icaltype"in _?(this.jCal[f+D]=this._undecorate(_),this._values[D]=_):(this.jCal[f+D]=_,this._values[D]=this._decorate(_))},getParameter:function(_){return _ in this.jCal[l]?this.jCal[l][_]:void 0},setParameter:function(_,D){var g=_.toLowerCase();"string"===typeof D&&g in this._designSet.param&&"multiValue"in this._designSet.param[g]&&(D=[D]),this.jCal[l][_]=D},removeParameter:function(_){delete this.jCal[l][_]},getDefaultType:function(){var _=this.jCal[u],D=this._designSet;if(_ in D.property){var g=D.property[_];if("defaultType"in g)return g.defaultType}return T.defaultType},resetType:function(_){this.removeAllValues(),this.jCal[c]=_,this._updateType()},getFirstValue:function(){return this._hydrateValue(0)},getValues:function(){var _=this.jCal.length-f;if(1>_)return[];for(var D=0,g=[];D<_;D++)g[D]=this._hydrateValue(D);return g},removeAllValues:function(){this._values&&(this._values.length=0),this.jCal.length=3},setValues:function(_){if(!this.isMultiValue)throw new Error(this.name+": does not not support mulitValue.\noverride isMultiValue");var D=_.length,g=0;if(this.removeAllValues(),0<D&&"object"===typeof _[0]&&"icaltype"in _[0]&&this.resetType(_[0].icaltype),this.isDecorated)for(;g<D;g++)this._setDecoratedValue(_[g],g);else for(;g<D;g++)this.jCal[f+g]=_[g]},setValue:function(_){this.removeAllValues(),"object"===typeof _&&"icaltype"in _&&this.resetType(_.icaltype),this.isDecorated?this._setDecoratedValue(_,0):this.jCal[f]=_},toJSON:function(){return this.jCal},toICALString:function(){return ICAL.stringify.property(this.jCal,this._designSet,!0)}},n.fromString=function(_,D){return new n(ICAL.parse.property(_,D))},n}(),ICAL.UtcOffset=function(){function n(u){this.fromData(u)}return n.prototype={hours:0,minutes:0,factor:1,icaltype:"utc-offset",clone:function(){return ICAL.UtcOffset.fromSeconds(this.toSeconds())},fromData:function(u){if(u)for(var l in u)u.hasOwnProperty(l)&&(this[l]=u[l]);this._normalize()},fromSeconds:function(u){var l=Math.abs(u);return this.factor=0>u?-1:1,this.hours=ICAL.helpers.trunc(l/3600),l-=3600*this.hours,this.minutes=ICAL.helpers.trunc(l/60),this},toSeconds:function(){return this.factor*(60*this.minutes+3600*this.hours)},compare:function(l){var c=this.toSeconds(),f=l.toSeconds();return(c>f)-(f>c)},_normalize:function(){for(var u=this.toSeconds(),l=this.factor;-43200>u;)u+=97200;for(;50400<u;)u-=97200;this.fromSeconds(u),0==u&&(this.factor=l)},toICALString:function(){return ICAL.design.icalendar.value["utc-offset"].toICAL(this.toString())},toString:function(){return(1==this.factor?"+":"-")+ICAL.helpers.pad2(this.hours)+":"+ICAL.helpers.pad2(this.minutes)}},n.fromString=function(u){var l={factor:"+"===u[0]?1:-1,hours:ICAL.helpers.strictParseInt(u.substr(1,2)),minutes:ICAL.helpers.strictParseInt(u.substr(4,2))};return new ICAL.UtcOffset(l)},n.fromSeconds=function(u){var l=new n;return l.fromSeconds(u),l},n}(),ICAL.Binary=function(){function n(u){this.value=u}return n.prototype={icaltype:"binary",decodeValue:function(){return this._b64_decode(this.value)},setEncodedValue:function(l){this.value=this._b64_encode(l)},_b64_encode:function(l){var f,T,_,D,g,O,A,N,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=0,I=0,C="",S=[];if(!l)return l;do f=l.charCodeAt(E++),T=l.charCodeAt(E++),_=l.charCodeAt(E++),N=f<<16|T<<8|_,D=63&N>>18,g=63&N>>12,O=63&N>>6,A=63&N,S[I++]=c.charAt(D)+c.charAt(g)+c.charAt(O)+c.charAt(A);while(E<l.length);C=S.join("");var P=l.length%3;return(P?C.slice(0,P-3):C)+"===".slice(P||3)},_b64_decode:function(l){var f,T,_,D,g,O,A,N,c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",E=0,I=0,C="",S=[];if(!l)return l;l+="";do D=c.indexOf(l.charAt(E++)),g=c.indexOf(l.charAt(E++)),O=c.indexOf(l.charAt(E++)),A=c.indexOf(l.charAt(E++)),N=D<<18|g<<12|O<<6|A,f=255&N>>16,T=255&N>>8,_=255&N,S[I++]=64==O?String.fromCharCode(f):64==A?String.fromCharCode(f,T):String.fromCharCode(f,T,_);while(E<l.length);return C=S.join(""),C},toString:function(){return this.value}},n.fromString=function(u){return new n(u)},n}(),function(){ICAL.Period=function(u){if(this.wrappedJSObject=this,u&&"start"in u){if(u.start&&!(u.start instanceof ICAL.Time))throw new TypeError(".start must be an instance of ICAL.Time");this.start=u.start}if(u&&u.end&&u.duration)throw new Error("cannot accept both end and duration");if(u&&"end"in u){if(u.end&&!(u.end instanceof ICAL.Time))throw new TypeError(".end must be an instance of ICAL.Time");this.end=u.end}if(u&&"duration"in u){if(u.duration&&!(u.duration instanceof ICAL.Duration))throw new TypeError(".duration must be an instance of ICAL.Duration");this.duration=u.duration}},ICAL.Period.prototype={start:null,end:null,duration:null,icalclass:"icalperiod",icaltype:"period",clone:function(){return ICAL.Period.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})},getDuration:function(){return this.duration?this.duration:this.end.subtractDate(this.start)},getEnd:function(){if(this.end)return this.end;var n=this.start.clone();return n.addDuration(this.duration),n},toString:function(){return this.start+"/"+(this.end||this.duration)},toJSON:function(){return[this.start.toString(),(this.end||this.duration).toString()]},toICALString:function(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}},ICAL.Period.fromString=function(u,l){var c=u.split("/");if(2!==c.length)throw new Error("Invalid string value: \""+u+"\" must contain a \"/\" char.");var f={start:ICAL.Time.fromDateTimeString(c[0],l)},T=c[1];return ICAL.Duration.isValueString(T)?f.duration=ICAL.Duration.fromString(T):f.end=ICAL.Time.fromDateTimeString(T,l),new ICAL.Period(f)},ICAL.Period.fromData=function(u){return new ICAL.Period(u)},ICAL.Period.fromJSON=function(n,u){return ICAL.Duration.isValueString(n[1])?ICAL.Period.fromData({start:ICAL.Time.fromDateTimeString(n[0],u),duration:ICAL.Duration.fromString(n[1])}):ICAL.Period.fromData({start:ICAL.Time.fromDateTimeString(n[0],u),end:ICAL.Time.fromDateTimeString(n[1],u)})}}(),function(){function n(l,c,f){var T;switch(l){case"P":f.isNegative=c&&"-"===c;break;case"D":T="days";break;case"W":T="weeks";break;case"H":T="hours";break;case"M":T="minutes";break;case"S":T="seconds";break;default:return 0;}if(T){if(!c&&0!==c)throw new Error("invalid duration value: Missing number before \""+l+"\"");var _=parseInt(c,10);if(ICAL.helpers.isStrictlyNaN(_))throw new Error("invalid duration value: Invalid number \""+c+"\" before \""+l+"\"");f[T]=_}return 1}var u=/([PDWHMTS]{1,1})/;ICAL.Duration=function(c){this.wrappedJSObject=this,this.fromData(c)},ICAL.Duration.prototype={weeks:0,days:0,hours:0,minutes:0,seconds:0,isNegative:!1,icalclass:"icalduration",icaltype:"duration",clone:function(){return ICAL.Duration.fromData(this)},toSeconds:function(){var c=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+604800*this.weeks;return this.isNegative?-c:c},fromSeconds:function(c){var f=Math.abs(c);return this.isNegative=0>c,this.days=ICAL.helpers.trunc(f/86400),0==this.days%7?(this.weeks=this.days/7,this.days=0):this.weeks=0,f-=86400*(this.days+7*this.weeks),this.hours=ICAL.helpers.trunc(f/3600),f-=3600*this.hours,this.minutes=ICAL.helpers.trunc(f/60),f-=60*this.minutes,this.seconds=f,this},fromData:function(c){var f=["weeks","days","hours","minutes","seconds","isNegative"];for(var T in f)if(f.hasOwnProperty(T)){var _=f[T];this[_]=c&&_ in c?c[_]:0}},reset:function(){this.isNegative=!1,this.weeks=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0},compare:function(c){var f=this.toSeconds(),T=c.toSeconds();return(f>T)-(f<T)},normalize:function(){this.fromSeconds(this.toSeconds())},toString:function(){if(0==this.toSeconds())return"PT0S";var c="";return this.isNegative&&(c+="-"),c+="P",this.weeks&&(c+=this.weeks+"W"),this.days&&(c+=this.days+"D"),(this.hours||this.minutes||this.seconds)&&(c+="T",this.hours&&(c+=this.hours+"H"),this.minutes&&(c+=this.minutes+"M"),this.seconds&&(c+=this.seconds+"S")),c},toICALString:function(){return this.toString()}},ICAL.Duration.fromSeconds=function(c){return new ICAL.Duration().fromSeconds(c)},ICAL.Duration.isValueString=function(l){return"P"===l[0]||"P"===l[1]},ICAL.Duration.fromString=function(c){for(var f=0,T=Object.create(null),_=0;-1!==(f=c.search(u));){var D=c[f],g=c.substr(0,f);c=c.substr(f+1),_+=n(D,g,T)}if(2>_)throw new Error("invalid duration value: Not enough duration components in \""+c+"\"");return new ICAL.Duration(T)},ICAL.Duration.fromData=function(c){return new ICAL.Duration(c)}}(),function(){var n=["tzid","location","tznames","latitude","longitude"];ICAL.Timezone=function(l){this.wrappedJSObject=this,this.fromData(l)},ICAL.Timezone.prototype={tzid:"",location:"",tznames:"",latitude:0,longitude:0,component:null,expandedUntilYear:0,icalclass:"icaltimezone",fromData:function(l){if(this.expandedUntilYear=0,this.changes=[],l instanceof ICAL.Component)this.component=l;else{if(l&&"component"in l)if("string"==typeof l.component){var c=ICAL.parse(l.component);this.component=new ICAL.Component(c)}else this.component=l.component instanceof ICAL.Component?l.component:null;for(var f in n)if(n.hasOwnProperty(f)){var T=n[f];l&&T in l&&(this[T]=l[T])}}return this.component instanceof ICAL.Component&&!this.tzid&&(this.tzid=this.component.getFirstPropertyValue("tzid")),this},utcOffset:function(l){if(this==ICAL.Timezone.utcTimezone||this==ICAL.Timezone.localTimezone)return 0;if(this._ensureCoverage(l.year),!this.changes.length)return 0;for(var D,c={year:l.year,month:l.month,day:l.day,hour:l.hour,minute:l.minute,second:l.second},f=this._findNearbyChange(c),T=-1,_=1;;){D=ICAL.helpers.clone(this.changes[f],!0),D.utcOffset<D.prevUtcOffset?ICAL.Timezone.adjust_change(D,0,0,0,D.utcOffset):ICAL.Timezone.adjust_change(D,0,0,0,D.prevUtcOffset);var g=ICAL.Timezone._compare_change_fn(c,D);if(0<=g?T=f:_=-1,-1==_&&-1!=T)break;if(f+=_,0>f)return 0;if(f>=this.changes.length)break}var O=this.changes[T],A=O.utcOffset-O.prevUtcOffset;if(0>A&&0<T){var N=ICAL.helpers.clone(O,!0);if(ICAL.Timezone.adjust_change(N,0,0,0,N.prevUtcOffset),0>ICAL.Timezone._compare_change_fn(c,N)){var E=this.changes[T-1],I=!1;O.is_daylight!=I&&E.is_daylight==I&&(O=E)}}return O.utcOffset},_findNearbyChange:function(l){var c=ICAL.helpers.binsearchInsert(this.changes,l,ICAL.Timezone._compare_change_fn);return c>=this.changes.length?this.changes.length-1:c},_ensureCoverage:function(u){if(-1==ICAL.Timezone._minimumExpansionYear){var l=ICAL.Time.now();ICAL.Timezone._minimumExpansionYear=l.year}var c=u;if(c<ICAL.Timezone._minimumExpansionYear&&(c=ICAL.Timezone._minimumExpansionYear),c+=ICAL.Timezone.EXTRA_COVERAGE,c>ICAL.Timezone.MAX_YEAR&&(c=ICAL.Timezone.MAX_YEAR),!this.changes.length||this.expandedUntilYear<u){for(var f=this.component.getAllSubcomponents(),T=f.length,_=0;_<T;_++)this._expandComponent(f[_],c,this.changes);this.changes.sort(ICAL.Timezone._compare_change_fn),this.expandedUntilYear=c}},_expandComponent:function(u,l,c){function f(S){return S.factor*(3600*S.hours+60*S.minutes)}function T(){var S={is_daylight:"daylight"==u.name,utcOffset:f(u.getFirstProperty("tzoffsetto").getFirstValue()),prevUtcOffset:f(u.getFirstProperty("tzoffsetfrom").getFirstValue())};return S}if(!u.hasProperty("dtstart")||!u.hasProperty("tzoffsetto")||!u.hasProperty("tzoffsetfrom"))return null;var _=u.getFirstProperty("dtstart").getFirstValue(),D;if(!u.hasProperty("rrule")&&!u.hasProperty("rdate"))D=T(),D.year=_.year,D.month=_.month,D.day=_.day,D.hour=_.hour,D.minute=_.minute,D.second=_.second,ICAL.Timezone.adjust_change(D,0,0,0,-D.prevUtcOffset),c.push(D);else{var g=u.getAllProperties("rdate");for(var O in g)if(g.hasOwnProperty(O)){var A=g[O],N=A.getFirstValue();D=T(),D.year=N.year,D.month=N.month,D.day=N.day,N.isDate?(D.hour=_.hour,D.minute=_.minute,D.second=_.second,_.zone!=ICAL.Timezone.utcTimezone&&ICAL.Timezone.adjust_change(D,0,0,0,-D.prevUtcOffset)):(D.hour=N.hour,D.minute=N.minute,D.second=N.second,N.zone!=ICAL.Timezone.utcTimezone&&ICAL.Timezone.adjust_change(D,0,0,0,-D.prevUtcOffset)),c.push(D)}var E=u.getFirstProperty("rrule");if(E){E=E.getFirstValue(),D=T(),E.until&&E.until.zone==ICAL.Timezone.utcTimezone&&(E.until.adjust(0,0,0,D.prevUtcOffset),E.until.zone=ICAL.Timezone.localTimezone);for(var C,I=E.iterator(_);(C=I.next())&&(D=T(),!(C.year>l)&&C);)D.year=C.year,D.month=C.month,D.day=C.day,D.hour=C.hour,D.minute=C.minute,D.second=C.second,D.isDate=C.isDate,ICAL.Timezone.adjust_change(D,0,0,0,-D.prevUtcOffset),c.push(D)}}return c},toString:function(){return this.tznames?this.tznames:this.tzid}},ICAL.Timezone._compare_change_fn=function(l,c){if(l.year<c.year)return-1;return l.year>c.year?1:l.month<c.month?-1:l.month>c.month?1:l.day<c.day?-1:l.day>c.day?1:l.hour<c.hour?-1:l.hour>c.hour?1:l.minute<c.minute?-1:l.minute>c.minute?1:l.second<c.second?-1:l.second>c.second?1:0},ICAL.Timezone.convert_time=function(l,c,f){if(l.isDate||c.tzid==f.tzid||c==ICAL.Timezone.localTimezone||f==ICAL.Timezone.localTimezone)return l.zone=f,l;var T=c.utcOffset(l);return l.adjust(0,0,0,-T),T=f.utcOffset(l),l.adjust(0,0,0,T),null},ICAL.Timezone.fromData=function(l){var c=new ICAL.Timezone;return c.fromData(l)},ICAL.Timezone.utcTimezone=ICAL.Timezone.fromData({tzid:"UTC"}),ICAL.Timezone.localTimezone=ICAL.Timezone.fromData({tzid:"floating"}),ICAL.Timezone.adjust_change=function(l,c,f,T,_){return ICAL.Time.prototype.adjust.call(l,c,f,T,_,l)},ICAL.Timezone._minimumExpansionYear=-1,ICAL.Timezone.MAX_YEAR=2035,ICAL.Timezone.EXTRA_COVERAGE=5}(),ICAL.TimezoneService=function(){var n,u={reset:function(){n=Object.create(null);var l=ICAL.Timezone.utcTimezone;n.Z=l,n.UTC=l,n.GMT=l},has:function(l){return!!n[l]},get:function(l){return n[l]},register:function(l,c){if(l instanceof ICAL.Component&&"vtimezone"===l.name&&(c=new ICAL.Timezone(l),l=c.tzid),c instanceof ICAL.Timezone)n[l]=c;else throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component")},remove:function(l){return delete n[l]}};return u.reset(),u}(),function(){ICAL.Time=function(u,l){this.wrappedJSObject=this;var c=this._time=Object.create(null);c.year=0,c.month=1,c.day=1,c.hour=0,c.minute=0,c.second=0,c.isDate=!1,this.fromData(u,l)},ICAL.Time._dowCache={},ICAL.Time._wnCache={},ICAL.Time.prototype={icalclass:"icaltime",_cachedUnixTime:null,get icaltype(){return this.isDate?"date":"date-time"},zone:null,_pendingNormalization:!1,clone:function(){return new ICAL.Time(this._time,this.zone)},reset:function(){this.fromData(ICAL.Time.epochTime),this.zone=ICAL.Timezone.utcTimezone},resetTo:function(u,l,c,f,T,_,D){this.fromData({year:u,month:l,day:c,hour:f,minute:T,second:_,zone:D})},fromJSDate:function(u,l){return u?l?(this.zone=ICAL.Timezone.utcTimezone,this.year=u.getUTCFullYear(),this.month=u.getUTCMonth()+1,this.day=u.getUTCDate(),this.hour=u.getUTCHours(),this.minute=u.getUTCMinutes(),this.second=u.getUTCSeconds()):(this.zone=ICAL.Timezone.localTimezone,this.year=u.getFullYear(),this.month=u.getMonth()+1,this.day=u.getDate(),this.hour=u.getHours(),this.minute=u.getMinutes(),this.second=u.getSeconds()):this.reset(),this._cachedUnixTime=null,this},fromData:function(u,l){if(u)for(var c in u)if(Object.prototype.hasOwnProperty.call(u,c)){if("icaltype"===c)continue;this[c]=u[c]}if(l&&(this.zone=l),u&&!("isDate"in u)?this.isDate=!("hour"in u):u&&"isDate"in u&&(this.isDate=u.isDate),u&&"timezone"in u){var f=ICAL.TimezoneService.get(u.timezone);this.zone=f||ICAL.Timezone.localTimezone}return u&&"zone"in u&&(this.zone=u.zone),this.zone||(this.zone=ICAL.Timezone.localTimezone),this._cachedUnixTime=null,this},dayOfWeek:function(){var u=(this.year<<9)+(this.month<<5)+this.day;if(u in ICAL.Time._dowCache)return ICAL.Time._dowCache[u];var l=this.day,c=this.month+(3>this.month?12:0),f=this.year-(3>this.month?1:0),T=l+f+ICAL.helpers.trunc(26*(c+1)/10)+ICAL.helpers.trunc(f/4);return T+=6*ICAL.helpers.trunc(f/100)+ICAL.helpers.trunc(f/400),T=(T+6)%7+1,ICAL.Time._dowCache[u]=T,T},dayOfYear:function(){var u=ICAL.Time.isLeapYear(this.year)?1:0,l=ICAL.Time.daysInYearPassedMonth;return l[u][this.month-1]+this.day},startOfWeek:function(u){var l=u||ICAL.Time.SUNDAY,c=this.clone();return c.day-=(this.dayOfWeek()+7-l)%7,c.isDate=!0,c.hour=0,c.minute=0,c.second=0,c},endOfWeek:function(u){var l=u||ICAL.Time.SUNDAY,c=this.clone();return c.day+=(7-this.dayOfWeek()+l-ICAL.Time.SUNDAY)%7,c.isDate=!0,c.hour=0,c.minute=0,c.second=0,c},startOfMonth:function(){var u=this.clone();return u.day=1,u.isDate=!0,u.hour=0,u.minute=0,u.second=0,u},endOfMonth:function(){var u=this.clone();return u.day=ICAL.Time.daysInMonth(u.month,u.year),u.isDate=!0,u.hour=0,u.minute=0,u.second=0,u},startOfYear:function(){var u=this.clone();return u.day=1,u.month=1,u.isDate=!0,u.hour=0,u.minute=0,u.second=0,u},endOfYear:function(){var u=this.clone();return u.day=31,u.month=12,u.isDate=!0,u.hour=0,u.minute=0,u.second=0,u},startDoyWeek:function(u){var l=u||ICAL.Time.SUNDAY,c=this.dayOfWeek()-l;return 0>c&&(c+=7),this.dayOfYear()-c},getDominicalLetter:function(){return ICAL.Time.getDominicalLetter(this.year)},nthWeekDay:function(u,l){var f,c=ICAL.Time.daysInMonth(this.month,this.year),T=l,_=0,D=this.clone();if(0<=T){D.day=1,0!=T&&T--,_=D.day;var g=D.dayOfWeek(),O=u-g;0>O&&(O+=7),_+=O,_-=u,f=u}else{D.day=c;var A=D.dayOfWeek();T++,f=A-u,0>f&&(f+=7),f=c-f}return f+=7*T,_+f},isNthWeekDay:function(n,u){var l=this.dayOfWeek();if(0===u&&l===n)return!0;var c=this.nthWeekDay(n,u);return!(c!==this.day)},weekNumber:function(u){var l=(this.year<<12)+(this.month<<8)+(this.day<<3)+u;if(l in ICAL.Time._wnCache)return ICAL.Time._wnCache[l];var c,f=this.clone();f.isDate=!0;var T=this.year;12==f.month&&25<f.day?(c=ICAL.Time.weekOneStarts(T+1,u),0>f.compare(c)?c=ICAL.Time.weekOneStarts(T,u):T++):(c=ICAL.Time.weekOneStarts(T,u),0>f.compare(c)&&(c=ICAL.Time.weekOneStarts(--T,u)));var _=f.subtractDate(c).toSeconds()/86400,D=ICAL.helpers.trunc(_/7)+1;return ICAL.Time._wnCache[l]=D,D},addDuration:function(u){var l=u.isNegative?-1:1,c=this.second,f=this.minute,T=this.hour,_=this.day;c+=l*u.seconds,f+=l*u.minutes,T+=l*u.hours,_+=l*u.days,_+=7*l*u.weeks,this.second=c,this.minute=f,this.hour=T,this.day=_,this._cachedUnixTime=null},subtractDate:function(u){var l=this.toUnixTime()+this.utcOffset(),c=u.toUnixTime()+u.utcOffset();return ICAL.Duration.fromSeconds(l-c)},subtractDateTz:function(u){var l=this.toUnixTime(),c=u.toUnixTime();return ICAL.Duration.fromSeconds(l-c)},compare:function(u){var l=this.toUnixTime(),c=u.toUnixTime();return l>c?1:c>l?-1:0},compareDateOnlyTz:function(u,l){function c(D){return ICAL.Time._cmp_attr(f,T,D)}var f=this.convertToZone(l),T=u.convertToZone(l),_=0;return 0==(_=c("year"))?0==(_=c("month"))?0==(_=c("day"))?_:_:_:_},convertToZone:function(u){var l=this.clone(),c=this.zone.tzid==u.tzid;return this.isDate||c||ICAL.Timezone.convert_time(l,this.zone,u),l.zone=u,l},utcOffset:function(){return this.zone==ICAL.Timezone.localTimezone||this.zone==ICAL.Timezone.utcTimezone?0:this.zone.utcOffset(this)},toICALString:function(){var n=this.toString();return 10<n.length?ICAL.design.icalendar.value["date-time"].toICAL(n):ICAL.design.icalendar.value.date.toICAL(n)},toString:function(){var u=this.year+"-"+ICAL.helpers.pad2(this.month)+"-"+ICAL.helpers.pad2(this.day);return this.isDate||(u+="T"+ICAL.helpers.pad2(this.hour)+":"+ICAL.helpers.pad2(this.minute)+":"+ICAL.helpers.pad2(this.second),this.zone===ICAL.Timezone.utcTimezone&&(u+="Z")),u},toJSDate:function(){return this.zone==ICAL.Timezone.localTimezone?this.isDate?new Date(this.year,this.month-1,this.day):new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0):new Date(1e3*this.toUnixTime())},_normalize:function(){this._time.isDate;return this._time.isDate&&(this._time.hour=0,this._time.minute=0,this._time.second=0),this.adjust(0,0,0,0),this},adjust:function(u,l,c,f,T){var _,D,A,N,E,I,C,g=0,O=0,S=T||this._time;if(S.isDate||(A=S.second+f,S.second=A%60,_=ICAL.helpers.trunc(A/60),0>S.second&&(S.second+=60,_--),N=S.minute+c+_,S.minute=N%60,D=ICAL.helpers.trunc(N/60),0>S.minute&&(S.minute+=60,D--),E=S.hour+l+D,S.hour=E%24,g=ICAL.helpers.trunc(E/24),0>S.hour&&(S.hour+=24,g--)),12<S.month?O=ICAL.helpers.trunc((S.month-1)/12):1>S.month&&(O=ICAL.helpers.trunc(S.month/12)-1),S.year+=O,S.month-=12*O,I=S.day+u+g,0<I)for(;;){if(C=ICAL.Time.daysInMonth(S.month,S.year),I<=C)break;S.month++,12<S.month&&(S.year++,S.month=1),I-=C}else for(;0>=I;)1==S.month?(S.year--,S.month=12):S.month--,I+=ICAL.Time.daysInMonth(S.month,S.year);return S.day=I,this._cachedUnixTime=null,this},fromUnixTime:function(u){this.zone=ICAL.Timezone.utcTimezone;var l=ICAL.Time.epochTime.clone();l.adjust(0,0,0,u),this.year=l.year,this.month=l.month,this.day=l.day,this.hour=l.hour,this.minute=l.minute,this.second=Math.floor(l.second),this._cachedUnixTime=null},toUnixTime:function(){if(null!==this._cachedUnixTime)return this._cachedUnixTime;var u=this.utcOffset(),l=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-u);return this._cachedUnixTime=l/1e3,this._cachedUnixTime},toJSON:function(){for(var f,n=["year","month","day","hour","minute","second","isDate"],u=Object.create(null),l=0,c=n.length;l<c;l++)f=n[l],u[f]=this[f];return this.zone&&(u.timezone=this.zone.tzid),u}},function(){function u(l){Object.defineProperty(ICAL.Time.prototype,l,{get:function(){return this._pendingNormalization&&(this._normalize(),this._pendingNormalization=!1),this._time[l]},set:function(f){return this._cachedUnixTime=null,this._pendingNormalization=!0,this._time[l]=f,f}})}"defineProperty"in Object&&(u("year"),u("month"),u("day"),u("hour"),u("minute"),u("second"),u("isDate"))}(),ICAL.Time.daysInMonth=function(u,l){var f=30;return 1>u||12<u?f:(f=[0,31,28,31,30,31,30,31,31,30,31,30,31][u],2==u&&(f+=ICAL.Time.isLeapYear(l)),f)},ICAL.Time.isLeapYear=function(u){return 1752>=u?0==u%4:0==u%4&&0!=u%100||0==u%400},ICAL.Time.fromDayOfYear=function(u,l){var c=l,f=u,T=new ICAL.Time;T.auto_normalize=!1;var _=ICAL.Time.isLeapYear(c)?1:0;if(1>f)return c--,_=ICAL.Time.isLeapYear(c)?1:0,f+=ICAL.Time.daysInYearPassedMonth[_][12],ICAL.Time.fromDayOfYear(f,c);if(f>ICAL.Time.daysInYearPassedMonth[_][12])return _=ICAL.Time.isLeapYear(c)?1:0,f-=ICAL.Time.daysInYearPassedMonth[_][12],c++,ICAL.Time.fromDayOfYear(f,c);T.year=c,T.isDate=!0;for(var D=11;0<=D;D--)if(f>ICAL.Time.daysInYearPassedMonth[_][D]){T.month=D+1,T.day=f-ICAL.Time.daysInYearPassedMonth[_][D];break}return T.auto_normalize=!0,T},ICAL.Time.fromStringv2=function(u){return new ICAL.Time({year:parseInt(u.substr(0,4),10),month:parseInt(u.substr(5,2),10),day:parseInt(u.substr(8,2),10),isDate:!0})},ICAL.Time.fromDateString=function(n){return new ICAL.Time({year:ICAL.helpers.strictParseInt(n.substr(0,4)),month:ICAL.helpers.strictParseInt(n.substr(5,2)),day:ICAL.helpers.strictParseInt(n.substr(8,2)),isDate:!0})},ICAL.Time.fromDateTimeString=function(n,u){if(19>n.length)throw new Error("invalid date-time value: \""+n+"\"");var l;n[19]&&"Z"===n[19]?l="Z":u&&(l=u.getParameter("tzid"));var c=new ICAL.Time({year:ICAL.helpers.strictParseInt(n.substr(0,4)),month:ICAL.helpers.strictParseInt(n.substr(5,2)),day:ICAL.helpers.strictParseInt(n.substr(8,2)),hour:ICAL.helpers.strictParseInt(n.substr(11,2)),minute:ICAL.helpers.strictParseInt(n.substr(14,2)),second:ICAL.helpers.strictParseInt(n.substr(17,2)),timezone:l});return c},ICAL.Time.fromString=function(u){return 10<u.length?ICAL.Time.fromDateTimeString(u):ICAL.Time.fromDateString(u)},ICAL.Time.fromJSDate=function(u,l){var c=new ICAL.Time;return c.fromJSDate(u,l)},ICAL.Time.fromData=function(u,l){var c=new ICAL.Time;return c.fromData(u,l)},ICAL.Time.now=function(){return ICAL.Time.fromJSDate(new Date,!1)},ICAL.Time.weekOneStarts=function(u,l){var c=ICAL.Time.fromData({year:u,month:1,day:1,isDate:!0}),f=c.dayOfWeek(),T=l||ICAL.Time.DEFAULT_WEEK_START;return f>ICAL.Time.THURSDAY&&(c.day+=7),T>ICAL.Time.THURSDAY&&(c.day-=7),c.day-=f-T,c},ICAL.Time.getDominicalLetter=function(n){var u="GFEDCBA",l=(n+(0|n/4)+(0|n/400)-(0|n/100)-1)%7,c=ICAL.Time.isLeapYear(n);return c?u[(l+6)%7]+u[l]:u[l]},ICAL.Time.epochTime=ICAL.Time.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"}),ICAL.Time._cmp_attr=function(u,l,c){return u[c]>l[c]?1:u[c]<l[c]?-1:0},ICAL.Time.daysInYearPassedMonth=[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]],ICAL.Time.SUNDAY=1,ICAL.Time.MONDAY=2,ICAL.Time.TUESDAY=3,ICAL.Time.WEDNESDAY=4,ICAL.Time.THURSDAY=5,ICAL.Time.FRIDAY=6,ICAL.Time.SATURDAY=7,ICAL.Time.DEFAULT_WEEK_START=ICAL.Time.MONDAY}(),function(){ICAL.VCardTime=function(n,u,l){this.wrappedJSObject=this;var c=this._time=Object.create(null);c.year=null,c.month=null,c.day=null,c.hour=null,c.minute=null,c.second=null,this.icaltype=l||"date-and-or-time",this.fromData(n,u)},ICAL.helpers.inherits(ICAL.Time,ICAL.VCardTime,{icalclass:"vcardtime",icaltype:"date-and-or-time",zone:null,clone:function(){return new ICAL.VCardTime(this._time,this.zone,this.icaltype)},_normalize:function(){return this},utcOffset:function(){return this.zone instanceof ICAL.UtcOffset?this.zone.toSeconds():ICAL.Time.prototype.utcOffset.apply(this,arguments)},toICALString:function(){return ICAL.design.vcard.value[this.icaltype].toICAL(this.toString())},toString:function(){var u=ICAL.helpers.pad2,l=this.year,c=this.month,f=this.day,T=this.hour,_=this.minute,D=this.second,O=null!==c,A=null!==f,N=null!==T,E=null!==_,I=null!==D,C=(null!==l?u(l)+(O||A?"-":""):O||A?"--":"")+(O?u(c):"")+(A?"-"+u(f):""),S=(N?u(T):"-")+(N&&E?":":"")+(E?u(_):"")+(N||E?"":"-")+(E&&I?":":"")+(I?u(D):""),P;if(this.zone===ICAL.Timezone.utcTimezone)P="Z";else if(this.zone instanceof ICAL.UtcOffset)P=this.zone.toString();else if(this.zone===ICAL.Timezone.localTimezone)P="";else if(this.zone instanceof ICAL.Timezone){var B=ICAL.UtcOffset.fromSeconds(this.zone.utcOffset(this));P=B.toString()}else P="";switch(this.icaltype){case"time":return S+P;case"date-and-or-time":case"date-time":return C+("--"==S?"":"T"+S+P);case"date":return C;}return null}}),ICAL.VCardTime.fromDateAndOrTimeString=function(n,u){function l(S,P,B){return S?ICAL.helpers.strictParseInt(S.substr(P,B)):null}var c=n.split("T"),f=c[0],T=c[1],_=T?ICAL.design.vcard.value.time._splitZone(T):[],D=_[0],g=_[1],O=ICAL.helpers.strictParseInt,A=f?f.length:0,N=g?g.length:0,E=f&&"-"==f[0]&&"-"==f[1],I=g&&"-"==g[0],C={year:E?null:l(f,0,4),month:E&&(4==A||7==A)?l(f,2,2):7==A?l(f,5,2):10==A?l(f,5,2):null,day:5==A?l(f,3,2):7==A&&E?l(f,5,2):10==A?l(f,8,2):null,hour:I?null:l(g,0,2),minute:I&&3==N?l(g,1,2):4<N?I?l(g,1,2):l(g,3,2):null,second:4==N?l(g,2,2):6==N?l(g,4,2):8==N?l(g,6,2):null};return D="Z"==D?ICAL.Timezone.utcTimezone:D&&":"==D[3]?ICAL.UtcOffset.fromString(D):null,new ICAL.VCardTime(C,D,u)}}(),function(){function n(A,N,E,I){var C=I;if("+"===I[0]&&(C=I.substr(1)),C=ICAL.helpers.strictParseInt(C),void 0!==N&&I<N)throw new Error(A+": invalid value \""+I+"\" must be > "+N);if(void 0!==E&&I>E)throw new Error(A+": invalid value \""+I+"\" must be < "+N);return C}var u={SU:ICAL.Time.SUNDAY,MO:ICAL.Time.MONDAY,TU:ICAL.Time.TUESDAY,WE:ICAL.Time.WEDNESDAY,TH:ICAL.Time.THURSDAY,FR:ICAL.Time.FRIDAY,SA:ICAL.Time.SATURDAY},l={};for(var c in u)u.hasOwnProperty(c)&&(l[u[c]]=c);ICAL.Recur=function(N){this.wrappedJSObject=this,this.parts={},N&&"object"===typeof N&&this.fromData(N)},ICAL.Recur.prototype={parts:null,interval:1,wkst:ICAL.Time.MONDAY,until:null,count:null,freq:null,icalclass:"icalrecur",icaltype:"recur",iterator:function(A){return new ICAL.RecurIterator({rule:this,dtstart:A})},clone:function(){return new ICAL.Recur(this.toJSON())},isFinite:function(){return!!(this.count||this.until)},isByCount:function(){return!(!this.count||this.until)},addComponent:function(N,E){var I=N.toUpperCase();I in this.parts?this.parts[I].push(E):this.parts[I]=[E]},setComponent:function(N,E){this.parts[N.toUpperCase()]=E.slice()},getComponent:function(N){var E=N.toUpperCase();return E in this.parts?this.parts[E].slice():[]},getNextOccurrence:function(N,E){var C,I=this.iterator(N);do C=I.next();while(C&&0>=C.compare(E));return C&&E.zone&&(C.zone=E.zone),C},fromData:function(A){for(var N in A){var E=N.toUpperCase();E in O?Array.isArray(A[N])?this.parts[E]=A[N]:this.parts[E]=[A[N]]:this[N]=A[N]}this.wkst&&"number"!=typeof this.wkst&&(this.wkst=ICAL.Recur.icalDayToNumericDay(this.wkst)),this.until&&!(this.until instanceof ICAL.Time)&&(this.until=ICAL.Time.fromString(this.until))},toJSON:function(){var A=Object.create(null);for(var N in A.freq=this.freq,this.count&&(A.count=this.count),1<this.interval&&(A.interval=this.interval),this.parts)if(this.parts.hasOwnProperty(N)){var E=this.parts[N];A[N.toLowerCase()]=Array.isArray(E)&&1==E.length?E[0]:ICAL.helpers.clone(this.parts[N])}return this.until&&(A.until=this.until.toString()),"wkst"in this&&this.wkst!==ICAL.Time.DEFAULT_WEEK_START&&(A.wkst=ICAL.Recur.numericDayToIcalDay(this.wkst)),A},toString:function(){var N="FREQ="+this.freq;for(var E in this.count&&(N+=";COUNT="+this.count),1<this.interval&&(N+=";INTERVAL="+this.interval),this.parts)this.parts.hasOwnProperty(E)&&(N+=";"+E+"="+this.parts[E]);return this.until&&(N+=";UNTIL="+this.until.toString()),"wkst"in this&&this.wkst!==ICAL.Time.DEFAULT_WEEK_START&&(N+=";WKST="+ICAL.Recur.numericDayToIcalDay(this.wkst)),N}},ICAL.Recur.icalDayToNumericDay=function(N){return u[N]},ICAL.Recur.numericDayToIcalDay=function(N){return l[N]};var T=/^(SU|MO|TU|WE|TH|FR|SA)$/,_=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,D=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"],g={FREQ:function(A,N){if(-1!==D.indexOf(A))N.freq=A;else throw new Error("invalid frequency \""+A+"\" expected: \""+D.join(", ")+"\"")},COUNT:function(A,N){N.count=ICAL.helpers.strictParseInt(A)},INTERVAL:function(A,N){N.interval=ICAL.helpers.strictParseInt(A),1>N.interval&&(N.interval=1)},UNTIL:function(A,N,E){N.until=E?10<A.length?ICAL.design.icalendar.value["date-time"].fromICAL(A):ICAL.design.icalendar.value.date.fromICAL(A):ICAL.Time.fromString(A)},WKST:function(A,N){if(T.test(A))N.wkst=ICAL.Recur.icalDayToNumericDay(A);else throw new Error("invalid WKST value \""+A+"\"")}},O={BYSECOND:n.bind(this,"BYSECOND",0,60),BYMINUTE:n.bind(this,"BYMINUTE",0,59),BYHOUR:n.bind(this,"BYHOUR",0,23),BYDAY:function(A){if(_.test(A))return A;throw new Error("invalid BYDAY value \""+A+"\"")},BYMONTHDAY:n.bind(this,"BYMONTHDAY",-31,31),BYYEARDAY:n.bind(this,"BYYEARDAY",-366,366),BYWEEKNO:n.bind(this,"BYWEEKNO",-53,53),BYMONTH:n.bind(this,"BYMONTH",0,12),BYSETPOS:n.bind(this,"BYSETPOS",-366,366)};ICAL.Recur.fromString=function(A){var N=ICAL.Recur._stringToData(A,!1);return new ICAL.Recur(N)},ICAL.Recur.fromData=function(A){return new ICAL.Recur(A)},ICAL.Recur._stringToData=function(A,N){for(var E=Object.create(null),I=A.split(";"),C=I.length,S=0;S<C;S++){var P=I[S].split("="),B=P[0].toUpperCase(),z=P[0].toLowerCase(),M=N?z:B,L=P[1];if(B in O){for(var R=L.split(","),w=0,U=R.length;w<U;w++)R[w]=O[B](R[w]);E[M]=1==R.length?R[0]:R}else B in g?g[B](L,E,N):E[z]=L}return E}}(),ICAL.RecurIterator=function(){function n(u){this.fromData(u)}return n.prototype={completed:!1,rule:null,dtstart:null,last:null,occurrence_number:0,by_indices:null,initialized:!1,by_data:null,days:null,days_index:0,fromData:function(u){if(this.rule=ICAL.helpers.formatClassType(u.rule,ICAL.Recur),!this.rule)throw new Error("iterator requires a (ICAL.Recur) rule");if(this.dtstart=ICAL.helpers.formatClassType(u.dtstart,ICAL.Time),!this.dtstart)throw new Error("iterator requires a (ICAL.Time) dtstart");this.by_data=u.by_data?u.by_data:ICAL.helpers.clone(this.rule.parts,!0),u.occurrence_number&&(this.occurrence_number=u.occurrence_number),this.days=u.days||[],u.last&&(this.last=ICAL.helpers.formatClassType(u.last,ICAL.Time)),this.by_indices=u.by_indices,this.by_indices||(this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}),this.initialized=u.initialized||!1,this.initialized||this.init()},init:function(){this.initialized=!0,this.last=this.dtstart.clone();var l=this.by_data;if("BYDAY"in l&&this.sort_byday_rules(l.BYDAY,this.rule.wkst),"BYYEARDAY"in l&&("BYMONTH"in l||"BYWEEKNO"in l||"BYMONTHDAY"in l||"BYDAY"in l))throw new Error("Invalid BYYEARDAY rule");if("BYWEEKNO"in l&&"BYMONTHDAY"in l)throw new Error("BYWEEKNO does not fit to BYMONTHDAY");if("MONTHLY"==this.rule.freq&&("BYYEARDAY"in l||"BYWEEKNO"in l))throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear");if("WEEKLY"==this.rule.freq&&("BYYEARDAY"in l||"BYMONTHDAY"in l))throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear");if("YEARLY"!=this.rule.freq&&"BYYEARDAY"in l)throw new Error("BYYEARDAY may only appear in YEARLY rules");if(this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second),this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute),this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour),this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day),this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month),"WEEKLY"==this.rule.freq)if("BYDAY"in l){var c=this.ruleDayOfWeek(l.BYDAY[0]),f=c[0],T=c[1],_=T-this.last.dayOfWeek();(this.last.dayOfWeek()<T&&0<=_||0>_)&&(this.last.day+=_)}else{var D=ICAL.Recur.numericDayToIcalDay(this.dtstart.dayOfWeek());l.BYDAY=[D]}if("YEARLY"==this.rule.freq){for(;;){if(this.expand_year_days(this.last.year),0<this.days.length)break;this.increment_year(this.rule.interval)}this._nextByYearDay()}if("MONTHLY"==this.rule.freq&&this.has_by_data("BYDAY")){var g=null,O=this.last.clone(),A=ICAL.Time.daysInMonth(this.last.month,this.last.year);for(var N in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(N)){this.last=O.clone();var c=this.ruleDayOfWeek(this.by_data.BYDAY[N]),f=c[0],T=c[1],E=this.last.nthWeekDay(T,f);if(6<=f||-6>=f)throw new Error("Malformed values in BYDAY part");if(E>A||0>=E){if(g&&g.month==O.month)continue;for(;E>A||0>=E;)this.increment_month(),A=ICAL.Time.daysInMonth(this.last.month,this.last.year),E=this.last.nthWeekDay(T,f)}this.last.day=E,(!g||0>this.last.compare(g))&&(g=this.last.clone())}if(this.last=g.clone(),this.has_by_data("BYMONTHDAY")&&this._byDayAndMonthDay(!0),this.last.day>A||0==this.last.day)throw new Error("Malformed values in BYDAY part")}else if(this.has_by_data("BYMONTHDAY")&&0>this.last.day){var A=ICAL.Time.daysInMonth(this.last.month,this.last.year);this.last.day=A+this.last.day+1}},next:function(){var l=this.last?this.last.clone():null;if(this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&0<this.last.compare(this.rule.until))return this.completed=!0,null;if(0==this.occurrence_number&&0<=this.last.compare(this.dtstart))return this.occurrence_number++,this.last;var c;do switch(c=1,this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":c=this.next_month();break;case"YEARLY":this.next_year();break;default:return null;}while(!this.check_contracting_rules()||0>this.last.compare(this.dtstart)||!c);if(0==this.last.compare(l))throw new Error("Same occurrence found twice, protecting you from death by recursion");return this.rule.until&&0<this.last.compare(this.rule.until)?(this.completed=!0,null):(this.occurrence_number++,this.last)},next_second:function(){return this.next_generic("BYSECOND","SECONDLY","second","minute")},increment_second:function(l){return this.increment_generic(l,"second",60,"minute")},next_minute:function(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")},increment_minute:function(l){return this.increment_generic(l,"minute",60,"hour")},next_hour:function(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")},increment_hour:function(l){this.increment_generic(l,"hour",24,"monthday")},next_day:function(){var l="BYDAY"in this.by_data,c="DAILY"==this.rule.freq;return 0==this.next_hour()?0:(c?this.increment_monthday(this.rule.interval):this.increment_monthday(1),0)},next_week:function(){var l=0;if(0==this.next_weekday_by_week())return l;if(this.has_by_data("BYWEEKNO")){++this.by_indices.BYWEEKNO;this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length&&(this.by_indices.BYWEEKNO=0,l=1),this.last.month=1,this.last.day=1;var f=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*f,l&&this.increment_year(1)}else this.increment_monthday(7*this.rule.interval);return l},normalizeByMonthDayRules:function(u,l,c){for(var g,f=ICAL.Time.daysInMonth(l,u),T=[],_=0,D=c.length;_<D;_++)if(g=c[_],!(Math.abs(g)>f)){if(0>g)g=f+(g+1);else if(0===g)continue;-1===T.indexOf(g)&&T.push(g)}return T.sort(function(O,A){return O-A})},_byDayAndMonthDay:function(u){function l(){for(N=ICAL.Time.daysInMonth(E.last.month,E.last.year),f=E.normalizeByMonthDayRules(E.last.year,E.last.month,E.by_data.BYMONTHDAY),g=f.length;f[D]<=I&&!(u&&f[D]==I)&&D<g-1;)D++}function c(){I=0,E.increment_month(),D=0,l()}var f,_,g,N,T=this.by_data.BYDAY,D=0,O=T.length,A=0,E=this,I=this.last.day;l(),u&&(I-=1);for(var C=48;!A&&C;){if(C--,_=I+1,_>N){c();continue}var S=f[D++];if(S>=_)I=S;else{c();continue}for(var P=0;P<O;P++){var B=this.ruleDayOfWeek(T[P]),z=B[0],M=B[1];if(this.last.day=I,this.last.isNthWeekDay(M,z)){A=1;break}}if(!A&&D===g){c();continue}}if(0>=C)throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts");return A},next_month:function(){var l="MONTHLY"==this.rule.freq,c=1;if(0==this.next_hour())return c;if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY"))c=this._byDayAndMonthDay();else if(this.has_by_data("BYDAY")){var f=ICAL.Time.daysInMonth(this.last.month,this.last.year),T=0,_=0;if(this.has_by_data("BYSETPOS")){for(var D=this.last.day,g=1;g<=f;g++)this.last.day=g,this.is_day_in_byday(this.last)&&(_++,g<=D&&T++);this.last.day=D}c=0;for(var g=this.last.day+1;g<=f;g++)if(this.last.day=g,this.is_day_in_byday(this.last)&&(!this.has_by_data("BYSETPOS")||this.check_set_position(++T)||this.check_set_position(T-_-1))){c=1;break}g>f&&(this.last.day=1,this.increment_month(),this.is_day_in_byday(this.last)?(!this.has_by_data("BYSETPOS")||this.check_set_position(1))&&(c=1):c=0)}else if(this.has_by_data("BYMONTHDAY")){this.by_indices.BYMONTHDAY++,this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length&&(this.by_indices.BYMONTHDAY=0,this.increment_month());var f=ICAL.Time.daysInMonth(this.last.month,this.last.year),g=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];0>g&&(g=f+g+1),g>f?(this.last.day=1,c=this.is_day_in_byday(this.last)):this.last.day=g}else{this.increment_month();var f=ICAL.Time.daysInMonth(this.last.month,this.last.year);this.by_data.BYMONTHDAY[0]>f?c=0:this.last.day=this.by_data.BYMONTHDAY[0]}return c},next_weekday_by_week:function(){var l=0;if(0==this.next_hour())return l;if(!this.has_by_data("BYDAY"))return 1;for(;;){var c=new ICAL.Time;this.by_indices.BYDAY++,this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length&&(this.by_indices.BYDAY=0,l=1);var f=this.by_data.BYDAY[this.by_indices.BYDAY],T=this.ruleDayOfWeek(f),_=T[1];_-=this.rule.wkst,0>_&&(_+=7),c.year=this.last.year,c.month=this.last.month,c.day=this.last.day;var D=c.startDoyWeek(this.rule.wkst);if(!(1>_+D)||l){var g=ICAL.Time.fromDayOfYear(D+_,this.last.year);return this.last.year=g.year,this.last.month=g.month,this.last.day=g.day,l}}},next_year:function(){if(0==this.next_hour())return 0;if(++this.days_index==this.days.length){this.days_index=0;do this.increment_year(this.rule.interval),this.expand_year_days(this.last.year);while(0==this.days.length)}return this._nextByYearDay(),1},_nextByYearDay:function(){var l=this.days[this.days_index],c=this.last.year;1>l&&(l+=1,c+=1);var f=ICAL.Time.fromDayOfYear(l,c);this.last.day=f.day,this.last.month=f.month},ruleDayOfWeek:function(l){var c=l.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(c){var f=parseInt(c[1]||0,10);return l=ICAL.Recur.icalDayToNumericDay(c[2]),[f,l]}return[0,0]},next_generic:function(l,c,f,T,_){var D=l in this.by_data,g=this.rule.freq==c,O=0;if(_&&0==this[_]())return O;if(D){this.by_indices[l]++;var A=this.by_indices[l],N=this.by_data[l];this.by_indices[l]==N.length&&(this.by_indices[l]=0,O=1),this.last[f]=N[this.by_indices[l]]}else g&&this["increment_"+f](this.rule.interval);return D&&O&&g&&this["increment_"+T](1),O},increment_monthday:function(l){for(var f,c=0;c<l;c++)f=ICAL.Time.daysInMonth(this.last.month,this.last.year),this.last.day++,this.last.day>f&&(this.last.day-=f,this.increment_month())},increment_month:function(){if(this.last.day=1,this.has_by_data("BYMONTH"))this.by_indices.BYMONTH++,this.by_indices.BYMONTH==this.by_data.BYMONTH.length&&(this.by_indices.BYMONTH=0,this.increment_year(1)),this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH];else{"MONTHLY"==this.rule.freq?this.last.month+=this.rule.interval:this.last.month++,this.last.month--;var l=ICAL.helpers.trunc(this.last.month/12);this.last.month%=12,this.last.month++,0!=l&&this.increment_year(l)}},increment_year:function(l){this.last.year+=l},increment_generic:function(l,c,f,T){this.last[c]+=l;var _=ICAL.helpers.trunc(this.last[c]/f);this.last[c]%=f,0!=_&&this["increment_"+T](_)},has_by_data:function(l){return l in this.rule.parts},expand_year_days:function(l){var c=new ICAL.Time;this.days=[];var f={},T=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(var _ in T)if(T.hasOwnProperty(_)){var D=T[_];D in this.rule.parts&&(f[D]=this.rule.parts[D])}if("BYMONTH"in f&&"BYWEEKNO"in f){var g=1,O={};c.year=l,c.isDate=!0;for(var N,A=0;A<this.by_data.BYMONTH.length;A++){N=this.by_data.BYMONTH[A],c.month=N,c.day=1;var E=c.weekNumber(this.rule.wkst);c.day=ICAL.Time.daysInMonth(N,l);var I=c.weekNumber(this.rule.wkst);for(A=E;A<I;A++)O[A]=1}for(var S,C=0;C<this.by_data.BYWEEKNO.length&&g;C++)S=this.by_data.BYWEEKNO[C],52>S?g&=O[C]:g=0;g?delete f.BYMONTH:delete f.BYWEEKNO}var P=Object.keys(f).length;if(0==P){var B=this.dtstart.clone();B.year=this.last.year,this.days.push(B.dayOfYear())}else if(1==P&&"BYMONTH"in f){for(var z in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(z)){var M=this.dtstart.clone();M.year=l,M.month=this.by_data.BYMONTH[z],M.isDate=!0,this.days.push(M.dayOfYear())}}else if(1==P&&"BYMONTHDAY"in f){for(var L in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(L)){var R=this.dtstart.clone(),w=this.by_data.BYMONTHDAY[L];if(0>w){var U=ICAL.Time.daysInMonth(R.month,l);w=w+U+1}R.day=w,R.year=l,R.isDate=!0,this.days.push(R.dayOfYear())}}else if(2==P&&"BYMONTHDAY"in f&&"BYMONTH"in f){for(var z in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(z)){var V=this.by_data.BYMONTH[z],U=ICAL.Time.daysInMonth(V,l);for(var L in this.by_data.BYMONTHDAY)if(this.by_data.BYMONTHDAY.hasOwnProperty(L)){var w=this.by_data.BYMONTHDAY[L];0>w&&(w=w+U+1),c.day=w,c.month=V,c.year=l,c.isDate=!0,this.days.push(c.dayOfYear())}}}else if(1==P&&"BYWEEKNO"in f);else if(2==P&&"BYWEEKNO"in f&&"BYMONTHDAY"in f);else if(1==P&&"BYDAY"in f)this.days=this.days.concat(this.expand_by_day(l));else if(2==P&&"BYDAY"in f&&"BYMONTH"in f){for(var z in this.by_data.BYMONTH)if(this.by_data.BYMONTH.hasOwnProperty(z)){var N=this.by_data.BYMONTH[z],U=ICAL.Time.daysInMonth(N,l);c.year=l,c.month=this.by_data.BYMONTH[z],c.day=1,c.isDate=!0;var H=c.dayOfWeek(),W=c.dayOfYear()-1;c.day=U;var K=c.dayOfWeek();if(this.has_by_data("BYSETPOS")){for(var J=[],Z=1;Z<=U;Z++)c.day=Z,this.is_day_in_byday(c)&&J.push(Z);for(var G=0;G<J.length;G++)(this.check_set_position(G+1)||this.check_set_position(G-J.length))&&this.days.push(W+J[G])}else for(var Q in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(Q)){var ne,$=this.by_data.BYDAY[Q],ee=this.ruleDayOfWeek($),te=ee[0],ae=ee[1],re=(ae+7-H)%7+1;if(0==te)for(var Z=re;Z<=U;Z+=7)this.days.push(W+Z);else 0<te?(ne=re+7*(te-1),ne<=U&&this.days.push(W+ne)):(ne=U-(K+7-ae)%7+7*(te+1),0<ne&&this.days.push(W+ne))}}this.days.sort(function(ue,le){return ue-le})}else if(2==P&&"BYDAY"in f&&"BYMONTHDAY"in f){var ie=this.expand_by_day(l);for(var se in ie)if(ie.hasOwnProperty(se)){var Z=ie[se],de=ICAL.Time.fromDayOfYear(Z,l);0<=this.by_data.BYMONTHDAY.indexOf(de.day)&&this.days.push(Z)}}else if(3==P&&"BYDAY"in f&&"BYMONTHDAY"in f&&"BYMONTH"in f){var ie=this.expand_by_day(l);for(var se in ie)if(ie.hasOwnProperty(se)){var Z=ie[se],de=ICAL.Time.fromDayOfYear(Z,l);0<=this.by_data.BYMONTH.indexOf(de.month)&&0<=this.by_data.BYMONTHDAY.indexOf(de.day)&&this.days.push(Z)}}else if(2==P&&"BYDAY"in f&&"BYWEEKNO"in f){var ie=this.expand_by_day(l);for(var se in ie)if(ie.hasOwnProperty(se)){var Z=ie[se],de=ICAL.Time.fromDayOfYear(Z,l),S=de.weekNumber(this.rule.wkst);this.by_data.BYWEEKNO.indexOf(S)&&this.days.push(Z)}}else if(3==P&&"BYDAY"in f&&"BYWEEKNO"in f&&"BYMONTHDAY"in f);else this.days=1==P&&"BYYEARDAY"in f?this.days.concat(this.by_data.BYYEARDAY):[];return 0},expand_by_day:function(l){var c=[],f=this.last.clone();f.year=l,f.month=1,f.day=1,f.isDate=!0;var T=f.dayOfWeek();f.month=12,f.day=31,f.isDate=!0;var _=f.dayOfWeek(),D=f.dayOfYear();for(var g in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(g)){var O=this.by_data.BYDAY[g],A=this.ruleDayOfWeek(O),N=A[0],E=A[1];if(0==N)for(var C=(E+7-T)%7+1;C<=D;C+=7)c.push(C);else if(0<N){var S;S=E>=T?E-T+1:E-T+8,c.push(S+7*(N-1))}else{var P;N=-N,P=E<=_?D-_+E:D-_+E-7,c.push(P-7*(N-1))}}return c},is_day_in_byday:function(l){for(var c in this.by_data.BYDAY)if(this.by_data.BYDAY.hasOwnProperty(c)){var f=this.by_data.BYDAY[c],T=this.ruleDayOfWeek(f),_=T[0],D=T[1],g=l.dayOfWeek();if(0==_&&D==g||l.nthWeekDay(D,_)==l.day)return 1}return 0},check_set_position:function(l){if(this.has_by_data("BYSETPOS")){var c=this.by_data.BYSETPOS.indexOf(l);return-1!==c}return!1},sort_byday_rules:function(l,c){for(var f=0;f<l.length;f++)for(var T=0;T<f;T++){var _=this.ruleDayOfWeek(l[T])[1],D=this.ruleDayOfWeek(l[f])[1];if(_-=c,D-=c,0>_&&(_+=7),0>D&&(D+=7),_>D){var g=l[f];l[f]=l[T],l[T]=g}}},check_contract_restriction:function(l,c){var f=n._indexMap[l],T=n._expandMap[this.rule.freq][f],_=!1;if(l in this.by_data&&T==n.CONTRACT){var D=this.by_data[l];for(var g in D)if(D.hasOwnProperty(g)&&D[g]==c){_=!0;break}}else _=!0;return _},check_contracting_rules:function(){var l=this.last.dayOfWeek(),c=this.last.weekNumber(this.rule.wkst),f=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",ICAL.Recur.numericDayToIcalDay(l))&&this.check_contract_restriction("BYWEEKNO",c)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",f)},setup_defaults:function(l,c,f){var T=n._indexMap[l],_=n._expandMap[this.rule.freq][T];return _!=n.CONTRACT&&(l in this.by_data||(this.by_data[l]=[f]),this.rule.freq!=c)?this.by_data[l][0]:f},toJSON:function(){var u=Object.create(null);return u.initialized=this.initialized,u.rule=this.rule.toJSON(),u.dtstart=this.dtstart.toJSON(),u.by_data=this.by_data,u.days=this.days,u.last=this.last.toJSON(),u.by_indices=this.by_indices,u.occurrence_number=this.occurrence_number,u}},n._indexMap={BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8},n._expandMap={SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]},n.UNKNOWN=0,n.CONTRACT=1,n.EXPAND=2,n.ILLEGAL=3,n}(),ICAL.RecurExpansion=function(){function n(f){return ICAL.helpers.formatClassType(f,ICAL.Time)}function u(f,T){return f.compare(T)}function l(f){return f.hasProperty("rdate")||f.hasProperty("rrule")||f.hasProperty("recurrence-id")}function c(f){this.ruleDates=[],this.exDates=[],this.fromData(f)}return c.prototype={complete:!1,ruleIterators:null,ruleDates:null,exDates:null,ruleDateInc:0,exDateInc:0,exDate:null,ruleDate:null,dtstart:null,last:null,fromData:function(f){var T=ICAL.helpers.formatClassType(f.dtstart,ICAL.Time);if(!T)throw new Error(".dtstart (ICAL.Time) must be given");else this.dtstart=T;if(f.component)this._init(f.component);else{if(this.last=n(f.last)||T.clone(),!f.ruleIterators)throw new Error(".ruleIterators or .component must be given");this.ruleIterators=f.ruleIterators.map(function(_){return ICAL.helpers.formatClassType(_,ICAL.RecurIterator)}),this.ruleDateInc=f.ruleDateInc,this.exDateInc=f.exDateInc,f.ruleDates&&(this.ruleDates=f.ruleDates.map(n),this.ruleDate=this.ruleDates[this.ruleDateInc]),f.exDates&&(this.exDates=f.exDates.map(n),this.exDate=this.exDates[this.exDateInc]),"undefined"!==typeof f.complete&&(this.complete=f.complete)}},next:function(){for(var f,_,D,O=0;;){if(O++>500)throw new Error("max tries have occured, rule may be impossible to forfill.");if(_=this.ruleDate,f=this._nextRecurrenceIter(this.last),!_&&!f){this.complete=!0;break}if((!_||f&&0<_.compare(f.last))&&(_=f.last.clone(),f.next()),this.ruleDate===_&&this._nextRuleDay(),this.last=_,this.exDate&&(D=this.exDate.compare(this.last),0>D&&this._nextExDay(),0===D)){this._nextExDay();continue}return this.last}},toJSON:function(){function f(_){return _.toJSON()}var T=Object.create(null);return T.ruleIterators=this.ruleIterators.map(f),this.ruleDates&&(T.ruleDates=this.ruleDates.map(f)),this.exDates&&(T.exDates=this.exDates.map(f)),T.ruleDateInc=this.ruleDateInc,T.exDateInc=this.exDateInc,T.last=this.last.toJSON(),T.dtstart=this.dtstart.toJSON(),T.complete=this.complete,T},_extractDates:function(f,T){function _(I){E=ICAL.helpers.binsearchInsert(D,I,u),D.splice(E,0,I)}for(var E,D=[],g=f.getAllProperties(T),O=g.length,A=0;A<O;A++)g[A].getValues().forEach(_);return D},_init:function(f){if(this.ruleIterators=[],this.last=this.dtstart.clone(),!l(f))return this.ruleDate=this.last.clone(),void(this.complete=!0);if(f.hasProperty("rdate")&&(this.ruleDates=this._extractDates(f,"rdate"),this.ruleDates[0]&&0>this.ruleDates[0].compare(this.dtstart)?(this.ruleDateInc=0,this.last=this.ruleDates[0].clone()):this.ruleDateInc=ICAL.helpers.binsearchInsert(this.ruleDates,this.last,u),this.ruleDate=this.ruleDates[this.ruleDateInc]),f.hasProperty("rrule"))for(var g,O,T=f.getAllProperties("rrule"),_=0,D=T.length;_<D;_++)g=T[_].getFirstValue(),O=g.iterator(this.dtstart),this.ruleIterators.push(O),O.next();f.hasProperty("exdate")&&(this.exDates=this._extractDates(f,"exdate"),this.exDateInc=ICAL.helpers.binsearchInsert(this.exDates,this.last,u),this.exDate=this.exDates[this.exDateInc])},_nextExDay:function(){this.exDate=this.exDates[++this.exDateInc]},_nextRuleDay:function(){this.ruleDate=this.ruleDates[++this.ruleDateInc]},_nextRecurrenceIter:function(){var f=this.ruleIterators;if(0===f.length)return null;for(var _,D,O,T=f.length,g=0;g<T;g++){if(_=f[g],D=_.last,_.completed){T--,0!==g&&g--,f.splice(g,1);continue}(!O||0<O.last.compare(D))&&(O=_)}return O}},c}(),ICAL.Event=function(){function n(l,c){l instanceof ICAL.Component||(c=l,l=null),this.component=l?l:new ICAL.Component("vevent"),this._rangeExceptionCache=Object.create(null),this.exceptions=Object.create(null),this.rangeExceptions=[],c&&c.strictExceptions&&(this.strictExceptions=c.strictExceptions),c&&c.exceptions&&c.exceptions.forEach(this.relateException,this)}function u(l,c){return l[0]>c[0]?1:c[0]>l[0]?-1:0}return n.prototype={THISANDFUTURE:"THISANDFUTURE",exceptions:null,strictExceptions:!1,relateException:function(l){if(this.isRecurrenceException())throw new Error("cannot relate exception to exceptions");if(l instanceof ICAL.Component&&(l=new ICAL.Event(l)),this.strictExceptions&&l.uid!==this.uid)throw new Error("attempted to relate unrelated exception");var c=l.recurrenceId.toString();if(this.exceptions[c]=l,l.modifiesFuture()){var f=[l.recurrenceId.toUnixTime(),c],T=ICAL.helpers.binsearchInsert(this.rangeExceptions,f,u);this.rangeExceptions.splice(T,0,f)}},modifiesFuture:function(){var l=this.component.getFirstPropertyValue("range");return l===this.THISANDFUTURE},findRangeException:function(l){if(!this.rangeExceptions.length)return null;var c=l.toUnixTime(),f=ICAL.helpers.binsearchInsert(this.rangeExceptions,[c],u);if(f-=1,0>f)return null;var T=this.rangeExceptions[f];return c<T[0]?null:T[1]},getOccurrenceDetails:function(l){var T,c=l.toString(),f=l.convertToZone(ICAL.Timezone.utcTimezone).toString(),_={recurrenceId:l};if(c in this.exceptions)T=_.item=this.exceptions[c],_.startDate=T.startDate,_.endDate=T.endDate,_.item=T;else if(f in this.exceptions)T=this.exceptions[f],_.startDate=T.startDate,_.endDate=T.endDate,_.item=T;else{var g,D=this.findRangeException(l);if(D){var O=this.exceptions[D];_.item=O;var A=this._rangeExceptionCache[D];if(!A){var N=O.recurrenceId.clone(),E=O.startDate.clone();N.zone=E.zone,A=E.subtractDate(N),this._rangeExceptionCache[D]=A}var I=l.clone();I.zone=O.startDate.zone,I.addDuration(A),g=I.clone(),g.addDuration(O.duration),_.startDate=I,_.endDate=g}else g=l.clone(),g.addDuration(this.duration),_.endDate=g,_.startDate=l,_.item=this}return _},iterator:function(l){return new ICAL.RecurExpansion({component:this.component,dtstart:l||this.startDate})},isRecurring:function(){var l=this.component;return l.hasProperty("rrule")||l.hasProperty("rdate")},isRecurrenceException:function(){return this.component.hasProperty("recurrence-id")},getRecurrenceTypes:function(){for(var _,l=this.component.getAllProperties("rrule"),c=0,f=l.length,T=Object.create(null);c<f;c++)_=l[c].getFirstValue(),T[_.freq]=!0;return T},get uid(){return this._firstProp("uid")},set uid(l){this._setProp("uid",l)},get startDate(){return this._firstProp("dtstart")},set startDate(l){this._setTime("dtstart",l)},get endDate(){var l=this._firstProp("dtend");if(!l){var c=this._firstProp("duration");l=this.startDate.clone(),c?l.addDuration(c):l.isDate&&(l.day+=1)}return l},set endDate(l){this._setTime("dtend",l)},get duration(){var l=this._firstProp("duration");return l?l:this.endDate.subtractDate(this.startDate)},get location(){return this._firstProp("location")},set location(l){return this._setProp("location",l)},get attendees(){return this.component.getAllProperties("attendee")},get summary(){return this._firstProp("summary")},set summary(l){this._setProp("summary",l)},get description(){return this._firstProp("description")},set description(l){this._setProp("description",l)},get organizer(){return this._firstProp("organizer")},set organizer(l){this._setProp("organizer",l)},get sequence(){return this._firstProp("sequence")},set sequence(l){this._setProp("sequence",l)},get recurrenceId(){return this._firstProp("recurrence-id")},set recurrenceId(l){this._setProp("recurrence-id",l)},_setTime:function(l,c){var f=this.component.getFirstProperty(l);f||(f=new ICAL.Property(l),this.component.addProperty(f)),c.zone===ICAL.Timezone.localTimezone||c.zone===ICAL.Timezone.utcTimezone?f.removeParameter("tzid"):f.setParameter("tzid",c.zone.tzid),f.setValue(c)},_setProp:function(l,c){this.component.updatePropertyWithValue(l,c)},_firstProp:function(l){return this.component.getFirstPropertyValue(l)},toString:function(){return this.component.toString()}},n}(),ICAL.ComponentParser=function(){function n(u){"undefined"===typeof u&&(u={});for(var l in u)u.hasOwnProperty(l)&&(this[l]=u[l])}return n.prototype={parseEvent:!0,parseTimezone:!0,oncomplete:function(){},onerror:function(){},ontimezone:function(){},onevent:function(){},process:function(u){"string"===typeof u&&(u=ICAL.parse(u)),u instanceof ICAL.Component||(u=new ICAL.Component(u));for(var T,l=u.getAllSubcomponents(),c=0,f=l.length;c<f;c++)switch(T=l[c],T.name){case"vtimezone":if(this.parseTimezone){var _=T.getFirstPropertyValue("tzid");_&&this.ontimezone(new ICAL.Timezone({tzid:_,component:T}))}break;case"vevent":this.parseEvent&&this.onevent(new ICAL.Event(T));break;default:continue;}this.oncomplete()}},n}();