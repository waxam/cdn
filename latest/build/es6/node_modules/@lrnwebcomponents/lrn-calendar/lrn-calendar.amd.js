define(["exports","meta","./node_modules/@polymer/polymer/polymer-legacy.js","./node_modules/@polymer/polymer/lib/legacy/polymer.dom.js","./node_modules/@polymer/polymer/lib/utils/resolve-url.js","./node_modules/@polymer/paper-button/paper-button.js","./node_modules/@polymer/iron-icons/iron-icons.js","./node_modules/@polymer/iron-icon/iron-icon.js","./node_modules/@polymer/paper-card/paper-card.js","./node_modules/@polymer/iron-ajax/iron-ajax.js","./node_modules/@polymer/paper-menu-button/paper-menu-button.js","./node_modules/@polymer/paper-dropdown-menu/paper-dropdown-menu.js","./node_modules/@lrnwebcomponents/materializecss-styles/lib/colors.js","./node_modules/@lrnwebcomponents/hax-body-behaviors/lib/HAXWiring.js","./node_modules/@lrnwebcomponents/lrnsys-layout/lrnsys-layout.js","./node_modules/@lrnwebcomponents/lrnsys-layout/lib/lrnsys-drawer.js","./node_modules/@lrnwebcomponents/lrnsys-layout/lib/lrnsys-dialog.js","./node_modules/@lrnwebcomponents/lrnsys-layout/lib/lrnsys-collapselist.js","./node_modules/@lrnwebcomponents/lrnsys-layout/lib/lrnsys-collapselist-item.js","./node_modules/@lrnwebcomponents/es-global-bridge/es-global-bridge.js","./lib/lrn-calendar-date.js"],function(a,b,c,d,e){"use strict";function w(){var y=babelHelpers.taggedTemplateLiteral(["\n    <style>\n      :host {\n        display: block;\n      }\n      lrn-calendar-date {\n        display: inline-table;\n        top: 0px;\n      }\n      paper-card {\n        width: 14%;\n        height: 20px;\n        display: inline-table;\n        padding: 0;\n        margin: 0;\n      }\n      .calendar {\n        color: var(--my-toolbar-title-color);\n      }\n      .header {\n        padding-bottom: 15px;\n      }\n    </style>\n\n    <div class=\"calendar\">\n      <div class=\"header\">\n        <div style=\"float: left\">\n          <paper-button raised type=\"button\" on-tap=\"monthView\"\n            >Month</paper-button\n          >\n          <paper-button raised type=\"button\" on-tap=\"weekView\"\n            >Week</paper-button\n          >\n        </div>\n        <div style=\"float: right\">\n          <paper-button raised type=\"button\" on-tap=\"showDate\"\n            >Today</paper-button\n          >\n          <paper-button on-tap=\"showPrev\"\n            ><iron-icon icon=\"arrow-back\"></iron-icon\n          ></paper-button>\n          <paper-button on-tap=\"showNext\"\n            ><iron-icon icon=\"arrow-forward\"></iron-icon\n          ></paper-button>\n        </div>\n        <div style=\"margin: 0 auto; width: 200px; text-align: center\">\n          <h2>[[getDisplayDate(date)]]</h2>\n        </div>\n      </div>\n\n      <div class=\"calendarView\" id=\"calView\"></div>\n    </div>\n  "]);return w=function(){return y},y}Object.defineProperty(a,"__esModule",{value:!0}),a.LrnCalendar=void 0,b=babelHelpers.interopRequireWildcard(b);var x=(0,c.Polymer)({_template:(0,c.html)(w()),is:"lrn-calendar",behaviors:[HAXBehaviors.PropertiesBehaviors],properties:{listOfEvents:{type:Array,value:[]},dateString:{type:String,observer:"_dateStringChanged"},date:{type:Date,value:new Date,observer:"_dateChanged"},view:{type:String,value:"month",observer:"_viewTypeChanged"},file:{type:String,reflectToAttribute:!0,observer:"_fileChanged"}},_fileChanged:function(z){babelHelpers.typeof(z)!=="undefined"&&this.__icalLoaded&&(this.loadFile(),this.getDateInfo(),this.createCalendar())},_viewTypeChanged:function(z){babelHelpers.typeof(z)!=="undefined"&&babelHelpers.typeof(this.file)!=="undefined"&&this.__icalLoaded&&(this.getDateInfo(),this.createCalendar())},_dateChanged:function(z){babelHelpers.typeof(z)!=="undefined"&&babelHelpers.typeof(this.file)!=="undefined"&&this.__icalLoaded&&(this.getDateInfo(),this.createCalendar())},_dateStringChanged:function(z){babelHelpers.typeof(z)!=="undefined"&&""!=z&&this.__icalLoaded&&(this.date=new Date(z))},created:function(){var z="ical",A=(0,e.pathFromUrl)(b.url),B="".concat(A,"lib/ical.js/build/ical.js");window.addEventListener("es-bridge-".concat(z,"-loaded"),this._icalLoaded.bind(this)),window.ESGlobalBridge.requestAvailability(),window.ESGlobalBridge.instance.load(z,B)},_icalLoaded:function(){this.__icalLoaded=!0,babelHelpers.typeof(this.file)!=="undefined"&&this.loadFile()},attached:function(){this.setHaxProperties({canScale:!1,canPosition:!1,canEditSource:!1,gizmo:{title:"Calendar",description:"Present dates.",icon:"icons:today",color:"grey",groups:["Date"],handles:[{type:"ical",source:"file",date:"date"}],meta:{author:"LRNWebComponents"}},settings:{quick:[{property:"file",title:"iCal feed",description:"Calendar feed to display",inputMethod:"textfield",icon:"link",required:!0}],configure:[{property:"file",title:"iCal feed",description:"Calendar feed to display",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"},{property:"view",title:"View calendar in week or month format",description:"week or month view",inputMethod:"select",options:{week:"Week",month:"Month"}},{property:"dateString",title:"Date: yyyy/mm/dd",description:"Date to display calendar",inputMethod:"datepicker"}],advanced:[]}})},loadFile:function(){this.startIndex=0,this.calendarText=this.readTextFile(this.file),this.listOfEvents=this.getEvents(this.date,this.calendarText),this.listOfEvents=this.sortByTime(this.listOfEvents)},showPrev:function(){var z;if(this.startIndex=0,"month"==this.view)z=2==this.date.getMonth()?28<this.date.getDate()?new Date(this.date.getFullYear(),this.date.getMonth()-1,28):new Date(this.date.getFullYear(),this.date.getMonth()-1,this.date.getDate()):new Date(this.date.getFullYear(),this.date.getMonth()-1,this.date.getDate()),this.date=z;else{var z=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate()-7);this.date=z}this.startMonth=this.date.getMonth()+1,this.getDateInfo(),this.createCalendar()},showNext:function(){var z;if("month"==this.view)z=11==this.date.getMonth()?new Date(this.date.getFullYear()+1,0,this.date.getDate()):0==this.date.getMonth()?28<this.date.getDate()?new Date(this.date.getFullYear(),this.date.getMonth()+1,28):new Date(this.date.getFullYear(),this.date.getMonth()+1,this.date.getDate()):new Date(this.date.getFullYear(),this.date.getMonth()+1,this.date.getDate()),this.date=z;else{var z=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate()+7);this.date=z}this.getDateInfo(),this.createCalendar()},showDate:function(){this.startIndex=0,this.date=new Date,this.getDateInfo(),this.createCalendar()},monthView:function(){this.view="month",this.startIndex=0,this.createCalendar()},weekView:function(){this.view="week",this.startIndex=0,this.createCalendar()},readTextFile:function(z){this.fileNotFound=!1;var A=new XMLHttpRequest,B="";return A.open("GET",z,!1),A.onreadystatechange=function(){4===A.readyState&&(200===A.status||0==A.status?B=A.responseText:B="Not Found")},A.send(null),this.calendarText=B,B},createCalendar:function(){"month"!=this.view&&"week"!=this.view&&(this.view="month"),this.date.getFullYear()||(this.date=new Date),this.getDateInfo(),this.totalDays=7*this.numweeks,this.calendarText=this.readTextFile(this.file),this.calendarView=this.$.calView;for(var z=1,A=0,B=(0,d.dom)(this.$.calView).node,C=B.childNodes;C[1];)B.removeChild(B.childNodes[1]);var D=this.currentDayofWeek;if("week"==this.view){for(var E=0;6>this.currentDayofWeek+E;)++E;this.totalDays=E}if("month"==this.view&&(1==this.currentMonth||3==this.currentMonth||5==this.currentMonth||7==this.currentMonth||8==this.currentMonth||10==this.currentMonth||12==this.currentMonth?(this.totalDays=31,this.totalDays=this.totalDays-this.startDay+1):4==this.currentMonth||6==this.currentMonth||9==this.currentMonth||11==this.currentMonth?(this.totalDays=30,this.totalDays=this.totalDays-this.startDay+1):(this.totalDays=29,this.totalDays-=this.startDay)),this.newDate=new Date(this.currentYear+"/"+this.currentMonth+"/"+this.currentDate),"month"==this.view){for(;1!=this.currentDate;)--z,1==this.currentMonth&&1==this.currentDate?(--this.currentYear,this.currentMonth=12,this.currentDate=31,this.newDate=new Date(this.currentYear+"/"+this.currentMonth+"/"+this.currentDate)):(--this.currentDate,this.newDate=new Date(this.currentYear+"/"+this.currentMonth+"/"+this.currentDate),this.newDate.getDate()!=this.currentDate&&(0==this.currentDate&&(2==this.currentMonth||4==this.currentMonth||6==this.currentMonth||8==this.currentMonth||9==this.currentMonth||11==this.currentMonth||1==this.currentMonth)&&(this.newDate=new Date(this.currentYear+"/"+(this.currentMonth-1)+"/"+31),this.currentDate=31),0==this.currentDate&&(5==this.currentMonth||7==this.currentMonth||10==this.currentMonth||12==this.currentMonth)&&(this.newDate=new Date(this.currentYear+"/"+(this.currentMonth-1)+"/"+30),this.currentDate=30),0==this.currentDate&&3==this.currentMonth&&(this.newDate=new Date(this.currentYear+"/"+2+"/"+29),this.currentDate=29,2==this.newDate.getMonth()&&(this.newDate=new Date(this.currentYear+"/"+2+"/"+28),this.currentDate=28)),--this.currentMonth)),(0==this.currentDayofWeek||0==D)&&(this.currentDayofWeek=7,D=-1),--this.currentDayofWeek;7==this.currentDayofWeek&&(this.currentDayofWeek=0)}for(;0!=this.currentDayofWeek;)--z,1==this.currentMonth&&1==this.currentDate?(--this.currentYear,this.currentMonth=12,this.currentDate=31,this.newDate=new Date(this.currentYear+"/"+this.currentMonth+"/"+this.currentDate)):(--this.currentDate,this.newDate=new Date(this.currentYear+"/"+this.currentMonth+"/"+this.currentDate),this.newDate.getDate()!=this.currentDate&&(0==this.currentDate&&(2==this.currentMonth||4==this.currentMonth||6==this.currentMonth||8==this.currentMonth||9==this.currentMonth||11==this.currentMonth||1==this.currentMonth)&&(this.newDate=new Date(this.currentYear+"/"+(this.currentMonth-1)+"/"+31),this.currentDate=31),0==this.currentDate&&(5==this.currentMonth||7==this.currentMonth||10==this.currentMonth||12==this.currentMonth)&&(this.newDate=new Date(this.currentYear+"/"+(this.currentMonth-1)+"/"+30),this.currentDate=30),0==this.currentDate&&3==this.currentMonth&&(this.newDate=new Date(this.currentYear+"/"+2+"/"+29),this.currentDate=29,2==this.newDate.getMonth()&&(this.newDate=new Date(this.currentYear+"/"+2+"/"+28),this.currentDate=28)),--this.currentMonth)),--this.currentDayofWeek;var F=document.createElement("lrn-calendar-date");F.date=this.newDate,F.firstWeek=!0,F.style.width="14.25%",F.style.display="inline-block",F.setAttribute("id","date"),F.view=this.view,this.date.getFullYear()===this.newDate.getFullYear()&&this.date.getMonth()===this.newDate.getMonth()&&this.date.getDate()===this.newDate.getDate()&&(F.loadeddate=!0);var G=this.eventCheck(this.listOfEvents,this.newDate),H=this.createReturn(G);F.events=H,F.valid=!0,(0,d.dom)(this.calendarView).appendChild(F);for(var I=1;z<this.totalDays;){12==this.currentMonth&&31==this.currentDate?(++this.currentYear,this.currentMonth=1,this.currentDate=1,this.newDay=new Date(this.currentYear+"/"+this.currentMonth+"/"+this.currentDate)):(++this.currentDate,this.newDay=new Date(this.currentYear+"/"+this.currentMonth+"/"+this.currentDate),this.newDay.getDate()!=this.currentDate&&((1==this.currentMonth||3==this.currentMonth||5==this.currentMonth||7==this.currentMonth||8==this.currentMonth||10==this.currentMonth||12==this.currentMonth)&&(this.newDay=new Date(this.currentYear+"/"+(this.currentMonth+1)+"/"+1)),this.currentDate=1,++this.currentMonth));var F=document.createElement("lrn-calendar-date");F.valid=!0,F.setAttribute("id","date"),F.date=this.newDay,F.style.width="14.25%",F.style.display="inline-block",F.view=this.view,this.date.getFullYear()===this.newDay.getFullYear()&&this.date.getMonth()===this.newDay.getMonth()&&this.date.getDate()===this.newDay.getDate()&&(F.loadeddate=!0);var J=this.eventCheck(this.listOfEvents,this.newDay),K=this.createReturn(J);F.events=K,7>I&&(F.firstWeek=!0),++I,F.valid=!0,(0,d.dom)(this.calendarView).appendChild(F),++z,z==this.totalDays&&6!=this.newDay.getDay()&&(--z,A=1)}},getEvents:function(z,A){if("Not Found"==A)return"";var C=ICAL.parse(A),D=new ICAL.Component(C),E=D.getFirstSubcomponent("vevent"),F=D.getAllSubcomponents("vevent"),G=F.map(function(J){return event=new ICAL.Event(J),event});this.eventArray=[];for(var I,H=0;H<G.length;H++)I=this.createDate(G[H]),G[H].isRecurring()&&this.createRecurrence(G[H]),this.eventArray.push(G[H]);return this.eventArray},createRecurrence:function(z){z.getRecurrenceTypes().WEEKLY?this.createRepeatedEvent(z,156):z.getRecurrenceTypes().DAILY?this.createRepeatedEvent(z,720):z.getRecurrenceTypes().MONTHLY?this.createRepeatedEvent(z,36):z.getRecurrenceTypes().YEARLY&&this.createRepeatedEvent(z,10)},createRepeatedEvent:function(z,A){for(var C,E,B=z.iterator(z.startDate),D=0;(C=B.next())&&D++<A;){E=new ICAL.Event,E.summary=z.summary,E.description=z.description,E.startDate=z.getOccurrenceDetails(C).startDate,E.endDate=z.getOccurrenceDetails(C).endDate;var F=z.location+"";E.location=F,(E.startDate._time.day!=z.startDate._time.day||E.startDate._time.month!=z.startDate._time.month||E.startDate._time.year!=z.startDate._time.year)&&this.eventArray.push(E)}},createDate:function(z){var A=z.startDate._time.year,B=z.startDate._time.month,C=z.startDate._time.day,D=new Date(A+"/"+B+"/"+C);return D},eventCheck:function(z,A){for(var E,B=[],C=z.length,D=this.startIndex;D<C;D++)E=this.createDate(z[D]),E.getTime()>A.getTime()&&(C=D,0!=D&&(this.startIndex=D-1)),E.getTime()==A.getTime()&&B.push(z[D]);return B},sortByTime:function(z){var A;do{A=!1;for(var B=0;B<z.length-1;B++)if(z[B].startDate>z[B+1].startDate){var C=z[B];z[B]=z[B+1],z[B+1]=C,A=!0}}while(A);return z},getDateInfo:function(){return this.startMonth=this.date.getMonth()+1,this.startYear=this.date.getFullYear(),this.startDay=this.date.getDate(),this.startDayOfWeek=this.date.getDay(),this.currentDate=this.startDay,this.currentMonth=this.startMonth,this.currentYear=this.startYear,void(this.currentDayofWeek=this.startDayOfWeek)},createReturn:function(z){for(var A=[],B=0;B<z.length;B++)A.push({event:z[B]});return A},getDisplayDate:function(z){if("function"===typeof z.getMonth){var A=z.getMonth(),B=z.getDate();return["January","February","March","April","May","June","July","August","September","October","November","December"][A]+" "+z.getFullYear()}return""}});a.LrnCalendar=x});