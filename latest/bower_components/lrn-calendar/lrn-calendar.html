<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../paper-button/paper-button.html"><link rel="import" href="../iron-icons/iron-icons.html"><link rel="import" href="../materializecss-styles/colors.html"><link rel="import" href="../paper-card/paper-card.html"><link rel="import" href="../hax-body-behaviors/hax-body-behaviors.html"><link rel="import" href="../iron-ajax/iron-ajax.html"><link rel="import" href="../paper-menu-button/paper-menu-button.html"><link rel="import" href="../paper-dropdown-menu/paper-dropdown-menu.html"><link rel="import" href="../lrnsys-layout/lrnsys-layout.html"><link rel="import" href="../lrnsys-layout/lrnsys-drawer.html"><link rel="import" href="../lrnsys-layout/lrnsys-dialog.html"><link rel="import" href="../lrnsys-layout/lrnsys-collapselist.html"><link rel="import" href="../lrnsys-layout/lrnsys-collapselist-item.html"><link rel="import" href="../web-animations-js/web-animations-next.min.html"><link rel="import" href="lrn-calendar-date.html"><link rel="import" href="i-cal-js.html"><link rel="prefetch" href="../polymer/polymer-mini.html"><link rel="prefetch" href="../polymer/polymer-micro.html"><link rel="prefetch" href="../iron-flex-layout/iron-flex-layout.html"><link rel="prefetch" href="../paper-behaviors/paper-button-behavior.html"><link rel="prefetch" href="../iron-behaviors/iron-button-state.html"><link rel="prefetch" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="prefetch" href="../iron-behaviors/iron-control-state.html"><link rel="prefetch" href="../paper-behaviors/paper-ripple-behavior.html"><link rel="prefetch" href="../paper-ripple/paper-ripple.html"><link rel="prefetch" href="../paper-styles/element-styles/paper-material-styles.html"><link rel="prefetch" href="../paper-styles/shadow.html"><link rel="prefetch" href="../iron-icon/iron-icon.html"><link rel="prefetch" href="../iron-meta/iron-meta.html"><link rel="prefetch" href="../iron-iconset-svg/iron-iconset-svg.html"><link rel="prefetch" href="../iron-image/iron-image.html"><link rel="prefetch" href="../paper-styles/default-theme.html"><link rel="prefetch" href="../paper-styles/color.html"><link rel="prefetch" href="../iron-ajax/iron-request.html"><link rel="prefetch" href="../iron-dropdown/iron-dropdown.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-overlay-behavior.html"><link rel="prefetch" href="../iron-fit-behavior/iron-fit-behavior.html"><link rel="prefetch" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-overlay-manager.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-overlay-backdrop.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-scroll-manager.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-focusables-helper.html"><link rel="prefetch" href="../neon-animation/neon-animation-runner-behavior.html"><link rel="prefetch" href="../neon-animation/neon-animatable-behavior.html"><link rel="prefetch" href="../iron-dropdown/iron-dropdown-scroll-manager.html"><link rel="prefetch" href="../neon-animation/animations/fade-in-animation.html"><link rel="prefetch" href="../neon-animation/neon-animation-behavior.html"><link rel="prefetch" href="../neon-animation/animations/fade-out-animation.html"><link rel="prefetch" href="../paper-menu-button/paper-menu-button-animations.html"><link rel="prefetch" href="../iron-form-element-behavior/iron-form-element-behavior.html"><link rel="prefetch" href="../iron-validatable-behavior/iron-validatable-behavior.html"><link rel="prefetch" href="../paper-input/paper-input.html"><link rel="prefetch" href="../iron-input/iron-input.html"><link rel="prefetch" href="../iron-a11y-announcer/iron-a11y-announcer.html"><link rel="prefetch" href="../paper-input/paper-input-behavior.html"><link rel="prefetch" href="../paper-input/paper-input-char-counter.html"><link rel="prefetch" href="../paper-styles/typography.html"><link rel="prefetch" href="../font-roboto/roboto.html"><link rel="prefetch" href="../paper-input/paper-input-addon-behavior.html"><link rel="prefetch" href="../paper-input/paper-input-container.html"><link rel="prefetch" href="../paper-input/paper-input-error.html"><link rel="prefetch" href="../paper-dropdown-menu/paper-dropdown-menu-icons.html"><link rel="prefetch" href="../paper-dropdown-menu/paper-dropdown-menu-shared-styles.html"><link rel="prefetch" href="../app-layout/app-layout.html"><link rel="prefetch" href="../app-layout/helpers/helpers.html"><link rel="prefetch" href="../app-layout/app-drawer/app-drawer.html"><link rel="prefetch" href="../app-layout/app-drawer-layout/app-drawer-layout.html"><link rel="prefetch" href="../iron-media-query/iron-media-query.html"><link rel="prefetch" href="../app-layout/app-layout-behavior/app-layout-behavior.html"><link rel="prefetch" href="../app-layout/app-grid/app-grid-style.html"><link rel="prefetch" href="../app-layout/app-header/app-header.html"><link rel="prefetch" href="../app-layout/app-scroll-effects/app-scroll-effects-behavior.html"><link rel="prefetch" href="../iron-scroll-target-behavior/iron-scroll-target-behavior.html"><link rel="prefetch" href="../app-layout/app-header-layout/app-header-layout.html"><link rel="prefetch" href="../app-layout/app-toolbar/app-toolbar.html"><link rel="prefetch" href="../app-layout/app-box/app-box.html"><link rel="prefetch" href="../paper-avatar/paper-avatar.html"><link rel="prefetch" href="../paper-avatar/lib/jdenticon-1.4.0.min.js"><link rel="prefetch" href="../paper-avatar/lib/md5.min.js"><link rel="prefetch" href="../paper-tooltip/paper-tooltip.html"><link rel="prefetch" href="../lrnsys-layout/lrnsys-button-inner.html"><link rel="prefetch" href="../lrn-icons/lrn-icons.html"><link rel="prefetch" href="../lrnsys-layout/lrnsys-drawer-modal.html"><link rel="prefetch" href="../neon-animation/web-animations.html"><link rel="prefetch" href="../web-animations-js/web-animations-next-lite.min.js"><link rel="prefetch" href="../paper-icon-button/paper-icon-button.html"><link rel="prefetch" href="../paper-behaviors/paper-inky-focus-behavior.html"><link rel="prefetch" href="../paper-dialog/paper-dialog.html"><link rel="prefetch" href="../paper-dialog-behavior/paper-dialog-behavior.html"><link rel="prefetch" href="../paper-dialog-behavior/paper-dialog-shared-styles.html"><link rel="prefetch" href="../paper-dialog-scrollable/paper-dialog-scrollable.html"><link rel="prefetch" href="../neon-animation/neon-animations.html"><link rel="prefetch" href="../neon-animation/animations/cascaded-animation.html"><link rel="prefetch" href="../neon-animation/animations/hero-animation.html"><link rel="prefetch" href="../neon-animation/neon-shared-element-animation-behavior.html"><link rel="prefetch" href="../neon-animation/animations/opaque-animation.html"><link rel="prefetch" href="../neon-animation/animations/ripple-animation.html"><link rel="prefetch" href="../neon-animation/animations/reverse-ripple-animation.html"><link rel="prefetch" href="../neon-animation/animations/scale-down-animation.html"><link rel="prefetch" href="../neon-animation/animations/scale-up-animation.html"><link rel="prefetch" href="../neon-animation/animations/slide-from-left-animation.html"><link rel="prefetch" href="../neon-animation/animations/slide-from-right-animation.html"><link rel="prefetch" href="../neon-animation/animations/slide-from-top-animation.html"><link rel="prefetch" href="../neon-animation/animations/slide-from-bottom-animation.html"><link rel="prefetch" href="../neon-animation/animations/slide-left-animation.html"><link rel="prefetch" href="../neon-animation/animations/slide-right-animation.html"><link rel="prefetch" href="../neon-animation/animations/slide-up-animation.html"><link rel="prefetch" href="../neon-animation/animations/slide-down-animation.html"><link rel="prefetch" href="../neon-animation/animations/transform-animation.html"><link rel="prefetch" href="../lrnsys-layout/lrnsys-dialog-modal.html"><link rel="prefetch" href="../lrnsys-layout/lrnsys-dialog-toolbar.html"><link rel="prefetch" href="../lrnsys-layout/lrnsys-dialog-toolbar-button.html"><link rel="prefetch" href="../iron-collapse/iron-collapse.html"><link rel="prefetch" href="../web-animations-js/web-animations-next.min.js"><link rel="prefetch" href="lrn-calendar.html"><link rel="prefetch" href="ical.js"></head><body><dom-module id="lrn-calendar"><template><style>:host{display:block;}lrn-calendar-date{display:inline-table;top:0px;}paper-card{width:14%;height:20px;display:inline-table;padding:0;margin:0;}.calendar{color:var(--my-toolbar-title-color);}.header{padding-bottom:15px;}</style><div class="calendar"><div class="header"><div style="float: left"><paper-button raised="" type="button" on-tap="monthView">Month</paper-button><paper-button raised="" type="button" on-tap="weekView">Week</paper-button></div><div style="float: right"><paper-button raised="" type="button" on-tap="showDate">Today</paper-button><paper-icon-button icon="arrow-back" on-tap="showPrev"></paper-icon-button><paper-icon-button icon="arrow-forward" on-tap="showNext"></paper-icon-button></div><div style="margin: 0 auto; width: 200px; text-align: center"><h2>[[getDisplayDate(date)]]</h2></div></div><div class="calendarView" id="calView"></div></div></template><script>Polymer({is:'lrn-calendar',behaviors:[HAXBehaviors.PropertiesBehaviors],properties:{listOfEvents:{type:Array,value:[]},dateString:{type:String,observer:'_dateStringChanged'},date:{type:Date,value:new Date,observer:'_dateChanged'},view:{type:String,value:'month',observer:'_viewTypeChanged'},file:{type:String,reflectToAttribute:!0,observer:'_fileChanged'}},_fileChanged:function(a){('undefined'===typeof a?'undefined':babelHelpers.typeof(a))!=='undefined'&&(this.loadFile(),this.getDateInfo(),this.createCalendar())},_viewTypeChanged:function(a){('undefined'===typeof a?'undefined':babelHelpers.typeof(a))!=='undefined'&&babelHelpers.typeof(this.file)!=='undefined'&&(this.getDateInfo(),this.createCalendar())},_dateChanged:function(a){('undefined'===typeof a?'undefined':babelHelpers.typeof(a))!=='undefined'&&babelHelpers.typeof(this.file)!=='undefined'&&(this.getDateInfo(),this.createCalendar())},_dateStringChanged:function(a){('undefined'===typeof a?'undefined':babelHelpers.typeof(a))!=='undefined'&&''!=a&&(this.date=new Date(a))},attached:function(){this.setHaxProperties({canScale:!1,canPosition:!1,canEditSource:!1,gizmo:{title:'Calendar',description:'Present dates.',icon:'icons:today',color:'grey',groups:['Date'],handles:[{type:'ical',source:'file',date:'date'}],meta:{author:'LRNWebComponents'}},settings:{quick:[{property:'file',title:'iCal feed',description:'Calendar feed to display',inputMethod:'textfield',icon:'link',required:!0}],configure:[{property:'file',title:'iCal feed',description:'Calendar feed to display',inputMethod:'textfield',icon:'link',required:!0,validationType:'url'},{property:'view',title:'View calendar in week or month format',description:'week or month view',inputMethod:'select',options:{week:'Week',month:'Month'}},{property:'dateString',title:'Date: yyyy/mm/dd',description:'Date to display calendar',inputMethod:'datepicker'}],advanced:[]}})},loadFile:function(){this.startIndex=0,this.calendarText=this.readTextFile(this.file),this.listOfEvents=this.getEvents(this.date,this.calendarText),this.listOfEvents=this.sortByTime(this.listOfEvents)},showPrev:function(){var a;if(this.startIndex=0,'month'==this.view)a=2==this.date.getMonth()?28<this.date.getDate()?new Date(this.date.getFullYear(),this.date.getMonth()-1,28):new Date(this.date.getFullYear(),this.date.getMonth()-1,this.date.getDate()):new Date(this.date.getFullYear(),this.date.getMonth()-1,this.date.getDate()),this.date=a;else{var a=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate()-7);this.date=a}this.startMonth=this.date.getMonth()+1,this.getDateInfo(),this.createCalendar()},showNext:function(){var a;if('month'==this.view)a=11==this.date.getMonth()?new Date(this.date.getFullYear()+1,0,this.date.getDate()):0==this.date.getMonth()?28<this.date.getDate()?new Date(this.date.getFullYear(),this.date.getMonth()+1,28):new Date(this.date.getFullYear(),this.date.getMonth()+1,this.date.getDate()):new Date(this.date.getFullYear(),this.date.getMonth()+1,this.date.getDate()),this.date=a;else{var a=new Date(this.date.getFullYear(),this.date.getMonth(),this.date.getDate()+7);this.date=a}this.getDateInfo(),this.createCalendar()},showDate:function(){this.startIndex=0,this.date=new Date,this.getDateInfo(),this.createCalendar()},monthView:function(){this.view='month',this.startIndex=0,this.createCalendar()},weekView:function(){this.view='week',this.startIndex=0,this.createCalendar()},readTextFile:function(a){this.fileNotFound=!1;var b=new XMLHttpRequest,c='';return b.open('GET',a,!1),b.onreadystatechange=function(){4===b.readyState&&(200===b.status||0==b.status?c=b.responseText:c='Not Found')},b.send(null),this.calendarText=c,c},createCalendar:function(){'month'!=this.view&&'week'!=this.view&&(this.view='month'),this.date.getFullYear()||(this.date=new Date),this.getDateInfo(),this.totalDays=7*this.numweeks,this.calendarText=this.readTextFile(this.file),this.calendarView=this.querySelector('.calendarView');for(var a=1,b=0,c=Polymer.dom(this.$.calView).node,d=c.childNodes;d[1];)c.removeChild(c.childNodes[1]);var e=this.currentDayofWeek;if('week'==this.view){for(var f=0;6>this.currentDayofWeek+f;)++f;this.totalDays=f}if('month'==this.view&&(1==this.currentMonth||3==this.currentMonth||5==this.currentMonth||7==this.currentMonth||8==this.currentMonth||10==this.currentMonth||12==this.currentMonth?(this.totalDays=31,this.totalDays=this.totalDays-this.startDay+1):4==this.currentMonth||6==this.currentMonth||9==this.currentMonth||11==this.currentMonth?(this.totalDays=30,this.totalDays=this.totalDays-this.startDay+1):(this.totalDays=29,this.totalDays-=this.startDay)),this.newDate=new Date(this.currentYear+'/'+this.currentMonth+'/'+this.currentDate),'month'==this.view){for(;1!=this.currentDate;)--a,1==this.currentMonth&&1==this.currentDate?(--this.currentYear,this.currentMonth=12,this.currentDate=31,this.newDate=new Date(this.currentYear+'/'+this.currentMonth+'/'+this.currentDate)):(--this.currentDate,this.newDate=new Date(this.currentYear+'/'+this.currentMonth+'/'+this.currentDate),this.newDate.getDate()!=this.currentDate&&(0==this.currentDate&&(2==this.currentMonth||4==this.currentMonth||6==this.currentMonth||8==this.currentMonth||9==this.currentMonth||11==this.currentMonth||1==this.currentMonth)&&(this.newDate=new Date(this.currentYear+'/'+(this.currentMonth-1)+'/'+31),this.currentDate=31),0==this.currentDate&&(5==this.currentMonth||7==this.currentMonth||10==this.currentMonth||12==this.currentMonth)&&(this.newDate=new Date(this.currentYear+'/'+(this.currentMonth-1)+'/'+30),this.currentDate=30),0==this.currentDate&&3==this.currentMonth&&(this.newDate=new Date(this.currentYear+'/'+2+'/'+29),this.currentDate=29,2==this.newDate.getMonth()&&(this.newDate=new Date(this.currentYear+'/'+2+'/'+28),this.currentDate=28)),--this.currentMonth)),(0==this.currentDayofWeek||0==e)&&(this.currentDayofWeek=7,e=-1),--this.currentDayofWeek;7==this.currentDayofWeek&&(this.currentDayofWeek=0)}for(;0!=this.currentDayofWeek;)--a,1==this.currentMonth&&1==this.currentDate?(--this.currentYear,this.currentMonth=12,this.currentDate=31,this.newDate=new Date(this.currentYear+'/'+this.currentMonth+'/'+this.currentDate)):(--this.currentDate,this.newDate=new Date(this.currentYear+'/'+this.currentMonth+'/'+this.currentDate),this.newDate.getDate()!=this.currentDate&&(0==this.currentDate&&(2==this.currentMonth||4==this.currentMonth||6==this.currentMonth||8==this.currentMonth||9==this.currentMonth||11==this.currentMonth||1==this.currentMonth)&&(this.newDate=new Date(this.currentYear+'/'+(this.currentMonth-1)+'/'+31),this.currentDate=31),0==this.currentDate&&(5==this.currentMonth||7==this.currentMonth||10==this.currentMonth||12==this.currentMonth)&&(this.newDate=new Date(this.currentYear+'/'+(this.currentMonth-1)+'/'+30),this.currentDate=30),0==this.currentDate&&3==this.currentMonth&&(this.newDate=new Date(this.currentYear+'/'+2+'/'+29),this.currentDate=29,2==this.newDate.getMonth()&&(this.newDate=new Date(this.currentYear+'/'+2+'/'+28),this.currentDate=28)),--this.currentMonth)),--this.currentDayofWeek;var g=document.createElement('lrn-calendar-date');g.date=this.newDate,g.firstWeek=!0,g.style.width='14.25%',g.style.display='inline-block',g.id='date',g.view=this.view,this.date.getFullYear()===this.newDate.getFullYear()&&this.date.getMonth()===this.newDate.getMonth()&&this.date.getDate()===this.newDate.getDate()&&(g.loadeddate=!0);var h=this.eventCheck(this.listOfEvents,this.newDate),i=this.createReturn(h);g.events=i,g.valid=!0,Polymer.dom(this.calendarView).appendChild(g);for(var j=1;a<this.totalDays;){12==this.currentMonth&&31==this.currentDate?(++this.currentYear,this.currentMonth=1,this.currentDate=1,this.newDay=new Date(this.currentYear+'/'+this.currentMonth+'/'+this.currentDate)):(++this.currentDate,this.newDay=new Date(this.currentYear+'/'+this.currentMonth+'/'+this.currentDate),this.newDay.getDate()!=this.currentDate&&((1==this.currentMonth||3==this.currentMonth||5==this.currentMonth||7==this.currentMonth||8==this.currentMonth||10==this.currentMonth||12==this.currentMonth)&&(this.newDay=new Date(this.currentYear+'/'+(this.currentMonth+1)+'/'+1)),this.currentDate=1,++this.currentMonth));var g=document.createElement('lrn-calendar-date');g.valid=!0,g.id='date',g.date=this.newDay,g.style.width='14.25%',g.style.display='inline-block',g.view=this.view,this.date.getFullYear()===this.newDay.getFullYear()&&this.date.getMonth()===this.newDay.getMonth()&&this.date.getDate()===this.newDay.getDate()&&(g.loadeddate=!0);var k=this.eventCheck(this.listOfEvents,this.newDay),l=this.createReturn(k);g.events=l,7>j&&(g.firstWeek=!0),++j,g.valid=!0,Polymer.dom(this.calendarView).appendChild(g),++a,a==this.totalDays&&6!=this.newDay.getDay()&&(--a,b=1)}},getEvents:function(a,b){if('Not Found'==b)return'';var c=ICAL.parse(b),d=new ICAL.Component(c),e=d.getFirstSubcomponent('vevent'),f=d.getAllSubcomponents('vevent'),g=f.map(function(a){return event=new ICAL.Event(a),event});this.eventArray=[];for(var h,j=0;j<g.length;j++)h=this.createDate(g[j]),g[j].isRecurring()&&this.createRecurrence(g[j]),this.eventArray.push(g[j]);return this.eventArray},createRecurrence:function(a){a.getRecurrenceTypes().WEEKLY?this.createRepeatedEvent(a,156):a.getRecurrenceTypes().DAILY?this.createRepeatedEvent(a,720):a.getRecurrenceTypes().MONTHLY?this.createRepeatedEvent(a,36):a.getRecurrenceTypes().YEARLY&&this.createRepeatedEvent(a,10)},createRepeatedEvent:function(a,b){for(var c,d=a.iterator(a.startDate),e=0;(c=d.next())&&e++<b;){var f=new ICAL.Event;f.summary=a.summary,f.description=a.description,f.startDate=a.getOccurrenceDetails(c).startDate,f.endDate=a.getOccurrenceDetails(c).endDate;var g=a.location+'';f.location=g,(f.startDate._time.day!=a.startDate._time.day||f.startDate._time.month!=a.startDate._time.month||f.startDate._time.year!=a.startDate._time.year)&&this.eventArray.push(f)}},createDate:function(a){var b=a.startDate._time.year,c=a.startDate._time.month,d=a.startDate._time.day,e=new Date(b+'/'+c+'/'+d);return e},eventCheck:function(a,b){for(var c,d=[],e=a.length,f=this.startIndex;f<e;f++)c=this.createDate(a[f]),c.getTime()>b.getTime()&&(e=f,0!=f&&(this.startIndex=f-1)),c.getTime()==b.getTime()&&d.push(a[f]);return d},sortByTime:function(a){var b;do{b=!1;for(var c=0;c<a.length-1;c++)if(a[c].startDate>a[c+1].startDate){var d=a[c];a[c]=a[c+1],a[c+1]=d,b=!0}}while(b);return a},getDateInfo:function(){return this.startMonth=this.date.getMonth()+1,this.startYear=this.date.getFullYear(),this.startDay=this.date.getDate(),this.startDayOfWeek=this.date.getDay(),this.currentDate=this.startDay,this.currentMonth=this.startMonth,this.currentYear=this.startYear,void(this.currentDayofWeek=this.startDayOfWeek)},createReturn:function(a){for(var b=[],c=0;c<a.length;c++)b.push({event:a[c]});return b},getDisplayDate:function(a){if('function'===typeof a.getMonth){var b=a.getMonth(),c=a.getDate();return monthstring=['January','February','March','April','May','June','July','August','September','October','November','December'][b]+' '+a.getFullYear(),monthstring}return''}});</script></dom-module></body></html>