<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="prefetch" href="../polymer/polymer-mini.html"><link rel="prefetch" href="../polymer/polymer-micro.html"></head><body><dom-module id="a11y-media-utility"><script>(function(){'use strict';Polymer.A11yMediaUtility=Polymer({is:'a11y-media-utility',properties:{players:{type:Array,value:[]},stickyPlayer:{type:Object,value:null}},created:function(){var a=this;Polymer.A11yMediaUtility.instance||(Polymer.A11yMediaUtility.instance=a),document.body.addEventListener('a11y-player',function(b){a.players.push(b.detail)}),document.body.addEventListener('a11y-player-playing',function(b){a.setStickyPlayer(b.detail)}),window.onscroll=function(){a._checkScroll()}},checkConcurrentPlayers:function(){for(var a,b=this,c=b.stickyPlayer,d=0;d<b.players.length;d++)a=b.players[d],a===c||c.allowConcurrent&&a.allowConcurrent||a.pause()},setStickyPlayer:function(a){var b=this,c=b._getParentNode(a);b.__playerTop=c.offsetTop,b.__playerUpperMiddle=b.__playerTop+0.15*c.offsetHeight,b.__playerLowerMiddle=b.__playerTop+0.85*c.offsetHeight,a!==b.stickyPlayer&&b.stickyPlayer!==void 0&&null!==b.stickyPlayer&&(b.stickyPlayer.toggleSticky(!1),b.__parent.style.height='unset');c.style.height=c.offsetHeight+'px',b.__parent=c,b.stickyPlayer=a,a.allowConcurrent||b.checkConcurrentPlayers(),b._checkScroll()},_checkScroll:function(){var a=this,b=window.pageYOffset,c=b+window.innerHeight;a.stickyPlayer!==void 0&&null!==a.stickyPlayer&&(console.log(b,a.__playerTop,a.__playerMiddle,a.__playerBottom,c),a.stickyPlayer.__playing&&(a.__playerLowerMiddle>c||a.__playerUpperMiddle<b)?a.stickyPlayer.toggleSticky(!0):a.stickyPlayer.toggleSticky(!1))},_getParentNode:function(a){var b=a.parentNode;return void 0!==b&&null!==b&&b.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&(b=b.host),b}}),Polymer.A11yMediaUtility.instance=null,Polymer.A11yMediaUtility.requestAvailability=function(){Polymer.A11yMediaUtility.instance||(Polymer.A11yMediaUtility.instance=document.createElement('a11y-media-utility')),document.body.appendChild(Polymer.A11yMediaUtility.instance)}})();</script></dom-module></body></html>