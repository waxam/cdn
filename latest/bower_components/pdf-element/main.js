'use strict';(function(a){var b=Math.round,c=function(a){this.element=a,this.reader=Polymer.dom(a.root).querySelector('.pdf-viewer'),this.viewportOut=this.reader.querySelector('.pdf-viewport-out'),this.element=this.reader.querySelector('.pdf-element'),this.container=this.reader.querySelector('.sidebar'),this.toolbar=this.reader.querySelector('.pdf-toolbar'),this.card=Polymer.dom(a.root).querySelector('.style-scope'),this.toolbarHeight=0,this.title=this.toolbar.querySelector('.title'),this.enableTextSelection=a.enableTextSelection,this.fitWidth=a.fitWidth,this.HEIGHT=a.getAttribute('height'),this.WIDTH=a.getAttribute('width'),this.viewport=this.reader.querySelector('.pdf-viewport'),this.enableTextSelection&&(this.textLayerDiv=this.reader.querySelector('.textLayer'),this.textLayerDivStyle=this.textLayerDiv.style),this.spinner=this.reader.querySelector('.spinner'),this.totalPages=this.reader.querySelector('#totalPages'),this.viewportStyle=this.viewport.style,this.viewportOutStyle=this.viewportOut.style,this.ctx=this.viewport.getContext('2d'),this.SRC=a.src,this.pageRendering=!1,this.pageNumPending=null};c.prototype.setSize=function(a,b){this.WIDTH||(this.WIDTH=this.viewportOut.offsetWidth),this.HEIGHT||(this.HEIGHT=this.viewportOut.offsetHeight);var c=this.WIDTH,d=this.HEIGHT;'width'===a&&(c=b),'height'===a&&(d=b),this.viewportOutStyle.height=d+'px',this.spinner.style.top=(d-this.toolbarHeight)/2+'px'},c.prototype.setSrc=function(a){this.SRC=a},c.prototype.setFitWidth=function(a){this.fitWidth=a},c.prototype.queueRenderPage=function(a){this.pdfExists=!0,this.pageRendering?this.pageNumPending=a:this.renderPDF(a)},c.prototype.loadPDF=function(a){var b=this;this.setSize(),a=1;var c=this;PDFJS.getDocument(this.SRC).then(function(b){c.PDF=b,c.queueRenderPage(a),c.currentPage=a,c.totalPages.innerHTML=c.PDF.numPages,c.totalPagesNum=c.PDF.numPages,c.currentZoomVal=c.fitZoomVal=c.widthZoomVal=0,c.createDownloadLink()}).catch(function(){b.pdfExists=!1})},c.prototype.renderPages=function(){var a=this;a.viewportOut.innerHTML='',PDFJS.getDocument(this.SRC).then(function(b){a.PDF=b;for(var c=1;c<=a.PDF.numPages;c++)b.getPage(c).then(a.renderPDF(c,null,!0));a.currentPage=1,a.totalPages.innerHTML=a.PDF.numPages,a.totalPagesNum=a.PDF.numPages,a.currentZoomVal||(a.currentZoomVal=a.fitZoomVal=a.widthZoomVal=0),a.createDownloadLink()})},c.prototype.sidebarSetup=function(a){function b(h){var i=0.14,j=0,k=c.container;j=a.sidebarOpen?c.WIDTH:c.WIDTH,i=.00035*j;var l=h.getViewport(i),m=document.createElement('div'),n=(h.pageIndex+1).toString(),o=d.split('/').pop();m.style.backgroundColor='gray';var p=document.querySelector('pdf-element'),q=document.createElement('canvas');m.appendChild(q),k.appendChild(m);var r=Polymer.dom(c.container).childNodes[h.pageIndex];r.addEventListener('click',function(){var b=h.pageIndex+1;p.sideBarClick(b,a.instance,a)});var s=q.getContext('2d');q.height=l.height,q.width=l.width;h.render({canvasContext:s,viewport:l}),e++,null!==g&&e<=f&&g.getPage(e).then(b)}var c=this,d=a.src,e=1,f=0,g=null;0==c.container.innerHTML.length?(c.container.innerHTML='',PDFJS.getDocument(this.SRC).then(function(a){g=a,f=g.numPages;var d=c.container;a.getPage(1).then(b)}),c.setViewportPos(!0)):a.changedSideBar&&(c.container.innerHTML='',PDFJS.getDocument(this.SRC).then(function(a){g=a,f=g.numPages;var d=c.container;a.getPage(1).then(b)}),c.setViewportPos(!1))},c.prototype.renderPDF=function(a,c,d){var e=this;e.pageRendering=!0,e.spinner.active=!0,this.PDF.getPage(a).then(function(f){var g,h,i,j,k,l=Math.abs,m=Math.sin,n=Math.cos;if(k=f.pageInfo.rotate*Math.PI/180,e.pageW=l(f.view[2]*n(k)+f.view[3]*m(k)),e.pageH=l(f.view[3]*n(k)+f.view[2]*m(k)),0!==e.currentZoomVal&&!c||(g=b(100*(e.WIDTH/e.pageW))/100,h=b(100*((e.HEIGHT-e.toolbarHeight)/e.pageH))/100,j=Math.min(h,g),e.fitZoomVal=j,e.widthZoomVal=e.WIDTH/e.pageW,e.currentZoomVal=e.fitWidth?e.widthZoomVal:e.fitZoomVal),!!c)e.zoomPage({target:e.zoomLvl});else{if(j=e.currentZoomVal,i=f.getViewport(j),e.ctx.height=i.height,e.ctx.width=i.width,e.pageW*=j,e.pageH*=j,e.WIDTH==e.currentWidth||null==e.currentWidth?e.setViewportPos(!1):e.setViewportPos(!0),e.viewport.width=e.pageW,e.viewport.height=e.pageH,e.viewportStyle.width=e.pageW+'px',e.viewportStyle.height=e.pageH+'px',e.enableTextSelection&&(e.textLayerDivStyle.width=e.pageW+'px',e.textLayerDivStyle.height=e.pageH+'px'),e.ctx.clearRect(0,0,e.viewport.width,e.viewport.height),d){var o=document.createElement('div');o.setAttribute('style','position: relative');var p=document.createElement('canvas'),q=document.createElement('div');q.setAttribute('style','left: '+e.viewportStyle.left),q.className='textLayer';var r=p.getContext('2d');q.height=i.height,q.width=i.width,e.viewportOut.appendChild(o),o.appendChild(p),o.appendChild(q),f.render({canvasContext:r,viewport:i}),e.enableTextSelection&&(e.textLayerDiv.innerHTML='',f.getTextContent().then(function(b){PDFJS.renderTextLayer({textContent:b,container:q,pageIndex:a,viewport:i,textDivs:[]})}))}else{var s=f.render({canvasContext:e.ctx,viewport:i});s.promise.then(function(){e.pageRendering=!1,e.spinner.active=!1,null!==e.pageNumPending&&(e.renderPDF(e.pageNumPending),e.pageNumPending=null)})}e.enableTextSelection&&(e.textLayerDiv.innerHTML='',f.getTextContent().then(function(b){PDFJS.renderTextLayer({textContent:b,container:e.textLayerDiv,pageIndex:a,viewport:i,textDivs:[]})}))}})},c.prototype.setViewportPos=function(a){var b=Math.floor;this.currentWidth=a?0.75*this.WIDTH:this.WIDTH,this.viewportStyle.left=this.pageW<this.currentWidth?(this.currentWidth-this.pageW)/2+'px':0,this.pageH<this.HEIGHT?(this.viewportStyle.top=(this.HEIGHT-this.pageH-this.toolbarHeight)/2+'px',this.viewportStyle.topNum=b((this.HEIGHT-this.pageH-this.toolbarHeight)/2)+this.toolbarHeight,this.enableTextSelection&&(this.textLayerDivStyle.topNum=b((this.HEIGHT-this.pageH-this.toolbarHeight)/2)+this.toolbarHeight)):this.viewportStyle.top=0,this.enableTextSelection&&(this.textLayerDivStyle.left=this.viewportStyle.left,this.textLayerDivStyle.top=this.viewportStyle.top)},c.prototype.changePDFSource=function(a){this.setSrc(a),this.loadPDF(1)},c.prototype.zoomInOut=function(a){this.currentZoomVal=b(10*(b(10*this.currentZoomVal)/10+a))/10,this.queueRenderPage(this.currentPage)},c.prototype.zoomIn=function(){this.currentZoomVal=b(10*(b(10*this.currentZoomVal)/10+0.1))/10,this.queueRenderPage(this.currentPage)},c.prototype.zoomOut=function(){this.currentZoomVal=b(10*(b(10*this.currentZoomVal)/10+-0.1))/10,this.queueRenderPage(this.currentPage)},c.prototype.zoomPageFit=function(){this.currentZoomVal=this.fitZoomVal,this.queueRenderPage(this.currentPage)},c.prototype.zoomWidthFit=function(){this.currentZoomVal=this.widthZoomVal,this.queueRenderPage(this.currentPage)},c.prototype.getPageNum=function(){return this.PDF.numPages},c.prototype.createDownloadLink=function(){var a=this;this.PDF.getData().then(function(b){var c=PDFJS.createBlob(b,'application/pdf');a.downloadLink=URL.createObjectURL(c)})},c.prototype.download=function(){var b=document.createElement('a'),a=this.SRC.split('/');b.href=this.downloadLink,b.target='_parent','download'in b&&(b.download=decodeURIComponent(a[a.length-1])),this.reader.appendChild(b),b.click(),b.parentNode.removeChild(b)},a.Polymer.Reader=c})(window);