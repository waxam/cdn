!function(c,a){"function"==typeof define&&define.amd?define("wavesurfer",[],function(){return c.WaveSurfer=a()}):"object"==("undefined"===typeof exports?"undefined":babelHelpers.typeof(exports))?module.exports=a():c.WaveSurfer=a()}(this,function(){"use strict";var k=Math.ceil,l=Math.floor,t=Math.round,y=Math.max,r=Math.min,f={defaultParams:{audioContext:null,audioRate:1,autoCenter:!0,backend:"WebAudio",barHeight:1,closeAudioContext:!1,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,loopSelection:!0,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,progressColor:"#555",normalize:!1,renderer:"MultiCanvas",scrollParent:!1,skipLength:2,splitChannels:!1,waveColor:"#999"},init:function(a){if(this.params=f.util.extend({},this.defaultParams,a),this.container="string"==typeof a.container?document.querySelector(this.params.container):this.params.container,!this.container)throw new Error("Container element not found");if(this.mediaContainer=null==this.params.mediaContainer?this.container:"string"==typeof this.params.mediaContainer?document.querySelector(this.params.mediaContainer):this.params.mediaContainer,!this.mediaContainer)throw new Error("Media Container element not found");this.savedVolume=0,this.isMuted=!1,this.tmpEvents=[],this.currentAjax=null,this.createDrawer(),this.createBackend(),this.createPeakCache(),this.isDestroyed=!1},createDrawer:function(){var d=this;this.drawer=Object.create(f.Drawer[this.params.renderer]),this.drawer.init(this.container,this.params),this.drawer.on("redraw",function(){d.drawBuffer(),d.drawer.progress(d.backend.getPlayedPercents())}),this.drawer.on("click",function(b,a){setTimeout(function(){d.seekTo(a)},0)}),this.drawer.on("scroll",function(b){d.params.partialRender&&d.drawBuffer(),d.fireEvent("scroll",b)})},createBackend:function(){var c=this;this.backend&&this.backend.destroy(),"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend||f.WebAudio.supportsWebAudio()||(this.params.backend="MediaElement"),this.backend=Object.create(f[this.params.backend]),this.backend.init(this.params),this.backend.on("finish",function(){c.fireEvent("finish")}),this.backend.on("play",function(){c.fireEvent("play")}),this.backend.on("pause",function(){c.fireEvent("pause")}),this.backend.on("audioprocess",function(b){c.drawer.progress(c.backend.getPlayedPercents()),c.fireEvent("audioprocess",b)})},createPeakCache:function(){this.params.partialRender&&(this.peakCache=Object.create(f.PeakCache),this.peakCache.init())},getDuration:function(){return this.backend.getDuration()},getCurrentTime:function(){return this.backend.getCurrentTime()},play:function(c,a){this.fireEvent("interaction",this.play.bind(this,c,a)),this.backend.play(c,a)},pause:function(){this.backend.isPaused()||this.backend.pause()},playPause:function(){this.backend.isPaused()?this.play():this.pause()},isPlaying:function(){return!this.backend.isPaused()},skipBackward:function(b){this.skip(-b||-this.params.skipLength)},skipForward:function(b){this.skip(b||this.params.skipLength)},skip:function(d){var a=this.getCurrentTime()||0,b=this.getDuration()||1;a=y(0,r(b,a+(d||0))),this.seekAndCenter(a/b)},seekAndCenter:function(b){this.seekTo(b),this.drawer.recenter(b)},seekTo:function(d){this.fireEvent("interaction",this.seekTo.bind(this,d));var a=this.backend.isPaused();a||this.backend.pause();var b=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(d*this.getDuration()),this.drawer.progress(this.backend.getPlayedPercents()),a||this.backend.play(),this.params.scrollParent=b,this.fireEvent("seek",d)},stop:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)},setVolume:function(b){this.backend.setVolume(b)},getVolume:function(){return this.backend.getVolume()},setPlaybackRate:function(b){this.backend.setPlaybackRate(b)},getPlaybackRate:function(){return this.backend.getPlaybackRate()},toggleMute:function(){this.setMute(!this.isMuted)},setMute:function(b){b!==this.isMuted&&(b?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0):(this.backend.setVolume(this.savedVolume),this.isMuted=!1))},getMute:function(){return this.isMuted},getFilters:function(){return this.backend.filters||[]},toggleScroll:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()},toggleInteraction:function(){this.params.interact=!this.params.interact},drawBuffer:function(){var i=t(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),a=this.drawer.getWidth(),b=i,c=this.drawer.getScrollX(),d=r(c+a,b);if(this.params.fillParent&&(!this.params.scrollParent||i<a)&&(b=a,c=0,d=b),this.params.partialRender)for(var e,h=this.peakCache.addRangeToPeakCache(b,c,d),f=0;f<h.length;f++)e=this.backend.getPeaks(b,h[f][0],h[f][1]),this.drawer.drawPeaks(e,b,h[f][0],h[f][1]);else{c=0,d=b;var e=this.backend.getPeaks(b,c,d);this.drawer.drawPeaks(e,b,c,d)}this.fireEvent("redraw",e,b)},zoom:function(b){this.params.minPxPerSec=b,this.params.scrollParent=!0,this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",b)},loadArrayBuffer:function(b){this.decodeArrayBuffer(b,function(b){this.isDestroyed||this.loadDecodedBuffer(b)}.bind(this))},loadDecodedBuffer:function(b){this.backend.load(b),this.drawBuffer(),this.fireEvent("ready")},loadBlob:function(d){var e=this,a=new FileReader;a.addEventListener("progress",function(b){e.onProgress(b)}),a.addEventListener("load",function(b){e.loadArrayBuffer(b.target.result)}),a.addEventListener("error",function(){e.fireEvent("error","Error reading file")}),a.readAsArrayBuffer(d),this.empty()},load:function(d,a,b){switch(this.empty(),this.isMuted=!1,this.params.backend){case"WebAudio":return this.loadBuffer(d,a);case"MediaElement":return this.loadMediaElement(d,a,b);}},loadBuffer:function(d,a){var b=function(a){return a&&this.tmpEvents.push(this.once("ready",a)),this.getArrayBuffer(d,this.loadArrayBuffer.bind(this))}.bind(this);return a?(this.backend.setPeaks(a),this.drawBuffer(),this.tmpEvents.push(this.once("interaction",b)),void 0):b()},loadMediaElement:function(f,g,h){var c=f;if("string"==typeof f)this.backend.load(c,this.mediaContainer,g,h);else{var d=f;this.backend.loadElt(d,g),c=d.src}this.tmpEvents.push(this.backend.once("canplay",function(){this.drawBuffer(),this.fireEvent("ready")}.bind(this)),this.backend.once("error",function(b){this.fireEvent("error",b)}.bind(this))),g&&this.backend.setPeaks(g),(!g||this.params.forceDecode)&&this.backend.supportsWebAudio()&&this.getArrayBuffer(c,function(b){this.decodeArrayBuffer(b,function(b){this.backend.buffer=b,this.backend.setPeaks(null),this.drawBuffer(),this.fireEvent("waveform-ready")}.bind(this))}.bind(this))},decodeArrayBuffer:function(d,a){this.arraybuffer=d,this.backend.decodeArrayBuffer(d,function(b){this.isDestroyed||this.arraybuffer!=d||(a(b),this.arraybuffer=null)}.bind(this),this.fireEvent.bind(this,"error","Error decoding audiobuffer"))},getArrayBuffer:function(a,g){var c=this,d=f.util.ajax({url:a,responseType:"arraybuffer"});return this.currentAjax=d,this.tmpEvents.push(d.on("progress",function(b){c.onProgress(b)}),d.on("success",function(b){g(b),c.currentAjax=null}),d.on("error",function(b){c.fireEvent("error","XHR error: "+b.target.statusText),c.currentAjax=null})),d},onProgress:function(c){if(c.lengthComputable)var a=c.loaded/c.total;else a=c.loaded/(c.loaded+1e6);this.fireEvent("loading",t(100*a),c.target)},exportPCM:function(g,h,a){g=g||1024,h=h||1e4,a=a||!1;var b=this.backend.getPeaks(g,h),c=[].map.call(b,function(b){return t(b*h)/h}),d=JSON.stringify(c);return a||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(d)),d},exportImage:function(c,a){return c||(c="image/png"),a||(a=1),this.drawer.getImage(c,a)},cancelAjax:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)},clearTmpEvents:function(){this.tmpEvents.forEach(function(b){b.un()})},empty:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)},destroy:function(){this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),this.backend.destroy(),this.drawer.destroy(),this.isDestroyed=!0}};return f.create=function(a){var b=Object.create(f);return b.init(a),b},f.util={extend:function(d){var a=Array.prototype.slice.call(arguments,1);return a.forEach(function(a){Object.keys(a).forEach(function(b){d[b]=a[b]})}),d},debounce:function(i,a,b){var c,d,e,j=function(){e=null,b||i.apply(d,c)};return function(){d=this,c=arguments;var g=b&&!e;clearTimeout(e),e=setTimeout(j,a),e||(e=setTimeout(j,a)),g&&i.apply(d,c)}},min:function(d){var a=+(1/0);for(var b in d)d[b]<a&&(a=d[b]);return a},max:function(d){var a=-(1/0);for(var b in d)d[b]>a&&(a=d[b]);return a},getId:function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},ajax:function(a){var b=Object.create(f.Observer),c=new XMLHttpRequest,d=!1;return c.open(a.method||"GET",a.url,!0),c.responseType=a.responseType||"json",c.addEventListener("progress",function(c){b.fireEvent("progress",c),c.lengthComputable&&c.loaded==c.total&&(d=!0)}),c.addEventListener("load",function(e){d||b.fireEvent("progress",e),b.fireEvent("load",e),200==c.status||206==c.status?b.fireEvent("success",c.response,e):b.fireEvent("error",e)}),c.addEventListener("error",function(c){b.fireEvent("error",c)}),c.send(),b.xhr=c,b}},f.Observer={on:function(d,e){this.handlers||(this.handlers={});var f=this.handlers[d];return f||(f=this.handlers[d]=[]),f.push(e),{name:d,callback:e,un:this.un.bind(this,d,e)}},un:function(e,a){if(this.handlers){var b=this.handlers[e];if(b)if(a)for(var c=b.length-1;0<=c;c--)b[c]==a&&b.splice(c,1);else b.length=0}},unAll:function(){this.handlers=null},once:function(e,a){var b=this;return this.on(e,function c(){a.apply(this,arguments),setTimeout(function(){b.un(e,c)},0)})},fireEvent:function(d){if(this.handlers){var a=this.handlers[d],b=Array.prototype.slice.call(arguments,1);a&&a.forEach(function(c){c.apply(null,b)})}}},f.util.extend(f,f.Observer),f.WebAudio={scriptBufferSize:256,PLAYING_STATE:0,PAUSED_STATE:1,FINISHED_STATE:2,supportsWebAudio:function(){return window.AudioContext||window.webkitAudioContext},getAudioContext:function(){return f.WebAudio.audioContext||(f.WebAudio.audioContext=new(window.AudioContext||window.webkitAudioContext)),f.WebAudio.audioContext},getOfflineAudioContext:function(a){return f.WebAudio.offlineAudioContext||(f.WebAudio.offlineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,a)),f.WebAudio.offlineAudioContext},init:function(a){this.params=a,this.ac=a.audioContext||this.getAudioContext(),this.lastPlay=this.ac.currentTime,this.startPosition=0,this.scheduledPause=null,this.states=[Object.create(f.WebAudio.state.playing),Object.create(f.WebAudio.state.paused),Object.create(f.WebAudio.state.finished)],this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(this.PAUSED_STATE),this.setPlaybackRate(this.params.audioRate),this.setLength(0)},disconnectFilters:function(){this.filters&&(this.filters.forEach(function(b){b&&b.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))},setState:function(b){this.state!==this.states[b]&&(this.state=this.states[b],this.state.init.call(this))},setFilter:function(){this.setFilters([].slice.call(arguments))},setFilters:function(b){this.disconnectFilters(),b&&b.length&&(this.filters=b,this.analyser.disconnect(),b.reduce(function(c,a){return c.connect(a),a},this.analyser).connect(this.gainNode))},createScriptNode:function(){this.scriptNode=this.ac.createScriptProcessor?this.ac.createScriptProcessor(this.scriptBufferSize):this.ac.createJavaScriptNode(this.scriptBufferSize),this.scriptNode.connect(this.ac.destination)},addOnAudioProcess:function(){var c=this;this.scriptNode.onaudioprocess=function(){var a=c.getCurrentTime();a>=c.getDuration()?(c.setState(c.FINISHED_STATE),c.fireEvent("pause")):a>=c.scheduledPause?c.pause():c.state===c.states[c.PLAYING_STATE]&&c.fireEvent("audioprocess",a)}},removeOnAudioProcess:function(){this.scriptNode.onaudioprocess=null},createAnalyserNode:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)},createVolumeNode:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)},setVolume:function(b){this.gainNode.gain.value=b},getVolume:function(){return this.gainNode.gain.value},decodeArrayBuffer:function(d,e,a){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(d,function(b){e(b)}.bind(this),a)},setPeaks:function(b){this.peaks=b},setLength:function(d){if(!this.mergedPeaks||d!=2*this.mergedPeaks.length-1+2){this.splitPeaks=[],this.mergedPeaks=[];for(var a=this.buffer?this.buffer.numberOfChannels:1,b=0;b<a;b++)this.splitPeaks[b]=[],this.splitPeaks[b][2*(d-1)]=0,this.splitPeaks[b][2*(d-1)+1]=0;this.mergedPeaks[2*(d-1)]=0,this.mergedPeaks[2*(d-1)+1]=0}},getPeaks:function(e,a,b){if(this.peaks)return this.peaks;this.setLength(e);for(var c=this.buffer.length/e,d=this.buffer.numberOfChannels,f=0;f<d;f++)for(var g=this.splitPeaks[f],h=this.buffer.getChannelData(f),i=a;i<=b;i++){for(var j,l=~~(i*c),k=0,m=0,n=l;n<~~(l+c);n+=~~(c/10)||1)j=h[n],j>m&&(m=j),j<k&&(k=j);g[2*i]=m,g[2*i+1]=k,(0==f||m>this.mergedPeaks[2*i])&&(this.mergedPeaks[2*i]=m),(0==f||k<this.mergedPeaks[2*i+1])&&(this.mergedPeaks[2*i+1]=k)}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks},getPlayedPercents:function(){return this.state.getPlayedPercents.call(this)},disconnectSource:function(){this.source&&this.source.disconnect()},destroy:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&("function"==typeof this.ac.close&&"closed"!=this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:f.WebAudio.audioContext=null,f.WebAudio.offlineAudioContext=null)},load:function(b){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=b,this.createSource()},createSource:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.value=this.playbackRate,this.source.buffer=this.buffer,this.source.connect(this.analyser)},isPaused:function(){return this.state!==this.states[this.PLAYING_STATE]},getDuration:function(){return this.buffer?this.buffer.duration:0},seekTo:function(c,d){if(this.buffer)return this.scheduledPause=null,null==c&&(c=this.getCurrentTime(),c>=this.getDuration()&&(c=0)),null==d&&(d=this.getDuration()),this.startPosition=c,this.lastPlay=this.ac.currentTime,this.state===this.states[this.FINISHED_STATE]&&this.setState(this.PAUSED_STATE),{start:c,end:d}},getPlayedTime:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate},play:function(d,a){if(this.buffer){this.createSource();var b=this.seekTo(d,a);d=b.start,a=b.end,this.scheduledPause=a,this.source.start(0,d,a-d),"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume(),this.setState(this.PLAYING_STATE),this.fireEvent("play")}},pause:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(this.PAUSED_STATE),this.fireEvent("pause")},getCurrentTime:function(){return this.state.getCurrentTime.call(this)},getPlaybackRate:function(){return this.playbackRate},setPlaybackRate:function(b){b=b||1,this.isPaused()?this.playbackRate=b:(this.pause(),this.playbackRate=b,this.play())}},f.WebAudio.state={},f.WebAudio.state.playing={init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var b=this.getDuration();return this.getCurrentTime()/b||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}},f.WebAudio.state.paused={init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var b=this.getDuration();return this.getCurrentTime()/b||0},getCurrentTime:function(){return this.startPosition}},f.WebAudio.state.finished={init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}},f.util.extend(f.WebAudio,f.Observer),f.MediaElement=Object.create(f.WebAudio),f.util.extend(f.MediaElement,{init:function(b){this.params=b,this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){}},this.mediaType=b.mediaType.toLowerCase(),this.elementPosition=b.elementPosition,this.setPlaybackRate(this.params.audioRate),this.createTimer()},createTimer:function(){var d=this;this.on("play",function a(){if(!d.isPaused()){d.fireEvent("audioprocess",d.getCurrentTime());var b=window.requestAnimationFrame||window.webkitRequestAnimationFrame;b(a)}})},load:function(g,a,b,c){var d=document.createElement(this.mediaType);d.controls=this.params.mediaControls,d.autoplay=this.params.autoplay||!1,d.preload=null==c?"auto":c,d.src=g,d.style.width="100%";var e=a.querySelector(this.mediaType);e&&a.removeChild(e),a.appendChild(d),this._load(d,b)},loadElt:function(d,a){var b=d;b.controls=this.params.mediaControls,b.autoplay=this.params.autoplay||!1,this._load(b,a)},_load:function(d,a){var b=this;"function"==typeof d.load&&d.load(),d.addEventListener("error",function(){b.fireEvent("error","Error loading media element")}),d.addEventListener("canplay",function(){b.fireEvent("canplay")}),d.addEventListener("ended",function(){b.fireEvent("finish")}),this.media=d,this.peaks=a,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate)},isPaused:function(){return!this.media||this.media.paused},getDuration:function(){var b=(this.buffer||this.media).duration;return b>=1/0&&(b=this.media.seekable.end(0)),b},getCurrentTime:function(){return this.media&&this.media.currentTime},getPlayedPercents:function(){return this.getCurrentTime()/this.getDuration()||0},getPlaybackRate:function(){return this.playbackRate||this.media.playbackRate},setPlaybackRate:function(b){this.playbackRate=b||1,this.media.playbackRate=this.playbackRate},seekTo:function(b){null!=b&&(this.media.currentTime=b),this.clearPlayEnd()},play:function(c,a){this.seekTo(c),this.media.play(),a&&this.setPlayEnd(a),this.fireEvent("play")},pause:function(){this.media&&this.media.pause(),this.clearPlayEnd(),this.fireEvent("pause")},setPlayEnd:function(d){var a=this;this.onPlayEnd=function(b){b>=d&&(a.pause(),a.seekTo(d))},this.on("audioprocess",this.onPlayEnd)},clearPlayEnd:function(){this.onPlayEnd&&(this.un("audioprocess",this.onPlayEnd),this.onPlayEnd=null)},getPeaks:function(a,b,c){return this.buffer?f.WebAudio.getPeaks.call(this,a,b,c):this.peaks||[]},getVolume:function(){return this.media.volume},setVolume:function(b){this.media.volume=b},destroy:function(){this.pause(),this.unAll(),this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}),f.AudioElement=f.MediaElement,f.Drawer={init:function(c,a){this.container=c,this.params=a,this.width=0,this.height=a.height*this.params.pixelRatio,this.lastPos=0,this.initDrawer(a),this.createWrapper(),this.createElements()},createWrapper:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()},handleEvent:function(h,a){a||h.preventDefault();var b,c=h.targetTouches?h.targetTouches[0].clientX:h.clientX,d=this.wrapper.getBoundingClientRect(),e=this.width,f=this.getWidth();return!this.params.fillParent&&e<f?(b=(c-d.left)*this.params.pixelRatio/e||0,1<b&&(b=1)):b=(c-d.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,b},setupWrapperEvents:function(){var e=this;this.wrapper.addEventListener("click",function(a){var b=e.wrapper.offsetHeight-e.wrapper.clientHeight;if(0!=b){var c=e.wrapper.getBoundingClientRect();if(a.clientY>=c.bottom-b)return}e.params.interact&&e.fireEvent("click",a,e.handleEvent(a))}),this.wrapper.addEventListener("scroll",function(a){e.fireEvent("scroll",a)})},drawPeaks:function(e,a,b,c){this.setWidth(a),this.params.barWidth?this.drawBars(e,0,b,c):this.drawWave(e,0,b,c)},style:function(d,a){return Object.keys(a).forEach(function(b){d.style[b]!==a[b]&&(d.style[b]=a[b])}),d},resetScroll:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)},recenter:function(c){var a=this.wrapper.scrollWidth*c;this.recenterOnPosition(a,!0)},recenterOnPosition:function(i,a){var j=this.wrapper.scrollLeft,c=~~(this.wrapper.clientWidth/2),k=i-c,e=k-j,f=this.wrapper.scrollWidth-this.wrapper.clientWidth;if(0!=f){if(!a&&-c<=e&&e<c){var g=5;e=y(-g,r(g,e)),k=j+e}k=y(0,r(f,k)),k!=j&&(this.wrapper.scrollLeft=k)}},getScrollX:function(){return t(this.wrapper.scrollLeft*this.params.pixelRatio)},getWidth:function(){return t(this.container.clientWidth*this.params.pixelRatio)},setWidth:function(b){this.width!=b&&(this.width=b,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize())},setHeight:function(b){b!=this.height&&(this.height=b,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize())},progress:function(e){var a=1/this.params.pixelRatio,b=t(e*this.width)*a;if(b<this.lastPos||b-this.lastPos>=a){if(this.lastPos=b,this.params.scrollParent&&this.params.autoCenter){var c=~~(this.wrapper.scrollWidth*e);this.recenterOnPosition(c)}this.updateProgress(b)}},destroy:function(){this.unAll(),this.wrapper&&(this.container.removeChild(this.wrapper),this.wrapper=null)},initDrawer:function(){},createElements:function(){},updateSize:function(){},drawWave:function(){},clearWave:function(){},updateProgress:function(){}},f.util.extend(f.Drawer,f.Observer),f.Drawer.Canvas=Object.create(f.Drawer),f.util.extend(f.Drawer.Canvas,{createElements:function(){var c=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:0,top:0,bottom:0}));if(this.waveCc=c.getContext("2d"),this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.params.waveColor!=this.params.progressColor){var a=this.progressWave.appendChild(document.createElement("canvas"));this.progressCc=a.getContext("2d")}},updateSize:function(){var b=t(this.width/this.params.pixelRatio);this.waveCc.canvas.width=this.width,this.waveCc.canvas.height=this.height,this.style(this.waveCc.canvas,{width:b+"px"}),this.style(this.progressWave,{display:"block"}),this.progressCc&&(this.progressCc.canvas.width=this.width,this.progressCc.canvas.height=this.height,this.style(this.progressCc.canvas,{width:b+"px"})),this.clearWave()},clearWave:function(){this.waveCc.clearRect(0,0,this.width,this.height),this.progressCc&&this.progressCc.clearRect(0,0,this.width,this.height)},drawBars:function(r,a,w,d){var c=this;if(r[0]instanceof Array){var b=r;if(this.params.splitChannels)return this.setHeight(b.length*this.params.height*this.params.pixelRatio),void b.forEach(function(e,a){c.drawBars(e,a,w,d)});r=b[0]}var e=[].some.call(r,function(b){return 0>b}),h=1;e&&(h=2);var i=.5/this.params.pixelRatio,g=this.width,j=this.params.height*this.params.pixelRatio,k=j*a||0,m=j/2,n=r.length/h,o=this.params.barWidth*this.params.pixelRatio,p=y(this.params.pixelRatio,~~(o/2)),q=1/this.params.barHeight;if(this.params.normalize){var s=f.util.max(r),x=f.util.min(r);q=-x>s?-x:s}var z=n/g;this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(b){if(b)for(var a=w/z;a<d/z;a+=o+p){var c=r[l(a*z*h)]||0,e=t(c/q*m);b.fillRect(a+i,m-e+k,o+i,2*e)}},this)},drawWave:function(u,a,v,d){var c=this;if(u[0]instanceof Array){var b=u;if(this.params.splitChannels)return this.setHeight(b.length*this.params.height*this.params.pixelRatio),void b.forEach(function(e,a){c.drawWave(e,a,v,d)});u=b[0]}var e=[].some.call(u,function(b){return 0>b});if(!e){for(var g=[],i=0,j=u.length;i<j;i++)g[2*i]=u[i],g[2*i+1]=-u[i];u=g}var k=.5/this.params.pixelRatio,l=this.params.height*this.params.pixelRatio,m=l*a||0,n=l/2,o=~~(u.length/2),p=1;this.params.fillParent&&this.width!=o&&(p=this.width/o);var q=1/this.params.barHeight;if(this.params.normalize){var r=f.util.max(u),s=f.util.min(u);q=-s>r?-s:r}this.waveCc.fillStyle=this.params.waveColor,this.progressCc&&(this.progressCc.fillStyle=this.params.progressColor),[this.waveCc,this.progressCc].forEach(function(b){if(b){b.beginPath(),b.moveTo(v*p+k,n+m);for(var a,e=v;e<d;e++)a=t(u[2*e]/q*n),b.lineTo(e*p+k,n-a+m);for(var a,e=d-1;e>=v;e--)a=t(u[2*e+1]/q*n),b.lineTo(e*p+k,n-a+m);b.closePath(),b.fill(),b.fillRect(0,n+m-k,this.width,k)}},this)},updateProgress:function(b){this.style(this.progressWave,{width:b+"px"})},getImage:function(c,a){return this.waveCc.canvas.toDataURL(c,a)}}),f.Drawer.MultiCanvas=Object.create(f.Drawer),f.util.extend(f.Drawer.MultiCanvas,{initDrawer:function(b){if(this.maxCanvasWidth=null==b.maxCanvasWidth?4e3:b.maxCanvasWidth,this.maxCanvasElementWidth=t(this.maxCanvasWidth/this.params.pixelRatio),1>=this.maxCanvasWidth)throw"maxCanvasWidth must be greater than 1.";if(1==this.maxCanvasWidth%2)throw"maxCanvasWidth must be an even number.";this.hasProgressCanvas=this.params.waveColor!=this.params.progressColor,this.halfPixel=.5/this.params.pixelRatio,this.canvases=[]},createElements:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:2,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})),this.addCanvas()},updateSize:function(){for(var e=t(this.width/this.params.pixelRatio),a=k(e/this.maxCanvasElementWidth);this.canvases.length<a;)this.addCanvas();for(;this.canvases.length>a;)this.removeCanvas();for(var b in this.canvases){var c=this.maxCanvasWidth+2*k(this.params.pixelRatio/2);b==this.canvases.length-1&&(c=this.width-this.maxCanvasWidth*(this.canvases.length-1)),this.updateDimensions(this.canvases[b],c,this.height),this.clearWaveForEntry(this.canvases[b])}},addCanvas:function(){var c={},a=this.maxCanvasElementWidth*this.canvases.length;c.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:1,left:a+"px",top:0,bottom:0,height:"100%"})),c.waveCtx=c.wave.getContext("2d"),this.hasProgressCanvas&&(c.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:a+"px",top:0,bottom:0,height:"100%"})),c.progressCtx=c.progress.getContext("2d")),this.canvases.push(c)},removeCanvas:function(){var b=this.canvases.pop();b.wave.parentElement.removeChild(b.wave),this.hasProgressCanvas&&b.progress.parentElement.removeChild(b.progress)},updateDimensions:function(f,a,b){var c=t(a/this.params.pixelRatio),d=t(this.width/this.params.pixelRatio);f.start=f.waveCtx.canvas.offsetLeft/d||0,f.end=f.start+c/d,f.waveCtx.canvas.width=a,f.waveCtx.canvas.height=b,this.style(f.waveCtx.canvas,{width:c+"px"}),this.style(this.progressWave,{display:"block"}),this.hasProgressCanvas&&(f.progressCtx.canvas.width=a,f.progressCtx.canvas.height=b,this.style(f.progressCtx.canvas,{width:c+"px"}))},clearWave:function(){for(var b in this.canvases)this.clearWaveForEntry(this.canvases[b])},clearWaveForEntry:function(b){b.waveCtx.clearRect(0,0,b.waveCtx.canvas.width,b.waveCtx.canvas.height),this.hasProgressCanvas&&b.progressCtx.clearRect(0,0,b.progressCtx.canvas.width,b.progressCtx.canvas.height)},drawBars:function(a,b,c,d){var e=this;if(a[0]instanceof Array){var q=a;if(this.params.splitChannels)return this.setHeight(q.length*this.params.height*this.params.pixelRatio),void q.forEach(function(f,a){e.drawBars(f,a,c,d)});a=q[0]}var g=[].some.call(a,function(b){return 0>b}),h=1;g&&(h=2);var i=this.width,j=this.params.height*this.params.pixelRatio,k=j/2,m=a.length/h,n=this.params.barWidth*this.params.pixelRatio,o=y(this.params.pixelRatio,~~(n/2)),p=1/this.params.barHeight;if(this.params.normalize){var r=f.util.max(a),s=f.util.min(a);p=-s>r?-s:r}for(var z=m/i,u=c/z;u<d/z;u+=n+o){var v=a[l(u*z*h)]||0,w=t(v/p*k);this.fillRect(u+this.halfPixel,k-w+(j*b||0),n+this.halfPixel,2*w)}},drawWave:function(a,b,c,d){var e=this;if(a[0]instanceof Array){var r=a;if(this.params.splitChannels)return this.setHeight(r.length*this.params.height*this.params.pixelRatio),void r.forEach(function(f,a){e.drawWave(f,a,c,d)});a=r[0]}var g=[].some.call(a,function(b){return 0>b});if(!g){for(var s=[],i=0,j=a.length;i<j;i++)s[2*i]=a[i],s[2*i+1]=-a[i];a=s}var k=this.params.height*this.params.pixelRatio,l=k*b||0,m=k/2,n=1/this.params.barHeight;if(this.params.normalize){var o=f.util.max(a),p=f.util.min(a);n=-p>o?-p:o}this.drawLine(a,n,m,l,c,d),this.fillRect(0,m+l-this.halfPixel,this.width,this.halfPixel)},drawLine:function(i,a,b,c,d,e){for(var f in this.canvases){var g=this.canvases[f];this.setFillStyles(g),this.drawLineToContext(g,g.waveCtx,i,a,b,c,d,e),this.drawLineToContext(g,g.progressCtx,i,a,b,c,d,e)}},drawLineToContext:function(s,a,b,c,d,e,f,g){if(a){var h=b.length/2,i=1;this.params.fillParent&&this.width!=h&&(i=this.width/h);var j=t(h*s.start),k=t(h*s.end);if(!(j>g||k<f)){var l=y(j,f),m=r(k,g);a.beginPath(),a.moveTo((l-j)*i+this.halfPixel,d+e);for(var n=l;n<m;n++){var o=b[2*n]||0,p=t(o/c*d);a.lineTo((n-j)*i+this.halfPixel,d-p+e)}for(var n=m-1;n>=l;n--){var o=b[2*n+1]||0,p=t(o/c*d);a.lineTo((n-j)*i+this.halfPixel,d-p+e)}a.closePath(),a.fill()}}},fillRect:function(m,a,n,c){for(var d=l(m/this.maxCanvasWidth),e=r(k((m+n)/this.maxCanvasWidth)+1,this.canvases.length),f=d;f<e;f++){var g=this.canvases[f],h=f*this.maxCanvasWidth,i={x1:y(m,f*this.maxCanvasWidth),y1:a,x2:r(m+n,f*this.maxCanvasWidth+g.waveCtx.canvas.width),y2:a+c};i.x1<i.x2&&(this.setFillStyles(g),this.fillRectToContext(g.waveCtx,i.x1-h,i.y1,i.x2-i.x1,i.y2-i.y1),this.fillRectToContext(g.progressCtx,i.x1-h,i.y1,i.x2-i.x1,i.y2-i.y1))}},fillRectToContext:function(f,a,b,c,d){f&&f.fillRect(a,b,c,d)},setFillStyles:function(b){b.waveCtx.fillStyle=this.params.waveColor,this.hasProgressCanvas&&(b.progressCtx.fillStyle=this.params.progressColor)},updateProgress:function(b){this.style(this.progressWave,{width:b+"px"})},getImage:function(e,a){var b=[];return this.canvases.forEach(function(c){b.push(c.wave.toDataURL(e,a))}),1<b.length?b:b[0]}}),f.Drawer.SplitWavePointPlot=Object.create(f.Drawer.Canvas),f.util.extend(f.Drawer.SplitWavePointPlot,{defaultPlotParams:{plotNormalizeTo:"whole",plotTimeStart:0,plotMin:0,plotMax:1,plotColor:"#f63",plotProgressColor:"#F00",plotPointHeight:2,plotPointWidth:2,plotSeparator:!0,plotSeparatorColor:"black",plotRangeDisplay:!1,plotRangeUnits:"",plotRangePrecision:4,plotRangeIgnoreOutliers:!1,plotRangeFontSize:12,plotRangeFontType:"Ariel",waveDrawMedianLine:!0,plotFileDelimiter:"\t"},plotTimeStart:0,plotTimeEnd:-1,plotArrayLoaded:!1,plotArray:[],plotPoints:[],plotMin:0,plotMax:1,initDrawer:function(e){var f=this;for(var a in this.defaultPlotParams)void 0===this.params[a]&&(this.params[a]=this.defaultPlotParams[a]);if(this.plotTimeStart=this.params.plotTimeStart,void 0!==this.params.plotTimeEnd&&(this.plotTimeEnd=this.params.plotTimeEnd),Array.isArray(e.plotArray))this.plotArray=e.plotArray,this.plotArrayLoaded=!0;else{var b=function(b){f.plotArray=b,f.plotArrayLoaded=!0,f.fireEvent("plot_array_loaded")};this.loadPlotArrayFromFile(e.plotFileUrl,b,this.params.plotFileDelimiter)}},drawPeaks:function(f,a,b,c){if(1==this.plotArrayLoaded)this.setWidth(a),this.splitChannels=!0,this.params.height/=2,f[0]instanceof Array&&(f=f[0]),this.params.barWidth?this.drawBars(f,1,b,c):this.drawWave(f,1,b,c),this.params.height=2*this.params.height,this.calculatePlots(),this.drawPlots();else{var d=this;d.on("plot-array-loaded",function(){d.drawPeaks(f,a,b,c)})}},drawPlots:function(){var g=this.params.height*this.params.pixelRatio/2,a=.5/this.params.pixelRatio;for(var b in this.waveCc.fillStyle=this.params.plotColor,this.progressCc&&(this.progressCc.fillStyle=this.params.plotProgressColor),this.plotPoints){var c=parseInt(b),d=g-this.params.plotPointHeight-this.plotPoints[b]*(g-this.params.plotPointHeight),e=this.params.plotPointHeight;this.waveCc.fillRect(c,d,this.params.plotPointWidth,e),this.progressCc&&this.progressCc.fillRect(c,d,this.params.plotPointWidth,e)}this.params.plotSeparator&&(this.waveCc.fillStyle=this.params.plotSeparatorColor,this.waveCc.fillRect(0,g,this.width,a)),this.params.plotRangeDisplay&&this.displayPlotRange()},displayPlotRange:function(){var d=this.params.plotRangeFontSize*this.params.pixelRatio,a=this.plotMax.toPrecision(this.params.plotRangePrecision)+" "+this.params.plotRangeUnits,b=this.plotMin.toPrecision(this.params.plotRangePrecision)+" "+this.params.plotRangeUnits;this.waveCc.font=d.toString()+"px "+this.params.plotRangeFontType,this.waveCc.fillText(a,3,d),this.waveCc.fillText(b,3,this.height/2)},calculatePlots:function(){this.plotPoints={},this.calculatePlotTimeEnd();for(var l,i=[],a=-1,b=0,c=99999999999999,d=0,e=99999999999999,f=this.plotTimeEnd-this.plotTimeStart,g=0;g<this.plotArray.length;g++)if(l=this.plotArray[g],l.value>b&&(b=l.value),l.value<c&&(c=l.value),l.time>=this.plotTimeStart&&l.time<=this.plotTimeEnd){var h=t(this.width*(l.time-this.plotTimeStart)/f);if(i.push(l.value),h!==a&&0<i.length){var j=this.avg(i);j>d&&(d=j),j<e&&(e=j),this.plotPoints[a]=j,i=[]}a=h}"whole"==this.params.plotNormalizeTo?(this.plotMin=c,this.plotMax=b):"values"==this.params.plotNormalizeTo?(this.plotMin=this.params.plotMin,this.plotMax=this.params.plotMax):(this.plotMin=e,this.plotMax=d),this.normalizeValues()},normalizeValues:function(){var d={};if("none"!==this.params.plotNormalizeTo){for(var a in this.plotPoints){var b=(this.plotPoints[a]-this.plotMin)/(this.plotMax-this.plotMin);1<b?this.params.plotRangeIgnoreOutliers||(d[a]=1):0>b?this.params.plotRangeIgnoreOutliers||(d[a]=0):d[a]=b}this.plotPoints=d}},loadPlotArrayFromFile:function(a,h,c){void 0===c&&(c="\t");var d=[],e=f.util.ajax({url:a,responseType:"text"});e.on("load",function(e){if(200==e.currentTarget.status){for(var a,g=e.currentTarget.responseText.split("\n"),b=0;b<g.length;b++)a=g[b].split(c),2==a.length&&d.push({time:parseFloat(a[0]),value:parseFloat(a[1])});h(d)}})},calculatePlotTimeEnd:function(){this.plotTimeEnd=void 0===this.params.plotTimeEnd?this.plotArray[this.plotArray.length-1].time:this.params.plotTimeEnd},avg:function(c){var a=c.reduce(function(c,a){return c+a});return a/c.length}}),f.util.extend(f.Drawer.SplitWavePointPlot,f.Observer),f.PeakCache={init:function(){this.clearPeakCache()},clearPeakCache:function(){this.peakCacheRanges=[],this.peakCacheLength=-1},addRangeToPeakCache:function(g,a,b){g!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=g);for(var c=[],d=0;d<this.peakCacheRanges.length&&this.peakCacheRanges[d]<a;)d++;for(0==d%2&&c.push(a);d<this.peakCacheRanges.length&&this.peakCacheRanges[d]<=b;)c.push(this.peakCacheRanges[d]),d++;0==d%2&&c.push(b),c=c.filter(function(d,a,b){return 0==a?d!=b[a+1]:a==b.length-1?d!=b[a-1]:d!=b[a-1]&&d!=b[a+1]}),this.peakCacheRanges=this.peakCacheRanges.concat(c),this.peakCacheRanges=this.peakCacheRanges.sort(function(c,a){return c-a}).filter(function(d,a,b){return 0==a?d!=b[a+1]:a==b.length-1?d!=b[a-1]:d!=b[a-1]&&d!=b[a+1]});var e=[];for(d=0;d<c.length;d+=2)e.push([c[d],c[d+1]]);return e},getCacheRanges:function(){for(var c=[],a=0;a<this.peakCacheRanges.length;a+=2)c.push([this.peakCacheRanges[a],this.peakCacheRanges[a+1]]);return c}},function(){var a=function(){var a=document.querySelectorAll("wavesurfer");Array.prototype.forEach.call(a,function(a){var g=f.util.extend({container:a,backend:"MediaElement",mediaControls:!0},a.dataset);a.style.display="block";var c=f.create(g);if(a.dataset.peaks)var d=JSON.parse(a.dataset.peaks);c.load(a.dataset.url,d)})};"complete"===document.readyState?a():window.addEventListener("load",a)}(),f});