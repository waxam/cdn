<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html"><link rel="prefetch" href="../polymer/polymer-mini.html"><link rel="prefetch" href="../polymer/polymer-micro.html"><link rel="prefetch" href="../iron-icon/iron-icon.html"><link rel="prefetch" href="../iron-meta/iron-meta.html"><link rel="prefetch" href="../iron-flex-layout/iron-flex-layout.html"><link rel="prefetch" href="../iron-iconset-svg/iron-iconset-svg.html"><link rel="prefetch" href="../paper-behaviors/paper-inky-focus-behavior.html"><link rel="prefetch" href="../iron-behaviors/iron-button-state.html"><link rel="prefetch" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="prefetch" href="../iron-behaviors/iron-control-state.html"><link rel="prefetch" href="../paper-behaviors/paper-ripple-behavior.html"><link rel="prefetch" href="../paper-ripple/paper-ripple.html"><link rel="prefetch" href="../paper-styles/default-theme.html"><link rel="prefetch" href="../paper-styles/color.html"><link rel="prefetch" href="../iron-collapse/iron-collapse.html"><link rel="prefetch" href="../iron-resizable-behavior/iron-resizable-behavior.html"><link rel="prefetch" href="../paper-item/paper-item-body.html"><link rel="prefetch" href="../paper-styles/typography.html"><link rel="prefetch" href="../font-roboto/roboto.html"><link rel="prefetch" href="../paper-styles/paper-styles.html"><link rel="prefetch" href="../paper-styles/shadow.html"><link rel="prefetch" href="../paper-collapse-item/simple-paper-item.html"><link rel="prefetch" href="../paper-item/paper-item-behavior.html"><link rel="prefetch" href="../paper-item/paper-item-shared-styles.html"><link rel="prefetch" href="../iron-ajax/iron-ajax.html"><link rel="prefetch" href="../iron-ajax/iron-request.html"><link rel="prefetch" href="../intl-messageformat/dist/intl-messageformat.min.js"><link rel="prefetch" href="../paper-checkbox/paper-checkbox.html"><link rel="prefetch" href="../paper-behaviors/paper-checked-element-behavior.html"><link rel="prefetch" href="../iron-checked-element-behavior/iron-checked-element-behavior.html"><link rel="prefetch" href="../iron-validatable-behavior/iron-validatable-behavior.html"><link rel="prefetch" href="../iron-form-element-behavior/iron-form-element-behavior.html"><link rel="prefetch" href="../paper-dropdown-menu/paper-dropdown-menu.html"><link rel="prefetch" href="../paper-input/paper-input.html"><link rel="prefetch" href="../iron-input/iron-input.html"><link rel="prefetch" href="../iron-a11y-announcer/iron-a11y-announcer.html"><link rel="prefetch" href="../paper-input/paper-input-behavior.html"><link rel="prefetch" href="../paper-input/paper-input-char-counter.html"><link rel="prefetch" href="../paper-input/paper-input-addon-behavior.html"><link rel="prefetch" href="../paper-input/paper-input-container.html"><link rel="prefetch" href="../paper-input/paper-input-error.html"><link rel="prefetch" href="../paper-menu-button/paper-menu-button.html"><link rel="prefetch" href="../iron-dropdown/iron-dropdown.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-overlay-behavior.html"><link rel="prefetch" href="../iron-fit-behavior/iron-fit-behavior.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-overlay-manager.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-overlay-backdrop.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-scroll-manager.html"><link rel="prefetch" href="../iron-overlay-behavior/iron-focusables-helper.html"><link rel="prefetch" href="../neon-animation/neon-animation-runner-behavior.html"><link rel="prefetch" href="../neon-animation/neon-animatable-behavior.html"><link rel="prefetch" href="../iron-dropdown/iron-dropdown-scroll-manager.html"><link rel="prefetch" href="../neon-animation/animations/fade-in-animation.html"><link rel="prefetch" href="../neon-animation/neon-animation-behavior.html"><link rel="prefetch" href="../neon-animation/animations/fade-out-animation.html"><link rel="prefetch" href="../paper-menu-button/paper-menu-button-animations.html"><link rel="prefetch" href="../paper-dropdown-menu/paper-dropdown-menu-icons.html"><link rel="prefetch" href="../paper-dropdown-menu/paper-dropdown-menu-shared-styles.html"><link rel="prefetch" href="../paper-menu/paper-menu.html"><link rel="prefetch" href="../iron-menu-behavior/iron-menu-behavior.html"><link rel="prefetch" href="../iron-selector/iron-multi-selectable.html"><link rel="prefetch" href="../iron-selector/iron-selectable.html"><link rel="prefetch" href="../iron-selector/iron-selection.html"><link rel="prefetch" href="../paper-menu/paper-menu-shared-styles.html"><link rel="prefetch" href="../paper-item/paper-item.html"><link rel="prefetch" href="eco-json-schema-array.html"><link rel="prefetch" href="../paper-button/paper-button.html"><link rel="prefetch" href="../paper-behaviors/paper-button-behavior.html"><link rel="prefetch" href="../paper-styles/element-styles/paper-material-styles.html"><link rel="prefetch" href="eco-json-schema-geolocation.html"><link rel="prefetch" href="../iron-icons/communication-icons.html"><link rel="prefetch" href="../geo-location/geo-location.html"><link rel="prefetch" href="../google-map/google-map.html"><link rel="prefetch" href="../google-apis/google-maps-api.html"><link rel="prefetch" href="../iron-jsonp-library/iron-jsonp-library.html"><link rel="prefetch" href="../iron-selector/iron-selector.html"><link rel="prefetch" href="../google-map/google-map-marker.html"></head><body><dom-module id="eco-json-schema-array"><link rel="import" href="../iron-icons/iron-icons.html"><link rel="import" href="../iron-icons/editor-icons.html"><link rel="import" href="../paper-icon-button/paper-icon-button.html"><link rel="import" href="../paper-tooltip/paper-tooltip.html"><link rel="import" href="../paper-collapse-item/paper-collapse-item.html"><link rel="import" href="../paper-collapse-item/paper-collapse-group.html"><link rel="import" href="../app-localize-behavior/app-localize-behavior.html"><link rel="import" href="./eco-json-schema-boolean.html"><link rel="import" href="./eco-json-schema-enum.html"><link rel="import" href="./eco-json-schema-input.html"><link rel="import" href="./eco-json-schema-object.html"><link rel="import" href="./eco-json-schema-file.html"><template><style is="custom-style" include="iron-flex iron-flex-alignment">paper-input{padding:2px;--paper-input-container-label:{white-space:normal;position:static;font-size:22px;color:#212121;};}paper-collapse-item{--paper-collapse-item-header:{font-weight:bold;padding:8px 0 0 8px;};}#form{border:1px solid #AAAAAA;}#form div:nth-child(odd){background-color:#F2F2F2;padding:4px;}#form div:nth-child(even){background-color:#E2E2E2;border-top:1px solid #AAAAAA;border-bottom:1px solid #AAAAAA;padding:4px;}#form div:focus,
      #form div:hover,
      #form div:active{background-color:#FFFFFF !important;}paper-icon-button{float:right;border-radius:50%;}.array-add{color:#34e79a;background-color:#f8f8f8;}.array-remove-element{color:#f44336;background-color:#f8f8f8;}.label{@apply (--paper-input-container-label);white-space:normal;position:static;font-size:22px;color:#212121;}:host{display:block;.label{@apply (--paper-input-container-label);white-space:normal;position:static;font-size:22px;color:#212121;}}</style><div class="horizontal layout"><div class="flex" hidden$="[[!label]]">[[label]]</div><paper-icon-button id="addarray" class="array-add" icon="add" on-click="_onAddItem"></paper-icon-button><paper-tooltip for="addarray">add</paper-tooltip></div><paper-collapse-group id="form" class="vertical flex layout"></paper-collapse-group></template><script>Polymer({is:'eco-json-schema-array',properties:{schema:{type:Object,observer:'_schemaChanged'},label:{type:String},value:{type:Array,notify:!0,value:function(){return[]},observer:'_valueChanged'},error:{type:Object,observer:'_errorChanged'},_schemaArrayItems:{type:Array,notify:!0,value:function(){return[]}}},observers:['_schemaArraySplicesChanged(_schemaArrayItems.splices)'],_valueChanged:function(a,b){var c=this;a!==b&&('undefined'===typeof a?'undefined':babelHelpers.typeof(a))!=='undefined'&&babelHelpers.typeof(this.schema)!=='undefined'&&setTimeout(function(){for(var b in c._buildSchemaArrayItems(),a)c._onAddItemWithValue(a[b],parseInt(b))},100)},ready:function(){},detached:function(){this._clearForm()},_buildSchemaArrayItems:function(){this._schemaArrayItems=[]},_setValue:function(){this.value=[],this.value=this._schemaArrayItems.map(function(a){return a.value})},_schemaArraySplicesChanged:function(a){if(!a)return console.warn('detail is undefined');var b=this;a.keySplices&&console.warn('Got keySplices, don\'t know what to do with them!'),a.indexSplices.forEach(function(a){var c=['value',a.index,a.removed.length];if(a.removed&&a.removed.length)for(var d=a.index,e=a.index+a.removed.length;d<e;d++)b._removeArrayEl(b.$.form.children[d]);if(a.addedCount)for(var d=a.index,e=a.index+a.addedCount;d<e;d++){var f=a.object[d],g=b.create(f.component.name,{label:f.label,schema:f.schema,schemaArrayItem:f}),h=b.create('paper-collapse-item',{header:'Item '+(d+1)}),i=b.create('paper-icon-button',{icon:'remove'}),j=b.create('paper-tooltip');Polymer.dom(j).appendChild(document.createTextNode('remove')),b.listen(i,'tap','_onRemoveItem'),i.classList.add('array-remove-element'),g.classList.add('flex','horizontal','layout'),Polymer.dom(h).appendChild(g),Polymer.dom(h).appendChild(i),Polymer.dom(h).appendChild(j);var k=b.$.form.children[d];k?Polymer.dom(b.$.form).insertBefore(h,k):Polymer.dom(b.$.form).appendChild(h),b.listen(g,f.component.valueProperty.replace(/([A-Z])/g,'-$1').toLowerCase()+'-changed','_schemaArrayItemChanged'),c.push(b._deepClone(g[f.component.valueProperty]))}b.splice.apply(b,c)})},_schemaArrayItemChanged:function(a,b){if(!(b.path&&/\.length$/.test(b.path))){var c=this,d=a.target.schemaArrayItem,e=this._schemaArrayItems.indexOf(d),f=['value',e];b.path&&/\.splices$/.test(b.path)?(f=f.concat(b.path.split('.').slice(1,-1)),b.value.keySplices&&console.warn('Got keySplices, don\'t know what to do with them!'),b.value.indexSplices.forEach(function(a){var b=[f.join('.'),a.index,a.removed.length];if(a.addedCount)for(var d=a.index,e=a.index+a.addedCount;d<e;d++)b.push(c._deepClone(a.object[d]));c.splice.apply(c,b)})):b.path?(f=f.concat(b.path.split('.').slice(1)),this.set(f,this._deepClone(b.value))):this.splice('value',e,1,this._deepClone(b.value))}},_removeArrayEl:function(a){var b=Polymer.dom(a);babelHelpers.typeof(b.childNodes[0])!=='undefined'&&(this.unlisten(b.childNodes[0],b.firstChild.schemaArrayItem.component.valueProperty.replace(/([A-Z])/g,'-$1').toLowerCase()+'-changed','_schemaArrayItemChanged'),babelHelpers.typeof(b.childNodes[1])!=='undefined'&&this.unlisten(b.childNodes[1],'tap','_onRemoveItem')),a.schemaArrayItem=null,Polymer.dom(this.$.form).removeChild(a)},_clearForm:function(){for(var a=Polymer.dom(this.$.form);a.firstChild;)this._removeArrayEl(a.firstChild)},_schemaChanged:function(){this._clearForm(),this._buildSchemaArrayItems(),this._setValue()},_errorChanged:function(){var a=this;Polymer.dom(this.$.form).childNodes.forEach(function(b,c){Polymer.dom(b).childNodes[0].error=a.error&&a.error[c]?a.error[c]:null})},_onAddItemWithValue:function(a,b){var c=this.schema.items;if(('undefined'===typeof a?'undefined':babelHelpers.typeof(a))!=='undefined')for(var d in a)babelHelpers.typeof(c.properties[d])!=='undefined'&&(c.properties[d].value=a[d]);var e={label:c.title,schema:c,component:c.component||{}};if(e.component.valueProperty||(e.component.valueProperty='value'),!e.component.name)if(this._isSchemaEnum(c))e.component.name='eco-json-schema-enum';else if(this._isSchemaBoolean(c.type))e.component.name='eco-json-schema-boolean';else if(this._isSchemaFile(c.type))e.component.name='eco-json-schema-file';else if(this._isSchemaValue(c.type))e.component.name='eco-json-schema-input';else if(this._isSchemaObject(c.type))e.component.name='eco-json-schema-object';else if(this._isSchemaArray(c.type))e.component.name='eco-json-schema-array';else return console.error('Unknown item type %s',c.type);var f=this,g=f.create(e.component.name,{label:e.label,schema:e.schema,schemaArrayItem:e}),h=f.create('paper-collapse-item',{header:'Item '+(b+1)}),i=f.create('paper-icon-button',{icon:'remove'}),j=f.create('paper-tooltip');Polymer.dom(j).appendChild(document.createTextNode('remove')),f.listen(i,'tap','_onRemoveItem'),i.classList.add('array-remove-element'),g.classList.add('flex','horizontal','layout'),Polymer.dom(h).appendChild(g),Polymer.dom(h).appendChild(i),Polymer.dom(h).appendChild(j);var k=f.$.form.children[d];k?Polymer.dom(f.$.form).insertBefore(h,k):Polymer.dom(f.$.form).appendChild(h),f.listen(g,e.component.valueProperty.replace(/([A-Z])/g,'-$1').toLowerCase()+'-changed','_schemaArrayItemChanged'),this._schemaArrayItems.push(e)},_onAddItem:function(){var a=this.schema.items,b={label:a.title,schema:a,component:a.component||{}};if(b.component.valueProperty||(b.component.valueProperty='value'),!b.component.name)if(this._isSchemaEnum(a))b.component.name='eco-json-schema-enum';else if(this._isSchemaBoolean(a.type))b.component.name='eco-json-schema-boolean';else if(this._isSchemaFile(a.type))b.component.name='eco-json-schema-file';else if(this._isSchemaValue(a.type))b.component.name='eco-json-schema-input';else if(this._isSchemaObject(a.type))b.component.name='eco-json-schema-object';else if(this._isSchemaArray(a.type))b.component.name='eco-json-schema-array';else return console.error('Unknown item type %s',a.type);this.push('_schemaArrayItems',b)},_onRemoveItem:function(a){var b=Polymer.dom(a).localTarget.previousSibling.schemaArrayItem,c=this._schemaArrayItems.indexOf(b);this.splice('_schemaArrayItems',c,1)},_deepClone:function(a){return JSON.parse(JSON.stringify(a))},_isSchemaValue:function(a){return this._isSchemaBoolean(a)||this._isSchemaNumber(a)||this._isSchemaString(a)||this._isSchemaFile(a)},_isSchemaFile:function(a){return Array.isArray(a)?-1!==a.indexOf('file'):'file'===a},_isSchemaBoolean:function(a){return Array.isArray(a)?-1!==a.indexOf('boolean'):'boolean'===a},_isSchemaEnum:function(a){return!!a.enum},_isSchemaNumber:function(a){return Array.isArray(a)?-1!==a.indexOf('number')||-1!==a.indexOf('integer'):'number'===a||'integer'===a},_isSchemaString:function(a){return Array.isArray(a)?-1!==a.indexOf('string'):'string'===a},_isSchemaObject:function(a){return'object'===a},_isSchemaArray:function(a){return'array'===a}});</script></dom-module></body></html>