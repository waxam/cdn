<html><head><link rel="import" href="../polymer/polymer.html"><link rel="import" href="../iron-flex-layout/iron-flex-layout-classes.html"><link rel="import" href="../app-localize-behavior/app-localize-behavior.html"><link rel="prefetch" href="../polymer/polymer-mini.html"><link rel="prefetch" href="../polymer/polymer-micro.html"><link rel="prefetch" href="../iron-ajax/iron-ajax.html"><link rel="prefetch" href="../iron-ajax/iron-request.html"><link rel="prefetch" href="../intl-messageformat/dist/intl-messageformat.min.js"><link rel="prefetch" href="../iron-flex-layout/iron-flex-layout.html"><link rel="prefetch" href="../paper-behaviors/paper-button-behavior.html"><link rel="prefetch" href="../iron-behaviors/iron-button-state.html"><link rel="prefetch" href="../iron-a11y-keys-behavior/iron-a11y-keys-behavior.html"><link rel="prefetch" href="../iron-behaviors/iron-control-state.html"><link rel="prefetch" href="../paper-behaviors/paper-ripple-behavior.html"><link rel="prefetch" href="../paper-ripple/paper-ripple.html"><link rel="prefetch" href="../paper-styles/element-styles/paper-material-styles.html"><link rel="prefetch" href="../paper-styles/shadow.html"><link rel="prefetch" href="../iron-form-element-behavior/iron-form-element-behavior.html"><link rel="prefetch" href="../iron-input/iron-input.html"><link rel="prefetch" href="../iron-a11y-announcer/iron-a11y-announcer.html"><link rel="prefetch" href="../iron-validatable-behavior/iron-validatable-behavior.html"><link rel="prefetch" href="../iron-meta/iron-meta.html"><link rel="prefetch" href="../paper-input/paper-input-behavior.html"><link rel="prefetch" href="../paper-input/paper-input-char-counter.html"><link rel="prefetch" href="../paper-styles/typography.html"><link rel="prefetch" href="../font-roboto/roboto.html"><link rel="prefetch" href="../paper-input/paper-input-addon-behavior.html"><link rel="prefetch" href="../paper-input/paper-input-container.html"><link rel="prefetch" href="../paper-styles/default-theme.html"><link rel="prefetch" href="../paper-styles/color.html"><link rel="prefetch" href="../paper-input/paper-input-error.html"><link rel="prefetch" href="../iron-iconset-svg/iron-iconset-svg.html"></head><body><dom-module id="eco-json-schema-file"><link rel="import" href="../paper-button/paper-button.html"><link rel="import" href="../paper-input/paper-input.html"><link rel="import" href="../iron-icon/iron-icon.html"><link rel="import" href="../iron-icons/iron-icons.html"><template><style is="custom-style" include="iron-flex iron-flex-alignment">paper-input{padding:2px;--paper-input-container-label:{white-space:normal;position:static;font-size:22px;color:#212121;};}:host{display:inline-block;}.enabled{border:1px dashed #555;@apply (--file-upload-upload-border-enabled);}.hover{opacity:.7;border:1px dashed #111;@apply (--file-upload-upload-border-hover);}#UploadBorder{vertical-align:middle;color:#555;padding:20px;max-height:300px;overflow-y:auto;display:inline-block;@apply (--file-upload-upload-border);}#dropArea{text-align:center;@apply (--file-upload-drop-area);}paper-button#button{margin-bottom:20px;@apply (--file-upload-button);}.file{padding:10px 0px;@apply (--file-upload-file);}.commands{float:right;@apply (--file-upload-commands);}.commands iron-icon:not([icon="check-circle"]){cursor:pointer;opacity:.9;@apply (--file-upload-commands-faded);}.commands iron-icon:hover{opacity:1;@apply (--file-upload-commands-hovered);}[hidden]{display:none;}.error{color:#f40303;font-size:11px;margin-top:2px;@apply (--file-upload-error);}.progress-bar{margin-top:2px;}paper-progress{--paper-progress-active-color:#03a9f4;}paper-progress[error]{--paper-progress-active-color:#f40303;}</style><div class="layout horizontal nowrap"><div><paper-button id="button" on-click="_fileClick" alt="{{paperButtonAlt}}" raised=""><iron-icon icon="editor:attach-file"></iron-icon>{{paperButtonTitle}}</paper-button><div id="UploadBorder"><div id="dropArea" hidden$="{{!_shownDropText}}">{{dropText}}</div><template is="dom-repeat" items="{{files}}"><div class="file"><div class="name"><span>{{item.name}}</span><div class="commands"><iron-icon icon="autorenew" title="{{retryText}}" on-click="_retryUpload" hidden$="{{!item.error}}"></iron-icon><iron-icon icon="cancel" title="{{removeText}}" on-click="_cancelUpload" hidden$="{{item.complete}}"></iron-icon><iron-icon icon="check-circle" title="{{successText}}" hidden$="{{!item.complete}}"></iron-icon></div></div><div class="error" hidden$="{{!item.error}}">{{errorText}}</div></div></template></div></div><input type="file" id="fileInput" on-change="_fileChange" hidden="" multiple="{{multi}}" accept="{{accept}}"></div></template><script>Polymer({is:'eco-json-schema-file',behaviors:[Polymer.AppLocalizeBehavior],properties:{language:{value:'en',notify:!0},resources:{value:function(){return{}},notify:!0},schema:{type:Object,observer:'_schemaChanged'},value:{type:Object,notify:!0,value:function(){return{}},observer:'_valueChanged'},target:{type:String,value:''},accept:{type:String,value:''},droppable:{type:Boolean,value:!1},dropText:{type:String,value:'Drop Files Here'},multi:{type:Boolean,value:!0},files:{type:Array,notify:!0,value:function(){return[]}},raised:{type:Boolean,value:!0},noink:{type:Boolean,value:!1},headers:{type:Object,value:{}},retryText:{type:String,value:'Retry Upload'},removeText:{type:String,value:'Remove'},successText:{type:String,value:'Success'},errorText:{type:String,value:'Error uploading file...'},_shownDropText:{type:Boolean,value:!1},additional:{type:Object,value:{}},fileDataName:{type:String,value:'file'},paperButtonAlt:{type:String,value:''},paperButtonTitle:{type:String,value:''}},clear:function(){this.set('files',[]),this.$.fileInput.value='',this._showDropText()},ready:function(){this.raised&&this.toggleAttribute('raised',!0,this.$.button),this.noink&&this.toggleAttribute('noink',!0,this.$.button),this.droppable&&(this._showDropText(),this.setupDrop())},setupDrop:function(){var a=this.$.UploadBorder;this.toggleClass('enabled',!0,a),this.ondragover=function(b){b.stopPropagation(),this.toggleClass('hover',!0,a);var c=b.dataTransfer&&b.dataTransfer.dropEffect,d=b.dataTransfer&&b.dataTransfer.effectAllowed;return'none'===c&&'none'!==d&&(b.dataTransfer.dropEffect='move'===d?'move':'copy'),!1},this.ondragleave=function(){return this.toggleClass('hover',!1,a),!1},this.ondrop=function(b){if(this.toggleClass('hover',!1,a),b.preventDefault(),this.multi||0===this.files.length)for(var c=b.dataTransfer.files.length,d=0;d<c;d++){var e=b.dataTransfer.files[d],f=''===e.type?null:e.type.match(/^[^\/]*\//)[0],g=e.name.match(/\.[^\.]*$/)[0];(''===this.accept||-1<this.accept.indexOf(f)||-1<this.accept.indexOf(g))&&(e.progress=0,e.error=!1,e.complete=!1,this.push('files',e),this.uploadFile(e))}}},_fileClick:function(){var a=this.$.fileInput;if(a&&document.createEvent){var b=document.createEvent('MouseEvents');b.initEvent('click',!0,!1),a.dispatchEvent(b)}},_fileChange:function(a){for(var b,c=a.target.files.length,d=0;d<c;d++)b=a.target.files[d],b.progress=0,b.error=!1,b.complete=!1,this.push('files',b),this.multi||0===this.files.length||(this.set('files',[]),this.set('value',{})),this.uploadFile(b)},cancel:function(a){a&&(a.xhr&&a.xhr.abort(),this.splice('files',this.files.indexOf(a),1),this._showDropText())},_cancelUpload:function(a){this.cancel(a.model.__data__.item)},_retryUpload:function(a){a.model.set('item.error',!1),a.model.set('item.progress',0);var b=this;this.async(function(){b.uploadFile(a.model.__data__.item)},50)},_showDropText:function(){this.set('_shownDropText',!this.files.length&&this.droppable)},uploadFile:function(a){if(a){this.fire('before-upload'),this._showDropText();var b='files.'+this.files.indexOf(a),c=this,d=new FileReader;d.addEventListener('load',function(){var b=d.result;c.set('value.'+c.attributes.name.value+'.'+c.files.indexOf(a),b)},!1),c.value.hasOwnProperty(c.attributes.name.value)||this.set('value.'+c.attributes.name.value,{}),d.readAsDataURL(a)}},_valueChanged:function(){console.log('this.value: '+JSON.stringify(this.value))},_schemaChanged:function(){this.schema},_isSchemaValue:function(a){return this._isSchemaFile(a)},_isSchemaFile:function(a){return Array.isArray(a)?-1!==a.indexOf('file'):'file'===a},_isSchemaBoolean:function(a){return Array.isArray(a)?-1!==a.indexOf('boolean'):'boolean'===a},_isSchemaNumber:function(a){return Array.isArray(a)?-1!==a.indexOf('number')||-1!==a.indexOf('integer'):'number'===a||'integer'===a},_isSchemaString:function(a){return Array.isArray(a)?-1!==a.indexOf('string'):'string'===a},_isSchemaObject:function(a){return'object'===a},_isSchemaArray:function(a){return'array'===a},stringify:function(a){return JSON.stringify(a)}});</script></dom-module></body></html>