window.OpenSeadragon=window.OpenSeadragon||function(e){return new OpenSeadragon.Viewer(e)},"function"==typeof define&&define.amd&&define(function(){return window.OpenSeadragon}),!function(t){t.version={versionStr:"<%= osdVersion.versionStr %>",major:parseInt("<%= osdVersion.major %>",10),minor:parseInt("<%= osdVersion.minor %>",10),revision:parseInt("<%= osdVersion.revision %>",10)};var e={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},i=Object.prototype.toString,n=Object.prototype.hasOwnProperty;t.isFunction=function(e){return"function"===t.type(e)},t.isArray=Array.isArray||function(e){return"array"===t.type(e)},t.isWindow=function(e){return e&&"object"==("undefined"===typeof e?"undefined":babelHelpers.typeof(e))&&"setInterval"in e},t.type=function(t){return null===t||void 0===t?t+"":e[i.call(t)]||"object"},t.isPlainObject=function(i){if(!i||"object"!==OpenSeadragon.type(i)||i.nodeType||t.isWindow(i))return!1;if(i.constructor&&!n.call(i,"constructor")&&!n.call(i.constructor.prototype,"isPrototypeOf"))return!1;var o;for(var r in i)o=r;return void 0===o||n.call(i,o)},t.isEmptyObject=function(e){for(var t in e)return!1;return!0},t.freezeObject=function(e){return t.freezeObject=Object.freeze?Object.freeze:function(e){return e},t.freezeObject(e)},t.supportsCanvas=function(){var e=document.createElement("canvas");return t.isFunction(e.getContext)&&e.getContext("2d")}(),t.isCanvasTainted=function(e){var t=!1;try{e.getContext("2d").getImageData(0,0,1,1)}catch(e){t=!0}return t},t.pixelDensityRatio=function(){if(t.supportsCanvas){var e=document.createElement("canvas").getContext("2d"),i=window.devicePixelRatio||1,n=e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||e.backingStorePixelRatio||1;return i/n}return 1}()}(OpenSeadragon),!function(t){function e(e,t){return t&&e!=document.body?document.body:e.offsetParent}var i=Math.round;t.extend=function(){var t,n,o,r,a,e,l=arguments[0]||{},s=arguments.length,d=!1,i=1;for("boolean"==typeof l&&(d=l,l=arguments[1]||{},i=2),"object"==("undefined"===typeof l?"undefined":babelHelpers.typeof(l))||OpenSeadragon.isFunction(l)||(l={}),s===i&&(l=this,--i);s>i;i++)if(t=arguments[i],null!==t||void 0!==t)for(n in t)o=l[n],r=t[n],l!==r&&(d&&r&&(OpenSeadragon.isPlainObject(r)||(a=OpenSeadragon.isArray(r)))?(a?(a=!1,e=o&&OpenSeadragon.isArray(o)?o:[]):e=o&&OpenSeadragon.isPlainObject(o)?o:{},l[n]=OpenSeadragon.extend(d,e,r)):void 0!==r&&(l[n]=r));return l};var n=function(){if("object"!=("undefined"===typeof navigator?"undefined":babelHelpers.typeof(navigator)))return!1;var e=navigator.userAgent;return!("string"!=typeof e)&&(-1!==e.indexOf("iPhone")||-1!==e.indexOf("iPad")||-1!==e.indexOf("iPod"))};t.extend(t,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:n(),pixelsPerWheelLine:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,degrees:0,opacity:1,compositeOperation:null,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:"#437AB2"},SIGNAL:"----seadragon----",delegate:function(e,t){return function(){var i=arguments;return void 0===i&&(i=[]),t.apply(e,i)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(e){return"string"==typeof e&&(e=document.getElementById(e)),e},getElementPosition:function(i){var n,o,r=new t.Point;for(i=t.getElement(i),n="fixed"==t.getElementStyle(i).position,o=e(i,n);o;)r.x+=i.offsetLeft,r.y+=i.offsetTop,n&&(r=r.plus(t.getPageScroll())),i=o,n="fixed"==t.getElementStyle(i).position,o=e(i,n);return r},getElementOffset:function(i){i=t.getElement(i);var n,o,r=i&&i.ownerDocument,a={top:0,left:0};return r?(n=r.documentElement,"undefined"!=typeof i.getBoundingClientRect&&(a=i.getBoundingClientRect()),o=r==r.window?r:9===r.nodeType&&(r.defaultView||r.parentWindow),new t.Point(a.left+(o.pageXOffset||n.scrollLeft)-(n.clientLeft||0),a.top+(o.pageYOffset||n.scrollTop)-(n.clientTop||0))):new t.Point},getElementSize:function(e){return e=t.getElement(e),new t.Point(e.clientWidth,e.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(e){return e=t.getElement(e),e.currentStyle}:function(e){return e=t.getElement(e),window.getComputedStyle(e,"")},getCssPropertyWithVendorPrefix:function(e){var i={};return t.getCssPropertyWithVendorPrefix=function(n){if(void 0!==i[n])return i[n];var o=document.createElement("div").style,r=null;if(void 0!==o[n])r=n;else for(var a,l=["Webkit","Moz","MS","O","webkit","moz","ms","o"],e=t.capitalizeFirstLetter(n),s=0;s<l.length;s++)if(a=l[s]+e,void 0!==o[a]){r=a;break}return i[n]=r,r},t.getCssPropertyWithVendorPrefix(e)},capitalizeFirstLetter:function(e){return e.charAt(0).toUpperCase()+e.slice(1)},pointInElement:function(e,i){e=t.getElement(e);var n=t.getElementOffset(e),o=t.getElementSize(e);return i.x>=n.x&&i.x<n.x+o.x&&i.y<n.y+o.y&&i.y>=n.y},getEvent:function(e){return t.getEvent=e?function(e){return e}:function(){return window.event},t.getEvent(e)},getMousePosition:function(e){if("number"==typeof e.pageX)t.getMousePosition=function(e){var i=new t.Point;return e=t.getEvent(e),i.x=e.pageX,i.y=e.pageY,i};else{if("number"!=typeof e.clientX)throw new Error("Unknown event mouse position, no known technique.");t.getMousePosition=function(e){var i=new t.Point;return e=t.getEvent(e),i.x=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,i.y=e.clientY+document.body.scrollTop+document.documentElement.scrollTop,i}}return t.getMousePosition(e)},getPageScroll:function(){var e=document.documentElement||{},i=document.body||{};if("number"==typeof window.pageXOffset)t.getPageScroll=function(){return new t.Point(window.pageXOffset,window.pageYOffset)};else if(i.scrollLeft||i.scrollTop)t.getPageScroll=function(){return new t.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!e.scrollLeft&&!e.scrollTop)return new t.Point(0,0);t.getPageScroll=function(){return new t.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return t.getPageScroll()},setPageScroll:function(e){if("undefined"!=typeof window.scrollTo)t.setPageScroll=function(e){window.scrollTo(e.x,e.y)};else{var i=t.getPageScroll();if(i.x===e.x&&i.y===e.y)return;document.body.scrollLeft=e.x,document.body.scrollTop=e.y;var n=t.getPageScroll();if(n.x!==i.x&&n.y!==i.y)return void(t.setPageScroll=function(e){document.body.scrollLeft=e.x,document.body.scrollTop=e.y});if(document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y,n=t.getPageScroll(),n.x!==i.x&&n.y!==i.y)return void(t.setPageScroll=function(e){document.documentElement.scrollLeft=e.x,document.documentElement.scrollTop=e.y});t.setPageScroll=function(){}}return t.setPageScroll(e)},getWindowSize:function(){var e=document.documentElement||{},i=document.body||{};if("number"==typeof window.innerWidth)t.getWindowSize=function(){return new t.Point(window.innerWidth,window.innerHeight)};else if(e.clientWidth||e.clientHeight)t.getWindowSize=function(){return new t.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!i.clientWidth&&!i.clientHeight)throw new Error("Unknown window size, no known technique.");t.getWindowSize=function(){return new t.Point(document.body.clientWidth,document.body.clientHeight)}}return t.getWindowSize()},makeCenteredNode:function(e){e=t.getElement(e);var i=[t.makeNeutralElement("div"),t.makeNeutralElement("div"),t.makeNeutralElement("div")];return t.extend(i[0].style,{display:"table",height:"100%",width:"100%"}),t.extend(i[1].style,{display:"table-row"}),t.extend(i[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),i[0].appendChild(i[1]),i[1].appendChild(i[2]),i[2].appendChild(e),i[0]},makeNeutralElement:function(e){var t=document.createElement(e),i=t.style;return i.background="transparent none",i.border="none",i.margin="0px",i.padding="0px",i.position="static",t},now:function(){return t.now=Date.now?Date.now:function(){return new Date().getTime()},t.now()},makeTransparentImage:function(e){return t.makeTransparentImage=function(e){var i=t.makeNeutralElement("img");return i.src=e,i},t.Browser.vendor==t.BROWSERS.IE&&7>t.Browser.version&&(t.makeTransparentImage=function(e){var i=t.makeNeutralElement("img"),n=null;return n=t.makeNeutralElement("span"),n.style.display="inline-block",i.onload=function(){n.style.width=n.style.width||i.width+"px",n.style.height=n.style.height||i.height+"px",i.onload=null,i=null},i.src=e,n.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+e+"', sizingMethod='scale')",n}),t.makeTransparentImage(e)},setElementOpacity:function(n,o,r){var a,l;n=t.getElement(n),r&&!t.Browser.alpha&&(o=i(o)),t.Browser.opacity?n.style.opacity=1>o?o:"":1>o?(a=i(100*o),l="alpha(opacity="+a+")",n.style.filter=l):n.style.filter=""},setElementTouchActionNone:function(e){e=t.getElement(e),"undefined"==typeof e.style.touchAction?"undefined"!=typeof e.style.msTouchAction&&(e.style.msTouchAction="none"):e.style.touchAction="none"},addClass:function(e,i){e=t.getElement(e),e.className?-1===(" "+e.className+" ").indexOf(" "+i+" ")&&(e.className+=" "+i):e.className=i},indexOf:function(e,t,i){return this.indexOf=Array.prototype.indexOf?function(e,t,i){return e.indexOf(t,i)}:function(t,i,n){var o,r,e=n?n:0;if(!t)throw new TypeError;if(r=t.length,0===r||e>=r)return-1;for(0>e&&(e=r-Math.abs(e)),o=e;r>o;o++)if(t[o]===i)return o;return-1},this.indexOf(e,t,i)},removeClass:function(i,n){var o,r,a=[];for(i=t.getElement(i),o=i.className.split(/\s+/),r=0;r<o.length;r++)o[r]&&o[r]!==n&&a.push(o[r]);i.className=a.join(" ")},addEvent:function(){if(window.addEventListener)return function(e,i,n,o){e=t.getElement(e),e.addEventListener(i,n,o)};if(window.attachEvent)return function(e,i,n){e=t.getElement(e),e.attachEvent("on"+i,n)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(e,i,n,o){e=t.getElement(e),e.removeEventListener(i,n,o)};if(window.detachEvent)return function(e,i,n){e=t.getElement(e),e.detachEvent("on"+i,n)};throw new Error("No known event model.")}(),cancelEvent:function(e){e=t.getEvent(e),t.cancelEvent=e.preventDefault?function(e){e.preventDefault()}:function(e){e=t.getEvent(e),e.cancel=!0,e.returnValue=!1},t.cancelEvent(e)},stopEvent:function(e){e=t.getEvent(e),t.stopEvent=e.stopPropagation?function(e){e.stopPropagation()}:function(e){e=t.getEvent(e),e.cancelBubble=!0},t.stopEvent(e)},createCallback:function(t,i){var e,n=[];for(e=2;e<arguments.length;e++)n.push(arguments[e]);return function(){var o,r=n.concat([]);for(o=0;o<arguments.length;o++)r.push(arguments[o]);return i.apply(t,r)}},getUrlParameter:function(e){var t=r[e];return t?t:null},getUrlProtocol:function(e){var t=e.match(/^([a-z]+:)\/\//i);return null===t?window.location.protocol:t[1].toLowerCase()},createAjaxRequest:function(e){var i;try{i=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(e){i=!1}if(i)t.createAjaxRequest=window.XMLHttpRequest?function(e){return e?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");t.createAjaxRequest=function(){return new XMLHttpRequest}}return t.createAjaxRequest(e)},makeAjaxRequest:function(n,o,r){var a;t.isPlainObject(n)&&(o=n.success,r=n.error,a=n.withCredentials,n=n.url);var l=t.getUrlProtocol(n),e=t.createAjaxRequest("file:"===l);if(!t.isFunction(o))throw new Error("makeAjaxRequest requires a success callback");e.onreadystatechange=function(){4==e.readyState&&(e.onreadystatechange=function(){},200===e.status||0===e.status&&"http:"!==l&&"https:"!==l?o(e):(t.console.log("AJAX request returned %d: %s",e.status,n),t.isFunction(r)&&r(e)))},a&&(e.withCredentials=!0);try{e.open("GET",n,!0),e.send(null)}catch(a){var s=a.message,d=t.Browser.vendor==t.BROWSERS.IE&&10>t.Browser.version;if(d&&"undefined"!=typeof a.number&&-2147024891==a.number&&(s+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),t.console.log("%s while making AJAX request: %s",a.name,s),e.onreadystatechange=function(){},window.XDomainRequest){var i=new XDomainRequest;if(i){i.onload=function(){t.isFunction(o)&&o({responseText:i.responseText,status:200,statusText:"OK"})},i.onerror=function(){t.isFunction(r)&&r({responseText:i.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{i.open("GET",n),i.send()}catch(i){t.isFunction(r)&&r(e,a)}}}else t.isFunction(r)&&r(e,a)}},jsonp:function(n){var o,r=n.url,l=document.head||document.getElementsByTagName("head")[0]||document.documentElement,s=n.callbackName||"openseadragon"+t.now(),e=window[s],a=n.param||"callback",d=n.callback;r=r.replace(/(\=)\?(&|$)|\?\?/i,"$1"+s+"$2"),r+=(/\?/.test(r)?"&":"?")+a+"="+s,window[s]=function(i){if(e)window[s]=e;else try{delete window[s]}catch(e){}d&&t.isFunction(d)&&d(i)},o=document.createElement("script"),(void 0!==n.async||!1!==n.async)&&(o.async="async"),n.scriptCharset&&(o.charset=n.scriptCharset),o.src=r,o.onload=o.onreadystatechange=function(e,t){(t||!o.readyState||/loaded|complete/.test(o.readyState))&&(o.onload=o.onreadystatechange=null,l&&o.parentNode&&l.removeChild(o),o=void 0)},l.insertBefore(o,l.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(e){if(window.DOMParser)t.parseXml=function(e){var t,i=null;return t=new DOMParser,i=t.parseFromString(e,"text/xml"),i};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");t.parseXml=function(e){var t=null;return t=new ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.loadXML(e),t}}return t.parseXml(e)},parseJSON:function(e){return t.parseJSON=window.JSON&&window.JSON.parse?window.JSON.parse:function(e){return eval("("+e+")")},t.parseJSON(e)},imageFormatSupported:function(e){return e=e?e:"",!!o[e.toLowerCase()]}}),t.Browser={vendor:t.BROWSERS.UNKNOWN,version:0,alpha:!0};var o={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},r={};!function(){var i,n=(navigator.appName,navigator.appVersion),o=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(o.substring(o.indexOf("MSIE")+5,o.indexOf(";",o.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(0<=o.indexOf("Firefox")?(t.Browser.vendor=t.BROWSERS.FIREFOX,t.Browser.version=parseFloat(o.substring(o.indexOf("Firefox")+8))):0<=o.indexOf("Safari")?(t.Browser.vendor=0<=o.indexOf("Chrome")?t.BROWSERS.CHROME:t.BROWSERS.SAFARI,t.Browser.version=parseFloat(o.substring(o.substring(0,o.indexOf("Safari")).lastIndexOf("/")+1,o.indexOf("Safari")))):(i=/Trident\/.*rv:([0-9]{1,}[.0-9]{0,})/,null!==i.exec(o)&&(t.Browser.vendor=t.BROWSERS.IE,t.Browser.version=parseFloat(RegExp.$1))));break;case"Opera":t.Browser.vendor=t.BROWSERS.OPERA,t.Browser.version=parseFloat(n);}var a,l,e,s=window.location.search.substring(1),d=s.split("&");for(e=0;e<d.length;e++)a=d[e],l=a.indexOf("="),0<l&&(r[a.substring(0,l)]=decodeURIComponent(a.substring(l+1)));t.Browser.alpha=!(t.Browser.vendor==t.BROWSERS.IE&&9>t.Browser.version||t.Browser.vendor==t.BROWSERS.CHROME&&2>t.Browser.version),t.Browser.opacity=!(t.Browser.vendor==t.BROWSERS.IE&&9>t.Browser.version)}();var a=function(){};t.console=window.console||{log:a,debug:a,info:a,warn:a,error:a,assert:a},!function(i){var n=i.requestAnimationFrame||i.mozRequestAnimationFrame||i.webkitRequestAnimationFrame||i.msRequestAnimationFrame,o=i.cancelAnimationFrame||i.mozCancelAnimationFrame||i.webkitCancelAnimationFrame||i.msCancelAnimationFrame;if(n&&o)t.requestAnimationFrame=function(){return n.apply(i,arguments)},t.cancelAnimationFrame=function(){return o.apply(i,arguments)};else{var r,l=[],e=[],s=0;t.requestAnimationFrame=function(i){return l.push([++s,i]),r||(r=setInterval(function(){if(l.length){var i=t.now(),n=e;for(e=l,l=n;e.length;)e.shift()[1](i)}else clearInterval(r),r=void 0},20)),s},t.cancelAnimationFrame=function(t){var i,n;for(i=0,n=l.length;n>i;i+=1)if(l[i][0]===t)return void l.splice(i,1);for(i=0,n=e.length;n>i;i+=1)if(e[i][0]===t)return void e.splice(i,1)}}}(window)}(OpenSeadragon),!function(e){var t={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.fullscreenElement},t.requestFullScreen=function(e){return e.requestFullscreen()},t.exitFullScreen=function(){document.exitFullscreen()},t.fullScreenEventName="fullscreenchange",t.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.msFullscreenElement},t.requestFullScreen=function(e){return e.msRequestFullscreen()},t.exitFullScreen=function(){document.msExitFullscreen()},t.fullScreenEventName="MSFullscreenChange",t.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitFullscreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullscreen()},t.exitFullScreen=function(){document.webkitExitFullscreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},t.requestFullScreen=function(e){return e.webkitRequestFullScreen()},t.exitFullScreen=function(){document.webkitCancelFullScreen()},t.fullScreenEventName="webkitfullscreenchange",t.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(t.supportsFullScreen=!0,t.getFullScreenElement=function(){return document.mozFullScreenElement},t.requestFullScreen=function(e){return e.mozRequestFullScreen()},t.exitFullScreen=function(){document.mozCancelFullScreen()},t.fullScreenEventName="mozfullscreenchange",t.fullScreenErrorEventName="mozfullscreenerror"),t.isFullScreen=function(){return null!==t.getFullScreenElement()},t.cancelFullScreen=function(){e.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),t.exitFullScreen()},e.extend(e,t)}(OpenSeadragon),!function(t){t.EventSource=function(){this.events={}},t.EventSource.prototype={addOnceHandler:function(t,i,n,o){var r=this;o=o||1;var e=0;this.addHandler(t,function n(a){e++,e===o&&r.removeHandler(t,n),i(a)},n)},addHandler:function(i,n,o){var r=this.events[i];r||(this.events[i]=r=[]),n&&t.isFunction(n)&&(r[r.length]={handler:n,userData:o||null})},removeHandler:function(i,n){var o,r=this.events[i],e=[];if(r&&t.isArray(r)){for(o=0;o<r.length;o++)r[o].handler!==n&&e.push(r[o]);this.events[i]=e}},removeAllHandlers:function(e){if(e)this.events[e]=[];else for(var t in this.events)this.events[t]=[]},getHandler:function(e){var t=this.events[e];return t&&t.length?(t=1===t.length?[t[0]]:Array.apply(null,t),function(i,n){var o,r=t.length;for(o=0;r>o;o++)t[o]&&(n.eventSource=i,n.userData=t[o].userData,t[o].handler(n))}):null},raiseEvent:function(e,t){var i=this.getHandler(e);i&&(t||(t={}),i(this,t))}}}(OpenSeadragon),!function(ee){function a(t){var i,n=he[t.hash],o=n.activePointersLists.length;for(i=0;o>i;i++)0<n.activePointersLists[i].captureCount&&(ee.removeEvent(ee.MouseTracker.captureElement,"mousemove",n.mousemovecaptured,!0),ee.removeEvent(ee.MouseTracker.captureElement,"mouseup",n.mouseupcaptured,!0),ee.removeEvent(ee.MouseTracker.captureElement,ee.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",n.pointermovecaptured,!0),ee.removeEvent(ee.MouseTracker.captureElement,ee.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",n.pointerupcaptured,!0),ee.removeEvent(ee.MouseTracker.captureElement,"touchmove",n.touchmovecaptured,!0),ee.removeEvent(ee.MouseTracker.captureElement,"touchend",n.touchendcaptured,!0),n.activePointersLists[i].captureCount=0);for(i=0;o>i;i++)n.activePointersLists.pop()}function b(t){var i,n,e=he[t.hash];if(!e.tracking){for(n=0;n<ee.MouseTracker.subscribeEvents.length;n++)i=ee.MouseTracker.subscribeEvents[n],ee.addEvent(t.element,i,e[i],!1);a(t),e.tracking=!0}}function c(t){var i,n,e=he[t.hash];if(e.tracking){for(n=0;n<ee.MouseTracker.subscribeEvents.length;n++)i=ee.MouseTracker.subscribeEvents[n],ee.removeEvent(t.element,i,e[i],!1);a(t),e.tracking=!1}}function te(e,t){var i=he[e.hash];if("pointerevent"===t)return{upName:ee.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:i.pointerupcaptured,moveName:ee.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:i.pointermovecaptured};if("mouse"===t)return{upName:"mouseup",upHandler:i.mouseupcaptured,moveName:"mousemove",moveHandler:i.mousemovecaptured};if("touch"===t)return{upName:"touchend",upHandler:i.touchendcaptured,moveName:"touchmove",moveHandler:i.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function ie(e,t,i){var n,o=e.getActivePointersListByType(t);o.captureCount+=i||1,1===o.captureCount&&(ee.Browser.vendor===ee.BROWSERS.IE&&9>ee.Browser.version?e.element.setCapture(!0):(n=te(e,ee.MouseTracker.havePointerEvents?"pointerevent":t),ve&&ge(window.top)&&ee.addEvent(window.top,n.upName,n.upHandler,!0),ee.addEvent(ee.MouseTracker.captureElement,n.upName,n.upHandler,!0),ee.addEvent(ee.MouseTracker.captureElement,n.moveName,n.moveHandler,!0)))}function ne(e,t,i){var n,o=e.getActivePointersListByType(t);o.captureCount-=i||1,0===o.captureCount&&(ee.Browser.vendor===ee.BROWSERS.IE&&9>ee.Browser.version?e.element.releaseCapture():(n=te(e,ee.MouseTracker.havePointerEvents?"pointerevent":t),ve&&ge(window.top)&&ee.removeEvent(window.top,n.upName,n.upHandler,!0),ee.removeEvent(ee.MouseTracker.captureElement,n.moveName,n.moveHandler,!0),ee.removeEvent(ee.MouseTracker.captureElement,n.upName,n.upHandler,!0)))}function e(e){var t;if(ee.MouseTracker.unprefixedPointerEvents)t=e.pointerType;else switch(e.pointerType){case 2:t="touch";break;case 3:t="pen";break;case 4:t="mouse";break;default:t="";}return t}function oe(e){return ee.getMousePosition(e)}function i(e,t){return re(oe(e),t)}function re(e,t){var i=ee.getElementOffset(t);return e.minus(i)}function k(e,t){return new ee.Point((e.x+t.x)/2,(e.y+t.y)/2)}function l(e,t){e.clickHandler&&ee.cancelEvent(t)}function g(e,t){e.dblClickHandler&&ee.cancelEvent(t)}function n(e,t){var i;e.keyDownHandler&&(t=ee.getEvent(t),i=e.keyDownHandler({eventSource:e,keyCode:t.keyCode?t.keyCode:t.charCode,ctrl:t.ctrlKey,shift:t.shiftKey,alt:t.altKey,meta:t.metaKey,originalEvent:t,preventDefaultAction:!1,userData:e.userData}),i||ee.cancelEvent(t))}function o(e,t){var i;e.keyUpHandler&&(t=ee.getEvent(t),i=e.keyUpHandler({eventSource:e,keyCode:t.keyCode?t.keyCode:t.charCode,ctrl:t.ctrlKey,shift:t.shiftKey,alt:t.altKey,meta:t.metaKey,originalEvent:t,preventDefaultAction:!1,userData:e.userData}),i||ee.cancelEvent(t))}function p(e,t){var i;e.keyHandler&&(t=ee.getEvent(t),i=e.keyHandler({eventSource:e,keyCode:t.keyCode?t.keyCode:t.charCode,ctrl:t.ctrlKey,shift:t.shiftKey,alt:t.altKey,meta:t.metaKey,originalEvent:t,preventDefaultAction:!1,userData:e.userData}),i||ee.cancelEvent(t))}function m(e,t){var i;e.focusHandler&&(t=ee.getEvent(t),i=e.focusHandler({eventSource:e,originalEvent:t,preventDefaultAction:!1,userData:e.userData}),!1===i&&ee.cancelEvent(t))}function r(e,t){var i;e.blurHandler&&(t=ee.getEvent(t),i=e.blurHandler({eventSource:e,originalEvent:t,preventDefaultAction:!1,userData:e.userData}),!1===i&&ee.cancelEvent(t))}function s(e,t){u(e,t,t)}function t(e,t){t=ee.getEvent(t);var i={target:t.target||t.srcElement,type:"wheel",shiftKey:t.shiftKey||!1,clientX:t.clientX,clientY:t.clientY,pageX:t.pageX?t.pageX:t.clientX,pageY:t.pageY?t.pageY:t.clientY,deltaMode:"MozMousePixelScroll"==t.type?0:1,deltaX:0,deltaZ:0};i.deltaY="mousewheel"==ee.MouseTracker.wheelEventName?-1/ee.DEFAULT_SETTINGS.pixelsPerWheelLine*t.wheelDelta:t.detail,u(e,i,t)}function u(t,n,o){var r,e=0;e=0>n.deltaY?1:-1,t.scrollHandler&&(r=t.scrollHandler({eventSource:t,pointerType:"mouse",position:i(n,t.element),scroll:e,shift:n.shiftKey,isTouchEvent:!1,originalEvent:o,preventDefaultAction:!1,userData:t.userData}),!1===r&&ee.cancelEvent(o))}function v(e,t){if(e===t)return!1;for(;t&&t!==e;)t=t.parentNode;return t===e}function h(e,t){t=ee.getEvent(t),d(e,t)}function w(e,t){t=ee.getEvent(t),t.currentTarget===t.relatedTarget||v(t.currentTarget,t.relatedTarget)||d(e,t)}function d(e,t){var i={id:ee.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:oe(t),currentTime:ee.now()};ae(e,t,[i])}function y(e,t){t=ee.getEvent(t),f(e,t)}function x(e,t){t=ee.getEvent(t),t.currentTarget===t.relatedTarget||v(t.currentTarget,t.relatedTarget)||f(e,t)}function f(e,t){var i={id:ee.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:oe(t),currentTime:ee.now()};le(e,t,[i])}function C(e){return ee.Browser.vendor===ee.BROWSERS.IE&&9>ee.Browser.version?1===e?0:2===e?2:4===e?1:-1:e}function B(e,t){var i;t=ee.getEvent(t),i={id:ee.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:oe(t),currentTime:ee.now()},se(e,t,[i],C(t.button))&&(ee.stopEvent(t),ie(e,"mouse")),(e.clickHandler||e.dblClickHandler||e.pressHandler||e.dragHandler||e.dragEndHandler)&&ee.cancelEvent(t)}function E(e,t){z(e,t)}function D(e,t){z(e,t),ee.stopEvent(t)}function z(e,t){var i;t=ee.getEvent(t),i={id:ee.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:oe(t),currentTime:ee.now()},de(e,t,[i],C(t.button))&&ne(e,"mouse")}function H(e,t){F(e,t)}function I(e,t){F(e,t),ee.stopEvent(t)}function F(e,t){var i;t=ee.getEvent(t),i={id:ee.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:oe(t),currentTime:ee.now()},ce(e,t,[i])}function A(t,i,n){var o,r=n.getLength(),e=[];for(o=0;r>o;o++)e.push(n.getByIndex(o));0<e.length&&(de(t,i,e,0),n.captureCount=1,ne(t,"touch"),le(t,i,e))}function L(t,i){var n,o,e,r,a=i.changedTouches.length,s=[],c=t.getActivePointersListByType("touch");for(n=ee.now(),c.getLength()>i.touches.length-a&&(ee.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),A(t,i,c)),o=0;a>o;o++)s.push({id:i.changedTouches[o].identifier,type:"touch",currentPos:oe(i.changedTouches[o]),currentTime:n});for(ae(t,i,s),o=0;o<me.length;o++)if(me[o]!==t&&me[o].isTracking()&&v(me[o].element,t.element)){for(r=[],e=0;a>e;e++)r.push({id:i.changedTouches[e].identifier,type:"touch",currentPos:oe(i.changedTouches[e]),currentTime:n});ae(me[o],i,r)}se(t,i,s,0)&&(ee.stopEvent(i),ie(t,"touch",a)),ee.cancelEvent(i)}function M(e,t){O(e,t)}function N(e,t){O(e,t),ee.stopEvent(t)}function O(t,i){var n,o,e,r,a=i.changedTouches.length,l=[];for(n=ee.now(),o=0;a>o;o++)l.push({id:i.changedTouches[o].identifier,type:"touch",currentPos:oe(i.changedTouches[o]),currentTime:n});for(de(t,i,l,0)&&ne(t,"touch",a),le(t,i,l),o=0;o<me.length;o++)if(me[o]!==t&&me[o].isTracking()&&v(me[o].element,t.element)){for(r=[],e=0;a>e;e++)r.push({id:i.changedTouches[e].identifier,type:"touch",currentPos:oe(i.changedTouches[e]),currentTime:n});le(me[o],i,r)}ee.cancelEvent(i)}function P(e,t){R(e,t)}function G(e,t){R(e,t),ee.stopEvent(t)}function R(t,i){var n,o=i.changedTouches.length,e=[];for(n=0;o>n;n++)e.push({id:i.changedTouches[n].identifier,type:"touch",currentPos:oe(i.changedTouches[n]),currentTime:ee.now()});ce(t,i,e),ee.cancelEvent(i)}function S(e,t){var i=(t.changedTouches.length,e.getActivePointersListByType("touch"));A(e,t,i)}function T(e,t){return t.stopPropagation(),t.preventDefault(),!1}function U(e,t){return t.stopPropagation(),t.preventDefault(),!1}function V(t,i){var n;i.currentTarget===i.relatedTarget||v(i.currentTarget,i.relatedTarget)||(n={id:i.pointerId,type:e(i),isPrimary:i.isPrimary,currentPos:oe(i),currentTime:ee.now()},ae(t,i,[n]))}function W(t,i){var n;i.currentTarget===i.relatedTarget||v(i.currentTarget,i.relatedTarget)||(n={id:i.pointerId,type:e(i),isPrimary:i.isPrimary,currentPos:oe(i),currentTime:ee.now()},le(t,i,[n]))}function q(t,i){var n;n={id:i.pointerId,type:e(i),isPrimary:i.isPrimary,currentPos:oe(i),currentTime:ee.now()},se(t,i,[n],i.button)&&(ee.stopEvent(i),ie(t,n.type)),(t.clickHandler||t.dblClickHandler||t.pressHandler||t.dragHandler||t.dragEndHandler||t.pinchHandler)&&ee.cancelEvent(i)}function j(e,t){X(e,t)}function Z(t,i){var n=t.getActivePointersListByType(e(i));n.getById(i.pointerId)&&X(t,i),ee.stopEvent(i)}function X(t,i){var n;n={id:i.pointerId,type:e(i),isPrimary:i.isPrimary,currentPos:oe(i),currentTime:ee.now()},de(t,i,[n],i.button)&&ne(t,n.type)}function _(e,t){K(e,t)}function Y(t,i){var n=t.getActivePointersListByType(e(i));n.getById(i.pointerId)&&K(t,i),ee.stopEvent(i)}function K(t,i){var n;n={id:i.pointerId,type:e(i),isPrimary:i.isPrimary,currentPos:oe(i),currentTime:ee.now()},ce(t,i,[n])}function Q(t,i){var n;n={id:i.pointerId,type:e(i)},pe(t,i,[n])}function J(e,t){return t.hasOwnProperty("isPrimary")||(0===e.getLength()?t.isPrimary=!0:t.isPrimary=!1),t.speed=0,t.direction=0,t.contactPos=t.currentPos,t.contactTime=t.currentTime,t.lastPos=t.currentPos,t.lastTime=t.currentTime,e.add(t)}function $(e,t){var i,n;return e.getById(t.id)?(i=e.removeById(t.id),!t.hasOwnProperty("isPrimary")&&(n=e.getPrimary(),!n&&(n=e.getByIndex(0),n&&(n.isPrimary=!0)))):i=e.getLength(),i}function ae(t,n,o){var r,e,a,l,s=t.getActivePointersListByType(o[0].type),i=o.length;for(r=0;i>r;r++)e=o[r],a=s.getById(e.id),a?(a.insideElement=!0,a.lastPos=a.currentPos,a.lastTime=a.currentTime,a.currentPos=e.currentPos,a.currentTime=e.currentTime,e=a):(e.captured=!1,e.insideElementPressed=!1,e.insideElement=!0,J(s,e)),t.enterHandler&&(l=t.enterHandler({eventSource:t,pointerType:e.type,position:re(e.currentPos,t.element),buttons:s.buttons,pointers:t.getActivePointerCount(),insideElementPressed:e.insideElementPressed,buttonDownAny:0!==s.buttons,isTouchEvent:"touch"===e.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData}),!1===l&&ee.cancelEvent(n))}function le(t,n,o){var r,e,a,l,s=(he[t.hash],t.getActivePointersListByType(o[0].type)),i=o.length;for(r=0;i>r;r++)e=o[r],a=s.getById(e.id),a&&(a.captured?(a.insideElement=!1,a.lastPos=a.currentPos,a.lastTime=a.currentTime,a.currentPos=e.currentPos,a.currentTime=e.currentTime):$(s,a),e=a),t.exitHandler&&(l=t.exitHandler({eventSource:t,pointerType:e.type,position:re(e.currentPos,t.element),buttons:s.buttons,pointers:t.getActivePointerCount(),insideElementPressed:!!a&&a.insideElementPressed,buttonDownAny:0!==s.buttons,isTouchEvent:"touch"===e.type,originalEvent:n,preventDefaultAction:!1,userData:t.userData}),!1===l&&ee.cancelEvent(n))}function se(t,o,r,a){var l,s,d,p,i=he[t.hash],u=t.getActivePointersListByType(r[0].type),g=r.length;if("undefined"==typeof o.buttons?ee.Browser.vendor===ee.BROWSERS.IE&&9>ee.Browser.version?0===a?u.buttons+=1:1===a?u.buttons+=4:2===a?u.buttons+=2:3===a?u.buttons+=8:4===a?u.buttons+=16:5===a&&(u.buttons+=32):0===a?u.buttons|=1:1===a?u.buttons|=4:2===a?u.buttons|=2:3===a?u.buttons|=8:4===a?u.buttons|=16:5===a&&(u.buttons|=32):u.buttons=o.buttons,0!==a)return t.nonPrimaryPressHandler&&(l=t.nonPrimaryPressHandler({eventSource:t,pointerType:r[0].type,position:re(r[0].currentPos,t.element),button:a,buttons:u.buttons,isTouchEvent:"touch"===r[0].type,originalEvent:o,preventDefaultAction:!1,userData:t.userData}),!1===l&&ee.cancelEvent(o)),!1;for(s=0;g>s;s++)d=r[s],p=u.getById(d.id),p?(p.captured=!0,p.insideElementPressed=!0,p.insideElement=!0,p.contactPos=d.currentPos,p.contactTime=d.currentTime,p.lastPos=p.currentPos,p.lastTime=p.currentTime,p.currentPos=d.currentPos,p.currentTime=d.currentTime,d=p):(d.captured=!0,d.insideElementPressed=!0,d.insideElement=!0,J(u,d)),u.contacts++,(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&ee.MouseTracker.gesturePointVelocityTracker.addPoint(t,d),1===u.contacts?t.pressHandler&&(l=t.pressHandler({eventSource:t,pointerType:d.type,position:re(d.contactPos,t.element),buttons:u.buttons,isTouchEvent:"touch"===d.type,originalEvent:o,preventDefaultAction:!1,userData:t.userData}),!1===l&&ee.cancelEvent(o)):2===u.contacts&&t.pinchHandler&&"touch"===d.type&&(i.pinchGPoints=u.asArray(),i.lastPinchDist=i.currentPinchDist=i.pinchGPoints[0].currentPos.distanceTo(i.pinchGPoints[1].currentPos),i.lastPinchCenter=i.currentPinchCenter=k(i.pinchGPoints[0].currentPos,i.pinchGPoints[1].currentPos));return!0}function de(t,a,l,d){var u,v,g,h,i,y,m,T=he[t.hash],o=t.getActivePointersListByType(l[0].type),p=l.length,w=!1,r=!1;if("undefined"==typeof a.buttons?ee.Browser.vendor===ee.BROWSERS.IE&&9>ee.Browser.version?0===d?o.buttons-=1:1===d?o.buttons-=4:2===d?o.buttons-=2:3===d?o.buttons-=8:4===d?o.buttons-=16:5===d&&(o.buttons-=32):0===d?o.buttons^=-2:1===d?o.buttons^=-5:2===d?o.buttons^=-3:3===d?o.buttons^=-9:4===d?o.buttons^=-17:5===d&&(o.buttons^=-33):o.buttons=a.buttons,0!==d)return t.nonPrimaryReleaseHandler&&(u=t.nonPrimaryReleaseHandler({eventSource:t,pointerType:l[0].type,position:re(l[0].currentPos,t.element),button:d,buttons:o.buttons,isTouchEvent:"touch"===l[0].type,originalEvent:a,preventDefaultAction:!1,userData:t.userData}),!1===u&&ee.cancelEvent(a)),!1;for(h=0;p>h;h++)i=l[h],y=o.getById(i.id),y&&(y.captured&&(y.captured=!1,w=!0,r=!0),y.lastPos=y.currentPos,y.lastTime=y.currentTime,y.currentPos=i.currentPos,y.currentTime=i.currentTime,y.insideElement||$(o,y),v=y.currentPos,g=y.currentTime,r?(o.contacts--,(t.dragHandler||t.dragEndHandler||t.pinchHandler)&&ee.MouseTracker.gesturePointVelocityTracker.removePoint(t,y),0===o.contacts?(t.releaseHandler&&(u=t.releaseHandler({eventSource:t,pointerType:y.type,position:re(v,t.element),buttons:o.buttons,insideElementPressed:y.insideElementPressed,insideElementReleased:y.insideElement,isTouchEvent:"touch"===y.type,originalEvent:a,preventDefaultAction:!1,userData:t.userData}),!1===u&&ee.cancelEvent(a)),t.dragEndHandler&&!y.currentPos.equals(y.contactPos)&&(u=t.dragEndHandler({eventSource:t,pointerType:y.type,position:re(y.currentPos,t.element),speed:y.speed,direction:y.direction,shift:a.shiftKey,isTouchEvent:"touch"===y.type,originalEvent:a,preventDefaultAction:!1,userData:t.userData}),!1===u&&ee.cancelEvent(a)),(t.clickHandler||t.dblClickHandler)&&y.insideElement&&(m=g-y.contactTime<=t.clickTimeThreshold&&y.contactPos.distanceTo(v)<=t.clickDistThreshold,t.clickHandler&&(u=t.clickHandler({eventSource:t,pointerType:y.type,position:re(y.currentPos,t.element),quick:m,shift:a.shiftKey,isTouchEvent:"touch"===y.type,originalEvent:a,preventDefaultAction:!1,userData:t.userData}),!1===u&&ee.cancelEvent(a)),t.dblClickHandler&&m&&(o.clicks++,1===o.clicks?(T.lastClickPos=v,T.dblClickTimeOut=setTimeout(function(){o.clicks=0},t.dblClickTimeThreshold)):2===o.clicks&&(clearTimeout(T.dblClickTimeOut),o.clicks=0,T.lastClickPos.distanceTo(v)<=t.dblClickDistThreshold&&(u=t.dblClickHandler({eventSource:t,pointerType:y.type,position:re(y.currentPos,t.element),shift:a.shiftKey,isTouchEvent:"touch"===y.type,originalEvent:a,preventDefaultAction:!1,userData:t.userData}),!1===u&&ee.cancelEvent(a)),T.lastClickPos=null)))):2===o.contacts&&t.pinchHandler&&"touch"===y.type&&(T.pinchGPoints=o.asArray(),T.lastPinchDist=T.currentPinchDist=T.pinchGPoints[0].currentPos.distanceTo(T.pinchGPoints[1].currentPos),T.lastPinchCenter=T.currentPinchCenter=k(T.pinchGPoints[0].currentPos,T.pinchGPoints[1].currentPos))):t.releaseHandler&&(u=t.releaseHandler({eventSource:t,pointerType:y.type,position:re(v,t.element),buttons:o.buttons,insideElementPressed:y.insideElementPressed,insideElementReleased:y.insideElement,isTouchEvent:"touch"===y.type,originalEvent:a,preventDefaultAction:!1,userData:t.userData}),!1===u&&ee.cancelEvent(a)));return w}function ce(t,r,a){var l,e,s,d,p,u,g=he[t.hash],m=t.getActivePointersListByType(a[0].type),n=a.length;for("undefined"!=typeof r.buttons&&(m.buttons=r.buttons),l=0;n>l;l++)e=a[l],s=m.getById(e.id),s?(e.hasOwnProperty("isPrimary")&&(s.isPrimary=e.isPrimary),s.lastPos=s.currentPos,s.lastTime=s.currentTime,s.currentPos=e.currentPos,s.currentTime=e.currentTime):(e.captured=!1,e.insideElementPressed=!1,e.insideElement=!0,J(m,e));t.stopHandler&&"mouse"===a[0].type&&(clearTimeout(t.stopTimeOut),t.stopTimeOut=setTimeout(function(){ue(t,r,a[0].type)},t.stopDelay)),0===m.contacts?t.moveHandler&&(u=t.moveHandler({eventSource:t,pointerType:a[0].type,position:re(a[0].currentPos,t.element),buttons:m.buttons,isTouchEvent:"touch"===a[0].type,originalEvent:r,preventDefaultAction:!1,userData:t.userData}),!1===u&&ee.cancelEvent(r)):1===m.contacts?(t.moveHandler&&(s=m.asArray()[0],u=t.moveHandler({eventSource:t,pointerType:s.type,position:re(s.currentPos,t.element),buttons:m.buttons,isTouchEvent:"touch"===s.type,originalEvent:r,preventDefaultAction:!1,userData:t.userData}),!1===u&&ee.cancelEvent(r)),t.dragHandler&&(s=m.asArray()[0],p=s.currentPos.minus(s.lastPos),u=t.dragHandler({eventSource:t,pointerType:s.type,position:re(s.currentPos,t.element),buttons:m.buttons,delta:p,speed:s.speed,direction:s.direction,shift:r.shiftKey,isTouchEvent:"touch"===s.type,originalEvent:r,preventDefaultAction:!1,userData:t.userData}),!1===u&&ee.cancelEvent(r))):2===m.contacts&&(t.moveHandler&&(d=m.asArray(),u=t.moveHandler({eventSource:t,pointerType:d[0].type,position:re(k(d[0].currentPos,d[1].currentPos),t.element),buttons:m.buttons,isTouchEvent:"touch"===d[0].type,originalEvent:r,preventDefaultAction:!1,userData:t.userData}),!1===u&&ee.cancelEvent(r)),t.pinchHandler&&"touch"===a[0].type&&(p=g.pinchGPoints[0].currentPos.distanceTo(g.pinchGPoints[1].currentPos),p!=g.currentPinchDist&&(g.lastPinchDist=g.currentPinchDist,g.currentPinchDist=p,g.lastPinchCenter=g.currentPinchCenter,g.currentPinchCenter=k(g.pinchGPoints[0].currentPos,g.pinchGPoints[1].currentPos),u=t.pinchHandler({eventSource:t,pointerType:"touch",gesturePoints:g.pinchGPoints,lastCenter:re(g.lastPinchCenter,t.element),center:re(g.currentPinchCenter,t.element),lastDistance:g.lastPinchDist,distance:g.currentPinchDist,shift:r.shiftKey,originalEvent:r,preventDefaultAction:!1,userData:t.userData}),!1===u&&ee.cancelEvent(r))))}function pe(e,t,i){de(e,t,i,0),le(e,t,i)}function ue(e,t,n){e.stopHandler&&e.stopHandler({eventSource:e,pointerType:n,position:i(t,e.element),buttons:e.getActivePointersListByType(n).buttons,isTouchEvent:"touch"===n,originalEvent:t,preventDefaultAction:!1,userData:e.userData})}function ge(e){try{return e.addEventListener&&e.removeEventListener}catch(e){return!1}}var me=[],he={};ee.MouseTracker=function(e){me.push(this);var i=arguments;ee.isPlainObject(e)||(e={element:i[0],clickTimeThreshold:i[1],clickDistThreshold:i[2]}),this.hash=Math.random(),this.element=ee.getElement(e.element),this.clickTimeThreshold=e.clickTimeThreshold||ee.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=e.clickDistThreshold||ee.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=e.dblClickTimeThreshold||ee.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=e.dblClickDistThreshold||ee.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=e.userData||null,this.stopDelay=e.stopDelay||50,this.enterHandler=e.enterHandler||null,this.exitHandler=e.exitHandler||null,this.pressHandler=e.pressHandler||null,this.nonPrimaryPressHandler=e.nonPrimaryPressHandler||null,this.releaseHandler=e.releaseHandler||null,this.nonPrimaryReleaseHandler=e.nonPrimaryReleaseHandler||null,this.moveHandler=e.moveHandler||null,this.scrollHandler=e.scrollHandler||null,this.clickHandler=e.clickHandler||null,this.dblClickHandler=e.dblClickHandler||null,this.dragHandler=e.dragHandler||null,this.dragEndHandler=e.dragEndHandler||null,this.pinchHandler=e.pinchHandler||null,this.stopHandler=e.stopHandler||null,this.keyDownHandler=e.keyDownHandler||null,this.keyUpHandler=e.keyUpHandler||null,this.keyHandler=e.keyHandler||null,this.focusHandler=e.focusHandler||null,this.blurHandler=e.blurHandler||null;var c=this;he[this.hash]={click:function(e){l(c,e)},dblclick:function(e){g(c,e)},keydown:function(e){n(c,e)},keyup:function(e){o(c,e)},keypress:function(e){p(c,e)},focus:function(e){m(c,e)},blur:function(e){r(c,e)},wheel:function(e){s(c,e)},mousewheel:function(e){t(c,e)},DOMMouseScroll:function(e){t(c,e)},MozMousePixelScroll:function(e){t(c,e)},mouseenter:function(e){h(c,e)},mouseleave:function(e){y(c,e)},mouseover:function(e){w(c,e)},mouseout:function(e){x(c,e)},mousedown:function(e){B(c,e)},mouseup:function(e){E(c,e)},mouseupcaptured:function(e){D(c,e)},mousemove:function(e){H(c,e)},mousemovecaptured:function(e){I(c,e)},touchstart:function(e){L(c,e)},touchend:function(e){M(c,e)},touchendcaptured:function(e){N(c,e)},touchmove:function(e){P(c,e)},touchmovecaptured:function(e){G(c,e)},touchcancel:function(e){S(c,e)},gesturestart:function(e){T(c,e)},gesturechange:function(e){U(c,e)},pointerover:function(e){V(c,e)},MSPointerOver:function(e){V(c,e)},pointerout:function(e){W(c,e)},MSPointerOut:function(e){W(c,e)},pointerdown:function(e){q(c,e)},MSPointerDown:function(e){q(c,e)},pointerup:function(e){j(c,e)},MSPointerUp:function(e){j(c,e)},pointermove:function(e){_(c,e)},MSPointerMove:function(e){_(c,e)},pointercancel:function(e){Q(c,e)},MSPointerCancel:function(e){Q(c,e)},pointerupcaptured:function(e){Z(c,e)},pointermovecaptured:function(e){Y(c,e)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},e.startDisabled||this.setTracking(!0)},ee.MouseTracker.prototype={destroy:function(){var e;for(c(this),this.element=null,e=0;e<me.length;e++)if(me[e]===this){me.splice(e,1);break}he[this.hash]=null,delete he[this.hash]},isTracking:function(){return he[this.hash].tracking},setTracking:function(e){return e?b(this):c(this),this},getActivePointersListByType:function(t){var i,n,o=he[this.hash],e=o.activePointersLists.length;for(i=0;e>i;i++)if(o.activePointersLists[i].type===t)return o.activePointersLists[i];return n=new ee.MouseTracker.GesturePointList(t),o.activePointersLists.push(n),n},getActivePointerCount:function(){var e,t=he[this.hash],i=t.activePointersLists.length,n=0;for(e=0;i>e;e++)n+=t.activePointersLists[e].getLength();return n},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},ee.MouseTracker.gesturePointVelocityTracker=function(){var t=[],n=0,o=0,r=function(e,t){return e.hash.toString()+t.type+t.id.toString()},e=function(){var n,r,e,a,l,s,i=t.length,d=ee.now();for(a=d-o,o=d,n=0;i>n;n++)r=t[n],e=r.gPoint,e.direction=Math.atan2(e.currentPos.y-r.lastPos.y,e.currentPos.x-r.lastPos.x),l=r.lastPos.distanceTo(e.currentPos),r.lastPos=e.currentPos,s=1e3*l/(a+1),e.speed=.75*s+.25*e.speed};return{addPoint:function(a,l){var s=r(a,l);t.push({guid:s,gPoint:l,lastPos:l.currentPos}),1===t.length&&(o=ee.now(),n=window.setInterval(e,50))},removePoint:function(e,i){var o,a=r(e,i),l=t.length;for(o=0;l>o;o++)if(t[o].guid===a){t.splice(o,1),l--,0===l&&window.clearInterval(n);break}}}}(),ee.MouseTracker.captureElement=document,ee.MouseTracker.wheelEventName=ee.Browser.vendor==ee.BROWSERS.IE&&8<ee.Browser.version||"onwheel"in document.createElement("div")?"wheel":void 0===document.onmousewheel?"DOMMouseScroll":"mousewheel",ee.MouseTracker.supportsMouseCapture=function(){var e=document.createElement("div");return ee.isFunction(e.setCapture)&&ee.isFunction(e.releaseCapture)}(),ee.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",ee.MouseTracker.wheelEventName],"DOMMouseScroll"==ee.MouseTracker.wheelEventName&&ee.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||ee.Browser.vendor!==ee.BROWSERS.IE)?(ee.MouseTracker.havePointerEvents=!0,ee.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),ee.MouseTracker.unprefixedPointerEvents=!0,ee.MouseTracker.maxTouchPoints=navigator.maxTouchPoints?navigator.maxTouchPoints:0,ee.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(ee.MouseTracker.havePointerEvents=!0,ee.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),ee.MouseTracker.unprefixedPointerEvents=!1,ee.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints?navigator.msMaxTouchPoints:0,ee.MouseTracker.haveMouseEnter=!1):(ee.MouseTracker.havePointerEvents=!1,ee.Browser.vendor===ee.BROWSERS.IE&&9>ee.Browser.version?(ee.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),ee.MouseTracker.haveMouseEnter=!0):(ee.MouseTracker.subscribeEvents.push("mouseover","mouseout"),ee.MouseTracker.haveMouseEnter=!1),ee.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&ee.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&ee.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),ee.MouseTracker.mousePointerId="legacy-mouse",ee.MouseTracker.maxTouchPoints=10),ee.MouseTracker.GesturePointList=function(e){this._gPoints=[],this.type=e,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},ee.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(e){return this._gPoints.push(e)},removeById:function(e){var t,i=this._gPoints.length;for(t=0;i>t;t++)if(this._gPoints[t].id===e){this._gPoints.splice(t,1);break}return this._gPoints.length},getByIndex:function(e){return e<this._gPoints.length?this._gPoints[e]:null},getById:function(e){var t,i=this._gPoints.length;for(t=0;i>t;t++)if(this._gPoints[t].id===e)return this._gPoints[t];return null},getPrimary:function(){var e,t=this._gPoints.length;for(e=0;t>e;e++)if(this._gPoints[e].isPrimary)return this._gPoints[e];return null}};var ve=function(){try{return window.self!==window.top}catch(e){return!0}}()}(OpenSeadragon),!function(t){t.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},t.Control=function(i,n,o){var r=i.parentNode;"number"==typeof n&&(t.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),n={anchor:n}),n.attachToViewer=!("undefined"!=typeof n.attachToViewer)||n.attachToViewer,this.autoFade=!("undefined"!=typeof n.autoFade)||n.autoFade,this.element=i,this.anchor=n.anchor,this.container=o,this.anchor==t.ControlAnchor.ABSOLUTE?(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof n.top?n.top+"px":n.top,this.wrapper.style.left="number"==typeof n.left?n.left+"px":n.left,this.wrapper.style.height="number"==typeof n.height?n.height+"px":n.height,this.wrapper.style.width="number"==typeof n.width?n.width+"px":n.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=t.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==t.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),n.attachToViewer?this.anchor==t.ControlAnchor.TOP_RIGHT||this.anchor==t.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):r.appendChild(this.wrapper)},t.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(e){this.wrapper.style.display=e?this.anchor==t.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(e){this.element[t.SIGNAL]&&t.Browser.vendor==t.BROWSERS.IE?t.setElementOpacity(this.element,e,!0):t.setElementOpacity(this.wrapper,e,!0)}}}(OpenSeadragon),!function(t){function i(e,t){var i,n=e.controls;for(i=n.length-1;0<=i;i--)if(n[i].element==t)return i;return-1}t.ControlDock=function(i){var n,o,r=["topleft","topright","bottomright","bottomleft"];for(t.extend(!0,this,{id:"controldock-"+t.now()+"-"+Math.floor(1e6*Math.random()),container:t.makeNeutralElement("div"),controls:[]},i),this.container.onsubmit=function(){return!1},this.element&&(this.element=t.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),o=0;o<r.length;o++)n=r[o],this.controls[n]=t.makeNeutralElement("div"),this.controls[n].style.position="absolute",n.match("left")&&(this.controls[n].style.left="0px"),n.match("right")&&(this.controls[n].style.right="0px"),n.match("top")&&(this.controls[n].style.top="0px"),n.match("bottom")&&(this.controls[n].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},t.ControlDock.prototype={addControl:function(n,o){n=t.getElement(n);var r=null;if(!(0<=i(this,n))){switch(o.anchor){case t.ControlAnchor.TOP_RIGHT:r=this.controls.topright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingTop="0px";break;case t.ControlAnchor.BOTTOM_RIGHT:r=this.controls.bottomright,n.style.position="relative",n.style.paddingRight="0px",n.style.paddingBottom="0px";break;case t.ControlAnchor.BOTTOM_LEFT:r=this.controls.bottomleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingBottom="0px";break;case t.ControlAnchor.TOP_LEFT:r=this.controls.topleft,n.style.position="relative",n.style.paddingLeft="0px",n.style.paddingTop="0px";break;case t.ControlAnchor.ABSOLUTE:r=this.container,n.style.margin="0px",n.style.padding="0px";break;default:case t.ControlAnchor.NONE:r=this.container,n.style.margin="0px",n.style.padding="0px";}this.controls.push(new t.Control(n,o,r)),n.style.display="inline-block"}},removeControl:function(e){e=t.getElement(e);var n=i(this,e);return 0<=n&&(this.controls[n].destroy(),this.controls.splice(n,1)),this},clearControls:function(){for(;0<this.controls.length;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var e;for(e=this.controls.length-1;0<=e;e--)if(this.controls[e].isVisible())return!0;return!1},setControlsEnabled:function(e){var t;for(t=this.controls.length-1;0<=t;t--)this.controls[t].setVisible(e);return this}}}(OpenSeadragon),!function(e){e.Placement=e.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),!function(_){function W(e){return e=_.getElement(e),new _.Point(0===e.clientWidth?1:e.clientWidth,0===e.clientHeight?1:e.clientHeight)}function a(t,n,i,o){function e(e,t){e.ready?i(e):(e.addHandler("ready",function(){i(e)}),e.addHandler("open-failed",function(e){o({message:e.message,source:t})}))}var r=t;"string"==_.type(n)&&(n.match(/\s*<.*/)?n=_.parseXml(n):n.match(/\s*[\{\[].*/)&&(n=_.parseJSON(n))),setTimeout(function(){if("string"==_.type(n))n=new _.TileSource({url:n,crossOriginPolicy:t.crossOriginPolicy,ajaxWithCredentials:t.ajaxWithCredentials,useCanvas:t.useCanvas,success:function(e){i(e.tileSource)}}),n.addHandler("open-failed",function(e){o(e)});else if(!(_.isPlainObject(n)||n.nodeType))e(n,n);else if(!n.crossOriginPolicy&&t.crossOriginPolicy&&(n.crossOriginPolicy=t.crossOriginPolicy),void 0===n.ajaxWithCredentials&&(n.ajaxWithCredentials=t.ajaxWithCredentials),void 0===n.useCanvas&&(n.useCanvas=t.useCanvas),_.isFunction(n.getTileUrl)){var a=new _.TileSource(n);a.getTileUrl=n.getTileUrl,i(a)}else{var l=_.TileSource.determineType(r,n);if(!l)return void o({message:"Unable to load TileSource",source:n});var s=l.prototype.configure.apply(r,[n]);e(new l(s),n)}})}function Z(t,n){if(n instanceof _.Overlay)return n;var o=null;if(n.element)o=_.getElement(n.element);else{var r=n.id?n.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());o=_.getElement(n.id),o||(o=document.createElement("a"),o.href="#/overlay/"+r),o.id=r,_.addClass(o,n.className?n.className:"openseadragon-overlay")}var e=n.location,a=n.width,s=n.height;if(!e){var c=n.x,i=n.y;if(void 0!==n.px){var p=t.viewport.imageToViewportRectangle(new _.Rect(n.px,n.py,a||0,s||0));c=p.x,i=p.y,a=void 0===a?void 0:p.width,s=void 0===s?void 0:p.height}e=new _.Point(c,i)}var u=n.placement;return u&&"string"===_.type(u)&&(u=_.Placement[n.placement.toUpperCase()]),new _.Overlay({element:o,location:e,placement:u,onDraw:n.onDraw,checkResize:n.checkResize,width:a,height:s,rotationMode:n.rotationMode})}function X(e,t){var i;for(i=e.length-1;0<=i;i--)if(e[i].element===t)return i;return-1}function e(e,t){return _.requestAnimationFrame(function(){t(e)})}function Y(e){_.requestAnimationFrame(function(){d(e)})}function b(e){e.autoHideControls&&(e.controlsShouldFade=!0,e.controlsFadeBeginTime=_.now()+e.controlsFadeDelay,window.setTimeout(function(){Y(e)},e.controlsFadeDelay))}function d(t){var i,n,o,e;if(t.controlsShouldFade){for(i=_.now(),n=i-t.controlsFadeBeginTime,o=1-n/t.controlsFadeLength,o=K(1,o),o=q(0,o),e=t.controls.length-1;0<=e;e--)t.controls[e].autoFade&&t.controls[e].setOpacity(o);0<o&&Y(t)}}function h(e){var t;for(e.controlsShouldFade=!1,t=e.controls.length-1;0<=t;t--)e.controls[t].setOpacity(1)}function $(){h(this)}function k(){b(this)}function i(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new _.Point(0,-40))),this.viewport.applyConstraints(),!1;case 40:return e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new _.Point(0,40))),this.viewport.applyConstraints(),!1;case 37:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new _.Point(-40,0))),this.viewport.applyConstraints(),!1;case 39:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new _.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0;}}function l(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return e.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new _.Point(0,-40))),this.viewport.applyConstraints(),!1;case 115:case 83:return e.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new _.Point(0,40))),this.viewport.applyConstraints(),!1;case 97:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new _.Point(-40,0))),this.viewport.applyConstraints(),!1;case 100:return this.viewport.panBy(this.viewport.deltaPointsFromPixels(new _.Point(40,0))),this.viewport.applyConstraints(),!1;default:return!0;}}function n(e){var t,i=document.activeElement==this.canvas;i||this.canvas.focus(),!e.preventDefaultAction&&this.viewport&&e.quick&&(t=this.gestureSettingsByDeviceType(e.pointerType),t.clickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-click",{tracker:e.eventSource,position:e.position,quick:e.quick,shift:e.shift,originalEvent:e.originalEvent})}function o(e){var t;!e.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType),t.dblClickToZoom&&(this.viewport.zoomBy(e.shift?1/this.zoomPerClick:this.zoomPerClick,this.viewport.pointFromPixel(e.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-double-click",{tracker:e.eventSource,position:e.position,shift:e.shift,originalEvent:e.originalEvent})}function p(e){var t;!e.preventDefaultAction&&this.viewport&&(t=this.gestureSettingsByDeviceType(e.pointerType),this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta.negate()),t.flickEnabled),this.constrainDuringPan&&this.viewport.applyConstraints()),this.raiseEvent("canvas-drag",{tracker:e.eventSource,position:e.position,delta:e.delta,speed:e.speed,direction:e.direction,shift:e.shift,originalEvent:e.originalEvent})}function m(t){if(!t.preventDefaultAction&&this.viewport){var i=this.gestureSettingsByDeviceType(t.pointerType);if(i.flickEnabled&&t.speed>=i.flickMinSpeed){var n=0;this.panHorizontal&&(n=i.flickMomentum*t.speed*Math.cos(t.direction));var o=0;this.panVertical&&(o=i.flickMomentum*t.speed*Math.sin(t.direction));var e=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),r=this.viewport.pointFromPixel(new _.Point(e.x-n,e.y-o));this.viewport.panTo(r,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:t.eventSource,position:t.position,speed:t.speed,direction:t.direction,shift:t.shift,originalEvent:t.originalEvent})}function r(e){this.raiseEvent("canvas-enter",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function s(e){this.raiseEvent("canvas-exit",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function t(e){this.raiseEvent("canvas-press",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function u(e){this.raiseEvent("canvas-release",{tracker:e.eventSource,pointerType:e.pointerType,position:e.position,insideElementPressed:e.insideElementPressed,insideElementReleased:e.insideElementReleased,originalEvent:e.originalEvent})}function v(e){this.raiseEvent("canvas-nonprimary-press",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function w(e){this.raiseEvent("canvas-nonprimary-release",{tracker:e.eventSource,position:e.position,pointerType:e.pointerType,button:e.button,buttons:e.buttons,originalEvent:e.originalEvent})}function x(t){var i,n,o,r;if(!t.preventDefaultAction&&this.viewport&&(i=this.gestureSettingsByDeviceType(t.pointerType),i.pinchToZoom&&(n=this.viewport.pointFromPixel(t.center,!0),o=this.viewport.pointFromPixel(t.lastCenter,!0),r=o.minus(n),this.panHorizontal||(r.x=0),this.panVertical||(r.y=0),this.viewport.zoomBy(t.distance/t.lastDistance,n,!0),this.viewport.panBy(r,!0),this.viewport.applyConstraints()),i.pinchRotate)){var e=j(t.gesturePoints[0].currentPos.y-t.gesturePoints[1].currentPos.y,t.gesturePoints[0].currentPos.x-t.gesturePoints[1].currentPos.x),a=j(t.gesturePoints[0].lastPos.y-t.gesturePoints[1].lastPos.y,t.gesturePoints[0].lastPos.x-t.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(e-a)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:t.eventSource,gesturePoints:t.gesturePoints,lastCenter:t.lastCenter,center:t.center,lastDistance:t.lastDistance,distance:t.distance,shift:t.shift,originalEvent:t.originalEvent}),!1}function y(t){var i,n,o,e;if(o=_.now(),e=o-this._lastScrollTime,e>this.minScrollDeltaTime){if(this._lastScrollTime=o,!t.preventDefaultAction&&this.viewport&&(i=this.gestureSettingsByDeviceType(t.pointerType),i.scrollToZoom&&(n=T(this.zoomPerScroll,t.scroll),this.viewport.zoomBy(n,this.viewport.pointFromPixel(t.position,!0)),this.viewport.applyConstraints())),this.raiseEvent("canvas-scroll",{tracker:t.eventSource,position:t.position,scroll:t.scroll,shift:t.shift,originalEvent:t.originalEvent}),i&&i.scrollToZoom)return!1;}else if(i=this.gestureSettingsByDeviceType(t.pointerType),i&&i.scrollToZoom)return!1}function z(e){Q[this.hash].mouseInside=!0,h(this),this.raiseEvent("container-enter",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function A(e){1>e.pointers&&(Q[this.hash].mouseInside=!1,Q[this.hash].animating||b(this)),this.raiseEvent("container-exit",{tracker:e.eventSource,position:e.position,buttons:e.buttons,pointers:e.pointers,insideElementPressed:e.insideElementPressed,buttonDownAny:e.buttonDownAny,originalEvent:e.originalEvent})}function c(t){g(t),t._updateRequestId=!!t.isOpen()&&e(t,c)}function g(t){if(!t._opening){if(t.autoResize){var n=W(t.container),o=Q[t.hash].prevContainerSize;if(!n.equals(o)){var r=t.viewport;if(t.preserveImageSizeOnResize){var e=o.x/n.x,a=r.getZoom()*e,s=r.getCenter();r.resize(n,!1),r.zoomTo(a,null,!0),r.panTo(s,!0)}else{var i=r.getBounds();r.resize(n,!0),r.fitBoundsWithConstraints(i,!0)}Q[t.hash].prevContainerSize=n,Q[t.hash].forceRedraw=!0}}var d=t.viewport.update(),l=t.world.update()||d;d&&t.raiseEvent("viewport-change"),t.referenceStrip&&(l=t.referenceStrip.update(t.viewport)||l),!Q[t.hash].animating&&l&&(t.raiseEvent("animation-start"),h(t)),(l||Q[t.hash].forceRedraw||t.world.needsDraw())&&(C(t),t._drawOverlays(),t.navigator&&t.navigator.update(t.viewport),Q[t.hash].forceRedraw=!1,l&&t.raiseEvent("animation")),Q[t.hash].animating&&!l&&(t.raiseEvent("animation-finish"),Q[t.hash].mouseInside||b(t)),Q[t.hash].animating=l}}function C(e){e.imageLoader.clear(),e.drawer.clear(),e.world.draw(),e.raiseEvent("update-viewport",{})}function E(e,t){return e?e+t:t}function B(){Q[this.hash].lastZoomTime=_.now(),Q[this.hash].zoomFactor=this.zoomPerSecond,Q[this.hash].zooming=!0,f(this)}function D(){Q[this.hash].lastZoomTime=_.now(),Q[this.hash].zoomFactor=1/this.zoomPerSecond,Q[this.hash].zooming=!0,f(this)}function H(){Q[this.hash].zooming=!1}function f(e){_.requestAnimationFrame(_.delegate(e,I))}function I(){var e,t,i;Q[this.hash].zooming&&this.viewport&&(e=_.now(),t=e-Q[this.hash].lastZoomTime,i=T(Q[this.hash].zoomFactor,t/1e3),this.viewport.zoomBy(i),this.viewport.applyConstraints(),Q[this.hash].lastZoomTime=e,f(this))}function F(){this.viewport&&(Q[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function L(){this.viewport&&(Q[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function M(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function N(){this.viewport&&this.viewport.goHome()}function O(){this.isFullPage()&&!_.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function P(){if(this.viewport){var e=this.viewport.getRotation();0===e?e=270:e-=90,this.viewport.setRotation(e)}}function G(){if(this.viewport){var e=this.viewport.getRotation();270===e?e=0:e+=90,this.viewport.setRotation(e)}}function R(){var e=this._sequenceIndex-1;this.navPrevNextWrap&&0>e&&(e+=this.tileSources.length),this.goToPage(e)}function S(){var e=this._sequenceIndex+1;this.navPrevNextWrap&&e>=this.tileSources.length&&(e=0),this.goToPage(e)}var T=Math.pow,q=Math.max,K=Math.min,j=Math.atan2,Q={},U=1;_.Viewer=function(a){var h,d=arguments,T=this;if(_.isPlainObject(a)||(a={id:d[0],xmlPath:1<d.length?d[1]:void 0,prefixUrl:2<d.length?d[2]:void 0,controls:3<d.length?d[3]:void 0,overlays:4<d.length?d[4]:void 0}),a.config&&(_.extend(!0,a,a.config),delete a.config),_.extend(!0,this,{id:a.id,hash:a.hash||U++,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},_.DEFAULT_SETTINGS,a),"undefined"==typeof this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for("undefined"!=typeof Q[this.hash]&&_.console.warn("Hash "+this.hash+" has already been used."),Q[this.hash]={fsBoundsDelta:new _.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=_.now(),_.EventSource.call(this),this.addHandler("open-failed",function(e){var t=_.getString("Errors.OpenFailed",e.eventSource,e.message);T._showMessage(t)}),_.ControlDock.call(this,a),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=_.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",!function(e){e.width="100%",e.height="100%",e.overflow="hidden",e.position="absolute",e.top="0px",e.left="0px"}(this.canvas.style),_.setElementTouchActionNone(this.canvas),""!==a.tabIndex&&(this.canvas.tabIndex=void 0===a.tabIndex?0:a.tabIndex),this.container.className="openseadragon-container",!function(e){e.width="100%",e.height="100%",e.position="relative",e.overflow="hidden",e.left="0px",e.top="0px",e.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new _.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:_.delegate(this,i),keyHandler:_.delegate(this,l),clickHandler:_.delegate(this,n),dblClickHandler:_.delegate(this,o),dragHandler:_.delegate(this,p),dragEndHandler:_.delegate(this,m),enterHandler:_.delegate(this,r),exitHandler:_.delegate(this,s),pressHandler:_.delegate(this,t),releaseHandler:_.delegate(this,u),nonPrimaryPressHandler:_.delegate(this,v),nonPrimaryReleaseHandler:_.delegate(this,w),scrollHandler:_.delegate(this,y),pinchHandler:_.delegate(this,x)}),this.outerTracker=new _.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:_.delegate(this,z),exitHandler:_.delegate(this,A)}),this.toolbar&&(this.toolbar=new _.ControlDock({element:this.toolbar})),this.bindStandardControls(),Q[this.hash].prevContainerSize=W(this.container),this.world=new _.World({viewer:this}),this.world.addHandler("add-item",function(){T.source=T.world.getItemAt(0).source,Q[T.hash].forceRedraw=!0,T._updateRequestId||(T._updateRequestId=e(T,c))}),this.world.addHandler("remove-item",function(){T.source=T.world.getItemCount()?T.world.getItemAt(0).source:null,Q[T.hash].forceRedraw=!0}),this.world.addHandler("metrics-change",function(){T.viewport&&T.viewport._setContentBounds(T.world.getHomeBounds(),T.world.getContentFactor())}),this.world.addHandler("item-index-change",function(){T.source=T.world.getItemAt(0).source}),this.viewport=new _.Viewport({containerSize:Q[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new _.ImageLoader({jobLimit:this.imageLoaderLimit}),this.tileCache=new _.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new _.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=_.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(h=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(h,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(h=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(h,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new _.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),h=0;h<this.customControls.length;h++)this.addControl(this.customControls[h].id,{anchor:this.customControls[h].anchor});_.requestAnimationFrame(function(){b(T)})},_.extend(_.Viewer.prototype,_.EventSource.prototype,_.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(e){return _.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(e)},openTileSource:function(e){return _.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(e)},open:function(t){var n=this;if(this.close(),t)if(this.sequenceMode&&_.isArray(t))this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),this.tileSources=t,this._sequenceIndex=q(0,K(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&(this.referenceStrip=new _.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}))),this._updateSequenceButtons(this._sequenceIndex);else if(_.isArray(t)||(t=[t]),t.length){this._opening=!0;for(var o,r=t.length,l=0,s=0,c=function(){if(l+s===r)if(l){(n._firstOpen||!n.preserveViewport)&&(n.viewport.goHome(!0),n.viewport.update()),n._firstOpen=!1;var e=t[0];if(e.tileSource&&(e=e.tileSource),n.overlays&&!n.preserveOverlays)for(var d=0;d<n.overlays.length;d++)n.currentOverlays[d]=Z(n,n.overlays[d]);n._drawOverlays(),n._opening=!1,n.raiseEvent("open",{source:e})}else n._opening=!1,n.raiseEvent("open-failed",o)},e=function(t){_.isPlainObject(t)&&t.tileSource||(t={tileSource:t}),void 0!==t.index&&(_.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete t.index),void 0===t.collectionImmediately&&(t.collectionImmediately=!0);var i=t.success;t.success=function(o){if(l++,t.tileSource.overlays)for(var r=0;r<t.tileSource.overlays.length;r++)n.addOverlay(t.tileSource.overlays[r]);i&&i(o),c()};var r=t.error;t.error=function(e){s++,o||(o=e),r&&r(e),c()},n.addTiledImage(t)},i=0;i<t.length;i++)e(t[i]);return this}},close:function(){return Q[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),Q[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(Q[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(_.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),Q[this.hash]=null,delete Q[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(e){return this.innerTracker.setTracking(e),this.outerTracker.setTracking(e),this.raiseEvent("mouse-enabled",{enabled:e}),this},areControlsEnabled:function(){var e,t=this.controls.length;for(e=0;e<this.controls.length;e++)t=t&&this.controls[e].isVisibile();return t},setControlsEnabled:function(e){return e?h(this):b(this),this.raiseEvent("controls-enabled",{enabled:e}),this},isFullPage:function(){return Q[this.hash].fullPage},setFullPage:function(t){var n,o,r=document.body,e=r.style,a=document.documentElement.style,l=this;if(t==this.isFullPage())return this;var s={fullPage:t,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",s),s.preventDefaultAction)return this;if(t){for(this.elementSize=_.getElementSize(this.element),this.pageScroll=_.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=e.margin,this.docMargin=a.margin,e.margin="0",a.margin="0",this.bodyPadding=e.padding,this.docPadding=a.padding,e.padding="0",a.padding="0",this.bodyWidth=e.width,this.docWidth=a.width,e.width="100%",a.width="100%",this.bodyHeight=e.height,this.docHeight=a.height,e.height="100%",a.height="100%",this.previousBody=[],Q[this.hash].prevElementParent=this.element.parentNode,Q[this.hash].prevNextSibling=this.element.nextSibling,Q[this.hash].prevElementWidth=this.element.style.width,Q[this.hash].prevElementHeight=this.element.style.height,n=r.childNodes.length,o=0;n>o;o++)this.previousBody.push(r.childNodes[0]),r.removeChild(r.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,r.appendChild(this.toolbar.element),_.addClass(this.toolbar.element,"fullpage")),_.addClass(this.element,"fullpage"),r.appendChild(this.element),this.element.style.height=_.getWindowSize().y+"px",this.element.style.width=_.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=_.getElementSize(this.element).y-_.getElementSize(this.toolbar.element).y+"px"),Q[this.hash].fullPage=!0,_.delegate(this,z)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,e.margin=this.bodyMargin,a.margin=this.docMargin,e.padding=this.bodyPadding,a.padding=this.docPadding,e.width=this.bodyWidth,a.width=this.docWidth,e.height=this.bodyHeight,a.height=this.docHeight,r.removeChild(this.element),n=this.previousBody.length,o=0;n>o;o++)r.appendChild(this.previousBody.shift());_.removeClass(this.element,"fullpage"),Q[this.hash].prevElementParent.insertBefore(this.element,Q[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(r.removeChild(this.toolbar.element),_.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=Q[this.hash].prevElementWidth,this.element.style.height=Q[this.hash].prevElementHeight;var i=0,d=function e(){_.setPageScroll(l.pageScroll);var t=_.getPageScroll();i++,(10>i&&t.x!==l.pageScroll.x||t.y!==l.pageScroll.y)&&_.requestAnimationFrame(e)};_.requestAnimationFrame(d),Q[this.hash].fullPage=!1,_.delegate(this,A)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:t}),this},setFullScreen:function(t){var i=this;if(!_.supportsFullScreen)return this.setFullPage(t);if(_.isFullScreen()===t)return this;var n={fullScreen:t,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",n),n.preventDefaultAction)return this;if(t){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var o=function t(){var e=_.isFullScreen();e||(_.removeEvent(document,_.fullScreenEventName,t),_.removeEvent(document,_.fullScreenErrorEventName,t),i.setFullPage(!1),i.isFullPage()&&(i.element.style.width=i.fullPageStyleWidth,i.element.style.height=i.fullPageStyleHeight)),i.navigator&&i.viewport&&i.navigator.update(i.viewport),i.raiseEvent("full-screen",{fullScreen:e})};_.addEvent(document,_.fullScreenEventName,o),_.addEvent(document,_.fullScreenErrorEventName,o),_.requestFullScreen(document.body)}else _.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(e){return this.container.style.visibility=e?"":"hidden",this.raiseEvent("visible",{visible:e}),this},addTiledImage:function(t){function i(i){for(var r=0;r<e._loadQueue.length;r++)if(e._loadQueue[r]===o){e._loadQueue.splice(r,1);break}0===e._loadQueue.length&&n(o),e.raiseEvent("add-item-failed",i),t.error&&t.error(i)}function n(t){e.collectionMode&&(e.world.arrange({immediately:t.options.collectionImmediately,rows:e.collectionRows,columns:e.collectionColumns,layout:e.collectionLayout,tileSize:e.collectionTileSize,tileMargin:e.collectionTileMargin}),e.world.setAutoRefigureSizes(!0))}_.console.assert(t,"[Viewer.addTiledImage] options is required"),_.console.assert(t.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),_.console.assert(!t.replace||-1<t.index&&t.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var e=this;t.replace&&(t.replaceItem=e.world.getItemAt(t.index)),this._hideMessage(),void 0===t.placeholderFillStyle&&(t.placeholderFillStyle=this.placeholderFillStyle),void 0===t.opacity&&(t.opacity=this.opacity),void 0===t.compositeOperation&&(t.compositeOperation=this.compositeOperation);var o={options:t};_.isArray(t.tileSource)?setTimeout(function(){i({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:t.tileSource,options:t})}):(this._loadQueue.push(o),a(this,t.tileSource,function(t){o.tileSource=t;for(var r,a,l;e._loadQueue.length&&(r=e._loadQueue[0],!!r.tileSource);){if(e._loadQueue.splice(0,1),r.options.replace){var s=e.world.getIndexOfItem(r.options.replaceItem);-1!=s&&(r.options.index=s),e.world.removeItem(r.options.replaceItem)}a=new _.TiledImage({viewer:e,source:r.tileSource,viewport:e.viewport,drawer:e.drawer,tileCache:e.tileCache,imageLoader:e.imageLoader,x:r.options.x,y:r.options.y,width:r.options.width,height:r.options.height,fitBounds:r.options.fitBounds,fitBoundsPlacement:r.options.fitBoundsPlacement,clip:r.options.clip,placeholderFillStyle:r.options.placeholderFillStyle,opacity:r.options.opacity,compositeOperation:r.options.compositeOperation,springStiffness:e.springStiffness,animationTime:e.animationTime,minZoomImageRatio:e.minZoomImageRatio,wrapHorizontal:e.wrapHorizontal,wrapVertical:e.wrapVertical,immediateRender:e.immediateRender,blendTime:e.blendTime,alwaysBlend:e.alwaysBlend,minPixelRatio:e.minPixelRatio,smoothTileEdgesMinZoom:e.smoothTileEdgesMinZoom,iOSDevice:e.iOSDevice,crossOriginPolicy:e.crossOriginPolicy,debugMode:e.debugMode}),e.collectionMode&&e.world.setAutoRefigureSizes(!1),e.world.addItem(a,{index:r.options.index}),0===e._loadQueue.length&&n(r),1!==e.world.getItemCount()||e.preserveViewport||e.viewport.goHome(!0),e.navigator&&(l=_.extend({},r.options,{replace:!1,originalTiledImage:a,tileSource:r.tileSource}),e.navigator.addTiledImage(l)),r.options.success&&r.options.success({item:a})}},function(e){e.options=t,i(e)}))},addSimpleImage:function(e){_.console.assert(e,"[Viewer.addSimpleImage] options is required"),_.console.assert(e.url,"[Viewer.addSimpleImage] options.url is required");var t=_.extend({},e,{tileSource:{type:"image",url:e.url}});delete t.url,this.addTiledImage(t)},addLayer:function(e){var t=this;_.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var i=_.extend({},e,{success:function(i){t.raiseEvent("add-layer",{options:e,drawer:i.item})},error:function(e){t.raiseEvent("add-layer-failed",e)}});return this.addTiledImage(i),this},getLayerAtLevel:function(e){return _.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(e)},getLevelOfLayer:function(e){return _.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(e)},getLayersCount:function(){return _.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(e,t){return _.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(e,t)},removeLayer:function(e){return _.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(e)},forceRedraw:function(){return Q[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var t=_.delegate(this,$),i=_.delegate(this,k),n=_.delegate(this,S),o=_.delegate(this,R),r=this.navImages,a=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(a=!1),this.previousButton=new _.Button({element:this.previousButton?_.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:_.getString("Tooltips.PreviousPage"),srcRest:E(this.prefixUrl,r.previous.REST),srcGroup:E(this.prefixUrl,r.previous.GROUP),srcHover:E(this.prefixUrl,r.previous.HOVER),srcDown:E(this.prefixUrl,r.previous.DOWN),onRelease:o,onFocus:t,onBlur:i}),this.nextButton=new _.Button({element:this.nextButton?_.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:_.getString("Tooltips.NextPage"),srcRest:E(this.prefixUrl,r.next.REST),srcGroup:E(this.prefixUrl,r.next.GROUP),srcHover:E(this.prefixUrl,r.next.HOVER),srcDown:E(this.prefixUrl,r.next.DOWN),onRelease:n,onFocus:t,onBlur:i}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),a&&(this.paging=new _.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:_.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||_.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var t=_.delegate(this,B),r=_.delegate(this,H),a=_.delegate(this,F),l=_.delegate(this,D),s=_.delegate(this,L),u=_.delegate(this,N),v=_.delegate(this,O),y=_.delegate(this,P),T=_.delegate(this,G),w=_.delegate(this,$),x=_.delegate(this,k),S=this.navImages,o=[],R=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton)&&(R=!1),this.showZoomControl&&(o.push(this.zoomInButton=new _.Button({element:this.zoomInButton?_.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:_.getString("Tooltips.ZoomIn"),srcRest:E(this.prefixUrl,S.zoomIn.REST),srcGroup:E(this.prefixUrl,S.zoomIn.GROUP),srcHover:E(this.prefixUrl,S.zoomIn.HOVER),srcDown:E(this.prefixUrl,S.zoomIn.DOWN),onPress:t,onRelease:r,onClick:a,onEnter:t,onExit:r,onFocus:w,onBlur:x})),o.push(this.zoomOutButton=new _.Button({element:this.zoomOutButton?_.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:_.getString("Tooltips.ZoomOut"),srcRest:E(this.prefixUrl,S.zoomOut.REST),srcGroup:E(this.prefixUrl,S.zoomOut.GROUP),srcHover:E(this.prefixUrl,S.zoomOut.HOVER),srcDown:E(this.prefixUrl,S.zoomOut.DOWN),onPress:l,onRelease:r,onClick:s,onEnter:l,onExit:r,onFocus:w,onBlur:x}))),this.showHomeControl&&o.push(this.homeButton=new _.Button({element:this.homeButton?_.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:_.getString("Tooltips.Home"),srcRest:E(this.prefixUrl,S.home.REST),srcGroup:E(this.prefixUrl,S.home.GROUP),srcHover:E(this.prefixUrl,S.home.HOVER),srcDown:E(this.prefixUrl,S.home.DOWN),onRelease:u,onFocus:w,onBlur:x})),this.showFullPageControl&&o.push(this.fullPageButton=new _.Button({element:this.fullPageButton?_.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:_.getString("Tooltips.FullPage"),srcRest:E(this.prefixUrl,S.fullpage.REST),srcGroup:E(this.prefixUrl,S.fullpage.GROUP),srcHover:E(this.prefixUrl,S.fullpage.HOVER),srcDown:E(this.prefixUrl,S.fullpage.DOWN),onRelease:v,onFocus:w,onBlur:x})),this.showRotationControl&&(o.push(this.rotateLeftButton=new _.Button({element:this.rotateLeftButton?_.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:_.getString("Tooltips.RotateLeft"),srcRest:E(this.prefixUrl,S.rotateleft.REST),srcGroup:E(this.prefixUrl,S.rotateleft.GROUP),srcHover:E(this.prefixUrl,S.rotateleft.HOVER),srcDown:E(this.prefixUrl,S.rotateleft.DOWN),onRelease:y,onFocus:w,onBlur:x})),o.push(this.rotateRightButton=new _.Button({element:this.rotateRightButton?_.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:_.getString("Tooltips.RotateRight"),srcRest:E(this.prefixUrl,S.rotateright.REST),srcGroup:E(this.prefixUrl,S.rotateright.GROUP),srcHover:E(this.prefixUrl,S.rotateright.HOVER),srcDown:E(this.prefixUrl,S.rotateright.DOWN),onRelease:T,onFocus:w,onBlur:x}))),R&&(this.buttons=new _.ButtonGroup({buttons:o,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",_.delegate(this,M)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:_.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||_.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(e){return this.tileSources&&0<=e&&e<this.tileSources.length&&(this.raiseEvent("page",{page:e}),this._sequenceIndex=e,this._updateSequenceButtons(e),this.open(this.tileSources[e]),this.referenceStrip&&this.referenceStrip.setFocus(e)),this},addOverlay:function(e,t,n,o){var r;if(r=_.isPlainObject(e)?e:{element:e,location:t,placement:n,onDraw:o},e=_.getElement(r.element),0<=X(this.currentOverlays,e))return this;var a=Z(this,r);return this.currentOverlays.push(a),a.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:e,location:r.location,placement:r.placement}),this},updateOverlay:function(e,t,i){var n;return e=_.getElement(e),n=X(this.currentOverlays,e),0<=n&&(this.currentOverlays[n].update(t,i),Q[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:e,location:t,placement:i})),this},removeOverlay:function(e){var t;return e=_.getElement(e),t=X(this.currentOverlays,e),0<=t&&(this.currentOverlays[t].destroy(),this.currentOverlays.splice(t,1),Q[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:e})),this},clearOverlays:function(){for(;0<this.currentOverlays.length;)this.currentOverlays.pop().destroy();return Q[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(e){var t;return e=_.getElement(e),t=X(this.currentOverlays,e),0<=t?this.currentOverlays[t]:null},_updateSequenceButtons:function(e){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==e?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(0<e?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(e){this._hideMessage();var t=_.makeNeutralElement("div");t.appendChild(document.createTextNode(e)),this.messageDiv=_.makeCenteredNode(t),_.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var e=this.messageDiv;e&&(e.parentNode.removeChild(e),delete this.messageDiv)},gestureSettingsByDeviceType:function(e){return"mouse"===e?this.gestureSettingsMouse:"touch"===e?this.gestureSettingsTouch:"pen"===e?this.gestureSettingsPen:this.gestureSettingsUnknown},_drawOverlays:function(){var e,t=this.currentOverlays.length;for(e=0;t>e;e++)this.currentOverlays[e].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]}})}(OpenSeadragon),!function(t){function n(e){e.quick&&this.viewer.viewport&&(this.viewer.viewport.panTo(this.viewport.pointFromPixel(e.position)),this.viewer.viewport.applyConstraints())}function o(e){this.viewer.viewport&&(this.panHorizontal||(e.delta.x=0),this.panVertical||(e.delta.y=0),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(e.delta)))}function r(e){e.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function a(e){return this.viewer.raiseEvent("navigator-scroll",{tracker:e.eventSource,position:e.position,scroll:e.scroll,shift:e.shift,originalEvent:e.originalEvent}),!1}function e(e,t){e.style.webkitTransform="rotate("+t+"deg)",e.style.mozTransform="rotate("+t+"deg)",e.style.msTransform="rotate("+t+"deg)",e.style.oTransform="rotate("+t+"deg)",e.style.transform="rotate("+t+"deg)"}var l=Math.max,s=Math.abs,p=Math.round;t.Navigator=function(s){function d(t){e(g.displayRegionContainer,t),e(g.displayRegion,-t),g.viewport.setRotation(t)}var c,i,u=s.viewer,g=this;if(s.id?(this.element=document.getElementById(s.id),s.controlOptions={anchor:t.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(s.id="navigator-"+t.now(),this.element=t.makeNeutralElement("div"),s.controlOptions={anchor:t.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:s.autoFade},s.position&&("BOTTOM_RIGHT"==s.position?s.controlOptions.anchor=t.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==s.position?s.controlOptions.anchor=t.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==s.position?s.controlOptions.anchor=t.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==s.position?s.controlOptions.anchor=t.ControlAnchor.TOP_LEFT:"ABSOLUTE"==s.position&&(s.controlOptions.anchor=t.ControlAnchor.ABSOLUTE,s.controlOptions.top=s.top,s.controlOptions.left=s.left,s.controlOptions.height=s.height,s.controlOptions.width=s.width))),this.element.id=s.id,this.element.className+=" navigator",s=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.navigatorSizeRatio},s,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:s.autoResize,minZoomImageRatio:1}),s.minPixelRatio=this.minPixelRatio=u.minPixelRatio,t.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new t.Point(1,1),this.totalBorderWidths=new t.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),s.controlOptions.anchor==t.ControlAnchor.NONE||function(e,t){e.margin="0px",e.border=t+"px solid #555",e.padding="0px",e.background="#000",e.opacity=.8,e.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=t.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",!function(e,t){e.position="relative",e.top="0px",e.left="0px",e.fontSize="0px",e.overflow="hidden",e.border=t+"px solid #900",e.margin="0px",e.padding="0px",e.background="transparent",e.float="left",e.cssFloat="left",e.styleFloat="left",e.zIndex=999999999,e.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=t.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",u.addControl(this.element,s.controlOptions),this._resizeWithViewer=s.controlOptions.anchor!=t.ControlAnchor.ABSOLUTE&&s.controlOptions.anchor!=t.ControlAnchor.NONE,this._resizeWithViewer&&(s.width&&s.height?(this.element.style.height="number"==typeof s.height?s.height+"px":s.height,this.element.style.width="number"==typeof s.width?s.width+"px":s.width):(c=t.getElementSize(u.element),this.element.style.height=p(c.y*s.sizeRatio)+"px",this.element.style.width=p(c.x*s.sizeRatio)+"px",this.oldViewerSize=c),i=t.getElementSize(this.element),this.elementArea=i.x*i.y),this.oldContainerSize=new t.Point(0,0),t.Viewer.apply(this,[s]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),s.navigatorRotate){var l=s.viewer.viewport?s.viewer.viewport.getRotation():s.viewer.degrees||0;d(l),s.viewer.addHandler("rotate",function(e){d(e.degrees)})}this.innerTracker.destroy(),this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,o),clickHandler:t.delegate(this,n),releaseHandler:t.delegate(this,r),scrollHandler:t.delegate(this,a)}),this.addHandler("reset-size",function(){g.viewport&&g.viewport.goHome(!0)}),u.world.addHandler("item-index-change",function(e){var t=g.world.getItemAt(e.previousIndex);g.world.setItemIndex(t,e.newIndex)}),u.world.addHandler("remove-item",function(e){var t=e.item,i=g._getMatchingItem(t);i&&g.world.removeItem(i)}),this.update(u.viewport)},t.extend(t.Navigator.prototype,t.EventSource.prototype,t.Viewer.prototype,{updateSize:function(){if(this.viewport){var e=new t.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);e.equals(this.oldContainerSize)||(this.viewport.resize(e,!0),this.viewport.goHome(!0),this.oldContainerSize=e,this.drawer.clear(),this.world.draw())}},update:function(n){var o,r,a,e,d,c;if(o=t.getElementSize(this.viewer.element),this._resizeWithViewer&&o.x&&o.y&&!o.equals(this.oldViewerSize)&&(this.oldViewerSize=o,this.maintainSizeRatio||!this.elementArea?(r=o.x*this.sizeRatio,a=o.y*this.sizeRatio):(r=Math.sqrt(this.elementArea*(o.x/o.y)),a=this.elementArea/r),this.element.style.width=p(r)+"px",this.element.style.height=p(a)+"px",this.elementArea||(this.elementArea=r*a),this.updateSize()),n&&this.viewport){e=n.getBoundsNoRotate(!0),d=this.viewport.pixelFromPointNoRotate(e.getTopLeft(),!1),c=this.viewport.pixelFromPointNoRotate(e.getBottomRight(),!1).minus(this.totalBorderWidths);var u=this.displayRegion.style;u.display=this.world.getItemCount()?"block":"none",u.top=p(d.y)+"px",u.left=p(d.x)+"px";var i=s(d.x-c.x),g=s(d.y-c.y);u.width=p(l(i,0))+"px",u.height=p(l(g,0))+"px"}},addTiledImage:function(i){var n=this,o=i.originalTiledImage;delete i.original;var r=t.extend({},i,{success:function(e){var t=e.item;t._originalForNavigator=o,n._matchBounds(t,o,!0),o.addHandler("bounds-change",function(){n._matchBounds(t,o)})}});return t.Viewer.prototype.addTiledImage.apply(this,[r])},_getMatchingItem:function(e){for(var t,i=this.world.getItemCount(),n=0;i>n;n++)if(t=this.world.getItemAt(n),t._originalForNavigator===e)return t;return null},_matchBounds:function(e,t,i){var n=t.getBounds();e.setPosition(n.getTopLeft(),i),e.setWidth(n.width,i)}})}(OpenSeadragon),!function(t){var i={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right"}};t.extend(t,{getString:function(n){var o,r=n.split("."),e=null,l=arguments,a=i;for(o=0;o<r.length-1;o++)a=a[r[o]]||{};return e=a[r[o]],"string"!=typeof e&&(t.console.debug("Untranslated source string:",n),e=""),e.replace(/\{\d+\}/g,function(e){var t=parseInt(e.match(/\d+/),10)+1;return t<l.length?l[t]:""})},setString:function(t,n){var o,r=t.split("."),e=i;for(o=0;o<r.length-1;o++)e[r[o]]||(e[r[o]]={}),e=e[r[o]];e[r[o]]=n}})}(OpenSeadragon),!function(t){var e=Math.pow,i=Math.round;t.Point=function(e,t){this.x="number"==typeof e?e:0,this.y="number"==typeof t?t:0},t.Point.prototype={clone:function(){return new t.Point(this.x,this.y)},plus:function(e){return new t.Point(this.x+e.x,this.y+e.y)},minus:function(e){return new t.Point(this.x-e.x,this.y-e.y)},times:function(e){return new t.Point(this.x*e,this.y*e)},divide:function(e){return new t.Point(this.x/e,this.y/e)},negate:function(){return new t.Point(-this.x,-this.y)},distanceTo:function(t){return Math.sqrt(e(this.x-t.x,2)+e(this.y-t.y,2))},apply:function(e){return new t.Point(e(this.x),e(this.y))},equals:function(e){return e instanceof t.Point&&this.x===e.x&&this.y===e.y},rotate:function(n,o){o=o||new t.Point(0,0);var r,a;if(0===n%90){var e=n%360;0>e&&(e+=360);0===e?(r=1,a=0):90===e?(r=0,a=1):180===e?(r=-1,a=0):270===e?(r=0,a=-1):void 0}else{var l=n*Math.PI/180;r=Math.cos(l),a=Math.sin(l)}var s=r*(this.x-o.x)-a*(this.y-o.y)+o.x,d=a*(this.x-o.x)+r*(this.y-o.y)+o.y;return new t.Point(s,d)},toString:function(){return"("+i(100*this.x)/100+","+i(100*this.y)/100+")"}}}(OpenSeadragon),!function(t){function i(i){var n,o,r=i.responseText,e=i.status;if(!i)throw new Error(t.getString("Errors.Security"));if(200!==i.status&&0!==i.status)throw e=i.status,n=404==e?"Not Found":i.statusText,new Error(t.getString("Errors.Status",e,n));if(r.match(/\s*<.*/))try{o=i.responseXML&&i.responseXML.documentElement?i.responseXML:t.parseXml(r)}catch(e){o=i.responseText}else o=r.match(/\s*[\{\[].*/)?t.parseJSON(r):r;return o}var n=Math.ceil,o=Math.max,r=Math.min,a=Math.floor;t.TileSource=function(e){var r,i,l=this,a=arguments;if(r=t.isPlainObject(e)?e:{width:a[0],height:a[1],tileSize:a[2],tileOverlap:a[3],minLevel:a[4],maxLevel:a[5]},t.EventSource.call(this),t.extend(!0,this,r),!this.success)for(i=0;i<arguments.length;i++)if(t.isFunction(arguments[i])){this.success=arguments[i];break}this.success&&this.addHandler("ready",function(e){l.success(e)}),"string"==t.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new t.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=r.width&&r.height?r.width/r.height:1,this.dimensions=new t.Point(r.width,r.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=r.tileOverlap?r.tileOverlap:0,this.minLevel=r.minLevel?r.minLevel:0,this.maxLevel=void 0!==r.maxLevel&&null!==r.maxLevel?r.maxLevel:r.width&&r.height?n(Math.log(o(r.width,r.height))/0.6931471805599453):0,this.success&&t.isFunction(this.success)&&this.success(this))},t.TileSource.prototype={getTileSize:function(){return t.console.error("[TileSource.getTileSize] is deprecated.Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(e){return this._tileWidth?this._tileWidth:this.getTileSize(e)},getTileHeight:function(e){return this._tileHeight?this._tileHeight:this.getTileSize(e)},getLevelScale:function(e){var t,i={};for(t=0;t<=this.maxLevel;t++)i[t]=1/Math.pow(2,this.maxLevel-t);return this.getLevelScale=function(e){return i[e]},this.getLevelScale(e)},getNumTiles:function(i){var o=this.getLevelScale(i),r=n(o*this.dimensions.x/this.getTileWidth(i)),a=n(o*this.dimensions.y/this.getTileHeight(i));return new t.Point(r,a)},getPixelRatio:function(i){var n=this.dimensions.times(this.getLevelScale(i)),o=1/n.x,r=1/n.y;return new t.Point(o,r)},getClosestLevel:function(i){var n,r,l;for(n=this.minLevel;n<this.maxLevel&&(l=this.getNumTiles(n),r=new t.Point(a(i.x/this.getTileWidth(n)),a(i.y/this.getTileHeight(n))),!(l.x+1>=r.x&&l.y+1>=r.y));n++);return o(0,n-1)},getTileAtPoint:function(i,n){var o=n.times(this.dimensions.x).times(this.getLevelScale(i)),r=a(o.x/this.getTileWidth(i)),e=a(o.y/this.getTileHeight(i));return new t.Point(r,e)},getTileBounds:function(n,o,a){var s=this.dimensions.times(this.getLevelScale(n)),e=this.getTileWidth(n),d=this.getTileHeight(n),c=0===o?0:e*o-this.tileOverlap,p=0===a?0:d*a-this.tileOverlap,i=e+(0===o?1:2)*this.tileOverlap,u=d+(0===a?1:2)*this.tileOverlap,g=1/s.x;return i=r(i,s.x-c),u=r(u,s.y-p),new t.Rect(c*g,p*g,i*g,u*g)},getImageInfo:function(n){var o,r,a,l,s,p,u,g=this;n&&(s=n.split("/"),p=s[s.length-1],u=p.lastIndexOf("."),-1<u&&(s[s.length-1]=p.slice(0,u))),r=function(e){"string"==typeof e&&(e=t.parseXml(e));var i=t.TileSource.determineType(g,e,n);i?(l=i.prototype.configure.apply(g,[e,n]),void 0===l.ajaxWithCredentials&&(l.ajaxWithCredentials=g.ajaxWithCredentials),a=new i(l),g.ready=!0,g.raiseEvent("ready",{tileSource:a})):g.raiseEvent("open-failed",{message:"Unable to load TileSource",source:n})},n.match(/\.js$/)?(o=n.split("/").pop().replace(".js",""),t.jsonp({url:n,async:!1,callbackName:o,callback:r})):t.makeAjaxRequest({url:n,withCredentials:this.ajaxWithCredentials,success:function(e){var t=i(e);r(t)},error:function(e,t){var i;try{i="HTTP "+e.status+" attempting to load TileSource"}catch(n){var o;o="undefined"!=typeof t&&t.toString?t.toString():"Unknown error",i=o+" attempting to load TileSource"}g.raiseEvent("open-failed",{message:i,source:n})}})},supports:function(){return!1},configure:function(){throw new Error("Method not implemented.")},getTileUrl:function(){throw new Error("Method not implemented.")},tileExists:function(e,t,i){var n=this.getNumTiles(e);return e>=this.minLevel&&e<=this.maxLevel&&0<=t&&0<=i&&t<n.x&&i<n.y}},t.extend(!0,t.TileSource.prototype,t.EventSource.prototype),t.TileSource.determineType=function(i,n,o){for(var r in OpenSeadragon)if(r.match(/.+TileSource$/)&&t.isFunction(OpenSeadragon[r])&&t.isFunction(OpenSeadragon[r].prototype.supports)&&OpenSeadragon[r].prototype.supports.call(i,n,o))return OpenSeadragon[r];t.console.error("No TileSource was able to open %s %s",o,n)}}(OpenSeadragon),!function(t){function i(r,a){if(!a||!a.documentElement)throw new Error(t.getString("Errors.Xml"));var s,e,c,u,g,i=a.documentElement,h=i.localName||i.tagName,v=a.documentElement.namespaceURI,l=null,m=[];if("Image"==h)try{if(u=i.getElementsByTagName("Size")[0],void 0===u&&(u=i.getElementsByTagNameNS(v,"Size")[0]),l={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:i.getAttribute("Url"),Format:i.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(i.getAttribute("Overlap"),10),TileSize:parseInt(i.getAttribute("TileSize"),10),Size:{Height:parseInt(u.getAttribute("Height"),10),Width:parseInt(u.getAttribute("Width"),10)}}},!t.imageFormatSupported(l.Image.Format))throw new Error(t.getString("Errors.ImageFormat",l.Image.Format.toUpperCase()));for(s=i.getElementsByTagName("DisplayRect"),void 0===s&&(s=i.getElementsByTagNameNS(v,"DisplayRect")[0]),g=0;g<s.length;g++)e=s[g],c=e.getElementsByTagName("Rect")[0],void 0===c&&(c=e.getElementsByTagNameNS(v,"Rect")[0]),m.push({Rect:{X:parseInt(c.getAttribute("X"),10),Y:parseInt(c.getAttribute("Y"),10),Width:parseInt(c.getAttribute("Width"),10),Height:parseInt(c.getAttribute("Height"),10),MinLevel:parseInt(e.getAttribute("MinLevel"),10),MaxLevel:parseInt(e.getAttribute("MaxLevel"),10)}});return m.length&&(l.Image.DisplayRect=m),o(r,l)}catch(e){throw e instanceof Error?e:new Error(t.getString("Errors.Dzi"))}else{if("Collection"==h)throw new Error(t.getString("Errors.Dzc"));if("Error"==h){var n=i.getElementsByTagName("Message")[0],p=n.firstChild.nodeValue;throw new Error(p)}}throw new Error(t.getString("Errors.Dzi"))}function o(r,a){var s,d,e=a.Image,p=e.Url,u=e.Format,v=e.Size,i=e.DisplayRect||[],y=parseInt(v.Width,10),T=parseInt(v.Height,10),w=parseInt(e.TileSize,10),x=parseInt(e.Overlap,10),f=[];for(d=0;d<i.length;d++)s=i[d].Rect,f.push(new t.DisplayRect(parseInt(s.X,10),parseInt(s.Y,10),parseInt(s.Width,10),parseInt(s.Height,10),parseInt(s.MinLevel,10),parseInt(s.MaxLevel,10)));return t.extend(!0,{width:y,height:T,tileSize:w,tileOverlap:x,minLevel:null,maxLevel:null,tilesUrl:p,fileFormat:u,displayRects:f},a)}var n=Math.ceil,r=Math.floor;t.DziTileSource=function(e){var i,o,r,a;if(a=t.isPlainObject(e)?e:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=a.tilesUrl,this.fileFormat=a.fileFormat,this.displayRects=a.displayRects,this.displayRects)for(i=this.displayRects.length-1;0<=i;i--)for(o=this.displayRects[i],r=o.minLevel;r<=o.maxLevel;r++)this._levelRects[r]||(this._levelRects[r]=[]),this._levelRects[r].push(o);t.TileSource.apply(this,[a])},t.extend(t.DziTileSource.prototype,t.TileSource.prototype,{supports:function(e){var t;return e.Image?t=e.Image.xmlns:e.documentElement&&("Image"==e.documentElement.localName||"Image"==e.documentElement.tagName)&&(t=e.documentElement.namespaceURI),"http://schemas.microsoft.com/deepzoom/2008"==t||"http://schemas.microsoft.com/deepzoom/2009"==t},configure:function(n,r){var e;return e=t.isPlainObject(n)?o(this,n):i(this,n),r&&!e.tilesUrl&&(e.tilesUrl=r.replace(/([^\/]+?)(\.(dzi|xml|js))?\/?(\?.*)?$/,"$1_files/"),e.queryParams=-1==r.search(/\.(dzi|xml|js)\?/)?"":r.match(/\?.*/)),e},getTileUrl:function(e,t,i){return[this.tilesUrl,e,"/",t,"_",i,".",this.fileFormat,this.queryParams].join("")},tileExists:function(t,o,a){var l,s,e,d,c,p,i,u=this._levelRects[t];if(!u||!u.length)return!0;for(i=u.length-1;0<=i;i--)if(l=u[i],!(t<l.minLevel||t>l.maxLevel)&&(s=this.getLevelScale(t),e=l.x*s,d=l.y*s,c=e+l.width*s,p=d+l.height*s,e=r(e/this.tileSize),d=r(d/this.tileSize),c=n(c/this.tileSize),p=n(p/this.tileSize),o>=e&&c>o&&a>=d&&p>a))return!0;return!1}})}(OpenSeadragon),!function(t){function n(e){var t=-1!=["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json"].indexOf(e[0]);return!t||-1!=e.indexOf("sizeByW")}function o(e){for(var t=[],i=0;i<e.sizes.length;i++)t.push({url:e["@id"]+"/full/"+e.sizes[i].width+",/0/default.jpg",width:e.sizes[i].width,height:e.sizes[i].height});return t.sort(function(e,t){return e.width-t.width})}function i(e){if(!e||!e.documentElement)throw new Error(t.getString("Errors.Xml"));var i=e.documentElement,n=i.tagName,o=null;if("info"==n)try{return o={},r(i,o),o}catch(e){throw e instanceof Error?e:new Error(t.getString("Errors.IIIF"))}throw new Error(t.getString("Errors.IIIF"))}function r(e,i,n){var o,a;if(3==e.nodeType&&n)a=e.nodeValue.trim(),a.match(/^\d*$/)&&(a=+a),i[n]?(t.isArray(i[n])||(i[n]=[i[n]]),i[n].push(a)):i[n]=a;else if(1==e.nodeType)for(o=0;o<e.childNodes.length;o++)r(e.childNodes[o],i,e.nodeName)}var u=Math.ceil,v=Math.pow,a=Math.max,y=Math.min;t.IIIFTileSource=function(r){if(t.extend(!0,this,r),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(r.tileSizePerScaleFactor={},this.tile_width&&this.tile_height)r.tileWidth=this.tile_width,r.tileHeight=this.tile_height;else if(this.tile_width)r.tileSize=this.tile_width;else if(this.tile_height)r.tileSize=this.tile_height;else if(this.tiles){if(1==this.tiles.length)r.tileWidth=this.tiles[0].width,r.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var l=0;l<this.tiles.length;l++)for(var e,s=0;s<this.tiles[l].scaleFactors.length;s++)e=this.tiles[l].scaleFactors[s],this.scale_factors.push(e),r.tileSizePerScaleFactor[e]={width:this.tiles[l].width,height:this.tiles[l].height||this.tiles[l].width}}}else if(n(r.profile)){for(var d=y(this.height,this.width),c=[256,512,1024],i=[],p=0;p<c.length;p++)c[p]<=d&&i.push(c[p]);r.tileSize=0<i.length?a.apply(null,i):d}else this.sizes&&0<this.sizes.length?(this.emulateLegacyImagePyramid=!0,r.levels=o(this),t.extend(!0,r,{width:r.levels[r.levels.length-1].width,height:r.levels[r.levels.length-1].height,tileSize:a(r.height,r.width),tileOverlap:0,minLevel:0,maxLevel:r.levels.length-1}),this.levels=r.levels):t.console.error("Nothing in the info.json to construct image pyramids from");r.maxLevel||this.emulateLegacyImagePyramid||(this.scale_factors?r.maxLevel=Math.floor(v(a.apply(null,this.scale_factors),.5)):r.maxLevel=+u(Math.log(a(this.width,this.height),2))),t.TileSource.apply(this,[r])},t.extend(t.IIIFTileSource.prototype,t.TileSource.prototype,{supports:function(e){return e.protocol&&"http://iiif.io/api/image"==e.protocol||e["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"==e["@context"]||"http://iiif.io/api/image/1/context.json"==e["@context"])||e.profile&&0===e.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||e.identifier&&e.width&&e.height||e.documentElement&&"info"==e.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==e.documentElement.namespaceURI},configure:function(n,o){if(t.isPlainObject(n))return n["@context"]?n:(n["@context"]="http://iiif.io/api/image/1.0/context.json",n["@id"]=o.replace("/info.json",""),n);var r=i(n);return r["@context"]="http://iiif.io/api/image/1.0/context.json",r["@id"]=o.replace("/info.xml",""),r},getTileWidth:function(e){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileWidth.call(this,e);var i=v(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].width:this._tileWidth},getTileHeight:function(e){if(this.emulateLegacyImagePyramid)return t.TileSource.prototype.getTileHeight.call(this,e);var i=v(2,this.maxLevel-e);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[i]?this.tileSizePerScaleFactor[i].height:this._tileHeight},getLevelScale:function(e){if(this.emulateLegacyImagePyramid){var i=NaN;return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel&&(i=this.levels[e].width/this.levels[this.maxLevel].width),i}return t.TileSource.prototype.getLevelScale.call(this,e)},getNumTiles:function(e){if(this.emulateLegacyImagePyramid){var i=this.getLevelScale(e);return i?new t.Point(1,1):new t.Point(0,0)}return t.TileSource.prototype.getNumTiles.call(this,e)},getTileAtPoint:function(e,i){return this.emulateLegacyImagePyramid?new t.Point(0,0):t.TileSource.prototype.getTileAtPoint.call(this,e,i)},getTileUrl:function(T,a,w){if(this.emulateLegacyImagePyramid){var c=null;return 0<this.levels.length&&T>=this.minLevel&&T<=this.maxLevel&&(c=this.levels[T].url),c}var d,e,x,g,h,i,f,S,l,m,n,o,p=v(.5,this.maxLevel-T),r=u(this.width*p),s=u(this.height*p);return d=this.getTileWidth(T),e=this.getTileHeight(T),x=u(d/p),g=u(e/p),n=-1<this["@context"].indexOf("/1.0/context.json")||-1<this["@context"].indexOf("/1.1/context.json")||-1<this["@context"].indexOf("/1/context.json")?"native.jpg":"default.jpg",d>r&&e>s?(m=r+",",h="full"):(i=a*x,f=w*g,S=y(x,this.width-i),l=y(g,this.height-f),m=u(S*p)+",",h=[i,f,S,l].join(",")),o=[this["@id"],h,m,"0",n].join("/"),o}})}(OpenSeadragon),!function(e){e.OsmTileSource=function(t){var i;i=e.isPlainObject(t)?t:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]},i.width&&i.height||(i.width=65572864,i.height=65572864),i.tileSize||(i.tileSize=256,i.tileOverlap=0),i.tilesUrl||(i.tilesUrl="http://tile.openstreetmap.org/"),i.minLevel=8,e.TileSource.apply(this,[i])},e.extend(e.OsmTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"openstreetmaps"==e.type},configure:function(e){return e},getTileUrl:function(e,t,i){return this.tilesUrl+(e-8)+"/"+t+"/"+i+".png"}})}(OpenSeadragon),!function(e){var t=Math.ceil;e.TmsTileSource=function(n){var o=e.isPlainObject(n)?n:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var r,a=256*t(o.width/256),i=256*t(o.height/256);r=a>i?a/256:i/256,o.maxLevel=t(Math.log(r)/0.6931471805599453)-1,o.tileSize=256,o.width=a,o.height=i,e.TileSource.apply(this,[o])},e.extend(e.TmsTileSource.prototype,e.TileSource.prototype,{supports:function(e){return e.type&&"tiledmapservice"==e.type},configure:function(e){return e},getTileUrl:function(e,t,i){var n=this.getNumTiles(e).y-1;return this.tilesUrl+e+"/"+t+"/"+(n-i)+".png"}})}(OpenSeadragon),!function(t){function i(i){var n,o,r=[];for(o=0;o<i.length;o++)n=i[o],n.height&&n.width&&n.url&&(n.url.toLowerCase().match(/^.*\.(png|jpg|jpeg|gif)(?:\?.*)?$/)||n.mimetype&&n.mimetype.toLowerCase().match(/^.*\/(png|jpg|jpeg|gif)$/))?r.push({url:n.url,width:+n.width,height:+n.height}):t.console.error("Unsupported image format: %s",n.url?n.url:"<no URL>");return r.sort(function(e,t){return e.height-t.height})}function e(o,r){if(!r||!r.documentElement)throw new Error(t.getString("Errors.Xml"));var a,e,l=r.documentElement,s=l.tagName,d=null,i=[];if("image"==s)try{for(d={type:l.getAttribute("type"),levels:[]},i=l.getElementsByTagName("level"),e=0;e<i.length;e++)a=i[e],d.levels.push({url:a.getAttribute("url"),width:parseInt(a.getAttribute("width"),10),height:parseInt(a.getAttribute("height"),10)});return n(o,d)}catch(e){throw e instanceof Error?e:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==s)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==s)throw new Error("Error: "+r)}throw new Error("Unknown element "+s)}function n(e,t){return t.levels}t.LegacyTileSource=function(n){var o,r,a;t.isArray(n)&&(o={type:"legacy-image-pyramid",levels:n}),o.levels=i(o.levels),0<o.levels.length?(r=o.levels[o.levels.length-1].width,a=o.levels[o.levels.length-1].height):(r=0,a=0,t.console.error("No supported image formats found")),t.extend(!0,o,{width:r,height:a,tileSize:Math.max(a,r),tileOverlap:0,minLevel:0,maxLevel:0<o.levels.length?o.levels.length-1:0}),t.TileSource.apply(this,[o]),this.levels=o.levels},t.extend(t.LegacyTileSource.prototype,t.TileSource.prototype,{supports:function(e){return e.type&&"legacy-image-pyramid"==e.type||e.documentElement&&"legacy-image-pyramid"==e.documentElement.getAttribute("type")},configure:function(i){var o;return o=t.isPlainObject(i)?n(this,i):e(this,i),o},getLevelScale:function(e){var t=NaN;return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(e){var i=this.getLevelScale(e);return i?new t.Point(1,1):new t.Point(0,0)},getTileAtPoint:function(){return new t.Point(0,0)},getTileUrl:function(e){var t=null;return 0<this.levels.length&&e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].url),t}})}(OpenSeadragon),!function(t){var i=Math.floor;t.ImageTileSource=function(e){e=t.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},e),t.TileSource.apply(this,[e])},t.extend(t.ImageTileSource.prototype,t.TileSource.prototype,{supports:function(e){return e.type&&"image"===e.type},configure:function(e){return e},getImageInfo:function(e){var i=this._image=new Image,n=this;this.crossOriginPolicy&&(i.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(i.useCredentials=this.ajaxWithCredentials),t.addEvent(i,"load",function(){n.width=i.naturalWidth,n.height=i.naturalHeight,n.aspectRatio=n.width/n.height,n.dimensions=new t.Point(n.width,n.height),n._tileWidth=n.width,n._tileHeight=n.height,n.tileOverlap=0,n.minLevel=0,n.levels=n._buildLevels(),n.maxLevel=n.levels.length-1,n.ready=!0,n.raiseEvent("ready",{tileSource:n})}),t.addEvent(i,"error",function(){n.raiseEvent("open-failed",{message:"Error loading image at "+e,source:e})}),i.src=e},getLevelScale:function(e){var t=NaN;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].width/this.levels[this.maxLevel].width),t},getNumTiles:function(e){var i=this.getLevelScale(e);return i?new t.Point(1,1):new t.Point(0,0)},getTileAtPoint:function(){return new t.Point(0,0)},getTileUrl:function(e){var t=null;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].url),t},getContext2D:function(e){var t=null;return e>=this.minLevel&&e<=this.maxLevel&&(t=this.levels[e].context2D),t},_buildLevels:function(){var n=[{url:this._image.src,width:this._image.naturalWidth,height:this._image.naturalHeight}];if(!this.buildPyramid||!t.supportsCanvas||!this.useCanvas)return delete this._image,n;var o=this._image.naturalWidth,r=this._image.naturalHeight,a=document.createElement("canvas"),e=a.getContext("2d");if(a.width=o,a.height=r,e.drawImage(this._image,0,0,o,r),n[0].context2D=e,delete this._image,t.isCanvasTainted(a))return n;for(;2<=o&&2<=r;){o=i(o/2),r=i(r/2);var l=document.createElement("canvas"),s=l.getContext("2d");l.width=o,l.height=r,s.drawImage(a,0,0,o,r),n.splice(0,0,{context2D:s,width:o,height:r}),a=l,e=s}return n}})}(OpenSeadragon),!function(e){e.TileSourceCollection=function(){e.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),!function(t){function i(e){t.requestAnimationFrame(function(){n(e)})}function n(n){var o,r,e;n.shouldFade&&(o=t.now(),r=o-n.fadeBeginTime,e=1-r/n.fadeLength,e=Math.min(1,e),e=Math.max(0,e),n.imgGroup&&t.setElementOpacity(n.imgGroup,e,!0),0<e&&i(n))}function o(e){e.shouldFade=!0,e.fadeBeginTime=t.now()+e.fadeDelay,window.setTimeout(function(){i(e)},e.fadeDelay)}function r(e){e.shouldFade=!1,e.imgGroup&&t.setElementOpacity(e.imgGroup,1,!0)}function e(e,i){e.element.disabled||(i>=t.ButtonState.GROUP&&e.currentState==t.ButtonState.REST&&(r(e),e.currentState=t.ButtonState.GROUP),i>=t.ButtonState.HOVER&&e.currentState==t.ButtonState.GROUP&&(e.imgHover&&(e.imgHover.style.visibility=""),e.currentState=t.ButtonState.HOVER),i>=t.ButtonState.DOWN&&e.currentState==t.ButtonState.HOVER&&(e.imgDown&&(e.imgDown.style.visibility=""),e.currentState=t.ButtonState.DOWN))}function a(e,i){e.element.disabled||(i<=t.ButtonState.HOVER&&e.currentState==t.ButtonState.DOWN&&(e.imgDown&&(e.imgDown.style.visibility="hidden"),e.currentState=t.ButtonState.HOVER),i<=t.ButtonState.GROUP&&e.currentState==t.ButtonState.HOVER&&(e.imgHover&&(e.imgHover.style.visibility="hidden"),e.currentState=t.ButtonState.GROUP),i<=t.ButtonState.REST&&e.currentState==t.ButtonState.GROUP&&(o(e),e.currentState=t.ButtonState.REST))}t.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},t.Button=function(i){var n=this;t.EventSource.call(this),t.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},i),this.element=i.element||t.makeNeutralElement("div"),i.element||(this.imgRest=t.makeTransparentImage(this.srcRest),this.imgGroup=t.makeTransparentImage(this.srcGroup),this.imgHover=t.makeTransparentImage(this.srcHover),this.imgDown=t.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",t.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",t.Browser.vendor==t.BROWSERS.FIREFOX&&3>t.Browser.version&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=t.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(i){i.insideElementPressed?(e(n,t.ButtonState.DOWN),n.raiseEvent("enter",{originalEvent:i.originalEvent})):i.buttonDownAny||e(n,t.ButtonState.HOVER)},focusHandler:function(e){this.enterHandler(e),n.raiseEvent("focus",{originalEvent:e.originalEvent})},exitHandler:function(e){a(n,t.ButtonState.GROUP),e.insideElementPressed&&n.raiseEvent("exit",{originalEvent:e.originalEvent})},blurHandler:function(e){this.exitHandler(e),n.raiseEvent("blur",{originalEvent:e.originalEvent})},pressHandler:function(i){e(n,t.ButtonState.DOWN),n.raiseEvent("press",{originalEvent:i.originalEvent})},releaseHandler:function(i){i.insideElementPressed&&i.insideElementReleased?(a(n,t.ButtonState.HOVER),n.raiseEvent("release",{originalEvent:i.originalEvent})):i.insideElementPressed?a(n,t.ButtonState.GROUP):e(n,t.ButtonState.HOVER)},clickHandler:function(e){e.quick&&n.raiseEvent("click",{originalEvent:e.originalEvent})},keyHandler:function(e){return 13!==e.keyCode||(n.raiseEvent("click",{originalEvent:e.originalEvent}),n.raiseEvent("release",{originalEvent:e.originalEvent}),!1)}}),a(this,t.ButtonState.REST)},t.extend(t.Button.prototype,t.EventSource.prototype,{notifyGroupEnter:function(){e(this,t.ButtonState.GROUP)},notifyGroupExit:function(){a(this,t.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,t.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,t.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),!function(t){t.ButtonGroup=function(i){t.extend(!0,this,{buttons:[],clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:t.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},i);var n,o=this.buttons.concat([]),r=this;if(this.element=i.element||t.makeNeutralElement("div"),!i.group)for(this.label=t.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),n=0;n<o.length;n++)this.element.appendChild(o[n].element);t.setElementTouchActionNone(this.element),this.tracker=new t.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(){var e;for(e=0;e<r.buttons.length;e++)r.buttons[e].notifyGroupEnter()},exitHandler:function(e){var t;if(!e.insideElementPressed)for(t=0;t<r.buttons.length;t++)r.buttons[t].notifyGroupExit()}})},t.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),!function(T){var t=Math.atan,i=Math.ceil,n=Math.PI,o=Math.max,r=Math.min,a=Math.floor,e=Math.round;T.Rect=function(t,i,n,o,r){this.x="number"==typeof t?t:0,this.y="number"==typeof i?i:0,this.width="number"==typeof n?n:0,this.height="number"==typeof o?o:0,this.degrees="number"==typeof r?r:0,this.degrees%=360,0>this.degrees&&(this.degrees+=360);var l,s;270<=this.degrees?(l=this.getTopRight(),this.x=l.x,this.y=l.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=270):180<=this.degrees?(l=this.getBottomRight(),this.x=l.x,this.y=l.y,this.degrees-=180):90<=this.degrees&&(l=this.getBottomLeft(),this.x=l.x,this.y=l.y,s=this.height,this.height=this.width,this.width=s,this.degrees-=90)},T.Rect.fromSummits=function(i,o,r){var a=i.distanceTo(o),e=i.distanceTo(r),l=o.minus(i),s=t(l.y/l.x);return 0>l.x?s+=n:0>l.y&&(s+=2*n),new T.Rect(i.x,i.y,a,e,180*(s/n))},T.Rect.prototype={clone:function(){return new T.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new T.Point(this.x,this.y)},getBottomRight:function(){return new T.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new T.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new T.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new T.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new T.Point(this.width,this.height)},equals:function(e){return e instanceof T.Rect&&this.x===e.x&&this.y===e.y&&this.width===e.width&&this.height===e.height&&this.degrees===e.degrees},times:function(e){return new T.Rect(this.x*e,this.y*e,this.width*e,this.height*e,this.degrees)},translate:function(e){return new T.Rect(this.x+e.x,this.y+e.y,this.width,this.height,this.degrees)},union:function(t){var i=this.getBoundingBox(),n=t.getBoundingBox(),a=r(i.x,n.x),e=r(i.y,n.y),l=o(i.x+i.width,n.x+n.width),s=o(i.y+i.height,n.y+n.height);return new T.Rect(a,e,l-a,s-e)},intersection:function(a){function S(t,n,o,e){var r=n.minus(t),a=e.minus(o),l=-a.x*r.y+r.x*a.y;if(0===l)return null;var i=(r.x*(t.y-o.y)-r.y*(t.x-o.x))/l,s=(a.x*(t.y-o.y)-a.y*(t.x-o.x))/l;return i>=-E&&1-E>=i&&s>=-E&&1-E>=s?new T.Point(t.x+s*r.x,t.y+s*r.y):null}var E=1e-10,c=[],e=this.getTopLeft();a.containsPoint(e,E)&&c.push(e);var f=this.getTopRight();a.containsPoint(f,E)&&c.push(f);var g=this.getBottomLeft();a.containsPoint(g,E)&&c.push(g);var h=this.getBottomRight();a.containsPoint(h,E)&&c.push(h);var i=a.getTopLeft();this.containsPoint(i,E)&&c.push(i);var P=a.getTopRight();this.containsPoint(P,E)&&c.push(P);var R=a.getBottomLeft();this.containsPoint(R,E)&&c.push(R);var l=a.getBottomRight();this.containsPoint(l,E)&&c.push(l);for(var m,_=this._getSegments(),n=a._getSegments(),o=0;o<_.length;o++){m=_[o];for(var p=0;p<n.length;p++){var r=n[p],s=S(m[0],m[1],r[0],r[1]);s&&c.push(s)}}if(0===c.length)return null;for(var t,b=c[0].x,u=c[0].x,v=c[0].y,w=c[0].y,x=1;x<c.length;x++)t=c[x],t.x<b&&(b=t.x),t.x>u&&(u=t.x),t.y<v&&(v=t.y),t.y>w&&(w=t.y);return new T.Rect(b,v,u-b,w-v)},_getSegments:function(){var e=this.getTopLeft(),t=this.getTopRight(),i=this.getBottomLeft(),n=this.getBottomRight();return[[e,t],[t,n],[n,i],[i,e]]},rotate:function(i,o){if(i%=360,0===i)return this.clone();0>i&&(i+=360),o=o||this.getCenter();var r=this.getTopLeft().rotate(i,o),a=this.getTopRight().rotate(i,o),e=a.minus(r),l=t(e.y/e.x);return 0>e.x?l+=n:0>e.y&&(l+=2*n),new T.Rect(r.x,r.y,this.width,this.height,180*(l/n))},getBoundingBox:function(){if(0===this.degrees)return this.clone();var t=this.getTopLeft(),n=this.getTopRight(),a=this.getBottomLeft(),l=this.getBottomRight(),e=r(t.x,n.x,a.x,l.x),s=o(t.x,n.x,a.x,l.x),d=r(t.y,n.y,a.y,l.y),c=o(t.y,n.y,a.y,l.y);return new T.Rect(e,d,s-e,c-d)},getIntegerBoundingBox:function(){var t=this.getBoundingBox(),n=a(t.x),o=a(t.y),r=i(t.width+t.x-n),e=i(t.height+t.y-o);return new T.Rect(n,o,r,e)},containsPoint:function(t,i){i=i||0;var n=this.getTopLeft(),o=this.getTopRight(),r=this.getBottomLeft(),e=o.minus(n),a=r.minus(n);return(t.x-n.x)*e.x+(t.y-n.y)*e.y>=-i&&(t.x-o.x)*e.x+(t.y-o.y)*e.y<=i&&(t.x-n.x)*a.x+(t.y-n.y)*a.y>=-i&&(t.x-r.x)*a.x+(t.y-r.y)*a.y<=i},toString:function(){return"["+e(100*this.x)/100+", "+e(100*this.y)/100+", "+e(100*this.width)/100+"x"+e(100*this.height)/100+", "+e(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),!function(t){function r(i){var n=+this.element.style.marginLeft.replace("px",""),o=+this.element.style.marginTop.replace("px",""),e=+this.element.style.width.replace("px",""),r=+this.element.style.height.replace("px",""),l=t.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?0<-i.delta.x?n>-(e-l.x)&&(this.element.style.marginLeft=n+2*i.delta.x+"px",a(this,l.x,n+2*i.delta.x)):0>-i.delta.x&&0>n&&(this.element.style.marginLeft=n+2*i.delta.x+"px",a(this,l.x,n+2*i.delta.x)):0<-i.delta.y?o>-(r-l.y)&&(this.element.style.marginTop=o+2*i.delta.y+"px",a(this,l.y,o+2*i.delta.y)):0>-i.delta.y&&0>o&&(this.element.style.marginTop=o+2*i.delta.y+"px",a(this,l.y,o+2*i.delta.y))),!1}function s(i){var n=+this.element.style.marginLeft.replace("px",""),o=+this.element.style.marginTop.replace("px",""),e=+this.element.style.width.replace("px",""),r=+this.element.style.height.replace("px",""),l=t.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?0<i.scroll?n>-(e-l.x)&&(this.element.style.marginLeft=n-60*i.scroll+"px",a(this,l.x,n-60*i.scroll)):0>i.scroll&&0>n&&(this.element.style.marginLeft=n-60*i.scroll+"px",a(this,l.x,n-60*i.scroll)):0>i.scroll?o>l.y-r&&(this.element.style.marginTop=o+60*i.scroll+"px",a(this,l.y,o+60*i.scroll)):0<i.scroll&&0>o&&(this.element.style.marginTop=o+60*i.scroll+"px",a(this,l.y,o+60*i.scroll))),!1}function a(o,r,a){var l,e,s,c,p,i,u;for(l="horizontal"==o.scroll?o.panelWidth:o.panelHeight,e=n(r/l)+5,s=n((Math.abs(a)+r)/l)+1,e=s-e,e=0>e?0:e,i=e;s>i&&i<o.panels.length;i++)u=o.panels[i],u.activePanel||(c=new t.Viewer({id:u.id,tileSources:[o.viewer.tileSources[i]],element:u,navigatorSizeRatio:o.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0}),c.displayRegion=t.makeNeutralElement("div"),c.displayRegion.id=u.id+"-displayregion",c.displayRegion.className="displayregion",p=c.displayRegion.style,p.position="relative",p.top="0px",p.left="0px",p.fontSize="0px",p.overflow="hidden",p.float="left",p.cssFloat="left",p.styleFloat="left",p.zIndex=999999999,p.cursor="default",p.width=o.panelWidth-4+"px",p.height=o.panelHeight-4+"px",c.displayRegion.innerTracker=new t.MouseTracker({element:c.displayRegion,startDisabled:!0}),u.getElementsByTagName("div")[0].appendChild(c.displayRegion),u.activePanel=!0)}function d(e){var t=e.eventSource.element;return"horizontal"==this.scroll?t.style.marginBottom="0px":t.style.marginLeft="0px",!1}function e(e){var i=e.eventSource.element;return"horizontal"==this.scroll?i.style.marginBottom="-"+t.getElementSize(i).y/2+"px":i.style.marginLeft="-"+t.getElementSize(i).x/2+"px",!1}function c(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 38:return s.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:return s.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 37:return s.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return s.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0;}}function u(e){if(e.preventDefaultAction||e.ctrl||e.alt||e.meta)return!0;switch(e.keyCode){case 61:return s.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return s.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return s.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:return s.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 97:return s.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return s.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0;}}var n=Math.ceil,o=Math.max,l=Math.min,g={};t.ReferenceStrip=function(i){var h,v,l,m=this,n=i.viewer,o=t.getElementSize(n.element);for(i.id||(i.id="referencestrip-"+t.now(),this.element=t.makeNeutralElement("div"),this.element.id=i.id,this.element.className="referencestrip"),i=t.extend(!0,{sizeRatio:t.DEFAULT_SETTINGS.referenceStripSizeRatio,position:t.DEFAULT_SETTINGS.referenceStripPosition,scroll:t.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:t.DEFAULT_SETTINGS.clickTimeThreshold},i,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),t.extend(this,i),g[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,v=this.element.style,v.marginTop="0px",v.marginRight="0px",v.marginBottom="0px",v.marginLeft="0px",v.left="0px",v.bottom="0px",v.border="0px",v.background="#000",v.position="relative",t.setElementTouchActionNone(this.element),t.setElementOpacity(this.element,.8),this.viewer=n,this.innerTracker=new t.MouseTracker({element:this.element,dragHandler:t.delegate(this,r),scrollHandler:t.delegate(this,s),enterHandler:t.delegate(this,d),exitHandler:t.delegate(this,e),keyDownHandler:t.delegate(this,c),keyHandler:t.delegate(this,u)}),i.width&&i.height?(this.element.style.width=i.width+"px",this.element.style.height=i.height+"px",n.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):"horizontal"==i.scroll?(this.element.style.width=o.x*i.sizeRatio*n.tileSources.length+12*n.tileSources.length+"px",this.element.style.height=o.y*i.sizeRatio+"px",n.addControl(this.element,{anchor:t.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=o.y*i.sizeRatio*n.tileSources.length+12*n.tileSources.length+"px",this.element.style.width=o.x*i.sizeRatio+"px",n.addControl(this.element,{anchor:t.ControlAnchor.TOP_LEFT})),this.panelWidth=o.x*this.sizeRatio+8,this.panelHeight=o.y*this.sizeRatio+8,this.panels=[],l=0;l<n.tileSources.length;l++)h=t.makeNeutralElement("div"),h.id=this.element.id+"-"+l,h.style.width=m.panelWidth+"px",h.style.height=m.panelHeight+"px",h.style.display="inline",h.style.float="left",h.style.cssFloat="left",h.style.styleFloat="left",h.style.padding="2px",t.setElementTouchActionNone(h),h.innerTracker=new t.MouseTracker({element:h,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(e){e.eventSource.dragging=t.now()},releaseHandler:function(i){var o=i.eventSource,r=o.element.id,a=+r.split("-")[2],e=t.now();i.insideElementPressed&&i.insideElementReleased&&o.dragging&&e-o.dragging<o.clickTimeThreshold&&(o.dragging=null,n.goToPage(a))}}),this.element.appendChild(h),h.activePanel=!1,this.panels.push(h);a(this,"vertical"==this.scroll?o.y:o.x,0),this.setFocus(0)},t.extend(t.ReferenceStrip.prototype,t.EventSource.prototype,t.Viewer.prototype,{setFocus:function(e){var n,r=t.getElement(this.element.id+"-"+e),s=t.getElementSize(this.viewer.canvas),p=+this.element.style.width.replace("px",""),u=+this.element.style.height.replace("px",""),i=-+this.element.style.marginLeft.replace("px",""),g=-+this.element.style.marginTop.replace("px","");this.currentSelected!==r&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=r,this.currentSelected.style.background="#999","horizontal"==this.scroll?(n=+e*(this.panelWidth+3),n>i+s.x-this.panelWidth?(n=l(n,p-s.x),this.element.style.marginLeft=-n+"px",a(this,s.x,-n)):i>n&&(n=o(0,n-s.x/2),this.element.style.marginLeft=-n+"px",a(this,s.x,-n))):(n=+e*(this.panelHeight+3),n>g+s.y-this.panelHeight?(n=l(n,u-s.y),this.element.style.marginTop=-n+"px",a(this,s.y,-n)):g>n&&(n=o(0,n-s.y/2),this.element.style.marginTop=-n+"px",a(this,s.y,-n))),this.currentPage=e,d.call(this,{eventSource:this.innerTracker}))},update:function(){return!!g[this.id].animating&&(t.console.log("image reference strip update"),!0)},destroy:function(){this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),!function(t){t.DisplayRect=function(i,n,o,r,e,a){t.Rect.apply(this,[i,n,o,r]),this.minLevel=e,this.maxLevel=a},t.extend(t.DisplayRect.prototype,t.Rect.prototype)}(OpenSeadragon),!function(t){function i(e,t){return(1-n(e*-t))/(1-n(-e))}var n=Math.exp,e=Math.log;t.Spring=function(i){var n=arguments;"object"!=("undefined"===typeof i?"undefined":babelHelpers.typeof(i))&&(i={initial:n.length&&"number"==typeof n[0]?n[0]:void 0,springStiffness:1<n.length?n[1].springStiffness:5,animationTime:1<n.length?n[1].animationTime:1.5}),t.console.assert("number"==typeof i.springStiffness&&0!==i.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),t.console.assert("number"==typeof i.animationTime&&0<=i.animationTime,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),i.exponential&&(this._exponential=!0,delete i.exponential),t.extend(!0,this,i),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:t.now()},t.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=e(this.start.value),this.target._logValue=e(this.target.value),this.current._logValue=e(this.current.value))},t.Spring.prototype={resetTo:function(i){t.console.assert(!this._exponential||0!==i,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=i,this.start.time=this.target.time=this.current.time=t.now(),this._exponential&&(this.start._logValue=e(this.start.value),this.target._logValue=e(this.target.value),this.current._logValue=e(this.current.value))},springTo:function(i){t.console.assert(!this._exponential||0!==i,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=i,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=e(this.start.value),this.target._logValue=e(this.target.value))},shiftBy:function(i){this.start.value+=i,this.target.value+=i,this._exponential&&(t.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=e(this.start.value),this.target._logValue=e(this.target.value))},setExponential:function(i){this._exponential=i,this._exponential&&(t.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=e(this.start.value),this.target._logValue=e(this.target.value),this.current._logValue=e(this.current.value))},update:function(){this.current.time=t.now();var o,r;this._exponential?(o=this.start._logValue,r=this.target._logValue):(o=this.start.value,r=this.target.value);var a=this.current.time>=this.target.time?r:o+(r-o)*i(this.springStiffness,(this.current.time-this.start.time)/(this.target.time-this.start.time));this.current.value=this._exponential?n(a):a},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),!function(e){function t(t){e.extend(!0,this,{timeout:e.DEFAULT_SETTINGS.timeout,jobId:null},t),this.image=null}function i(e,t,i){var n;e.jobsInProgress--,(!e.jobLimit||e.jobsInProgress<e.jobLimit)&&0<e.jobQueue.length&&(n=e.jobQueue.shift(),n.start(),e.jobsInProgress++),i(t.image,t.errorMsg)}t.prototype={errorMsg:null,start:function(){var e=this;this.image=new Image,!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.onload=function(){e.finish(!0)},this.image.onabort=this.image.onerror=function(){e.errorMsg="Image load aborted",e.finish(!1)},this.jobId=window.setTimeout(function(){e.errorMsg="Image load exceeded timeout",e.finish(!1)},this.timeout),this.image.src=this.src},finish:function(e){this.image.onload=this.image.onerror=this.image.onabort=null,e||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},e.ImageLoader=function(t){e.extend(!0,this,{jobLimit:e.DEFAULT_SETTINGS.imageLoaderLimit,jobQueue:[],jobsInProgress:0},t)},e.ImageLoader.prototype={addJob:function(e){var n=this,o={src:e.src,crossOriginPolicy:e.crossOriginPolicy,callback:function(t){i(n,t,e.callback)},abort:e.abort},r=new t(o);!this.jobLimit||this.jobsInProgress<this.jobLimit?(r.start(),this.jobsInProgress++):this.jobQueue.push(r)},clear:function(){for(var e,t=0;t<this.jobQueue.length;t++)e=this.jobQueue[t],"function"==typeof e.abort&&e.abort();this.jobQueue=[]}}}(OpenSeadragon),!function(t){var i=Math.ceil,n=Math.max;t.Tile=function(t,i,n,o,r,e,a){this.level=t,this.x=i,this.y=n,this.bounds=o,this.exists=r,this.url=e,this.context2D=a,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.distance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0},t.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(e){this.cacheImageRecord?this.loaded?(!this.element&&(this.element=t.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=e&&e.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",t.setElementOpacity(this.element,this.opacity)):t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):t.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(i,n,o,r){var e,a=this.position.times(t.pixelDensityRatio),l=this.size.times(t.pixelDensityRatio);this.context2D||this.cacheImageRecord?(e=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&e?(i.save(),i.globalAlpha=this.opacity,"number"==typeof o&&1!==o&&(a=a.times(o),l=l.times(o)),r instanceof t.Point&&(a=a.plus(r)),1===i.globalAlpha&&this._hasTransparencyChannel()&&i.clearRect(a.x+1,a.y+1,l.x-2,l.y-2),n({context:i,tile:this,rendered:e}),i.drawImage(e.canvas,0,0,e.canvas.width,e.canvas.height,a.x,a.y,l.x,l.y),i.restore()):t.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):t.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var e;if(this.cacheImageRecord)e=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return t.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;e=this.context2D}return e.canvas.width/(this.size.x*t.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(o,r,a){var l=n(1,i((a.x-r.x)/2)),e=n(1,i((a.y-r.y)/2));return new t.Point(l,e).minus(this.position.times(t.pixelDensityRatio).times(o||1).apply(function(e){return e%1}))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),!function(t){t.OverlayPlacement=t.Placement,t.OverlayRotationMode=t.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),t.Overlay=function(i,n,o){var r;r=t.isPlainObject(i)?i:{element:i,location:n,placement:o},this.element=r.element,this.style=r.element.style,this._init(r)},t.Overlay.prototype={_init:function(e){this.location=e.location,this.placement=void 0===e.placement?t.Placement.TOP_LEFT:e.placement,this.onDraw=e.onDraw,this.checkResize=!(void 0!==e.checkResize)||e.checkResize,this.width=void 0===e.width?null:e.width,this.height=void 0===e.height?null:e.height,this.rotationMode=e.rotationMode||t.OverlayRotationMode.EXACT,this.location instanceof t.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=t.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new t.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(e,i){var n=t.Placement.properties[this.placement];n&&(n.isHorizontallyCentered?e.x-=i.x/2:n.isRight&&(e.x-=i.x),n.isVerticallyCentered?e.y-=i.y/2:n.isBottom&&(e.y-=i.y))},destroy:function(){var i=this.element,n=this.style;i.parentNode&&(i.parentNode.removeChild(i),i.prevElementParent&&(n.display="none",document.body.appendChild(i))),this.onDraw=null,n.top="",n.left="",n.position="",null!==this.width&&(n.width=""),null!==this.height&&(n.height="");var o=t.getCssPropertyWithVendorPrefix("transformOrigin"),r=t.getCssPropertyWithVendorPrefix("transform");o&&r&&(n[o]="",n[r]="")},drawHTML:function(n,o){var r=this.element;r.parentNode!==n&&(r.prevElementParent=r.parentNode,r.prevNextSibling=r.nextSibling,n.appendChild(r),this.size=t.getElementSize(r));var a=this._getOverlayPositionAndSize(o),e=a.position,l=this.size=a.size,s=a.rotate;if(this.onDraw)this.onDraw(e,l,this.element);else{var d=this.style;d.left=e.x+"px",d.top=e.y+"px",null!==this.width&&(d.width=l.x+"px"),null!==this.height&&(d.height=l.y+"px");var i=t.getCssPropertyWithVendorPrefix("transformOrigin"),c=t.getCssPropertyWithVendorPrefix("transform");i&&c&&(s?(d[i]=this._getTransformOrigin(),d[c]="rotate("+s+"deg)"):(d[i]="",d[c]="")),d.position="absolute","none"!==d.display&&(d.display="block")}},_getOverlayPositionAndSize:function(i){var n=i.pixelFromPoint(this.location,!0),o=this._getSizeInPixels(i);this.adjust(n,o);var r=0;if(i.degrees&&this.rotationMode!==t.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var a=new t.Rect(n.x,n.y,o.x,o.y),l=this._getBoundingBox(a,i.degrees);n=l.getTopLeft(),o=l.getSize()}else r=i.degrees;return{position:n,size:o,rotate:r}},_getSizeInPixels:function(i){var n=this.size.x,o=this.size.y;if(null!==this.width||null!==this.height){var r=i.deltaPixelsFromPointsNoRotate(new t.Point(this.width||0,this.height||0),!0);null!==this.width&&(n=r.x),null!==this.height&&(o=r.y)}if(this.checkResize&&(null===this.width||null===this.height)){var e=this.size=t.getElementSize(this.element);null===this.width&&(n=e.x),null===this.height&&(o=e.y)}return new t.Point(n,o)},_getBoundingBox:function(e,t){var i=this._getPlacementPoint(e);return e.rotate(t,i).getBoundingBox()},_getPlacementPoint:function(e){var i=new t.Point(e.x,e.y),n=t.Placement.properties[this.placement];return n&&(n.isHorizontallyCentered?i.x+=e.width/2:n.isRight&&(i.x+=e.width),n.isVerticallyCentered?i.y+=e.height/2:n.isBottom&&(i.y+=e.height)),i},_getTransformOrigin:function(){var e="",i=t.Placement.properties[this.placement];return i?(i.isLeft?e="left":i.isRight&&(e="right"),i.isTop?e+=" top":i.isBottom&&(e+=" bottom"),e):e},update:function(e,i){var n=t.isPlainObject(e)?e:{location:e,placement:i};this._init({location:n.location||this.location,placement:void 0===n.placement?this.placement:n.placement,onDraw:n.onDraw||this.onDraw,checkResize:n.checkResize||this.checkResize,width:void 0===n.width?this.width:n.width,height:void 0===n.height?this.height:n.height,rotationMode:n.rotationMode||this.rotationMode})},getBounds:function(i){t.console.assert(i,"A viewport must now be passed to Overlay.getBounds.");var n=this.width,o=this.height;if(null===n||null===o){var r=i.deltaPointsFromPixelsNoRotate(this.size,!0);null===n&&(n=r.x),null===o&&(o=r.y)}var e=this.location.clone();return this.adjust(e,new t.Point(n,o)),this._adjustBoundsForRotation(i,new t.Rect(e.x,e.y,n,o))},_adjustBoundsForRotation:function(e,i){if(!e||0===e.degrees||this.rotationMode===t.OverlayRotationMode.EXACT)return i;if(this.rotationMode===t.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return i;var n=this._getOverlayPositionAndSize(e);return e.viewerElementToViewportRectangle(new t.Rect(n.position.x,n.position.y,n.size.x,n.size.y))}return i.rotate(-e.degrees,this._getPlacementPoint(i))}}}(OpenSeadragon),!function(t){var i=Math.PI,e=Math.round;t.Drawer=function(e){t.console.assert(e.viewer,"[Drawer] options.viewer is required");var i=arguments;if(t.isPlainObject(e)||(e={source:i[0],viewport:i[1],element:i[2]}),t.console.assert(e.viewport,"[Drawer] options.viewport is required"),t.console.assert(e.element,"[Drawer] options.element is required"),e.source&&t.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=e.viewer,this.viewport=e.viewport,this.debugGridColor=e.debugGridColor||t.DEFAULT_SETTINGS.debugGridColor,e.opacity&&t.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=t.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=t.getElement(e.element),this.canvas=t.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var n=this._calculateCanvasSize();this.canvas.width=n.x,this.canvas.height=n.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",t.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas)},t.Drawer.prototype={addOverlay:function(i,n,o,r){return t.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(i,n,o,r),this},updateOverlay:function(e,i,n){return t.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(e,i,n),this},removeOverlay:function(e){return t.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(e),this},clearOverlays:function(){return t.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},setOpacity:function(e){t.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var i=this.viewer.world,n=0;n<i.getItemCount();n++)i.getItemAt(n).setOpacity(e);return this},getOpacity:function(){t.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var i,e=this.viewer.world,n=0,o=0;o<e.getItemCount();o++)i=e.getItemAt(o).getOpacity(),i>n&&(n=i);return n},needsUpdate:function(){return t.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return t.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return t.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return t.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var e=this._calculateCanvasSize();if((this.canvas.width!=e.x||this.canvas.height!=e.y)&&(this.canvas.width=e.x,this.canvas.height=e.y,null!==this.sketchCanvas)){var t=this._calculateSketchCanvasSize();this.sketchCanvas.width=t.x,this.sketchCanvas.height=t.y}this._clear()}},_clear:function(e,t){if(this.useCanvas){var i=this._getContext(e);if(t)i.clearRect(t.x,t.y,t.width,t.height);else{var n=i.canvas;i.clearRect(0,0,n.width,n.height)}}},viewportToDrawerRectangle:function(e){var i=this.viewport.pixelFromPointNoRotate(e.getTopLeft(),!0),n=this.viewport.deltaPixelsFromPointsNoRotate(e.getSize(),!0);return new t.Rect(i.x*t.pixelDensityRatio,i.y*t.pixelDensityRatio,n.x*t.pixelDensityRatio,n.y*t.pixelDensityRatio)},drawTile:function(i,n,o,r,e){if(t.console.assert(i,"[Drawer.drawTile] tile is required"),t.console.assert(n,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var a=this._getContext(o);r=r||1,i.drawCanvas(a,n,r,e)}else i.drawHTML(this.canvas)},_getContext:function(e){var t=this.context;if(e){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var i=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=i.x,this.sketchCanvas.height=i.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var n=this;this.viewer.addHandler("rotate",function t(){n.viewer.removeHandler("rotate",t);var e=n._calculateSketchCanvasSize();n.sketchCanvas.width=e.x,n.sketchCanvas.height=e.y})}}t=this.sketchContext}return t},saveContext:function(e){this.useCanvas&&this._getContext(e).save()},restoreContext:function(e){this.useCanvas&&this._getContext(e).restore()},setClip:function(e,t){if(this.useCanvas){var i=this._getContext(t);i.beginPath(),i.rect(e.x,e.y,e.width,e.height),i.clip()}},drawRectangle:function(e,t,i){if(this.useCanvas){var n=this._getContext(i);n.save(),n.fillStyle=t,n.fillRect(e.x,e.y,e.width,e.height),n.restore()}},blendSketch:function(n,o,r,a){var s=n;if(t.isPlainObject(s)||(s={opacity:n,scale:o,translate:r,compositeOperation:a}),this.useCanvas&&this.sketchCanvas){n=s.opacity,a=s.compositeOperation;var p=s.bounds;if(this.context.save(),this.context.globalAlpha=n,a&&(this.context.globalCompositeOperation=a),p)this.context.drawImage(this.sketchCanvas,p.x,p.y,p.width,p.height,p.x,p.y,p.width,p.height);else{o=s.scale||1,r=s.translate;var u=r instanceof t.Point?r:new t.Point(0,0),g=0,m=0;if(r){var h=this.sketchCanvas.width-this.canvas.width,v=this.sketchCanvas.height-this.canvas.height;g=e(h/2),m=e(v/2)}this.context.drawImage(this.sketchCanvas,u.x-g*o,u.y-m*o,(this.canvas.width+2*g)*o,(this.canvas.height+2*m)*o,-g,-m,this.canvas.width+2*g,this.canvas.height+2*m)}this.context.restore()}},drawDebugInfo:function(n,o,r){if(this.useCanvas){var a=this.context;a.save(),a.lineWidth=2*t.pixelDensityRatio,a.font="small-caps bold "+13*t.pixelDensityRatio+"px arial",a.strokeStyle=this.debugGridColor,a.fillStyle=this.debugGridColor,0!==this.viewport.degrees&&this._offsetForRotation(this.viewport.degrees),a.strokeRect(n.position.x*t.pixelDensityRatio,n.position.y*t.pixelDensityRatio,n.size.x*t.pixelDensityRatio,n.size.y*t.pixelDensityRatio);var e=(n.position.x+n.size.x/2)*t.pixelDensityRatio,l=(n.position.y+n.size.y/2)*t.pixelDensityRatio;a.translate(e,l),a.rotate(i/180*-this.viewport.degrees),a.translate(-e,-l),0===n.x&&0===n.y&&(a.fillText("Zoom: "+this.viewport.getZoom(),n.position.x*t.pixelDensityRatio,(n.position.y-30)*t.pixelDensityRatio),a.fillText("Pan: "+this.viewport.getBounds().toString(),n.position.x*t.pixelDensityRatio,(n.position.y-20)*t.pixelDensityRatio)),a.fillText("Level: "+n.level,(n.position.x+10)*t.pixelDensityRatio,(n.position.y+20)*t.pixelDensityRatio),a.fillText("Column: "+n.x,(n.position.x+10)*t.pixelDensityRatio,(n.position.y+30)*t.pixelDensityRatio),a.fillText("Row: "+n.y,(n.position.x+10)*t.pixelDensityRatio,(n.position.y+40)*t.pixelDensityRatio),a.fillText("Order: "+r+" of "+o,(n.position.x+10)*t.pixelDensityRatio,(n.position.y+50)*t.pixelDensityRatio),a.fillText("Size: "+n.size.toString(),(n.position.x+10)*t.pixelDensityRatio,(n.position.y+60)*t.pixelDensityRatio),a.fillText("Position: "+n.position.toString(),(n.position.x+10)*t.pixelDensityRatio,(n.position.y+70)*t.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),a.restore()}},debugRect:function(e){if(this.useCanvas){var i=this.context;i.save(),i.lineWidth=2*t.pixelDensityRatio,i.strokeStyle=this.debugGridColor,i.fillStyle=this.debugGridColor,i.strokeRect(e.x*t.pixelDensityRatio,e.y*t.pixelDensityRatio,e.width*t.pixelDensityRatio,e.height*t.pixelDensityRatio),i.restore()}},getCanvasSize:function(e){var i=this._getContext(e).canvas;return new t.Point(i.width,i.height)},_offsetForRotation:function(t,n){var o=this.canvas.width/2,r=this.canvas.height/2,a=this._getContext(n);a.save(),a.translate(o,r),a.rotate(i/180*t),a.translate(-o,-r)},_restoreRotationChanges:function(e){var t=this._getContext(e);t.restore()},_calculateCanvasSize:function(){var e=t.pixelDensityRatio,i=this.viewport.getContainerSize();return{x:i.x*e,y:i.y*e}},_calculateSketchCanvasSize:function(){var e=this._calculateCanvasSize();if(0===this.viewport.getRotation())return e;var t=Math.ceil(Math.sqrt(e.x*e.x+e.y*e.y));return{x:t,y:t}}}}(OpenSeadragon),!function(t){var e=Math.max;t.Viewport=function(e){var i=arguments;i.length&&i[0]instanceof t.Point&&(e={containerSize:i[0],contentSize:i[1],config:i[2]}),e.config&&(t.extend(!0,e,e.config),delete e.config),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e.margins||{}),delete e.margins,t.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:t.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:t.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:t.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:t.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:t.DEFAULT_SETTINGS.maxZoomLevel,degrees:t.DEFAULT_SETTINGS.degrees,homeFillsViewer:t.DEFAULT_SETTINGS.homeFillsViewer},e),this._updateContainerInnerSize(),this.centerSpringX=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new t.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new t.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new t.Rect(0,0,1,1),1),this.goHome(!0),this.update()},t.Viewport.prototype={resetContentSize:function(e){return t.console.assert(e,"[Viewport.resetContentSize] contentSize is required"),t.console.assert(e instanceof t.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),t.console.assert(0<e.x,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),t.console.assert(0<e.y,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new t.Rect(0,0,1,e.y/e.x),e.x),this},setHomeBounds:function(e,i){t.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(e,i)},_setContentBounds:function(e,i){t.console.assert(e,"[Viewport._setContentBounds] bounds is required"),t.console.assert(e instanceof t.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),t.console.assert(0<e.width,"[Viewport._setContentBounds] bounds.width must be greater than 0"),t.console.assert(0<e.height,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=e.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(i),this._contentBounds=e.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(i),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:i,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var e,t=this._contentAspectRatio/this.getAspectRatio();return e=this.homeFillsViewer?1<=t?t:1:1<=t?1:t,e/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var e=this._contentBounds.getCenter(),i=1/this.getHomeZoom(),n=i/this.getAspectRatio();return new t.Rect(e.x-i/2,e.y-n/2,i,n)},goHome:function(e){return this.viewer&&this.viewer.raiseEvent("home",{immediately:e}),this.fitBounds(this.getHomeBounds(),e)},getMinZoom:function(){var e=this.getHomeZoom(),t=this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*e;return t},getMaxZoom:function(){var t=this.maxZoomLevel;return t||(t=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,t/=this._contentBounds.width),e(t,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new t.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return t.extend({},this._margins)},setMargins:function(e){t.console.assert("object"===t.type(e),"[Viewport.setMargins] margins must be an object"),this._margins=t.extend({left:0,top:0,right:0,bottom:0},e),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(e){return this.getBoundsNoRotate(e).rotate(-this.getRotation())},getBoundsNoRotate:function(i){var n=this.getCenter(i),o=1/this.getZoom(i),r=o/this.getAspectRatio();return new t.Rect(n.x-o/2,n.y-r/2,o,r)},getBoundsWithMargins:function(e){return this.getBoundsNoRotateWithMargins(e).rotate(-this.getRotation(),this.getCenter(e))},getBoundsNoRotateWithMargins:function(e){var t=this.getBoundsNoRotate(e),i=this._containerInnerSize.x*this.getZoom(e);return t.x-=this._margins.left/i,t.y-=this._margins.top/i,t.width+=(this._margins.left+this._margins.right)/i,t.height+=(this._margins.top+this._margins.bottom)/i,t},getCenter:function(n){var o,r,a,e,s,d,c,i,p=new t.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),u=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return n?p:this.zoomPoint?(o=this.pixelFromPoint(this.zoomPoint,!0),r=this.getZoom(),a=1/r,e=a/this.getAspectRatio(),s=new t.Rect(p.x-a/2,p.y-e/2,a,e),d=this._pixelFromPoint(this.zoomPoint,s),c=d.minus(o),i=c.divide(this._containerInnerSize.x*r),u.plus(i)):u},getZoom:function(e){return e?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(t){return e(Math.min(t,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(o,r){var a=new t.Rect(o.x,o.y,o.width,o.height);if(this.wrapHorizontal);else{var s=this.visibilityRatio*a.width,e=a.x+a.width,d=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,p=this._contentBoundsNoRotate.x-e+s,u=d-a.x-s;s>this._contentBoundsNoRotate.width?a.x+=(p+u)/2:0>u?a.x+=u:0<p&&(a.x+=p)}if(this.wrapVertical);else{var i=this.visibilityRatio*a.height,g=a.y+a.height,h=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,l=this._contentBoundsNoRotate.y-g+i,m=h-a.y-i;i>this._contentBoundsNoRotate.height?a.y+=(l+m)/2:0>m?a.y+=m:0<l&&(a.y+=l)}return this.viewer&&this.viewer.raiseEvent("constrain",{immediately:r}),a},applyConstraints:function(t){var i=this.getZoom(),n=this._applyZoomConstraints(i);i!==n&&this.zoomTo(n,this.zoomPoint,t);var o=this.getBoundsNoRotate(),r=this._applyBoundaryConstraints(o,t);return(o.x!==r.x||o.y!==r.y||t)&&this.fitBounds(r.rotate(-this.getRotation()),t),this},ensureVisible:function(e){return this.applyConstraints(e)},_fitBounds:function(o,r){r=r||{};var a=r.immediately||!1,s=r.constraints||!1,e=this.getAspectRatio(),d=o.getCenter(),c=new t.Rect(o.x,o.y,o.width,o.height,o.degrees+this.getRotation()).getBoundingBox();c.getAspectRatio()>=e?c.height=c.width/e:c.width=c.height*e,c.x=d.x-c.width/2,c.y=d.y-c.height/2;var p=1/c.width;if(s){var i=c.getAspectRatio(),u=this._applyZoomConstraints(p);p!==u&&(p=u,c.width=1/p,c.x=d.x-c.width/2,c.height=c.width/i,c.y=d.y-c.height/2),c=this._applyBoundaryConstraints(c,a),d=c.getCenter()}if(a)return this.panTo(d,!0),this.zoomTo(p,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var g=this.getBounds(),l=this.getZoom();if(0===l||1e-8>Math.abs(p/l-1))return this.zoomTo(p,!0),this.panTo(d,a);c=c.rotate(-this.getRotation());var m=c.getTopLeft().times(p).minus(g.getTopLeft().times(l)).divide(p-l);return this.zoomTo(p,m,a)},fitBounds:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!1})},fitBoundsWithConstraints:function(e,t){return this._fitBounds(e,{immediately:t,constraints:!0})},fitVertically:function(e){var i=new t.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(i,e)},fitHorizontally:function(e){var i=new t.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(i,e)},panBy:function(e,i){var n=new t.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(n.plus(e),i)},panTo:function(e,t){return t?(this.centerSpringX.resetTo(e.x),this.centerSpringY.resetTo(e.y)):(this.centerSpringX.springTo(e.x),this.centerSpringY.springTo(e.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:e,immediately:t}),this},zoomBy:function(e,t,i){return this.zoomTo(this.zoomSpring.target.value*e,t,i)},zoomTo:function(e,i,n){return this.zoomPoint=!(i instanceof t.Point)||isNaN(i.x)||isNaN(i.y)?null:i,n?this.zoomSpring.resetTo(e):this.zoomSpring.springTo(e),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:e,refPoint:i,immediately:n}),this},setRotation:function(e){return this.viewer&&this.viewer.drawer.canRotate()?(e%=360,0>e&&(e+=360),this.degrees=e,this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:e}),this):this},getRotation:function(){return this.degrees},resize:function(t,i){var n,o=this.getBoundsNoRotate(),r=o;return this.containerSize.x=t.x,this.containerSize.y=t.y,this._updateContainerInnerSize(),i&&(n=t.x/this.containerSize.x,r.width=o.width*n,r.height=r.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:t,maintain:i}),this.fitBounds(r,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new t.Point(e(1,this.containerSize.x-(this._margins.left+this._margins.right)),e(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){if(this.zoomPoint){var t=this.pixelFromPoint(this.zoomPoint,!0);this.zoomSpring.update();var i=this.pixelFromPoint(this.zoomPoint,!0),n=i.minus(t),o=this.deltaPointsFromPixels(n,!0);this.centerSpringX.shiftBy(o.x),this.centerSpringY.shiftBy(o.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else this.zoomSpring.update();this.centerSpringX.update(),this.centerSpringY.update();var r=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,r},deltaPixelsFromPointsNoRotate:function(e,t){return e.times(this._containerInnerSize.x*this.getZoom(t))},deltaPixelsFromPoints:function(e,t){return this.deltaPixelsFromPointsNoRotate(e.rotate(this.getRotation()),t)},deltaPointsFromPixelsNoRotate:function(e,t){return e.divide(this._containerInnerSize.x*this.getZoom(t))},deltaPointsFromPixels:function(e,t){return this.deltaPointsFromPixelsNoRotate(e,t).rotate(-this.getRotation())},pixelFromPointNoRotate:function(e,t){return this._pixelFromPointNoRotate(e,this.getBoundsNoRotate(t))},pixelFromPoint:function(e,t){return this._pixelFromPoint(e,this.getBoundsNoRotate(t))},_pixelFromPointNoRotate:function(e,i){return e.minus(i.getTopLeft()).times(this._containerInnerSize.x/i.width).plus(new t.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(e,t){return this._pixelFromPointNoRotate(e.rotate(this.getRotation(),this.getCenter(!0)),t)},pointFromPixelNoRotate:function(e,i){var n=this.getBoundsNoRotate(i);return e.minus(new t.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/n.width).plus(n.getTopLeft())},pointFromPixel:function(e,t){return this.pointFromPixelNoRotate(e,t).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e*this._contentSizeNoRotate.x/n,i*this._contentSizeNoRotate.x/n)},viewportToImageCoordinates:function(i,n){if(i instanceof t.Point)return this.viewportToImageCoordinates(i.x,i.y);if(this.viewer){var o=this.viewer.world.getItemCount();if(1<o)t.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===o){var r=this.viewer.world.getItemAt(0);return r.viewportToImageCoordinates(i,n,!0)}}return this._viewportToImageDelta(i-this._contentBoundsNoRotate.x,n-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(e,i){var n=this._contentBoundsNoRotate.width;return new t.Point(e/this._contentSizeNoRotate.x*n,i/this._contentSizeNoRotate.x*n)},imageToViewportCoordinates:function(i,n){if(i instanceof t.Point)return this.imageToViewportCoordinates(i.x,i.y);if(this.viewer){var o=this.viewer.world.getItemCount();if(1<o)t.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===o){var r=this.viewer.world.getItemAt(0);return r.imageToViewportCoordinates(i,n,!0)}}var e=this._imageToViewportDelta(i,n);return e.x+=this._contentBoundsNoRotate.x,e.y+=this._contentBoundsNoRotate.y,e},imageToViewportRectangle:function(n,o,r,a){var e=n;if(e instanceof t.Rect||(e=new t.Rect(n,o,r,a)),this.viewer){var l=this.viewer.world.getItemCount();if(1<l)t.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===l){var s=this.viewer.world.getItemAt(0);return s.imageToViewportRectangle(n,o,r,a,!0)}}var d=this.imageToViewportCoordinates(e.x,e.y),i=this._imageToViewportDelta(e.width,e.height);return new t.Rect(d.x,d.y,i.x,i.y,e.degrees)},viewportToImageRectangle:function(n,o,r,a){var e=n;if(e instanceof t.Rect||(e=new t.Rect(n,o,r,a)),this.viewer){var l=this.viewer.world.getItemCount();if(1<l)t.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===l){var s=this.viewer.world.getItemAt(0);return s.viewportToImageRectangle(n,o,r,a,!0)}}var d=this.viewportToImageCoordinates(e.x,e.y),i=this._viewportToImageDelta(e.width,e.height);return new t.Rect(d.x,d.y,i.x,i.y,e.degrees)},viewerElementToImageCoordinates:function(e){var t=this.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var i=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(i)},imageToWindowCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer.");var i=this.imageToViewerElementCoordinates(e);return i.plus(t.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(e){return this.pointFromPixel(e,!0)},viewportToViewerElementCoordinates:function(e){return this.pixelFromPoint(e,!0)},viewerElementToViewportRectangle:function(e){return t.Rect.fromSummits(this.pointFromPixel(e.getTopLeft(),!0),this.pointFromPixel(e.getTopRight(),!0),this.pointFromPixel(e.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(e){return t.Rect.fromSummits(this.pixelFromPoint(e.getTopLeft(),!0),this.pixelFromPoint(e.getTopRight(),!0),this.pixelFromPoint(e.getBottomLeft(),!0))},windowToViewportCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var i=e.minus(t.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(i)},viewportToWindowCoordinates:function(e){t.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer.");var i=this.viewportToViewerElementCoordinates(e);return i.plus(t.getElementPosition(this.viewer.element))},viewportToImageZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(1<n)t.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===n){var o=this.viewer.world.getItemAt(0);return o.viewportToImageZoom(i)}}var r=this._contentSizeNoRotate.x,e=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width;return i*(e/r*a)},imageToViewportZoom:function(i){if(this.viewer){var n=this.viewer.world.getItemCount();if(1<n)t.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===n){var o=this.viewer.world.getItemAt(0);return o.imageToViewportZoom(i)}}var r=this._contentSizeNoRotate.x,e=this._containerInnerSize.x,a=this._contentBoundsNoRotate.width;return i*(r/e/a)}}}(OpenSeadragon),!function(t){function r(T){T._needsDraw=!1;for(var E,P,e,g,h,i,R,l,m=null,_=!1,C=t.now(),I=T.viewport.getBoundsWithMargins(!0),r=T.viewport.deltaPixelsFromPointsNoRotate(T.source.getPixelRatio(0),!0).x*T._scaleSpring.current.value,s=p(T.source.minLevel,o(n(T.minZoomImageRatio)/0.6931471805599453)),k=S(f(T.source.maxLevel),f(o(n(r/T.minPixelRatio)/0.6931471805599453)));0<T.lastDrawn.length;)E=T.lastDrawn.pop(),E.beingDrawn=!1;if(!T.wrapHorizontal&&!T.wrapVertical){var u=T.getClippedBounds(!0),O=I.intersection(u);if(null===O)return;I=O}I=I.getBoundingBox(),I.x-=T._xSpring.current.value,I.y-=T._ySpring.current.value;var w=I.getTopLeft(),x=I.getBottomRight();if((T.wrapHorizontal||!(0>x.x||w.x>T._worldWidthCurrent))&&(T.wrapVertical||!(0>x.y||w.y>T._worldHeightCurrent))){T.wrapHorizontal||(w.x=p(w.x,0),x.x=S(x.x,T._worldWidthCurrent)),T.wrapVertical||(w.y=p(w.y,0),x.y=S(x.y,T._worldHeightCurrent)),s=S(s,k);var y;for(P=k;P>=s;P--){if(y=!1,e=T.viewport.deltaPixelsFromPointsNoRotate(T.source.getPixelRatio(P),!0).x*T._scaleSpring.current.value,!_&&e>=T.minPixelRatio||P==s)y=!0,_=!0;else if(!_)continue;if(g=T.viewport.deltaPixelsFromPointsNoRotate(T.source.getPixelRatio(P),!1).x*T._scaleSpring.current.value,h=T.viewport.deltaPixelsFromPointsNoRotate(T.source.getPixelRatio(p(T.source.getClosestLevel(T.viewport.containerSize)-1,0)),!1).x*T._scaleSpring.current.value,i=T.immediateRender?1:h,R=S(1,(e-.5)/.5),l=i/f(i-g),m=a(T,_,y,P,R,l,w,x,C,m),v(T.coverage,P))break}c(T,T.lastDrawn),m&&!m.context2D&&d(T,m,C)}}function a(t,n,d,u,v,y,T,x,E,P){var R,l,m,o,p,_=t.viewport.pixelFromPoint(t.viewport.getCenter());for(t.viewer&&t.viewer.raiseEvent("update-level",{tiledImage:t,havedrawn:n,level:u,opacity:v,visibility:y,topleft:T,bottomright:x,currenttime:E,best:P}),m=t.source.getTileAtPoint(u,T.divide(t._scaleSpring.current.value)),o=t.source.getTileAtPoint(u,x.divide(t._scaleSpring.current.value)),p=t.source.getNumTiles(u),w(t.coverage,u),t.wrapHorizontal||(o.x=S(o.x,p.x-1)),t.wrapVertical||(o.y=S(o.y,p.y-1)),R=m.x;R<=o.x;R++)for(l=m.y;l<=o.y;l++)P=s(t,d,n,R,l,u,v,y,_,p,E,P);return P}function s(o,S,E,c,P,f,g,R,n,p,_,r){var s=y(c,P,f,o.source,o.tilesMatrix,_,p,o._worldWidthCurrent,o._worldHeightCurrent),b=S;if(o.viewer&&o.viewer.raiseEvent("update-tile",{tiledImage:o,tile:s}),l(o.coverage,f,c,P,!1),!s.exists)return r;if(E&&!b&&(h(o.coverage,f,c,P)?l(o.coverage,f,c,P,!0):b=!0),!b)return r;if(e(s,o.source.tileOverlap,o.viewport,n,R,o),!s.loaded)if(s.context2D)T(o,s);else{var C=o._tileCache.getImageRecord(s.url);if(C){var v=C.getImage();T(o,s,v)}}if(s.loaded){var w=i(o,s,c,P,f,g,_);w&&(o._needsDraw=!0)}else s.loading||(r=m(r,s));return r}function y(r,a,s,d,c,u,g,h,i){var v,y,l,m,n,o,p;return c[s]||(c[s]={}),c[s][r]||(c[s][r]={}),c[s][r][a]||(v=(g.x+r%g.x)%g.x,y=(g.y+a%g.y)%g.y,l=d.getTileBounds(s,v,y),m=d.tileExists(s,v,y),n=d.getTileUrl(s,v,y),o=d.getContext2D?d.getContext2D(s,v,y):void 0,l.x+=(r-v)/g.x,l.y+=i/h*((a-y)/g.y),c[s][r][a]=new t.Tile(s,r,a,l,m,n,o)),p=c[s][r][a],p.lastTouchTime=u,p}function d(t,i,n){i.loading=!0,t._imageLoader.addJob({src:i.url,crossOriginPolicy:t.crossOriginPolicy,callback:function(o,r){u(t,i,n,o,r)},abort:function(){i.loading=!1}})}function u(i,o,r,l,a){if(!l)t.console.log("Tile %s failed to load: %s - error: %s",o,o.url,a),i.viewer.raiseEvent("tile-load-failed",{tile:o,tiledImage:i,time:r,message:a}),o.loading=!1,o.exists=!1;else if(r<i.lastResetTime)t.console.log("Ignoring tile %s loaded before reset: %s",o,o.url),o.loading=!1;else{var s=function(){var e=Math.ceil(n(i.source.getTileWidth(o.level))/0.6931471805599453);T(i,o,l,e)};i._midDraw?window.setTimeout(s,1):s()}}function T(t,i,n,o){function r(){return s++,l}function l(){s--,0===s&&(i.loading=!1,i.loaded=!0,i.context2D||t._tileCache.cacheTile({image:n,tile:i,cutoff:o,tiledImage:t}),t._needsDraw=!0)}var s=0;t.viewer.raiseEvent("tile-loaded",{tile:i,tiledImage:t,image:n,getCompletionCallback:r}),r()()}function e(r,a,s,d,e,c){var p=r.bounds.getTopLeft();p.x*=c._scaleSpring.current.value,p.y*=c._scaleSpring.current.value,p.x+=c._xSpring.current.value,p.y+=c._ySpring.current.value;var u=r.bounds.getSize();u.x*=c._scaleSpring.current.value,u.y*=c._scaleSpring.current.value;var g=s.pixelFromPointNoRotate(p,!0),h=s.pixelFromPointNoRotate(p,!1),v=s.deltaPixelsFromPointsNoRotate(u,!0),l=s.deltaPixelsFromPointsNoRotate(u,!1),m=h.plus(l.divide(2)),n=d.distanceTo(m);a||(v=v.plus(new t.Point(1,1))),r.position=g,r.size=v,r.distance=n,r.visibility=e}function i(t,n,o,r,a,e,s){var d,c,i=1e3*t.blendTime;if(n.blendStart||(n.blendStart=s),d=s-n.blendStart,c=i?S(1,d/i):1,t.alwaysBlend&&(c*=e),n.opacity=c,t.lastDrawn.push(n),1==c)l(t.coverage,a,o,r,!0),t._hasOpaqueTile=!0;else if(i>d)return!0;return!1}function v(t,i,n,o){var r,e,a,l;if(!t[i])return!1;if(void 0===n||void 0===o){for(a in r=t[i],r)if(r.hasOwnProperty(a))for(l in e=r[a],e)if(e.hasOwnProperty(l)&&!e[l])return!1;return!0}return void 0===t[i][n]||void 0===t[i][n][o]||!0===t[i][n][o]}function h(e,t,i,n){return void 0===i||void 0===n?v(e,t+1):v(e,t+1,2*i,2*n)&&v(e,t+1,2*i,2*n+1)&&v(e,t+1,2*i+1,2*n)&&v(e,t+1,2*i+1,2*n+1)}function l(i,n,o,r,e){i[n]?(i[n][o]||(i[n][o]={}),i[n][o][r]=e):t.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",n)}function w(e,t){e[t]={}}function m(e,t){return e?t.visibility>e.visibility?t:t.visibility==e.visibility&&t.distance<e.distance?t:e:t}function c(a,s){if(0!==s.length){var c,u,v=s[0],y=1>a.opacity||a.compositeOperation&&"source-over"!==a.compositeOperation||!a._isBottomItem()&&v._hasTransparencyChannel(),e=a.viewport.getZoom(!0),h=a.viewportToImageZoom(e);h>a.smoothTileEdgesMinZoom&&!a.iOSDevice&&(y=!0,c=v.getScaleForEdgeSmoothing(),u=v.getTranslationForEdgeSmoothing(c,a._drawer.getCanvasSize(!1),a._drawer.getCanvasSize(!0)));var i;y&&(c||(i=a.viewport.viewportToViewerElementRectangle(a.getClippedBounds(!0)).getIntegerBoundingBox().times(t.pixelDensityRatio)),a._drawer._clear(!0,i)),0===a.viewport.degrees||c||a._drawer._offsetForRotation(a.viewport.degrees,y);var T=!1;if(a._clip){a._drawer.saveContext(y);var w=a.imageToViewportRectangle(a._clip,!0),l=a._drawer.viewportToDrawerRectangle(w);c&&(l=l.times(c)),u&&(l=l.translate(u)),a._drawer.setClip(l,y),T=!0}if(a.placeholderFillStyle&&!1===a._hasOpaqueTile){var m=a._drawer.viewportToDrawerRectangle(a.getBounds(!0));c&&(m=m.times(c)),u&&(m=m.translate(u));var n=null;n="function"==typeof a.placeholderFillStyle?a.placeholderFillStyle(a,a._drawer.context):a.placeholderFillStyle,a._drawer.drawRectangle(m,n,y)}for(var o=s.length-1;0<=o;o--)v=s[o],a._drawer.drawTile(v,a._drawingHandler,y,c,u),v.beingDrawn=!0,a.viewer&&a.viewer.raiseEvent("tile-drawn",{tiledImage:a,tile:v});if(T&&a._drawer.restoreContext(y),0===a.viewport.degrees||c||a._drawer._restoreRotationChanges(y),y){var S=0!==a.viewport.degrees&&c;S&&a._drawer._offsetForRotation(a.viewport.degrees,!1),a._drawer.blendSketch({opacity:a.opacity,scale:c,translate:u,compositeOperation:a.compositeOperation,bounds:i}),S&&a._drawer._restoreRotationChanges(!1)}x(a,s)}}function x(i,n){if(i.debugMode)for(var o,e=n.length-1;0<=e;e--){o=n[e];try{i._drawer.drawDebugInfo(o,n.length,e)}catch(e){t.console.error(e)}}}var n=Math.log,p=Math.max,S=Math.min,o=Math.floor,f=Math.abs;t.TiledImage=function(i){var n=this;t.console.assert(i.tileCache,"[TiledImage] options.tileCache is required"),t.console.assert(i.drawer,"[TiledImage] options.drawer is required"),t.console.assert(i.viewer,"[TiledImage] options.viewer is required"),t.console.assert(i.imageLoader,"[TiledImage] options.imageLoader is required"),t.console.assert(i.source,"[TiledImage] options.source is required"),t.console.assert(!i.clip||i.clip instanceof t.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),t.EventSource.call(this),this._tileCache=i.tileCache,delete i.tileCache,this._drawer=i.drawer,delete i.drawer,this._imageLoader=i.imageLoader,delete i.imageLoader,i.clip instanceof t.Rect&&(this._clip=i.clip.clone()),delete i.clip;var o=i.x||0;delete i.x;var r=i.y||0;delete i.y,this.normHeight=i.source.dimensions.y/i.source.dimensions.x,this.contentAspectX=i.source.dimensions.x/i.source.dimensions.y;var a=1;i.width?(a=i.width,delete i.width,i.height&&(t.console.error("specifying both width and height to a tiledImage is not supported"),delete i.height)):i.height&&(a=i.height/this.normHeight,delete i.height);var l=i.fitBounds;delete i.fitBounds;var s=i.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete i.fitBoundsPlacement,t.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,springStiffness:t.DEFAULT_SETTINGS.springStiffness,animationTime:t.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:t.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:t.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:t.DEFAULT_SETTINGS.wrapVertical,immediateRender:t.DEFAULT_SETTINGS.immediateRender,blendTime:t.DEFAULT_SETTINGS.blendTime,alwaysBlend:t.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:t.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:t.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:t.DEFAULT_SETTINGS.iOSDevice,debugMode:t.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:t.DEFAULT_SETTINGS.crossOriginPolicy,placeholderFillStyle:t.DEFAULT_SETTINGS.placeholderFillStyle,opacity:t.DEFAULT_SETTINGS.opacity,compositeOperation:t.DEFAULT_SETTINGS.compositeOperation},i),this._xSpring=new t.Spring({initial:o,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new t.Spring({initial:r,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new t.Spring({initial:a,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),l&&this.fitBounds(l,s,!0),this._drawingHandler=function(e){n.viewer.raiseEvent("tile-drawing",t.extend({tiledImage:n},e))}},t.extend(t.TiledImage.prototype,t.EventSource.prototype,{needsDraw:function(){return this._needsDraw},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=t.now(),this._needsDraw=!0},update:function(){var e=this._xSpring.current.value,t=this._ySpring.current.value,i=this._scaleSpring.current.value;return this._xSpring.update(),this._ySpring.update(),this._scaleSpring.update(),(this._xSpring.current.value!==e||this._ySpring.current.value!==t||this._scaleSpring.current.value!==i)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity&&(this._midDraw=!0,r(this),this._midDraw=!1)},destroy:function(){this.reset()},getBounds:function(e){return e?new t.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new t.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return t.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(i){var n=this.getBounds(i);if(this._clip){var o=this._worldWidthCurrent/this.source.dimensions.x,r=this._clip.times(o);n=new t.Rect(n.x+r.x,n.y+r.y,r.width,r.height)}return n},getContentSize:function(){return new t.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(i,n,o){var r=o?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(i*(this.source.dimensions.x/r),n*(this.source.dimensions.y*this.contentAspectX/r))},viewportToImageCoordinates:function(e,i,n){return e instanceof t.Point&&(n=i,i=e.y,e=e.x),n?this._viewportToImageDelta(e-this._xSpring.current.value,i-this._ySpring.current.value):this._viewportToImageDelta(e-this._xSpring.target.value,i-this._ySpring.target.value)},_imageToViewportDelta:function(i,n,o){var r=o?this._scaleSpring.current.value:this._scaleSpring.target.value;return new t.Point(i/this.source.dimensions.x*r,n/this.source.dimensions.y/this.contentAspectX*r)},imageToViewportCoordinates:function(i,n,o){i instanceof t.Point&&(o=n,n=i.y,i=i.x);var r=this._imageToViewportDelta(i,n);return o?(r.x+=this._xSpring.current.value,r.y+=this._ySpring.current.value):(r.x+=this._xSpring.target.value,r.y+=this._ySpring.target.value),r},imageToViewportRectangle:function(n,o,r,a,e){var l=n;l instanceof t.Rect?e=o:l=new t.Rect(n,o,r,a);var s=this.imageToViewportCoordinates(l.getTopLeft(),e),d=this._imageToViewportDelta(l.width,l.height,e);return new t.Rect(s.x,s.y,d.x,d.y,l.degrees)},viewportToImageRectangle:function(n,o,r,a,e){var l=n;n instanceof t.Rect?e=o:l=new t.Rect(n,o,r,a);var s=this.viewportToImageCoordinates(l.getTopLeft(),e),d=this._viewportToImageDelta(l.width,l.height,e);return new t.Rect(s.x,s.y,d.x,d.y,l.degrees)},viewerElementToImageCoordinates:function(e){var t=this.viewport.pointFromPixel(e,!0);return this.viewportToImageCoordinates(t)},imageToViewerElementCoordinates:function(e){var t=this.imageToViewportCoordinates(e);return this.viewport.pixelFromPoint(t,!0)},windowToImageCoordinates:function(e){var t=e.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(t)},imageToWindowCoordinates:function(e){var t=this.imageToViewerElementCoordinates(e);return t.plus(OpenSeadragon.getElementPosition(this.viewer.element))},viewportToImageZoom:function(e){var t=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return t*e},imageToViewportZoom:function(e){var t=this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x;return e/t},setPosition:function(e,t){var i=this._xSpring.target.value===e.x&&this._ySpring.target.value===e.y;if(t){if(i&&this._xSpring.current.value===e.x&&this._ySpring.current.value===e.y)return;this._xSpring.resetTo(e.x),this._ySpring.resetTo(e.y),this._needsDraw=!0}else{if(i)return;this._xSpring.springTo(e.x),this._ySpring.springTo(e.y),this._needsDraw=!0}i||this._raiseBoundsChange()},setWidth:function(e,t){this._setScale(e,t)},setHeight:function(e,t){this._setScale(e/this.normHeight,t)},fitBounds:function(o,r,a){r=r||t.Placement.CENTER;var s=t.Placement.properties[r],e=this.contentAspectX,d=0,c=0,p=1,i=1;if(this._clip&&(e=this._clip.getAspectRatio(),p=this._clip.width/this.source.dimensions.x,i=this._clip.height/this.source.dimensions.y,o.getAspectRatio()>e?(d=this._clip.x/this._clip.height*o.height,c=this._clip.y/this._clip.height*o.height):(d=this._clip.x/this._clip.width*o.width,c=this._clip.y/this._clip.width*o.width)),o.getAspectRatio()>e){var u=o.height/i,g=0;s.isHorizontallyCentered?g=(o.width-o.height*e)/2:s.isRight&&(g=o.width-o.height*e),this.setPosition(new t.Point(o.x-d+g,o.y-c),a),this.setHeight(u,a)}else{var l=o.width/p,m=0;s.isVerticallyCentered?m=(o.height-o.width/e)/2:s.isBottom&&(m=o.height-o.width/e),this.setPosition(new t.Point(o.x-d,o.y-c+m),a),this.setWidth(l,a)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(e){t.console.assert(!e||e instanceof t.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),this._clip=e instanceof t.Rect?e.clone():null,this._needsDraw=!0},getOpacity:function(){return this.opacity},setOpacity:function(e){this.opacity=e,this._needsDraw=!0},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(e){this.compositeOperation=e,this._needsDraw=!0},_setScale:function(e,t){var i=this._scaleSpring.target.value===e;if(t){if(i&&this._scaleSpring.current.value===e)return;this._scaleSpring.resetTo(e),this._updateForScale(),this._needsDraw=!0}else{if(i)return;this._scaleSpring.springTo(e),this._updateForScale(),this._needsDraw=!0}i||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this}})}(OpenSeadragon),!function(t){var r=function(e){t.console.assert(e,"[TileCache.cacheTile] options is required"),t.console.assert(e.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(e.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=e.tile,this.tiledImage=e.tiledImage},a=function(e){t.console.assert(e,"[ImageRecord] options is required"),t.console.assert(e.image,"[ImageRecord] options.image is required"),this._image=e.image,this._tiles=[]};a.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var e=document.createElement("canvas");e.width=this._image.width,e.height=this._image.height,this._renderedContext=e.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(e){t.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=e},addTile:function(e){t.console.assert(e,"[ImageRecord.addTile] tile is required"),this._tiles.push(e)},removeTile:function(e){for(var i=0;i<this._tiles.length;i++)if(this._tiles[i]===e)return void this._tiles.splice(i,1);t.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",e)},getTileCount:function(){return this._tiles.length}},t.TileCache=function(e){e=e||{},this._maxImageCacheCount=e.maxImageCacheCount||t.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},t.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(s){t.console.assert(s,"[TileCache.cacheTile] options is required"),t.console.assert(s.tile,"[TileCache.cacheTile] options.tile is required"),t.console.assert(s.tile.url,"[TileCache.cacheTile] options.tile.url is required"),t.console.assert(s.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var d=s.cutoff||0,e=this._tilesLoaded.length,c=this._imagesLoaded[s.tile.url];if(c||(t.console.assert(s.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),c=this._imagesLoaded[s.tile.url]=new a({image:s.image}),this._imagesLoadedCount++),c.addTile(s.tile),s.tile.cacheImageRecord=c,this._imagesLoadedCount>this._maxImageCacheCount){for(var u,g,l,m,n,o,p=null,h=-1,i=null,v=this._tilesLoaded.length-1;0<=v;v--)o=this._tilesLoaded[v],u=o.tile,u.level<=d||u.beingDrawn||(p?(m=u.lastTouchTime,g=p.lastTouchTime,n=u.level,l=p.level,(g>m||m==g&&n>l)&&(p=u,h=v,i=o)):(p=u,h=v,i=o));p&&0<=h&&(this._unloadTile(i),e=h)}this._tilesLoaded[e]=new r({tile:s.tile,tiledImage:s.tiledImage})},clearTilesFor:function(e){t.console.assert(e,"[TileCache.clearTilesFor] tiledImage is required");for(var i,n=0;n<this._tilesLoaded.length;++n)i=this._tilesLoaded[n],i.tiledImage===e&&(this._unloadTile(i),this._tilesLoaded.splice(n,1),n--)},getImageRecord:function(e){return t.console.assert(e,"[TileCache.getImageRecord] url is required"),this._imagesLoaded[e]},_unloadTile:function(i){t.console.assert(i,"[TileCache._unloadTile] tileRecord is required");var n=i.tile,o=i.tiledImage;n.unload(),n.cacheImageRecord=null;var r=this._imagesLoaded[n.url];r.removeTile(n),r.getTileCount()||(r.destroy(),delete this._imagesLoaded[n.url],this._imagesLoadedCount--),o.viewer.raiseEvent("tile-unloaded",{tile:n,tiledImage:o})}}}(OpenSeadragon),!function(t){var n=Math.max,o=Math.min;t.World=function(e){var i=this;t.console.assert(e.viewer,"[World] options.viewer is required"),t.EventSource.call(this),this.viewer=e.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(){i._autoRefigureSizes?i._figureSizes():i._needsSizesFigured=!0},this._figureSizes()},t.extend(t.World.prototype,t.EventSource.prototype,{addItem:function(e,i){if(t.console.assert(e,"[World.addItem] item is required"),t.console.assert(e instanceof t.TiledImage,"[World.addItem] only TiledImages supported at this time"),i=i||{},void 0!==i.index){var r=n(0,o(this._items.length,i.index));this._items.splice(r,0,e)}else this._items.push(e);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,e.addHandler("bounds-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:e})},getItemAt:function(e){return t.console.assert(void 0!==e,"[World.getItemAt] index is required"),this._items[e]},getIndexOfItem:function(e){return t.console.assert(e,"[World.getIndexOfItem] item is required"),t.indexOf(this._items,e)},getItemCount:function(){return this._items.length},setItemIndex:function(e,i){t.console.assert(e,"[World.setItemIndex] item is required"),t.console.assert(void 0!==i,"[World.setItemIndex] index is required");var n=this.getIndexOfItem(e);if(i>=this._items.length)throw new Error("Index bigger than number of layers.");i!==n&&-1!==n&&(this._items.splice(n,1),this._items.splice(i,0,e),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:e,previousIndex:n,newIndex:i}))},removeItem:function(e){t.console.assert(e,"[World.removeItem] item is required");var i=t.indexOf(this._items,e);-1!==i&&(e.removeHandler("bounds-change",this._delegatedFigureSizes),e.destroy(),this._items.splice(i,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(e))},removeAll:function(){this.viewer._cancelPendingImages();for(var e,t=0;t<this._items.length;t++)e=this._items[t],e.removeHandler("bounds-change",this._delegatedFigureSizes),e.destroy();var i=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,t=0;t<i.length;t++)e=i[t],this._raiseRemoveItem(e)},resetItems:function(){for(var e=0;e<this._items.length;e++)this._items[e].reset()},update:function(){for(var e=!1,t=0;t<this._items.length;t++)e=this._items[t].update()||e;return e},draw:function(){for(var e=0;e<this._items.length;e++)this._items[e].draw();this._needsDraw=!1},needsDraw:function(){for(var e=0;e<this._items.length;e++)if(this._items[e].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(e){this._autoRefigureSizes=e,e&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(a){a=a||{};var s,u=a.immediately||!1,c=a.layout||t.DEFAULT_SETTINGS.collectionLayout,d=a.rows||t.DEFAULT_SETTINGS.collectionRows,e=a.columns||t.DEFAULT_SETTINGS.collectionColumns,v=a.tileSize||t.DEFAULT_SETTINGS.collectionTileSize,g=a.tileMargin||t.DEFAULT_SETTINGS.collectionTileMargin,h=v+g;s=!a.rows&&e?e:Math.ceil(this._items.length/d);var i,m,n,o,p,y=0,T=0;this.setAutoRefigureSizes(!1);for(var l=0;l<this._items.length;l++)l&&0===l%s&&("horizontal"===c?(T+=h,y=0):(y+=h,T=0)),i=this._items[l],m=i.getBounds(),n=m.width>m.height?v:v*(m.width/m.height),o=n*(m.height/m.width),p=new t.Point(y+(v-n)/2,T+(v-o)/2),i.setPosition(p,u),i.setWidth(n,u),"horizontal"===c?y+=h:T+=h;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var r=this._homeBounds?this._homeBounds.clone():null,a=this._contentSize?this._contentSize.clone():null,s=this._contentFactor||0;if(this._items.length){var d=this._items[0],e=d.getBounds();this._contentFactor=d.getContentSize().x/e.width;for(var c=d.getClippedBounds(),p=c.x,u=c.y,i=c.x+c.width,g=c.y+c.height,m=1;m<this._items.length;m++)d=this._items[m],e=d.getBounds(),this._contentFactor=n(this._contentFactor,d.getContentSize().x/e.width),c=d.getClippedBounds(),p=o(p,c.x),u=o(u,c.y),i=n(i,c.x+c.width),g=n(g,c.y+c.height);this._homeBounds=new t.Rect(p,u,i-p,g-u),this._contentSize=new t.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new t.Rect(0,0,1,1),this._contentSize=new t.Point(1,1),this._contentFactor=1;this._contentFactor===s&&this._homeBounds.equals(r)&&this._contentSize.equals(a)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(e){this.raiseEvent("remove-item",{item:e})}})}(OpenSeadragon);