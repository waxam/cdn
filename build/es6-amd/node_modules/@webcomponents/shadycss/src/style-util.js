define(["exports","./style-settings.js","./css-parse.js","./common-regex.js","./unscoped-style-handler.js"],(function(e,t,n,s,i){
/**
  @license
  Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
  This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
  The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
  The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
  Code distributed by Google as part of the polymer project is also
  subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
  */
"use strict";function forEachRule(e,t,i,l){if(!e)return;let r=!1,o=e.type;if(l&&o===n.types.MEDIA_RULE){let t=e.selector.match(s.MEDIA_MATCH);t&&(window.matchMedia(t[1]).matches||(r=!0))}o===n.types.STYLE_RULE?t(e):i&&o===n.types.KEYFRAMES_RULE?i(e):o===n.types.MIXIN_RULE&&(r=!0);let a=e.rules;if(a&&!r)for(let n,s=0,u=a.length;s<u&&(n=a[s]);s++)forEachRule(n,t,i,l)}function createScopeStyle(e,t){let n=document.createElement("style");return t&&n.setAttribute("scope",t),n.textContent=e,n}Object.defineProperty(e,"__esModule",{value:!0}),e.toCssText=function toCssText(e,s){if(!e)return"";"string"==typeof e&&(e=(0,n.parse)(e));s&&forEachRule(e,s);return(0,n.stringify)(e,t.nativeCssVariables)},e.rulesForStyle=function rulesForStyle(e){!e.__cssRules&&e.textContent&&(e.__cssRules=(0,n.parse)(e.textContent));return e.__cssRules||null},e.isKeyframesSelector=function isKeyframesSelector(e){return Boolean(e.parent)&&e.parent.type===n.types.KEYFRAMES_RULE},e.forEachRule=forEachRule,e.applyCss=function applyCss(e,t,n,s){let i=createScopeStyle(e,t);return applyStyle(i,n,s),i},e.createScopeStyle=createScopeStyle,e.applyStylePlaceHolder=function applyStylePlaceHolder(e){let t=document.createComment(" Shady DOM styles for "+e+" "),n=l?l.nextSibling:null,s=document.head;return s.insertBefore(t,n||s.firstChild),l=t,t},e.applyStyle=applyStyle,e.isTargetedBuild=function isTargetedBuild(e){return t.nativeShadow?"shadow"===e:"shady"===e},e.findMatchingParen=findMatchingParen,e.processVariableAndFallback=function processVariableAndFallback(e,t){let n=e.indexOf("var(");if(-1===n)return t(e,"","","");let s=findMatchingParen(e,n+3),i=e.substring(n+4,s),l=e.substring(0,n),r=processVariableAndFallback(e.substring(s+1),t),o=i.indexOf(",");if(-1===o)return t(l,i.trim(),"",r);let a=i.substring(0,o).trim(),u=i.substring(o+1).trim();return t(l,a,u,r)},e.setElementClassRaw=function setElementClassRaw(e,n){t.nativeShadow?e.setAttribute("class",n):window.ShadyDOM.nativeMethods.setAttribute.call(e,"class",n)},e.getIsExtends=function getIsExtends(e){let t=e.localName,n="",s="";t?t.indexOf("-")>-1?n=t:(s=t,n=e.getAttribute&&e.getAttribute("is")||""):(n=e.is,s=e.extends);return{is:n,typeExtension:s}},e.gatherStyleText=function gatherStyleText(e){const n=[],s=e.querySelectorAll("style");for(let l=0;l<s.length;l++){const e=s[l];(0,i.isUnscopedStyle)(e)?t.nativeShadow||((0,i.processUnscopedStyle)(e),e.parentNode.removeChild(e)):(n.push(e.textContent),e.parentNode.removeChild(e))}return n.join("").trim()},e.splitSelectorList=function splitSelectorList(e){const t=[];let n="";for(let s=0;s>=0&&s<e.length;s++)if("("===e[s]){const t=findMatchingParen(e,s);n+=e.slice(s,t+1),s=t}else","===e[s]?(t.push(n),n=""):n+=e[s];n&&t.push(n);return t},e.getCssBuild=getCssBuild,e.elementHasBuiltCss=function elementHasBuiltCss(e){return""!==getCssBuild(e)},e.getBuildComment=getBuildComment,e.isOptimalCssBuild=function isOptimalCssBuild(e=""){if(""===e||!t.nativeCssVariables)return!1;return t.nativeShadow?"shadow"===e:"shady"===e},e.wrap=void 0;let l=null;function applyStyle(e,t,n){t=t||document.head;let s=n&&n.nextSibling||t.firstChild;if(t.insertBefore(e,s),l){e.compareDocumentPosition(l)===Node.DOCUMENT_POSITION_PRECEDING&&(l=e)}else l=e}function findMatchingParen(e,t){let n=0;for(let s=t,i=e.length;s<i;s++)if("("===e[s])n++;else if(")"===e[s]&&0==--n)return s;return-1}const r=window.ShadyDOM&&window.ShadyDOM.wrap||(e=>e);e.wrap=r;function getCssBuild(e){if(void 0!==t.cssBuild)return t.cssBuild;if(void 0===e.__cssBuild){const t=e.getAttribute("css-build");if(t)e.__cssBuild=t;else{const t=getBuildComment(e);""!==t&&function removeBuildComment(e){const t="template"===e.localName?e.content.firstChild:e.firstChild;t.parentNode.removeChild(t)}(e),e.__cssBuild=t}}return e.__cssBuild||""}function getBuildComment(e){const t="template"===e.localName?e.content.firstChild:e.firstChild;if(t instanceof Comment){const e=t.textContent.trim().split(":");if("css-build"===e[0])return e[1]}return""}}));