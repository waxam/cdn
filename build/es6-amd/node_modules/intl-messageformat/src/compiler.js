define(["exports"],(function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var e=Compiler;function Compiler(t,e,r){this.locales=t,this.formats=e,this.pluralFn=r}function StringFormat(t){this.id=t}function PluralFormat(t,e,r,o,i){this.id=t,this.useOrdinal=e,this.offset=r,this.options=o,this.pluralFn=i}function PluralOffsetString(t,e,r,o){this.id=t,this.offset=e,this.numberFormat=r,this.string=o}function SelectFormat(t,e){this.id=t,this.options=e}t.default=e,Compiler.prototype.compile=function(t){return this.pluralStack=[],this.currentPlural=null,this.pluralNumberFormat=null,this.compileMessage(t)},Compiler.prototype.compileMessage=function(t){if(!t||"messageFormatPattern"!==t.type)throw new Error('Message AST is not of type: "messageFormatPattern"');var e,r,o,i=t.elements,a=[];for(e=0,r=i.length;e<r;e+=1)switch((o=i[e]).type){case"messageTextElement":a.push(this.compileMessageText(o));break;case"argumentElement":a.push(this.compileArgument(o));break;default:throw new Error("Message element does not have a valid type")}return a},Compiler.prototype.compileMessageText=function(t){return this.currentPlural&&/(^|[^\\])#/g.test(t.value)?(this.pluralNumberFormat||(this.pluralNumberFormat=new Intl.NumberFormat(this.locales)),new PluralOffsetString(this.currentPlural.id,this.currentPlural.format.offset,this.pluralNumberFormat,t.value)):t.value.replace(/\\#/g,"#")},Compiler.prototype.compileArgument=function(t){var e=t.format;if(!e)return new StringFormat(t.id);var r,o=this.formats,i=this.locales,a=this.pluralFn;switch(e.type){case"numberFormat":return r=o.number[e.style],{id:t.id,format:new Intl.NumberFormat(i,r).format};case"dateFormat":return r=o.date[e.style],{id:t.id,format:new Intl.DateTimeFormat(i,r).format};case"timeFormat":return r=o.time[e.style],{id:t.id,format:new Intl.DateTimeFormat(i,r).format};case"pluralFormat":return r=this.compileOptions(t),new PluralFormat(t.id,e.ordinal,e.offset,r,a);case"selectFormat":return r=this.compileOptions(t),new SelectFormat(t.id,r);default:throw new Error("Message element does not have a valid format type")}},Compiler.prototype.compileOptions=function(t){var e,r,o,i=t.format,a=i.options,s={};for(this.pluralStack.push(this.currentPlural),this.currentPlural="pluralFormat"===i.type?t:null,e=0,r=a.length;e<r;e+=1)s[(o=a[e]).selector]=this.compileMessage(o.value);return this.currentPlural=this.pluralStack.pop(),s},StringFormat.prototype.format=function(t){return t||"number"==typeof t?"string"==typeof t?t:String(t):""},PluralFormat.prototype.getOption=function(t){var e=this.options;return e["="+t]||e[this.pluralFn(t-this.offset,this.useOrdinal)]||e.other},PluralOffsetString.prototype.format=function(t){var e=this.numberFormat.format(t-this.offset);return this.string.replace(/(^|[^\\])#/g,"$1"+e).replace(/\\#/g,"#")},SelectFormat.prototype.getOption=function(t){var e=this.options;return e[t]||e.other}}));