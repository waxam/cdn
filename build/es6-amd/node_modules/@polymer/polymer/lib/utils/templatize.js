define(["exports","./boot.js","../mixins/property-effects.js","../mixins/mutable-data.js","./settings.js","./wrap.js"],(function(e,t,o,a,n,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.templatize=templatize,e.modelForElement=function modelForElement(e,t){let o;for(;t;)if(o=t.__templatizeInstance){if(o.__dataHost==e)return o;t=o.__dataHost}else t=(0,s.wrap)(t).parentNode;return null},e.TemplateInstanceBase=void 0;
/**
  @license
  Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
  This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
  The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
  The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
  Code distributed by Google as part of the polymer project is also
  subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
  */
let r=null;function HTMLTemplateElementExtension(){return r}HTMLTemplateElementExtension.prototype=Object.create(HTMLTemplateElement.prototype,{constructor:{value:HTMLTemplateElementExtension,writable:!0}});const p=(0,o.PropertyEffects)(HTMLTemplateElementExtension),l=(0,a.MutableData)(p);const i=(0,o.PropertyEffects)(class{});class TemplateInstanceBase extends i{constructor(e){super(),this._configureProperties(e),this.root=this._stampTemplate(this.__dataHost);let t=[];this.children=t;for(let a=this.root.firstChild;a;a=a.nextSibling)t.push(a),a.__templatizeInstance=this;this.__templatizeOwner&&this.__templatizeOwner.__hideTemplateChildren__&&this._showHideChildren(!0);let o=this.__templatizeOptions;(e&&o.instanceProps||!o.instanceProps)&&this._enableProperties()}_configureProperties(e){if(this.__templatizeOptions.forwardHostProp)for(let t in this.__hostProps)this._setPendingProperty(t,this.__dataHost["_host_"+t]);for(let t in e)this._setPendingProperty(t,e[t])}forwardHostProp(e,t){this._setPendingPropertyOrPath(e,t,!1,!0)&&this.__dataHost._enqueueClient(this)}_addEventListenerToNode(e,t,o){if(this._methodHost&&this.__templatizeOptions.parentModel)this._methodHost._addEventListenerToNode(e,t,e=>{e.model=this,o(e)});else{let a=this.__dataHost.__dataHost;a&&a._addEventListenerToNode(e,t,o)}}_showHideChildren(e){let t=this.children;for(let o=0;o<t.length;o++){let a=t[o];if(Boolean(e)!=Boolean(a.__hideTemplateChildren__))if(a.nodeType===Node.TEXT_NODE)e?(a.__polymerTextContent__=a.textContent,a.textContent=""):a.textContent=a.__polymerTextContent__;else if("slot"===a.localName)if(e)a.__polymerReplaced__=document.createComment("hidden-slot"),(0,s.wrap)((0,s.wrap)(a).parentNode).replaceChild(a.__polymerReplaced__,a);else{const e=a.__polymerReplaced__;e&&(0,s.wrap)((0,s.wrap)(e).parentNode).replaceChild(a,e)}else a.style&&(e?(a.__polymerDisplay__=a.style.display,a.style.display="none"):a.style.display=a.__polymerDisplay__);a.__hideTemplateChildren__=e,a._showHideChildren&&a._showHideChildren(e)}}_setUnmanagedPropertyToNode(e,t,o){e.__hideTemplateChildren__&&e.nodeType==Node.TEXT_NODE&&"textContent"==t?e.__polymerTextContent__=o:super._setUnmanagedPropertyToNode(e,t,o)}get parentModel(){let e=this.__parentModel;if(!e){let t;e=this;do{e=e.__dataHost.__dataHost}while((t=e.__templatizeOptions)&&!t.parentModel);this.__parentModel=e}return e}dispatchEvent(e){return!0}}e.TemplateInstanceBase=TemplateInstanceBase,TemplateInstanceBase.prototype.__dataHost,TemplateInstanceBase.prototype.__templatizeOptions,TemplateInstanceBase.prototype._methodHost,TemplateInstanceBase.prototype.__templatizeOwner,TemplateInstanceBase.prototype.__hostProps;const _=(0,a.MutableData)(TemplateInstanceBase);function findMethodHost(e){let t=e.__dataHost;return t&&t._methodHost||t}function createTemplatizerClass(e,t,o){let a=o.mutableData?_:TemplateInstanceBase;templatize.mixin&&(a=templatize.mixin(a));let n=class extends a{};return n.prototype.__templatizeOptions=o,n.prototype._bindTemplate(e),function addNotifyEffects(e,t,o,a){let n=o.hostProps||{};for(let s in a.instanceProps){delete n[s];let t=a.notifyInstanceProp;t&&e.prototype._addPropertyEffect(s,e.prototype.PROPERTY_EFFECT_TYPES.NOTIFY,{fn:createNotifyInstancePropEffect(s,t)})}if(a.forwardHostProp&&t.__dataHost)for(let s in n)o.hasHostProps||(o.hasHostProps=!0),e.prototype._addPropertyEffect(s,e.prototype.PROPERTY_EFFECT_TYPES.NOTIFY,{fn:function notifyHostProp(e,t,o){e.__dataHost._setPendingPropertyOrPath("_host_"+t,o[t],!0,!0)}})}(n,e,t,o),n}function addPropagateEffects(e,t,o){let a=o.forwardHostProp;if(a&&t.hasHostProps){let n=t.templatizeTemplateClass;if(!n){let e=o.mutableData?l:p;n=t.templatizeTemplateClass=class TemplatizedTemplate extends e{};let s=t.hostProps;for(let t in s)n.prototype._addPropertyEffect("_host_"+t,n.prototype.PROPERTY_EFFECT_TYPES.PROPAGATE,{fn:createForwardHostPropEffect(t,a)}),n.prototype._createNotifyingProperty("_host_"+t)}!function upgradeTemplate(e,t){r=e,Object.setPrototypeOf(e,t.prototype),new t,r=null}(e,n),e.__dataProto&&Object.assign(e.__data,e.__dataProto),e.__dataTemp={},e.__dataPending=null,e.__dataOld=null,e._enableProperties()}}function createForwardHostPropEffect(e,t){return function forwardHostProp(e,o,a){t.call(e.__templatizeOwner,o.substring("_host_".length),a[o])}}function createNotifyInstancePropEffect(e,t){return function notifyInstanceProp(e,o,a){t.call(e.__templatizeOwner,e,o,a[o])}}function templatize(e,t,o){if(n.strictTemplatePolicy&&!findMethodHost(e))throw new Error("strictTemplatePolicy: template owner not trusted");if(o=o||{},e.__templatizeOwner)throw new Error("A <template> can only be templatized once");e.__templatizeOwner=t;let a=(t?t.constructor:TemplateInstanceBase)._parseTemplate(e),s=a.templatizeInstanceClass;s||(s=createTemplatizerClass(e,a,o),a.templatizeInstanceClass=s),addPropagateEffects(e,a,o);let r=class TemplateInstance extends s{};return r.prototype._methodHost=findMethodHost(e),r.prototype.__dataHost=e,r.prototype.__templatizeOwner=t,r.prototype.__hostProps=a.hostProps,r=r,r}}));