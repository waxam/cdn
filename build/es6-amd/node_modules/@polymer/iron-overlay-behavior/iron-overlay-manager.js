define(["exports","../polymer/polymer-legacy.js","./iron-overlay-backdrop.js","../iron-a11y-keys-behavior/iron-a11y-keys-behavior.js","../polymer/lib/legacy/polymer.dom.js","../polymer/lib/utils/gestures.js"],(function(_exports,_polymerLegacy,_ironOverlayBackdrop,_ironA11yKeysBehavior,_polymerDom,gestures){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.IronOverlayManager=_exports.IronOverlayManagerClass=void 0,gestures=babelHelpers.interopRequireWildcard(gestures);
/**
  @license
  Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
  This code may only be used under the BSD style license found at
  http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
  http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
  found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
  part of the polymer project is also subject to an additional IP rights grant
  found at http://polymer.github.io/PATENTS.txt
  */
class IronOverlayManagerClass{constructor(){this._overlays=[],this._minimumZ=101,this._backdropElement=null,gestures.addListener(document.documentElement,"tap",(function(){})),document.addEventListener("tap",this._onCaptureClick.bind(this),!0),document.addEventListener("focus",this._onCaptureFocus.bind(this),!0),document.addEventListener("keydown",this._onCaptureKeyDown.bind(this),!0)}get backdropElement(){return this._backdropElement||(this._backdropElement=document.createElement("iron-overlay-backdrop")),this._backdropElement}get deepActiveElement(){var active=document.activeElement;for(active&&active instanceof Element!=!1||(active=document.body);active.root&&(0,_polymerDom.dom)(active.root).activeElement;)active=(0,_polymerDom.dom)(active.root).activeElement;return active}_bringOverlayAtIndexToFront(i){var overlay=this._overlays[i];if(overlay){var lastI=this._overlays.length-1,currentOverlay=this._overlays[lastI];if(currentOverlay&&this._shouldBeBehindOverlay(overlay,currentOverlay)&&lastI--,!(i>=lastI)){var minimumZ=Math.max(this.currentOverlayZ(),this._minimumZ);for(this._getZ(overlay)<=minimumZ&&this._applyOverlayZ(overlay,minimumZ);i<lastI;)this._overlays[i]=this._overlays[i+1],i++;this._overlays[lastI]=overlay}}}addOrRemoveOverlay(overlay){overlay.opened?this.addOverlay(overlay):this.removeOverlay(overlay)}addOverlay(overlay){var i=this._overlays.indexOf(overlay);if(i>=0)return this._bringOverlayAtIndexToFront(i),void this.trackBackdrop();var insertionIndex=this._overlays.length,currentOverlay=this._overlays[insertionIndex-1],minimumZ=Math.max(this._getZ(currentOverlay),this._minimumZ),newZ=this._getZ(overlay);if(currentOverlay&&this._shouldBeBehindOverlay(overlay,currentOverlay)){this._applyOverlayZ(currentOverlay,minimumZ),insertionIndex--;var previousOverlay=this._overlays[insertionIndex-1];minimumZ=Math.max(this._getZ(previousOverlay),this._minimumZ)}newZ<=minimumZ&&this._applyOverlayZ(overlay,minimumZ),this._overlays.splice(insertionIndex,0,overlay),this.trackBackdrop()}removeOverlay(overlay){var i=this._overlays.indexOf(overlay);-1!==i&&(this._overlays.splice(i,1),this.trackBackdrop())}currentOverlay(){var i=this._overlays.length-1;return this._overlays[i]}currentOverlayZ(){return this._getZ(this.currentOverlay())}ensureMinimumZ(minimumZ){this._minimumZ=Math.max(this._minimumZ,minimumZ)}focusOverlay(){var current=this.currentOverlay();current&&current._applyFocus()}trackBackdrop(){var overlay=this._overlayWithBackdrop();(overlay||this._backdropElement)&&(this.backdropElement.style.zIndex=this._getZ(overlay)-1,this.backdropElement.opened=!!overlay,this.backdropElement.prepare())}getBackdrops(){for(var backdrops=[],i=0;i<this._overlays.length;i++)this._overlays[i].withBackdrop&&backdrops.push(this._overlays[i]);return backdrops}backdropZ(){return this._getZ(this._overlayWithBackdrop())-1}_overlayWithBackdrop(){for(var i=this._overlays.length-1;i>=0;i--)if(this._overlays[i].withBackdrop)return this._overlays[i]}_getZ(overlay){var z=this._minimumZ;if(overlay){var z1=Number(overlay.style.zIndex||window.getComputedStyle(overlay).zIndex);z1==z1&&(z=z1)}return z}_setZ(element,z){element.style.zIndex=z}_applyOverlayZ(overlay,aboveZ){this._setZ(overlay,aboveZ+2)}_overlayInPath(path){path=path||[];for(var i=0;i<path.length;i++)if(path[i]._manager===this)return path[i]}_onCaptureClick(event){var i=this._overlays.length-1;if(-1!==i)for(var overlay,path=(0,_polymerDom.dom)(event).path;(overlay=this._overlays[i])&&this._overlayInPath(path)!==overlay&&(overlay._onCaptureClick(event),overlay.allowClickThrough);)i--}_onCaptureFocus(event){var overlay=this.currentOverlay();overlay&&overlay._onCaptureFocus(event)}_onCaptureKeyDown(event){var overlay=this.currentOverlay();overlay&&(_ironA11yKeysBehavior.IronA11yKeysBehavior.keyboardEventMatchesKeys(event,"esc")?overlay._onCaptureEsc(event):_ironA11yKeysBehavior.IronA11yKeysBehavior.keyboardEventMatchesKeys(event,"tab")&&overlay._onCaptureTab(event))}_shouldBeBehindOverlay(overlay1,overlay2){return!overlay1.alwaysOnTop&&overlay2.alwaysOnTop}}_exports.IronOverlayManagerClass=IronOverlayManagerClass;const IronOverlayManager=new IronOverlayManagerClass;_exports.IronOverlayManager=IronOverlayManager}));