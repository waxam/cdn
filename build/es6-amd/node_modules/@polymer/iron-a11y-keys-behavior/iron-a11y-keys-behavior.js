define(["exports","../polymer/polymer-legacy.js"],(function(_exports,_polymerLegacy){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.IronA11yKeysBehavior=void 0;
/**
  @license
  Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
  This code may only be used under the BSD style license found at
  http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
  http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
  found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
  part of the polymer project is also subject to an additional IP rights grant
  found at http://polymer.github.io/PATENTS.txt
  */
var KEY_IDENTIFIER={"U+0008":"backspace","U+0009":"tab","U+001B":"esc","U+0020":"space","U+007F":"del"},KEY_CODE={8:"backspace",9:"tab",13:"enter",27:"esc",33:"pageup",34:"pagedown",35:"end",36:"home",32:"space",37:"left",38:"up",39:"right",40:"down",46:"del",106:"*"},MODIFIER_KEYS={shift:"shiftKey",ctrl:"ctrlKey",alt:"altKey",meta:"metaKey"},KEY_CHAR=/[a-z0-9*]/,IDENT_CHAR=/U\+/,ARROW_KEY=/^arrow/,SPACE_KEY=/^space(bar)?/,ESC_KEY=/^escape$/;function transformKey(key,noSpecialChars){var validKey="";if(key){var lKey=key.toLowerCase();" "===lKey||SPACE_KEY.test(lKey)?validKey="space":ESC_KEY.test(lKey)?validKey="esc":1==lKey.length?noSpecialChars&&!KEY_CHAR.test(lKey)||(validKey=lKey):validKey=ARROW_KEY.test(lKey)?lKey.replace("arrow",""):"multiply"==lKey?"*":lKey}return validKey}function normalizedKeyForEvent(keyEvent,noSpecialChars){return keyEvent.key?transformKey(keyEvent.key,noSpecialChars):keyEvent.detail&&keyEvent.detail.key?transformKey(keyEvent.detail.key,noSpecialChars):function transformKeyIdentifier(keyIdent){var validKey="";return keyIdent&&(keyIdent in KEY_IDENTIFIER?validKey=KEY_IDENTIFIER[keyIdent]:IDENT_CHAR.test(keyIdent)?(keyIdent=parseInt(keyIdent.replace("U+","0x"),16),validKey=String.fromCharCode(keyIdent).toLowerCase()):validKey=keyIdent.toLowerCase()),validKey}(keyEvent.keyIdentifier)||function transformKeyCode(keyCode){var validKey="";return Number(keyCode)&&(validKey=keyCode>=65&&keyCode<=90?String.fromCharCode(32+keyCode):keyCode>=112&&keyCode<=123?"f"+(keyCode-112+1):keyCode>=48&&keyCode<=57?String(keyCode-48):keyCode>=96&&keyCode<=105?String(keyCode-96):KEY_CODE[keyCode]),validKey}(keyEvent.keyCode)||""}function keyComboMatchesEvent(keyCombo,event){return normalizedKeyForEvent(event,keyCombo.hasModifiers)===keyCombo.key&&(!keyCombo.hasModifiers||!!event.shiftKey==!!keyCombo.shiftKey&&!!event.ctrlKey==!!keyCombo.ctrlKey&&!!event.altKey==!!keyCombo.altKey&&!!event.metaKey==!!keyCombo.metaKey)}function parseEventString(eventString){return eventString.trim().split(" ").map((function(keyComboString){return function parseKeyComboString(keyComboString){return 1===keyComboString.length?{combo:keyComboString,key:keyComboString,event:"keydown"}:keyComboString.split("+").reduce((function(parsedKeyCombo,keyComboPart){var eventParts=keyComboPart.split(":"),keyName=eventParts[0],event=eventParts[1];return keyName in MODIFIER_KEYS?(parsedKeyCombo[MODIFIER_KEYS[keyName]]=!0,parsedKeyCombo.hasModifiers=!0):(parsedKeyCombo.key=keyName,parsedKeyCombo.event=event||"keydown"),parsedKeyCombo}),{combo:keyComboString.split(":").shift()})}(keyComboString)}))}const IronA11yKeysBehavior={properties:{keyEventTarget:{type:Object,value:function(){return this}},stopKeyboardEventPropagation:{type:Boolean,value:!1},_boundKeyHandlers:{type:Array,value:function(){return[]}},_imperativeKeyBindings:{type:Object,value:function(){return{}}}},observers:["_resetKeyEventListeners(keyEventTarget, _boundKeyHandlers)"],keyBindings:{},registered:function(){this._prepKeyBindings()},attached:function(){this._listenKeyEventListeners()},detached:function(){this._unlistenKeyEventListeners()},addOwnKeyBinding:function(eventString,handlerName){this._imperativeKeyBindings[eventString]=handlerName,this._prepKeyBindings(),this._resetKeyEventListeners()},removeOwnKeyBindings:function(){this._imperativeKeyBindings={},this._prepKeyBindings(),this._resetKeyEventListeners()},keyboardEventMatchesKeys:function(event,eventString){for(var keyCombos=parseEventString(eventString),i=0;i<keyCombos.length;++i)if(keyComboMatchesEvent(keyCombos[i],event))return!0;return!1},_collectKeyBindings:function(){var keyBindings=this.behaviors.map((function(behavior){return behavior.keyBindings}));return-1===keyBindings.indexOf(this.keyBindings)&&keyBindings.push(this.keyBindings),keyBindings},_prepKeyBindings:function(){for(var eventString in this._keyBindings={},this._collectKeyBindings().forEach((function(keyBindings){for(var eventString in keyBindings)this._addKeyBinding(eventString,keyBindings[eventString])}),this),this._imperativeKeyBindings)this._addKeyBinding(eventString,this._imperativeKeyBindings[eventString]);for(var eventName in this._keyBindings)this._keyBindings[eventName].sort((function(kb1,kb2){var b1=kb1[0].hasModifiers;return b1===kb2[0].hasModifiers?0:b1?-1:1}))},_addKeyBinding:function(eventString,handlerName){parseEventString(eventString).forEach((function(keyCombo){this._keyBindings[keyCombo.event]=this._keyBindings[keyCombo.event]||[],this._keyBindings[keyCombo.event].push([keyCombo,handlerName])}),this)},_resetKeyEventListeners:function(){this._unlistenKeyEventListeners(),this.isAttached&&this._listenKeyEventListeners()},_listenKeyEventListeners:function(){this.keyEventTarget&&Object.keys(this._keyBindings).forEach((function(eventName){var keyBindings=this._keyBindings[eventName],boundKeyHandler=this._onKeyBindingEvent.bind(this,keyBindings);this._boundKeyHandlers.push([this.keyEventTarget,eventName,boundKeyHandler]),this.keyEventTarget.addEventListener(eventName,boundKeyHandler)}),this)},_unlistenKeyEventListeners:function(){for(var keyHandlerTuple,keyEventTarget,eventName,boundKeyHandler;this._boundKeyHandlers.length;)keyEventTarget=(keyHandlerTuple=this._boundKeyHandlers.pop())[0],eventName=keyHandlerTuple[1],boundKeyHandler=keyHandlerTuple[2],keyEventTarget.removeEventListener(eventName,boundKeyHandler)},_onKeyBindingEvent:function(keyBindings,event){if(this.stopKeyboardEventPropagation&&event.stopPropagation(),!event.defaultPrevented)for(var i=0;i<keyBindings.length;i++){var keyCombo=keyBindings[i][0],handlerName=keyBindings[i][1];if(keyComboMatchesEvent(keyCombo,event)&&(this._triggerKeyHandler(keyCombo,handlerName,event),event.defaultPrevented))return}},_triggerKeyHandler:function(keyCombo,handlerName,keyboardEvent){var detail=Object.create(keyCombo);detail.keyboardEvent=keyboardEvent;var event=new CustomEvent(keyCombo.event,{detail:detail,cancelable:!0});this[handlerName].call(this,event),event.defaultPrevented&&keyboardEvent.preventDefault()}};_exports.IronA11yKeysBehavior=IronA11yKeysBehavior}));