define(["exports","require","../../../lit-element/lit-element.js","./simple-fields-array.js"],(function(e,t,s,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.SimpleFieldsSchema=void 0,t=babelHelpers.interopRequireWildcard(t);class SimpleFieldsSchema extends s.LitElement{static get styles(){return[s.css``]}render(){return s.html`
      <div id="schema-fields" aria-live="polite">
        <slot></slot>
      </div>
    `}constructor(){super(),this.autofocus=!1,this.codeTheme="vs-light-2",this.dataTypes={array:{element:"simple-fields-array",defaultValue:[],isArray:!0,previewSlot:"preview",sortSlot:"sort"},boolean:{element:"simple-fields-boolean",defaultValue:!1},fieldset:{element:"simple-fields-fieldset",defaultValue:{},isFieldset:!0},file:{element:"simple-fields-file",defaultValue:{}},integer:{element:"paper-input",defaultValue:"",type:"number",step:1},markup:{element:"simple-fields-markup",defaultValue:""},number:{element:"paper-input",type:"number",defaultValue:""},object:{element:"simple-fields-fieldset",defaultValue:{},isFieldset:!0},string:{element:"paper-input"},tabs:{element:"a11y-tabs",defaultValue:{},isFieldset:!0}},this.language="en",this.resources={},this.value={},setTimeout(()=>{new Promise((e,s)=>t.default(["./simple-fields-fieldset.js"],e,s)),new Promise((e,s)=>t.default(["../../../@polymer/iron-icons/iron-icons.js"],e,s)),new Promise((e,s)=>t.default(["../../../@polymer/iron-icons/editor-icons.js"],e,s)),new Promise((e,s)=>t.default(["../../../@polymer/paper-input/paper-input.js"],e,s)),new Promise((e,s)=>t.default(["../../../@polymer/paper-icon-button/paper-icon-button.js"],e,s)),new Promise((e,s)=>t.default(["../../simple-tooltip/simple-tooltip.js"],e,s))},0)}static get tag(){return"simple-fields-schema"}static get properties(){return{...super.properties,autofocus:{type:Boolean},codeTheme:{type:String},dataTypes:{type:Object},error:{type:Object},label:{type:String},language:{type:String,attribute:"lang",reflect:!0},resources:{type:Object},schema:{type:Object},value:{type:Object},wizard:{type:Boolean}}}_buildFormElement(e,t=this,s=-1,i){let l=document.createElement(e.component.type.element),r=s>-1?e.name.replace("..",`.${s}.`):e.name,o=this._getValue(r),a=e.schema.properties?Object.keys(e.schema.properties):[];l.label=e.label||e.title,l.schema=e.schema,l.resources=this.resources,l.setAttribute("language",this.language),l.setAttribute("name",r),Object.keys(e.component.type).forEach(t=>{l.setAttribute(t,e.component.type[t])}),e.schema.hidden&&l.setAttribute("hidden",!0),i&&(l.slot=i),t.append(l),e.component.type.isArray&&s<0?(l.addEventListener("add",e=>this._setValue(`${r}.${o.length}`,{})),l.addEventListener("remove",e=>{let t=this._deepClone(o);t.splice(parseInt(e.detail.id.replace(/item-/,"")),1),console.log(t,parseInt(e.detail.id.replace(/item-/,""))),this._setValue(`${r}`,t)}),e.sortBy&&(o=o.sort((t,s)=>{let i=0,l=0,r=0;for(;i<e.sortBy.length&&l===r;)l=t[e.sortBy[i]],r=s[e.sortBy[i]],i++;return l===r?0:l<r?-1:1})),o&&o.forEach((t,s)=>{let i=`item-${s}`,o=l.buildItem(i),p=e.component.type.sortSlot,n=e.component.type.previewSlot,m=a.filter(t=>!0===e.schema.properties[t].previewField);m.length<1&&m.push(a[0]),a.forEach(t=>{let i=e.schema.properties[t].name.replace(`${r}..`,"");this._buildFormElement(e.schema.properties[t],o,s,p&&e.sortBy[0]===i?p:m.includes(t)?n:void 0)})})):e.schema&&e.schema.properties?Object.keys(e.schema.properties).forEach(t=>this._buildFormElement(e.schema.properties[t],l)):(l[e.component.valueProperty]=o,l.onchange=t=>this._setValue(r,l[e.component.valueProperty]))}_getProperties(e=this.schema,t){let s=this;return Object.keys(e.properties||[]).map(i=>{let l=e.properties[i],r={name:t?`${t}.${i}`:i,schema:l,component:l.component||{},description:l.description,label:l.title||i,previewField:l.previewField,sortBy:l.sortBy};return r.component.valueProperty=r.component.valueProperty||"value",r.component.slot=r.component.slot||"",Object.keys(s.dataTypes).forEach(e=>{(Array.isArray(l.type)&&-1!==l.type.indexOf(e)||l.type===e)&&(r.component.type=this._deepClone(s.dataTypes[e]),r.component.type.element=r.component.name||r.component.type.element,r.component.type.type=l.format,(r.component.type.isFieldset||r.component.type.isArray)&&(l.items&&l.items.properties||(l.items={properties:l.properties?this._deepClone(l.properties):{}}),l.items&&l.items.properties&&(r.schema.properties=this._getProperties(l.items,r.component.type.isArray?`${r.name}.`:r.name))))}),r.component.type&&r.component.type.element||console.error("Unknown property type %s",l.type),r})}_setValue(e,t){let s=this._deepClone(this.value),i=this.value,l=e.split("."),r=l.length;for(var o=0;o<r-1;o++){let e=l[o];i[e]||(i[e]={}),i=i[e]}i[l[r-1]]=t,this._valueChanged(this.value,s)}_getValue(e){let t=e.split("."),s=this.value;return t.forEach(e=>{s=s&&s[e]?s[e]:void 0}),s}updated(e){e.forEach((e,t)=>{"schema"===t&&this._schemaChanged(this.schema,e),"value"===t&&this._valueChanged(this.value,e)})}_clearForm(){this.querySelectorAll("*").forEach(e=>e.remove())}_deepClone(e){return JSON.parse(JSON.stringify(e))}_rebuildForm(){if(this._clearForm(),this.schema){this._getProperties(this.schema).forEach(e=>this._buildFormElement(e))}}_valueChanged(e,t){console.log("this._valueChanged",this.value,t),e&&e!==t&&(this._rebuildForm(),this.dispatchEvent(new CustomEvent("value-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:this})))}_schemaChanged(e,t){e&&e!==t&&(this._rebuildForm(),this.dispatchEvent(new CustomEvent("schema-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:this})))}disconnectedCallback(){this._clearForm(),super.disconnectedCallback()}}e.SimpleFieldsSchema=SimpleFieldsSchema,window.customElements.define(SimpleFieldsSchema.tag,SimpleFieldsSchema)}));