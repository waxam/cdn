define(["exports","require","../../@polymer/polymer/polymer-element.js","../../@polymer/polymer/lib/utils/render-status.js","../../@polymer/polymer/lib/utils/async.js","../simple-modal/simple-modal.js"],(function(_exports,_require,_polymerElement,_renderStatus,async,_simpleModal){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.LrnsysOutline=void 0,_require=babelHelpers.interopRequireWildcard(_require),async=babelHelpers.interopRequireWildcard(async);
/**
   * Copyright 2018 The Pennsylvania State University
   * @license Apache-2.0, see License.md for full text.
   */
class LrnsysOutline extends _polymerElement.PolymerElement{constructor(){super(),new Promise((res,rej)=>_require.default(["../../@polymer/paper-input/paper-input.js"],res,rej)),new Promise((res,rej)=>_require.default(["../../@polymer/paper-icon-button/paper-icon-button.js"],res,rej)),new Promise((res,rej)=>_require.default(["../../@polymer/paper-button/paper-button.js"],res,rej)),new Promise((res,rej)=>_require.default(["./lib/lrnsys-outline-item.js"],res,rej))}static get template(){return _polymerElement.html`
      <style>
        :host {
          display: block;
        }
        :host kbd {
          display: inline-block;
          background: #333;
          color: white;
          border-radius: 4px;
          margin: 4px 4px 4px 0;
          padding: 8px;
          font-family: Verdana, Geneva, Tahoma, sans-serif;
          font-size: 85%;
        }
      </style>
      <div id="itemslist">
        <template is="dom-repeat" items="{{items}}" as="item">
          <lrnsys-outline-item
            disable-down="[[item.disableDown]]"
            disable-left="[[item.disableLeft]]"
            disable-right="[[item.disableRight]]"
            disable-up="[[item.disableUp]]"
            id$="[[item.id]]"
            index$="[[item.index]]"
            indent-level="{{item.indent}}"
            parent="{{item.parent}}"
            title="{{item.title}}"
          >
          </lrnsys-outline-item>
        </template>
      </div>
    `}static get tag(){return"lrnsys-outline"}static get properties(){return{data:{type:Array,value:null},items:{type:Array,value:null,notify:!0},activeItem:{type:Object,notify:!0}}}connectedCallback(){super.connectedCallback(),window.SimpleModal.requestAvailability(),(0,_renderStatus.afterNextRender)(this,(function(){this.addEventListener("delete-item",this._handleRemoveItem.bind(this)),this.addEventListener("indent-item",this._handleIndentItem.bind(this)),this.addEventListener("add-item",this._handleAddItem.bind(this)),this.addEventListener("move-item",this._handleMoveItem.bind(this)),this.addEventListener("change-item",this._handleChangeItem.bind(this)),this.addEventListener("focus-item",this._handleFocusItem.bind(this)),this.addEventListener("blur-item",this._handleBlurItem.bind(this))}))}disconnectedCallback(){this.removeEventListener("delete-item",this._handleRemoveItem.bind(this)),this.removeEventListener("indent-item",this._handleIndentItem.bind(this)),this.removeEventListener("add-item",this._handleAddItem.bind(this)),this.removeEventListener("move-item",this._handleMoveItem.bind(this)),this.removeEventListener("change-item",this._handleChangeItem.bind(this)),this.removeEventListener("focus-item",this._handleFocusItem.bind(this)),this.removeEventListener("blur-item",this._handleBlurItem.bind(this)),super.disconnectedCallback()}ready(){super.ready(),(null===this.data||this.data.length<1)&&(this.__tempid=void 0===this.__tempid?0:this.__tempid+1,this.data=[{id:"outline-item-"+this.__tempid,title:"",order:0,parent:null}]),this.setData(this.data)}setData(data){if(void 0!==data&&data.length>0){let prevIndent=-1;for(var i in data){let indent=parseInt(this._getIndent(data,i));this.__tempid=void 0===this.__tempid?0:this.__tempid+1,data[i].index=parseInt(i),data[i].indent=indent,data[i].prevSibling=this._getSibling(parseInt(i),indent,!0),data[i].nextSibling=this._getSibling(parseInt(i),indent,!1),data[i].disableUp=null===data[i].prevSibling,data[i].disableDown=null===data[i].nextSibling,data[i].disableLeft=0===indent,data[i].disableRight=indent>prevIndent,data[i].id=void 0===data[i].id?"outline-item-"+this.__tempid:data[i].id,prevIndent=indent}}this.set("items",[]),this.set("items",data)}getData(){for(var i in this.items)this.items[i].order=this._getOrder(this.items[i]),this.notifyPath(`items.${i}.order`);return this.items}addItem(detail){let item=detail.item,title=detail.new,spliceIndex=this.items.findIndex(j=>j.id===item.id)+1;this.__tempid=this.__tempid+1,this.splice("items",spliceIndex,0,{id:"outline-item-"+this.__tempid,title:title,indent:item.indent,parent:item.parent}),this.items[spliceIndex].indentLevel=item.indent,this.notifyPath(`items.${spliceIndex}.indentLevel`),this.setData(this.items),void 0!==this.__focusedItem&&null!==this.__focusedItem&&async.microTask.run(()=>{setTimeout(()=>{this.__focusedItem=item.nextElementSibling,this.__focusedItem.focus()},50)})}removeItem(item){let i=this.items.findIndex(j=>j.id===item.id),b=document.createElement("paper-button");b.raised=!0,b.addEventListener("click",this._deleteItemConfirm.bind(this)),b.appendChild(document.createTextNode("Yes, delete"));const evt=new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!0,detail:{title:`Do you really want to delete ${this.items[i].title}?`,elements:{buttons:b},invokedBy:item.shadowRoot.querySelector("#delete"),clone:!1}});this.dispatchEvent(evt)}_deleteItemConfirm(e){let i=this.items.findIndex(j=>j.id===this.activeItem.id);this.activeItem.classList.add("collapse-to-remove");const evt=new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}});this.dispatchEvent(evt),setTimeout(()=>{for(var k in this.__focusedItem=this.activeItem.previousElementSibling,this.items)this.items[k].parent==this.items[i].id&&(this.items[k].parent=this.items[i].parent);this.activeItem.classList.remove("collapse-to-remove"),this.splice("items",i,1),void 0!==this.__focusedItem&&null!==this.__focusedItem&&async.microTask.run(()=>{setTimeout(()=>{this.__focusedItem.focus()},50)})},300)}moveItem(item,moveUp){let sourceStart=item.index,sourceEnd=this._getLastChild(item),sourceCount=sourceEnd-sourceStart+1,target=moveUp?this.items[sourceStart].prevSibling:this._getLastChild(this.items[sourceEnd+1])-sourceCount+1;if(target>-1&&target<this.items.length&&(moveUp&&!item.disableUp||!moveUp&&!item.disableDown)){let item2=this.splice("items",sourceStart,sourceCount);this.splice("items",target,0,item2),this.__focusedItem=this.shadowRoot.querySelector("#itemslist").querySelectorAll("lrnsys-outline-item")[target],this.setData(this.items),void 0!==this.__focusedItem&&null!==this.__focusedItem&&async.microTask.run(()=>{setTimeout(()=>{this.__focusedItem.focus()},50)})}}_adjustIndent(item,amount){if(amount>0&&!item.disableRight||amount<0&&!item.disableLeft){let i=parseInt(item.index),oldIndent=item.indent,indent=item.indent+amount,n=i+1,prevParent=null!==item.prevSibling&&void 0!==item.prevSibling?item.prevSibling.id:null,grandParent=this._getItemById(item.parent)&&this._getItemById(item.parent).parent?this._getItemById(item.parent).parent.id:null;for(item.indent=indent,item.parent=amount>0?prevParent:grandParent,item.prevSibling=this._getSibling(i,indent,!0),item.nextSibling=this._getSibling(i,indent,!1),item.disableUp=null===item.prevSibling,item.disableDown=null===item.nextSibling,item.disableLeft=0===indent,item.disableRight=null===this.items[i-1]||void 0===this.items[i-1]||indent>this.items[i-1].indentLevel,this.set(`items.${i}`,item),this.notifyPath(`items.${i}.*`);null!==this.items[n]&&void 0!==this.items[n]&&oldIndent<this.items[n].indentLevel;)this.items[n].indentLevel=this.items[n].indentLevel+amount,this.notifyPath(`items.${n}.indentLevel`),n++,next=this.items[n]}}_getLastChild(item){let next=null!=item?this._getSibling(item.index,item.indent,!1):null;return null!=next?next-1:void 0!==item&&null!==item.parent&&null!==item.parent&&null!==this._getItemById(item.parent)?this._getLastChild(this._getItemById(item.parent)):this.items.length-1}_getIndent(data,i){if(void 0!==data[i].parent){let k=data.findIndex(j=>j.id===data[i].parent);if(-1!==k&&void 0!==data[k]&&void 0!==data[k].indent)return data[k].indent+1}return 0}_getOrder(item){let ctr=0,order=0;for(var i in this.items)this.items[i].parent==item.parent&&this.items[i].id==item.id?order=ctr:this.items[i].parent==item.parent&&ctr++;return order}_getSibling(index,indent,prev){let inc=prev?-1:1,i=index+inc,sib=null;if(null!==this.items)for(;i<this.items.length&&i>-1;)null===sib&&void 0!==this.items[i]&&void 0!==this.items[index]&&this.items[i].parent===this.items[index].parent&&(sib=i),i+=inc;return sib}_getItemById(id,offset){let i=this.items.findIndex(j=>j.id===id);return offset=void 0===offset?0:offset,void 0!==this.items[i+offset]?this.items[i+offset]:null}_handleAddItem(e){this.addItem(e.detail)}_handleRemoveItem(e){this.activeItem=e.detail.item,this.removeItem(e.detail.item)}_handleMoveItem(e){this.activeItem=e.detail.item,this.moveItem(e.detail.item,e.detail.moveUp,e.detail.byGroup)}_handleFocusItem(e){(e.detail.moveUp?e.detail.item.previousElementSibling:e.detail.item.nextElementSibling).setSelection()}_handleIndentItem(e){let amt=e.detail.increase?1:-1;this._adjustIndent(this._getItemById(e.detail.item.id),amt),this.setData(this.items)}_handleChangeItem(e){if(null!=this._getItemById(e.detail.item.id)){let i=this.items.findIndex(j=>j.id===e.detail.item.id);void 0!==this.items[i]&&(this.items[i].title=e.detail.value,this.notifyPath(`items.${i}.title`))}}_handleFocusItem(e){this.__focusedItem=e.srcElement}_handleBlurItem(e){}}_exports.LrnsysOutline=LrnsysOutline,window.customElements.define(LrnsysOutline.tag,LrnsysOutline)}));