var _Mathround=Math.round,Reader=function(e){this.element=e,this.reader=e.root.querySelector(".pdf-viewer"),this.viewportOut=this.reader.querySelector(".pdf-viewport-out"),this.element=this.reader.querySelector(".pdf-element"),this.container=this.reader.querySelector(".sidebar"),this.toolbar=this.reader.querySelector(".pdf-toolbar"),this.card=e.root.querySelector(".style-scope"),this.toolbarHeight=0,this.title=this.toolbar.querySelector(".title"),this.enableTextSelection=e.enableTextSelection,this.fitWidth=e.fitWidth,this.HEIGHT=e.getAttribute("height"),this.WIDTH=e.getAttribute("width"),this.viewport=this.reader.querySelector(".pdf-viewport"),this.enableTextSelection&&(this.textLayerDiv=this.reader.querySelector(".textLayer"),this.textLayerDivStyle=this.textLayerDiv.style),this.spinner=this.reader.querySelector(".spinner"),this.totalPages=this.reader.querySelector("#totalPages"),this.viewportStyle=this.viewport.style,this.viewportOutStyle=this.viewportOut.style,this.ctx=this.viewport.getContext("2d"),this.SRC=e.src,this.pageRendering=!1,this.pageNumPending=null};Reader.prototype.setSize=function(e,t){this.WIDTH||(this.WIDTH=this.viewportOut.offsetWidth),this.HEIGHT||(this.HEIGHT=this.viewportOut.offsetHeight);this.WIDTH;var i=this.HEIGHT;"height"===e&&(i=t),this.viewportOutStyle.height=i+"px",this.spinner.style.top=(i-this.toolbarHeight)/2+"px"},Reader.prototype.setSrc=function(e){this.SRC=e},Reader.prototype.setFitWidth=function(e){this.fitWidth=e},Reader.prototype.queueRenderPage=function(e){this.pdfExists=!0,this.pageRendering?this.pageNumPending=e:this.renderPDF(e)},Reader.prototype.loadPDF=function(e){var t=this;this.setSize();var i=this;PDFJS.getDocument(this.SRC).then((function(e){i.PDF=e,i.queueRenderPage(1),i.currentPage=1,i.totalPages.innerHTML=i.PDF.numPages,i.totalPagesNum=i.PDF.numPages,i.currentZoomVal=i.fitZoomVal=i.widthZoomVal=0,i.createDownloadLink()})).catch((function(){t.pdfExists=!1}))},Reader.prototype.renderPages=function(){var e=this;e.viewportOut.innerHTML="",PDFJS.getDocument(this.SRC).then((function(t){e.PDF=t;for(var i=1;i<=e.PDF.numPages;i++)t.getPage(i).then(e.renderPDF(i,null,!0));e.currentPage=1,e.totalPages.innerHTML=e.PDF.numPages,e.totalPagesNum=e.PDF.numPages,e.currentZoomVal||(e.currentZoomVal=e.fitZoomVal=e.widthZoomVal=0),e.createDownloadLink()}))},Reader.prototype.sidebarSetup=function(e){var t=this,i=e.src,r=1,o=0,n=null;function handlePages(a){var h,s=t.container;h=35e-5*(e.sidebarOpen,t.WIDTH);var d=a.getViewport(h),l=document.createElement("div");(a.pageIndex+1).toString(),i.split("/").pop();l.style.backgroundColor="gray";var p=document.querySelector("pdf-element"),u=document.createElement("canvas");l.appendChild(u),s.appendChild(l),t.container.childNodes[a.pageIndex].addEventListener("click",(function(){var t=a.pageIndex+1;p.sideBarClick(t,e.instance,e)}));var c=u.getContext("2d");u.height=d.height,u.width=d.width,a.render({canvasContext:c,viewport:d}),r++,null!==n&&r<=o&&n.getPage(r).then(handlePages)}0!=t.container.innerHTML.length?e.changedSideBar&&(t.container.innerHTML="",PDFJS.getDocument(this.SRC).then((function(e){o=(n=e).numPages;t.container;e.getPage(1).then(handlePages)})),t.setViewportPos(!1)):(t.container.innerHTML="",PDFJS.getDocument(this.SRC).then((function(e){o=(n=e).numPages;t.container;e.getPage(1).then(handlePages)})),t.setViewportPos(!0))},Reader.prototype.renderPDF=function(e,t,i){var r=this;r.pageRendering=!0,r.spinner.active=!0,this.PDF.getPage(e).then((function(o){var n,a,h,s,d,l=Math.abs,p=Math.sin,u=Math.cos;if(d=o.pageInfo.rotate*Math.PI/180,r.pageW=l(o.view[2]*u(d)+o.view[3]*p(d)),r.pageH=l(o.view[3]*u(d)+o.view[2]*p(d)),(0===r.currentZoomVal||t)&&(n=_Mathround(r.WIDTH/r.pageW*100)/100,a=_Mathround((r.HEIGHT-r.toolbarHeight)/r.pageH*100)/100,s=Math.min(a,n),r.fitZoomVal=s,r.widthZoomVal=r.WIDTH/r.pageW,r.currentZoomVal=r.fitWidth?r.widthZoomVal:r.fitZoomVal),t)r.zoomPage({target:r.zoomLvl});else{if(s=r.currentZoomVal,h=o.getViewport(s),r.ctx.height=h.height,r.ctx.width=h.width,r.pageW=r.pageW*s,r.pageH=r.pageH*s,r.WIDTH==r.currentWidth||null==r.currentWidth?r.setViewportPos(!1):r.setViewportPos(!0),r.viewport.width=r.pageW,r.viewport.height=r.pageH,r.viewportStyle.width=r.pageW+"px",r.viewportStyle.height=r.pageH+"px",r.enableTextSelection&&(r.textLayerDivStyle.width=r.pageW+"px",r.textLayerDivStyle.height=r.pageH+"px"),r.ctx.clearRect(0,0,r.viewport.width,r.viewport.height),i){var c=document.createElement("div");c.setAttribute("style","position: relative");var g=document.createElement("canvas"),v=document.createElement("div");v.setAttribute("style","left: "+r.viewportStyle.left),v.className="textLayer";var P=g.getContext("2d");v.height=h.height,v.width=h.width,r.viewportOut.appendChild(c),c.appendChild(g),c.appendChild(v),o.render({canvasContext:P,viewport:h}),r.enableTextSelection&&(r.textLayerDiv.innerHTML="",o.getTextContent().then((function(t){PDFJS.renderTextLayer({textContent:t,container:v,pageIndex:e,viewport:h,textDivs:[]})})))}else{o.render({canvasContext:r.ctx,viewport:h}).promise.then((function(){r.pageRendering=!1,r.spinner.active=!1,null!==r.pageNumPending&&(r.renderPDF(r.pageNumPending),r.pageNumPending=null)}))}r.enableTextSelection&&(r.textLayerDiv.innerHTML="",o.getTextContent().then((function(t){PDFJS.renderTextLayer({textContent:t,container:r.textLayerDiv,pageIndex:e,viewport:h,textDivs:[]})})))}}))},Reader.prototype.setViewportPos=function(e){var t=Math.floor;this.currentWidth=e?.75*this.WIDTH:this.WIDTH,this.pageW<this.currentWidth?this.viewportStyle.left=(this.currentWidth-this.pageW)/2+"px":this.viewportStyle.left=0,this.pageH<this.HEIGHT?(this.viewportStyle.top=(this.HEIGHT-this.pageH-this.toolbarHeight)/2+"px",this.viewportStyle.topNum=t((this.HEIGHT-this.pageH-this.toolbarHeight)/2)+this.toolbarHeight,this.enableTextSelection&&(this.textLayerDivStyle.topNum=t((this.HEIGHT-this.pageH-this.toolbarHeight)/2)+this.toolbarHeight)):this.viewportStyle.top=0,this.enableTextSelection&&(this.textLayerDivStyle.left=this.viewportStyle.left,this.textLayerDivStyle.top=this.viewportStyle.top)},Reader.prototype.changePDFSource=function(e){this.setSrc(e),this.loadPDF(1)},Reader.prototype.zoomInOut=function(e){this.currentZoomVal=_Mathround(10*(_Mathround(10*this.currentZoomVal)/10+e))/10,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomIn=function(){this.currentZoomVal=_Mathround(10*(_Mathround(10*this.currentZoomVal)/10+.1))/10,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomOut=function(){this.currentZoomVal=_Mathround(10*(_Mathround(10*this.currentZoomVal)/10-.1))/10,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomPageFit=function(){this.currentZoomVal=this.fitZoomVal,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomWidthFit=function(){this.currentZoomVal=this.widthZoomVal,this.queueRenderPage(this.currentPage)},Reader.prototype.getPageNum=function(){return this.PDF.numPages},Reader.prototype.createDownloadLink=function(){var e=this;this.PDF.getData().then((function(t){var i=PDFJS.createBlob(t,"application/pdf");e.downloadLink=URL.createObjectURL(i)}))},Reader.prototype.download=function(){var e=document.createElement("a"),t=this.SRC.split("/");e.href=this.downloadLink,e.target="_parent","download"in e&&(e.download=decodeURIComponent(t[t.length-1])),this.reader.appendChild(e),e.click(),e.parentNode.removeChild(e)},window.Reader=Reader;