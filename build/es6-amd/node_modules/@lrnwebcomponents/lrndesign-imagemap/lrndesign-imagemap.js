define(["exports","require","../../@polymer/polymer/polymer-element.js","../../@polymer/polymer/lib/utils/render-status.js","../../@polymer/iron-ajax/iron-ajax.js","../../@polymer/iron-a11y-keys/iron-a11y-keys.js","../simple-modal/simple-modal.js"],(function(e,t,s,l,o,i,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.LrndesignImagemap=void 0,t=babelHelpers.interopRequireWildcard(t);class LrndesignImagemap extends s.PolymerElement{constructor(){super(),new Promise((e,s)=>t.default(["../relative-heading/relative-heading.js"],e,s)),new Promise((e,s)=>t.default(["./lib/lrndesign-imagemap-hotspot.js"],e,s))}static get template(){return s.html`
      <style>
        :host {
          display: block;
        }
        :host #buttons {
          position: absolute;
          left: -999999px;
          top: 0;
          overflow: hidden;
          opacity: 0;
        }
        /*::slotted([hotspot]) {
        display: none;
      }*/
        @media print {
          :host > #svg {
            display: none;
          }
          /*::slotted(#screen-only) {
          display: none;
        }
        ::slotted([hotspot]) {
          display: block;
        }*/
        }
      </style>
      <relative-heading
        hidden\$="[[!label]]"
        id="heading"
        subtopic-of\$="[[subtopicOf]]"
        tag\$="[[tag]]"
        text\$="[[label]]"
      >
      </relative-heading>
      <div id="desc"><slot name="desc"></slot></div>
      <div id="svg"></div>
      <div id="buttons"></div>
      <slot></slot>
      <iron-ajax
        auto=""
        id="get_svg"
        url="[[src]]"
        handle-as="text"
        on-response="_getSVGHandler"
      ></iron-ajax>
    `}static get tag(){return"lrndesign-imagemap"}static get properties(){return{label:{type:String,value:null},src:{type:String,value:null},hotspotDetails:{type:Array,value:[]},subtopicOf:{type:String,value:null,reflectToAttribute:!0},tag:{type:String,value:null,reflectToAttribute:!0}}}connectedCallback(){super.connectedCallback(),window.SimpleModal.requestAvailability(),window.addEventListener("simple-modal-closed",e=>{e.detail.invokedBy===this&&this.closeHotspot()})}disconnectedCallback(){window.removeEventListener("simple-modal-closed",e=>{e.detail.invokedBy===this&&this.closeHotspot()}),super.disconnectedCallback()}_getSVGHandler(e){let t=this,s=document.createElement("div"),getID=function(e,t){return null===e.getAttribute("id")&&e.setAttribute("id",t),e.getAttribute("id")},setAriaLabelledBy=function(e,s,l){let svgElem=function(o){let i="title"===o?"label":o,n=(e=null!==e?e:t).querySelector("#"+i);var a=s.querySelector(o);return null===a&&(a=document.createElement(o),s.prepend(a)),null!==e.getAttribute(i)?a.innerHTML=e.getAttribute(i):null!==n&&""!==n.innerHTML&&(a.innerHTML=n.innerHTML),getID(a,l+"-"+i)};s.setAttribute("aria-labelledby",svgElem("desc")+" "+svgElem("label"))};s.innerHTML=e.detail.response;let l=s.querySelector("svg"),o=getID(l,"svg-"+Date.now()),i=t.querySelectorAll("lrndesign-imagemap-hotspot");setAriaLabelledBy(t,l,o),this.shadowRoot.querySelector("#svg").appendChild(l);for(let n=0;n<i.length;n++){let e=i[n].getAttribute("hotspot-id"),s=l.querySelector("#"+e),o=l.cloneNode(!0);setAriaLabelledBy(i[n],o,e),i[n].appendChild(o),i[n].querySelector("#"+e).classList.add("selected"),i[n].setParentHeading(t.shadowRoot.querySelector("#heading"));for(let t=0;t<i.length;t++)i[n].querySelector("#"+i[t].getAttribute("hotspot-id")).classList.add("hotspot");let a=document.createElement("button");a.setAttribute("tabindex",0),a.setAttribute("aria-label",i[n].label),t.shadowRoot.querySelector("#buttons").appendChild(a),a.addEventListener("focus",(function(){s.classList.add("focus")})),a.addEventListener("blur",(function(){s.classList.remove("focus")})),s.classList.add("hotspot"),s.addEventListener("click",e=>{this.openHotspot(s,i[n])}),a.addEventListener("keyup",e=>{13!==e.keyCode&&32!==e.keyCode||s.classList.contains("selected")||this.openHotspot(s,i[n])})}}openHotspot(e,t){var s=t.shadowRoot.querySelector("#desc").querySelector("slot").assignedNodes({flatten:!0});let l=document.createElement("div");for(var o in s)l.appendChild(s[o].cloneNode(!0));const i=new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!0,detail:{title:t.getAttribute("label"),elements:{content:l},invokedBy:this,clone:!1}});this.dispatchEvent(i),this.__activeHotspot=e,this.resetHotspots(),e.classList.add("selected")}closeHotspot(){this.resetHotspots(),this.__activeHotspot.focus()}resetHotspots(){let e=this.querySelectorAll('.hotspot[role="button"]');for(let t=0;t<e.length;t++)e[t].classList.remove("selected")}}e.LrndesignImagemap=LrndesignImagemap,window.customElements.define(LrndesignImagemap.tag,LrndesignImagemap)}));