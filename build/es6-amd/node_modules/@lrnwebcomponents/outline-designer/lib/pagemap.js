define(["exports"],(function(e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.pagemap=void 0;const t=window.document.documentElement,o=window.document,r=o.querySelector("body"),Rect=(e,t,o,r)=>Object.assign(Object.create(Rect.prototype),{x:e,y:t,w:o,h:r});Rect.prototype={constructor:Rect,relativeTo(e={x:0,y:0}){return Rect(this.x-e.x,this.y-e.y,this.w,this.h)}},Rect.ofDocument=()=>Rect(0,0,t.scrollWidth,t.scrollHeight),Rect.ofWindow=()=>Rect(window.pageXOffset,window.pageYOffset,t.clientWidth,t.clientHeight);const getOffset=e=>{const t=e.getBoundingClientRect();return{x:t.left+window.pageXOffset,y:t.top+window.pageYOffset,width:t.width,height:t.height}};Rect.ofElement=e=>{const{x:t,y:o,width:r,height:i}=getOffset(e);return Rect(t,o,r,i)},Rect.ofViewport=e=>{const{x:t,y:o}=getOffset(e);return Rect(t+e.clientLeft,o+e.clientTop,e.clientWidth,e.clientHeight)},Rect.ofContent=e=>{const{x:t,y:o}=getOffset(e);return Rect(t+e.clientLeft-e.scrollLeft,o+e.clientTop-e.scrollTop,e.scrollWidth,e.scrollHeight)};const black=e=>`rgba(0,0,0,${e/100})`,i={viewport:null,styles:{"header,footer,section,article":black(8),"h1,a":black(10),"h2,h3,h4":black(8)},back:black(2),view:black(5),drag:black(10),interval:null},_listener=(e,t,o,r)=>o.split(/\s+/).forEach(o=>e[t](o,r)),on=(e,t,o)=>_listener(e,"addEventListener",t,o),off=(e,t,o)=>_listener(e,"removeEventListener",t,o);e.pagemap=(e,t)=>{const n=Object.assign({},i,t),s=e.getContext("2d"),l=(()=>{const t=e.clientWidth,o=e.clientHeight;return(e,r)=>Math.min(t/e,o/r)})(),c=n.viewport;let h,a,w,d,f,p=!1;const drawRect=(e,t)=>{t&&(s.beginPath(),s.rect(e.x,e.y,e.w,e.h),s.fillStyle=t,s.fill())},applyStyles=e=>{Object.keys(e).forEach(t=>{const r=e[t];(e=>Array.from((c||o).querySelectorAll(e)))(t).forEach(e=>{drawRect(Rect.ofElement(e).relativeTo(h),r)})})},draw=()=>{var t,o;h=c?Rect.ofContent(c):Rect.ofDocument(),a=c?Rect.ofViewport(c):Rect.ofWindow(),w=l(h.w,h.h),t=h.w*w,o=h.h*w,e.width=t,e.height=o,e.style.width=`${t}px`,e.style.height=`${o}px`,s.setTransform(1,0,0,1,0,0),s.clearRect(0,0,e.width,e.height),s.scale(w,w),drawRect(h.relativeTo(h),n.back),applyStyles(n.styles),drawRect(a.relativeTo(h),p?n.drag:n.view)},onDrag=t=>{t.preventDefault();const o=Rect.ofViewport(e),r=(t.pageX-o.x)/w-a.w*d,i=(t.pageY-o.y)/w-a.h*f;c?(c.scrollLeft=r,c.scrollTop=i):window.scrollTo(r,i),draw()},onDragEnd=t=>{p=!1,e.style.cursor="pointer",r.style.cursor="auto",off(window,"mousemove",onDrag),off(window,"mouseup",onDragEnd),onDrag(t)},onDragStart=t=>{p=!0;const o=Rect.ofViewport(e),i=a.relativeTo(h);d=((t.pageX-o.x)/w-i.x)/i.w,f=((t.pageY-o.y)/w-i.y)/i.h,(d<0||d>1||f<0||f>1)&&(d=.5,f=.5),e.style.cursor="crosshair",r.style.cursor="crosshair",on(window,"mousemove",onDrag),on(window,"mouseup",onDragEnd),onDrag(t)};return e.style.cursor="pointer",on(e,"mousedown",onDragStart),on(c||window,"load resize scroll",draw),n.interval>0&&setInterval(()=>draw(),n.interval),draw(),{redraw:draw}}}));