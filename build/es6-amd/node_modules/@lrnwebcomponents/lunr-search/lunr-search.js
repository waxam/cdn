define(["exports","meta","../../@polymer/polymer/polymer-element.js","../../@polymer/polymer/lib/utils/resolve-url.js","../es-global-bridge/es-global-bridge.js","../../@polymer/iron-ajax/iron-ajax.js"],function(_exports,meta,_polymerElement,_resolveUrl,_esGlobalBridge,_ironAjax){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.LunrSearch=void 0,meta=babelHelpers.interopRequireWildcard(meta);class LunrSearch extends _polymerElement.PolymerElement{static get template(){return _polymerElement.html`
      <style>
        :host {
          display: block;
        }

        :host([hidden]) {
          display: none;
        }
      </style>
      <iron-ajax
        auto
        url="[[dataSource]]"
        method="[[method]]"
        handle-as="json"
        on-response="_dataResponse"
      ></iron-ajax>
    `}static get properties(){return{dataSource:{name:"dataSource",type:"String"},data:{name:"data",type:"Array",notify:!0},method:{name:"method",type:"String",value:"GET"},search:{type:"String",notify:!0},results:{type:"Array",computed:"searched(data, search, index, minScore, limit)",notify:!0},noStopWords:{type:"Boolean",value:!1,notify:!0},fields:{type:"Array",value:[]},indexNoStopWords:{type:"Object"},index:{type:"Object",computed:"_createIndex(data, fields, noStopWords, __lunrLoaded)"},__lunrLoaded:{type:"Boolean"},limit:{type:"Number",value:500},minScore:{type:"Number",value:0},log:{type:"Boolean",value:!1}}}constructor(){super();const location=`${(0,_resolveUrl.pathFromUrl)(meta.url)}../../lunr/lunr.js`;window.addEventListener("es-bridge-lunr-loaded",this._lunrLoaded.bind(this)),window.ESGlobalBridge.requestAvailability(),window.ESGlobalBridge.instance.load("lunr",location),window.ESGlobalBridge.imports&&window.ESGlobalBridge.imports.lunr&&(this.__lunrLoaded=!0)}disconnectedCallback(){window.removeEventListener("es-bridge-lunr-loaded",this._lunrLoaded.bind(this)),super.disconnectedCallback()}_lunrLoaded(e){this.__lunrLoaded=!0}static get tag(){return"lunr-search"}_dataResponse(e){this.set("data",e.detail.response),this.notifyPath("data.*")}searched(data,search,index,minScore,limit){if(data&&index&&search){var results=[];if(""+search!="")for(var searched=index.search(search),i=0;i<searched.length&&!(i===limit||searched[i].score<minScore);i++){let tmpItem=data.find(j=>j.id==searched[i].ref);results.push(tmpItem)}if(0===results.length&&!this.noStopWords&&""+search!=""){this.indexNoStopWords||(this.indexNoStopWords=this._createIndex(data,this.fields,!0,index)),searched=this.indexNoStopWords.search(search);for(results=[],i=0;i<searched.length&&!(i===limit||searched[i].score<minScore);i++){let tmpItem=data.find(j=>j.id==searched[i].ref);results.push(tmpItem)}}return results}}_createIndex(data,fields,noStopWords,ready){if(ready){let root=this;if(Array.isArray(data)&&data.length>0){if(Array.isArray(fields)&&fields.length>0)return lunr(function(){for(var i=0;i<fields.length;i++)fields[i].charAt(0)===fields[i].charAt(0).toUpperCase()?this.field(fields[i],{boost:10}):this.field(fields[i]);for(i=0;i<data.length;i++){for(var toIndex={id:i},f=0;f<fields.length;f++)data[i].hasOwnProperty(fields[f])&&null!==data[i][fields[f]]&&"function"==typeof data[i][fields[f]].toString&&(data[i][fields[f]].toString().split(" ").length>2||data[i][fields[f]].toString().length<30)?toIndex[fields[f]]=data[i][fields[f]].toString():toIndex[fields[f]]="";this.add(toIndex)}noStopWords&&this.pipeline.remove(lunr.stopWordFilter)});fields=[];var ddup={};return lunr(function(){for(var indexOfData=0;indexOfData<data.length;indexOfData++)for(var prop in data[indexOfData])"_"!==prop.charAt(0)&&!ddup.hasOwnProperty(prop)&&(prop.toString().split(" ").length>2||prop.toString().length<30)&&(fields.push(prop),prop.charAt(0)===prop.charAt(0).toUpperCase()?this.field(prop,{boost:10}):this.field(prop),ddup[prop]=1);fields.length>0&&(root.fields=fields);for(var i=0;i<data.length;i++){for(var toIndex={id:i},f=0;f<fields.length;f++)data[i].hasOwnProperty(fields[f])&&null!==data[i][fields[f]]&&"function"==typeof data[i][fields[f]].toString&&(data[i][fields[f]].toString().split(" ").length>2||data[i][fields[f]].toString().length<30)?toIndex[fields[f]]=data[i][fields[f]].toString():toIndex[fields[f]]="";this.add(toIndex)}noStopWords&&this.pipeline.remove(lunr.stopWordFilter)})}}}}_exports.LunrSearch=LunrSearch,window.customElements.define(LunrSearch.tag,LunrSearch)});