var H5PLibraryDetails=H5PLibraryDetails||{};!function(e){H5PLibraryDetails.PAGER_SIZE=20,H5PLibraryDetails.init=function(){H5PLibraryDetails.$adminContainer=H5P.jQuery(H5PAdminIntegration.containerSelector),H5PLibraryDetails.library=H5PAdminIntegration.libraryInfo,H5PLibraryDetails.currentContent=H5PLibraryDetails.library.content,H5PLibraryDetails.currentPage=0,H5PLibraryDetails.currentFilter="",H5PLibraryDetails.filterCache=[],H5PLibraryDetails.$adminContainer.append(H5PLibraryDetails.createLibraryInfo()),H5PLibraryDetails.$adminContainer.append(H5PLibraryDetails.createContentElement())},H5PLibraryDetails.createLibraryInfo=function(){var a=e('<div class="h5p-library-info"></div>');return e.each(H5PLibraryDetails.library.info,(function(e,r){a.append(H5PUtils.createLabeledField(e,r))})),a},H5PLibraryDetails.createContentElement=function(){return void 0!==H5PLibraryDetails.library.notCached?H5PUtils.getRebuildCache(H5PLibraryDetails.library.notCached):void 0!==H5PLibraryDetails.currentContent?(H5PLibraryDetails.$content=e('<div class="h5p-content"><h3>'+H5PLibraryDetails.library.translations.contentHeader+"</h3></div>"),H5PLibraryDetails.createSearchElement(),H5PLibraryDetails.createPageSizeSelector(),H5PLibraryDetails.createContentTable(),H5PLibraryDetails.createPagerElement(),H5PLibraryDetails.$content):void(H5PLibraryDetails.$content=e('<div class="h5p-content empty">'+H5PLibraryDetails.library.translations.noContent+"</div>"))},H5PLibraryDetails.createContentTable=function(){H5PLibraryDetails.$contentTable&&H5PLibraryDetails.$contentTable.remove(),H5PLibraryDetails.$contentTable=H5PUtils.createTable();var e=H5PLibraryDetails.currentPage*H5PLibraryDetails.PAGER_SIZE,a=e+H5PLibraryDetails.PAGER_SIZE;for(a>H5PLibraryDetails.currentContent.length&&(a=H5PLibraryDetails.currentContent.length);e<a;e++){var r=H5PLibraryDetails.currentContent[e];H5PLibraryDetails.$contentTable.append(H5PUtils.createTableRow(['<a href="'+r.url+'">'+r.title+"</a>"]))}H5PLibraryDetails.$contentTable.insertAfter(H5PLibraryDetails.$search)},H5PLibraryDetails.createPagerElement=function(){H5PLibraryDetails.$previous=e('<button type="button" class="previous h5p-admin"><</button>'),H5PLibraryDetails.$next=e('<button type="button" class="next h5p-admin">></button>'),H5PLibraryDetails.$previous.on("click",(function(){H5PLibraryDetails.$previous.hasClass("disabled")||(H5PLibraryDetails.currentPage--,H5PLibraryDetails.updatePager(),H5PLibraryDetails.createContentTable())})),H5PLibraryDetails.$next.on("click",(function(){H5PLibraryDetails.$next.hasClass("disabled")||(H5PLibraryDetails.currentPage++,H5PLibraryDetails.updatePager(),H5PLibraryDetails.createContentTable())})),H5PLibraryDetails.$pagerInfo=e('<span class="pager-info"></span>'),H5PLibraryDetails.$pager=e('<div class="h5p-content-pager"></div>').append(H5PLibraryDetails.$previous,H5PLibraryDetails.$pagerInfo,H5PLibraryDetails.$next),H5PLibraryDetails.$content.append(H5PLibraryDetails.$pager),H5PLibraryDetails.$pagerInfo.on("click",(function(){var a=H5PLibraryDetails.$pagerInfo.innerWidth();H5PLibraryDetails.$pagerInfo.hide();var pageNumerUpdated=function(){var e=r.val()-1;t.remove(),H5PLibraryDetails.$pagerInfo.css({display:"inline-block"}),/^\d+$/.test(e)&&e>=0&&e<H5PLibraryDetails.getNumPages()&&e!=H5PLibraryDetails.currentPage&&(H5PLibraryDetails.currentPage=e,H5PLibraryDetails.updatePager(),H5PLibraryDetails.createContentTable())},r=e("<input/>",{type:"number",min:1,max:H5PLibraryDetails.getNumPages(),on:{blur:pageNumerUpdated,keyup:function(e){13===e.keyCode&&pageNumerUpdated()}}}).css({width:a}),t=e("<span/>",{class:"h5p-pager-goto"}).css({width:a}).append(r).insertAfter(H5PLibraryDetails.$pagerInfo);r.focus()})),H5PLibraryDetails.updatePager()},H5PLibraryDetails.getNumPages=function(){return Math.ceil(H5PLibraryDetails.currentContent.length/H5PLibraryDetails.PAGER_SIZE)},H5PLibraryDetails.updatePager=function(){if(H5PLibraryDetails.$pagerInfo.css({display:"inline-block"}),H5PLibraryDetails.getNumPages()>0){var e=H5PUtils.translateReplace(H5PLibraryDetails.library.translations.pageXOfY,{$x:H5PLibraryDetails.currentPage+1,$y:H5PLibraryDetails.getNumPages()});H5PLibraryDetails.$pagerInfo.html(e)}else H5PLibraryDetails.$pagerInfo.html("");H5PLibraryDetails.$previous.toggleClass("disabled",H5PLibraryDetails.currentPage<=0),H5PLibraryDetails.$next.toggleClass("disabled",H5PLibraryDetails.currentContent.length<(H5PLibraryDetails.currentPage+1)*H5PLibraryDetails.PAGER_SIZE)},H5PLibraryDetails.createSearchElement=function(){H5PLibraryDetails.$search=e('<div class="h5p-content-search"><input placeholder="'+H5PLibraryDetails.library.translations.filterPlaceholder+'" type="search"></div>');var a;e("input",H5PLibraryDetails.$search).on("change keypress paste input",(function(){a&&clearTimeout(a),a=setTimeout((function(){!function(){var a=e(".h5p-content-search > input").val();if(H5PLibraryDetails.currentFilter!==a){if(0===a.trim().length)H5PLibraryDetails.currentContent=H5PLibraryDetails.library.content;else if(H5PLibraryDetails.filterCache[a])H5PLibraryDetails.currentContent=H5PLibraryDetails.filterCache[a];else{var r=H5PLibraryDetails.library.content;a.length>1&&H5PLibraryDetails.currentFilter===a.substr(0,H5PLibraryDetails.currentFilter.length)&&(r=H5PLibraryDetails.currentContent),H5PLibraryDetails.currentContent=e.grep(r,(function(e){return e.title&&e.title.match(new RegExp(a,"i"))}))}H5PLibraryDetails.currentFilter=a,H5PLibraryDetails.filterCache[a]=H5PLibraryDetails.currentContent,H5PLibraryDetails.currentPage=0,H5PLibraryDetails.createContentTable(),H5PLibraryDetails.$searchResults&&H5PLibraryDetails.$searchResults.remove(),a.trim().length>0&&(H5PLibraryDetails.$searchResults=e('<span class="h5p-admin-search-results">'+H5PLibraryDetails.currentContent.length+" hits on "+H5PLibraryDetails.currentFilter+"</span>"),H5PLibraryDetails.$search.append(H5PLibraryDetails.$searchResults)),H5PLibraryDetails.updatePager()}}()}),500)})),H5PLibraryDetails.$content.append(H5PLibraryDetails.$search)},H5PLibraryDetails.createPageSizeSelector=function(){H5PLibraryDetails.$search.append('<div class="h5p-admin-pager-size-selector">'+H5PLibraryDetails.library.translations.pageSizeSelectorLabel+':<span data-page-size="10">10</span><span class="selected" data-page-size="20">20</span><span data-page-size="50">50</span><span data-page-size="100">100</span><span data-page-size="200">200</span></div>'),e(".h5p-admin-pager-size-selector > span",H5PLibraryDetails.$search).on("click",(function(){H5PLibraryDetails.PAGER_SIZE=e(this).data("page-size"),e(".h5p-admin-pager-size-selector > span",H5PLibraryDetails.$search).removeClass("selected"),e(this).addClass("selected"),H5PLibraryDetails.currentPage=0,H5PLibraryDetails.createContentTable(),H5PLibraryDetails.updatePager()}))},e(document).ready((function(){H5PLibraryDetails.initialized||(H5PLibraryDetails.initialized=!0,H5PLibraryDetails.init())}))}(H5P.jQuery);