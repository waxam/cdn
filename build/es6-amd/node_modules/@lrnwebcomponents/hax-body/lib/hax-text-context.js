define(["exports","require","../../../lit-element/lit-element.js","../../utils/utils.js"],(function(_exports,_require,_litElement,_utils){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.HaxTextContext=void 0,_require=babelHelpers.interopRequireWildcard(_require);class HaxTextContext extends((0,_utils.winEventsElement)(_litElement.LitElement)){static get styles(){return[_litElement.css`:host{display:block;pointer-events:none}:host [hidden]{display:none}.selected-buttons{transition:.1s all ease-in-out;width:0}:host([has-selected-text]) .selected-buttons{width:100%}#toolbar{overflow:hidden}paper-item{color:#fff;background-color:var(--hax-contextual-action-color);-webkit-justify-content:flex-start;justify-content:flex-start;font-size:11px;line-height:24px;margin:0;padding:0 4px;min-height:24px}paper-item:hover{cursor:pointer;color:#000}iron-icon{width:20px;height:20px;padding:4px}paper-item strong{padding:4px}hax-context-item,hax-context-item-textop{transition:all .2s linear;visibility:visible;opacity:1}hax-context-item-textop[hidden],hax-context-item[hidden]{visibility:hidden;opacity:0}:host(.hax-context-pin-top) hax-toolbar{position:fixed;top:40px;flex-direction:column}`]}constructor(){super(),this.__winEvents={"hax-store-property-updated":"_haxStorePropertyUpdated"},new Promise((res,rej)=>_require.default(["../../../@polymer/paper-item/paper-item.js"],res,rej)),new Promise((res,rej)=>_require.default(["../../../@polymer/iron-icon/iron-icon.js"],res,rej)),new Promise((res,rej)=>_require.default(["./hax-context-item-menu.js"],res,rej)),new Promise((res,rej)=>_require.default(["./hax-context-item.js"],res,rej)),new Promise((res,rej)=>_require.default(["./hax-context-item-textop.js"],res,rej)),new Promise((res,rej)=>_require.default(["./hax-toolbar.js"],res,rej)),setTimeout(()=>{this.addEventListener("hax-context-item-selected",this._haxContextOperation.bind(this))},0),this.realSelectedValue="p",this.selection=!1,this.formatIcon="hax:format-textblock",this.isSafari=this._isSafari()}_haxStorePropertyUpdated(e){e.detail&&void 0!==e.detail.value&&e.detail.property&&(this[e.detail.property]=e.detail.value)}render(){return _litElement.html`<hax-toolbar .selected=${this.selection} ?hide-more=${!this.hasSelectedText} id=toolbar><hax-context-item-menu action mini slot=primary .selected-value=${this.selectedValue} @selected-value-changed=${this.selectedValueChanged} id=formatsize icon=${this.formatIcon} label="Text format" event-name=text-tag><paper-item value=p><iron-icon icon=hax:paragraph></iron-icon>Paragraph</paper-item><paper-item value=ul><iron-icon icon=editor:format-list-bulleted></iron-icon>Bulleted list</paper-item><paper-item value=ol><iron-icon icon=editor:format-list-numbered></iron-icon>Numbered list</paper-item><paper-item value=h2><iron-icon icon=hax:h2></iron-icon>Title</paper-item><paper-item value=h3><iron-icon icon=hax:h3></iron-icon>Content heading</paper-item><paper-item value=h4><iron-icon icon=hax:h4></iron-icon>Subheading</paper-item><paper-item value=h5><iron-icon icon=hax:h5></iron-icon>Deep subheading</paper-item><paper-item value=blockquote><iron-icon icon=editor:format-quote></iron-icon>Blockquote</paper-item><paper-item value=code><iron-icon icon=icons:code></iron-icon>Code</paper-item></hax-context-item-menu><hax-context-item-textop mini action slot=primary icon=editor:format-list-bulleted event-name=text-tag-ul label="Bulleted list" .hidden=${!this._showLists}></hax-context-item-textop><hax-context-item-textop mini action slot=primary icon=editor:format-list-numbered label="Numbered list" event-name=text-tag-ol .hidden=${!this._showLists}></hax-context-item-textop><hax-context-item-textop mini action slot=primary icon=editor:format-indent-decrease label=Outdent event-name=text-outdent .hidden=${!this._showIndent}></hax-context-item-textop><hax-context-item-textop mini action slot=primary icon=editor:format-indent-increase label=Indent event-name=text-indent .hidden=${!this._showIndent}></hax-context-item-textop><hax-context-item-textop mini action slot=primary icon=editor:format-bold label=Bold class=selected-buttons event-name=text-bold ?disabled=${!this.hasSelectedText}></hax-context-item-textop><hax-context-item-textop mini action slot=primary icon=editor:format-italic label=Italic class=selected-buttons event-name=text-italic ?disabled=${!this.hasSelectedText}></hax-context-item-textop><hax-context-item-textop mini action slot=primary icon=editor:insert-link label=Link class=selected-buttons event-name=text-link ?disabled=${!this.hasSelectedText}></hax-context-item-textop><hax-context-item-textop mini action slot=primary icon=mdextra:unlink label="Remove link" class=selected-buttons event-name=text-unlink ?disabled=${!this.hasSelectedText}></hax-context-item-textop><hax-context-item-textop mini action slot=primary icon=editor:format-clear label="Remove format" class=selected-buttons event-name=text-remove-format ?disabled=${!this.hasSelectedText}></hax-context-item-textop><hax-context-item mini action slot=primary icon=hax:add-brick label="Add element to selection" class=selected-buttons event-name=insert-inline-gizmo ?hidden=${this.isSafari||!this.hasSelectedText}></hax-context-item><hax-context-item-textop mini action slot=primary icon=hax:add-brick label="Add element to selection" class=selected-buttons event-name=insert-inline-gizmo ?hidden=${!this.isSafari||!this.hasSelectedText}></hax-context-item-textop><hax-context-item-textop action menu slot=more icon=mdextra:subscript event-name=text-subscript>Subscript</hax-context-item-textop><hax-context-item-textop action menu slot=more icon=mdextra:superscript event-name=text-superscript>Superscript</hax-context-item-textop><hax-context-item-textop action menu slot=more icon=editor:format-underlined event-name=text-underline>Underline</hax-context-item-textop><hax-context-item-textop action menu slot=more icon=editor:format-strikethrough event-name=text-strikethrough>Cross out</hax-context-item-textop></hax-toolbar>`}selectedValueChanged(e){this.selectedValue=e.detail}static get tag(){return"hax-text-context"}static get properties(){return{_showIndent:{type:Boolean},_showLists:{type:Boolean},realSelectedValue:{type:String},hasSelectedText:{type:Boolean,attribute:"has-selected-text",reflect:!0},haxSelectedText:{type:String},selectedValue:{type:Number,attribute:"selected-value"},selection:{type:Boolean},formatIcon:{type:String,attribute:"format-icon"},isSafari:{type:Boolean,attribute:"is-safari"}}}updated(changedProperties){changedProperties.forEach((oldValue,propName)=>{if(this.realSelectedValue&&"realSelectedValue"==propName&&this.shadowRoot)for(var i in this._showIndent=this._computeShowIndent(this.realSelectedValue),this._showIndent||"p"==this.realSelectedValue?this._showLists=!0:this._showLists=!1,this.shadowRoot.querySelector("#formatsize").children)this.shadowRoot.querySelector("#formatsize").children[i]&&this.shadowRoot.querySelector("#formatsize").children[i].getAttribute&&this.shadowRoot.querySelector("#formatsize").children[i].getAttribute("value")==this.realSelectedValue&&(this.selectedValue=i);"haxSelectedText"==propName&&(this.hasSelectedText=this[propName].length>0),"selectedValue"==propName&&(this.realSelectedValue=this.shadowRoot.querySelector("#formatsize").children[this.selectedValue].getAttribute("value"),this.formatIcon=this.shadowRoot.querySelector("#formatsize").children[this[propName]].querySelector("iron-icon").icon,this.dispatchEvent(new CustomEvent("selected-value-changed",{detail:this[propName]})))})}_computeShowIndent(realSelectedValue){return!(!window.HaxStore.instance.computePolyfillSafe()||"ol"!=realSelectedValue&&"ul"!=realSelectedValue)}_haxContextOperation(e){let detail=e.detail,selection=window.HaxStore.getSelection(),prevent=!1;switch(detail.eventName){case"close-menu":setTimeout(()=>{this.shadowRoot.querySelector("#formatsize").shadowRoot.querySelector("#menu").hideMenu()},200);break;case"insert-inline-gizmo":if(window.HaxStore._tmpSelection&&window.HaxStore.instance.editMode)try{"HAX-BODY"!==window.HaxStore._tmpRange.startContainer.parentNode.parentNode.tagName&&"HAX-BODY"!==window.HaxStore._tmpRange.startContainer.parentNode.parentNode.parentNode.tagName||(window.HaxStore.instance.activePlaceHolder=window.HaxStore._tmpRange,window.HaxStore.write("activePlaceHolder",window.HaxStore._tmpRange,this))}catch(err){}if(null!=window.HaxStore.instance.activePlaceHolder){let values={text:window.HaxStore.instance.activePlaceHolder.toString()},type="inline",haxElements=window.HaxStore.guessGizmo(type,values);haxElements.length>0&&window.HaxStore.instance.haxAppPicker.presentOptions(haxElements,type,"Transform selected text to..","gizmo")}break;case"text-bold":document.execCommand("bold"),prevent=!0;break;case"text-italic":document.execCommand("italic"),prevent=!0;break;case"text-underline":document.execCommand("underline"),prevent=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-subscript":document.execCommand("subscript"),prevent=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-superscript":document.execCommand("superscript"),prevent=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-remove-format":document.execCommand("removeFormat"),prevent=!0;break;case"text-strikethrough":document.execCommand("strikeThrough"),prevent=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-link":var href="";selection&&selection.focusNode&&selection.focusNode.parentNode&&void 0!==selection.focusNode.parentNode.href&&(href=selection.focusNode.parentNode.href);let url=prompt("Enter a URL:",href);url&&(document.execCommand("createLink",!1,url),selection.focusNode.parentNode&&(selection.focusNode.parentNode.setAttribute("contenteditable",!0),selection.focusNode.parentNode.setAttribute("data-editable",!0),selection.focusNode.parentNode.removeEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),selection.focusNode.parentNode.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()})),prevent=!0);break;case"text-unlink":document.execCommand("unlink"),prevent=!0;break;case"text-indent":document.execCommand("indent"),prevent=!0;break;case"text-outdent":document.execCommand("outdent"),prevent=!0}prevent&&(e.preventDefault(),e.stopPropagation())}_isSafari(){let ua=navigator.userAgent.toLowerCase();return!(-1==ua.indexOf("safari")||ua.indexOf("chrome")>-1)}}_exports.HaxTextContext=HaxTextContext,window.customElements.define(HaxTextContext.tag,HaxTextContext)}));