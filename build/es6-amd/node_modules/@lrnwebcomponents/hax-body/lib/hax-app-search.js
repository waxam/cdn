define(["exports","require","../../../lit-element/lit-element.js","../../simple-colors/simple-colors.js","../../../@polymer/iron-ajax/iron-ajax.js","../../utils/utils.js"],(function(e,t,i,a,s,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HaxAppSearch=void 0,t=babelHelpers.interopRequireWildcard(t);class HaxAppSearch extends((0,o.winEventsElement)(a.SimpleColors)){static get styles(){return[...super.styles,i.css`
        :host {
          display: block;
        }
        hexagon-loader {
          display: none;
          justify-content: center;
          width: 100%;
          z-index: 1000;
          position: absolute;
          --hexagon-color: var(--hax-color-bg-accent, #0085ba);
        }
        hexagon-loader[loading] {
          display: block;
          opacity: 0.8;
        }
        .card-content {
          padding: 16px;
        }
        .card-content p {
          padding: 0;
          margin: 0;
        }
        #itemlist {
          min-height: 172px;
          border: 1px solid #222222;
        }
        hax-app-search-inputs {
          min-height: 80px;
          padding: 0 16px;
        }
        hax-app-pagination {
          min-height: 32px;
          font-size: 12.8px;
          display: none;
          justify-content: flex-end;
          justify-content: center;
        }
      `]}constructor(){super(),this.__winEvents={"hax-store-property-updated":"_haxStorePropertyUpdated"},this.auto=!1,this.headers={},this.method="GET",this.loading=!1,this.requestData={},this.media=[],this.resultMap={},new Promise((e,i)=>t.default(["../../simple-fields/lib/simple-fields-field.js"],e,i)),new Promise((e,i)=>t.default(["../../dropdown-select/dropdown-select.js"],e,i)),new Promise((e,i)=>t.default(["../../hexagon-loader/hexagon-loader.js"],e,i)),new Promise((e,i)=>t.default(["./hax-app-search-inputs.js"],e,i)),new Promise((e,i)=>t.default(["./hax-app-search-result.js"],e,i))}render(){return i.html`
      <iron-ajax
        id="request"
        handle-as="json"
        @last-response-changed="${this.requestDataChanged}"
        @loading-changed="${this._loadingChanged}"
        debounce-duration="200"
      ></iron-ajax>
      <hax-app-search-inputs
        id="searchinput"
        .label="${this.label}"
        .schema="${this.searchSchema}"
        @search-values-changed="${this._searchValuesChanged}"
      ></hax-app-search-inputs>
      <hax-app-pagination
        id="pagerbottom"
        .request-data="${this.requestData}"
        .pagination="${this.pagination}"
      ></hax-app-pagination>
      <hexagon-loader
        size="medium"
        item-count="4"
        ?loading="${this.loading}"
        aria-roledescription="Loading"
      ></hexagon-loader>
      <div id="itemlist">
        ${this.media.map(e=>i.html`
            <hax-app-search-result
              image="${e.image}"
              title="${e.title}"
              details="${e.details}"
              .map="${e.map}"
              type="${e.type}"
            ></hax-app-search-result>
          `)}
      </div>
    `}requestDataChanged(e){this.requestData=e.detail.value}updated(e){e.forEach((e,t)=>{["auto","method","headers"].includes(t)&&(this.shadowRoot.querySelector("#request")[t]=this[t]),"requestEndPoint"==t&&(this.shadowRoot.querySelector("#request").url=this[t]),"requestParams"==t&&(this.shadowRoot.querySelector("#request").params=this[t]),"activeApp"==t&&this._resetAppSearch(this[t],e),"requestData"==t&&this._requestDataChanged(this[t],e)})}static get tag(){return"hax-app-search"}static get properties(){return{activeApp:{type:Object},auto:{type:Boolean},searchSchema:{type:Object},headers:{type:Object},method:{type:String},loading:{type:Boolean},requestData:{type:Object},media:{type:Array},requestEndPoint:{type:String},requestParams:{type:Object},resultMap:{type:Object}}}_searchValuesChanged(e){let t=this.requestParams;for(let i in e.detail)""!=e.detail[i]&&(t[i]=e.detail[i]);this.requestParams={...this.requestParams}}_resetAppSearch(e,t){if(null!=e){let t=e;var i={};this.label=t.details.title,this.auto=!1,this.media=[],void 0!==t.connection.data&&(i=t.connection.data),void 0!==t.connection.operations.browse.data&&(i=Object.assign(i,t.connection.operations.browse.data)),this.method=t.connection.operations.browse.method,this.headers={},void 0!==t.connection.headers&&(this.headers=t.connection.headers),this.requestParams={},this.requestParams=i;var a=t.connection.protocol+"://"+t.connection.url;"/"!=a.substr(a.length-1)&&(a+="/"),void 0!==t.connection.operations.browse.endPoint&&(a+=t.connection.operations.browse.endPoint),this.requestEndPoint=a,this.searchSchema={};var s={properties:{}};void 0!==t.connection.operations.browse.search&&(s.properties=t.connection.operations.browse.search,this.searchSchema=s),this.resultMap=t.connection.operations.browse.resultMap,this.pagination={},void 0!==t.connection.operations.browse.pagination&&(this.pagination=t.connection.operations.browse.pagination),void 0!==t.connection.auto?this.auto=t.connection.auto:this.auto=!0}}_haxStorePropertyUpdated(e){e.detail&&void 0!==e.detail.value&&e.detail.property&&(this[e.detail.property]=e.detail.value)}_requestDataChanged(e,t){if(this.resultMap&&this.resultMap.items&&typeof e!={}&&void 0!==t){let t=[],s=this.resultMap,o=[];if(void 0!==this._resolveObjectPath(s.items,e)?o=this._resolveObjectPath(s.items,e):null!=e&&(o=e),null!=o){for(var i=0;i<o.length;i++){if(t[i]={title:this._resolveObjectPath(s.preview.title,o[i]),details:this._resolveObjectPath(s.preview.details,o[i]),type:s.defaultGizmoType,map:{}},void 0!==t[i].details&&null!=t[i].details&&(t[i].details=t[i].details.replace(/(<([^>]+)>)/gi,"")),s.preview.id.constructor===Object){let e=this._resolveObjectPath(s.preview.id.property,o[i]);"split"===s.preview.id.op&&(e=e.split(s.preview.id.delimiter),t[i].id=e[s.preview.id.position])}else t[i].id=this._resolveObjectPath(s.preview.id,o[i]);for(var a in void 0!==s.preview.image?t[i].image=this._resolveObjectPath(s.preview.image,o[i]):void 0!==s.image?t[i].image=s.image:t[i].image="",s.gizmo)if("_url_source"===a){let e="";e=void 0!==t[i].map.__id?t[i].map.__id:this._resolveObjectPath(s.gizmo.id,o[i]),t[i].map.source=s.gizmo._url_source.replace("<%= id %>",e)}else if(s.gizmo[a].constructor===Object){let e=this._resolveObjectPath(s.gizmo[a].property,o[i]);"split"===s.gizmo[a].op&&(e=e.split(s.gizmo[a].delimiter),t[i].map[a]=e[s.gizmo[a].position],"id"===a&&(t[i].map.__id=t[i].map[a]))}else t[i].map[a]=this._resolveObjectPath(s.gizmo[a],o[i]);void 0===t[i].map.url&&void 0!==t[i].map.source&&(t[i].map.url=t[i].map.source),void 0!==s.gizmo.type&&(t[i].type=this._resolveObjectPath(s.gizmo.type,o[i]))}this.media=[...t]}}}_loadingChanged(e){this.loading=e.detail.value}_resolveObjectPath(e,t){return e.split(".").reduce((function(e,t){return e?e[t]:null}),t||self)}}e.HaxAppSearch=HaxAppSearch,window.customElements.define(HaxAppSearch.tag,HaxAppSearch)}));