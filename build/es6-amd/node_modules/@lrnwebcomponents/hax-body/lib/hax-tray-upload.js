define(["exports","require","../../../lit-element/lit-element.js","../../utils/utils.js","../../../@polymer/polymer/lib/elements/custom-style.js"],(function(_exports,_require,_litElement,_utils,_customStyle){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.HaxTrayUpload=void 0,_require=babelHelpers.interopRequireWildcard(_require);class HaxTrayUpload extends((0,_utils.winEventsElement)(_litElement.LitElement)){static get styles(){return[_litElement.css`vaadin-upload{--lumo-primary-color:var(
            --hax-color-accent1,
            --simple-colors-default-theme-light-blue-7
          );--lumo-primary-font-color:black;--lumo-dark-primary-color:black;--lumo-light-primary-color:var(
            --hax-color-accent1,
            --simple-colors-default-theme-light-blue-7
          );--lumo-error-color:darkred;color:#fff;display:block;padding:16px!important}vaadin-upload[dragover]{border-color:var(--simple-colors-default-theme-green-3)}vaadin-upload-file{--disabled-text-color:#222222}.add-area-content-wrapper{padding:0 4px}.add-upload-area,.add-url-area{margin:0}.url-description{color:#000;line-height:22px;font-family:sans-serif;letter-spacing:1px}`]}static get tag(){return"hax-tray-upload"}constructor(){super(),this.__winEvents={"hax-app-picker-selection":"_haxAppPickerSelection","place-holder-file-drop":"_placeHolderFileDrop"},setTimeout(()=>{new Promise((res,rej)=>_require.default(["../../../@polymer/paper-button/paper-button.js"],res,rej)),new Promise((res,rej)=>_require.default(["../../../@polymer/paper-input/paper-input.js"],res,rej)),new Promise((res,rej)=>_require.default(["../../../@vaadin/vaadin-upload/vaadin-upload.js"],res,rej))},0)}render(){return _litElement.html`<custom-style><style>@import url(https://fonts.googleapis.com/css?family=Noto+Serif);paper-input{--paper-input-container-label:{font-size:11px};--paper-input-container:{padding:0};}vaadin-upload{--vaadin-upload-button-add-wrapper:{border:2px solid #fff;background-color:var(--hax-color-accent1,--simple-colors-default-theme-light-blue-7);color:#fff;display:block};--vaadin-upload-buttons-primary:{display:block;width:100%;flex:unset;-webkit-flex:unset};--vaadin-upload-button-add:{color:#000;display:block;flex:unset;-webkit-flex:unset;text-align:center};--vaadin-upload-drop-label:{color:#fff;display:block;padding:8px};--vaadin-upload-drop-label-dragover:{color:#fff};--vaadin-upload-file-list:{padding:8px;margin:0;color:#fff};--vaadin-upload-file:{color:#fff};}</style></custom-style><div class=add-area-content-wrapper><div class=add-url-area><paper-input id=url label=URL type=url auto-validate=""></paper-input><div class=url-description>Add an existing resource / link</div></div><div class=add-upload-area><vaadin-upload @upload-before=${this._fileAboutToUpload} @upload-response=${this._fileUploadResponse} form-data-name=file-upload id=fileupload></vaadin-upload></div><paper-button @click=${this.newAssetConfigure} id=newassetconfigure raised="">Configure</paper-button></div>`}newAssetConfigure(){let values={source:this.shadowRoot.querySelector("#url").value},type=window.HaxStore.guessGizmoType(values),haxElements=window.HaxStore.guessGizmo(type,values,!1,!0);haxElements.length>0?1===haxElements.length?void 0!==haxElements[0].tag&&this.dispatchEvent(new CustomEvent("hax-insert-content",{bubbles:!0,cancelable:!0,composed:!0,detail:haxElements[0]})):window.HaxStore.instance.haxAppPicker.presentOptions(haxElements,type,"Pick how to present the "+type,"gizmo"):window.HaxStore.toast("Sorry, HAX doesn't know how to handle that type of link yet.")}_placeHolderFileDrop(e){window.HaxStore.instance.activePlaceHolder=e.detail.placeHolderElement,this.shadowRoot.querySelector("#fileupload")._onDrop(e.detail)}_fileUploadResponse(e){this.editExistingNode=!0;let response=JSON.parse(e.detail.xhr.response),map=this.__appUsed.connection.operations.add.resultMap,data={},item={};for(var prop in void 0!==this._resolveObjectPath(map.item,response)&&(data=this._resolveObjectPath(map.item,response)),item.type=map.defaultGizmoType,map.gizmo)item[prop]=this._resolveObjectPath(map.gizmo[prop],data);void 0===item.url&&void 0!==item.source&&(item.url=item.source),void 0!==map.gizmo.type&&(item.type=this._resolveObjectPath(map.gizmo.type,data)),this.shadowRoot.querySelector("#url").value=item.url,this.newAssetConfigure()}_fileAboutToUpload(e){if(this.__allowUpload)this.__allowUpload=!1;else{e.preventDefault(),e.stopPropagation();let values={source:e.detail.file.name,type:e.detail.file.type};var type=window.HaxStore.guessGizmoType(values);let targets=window.HaxStore.getHaxAppStoreTargets(type);1===targets.length?this._haxAppPickerSelection({detail:targets[0]}):0!==targets.length?window.HaxStore.instance.haxAppPicker.presentOptions(targets,type,"Where would you like to upload this "+type+"?","app"):window.HaxStore.toast("Sorry, you don't have a storage location that can handle "+type+" uploads!",5e3)}}_haxAppPickerSelection(e){let connection=e.detail.connection;this.__appUsed=e.detail,this.shadowRoot.querySelector("#fileupload").method=connection.operations.add.method;let requestEndPoint=connection.protocol+"://"+connection.url;"/"!=requestEndPoint.substr(requestEndPoint.length-1)&&(requestEndPoint+="/"),void 0!==connection.operations.add.endPoint&&(requestEndPoint+=connection.operations.add.endPoint),null!=window.HaxStore.instance.connectionRewrites.appendUploadEndPoint&&(requestEndPoint+="?"+window.HaxStore.instance.connectionRewrites.appendUploadEndPoint),null!=window.HaxStore.instance.connectionRewrites.appendJwt&&(requestEndPoint+="&"+window.HaxStore.instance.connectionRewrites.appendJwt+"="+localStorage.getItem(window.HaxStore.instance.connectionRewrites.appendJwt)),this.shadowRoot.querySelector("#fileupload").headers=connection.headers,this.shadowRoot.querySelector("#fileupload").target=requestEndPoint,this.__allowUpload=!0,this.shadowRoot.querySelector("#fileupload").uploadFiles()}_resolveObjectPath(path,obj){return path.split(".").reduce((function(prev,curr){return prev?prev[curr]:null}),obj||self)}}_exports.HaxTrayUpload=HaxTrayUpload,window.customElements.define(HaxTrayUpload.tag,HaxTrayUpload)}));