define(["exports","require","../../@polymer/polymer/polymer-element.js","../../@polymer/polymer/lib/legacy/polymer.dom.js","../../@polymer/polymer/lib/utils/flattened-nodes-observer.js","../../@polymer/polymer/lib/utils/flush.js","../../@polymer/polymer/lib/utils/render-status.js","../../@polymer/polymer/lib/utils/async.js","./lib/haxutils.js","../simple-colors/simple-colors.js","./lib/hax-text-context.js","./lib/hax-ce-context.js","./lib/hax-plate-context.js","./lib/hax-input-mixer.js","./lib/hax-shared-styles.js"],function(_exports,_require,_polymerElement,_polymerDom,_flattenedNodesObserver,_flush,_renderStatus,async,_haxutils,_simpleColors,_haxTextContext,_haxCeContext,_haxPlateContext,_haxInputMixer,_haxSharedStyles){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.HaxBody=void 0,_require=babelHelpers.interopRequireWildcard(_require),async=babelHelpers.interopRequireWildcard(async);class HaxBody extends _polymerElement.PolymerElement{constructor(){super(),new Promise((res,rej)=>_require.default(["../../@polymer/iron-a11y-keys/iron-a11y-keys.js"],res,rej)),new Promise((res,rej)=>_require.default(["../../@polymer/paper-item/paper-item.js"],res,rej)),new Promise((res,rej)=>_require.default(["../grid-plate/grid-plate.js"],res,rej))}static get tag(){return"hax-body"}static get template(){return _polymerElement.html`
      <style include="hax-shared-styles">
        :host {
          display: block;
          min-height: 32px;
          min-width: 32px;
          outline: none;
        }
        .hax-context-menu {
          padding: 0;
          margin-left: -5000px;
          position: absolute;
          visibility: hidden;
          opacity: 0;
          z-index: 1000;
          float: left;
          display: block;
          pointer-events: none;
          transition: 0.8s opacity ease-in-out, 0.8s visibility ease-in-out;
        }
        #haxinputmixer {
          z-index: 10000000;
        }
        .hax-context-visible.hax-active-hover {
          visibility: visible;
          opacity: 1;
          pointer-events: all;
          margin-left: unset;
        }
        :host #bodycontainer ::slotted(h1) {
          font-size: var(--haxcms-base-styles-h1-font-size, 2.5em);
          line-height: var(--haxcms-base-styles-h1-line-height, 2.5em);
        }
        :host #bodycontainer ::slotted(h2) {
          font-size: var(--haxcms-base-styles-h2-font-size, 2em);
        }
        :host #bodycontainer ::slotted(h3) {
          font-size: var(--haxcms-base-styles-h3-font-size, 1.75em);
        }
        :host #bodycontainer ::slotted(h4) {
          font-size: var(--haxcms-base-styles-h4-font-size, 1.5em);
        }
        :host #bodycontainer ::slotted(h5) {
          font-size: var(--haxcms-base-styles-h5-font-size, 1.25em);
        }
        :host #bodycontainer ::slotted(h6) {
          font-size: var(--haxcms-base-styles-h6-font-size, 1.25em);
        }
        :host #bodycontainer ::slotted(p) {
          min-height: 26px;
          font-size: var(--haxcms-base-styles-p-font-size, 24px);
          line-height: var(--haxcms-base-styles-p-line-height, 1.8);
          letter-spacing: var(--haxcms-base-styles-p-letter-spacing, 0.5px);
        }

        :host #bodycontainer ::slotted(a),
        :host #bodycontainer ::slotted(a:visited),
        :host #bodycontainer ::slotted(a:active) {
          color: #000;
        }
        :host #bodycontainer ::slotted(a:hover) {
          color: #2196f3;
        }
        :host #bodycontainer ::slotted(ol),
        :host #bodycontainer ::slotted(ul),
        :host #bodycontainer ::slotted(li) {
          padding-bottom: 1.5em;
          line-height: 40px;
          font-size: 24px;
          max-width: 28em;
        }
        :host #bodycontainer ::slotted(ol > li:last-child),
        :host #bodycontainer ::slotted(ul > li:last-child) {
          padding-bottom: 1em;
        }
        :host #bodycontainer ::slotted(ul),
        :host #bodycontainer ::slotted(ol) {
          padding-left: 20px;
          margin-left: 20px;
        }

        :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {
          outline: none;
          outline-offset: 2px;
          transition: 0.2s width ease-in-out, 0.2s height ease-in-out,
            0.2s margin ease-in-out;
          caret-color: var(--hax-color-text);
        }
        :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]:hover) {
          outline: 1px solid rgba(145, 151, 162, 0.25);
          caret-color: #000000;
        }
        :host([edit-mode])
          #bodycontainer
          ::slotted(*.hax-active[data-editable]:hover) {
          cursor: text !important;
          outline: 1px solid rgba(145, 151, 162, 0.25);
        }
        :host([edit-mode])
          #bodycontainer
          ::slotted(*[data-editable] .hax-active:hover) {
          cursor: text !important;
          outline: 1px solid rgba(145, 151, 162, 0.25);
        }
        :host([edit-mode])
          #bodycontainer
          ::slotted(code.hax-active[data-editable]) {
          display: block;
        }
        :host([edit-mode]) #bodycontainer ::slotted(hr[data-editable]) {
          height: 2px;
          background-color: #eeeeee;
          padding-top: 4px;
          padding-bottom: 4px;
        }
        /** Fix to support safari as it defaults to none */
        :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {
          -webkit-user-select: text;
          cursor: pointer;
        }

        :host([edit-mode])
          #bodycontainer
          ::slotted(*[data-editable]::-moz-selection),
        :host([edit-mode])
          #bodycontainer
          ::slotted(*[data-editable] *::-moz-selection) {
          background-color: var(--hax-body-highlight, --paper-yellow-300);
          color: black;
        }
        :host([edit-mode])
          #bodycontainer
          ::slotted(*[data-editable]::selection),
        :host([edit-mode])
          #bodycontainer
          ::slotted(*[data-editable] *::selection) {
          background-color: var(--hax-body-highlight, --paper-yellow-300);
          color: black;
        }
        #bodycontainer {
          -webkit-user-select: text;
          user-select: text;
        }
        :host([edit-mode][hax-ray-mode])
          #bodycontainer
          ::slotted(*[data-editable]):before {
          content: attr(data-hax-ray) " " attr(resource) " " attr(typeof) " "
            attr(property) " " attr(content);
          font-size: 10px;
          font-style: italic;
          left: unset;
          right: unset;
          top: unset;
          background-color: #d3d3d3;
          color: #000000;
          bottom: unset;
          width: auto;
          padding: 8px;
          margin: 0;
          z-index: 1;
          margin: -16px 0 0 0;
          float: right;
          line-height: 2;
        }
      </style>
      <div id="bodycontainer" class="ignore-activation">
        <slot id="body"></slot>
      </div>
      <hax-text-context
        id="textcontextmenu"
        class="hax-context-menu ignore-activation"
      ></hax-text-context>
      <hax-ce-context
        id="cecontextmenu"
        class="hax-context-menu ignore-activation"
      ></hax-ce-context>
      <hax-plate-context
        id="platecontextmenu"
        class="hax-context-menu ignore-activation"
      ></hax-plate-context>
      <hax-input-mixer
        id="haxinputmixer"
        class="hax-context-menu ignore-activation"
      ></hax-input-mixer>
    `}static get properties(){return{editMode:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_editModeChanged"},globalPreferences:{type:Object,value:{},observer:"_globalPreferencesUpdated"},haxRayMode:{type:Boolean,value:!1,reflectToAttribute:!0},activeNode:{type:Object,value:null,notify:!0,observer:"_activeNodeChanged"},activeContainerNode:{type:Object,value:null,notify:!0,observer:"_activeContainerNodeChanged"}}}ready(){super.ready(),this.dispatchEvent(new CustomEvent("hax-register-body",{bubbles:!0,cancelable:!0,composed:!0,detail:this})),this.polyfillSafe=window.HaxStore.instance.computePolyfillSafe(),(0,_renderStatus.afterNextRender)(this,function(){this._observer=new _flattenedNodesObserver.FlattenedNodesObserver(this,info=>{(0,_flush.flush)(),info.addedNodes.length>0&&info.addedNodes.map(node=>{if(this._haxElementTest(node)){this._HTMLPrimativeTest(node)&&(node.contentEditable=this.editMode),node.setAttribute("data-editable",this.editMode);let haxRay=node.tagName.replace("-"," ").toLowerCase(),i=window.HaxStore.instance.gizmoList.findIndex(j=>j.tag===node.tagName.toLowerCase());-1!==i&&(haxRay=window.HaxStore.instance.gizmoList[i].title),node.setAttribute("data-hax-ray",haxRay),this.dispatchEvent(new CustomEvent("hax-body-tag-added",{bubbles:!0,cancelable:!0,composed:!0,detail:{node:node}}))}}),info.removedNodes.length>0&&info.removedNodes.map(node=>{this._haxElementTest(node)&&!node.classList.contains("hax-active")&&this.dispatchEvent(new CustomEvent("hax-body-tag-removed",{bubbles:!0,cancelable:!0,composed:!0,detail:{node:node}}))})}),this.addEventListener("hax-context-item-selected",this._haxContextOperation.bind(this)),this.addEventListener("hax-input-mixer-update",this._haxInputMixerOperation.bind(this)),this.addEventListener("place-holder-replace",this.replacePlaceholder.bind(this));try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("defaultParagraphSeparator",!1,"p")}catch(e){console.log(e)}window.addEventListener("keydown",this._onKeyDown.bind(this)),window.addEventListener("keypress",this._onKeyPress.bind(this)),this.shadowRoot.querySelector("slot").addEventListener("mousemove",this.hoverEvent.bind(this)),this.shadowRoot.querySelector("slot").addEventListener("mouseup",e=>{const tmp=window.HaxStore.getSelection();window.HaxStore._tmpSelection=tmp;try{const range=window.HaxStore.getRange();range.cloneRange&&(window.HaxStore._tmpRange=range.cloneRange())}catch(e){console.log(e)}}),document.body.addEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),window.addEventListener("scroll",this._keepContextVisible.bind(this)),this.addEventListener("focusin",this._focusIn.bind(this)),this.addEventListener("mousedown",this._focusIn.bind(this))})}connectedCallback(){super.connectedCallback(),(0,_renderStatus.afterNextRender)(this,function(){this.editMode=window.HaxStore.instance.editMode,this.__tabTrap=!1})}_keepContextVisible(e){let el=!1;this.$.textcontextmenu.classList.contains("hax-context-visible")?el=this.$.textcontextmenu:this.$.cecontextmenu.classList.contains("hax-context-visible")&&(el=this.$.cecontextmenu),el&&(this.elementInViewport(el)?el.classList.remove("hax-context-pin-bottom","hax-context-pin-top"):this.__OffBottom?el.classList.add("hax-context-pin-top"):el.classList.add("hax-context-pin-bottom"))}_onKeyDown(e){this.editMode&&this.getAttribute("contenteditable")&&(setTimeout(()=>{const rng=window.HaxStore.getRange();switch(e.key){case"Tab":window.HaxStore.instance.isTextElement(this.activeContainerNode)&&(e.detail.keyboardEvent&&(e.detail.keyboardEvent.preventDefault(),e.detail.keyboardEvent.stopPropagation(),e.detail.keyboardEvent.stopImmediatePropagation()),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.shiftKey?this._tabBackKeyPressed():this._tabKeyPressed());break;case"Enter":this.setAttribute("contenteditable",!0),setTimeout(()=>{rng.commonAncestorContainer&&"function"==typeof rng.commonAncestorContainer.focus&&(rng.commonAncestorContainer.focus(),this.__focusLogic(rng.commonAncestorContainer))},900);break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":rng.commonAncestorContainer&&this.activeNode!==rng.commonAncestorContainer&&"function"==typeof rng.commonAncestorContainer.focus?"HAX-BODY"!==rng.commonAncestorContainer.tagName&&(window.HaxStore.instance.isTextElement(rng.commonAncestorContainer)?this.setAttribute("contenteditable",!0):this.removeAttribute("contenteditable"),setTimeout(()=>{rng.commonAncestorContainer.focus(),this.__focusLogic(rng.commonAncestorContainer)},900)):rng.commonAncestorContainer&&rng.commonAncestorContainer.parentNode&&this.activeNode!==rng.commonAncestorContainer.parentNode&&"function"==typeof rng.commonAncestorContainer.parentNode.focus&&"HAX-BODY"!==rng.commonAncestorContainer.parentNode.tagName&&(window.HaxStore.instance.isTextElement(rng.commonAncestorContainer.parentNode)?this.setAttribute("contenteditable",!0):this.removeAttribute("contenteditable"),setTimeout(()=>{rng.commonAncestorContainer.parentNode.focus(),this.__focusLogic(rng.commonAncestorContainer.parentNode)},900))}},100),this.$.platecontextmenu.classList.contains("hax-active-hover")&&this.__dropActiveHover())}_onKeyPress(e){this.editMode&&this.$.platecontextmenu.classList.contains("hax-active-hover")&&this.__dropActiveHover()}hoverEvent(e){if(this.editMode&&(e.target&&null!=e.target.getAttribute("data-hax-ray")?(this.__activeHover=e.target,this.dispatchEvent(new CustomEvent("hax-active-hover-name",{bubbles:!0,cancelable:!0,composed:!0,detail:e.target.getAttribute("data-hax-ray")}))):e.target&&e.target.parentNode&&null!=e.target.parentNode.getAttribute("data-hax-ray")&&(this.__activeHover=e.target.parentNode,this.dispatchEvent(new CustomEvent("hax-active-hover-name",{bubbles:!0,cancelable:!0,composed:!0,detail:e.target.parentNode.getAttribute("data-hax-ray")}))),!this.$.platecontextmenu.classList.contains("hax-active-hover"))){let local=(0,_polymerDom.dom)(e).localTarget;e.target===this.$.cecontextmenu||e.target===this.$.textcontextmenu||e.target===this.$.platecontextmenu||local===this.activeNode||local===this.activeContainerNode||e.target===this.activeNode||e.target===this.activeContainerNode||local.parentNode===this.activeContainerNode||local.parentNode.parentNode===this.activeContainerNode||local.parentNode.parentNode.parentNode===this.activeContainerNode?(this.__addActiveHover(),this.__typeLock=!1):this.__dropActiveHover()}}__addActiveHover(){this.$.cecontextmenu.classList.add("hax-active-hover"),this.$.textcontextmenu.classList.add("hax-active-hover"),this.$.platecontextmenu.classList.add("hax-active-hover")}__dropActiveHover(){this.$.cecontextmenu.classList.remove("hax-active-hover"),this.$.textcontextmenu.classList.remove("hax-active-hover"),this.$.platecontextmenu.classList.remove("hax-active-hover")}elementInViewport(el){let top=el.offsetTop-32-window.HaxStore.instance.haxPanel.$.drawer.offsetHeight,left=el.offsetLeft,width=el.offsetWidth,height=el.offsetHeight;for(;el.offsetParent;)top+=(el=el.offsetParent).offsetTop,left+=el.offsetLeft;return this.__OffBottom=top<window.pageYOffset+window.innerHeight,top<window.pageYOffset+window.innerHeight&&left<window.pageXOffset+window.innerWidth&&top+height>window.pageYOffset&&left+width>window.pageXOffset}replacePlaceholder(e){if("text"===e.detail){let p=document.createElement("p");p.innerHTML="<br/>",this.haxReplaceNode(this.activeNode,p,(0,_polymerDom.dom)(this.activeNode).parentNode),setTimeout(()=>{this.activeNode=p,window.HaxStore.write("activeNode",p,this),this.activeContainerNode.setAttribute("contenteditable",!0),p.focus(),this.__focusLogic(p)},210)}else this.replaceElementWorkflow()}replaceElementWorkflow(){let element=window.HaxStore.nodeToHaxElement(this.activeNode,null),type="*",skipPropMatch=!1;"place-holder"===element.tag&&void 0!==element.properties.type&&(type=element.properties.type,skipPropMatch=!0);var props={};if(void 0!==window.HaxStore.instance.elementList[element.tag]&&!1!==window.HaxStore.instance.elementList[element.tag].gizmo&&void 0!==window.HaxStore.instance.elementList[element.tag].gizmo.handles&&window.HaxStore.instance.elementList[element.tag].gizmo.handles.length>0){let gizmo=window.HaxStore.instance.elementList[element.tag].gizmo;for(var i=0;i<gizmo.handles.length;i++)for(var prop in gizmo.handles[i])"type"!==prop&&void 0!==element.properties[gizmo.handles[i][prop]]&&(props[prop]=element.properties[gizmo.handles[i][prop]])}let haxElements=window.HaxStore.guessGizmo(type,props,skipPropMatch);if(haxElements.length>0){let tag=this.activeNode.tagName.toLowerCase(),humanName=tag.replace("-"," ");void 0!==window.HaxStore.instance.elementList[tag]&&!1!==window.HaxStore.instance.elementList[tag].gizmo&&(humanName=window.HaxStore.instance.elementList[tag].gizmo.title),window.HaxStore.instance.haxAppPicker.presentOptions(haxElements,"__convert",`Transform ${humanName} to..`,"gizmo")}else window.HaxStore.toast("Sorry, this can not be transformed!",5e3)}_globalPreferencesUpdated(newValue,oldValue){void 0!==newValue&&null!=newValue&&(this.haxRayMode=newValue.haxRayMode)}_haxStorePropertyUpdated(e){e.detail&&void 0!==e.detail.value&&e.detail.property&&("object"==typeof e.detail.value&&this.set(e.detail.property,null),this.set(e.detail.property,e.detail.value))}haxClearBody(confirm=!0){let status=!0;confirm&&(status=prompt("Are you sure you want to delete all content?")),status&&(0,_haxutils.wipeSlot)(this)}haxInsert(tag,content,properties={},waitForLock=!0){this.__activeHover=null;var frag=document.createElement(tag);frag.innerHTML=content;var newNode=frag.cloneNode(!0);for(var property in properties){let attributeName=window.HaxStore.camelToDash(property);properties.hasOwnProperty(property)&&(!0===properties[property]?newNode.setAttribute(attributeName,attributeName):!1===properties[property]?newNode.removeAttribute(attributeName):null!=properties[property]&&properties[property].constructor===Array?newNode.properties&&newNode.properties[property].readOnly||newNode.set(attributeName,properties[property]):null!=properties[property]&&properties[property].constructor===Object?newNode.properties&&newNode.properties[property].readOnly||newNode.set(attributeName,properties[property]):newNode.setAttribute(attributeName,properties[property]))}return null!==window.HaxStore.instance.activePlaceHolder&&void 0!==window.HaxStore.instance.activePlaceHolder.style?(newNode.style.width=window.HaxStore.instance.activePlaceHolder.style.width,newNode.style.float=window.HaxStore.instance.activePlaceHolder.style.float,newNode.style.margin=window.HaxStore.instance.activePlaceHolder.style.margin,newNode.style.display=window.HaxStore.instance.activePlaceHolder.style.display,this.haxReplaceNode(window.HaxStore.instance.activePlaceHolder,newNode,(0,_polymerDom.dom)(window.HaxStore.instance.activePlaceHolder).parentNode),window.HaxStore.instance.activePlaceHolder=null):null!=this.activeContainerNode?"GRID-PLATE"!==newNode.tagName&&"GRID-PLATE"===this.activeContainerNode.tagName&&this.activeContainerNode!==this.activeNode?(null!=this.activeNode.getAttribute("slot")&&newNode.setAttribute("slot",this.activeNode.getAttribute("slot")),(0,_polymerDom.dom)(this.activeContainerNode).insertBefore(newNode,this.activeNode)):(0,_polymerDom.dom)(this).insertBefore(newNode,this.activeContainerNode.nextElementSibling):(0,_polymerDom.dom)(this).appendChild(newNode),this.$.textcontextmenu.highlightOps=!1,this.__updateLockFocus=newNode,waitForLock&&setTimeout(()=>{this.breakUpdateLock()},50),!0}breakUpdateLock(){window.HaxStore.write("activeContainerNode",this.__updateLockFocus,this),window.HaxStore.write("activeNode",this.__updateLockFocus,this),this.__updateLockFocus.focus(),"function"==typeof this.__updateLockFocus.scrollIntoViewIfNeeded?this.__updateLockFocus.scrollIntoViewIfNeeded(!0):this.__updateLockFocus.scrollIntoView({behavior:"smooth",inline:"center"})}haxToContent(){this.hideContextMenus();var __active=this.activeNode;this.set("activeNode",null),this.set("activeContainerNode",null),window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this);let children=(0,_polymerDom.dom)(this.$.body).getDistributedNodes();this.globalPreferences.haxDeveloperMode&&console.log(children);for(var content="",i=0,len=children.length;i<len;i++)this._haxElementTest(children[i])?(children[i].removeAttribute("data-editable"),children[i].removeAttribute("data-hax-ray"),children[i].contentEditable=!1,content+=window.HaxStore.nodeToContent(children[i]),"grid-plate"===children[i].tagName.toLowerCase()&&this._applyContentEditable(this.editMode,children[i])):8===children[i].nodeType?content+="\x3c!-- "+children[i].textContent+" --\x3e":1!==children[i].nodeType&&void 0!==children[i].textContent&&"undefined"!==children[i].textContent&&(content+=children[i].textContent);if(content=(content=(content=(content=(content=(content=(content=(content=(content=content.replace(/\scontenteditable=\"false\"/g,"")).replace(/\sdata-editable=\"true\"/g,"")).replace(/\sdata-editable=\"false\"/g,"")).replace(/\sdata-editable=\""/g,"")).replace(/\sdata-editable/g,"")).replace(/\scontenteditable/g,"")).replace(/\sdraggable/g,"")).replace(/\sdata-draggable/g,"")).replace(/\sdata-hax-ray=\".*?\"/g,""),this.parentNode.tagName){let parentTag=this.parentNode.tagName.toLowerCase(),string="style-scope "+parentTag+" x-scope",re=new RegExp(string,"g");content=content.replace(re,""),string="style-scope "+parentTag,re=new RegExp(string,"g"),content=content.replace(re,""),string="x-scope "+parentTag+"-0",re=new RegExp(string,"g"),content=content.replace(re,"");let tags=window.HaxStore.instance.validTagList;for(var i in tags.push("hax-preview"),tags)string="style-scope "+tags[i],re=new RegExp(string,"g"),content=content.replace(re,""),string="x-scope "+tags[i]+"-0 ",re=new RegExp(string,"g"),content=content.replace(re,""),string="x-scope "+tags[i]+"-0",re=new RegExp(string,"g"),content=content.replace(re,"")}return content=(content=content.replace(/\sclass=\"\"/g,"")).replace(/\sclass=\"\s\"/g,""),this._applyContentEditable(this.editMode),window.HaxStore.write("activeNode",__active,this),window.HaxStore.write("activeContainerNode",__active,this),content=(0,_haxutils.encapScript)(content),this.globalPreferences.haxDeveloperMode&&console.log(content),content}haxDuplicateNode(node,parent=this){this.hideContextMenus();let haxElement=window.HaxStore.nodeToHaxElement(node,null);void 0!==node.preProcessHaxInsertContent&&(haxElement=node.preProcessHaxInsertContent(haxElement));var nodeClone=window.HaxStore.haxElementToNode(haxElement.tag,haxElement.content,haxElement.properties);return"webview"===nodeClone.tagName.toLowerCase()&&window.HaxStore.instance._isSandboxed&&void 0!==nodeClone.guestinstance&&delete nodeClone.guestinstance,null!==node?(0,_polymerDom.dom)(parent).insertBefore(nodeClone,(0,_polymerDom.dom)(node).nextSibling):(0,_polymerDom.dom)(parent).appendChild(nodeClone),setTimeout(()=>{parent===this&&window.HaxStore.write("activeContainerNode",nodeClone,this),window.HaxStore.write("activeNode",nodeClone,this)},50),!0}hideContextMenus(){this._hideContextMenu(this.$.textcontextmenu),this._hideContextMenu(this.$.cecontextmenu),this._hideContextMenu(this.$.platecontextmenu),this._hideContextMenu(this.$.haxinputmixer),this.$.textcontextmenu.highlightOps=!1}positionContextMenus(node,container){if(node){let tag=node.tagName.toLowerCase();window.HaxStore.instance._isSandboxed&&"webview"===tag&&(tag="iframe");let props=window.HaxStore.instance.elementList[tag];void 0===props||window.HaxStore.instance.isTextElement(node)?this.__activeContextType=this.$.textcontextmenu:(this.__activeContextType=this.$.cecontextmenu,props.element=node,this.__activeContextType.setHaxProperties(props)),this._positionContextMenu(this.__activeContextType,container,-39,-39),this._positionContextMenu(this.$.platecontextmenu,container,-31,0),container&&!this._HTMLPrimativeTest(node)&&node!==container?container.contentEditable=!1:container&&this._HTMLPrimativeTest(container)&&(container.contentEditable=!0)}}haxMoveGridPlate(direction,node,container){switch(direction){case"first":null!==container.previousElementSibling&&(0,_polymerDom.dom)(this).insertBefore(container,(0,_polymerDom.dom)(this).firstChild);break;case"up":null!==container.previousElementSibling&&(0,_polymerDom.dom)(this).insertBefore(container,container.previousElementSibling);break;case"down":null!==container.nextElementSibling&&(0,_polymerDom.dom)(this).insertBefore(container.nextElementSibling,container);break;case"last":null!==container.nextElementSibling&&(0,_polymerDom.dom)(this).appendChild(container)}return setTimeout(()=>{this.positionContextMenus(node,container),"function"==typeof container.scrollIntoViewIfNeeded?container.scrollIntoViewIfNeeded(!0):container.scrollIntoView({behavior:"smooth",inline:"center"})},50),!0}haxReplaceNode(node,replacement,parent=this){this.hideContextMenus();try{null!=node.getAttribute("slot")&&replacement.setAttribute("slot",node.getAttribute("slot")),null==node&&(node=this.__oldActiveNode,parent=this.__oldActiveNode.parentNode),(0,_polymerDom.dom)(parent).replaceChild(replacement,node)}catch(e){console.log(e)}return replacement}haxChangeTagName(node,tagName,newNode){this.hideContextMenus();for(var replacement=document.createElement(tagName),i=0,l=node.attributes.length;i<l;++i){var nodeName=node.attributes.item(i).nodeName,value=node.attributes.item(i).value;replacement.setAttribute(nodeName,value)}replacement.innerHTML=node.innerHTML.trim(),"ul"==tagName||"ol"==tagName?""==replacement.innerHTML?replacement.innerHTML="<li></li>":"ul"!=node.tagName.toLowerCase()&&"ol"!=node.tagName.toLowerCase()&&(replacement.innerHTML="<li>"+node.innerHTML.trim().replace(/<br\/>/g,"</li>\n<li>").replace(/<br>/g,"</li>\n<li>")+"</li>"):"ul"!=node.tagName.toLowerCase()&&"ol"!=node.tagName.toLowerCase()||(replacement.innerHTML=replacement.innerHTML.replace(/<ul>/g,"").replace(/<\/ul>/g,"").replace(/<li><\/li>/g,"").replace(/<li>/g,"").replace(/<\/li>/g,"<br/>"));try{(0,_polymerDom.dom)(this).replaceChild(replacement,node),setTimeout(()=>{let children=(0,_polymerDom.dom)(replacement).getEffectiveChildNodes();children[0]&&children.tagName?children[0].focus():replacement.focus()},50)}catch(e){console.log(e),console.log(replacement),console.log(node)}return replacement}haxDeleteNode(node,parent=this){if(this.hideContextMenus(),null!=this.activeContainerNode&&null!==this.activeContainerNode.previousElementSibling){if(this.activeContainerNode.previousElementSibling.focus(),null!=this.activeContainerNode&&window.HaxStore.instance.isTextElement(this.activeContainerNode)&&""!==(0,_polymerDom.dom)(this.activeContainerNode).textContent)try{var range=document.createRange(),sel=window.HaxStore.getSelection();range.setStart(this.activeContainerNode,1),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range),this.activeContainerNode.focus()}catch(e){console.log(e)}}else null!=this.activeContainerNode&&null!==this.activeContainerNode.nextElementSibling?this.activeContainerNode.nextElementSibling.focus():(this.set("activeNode",null),this.set("activeContainerNode",null),window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this));try{return(0,_polymerDom.dom)(parent).removeChild(node)}catch(e){console.log(e)}}importContent(html,clear=!0){clear&&(0,_haxutils.wipeSlot)(this,"*"),setTimeout(()=>{html=(0,_haxutils.encapScript)(html);let fragment=document.createElement("div");for(fragment.insertAdjacentHTML("beforeend",html);null!==fragment.firstChild;)if(void 0!==fragment.firstChild.tagName)if(window.HaxStore.instance._isSandboxed&&"iframe"===fragment.firstChild.tagName.toLowerCase()){for(var replacement=document.createElement("webview"),j=0,l=fragment.firstChild.attributes.length;j<l;++j){var nodeName=fragment.firstChild.attributes.item(j).nodeName,value=fragment.firstChild.attributes.item(j).value;"height"!==nodeName&&"width"!==nodeName||replacement.style[nodeName],replacement.setAttribute(nodeName,value)}(0,_polymerDom.dom)(this).appendChild(replacement)}else(0,_polymerDom.dom)(this).appendChild(fragment.firstChild);else fragment.removeChild(fragment.firstChild)},50)}_haxContextOperation(e){let detail=e.detail;var haxElement;switch(detail.eventName){case"p":case"ol":case"ul":case"h2":case"h3":case"h4":case"h5":case"h6":case"blockquote":case"code":this.$.textcontextmenu.selectedValue=detail.eventName,window.HaxStore.write("activeContainerNode",this.haxChangeTagName(this.activeContainerNode,detail.eventName),this),this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"text-align-left":this.activeNode.style.textAlign=null,this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"grid-plate-convert":this.replaceElementWorkflow();break;case"grid-plate-duplicate":this.activeNode===this.activeContainerNode?this.haxDuplicateNode(this.activeNode):this.haxDuplicateNode(this.activeNode,this.activeContainerNode);break;case"grid-plate-delete":if(null!=this.activeNode){let options=[{icon:"thumb-up",color:"green",title:"Yes"},{icon:"thumb-down",color:"red",title:"No"}],tag=this.activeNode.tagName.toLowerCase(),humanName=tag.replace("-"," ");void 0!==window.HaxStore.instance.elementList[tag]&&!1!==window.HaxStore.instance.elementList[tag].gizmo&&(humanName=window.HaxStore.instance.elementList[tag].gizmo.title),window.HaxStore.instance.haxAppPicker.presentOptions(options,"",`Remove this \`${humanName}\`?`,"delete")}break;case"grid-plate-first":this.haxMoveGridPlate("first",this.activeNode,this.activeContainerNode);break;case"grid-plate-up":this.haxMoveGridPlate("up",this.activeNode,this.activeContainerNode);break;case"hax-manager-open":window.HaxStore.write("activeHaxElement",{},this),window.HaxStore.instance.haxManager.resetManager(parseInt(detail.value)),window.HaxStore.instance.haxManager.toggleDialog();break;case"grid-plate-down":this.haxMoveGridPlate("down",this.activeNode,this.activeContainerNode);break;case"grid-plate-last":this.haxMoveGridPlate("last",this.activeNode,this.activeContainerNode);break;case"close-menu":this.set("activeNode",null),this.set("activeContainerNode",null),window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this);break;case"hax-edit-property":let haxInputMixer=this.$.haxinputmixer;haxInputMixer.label=detail.target.label,haxInputMixer.options=detail.target.options,haxInputMixer.icon=detail.target.icon,haxInputMixer.description=detail.target.description,haxInputMixer.required=detail.target.required,haxInputMixer.validation=detail.target.validation,haxInputMixer.validationType=detail.target.validationType,haxInputMixer.inputMethod=detail.target.inputMethod,haxInputMixer.value="",void 0!==detail.target.propertyToBind&&null!=detail.target.propertyToBind&&0!=detail.target.propertyToBind&&(haxInputMixer.propertyToBind=detail.target.propertyToBind,void 0!==this.activeNode[detail.target.propertyToBind]?haxInputMixer.value=this.activeNode[detail.target.propertyToBind]:haxInputMixer.value=this.activeNode.getAttribute(detail.target.propertyToBind)),this._positionContextMenu(haxInputMixer,this.activeContainerNode,-1,-38);let style=this.$.cecontextmenu.currentStyle||window.getComputedStyle(this.$.cecontextmenu);haxInputMixer.style.width=style.width.replace("px","")-40+"px";break;case"hax-align-left":this.activeNode.style.float=null,this.activeNode.style.margin=null,this.activeNode.style.display=null,setTimeout(()=>{this.positionContextMenus(this.activeNode,this.activeContainerNode)},200);break;case"hax-align-center":this.activeNode.style.float=null,this.activeNode.style.margin="0 auto",this.activeNode.style.display="block",setTimeout(()=>{this.positionContextMenus(this.activeNode,this.activeContainerNode)},200);break;case"hax-size-change":this.activeNode&&(this.activeNode.style.width=detail.value+"%",setTimeout(()=>{this.positionContextMenus(this.activeNode,this.activeContainerNode)},200));break;case"hax-manager-configure":this._hideContextMenu(this.$.haxinputmixer),window.HaxStore.instance.haxManager.resetManager(),haxElement=window.HaxStore.nodeToHaxElement(window.HaxStore.instance.activeNode),window.HaxStore.write("activeHaxElement",haxElement,this),window.HaxStore.instance.haxManager.editExistingNode=!0,window.HaxStore.instance.haxManager.selectStep("configure"),window.HaxStore.instance.haxManager.toggleDialog(),setTimeout(()=>{window.HaxStore.instance.haxManager.$.preview.$.configurebutton.focus()},100);break;case"hax-manager-configure-container":window.HaxStore.write("activeNode",window.HaxStore.instance.activeContainerNode,this),this._hideContextMenu(this.$.haxinputmixer),window.HaxStore.instance.haxManager.resetManager(),haxElement=window.HaxStore.nodeToHaxElement(window.HaxStore.instance.activeNode),window.HaxStore.write("activeHaxElement",haxElement,this),window.HaxStore.instance.haxManager.editExistingNode=!0,window.HaxStore.instance.haxManager.selectStep("configure"),window.HaxStore.instance.haxManager.toggleDialog(),setTimeout(()=>{window.HaxStore.instance.haxManager.$.preview.$.configurebutton.focus()},100)}}_haxInputMixerOperation(e){let mixer=e.detail.inputMixer;null!=mixer.propertyToBind?this.activeNode[mixer.propertyToBind]=mixer.value:null!=mixer.slotToBind&&(item=document.createElement("span"),item.style.height="inherit",item.innerHTML=mixer.value,item.slot=mixer.slotToBind,this.activeNode.appendChild(item)),this._hideContextMenu(this.$.haxinputmixer)}_focusIn(e){var normalizedEvent=(0,_polymerDom.dom)(e);this.__focusLogic(normalizedEvent.localTarget)&&e.stopPropagation()}__focusLogic(target){let stopProp=!1;if(this.editMode&&!this.__tabTrap){let containerNode=target,activeNode=null;if(this._haxElementTest(containerNode)&&null!=containerNode.parentNode){for(;"HAX-BODY"!=containerNode.parentNode.tagName;)null===activeNode&&"LI"!==containerNode.tagName&&"B"!==containerNode.tagName&&"I"!==containerNode.tagName&&"STRONG"!==containerNode.tagName&&"EM"!==containerNode.tagName&&(activeNode=containerNode),containerNode=containerNode.parentNode;null===activeNode?activeNode=containerNode:window.HaxStore.instance.isGridPlateElement(containerNode)?["UL","OL","LI","P","GRID-PLATE"].includes(containerNode.tagName)&&["UL","OL","LI"].includes(activeNode.tagName)&&(activeNode=containerNode):activeNode=containerNode,this.activeContainerNode===containerNode||containerNode.classList.contains("ignore-activation")?containerNode.classList.contains("ignore-activation")&&(stopProp=!0):(this.hideContextMenus(),this.activeContainerNode=containerNode,window.HaxStore.write("activeContainerNode",containerNode,this),stopProp=!0),this.activeNode===activeNode||activeNode.classList.contains("ignore-activation")||(this.activeNode=activeNode,window.HaxStore.write("activeNode",activeNode,this),this.positionContextMenus(activeNode,containerNode),stopProp=!0)}}else this.__tabTrap=!1;return stopProp}_editModeChanged(newValue,oldValue){void 0!==oldValue&&(this._applyContentEditable(newValue),this.setAttribute("tabindex","-1"),!1!==newValue&&void 0!==this.activeNode&&null!==this.activeNode&&this.positionContextMenus(this.activeNode,this.activeContainerNode)),!1===newValue&&(this.removeAttribute("contenteditable"),this.hideContextMenus())}_haxResolvePreviousElement(node){for(node=(0,_polymerDom.dom)(node).previousElementSibling;null!=node&&void 0!==node.tagName&&"HAX-"===node.tagName.substring(0,4);)node=(0,_polymerDom.dom)(node).previousElementSibling;return node}_haxElementTest(node){return void 0!==node.tagName&&"HAX-"!==node.tagName.substring(0,4)}_HTMLPrimativeTest(node){return null!=node&&void 0!==node.tagName&&-1==node.tagName.indexOf("-")}_applyContentEditable(status,target=this.$.body){let children=(0,_polymerDom.dom)(target).getDistributedNodes();0===children.length&&(children=(0,_polymerDom.dom)(target).getEffectiveChildNodes());for(var i=0,len=children.length;i<len;i++)if(this._HTMLPrimativeTest(children[i])&&(children[i].contentEditable=status),this._haxElementTest(children[i]))if(status){children[i].setAttribute("data-editable",status);let haxRay=children[i].tagName.replace("-"," ").toLowerCase(),l=window.HaxStore.instance.gizmoList.findIndex(j=>j.tag===children[i].tagName.toLowerCase());-1!==l&&(haxRay=window.HaxStore.instance.gizmoList[l].title),children[i].setAttribute("data-hax-ray",haxRay)}else children[i].removeAttribute("data-editable"),children[i].removeAttribute("data-hax-ray")}_activeContainerNodeChanged(newValue,oldValue){if(this.editMode&&void 0!==newValue&&null!=newValue&&null!=newValue.tagName){window.HaxStore.instance.isTextElement(newValue)||window.HaxStore.instance.isGridPlateElement(newValue)?(newValue.setAttribute("contenteditable",!0),this.setAttribute("contenteditable",!0)):(newValue.removeAttribute("contenteditable"),this.removeAttribute("contenteditable")),"grid-plate"===newValue.tagName.toLowerCase()&&(newValue.editMode=this.editMode,this._applyContentEditable(this.editMode,newValue))}}_activeNodeChanged(newValue,oldValue){if(void 0!==oldValue&&null!=oldValue&&oldValue.classList.remove("hax-active"),this.editMode&&null!=newValue){let tag=newValue.tagName.toLowerCase();newValue.classList.add("hax-active"),window.HaxStore.instance.isTextElement(newValue)||window.HaxStore.instance.isGridPlateElement(newValue)?(newValue.setAttribute("contenteditable",!0),this.setAttribute("contenteditable",!0)):(newValue.removeAttribute("contenteditable"),this.removeAttribute("contenteditable")),this.$.textcontextmenu.selectedValue=tag,setTimeout(()=>{this.positionContextMenus(newValue,window.HaxStore.instance.activeContainerNode)},100),"left"==newValue.style.textAlign?(this.$.textcontextmenu.justifyIcon="editor:format-align-left",this.$.textcontextmenu.justifyValue="text-align-left"):"left"==newValue.style.float?(this.$.cecontextmenu.justifyIcon="editor:format-align-left",this.$.cecontextmenu.justifyValue="hax-align-left"):"0 auto"==newValue.style.margin&&(this.$.cecontextmenu.justifyIcon="editor:format-align-center",this.$.cecontextmenu.justifyValue="hax-align-center")}else null===newValue&&(this.hideContextMenus(),this.__oldActiveNode=oldValue,this.$.textcontextmenu.justifyIcon="editor:format-align-left",this.$.textcontextmenu.justifyValue="text-align-left")}_getPosition(element){return{x:element.offsetLeft-element.scrollLeft+element.clientLeft,y:element.offsetTop-element.scrollTop+element.clientTop}}_positionContextMenu(menu,target,xoffset,yoffset){if(null!=target){let pos=this._getPosition(target);menu.style.left=null!=xoffset?pos.x+xoffset+"px":pos.x+"px",menu.style.top=null!=yoffset?pos.y+yoffset+"px":pos.y+"px"}menu.classList.add("hax-context-visible"),this.__activeHover&&(menu.classList.add("hax-active-hover"),menu.style.marginLeft="",this.__typeLock=!1),setTimeout(()=>{async.microTask.run(this._keepContextVisible())},100)}_hideContextMenu(menu){menu.classList.remove("hax-context-visible","hax-context-pin-top","hax-context-pin-bottom"),menu.style.left="-100px"}_tabKeyPressed(){let focus=!1,node=this.activeContainerNode;const activeNodeTagName=this.activeContainerNode.tagName;try{let range=window.HaxStore.getRange().cloneRange();var tagTest=range.commonAncestorContainer.tagName;if(void 0===tagTest&&(tagTest=range.commonAncestorContainer.parentNode.tagName),["UL","OL","LI"].includes(activeNodeTagName)||["UL","OL","LI"].includes(tagTest))this.polyfillSafe&&(document.execCommand("indent"),this.__tabTrap=!0);else for(;!focus;)null==(0,_polymerDom.dom)(node).nextSibling?focus=!0:"function"===(0,_polymerDom.dom)(node).nextSibling.focus?((0,_polymerDom.dom)(node).nextSibling.focus(),focus=!0):node=(0,_polymerDom.dom)(node).nextSibling}catch(e){console.log(e)}}_tabBackKeyPressed(){let node=this.activeContainerNode;const activeNodeTagName=this.activeContainerNode.tagName;try{let range=window.HaxStore.getRange().cloneRange();var tagTest=range.commonAncestorContainer.tagName;if(void 0===tagTest&&(tagTest=range.commonAncestorContainer.parentNode.tagName),["UL","OL","LI"].includes(activeNodeTagName)||["UL","OL","LI"].includes(tagTest))this.polyfillSafe&&(document.execCommand("outdent"),this.__tabTrap=!0);else{if(null!=node)for(;null!=node&&!this._haxElementTest(node);)node=(0,_polymerDom.dom)(node).previousSibling;null!=node&&setTimeout(()=>{node.focus()},50)}}catch(e){console.log(e)}}}_exports.HaxBody=HaxBody,window.customElements.define(HaxBody.tag,HaxBody)});