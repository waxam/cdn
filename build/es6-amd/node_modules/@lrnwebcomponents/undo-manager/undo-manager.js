define(["exports","meta","../../lit-element/lit-element.js","../es-global-bridge/es-global-bridge.js"],(function(e,t,s,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.UndoManagerCommand=e.UndoManager=void 0,t=babelHelpers.interopRequireWildcard(t);
/**
   * Copyright 2019 The Pennsylvania State University
   * @license Apache-2.0, see License.md for full text.
   */
class UndoManager extends s.LitElement{static get tag(){return"undo-manager"}render(){return s.html`
      <slot></slot>
    `}static get properties(){return{...super.properties,canUndo:{type:Boolean,attribute:"can-undo"},canRedo:{type:Boolean,attribute:"can-redo"},isDirty:{type:Boolean,attribute:"is-dirty"},target:{type:Object}}}constructor(){super(),this.blocked=!1,this.observer=null;const e=`${this.pathFromUrl(decodeURIComponent(t.url))}../../undo.js/undo.js`;window.addEventListener("es-bridge-undojs-loaded",this._undoLoaded.bind(this)),window.ESGlobalBridge.requestAvailability(),window.ESGlobalBridge.instance.load("undojs",e)}pathFromUrl(e){return e.substring(0,e.lastIndexOf("/")+1)}_undoLoaded(e){this.stack=new Undo.Stack,this.stack.changed=e=>{this.canRedo=this.stack.canRedo(),this.canUndo=this.stack.canUndo(),this.isDirty=this.stack.dirty()},this.stack.changed(),window.removeEventListener("undo-js-loaded",this._undoLoaded.bind(this))}connectedCallback(){this.observer=new MutationObserver(e=>{setTimeout(()=>{if(this.blocked)return void(this.blocked=!1);const e=this.innerHTML;this.stack&&e!=this.startValue&&(this.stack.execute(new UndoManagerCommand(this,this.startValue,e)),this.startValue=e)},50)}),this.observer.observe(this,{attributes:!0,childList:!0,subtree:!0}),super.connectedCallback()}disconnectedCallback(){this.observer.disconnect(),super.disconnectedCallback()}firstUpdated(e){super.firstUpdated&&super.firstUpdated(e),this.startValue=this.innerHTML}updated(e){super.updated&&super.updated(e),e.forEach((e,t)=>{"canUndo"==t&&this.dispatchEvent(new CustomEvent("can-undo-changed",{detail:{value:this[t]}})),"canRedo"==t&&this.dispatchEvent(new CustomEvent("can-redo-changed",{detail:{value:this[t]}})),"isDirty"==t&&this.dispatchEvent(new CustomEvent("is-dirty-changed",{detail:{value:this[t]}}))})}undo(){return this.stack.undo()}redo(){return this.stack.redo()}commands(){return this.stack.commands}stackPosition(){return this.stack.stackPosition}savePosition(){return this.stack.savePosition}save(){this.stack.save()}}e.UndoManager=UndoManager,customElements.define("undo-manager",UndoManager);class UndoManagerCommand{constructor(e,t,s){this.el=e,this.oldValue=t,this.newValue=s}execute(){}undo(){this.el.blocked=!0,this.el.innerHTML=this.oldValue}redo(){this.el.blocked=!0,this.el.innerHTML=this.newValue}}e.UndoManagerCommand=UndoManagerCommand}));