define(["exports","./haxcms-site-store.js","../../../../mobx/lib/mobx.module.js","../../../utils/utils.js","../../../simple-colors-shared-styles/simple-colors-shared-styles.js","../../../anchor-behaviors/anchor-behaviors.js"],(function(e,t,i,s,o,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.HAXCMSThemeWiring=e.HAXCMSTheme=void 0;e.HAXCMSTheme=function(e){return class extends e{constructor(){super(),this.HAXCMSThemeSettings={autoScroll:!1},this.__disposer=[],this.HAXCMSThemeWiring=new HAXCMSThemeWiring(this)}_colorChanged(e){e&&(this.hexColor=this._getHexColor(e))}_getHexColor(e){let t=e.replace("-text",""),i=window.SimpleColorsStyles.colors;return i[t]?i[t][6]:"#000000"}_editModeChanged(e,i){void 0!==i&&(t.store.editMode=e,this.__styleReapply())}_contentContainerChanged(e,t){!e||void 0!==t&&null!=t?e&&t?(this.HAXCMSThemeWiring.disconnect(this),this.HAXCMSThemeWiring.connect(this,e)):t&&null==e&&this.HAXCMSThemeWiring.disconnect(this):this.HAXCMSThemeWiring.connect(this,e)}_locationChanged(e,i){if(!e||void 0===e.route)return;const s=e.route.name;if("home"==s||"404"==s){const e=t.store.routerManifest.items.find(e=>void 0!==e.id);e&&(t.store.activeId=e.id)}this.HAXCMSThemeSettings.autoScroll&&(window.scrollTo({top:0,left:0}),setTimeout(()=>{window.AnchorBehaviors.getTarget(t.store.themeElement)},1e3))}connectedCallback(){super.connectedCallback(),setTimeout(()=>{if(0===this.childNodes.length){let e=document.createRange().createContextualFragment(t.store.activeItemContent);this.appendChild(e)}this.__styleReapply()},50),(0,i.autorun)(e=>{this.editMode=(0,i.toJS)(t.store.editMode),this.__disposer.push(e)}),(0,i.autorun)(e=>{this.isLoggedIn=(0,i.toJS)(t.store.isLoggedIn),this.__disposer.push(e)}),(0,i.autorun)(e=>{const o=(0,i.toJS)(t.store.manifest);if(o&&(0,s.varExists)(o,"title")&&(document.title=o.title),o&&(0,s.varExists)(o,"metadata.theme.variables.cssVariable")){let e=o.metadata.theme.variables.cssVariable.replace("--simple-colors-default-theme-","").split("-");e.pop(),this.accentColor=e.join("-");var n=(0,s.varGet)(o,"metadata.theme.variables.cssVariable",null);n=null==n?(0,s.varGet)(o,"metadata.theme.variables.hexCode","#ff0074"):`var(${n})`,document.body.style.setProperty("--haxcms-color",n)}this.__disposer.push(e)}),(0,i.autorun)(e=>{this._location=(0,i.toJS)(t.store.location),this.__disposer.push(e)})}__styleReapply(){window.dispatchEvent(new Event("resize"))}disconnectedCallback(){for(var e in delete this.contentContainer,this.__disposer)this.__disposer[e].dispose();super.disconnectedCallback()}resetActive(){window.history.pushState(null,null,t.store.location.baseUrl),window.dispatchEvent(new PopStateEvent("popstate")),this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,composed:!0,cancelable:!0,detail:{}}))}}};class HAXCMSThemeWiring{constructor(e,t=!0){window.SimpleColorsSharedStyles.requestAvailability(),t&&null==window.localStorage.getItem("HAXCMSSystemData")&&window.localStorage.setItem("HAXCMSSystemData",JSON.stringify({}))}connect(e,i){window.addEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(e)),window.addEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(e)),window.addEventListener("haxcms-trigger-update",this._triggerUpdate.bind(e)),t.store.cmsSiteEditorAvailability(),t.store.cmsSiteEditor.instance.appElement=e,t.store.cmsSiteEditor.instance.appendTarget=i,t.store.cmsSiteEditor.instance.appendTarget.appendChild(t.store.cmsSiteEditor.instance)}disconnect(e){window.removeEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(e)),window.removeEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(e)),window.removeEventListener("haxcms-trigger-update",this._triggerUpdate.bind(e)),document.body.appendChild(t.store.cmsSiteEditorAvailability())}_globalEditChanged(e){this.editMode=e.detail}_activeItemUpdate(e){let i=e.detail;if(i&&void 0!==i.id){t.store.activeId=i.id;const e=new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,composed:!0,cancelable:!0,detail:i});this.dispatchEvent(e),void 0!==i.title?document.title=t.store.routerManifest.title+" - "+i.title:document.title=t.store.routerManifest.title}else document.title=t.store.routerManifest.title}_triggerUpdate(e){this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,composed:!0,cancelable:!0,detail:{}}))}}e.HAXCMSThemeWiring=HAXCMSThemeWiring}));