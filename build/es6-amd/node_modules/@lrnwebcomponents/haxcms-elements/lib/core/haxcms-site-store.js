define(["exports","../../../../mobx/lib/mobx.module.js","../../../utils/utils.js"],(function(e,t,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.store=void 0;class Store{constructor(){this.location=null,this.jwt=null,this.editMode=!1,this.manifest=null,this.activeItemContent="",this.themeElement=null,this.activeId=null,this.userData={},this.cmsSiteEditor={instance:null},this.cmsSiteEditorBackend={instance:null},this.dashboardOpened=!1}cmsSiteEditorAvailability(){return this.cmsSiteEditor.instance||(this.cmsSiteEditor.instance=document.createElement("haxcms-site-editor")),this.cmsSiteEditor.instance}get processedItems(){}_computeItems(e,t,i,a,s){if(s){let n,r=[],c=[];switch(s.items.forEach(e=>{e.parent||r.push(e)}),a){case"parent":n=s.items.find(e=>i===e.id),n&&(i=n.parent);break;case"ancestor":for(n=s.items.find(e=>i===e.id);n&&null!=n.parent;)n=s.items.find(e=>e.id==n.parent);n&&(i=n.id)}return r.forEach((a,s)=>{this._spiderChildren(a,c,e,t,i,!1)}),c}}_setChildren(e,t){const i=t.filter(t=>e.id===t.parent);e.children=i,e.children.length>0&&e.children.forEach(e=>{this._setChildren(e,t)})}get routerManifest(){const e=this.manifest;if(document.body.dispatchEvent(new CustomEvent("json-outline-schema-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:e})),e&&void 0!==e.items){let a=JSON.parse(window.localStorage.getItem("HAXCMSSystemData"));var t={};null==a&&(a={manifests:{}},a.manifests[e.id]={accessData:{}},window.localStorage.setItem("HAXCMSSystemData",JSON.stringify(a))),a&&void 0!==a.manifests&&void 0!==a.manifests[e.id]&&"undefined"!==a.manifests[e.id].accessData&&(t=a.manifests[e.id].accessData);let s=e.items.map(i=>{let a=null,s=e.items.find(e=>i.parent===e.id);s&&(a=s.location.replace("pages/","").replace("/index.html",""));let n=i.metadata;void 0!==t[i.id]&&(n.accessData=t[i.id]);let r=i.location.replace("pages/","").replace("/index.html","");return Object.assign({},i,{parentLocation:a,location:r,metadata:n})});if(s.forEach((e,t)=>{this._setChildren(e,s)}),!0===(0,i.varGet)(e,"metadata.site.settings.publishPagesOn",!1)){const filterHiddenParentsRecursive=e=>{if(!1===e.metadata.published)return!1;const t=s.find(t=>t.id===e.parent);return!t||filterHiddenParentsRecursive(t)};s=s.filter(e=>filterHiddenParentsRecursive(e))}return Object.assign({},e,{items:s,accessData:t})}}get siteTitle(){const e=this.manifest;return e&&e.title?e.title:""}get homeLink(){if(this.manifest){const e=this.manifest.items.find(e=>void 0!==e.id);if(e)return e.location.replace("pages/","").replace("/index.html","")}return"/"}get activeItem(){let e=this.findItem(this.activeId);return e||null}get activeItemFields(){if(this.activeItem&&this.activeItem.metadata){let e={title:this.activeItem.title,description:this.activeItem.description,location:this.activeItem.location,created:this.activeItem.metadata.created,updated:this.activeItem.metadata.created};if(this.activeItem.metadata.fields)return Object.assign({},e,this.activeItem.metadata.fields)}}get themeData(){if(this.manifest){var e={};return e=(0,i.varExists)(this.manifest,"metadata.theme")?this.manifest.metadata.theme:{"haxcms-basic-theme":{element:"haxcms-basic-theme",path:"@lrnwebcomponents/haxcms-elements/lib/core/themes/haxcms-basic-theme.js",name:"Basic theme",variables:{image:"assets/banner.jpg",icon:"icons:record-voice-over",hexCode:"#da004e",cssVariable:"pink"}}},this.activeItem&&(0,i.varExists)(this.activeItem,"metadata.theme")?this.activeItem.metadata.theme:e}}get activeManifestIndex(){if(this.manifest&&this.manifest.items&&this.activeId)for(var e in this.manifest.items)if(this.manifest.items[e].id===this.activeId)return parseInt(e);return-1}get activeRouterManifestIndex(){if(this.routerManifest&&this.routerManifest.items&&this.activeId)for(var e in this.routerManifest.items)if(this.routerManifest.items[e].id===this.activeId)return parseInt(e);return-1}get activeManifestIndexCounter(){return null!==this.activeManifestIndex?1+this.activeManifestIndex:0}get activeTitle(){return this.activeItem?this.activeItem.title:""}get parentTitle(){if(this.manifest&&this.activeItem){let e=this.manifest.items.find(e=>this.activeItem.parent===e.id);if(e)return e.title}return""}get isLoggedIn(){return!(!this.jwt||"null"==this.jwt)}get ancestorTitle(){if(this.manifest&&this.activeItem){let e=this.manifest.items.find(e=>this.activeItem.parent===e.id);for(;e&&null!=e.parent;)e=this.manifest.items.find(t=>t.id==e.parent);if(e)return e.title}return""}findItem(e){return this.manifest&&e?this.manifest.items.find(t=>t.id===e):null}spiderChildren(e,t,i,a,s,n,r){e.id===s||n?(n||(n=!0,!r&&e.indent>=i&&(i+=e.indent,a+=e.indent)),e.indent>=i&&e.indent<=a&&t.push(e),e.children.length>0&&e.children.forEach(e=>{this.spiderChildren(e,t,i,a,s,n,r)})):e.children.length>0&&e.children.forEach(e=>{this.spiderChildren(e,t,i,a,s,n,r)})}computeItems(e,t,i,s,n,r){if(n){let c,d=[],o=[];switch(n.items.forEach(e=>{e.parent||d.push(e)}),s){case"parent":c=n.items.find(e=>i===e.id),c&&(i=c.parent);break;case"ancestor":for(c=n.items.find(e=>i===e.id);c&&null!=c.parent;)c=n.items.find(e=>e.id==c.parent);c&&(i=c.id)}return n.items.forEach((s,n)=>{a.spiderChildren(s,o,e,t,i,!1,r)}),o}}}(0,t.decorate)(Store,{location:t.observable.ref,editMode:t.observable,jwt:t.observable,dashboardOpened:t.observable,userData:t.observable,manifest:t.observable,activeItemContent:t.observable,themeElement:t.observable,routerManifest:t.computed,siteTitle:t.computed,isLoggedIn:t.computed,themeData:t.computed,homeLink:t.computed,activeId:t.observable,activeItem:t.computed,activeItemFields:t.computed,activeManifestIndex:t.computed,activeManifestIndexCounter:t.computed,activeTitle:t.computed,parentTitle:t.computed,ancestorTitle:t.computed,changeActiveItem:t.action.bound});const a=new Store;e.store=a,(0,t.autorun)(()=>{if(a.location&&a.location.route&&a.location.route.component){const e=a.location.route.name;a.manifest.items.filter(t=>t.id===e)&&(a.activeId=e)}}),(0,t.autorun)(()=>{const e=(0,t.toJS)(a.findItem(a.activeId));e&&document.body.dispatchEvent(new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:e}))}),(0,t.autorun)(()=>{const e=(0,t.toJS)(a.editMode);window.HaxStore&&window.HaxStore.write&&(window.dispatchEvent(new CustomEvent("haxcms-edit-mode-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:e})),window.HaxStore.write("editMode",e,window.HaxStore.instance),window.HaxStore.instance.globalPreferences.haxVoiceCommands&&setTimeout(()=>{window.HaxStore.instance.__hal.auto=!0},10))})}));