define(["exports","../../../../../lit-element/lit-element.js","../../core/haxcms-site-store.js","../../../../utils/utils.js","../../../../../mobx/lib/mobx.module.js"],(function(t,e,i,r,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SiteQuery=void 0,
/**
   * Copyright 2019 The Pennsylvania State University
   * @license Apache-2.0, see License.md for full text.
   */
Object.byString=function(t,e){return(0,r.objectValFromStringPos)(t,e)};class SiteQuery extends e.LitElement{static get tag(){return"site-query"}static get properties(){return{routerManifest:{type:Object},activeId:{type:String,attribute:"active-id"},result:{type:Array},conditions:{type:Object},sort:{type:Object},forceRebuild:{type:Boolean,attribute:"force-rebuild"},limit:{type:Number},startIndex:{type:Number,attribute:"start-index"},random:{type:Boolean},entity:{type:String}}}constructor(){super(),this.entity="node",this.conditions={},this.random=!1,this.sort={order:"ASC"},this.forceRebuild=!1,this.limit=0,this.startIndex=0}updated(t){t.forEach((t,e)=>{if(["result","conditions","sort","forceRebuild"].includes(e)){let t=`${e.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g,"$1-$2").toLowerCase()}-changed`;this.dispatchEvent(new CustomEvent(t,{detail:{value:this[e]}}))}["entity","conditions","sort","routerManifest","activeId","limit","startIndex","random","forceRebuild"].includes(e)&&(this.result=[...this._computeResult(this.entity,this.conditions,this.sort,this.routerManifest,this.activeId,this.limit,this.startIndex,this.random,this.forceRebuild)])})}_computeResult(t,e,i,r,n,o,a,c,u){if(r&&r.items){var b=[...(0,s.toJS)(r.items)];if("node"!==t){var d=[];for(var l in b)if(void 0!==Object.byString(b[l],t)){let e,i=Object.byString(b[l],t);if(e="object"==typeof i||"array"==typeof i?Object.assign([],Object.byString(b[l],t)):i,"object"==typeof e||"array"==typeof e)for(var l in e)if("object"==typeof e[l]||"array"==typeof e[l])e[l]._node=Object.assign({},b[l]),d.push(e[l]);else{let t={_node:Object.assign({},b[l]),value:e[l]};d.push(t)}else{let t={_node:Object.assign({},b[l]),value:e};d.push(t)}}b=Object.assign([],d)}if(e&&b)for(var l in e){null===e[l]?e[l]={value:[e[l]],operator:"="}:"object"!=typeof e[l]&&(e[l]={value:e[l],operator:"="});var y=e[l].value;"$activeId"===e[l].value?y=n:"$firstId"===e[l].value&&(y=b[0].id),b=b.filter(t=>{switch(e[l].operator){case">":return Object.byString(t,l)>y;case"<":return Object.byString(t,l)<y;case"!=":return"object"==typeof y&&!y.includes(Object.byString(t,l))||"string"==typeof y&&Object.byString(t,l)!==y;case"=":default:return!("object"==typeof y&&!y.includes(Object.byString(t,l)))&&("string"!=typeof y||Object.byString(t,l)===y)}})}if(i)for(var l in i)b.sort((t,e)=>"ASC"===i[l]?Object.byString(t,l)<Object.byString(e,l)?-1:Object.byString(t,l)>Object.byString(e,l)?1:0:Object.byString(t,l)>Object.byString(e,l)?-1:Object.byString(t,l)<Object.byString(e,l)?1:0);if(c&&b.sort((t,e)=>Math.random()<Math.random()?-1:Math.random()>Math.random()?1:0),0!==a&&b.length>a)for(;a>0;)b.shift(),a--;else if(b.length<a)return[];if(0!==o)for(;b.length>o;)b.pop();return b}return[]}connectedCallback(){super.connectedCallback(),this.__disposer=(0,s.autorun)(()=>{this.routerManifest=Object.assign({},(0,s.toJS)(i.store.routerManifest))}),this.__disposer2=(0,s.autorun)(()=>{this.activeId=(0,s.toJS)(i.store.activeId)})}disconnectedCallback(){this.__disposer(),this.__disposer2(),super.disconnectedCallback()}}t.SiteQuery=SiteQuery,window.customElements.define(SiteQuery.tag,SiteQuery)}));