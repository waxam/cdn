define(["exports","../../../@polymer/polymer/polymer-legacy.js","../../vaadin-themable-mixin/vaadin-themable-mixin.js","./vaadin-grid-scroller.js","./vaadin-grid-a11y-mixin.js","./vaadin-grid-active-item-mixin.js","./vaadin-grid-array-data-provider-mixin.js","./vaadin-grid-column-resizing-mixin.js","./vaadin-grid-data-provider-mixin.js","./vaadin-grid-dynamic-columns-mixin.js","./vaadin-grid-event-context-mixin.js","./vaadin-grid-filter-mixin.js","./vaadin-grid-row-details-mixin.js","./vaadin-grid-scroll-mixin.js","./vaadin-grid-selection-mixin.js","./vaadin-grid-sort-mixin.js","./vaadin-grid-styling-mixin.js","./vaadin-grid-drag-and-drop-mixin.js","./vaadin-grid-keyboard-navigation-mixin.js","./vaadin-grid-column-reordering-mixin.js","./vaadin-grid-column.js","./vaadin-grid-outer-scroller.js","./vaadin-grid-styles.js","../../vaadin-element-mixin/vaadin-element-mixin.js","../../../@polymer/polymer/lib/utils/html-tag.js","../../../@polymer/polymer/lib/utils/render-status.js","../../../@polymer/polymer/lib/utils/debounce.js","../../../@polymer/polymer/lib/utils/async.js"],(function(_exports,_polymerLegacy,_vaadinThemableMixin,_vaadinGridScroller,_vaadinGridA11yMixin,_vaadinGridActiveItemMixin,_vaadinGridArrayDataProviderMixin,_vaadinGridColumnResizingMixin,_vaadinGridDataProviderMixin,_vaadinGridDynamicColumnsMixin,_vaadinGridEventContextMixin,_vaadinGridFilterMixin,_vaadinGridRowDetailsMixin,_vaadinGridScrollMixin,_vaadinGridSelectionMixin,_vaadinGridSortMixin,_vaadinGridStylingMixin,_vaadinGridDragAndDropMixin,_vaadinGridKeyboardNavigationMixin,_vaadinGridColumnReorderingMixin,_vaadinGridColumn,_vaadinGridOuterScroller,_vaadinGridStyles,_vaadinElementMixin,_htmlTag,_renderStatus,_debounce,_async){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.GridElement=void 0;
/**
  @license
  Copyright (c) 2017 Vaadin Ltd.
  This program is available under Apache License Version 2.0, available at https://vaadin.com/license/
  */
const TOUCH_DEVICE=(()=>{try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}})();class GridElement extends((0,_vaadinElementMixin.ElementMixin)((0,_vaadinThemableMixin.ThemableMixin)((0,_vaadinGridDataProviderMixin.DataProviderMixin)((0,_vaadinGridArrayDataProviderMixin.ArrayDataProviderMixin)((0,_vaadinGridDynamicColumnsMixin.DynamicColumnsMixin)((0,_vaadinGridActiveItemMixin.ActiveItemMixin)((0,_vaadinGridScrollMixin.ScrollMixin)((0,_vaadinGridSelectionMixin.SelectionMixin)((0,_vaadinGridSortMixin.SortMixin)((0,_vaadinGridRowDetailsMixin.RowDetailsMixin)((0,_vaadinGridKeyboardNavigationMixin.KeyboardNavigationMixin)((0,_vaadinGridA11yMixin.A11yMixin)((0,_vaadinGridFilterMixin.FilterMixin)((0,_vaadinGridColumnReorderingMixin.ColumnReorderingMixin)((0,_vaadinGridColumnResizingMixin.ColumnResizingMixin)((0,_vaadinGridEventContextMixin.EventContextMixin)((0,_vaadinGridDragAndDropMixin.DragAndDropMixin)((0,_vaadinGridStylingMixin.StylingMixin)(_vaadinGridScroller.ScrollerElement))))))))))))))))))){static get template(){return _htmlTag.html`
    <style include="vaadin-grid-styles"></style>

    <div id="scroller" no-scrollbars\$="[[!_scrollbarWidth]]" wheel-scrolling\$="[[_wheelScrolling]]" safari\$="[[_safari]]" ios\$="[[_ios]]" loading\$="[[loading]]" edge\$="[[_edge]]" firefox\$="[[_firefox]]" ie\$="[[_ie]]" column-reordering-allowed\$="[[columnReorderingAllowed]]">

      <table id="table" role="grid" aria-multiselectable="true" tabindex="0">
        <caption id="fixedsizer" class="sizer" part="row"></caption>
        <thead id="header" role="rowgroup"></thead>
        <tbody id="items" role="rowgroup"></tbody>
        <tfoot id="footer" role="rowgroup"></tfoot>
      </table>

      <div part="reorder-ghost"></div>
      <vaadin-grid-outer-scroller id="outerscroller" _touch-device="[[_touchDevice]]" scroll-target="[[scrollTarget]]" scroll-handler="[[_this]]" no-scrollbars="[[!_scrollbarWidth]]">
        <div id="outersizer" class="sizer" part="row"></div>
      </vaadin-grid-outer-scroller>
    </div>

    <!-- The template needs at least one slot or else shady doesn't distribute -->
    <slot name="nodistribute"></slot>

    <div id="focusexit" tabindex="0"></div>
`}static get is(){return"vaadin-grid"}static get version(){return"5.4.12"}static get observers(){return["_columnTreeChanged(_columnTree, _columnTree.*)"]}static get properties(){return{_this:{type:Object,value:function(){return this}},_safari:{type:Boolean,value:/^((?!chrome|android).)*safari/i.test(navigator.userAgent)},_ios:{type:Boolean,value:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1},_edge:{type:Boolean,value:"undefined"!=typeof CSS&&CSS.supports("(-ms-ime-align:auto)")},_ie:{type:Boolean,value:!(!navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/MSIE/))},_firefox:{type:Boolean,value:navigator.userAgent.toLowerCase().indexOf("firefox")>-1},_android:{type:Boolean,value:/android/i.test(navigator.userAgent)},_touchDevice:{type:Boolean,value:TOUCH_DEVICE},heightByRows:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_heightByRowsChanged"}}}constructor(){super(),this.addEventListener("animationend",this._onAnimationEnd)}__hasRowsWithClientHeight(){return!!Array.from(this.$.items.children).filter(row=>row.clientHeight).length}__setInitialColumnWidths(){!this._initialColumnWidthsSet&&this.__hasRowsWithClientHeight()&&(this._initialColumnWidthsSet=!0,this.recalculateColumnWidths())}_recalculateColumnWidths(cols){cols.forEach(col=>{col.width="auto",col._origFlexGrow=col.flexGrow,col.flexGrow=0}),cols.forEach(col=>{col._currentWidth=0,col._allCells.forEach(c=>{const cellWidth=Math.ceil(c.getBoundingClientRect().width);col._currentWidth=Math.max(col._currentWidth,cellWidth)})}),cols.forEach(col=>{col.width=`${col._currentWidth}px`,col.flexGrow=col._origFlexGrow,col._currentWidth=void 0,col._origFlexGrow=void 0})}recalculateColumnWidths(){if(!this._columnTree)return;const cols=this._getColumns().filter(col=>!col.hidden&&col.autoWidth);this._recalculateColumnWidths(cols)}_createScrollerRows(count){const rows=[];for(var i=0;i<count;i++){const row=document.createElement("tr");row.setAttribute("part","row"),row.setAttribute("role","row"),this._columnTree&&this._updateRow(row,this._columnTree[this._columnTree.length-1],"body",!1,!0),rows.push(row)}return this._columnTree&&this._columnTree[this._columnTree.length-1].forEach(c=>c.notifyPath&&c.notifyPath("_cells.*",c._cells)),(0,_renderStatus.beforeNextRender)(this,()=>{this._updateFirstAndLastColumn(),this._resetKeyboardNavigation()}),rows}_getRowTarget(){return this.$.items}_createCell(tagName){const slotName="vaadin-grid-cell-content-"+(this._contentIndex=this._contentIndex+1||0),cellContent=document.createElement("vaadin-grid-cell-content");cellContent.setAttribute("slot",slotName);const cell=document.createElement(tagName);cell.id=slotName.replace("-content-","-"),cell.setAttribute("tabindex","-1"),cell.setAttribute("role","td"===tagName?"gridcell":"columnheader");const slot=document.createElement("slot");return slot.setAttribute("name",slotName),cell.appendChild(slot),cell._content=cellContent,cellContent.addEventListener("mousedown",()=>{if(window.chrome){const mouseUpListener=()=>{cellContent.contains(this.getRootNode().activeElement)||cell.focus(),document.removeEventListener("mouseup",mouseUpListener,!0)};document.addEventListener("mouseup",mouseUpListener,!0)}else setTimeout(()=>{cellContent.contains(this.getRootNode().activeElement)||cell.focus()})}),cell}_updateRow(row,columns,section,isColumnRow,noNotify){section=section||"body";const contentsFragment=document.createDocumentFragment();Array.from(row.children).forEach(cell=>cell._vacant=!0),row.innerHTML="","outersizer"!==row.id&&"fixedsizer"!==row.id&&(row.hidden=!0),columns.forEach((column,index)=>{let cell;if("body"===section){if(column._cells=column._cells||[],cell=column._cells.filter(cell=>cell._vacant)[0],cell||(cell=this._createCell("td"),column._cells.push(cell)),cell.setAttribute("part","cell body-cell"),row.appendChild(cell),index===columns.length-1&&(this._rowDetailsTemplate||this.rowDetailsRenderer)){this._detailsCells=this._detailsCells||[];const detailsCell=this._detailsCells.filter(cell=>cell._vacant)[0]||this._createCell("td");-1===this._detailsCells.indexOf(detailsCell)&&this._detailsCells.push(detailsCell),detailsCell._content.parentElement||contentsFragment.appendChild(detailsCell._content),this._configureDetailsCell(detailsCell),row.appendChild(detailsCell),this._a11ySetRowDetailsCell(row,detailsCell),detailsCell._vacant=!1}column.notifyPath&&!noNotify&&column.notifyPath("_cells.*",column._cells)}else{const tagName="header"===section?"th":"td";isColumnRow||"vaadin-grid-column-group"===column.localName?(cell=column[`_${section}Cell`]||this._createCell(tagName),cell._column=column,row.appendChild(cell),column[`_${section}Cell`]=cell):(column._emptyCells=column._emptyCells||[],cell=column._emptyCells.filter(cell=>cell._vacant)[0]||this._createCell(tagName),cell._column=column,row.appendChild(cell),-1===column._emptyCells.indexOf(cell)&&column._emptyCells.push(cell)),cell.setAttribute("part",`cell ${section}-cell`),this.__updateHeaderFooterRowVisibility(row)}cell._content.parentElement||contentsFragment.appendChild(cell._content),cell._vacant=!1,cell._column=column}),this.appendChild(contentsFragment),this._frozenCellsChanged(),this._updateFirstAndLastColumnForRow(row)}__updateHeaderFooterRowVisibility(row){if(!row)return;const visibleRowCells=Array.from(row.children).filter(cell=>{const column=cell._column;if(column._emptyCells&&column._emptyCells.indexOf(cell)>-1)return!1;if(row.parentElement===this.$.header){if(column.headerRenderer||column._headerTemplate)return!0;if(null===column.header)return!1;if(column.path||void 0!==column.header)return!0}else if(column.footerRenderer||column._footerTemplate)return!0});row.hidden!==!visibleRowCells.length&&(row.hidden=!visibleRowCells.length,this.notifyResize())}_updateScrollerItem(row,index){this._preventScrollerRotatingCellFocus(row,index),this._columnTree&&(this._toggleAttribute("first",0===index,row),this._toggleAttribute("odd",index%2,row),this._a11yUpdateRowRowindex(row,index),this._getItem(index,row))}_columnTreeChanged(columnTree,splices){for(Array.from(this.$.items.children).forEach(row=>this._updateRow(row,columnTree[columnTree.length-1]));this.$.header.children.length<columnTree.length;){const headerRow=document.createElement("tr");headerRow.setAttribute("part","row"),headerRow.setAttribute("role","row"),this.$.header.appendChild(headerRow);const footerRow=document.createElement("tr");footerRow.setAttribute("part","row"),footerRow.setAttribute("role","row"),this.$.footer.appendChild(footerRow)}for(;this.$.header.children.length>columnTree.length;)this.$.header.removeChild(this.$.header.firstElementChild),this.$.footer.removeChild(this.$.footer.firstElementChild);Array.from(this.$.header.children).forEach((headerRow,index)=>this._updateRow(headerRow,columnTree[index],"header",index===columnTree.length-1)),Array.from(this.$.footer.children).forEach((footerRow,index)=>this._updateRow(footerRow,columnTree[columnTree.length-1-index],"footer",0===index)),this._updateRow(this.$.outersizer,columnTree[columnTree.length-1]),this._updateRow(this.$.fixedsizer,columnTree[columnTree.length-1]),this._resizeHandler(),this._frozenCellsChanged(),this._updateFirstAndLastColumn(),this._resetKeyboardNavigation(),this._a11yUpdateHeaderRows(),this._a11yUpdateFooterRows()}_updateItem(row,item){row._item=item;const model=this.__getRowModel(row);this._toggleAttribute("selected",model.selected,row),this._a11yUpdateRowSelected(row,model.selected),this._a11yUpdateRowLevel(row,model.level),this._toggleAttribute("expanded",model.expanded,row),(this._rowDetailsTemplate||this.rowDetailsRenderer)&&this._toggleDetailsCell(row,item),this._generateCellClassNames(row,model),this._filterDragAndDrop(row,model),Array.from(row.children).forEach(cell=>{if(cell._renderer){const owner=cell._column||this;cell._renderer.call(owner,cell._content,owner,model)}else cell._instance&&(cell._instance.__detailsOpened__=model.detailsOpened,cell._instance.__selected__=model.selected,cell._instance.__level__=model.level,cell._instance.__expanded__=model.expanded,cell._instance.setProperties(model))}),this._debouncerUpdateHeights=_debounce.Debouncer.debounce(this._debouncerUpdateHeights,_async.timeOut.after(1),()=>{this._updateMetrics(),this._positionItems(),this._updateScrollerSize()})}_resizeHandler(){this._updateDetailsCellHeights(),this._accessIronListAPI(super._resizeHandler,!0),this._updateHeaderFooterMetrics()}_updateHeaderFooterMetrics(){const headerHeight=this.$.header.clientHeight+"px",footerHeight=this.$.footer.clientHeight+"px";[this.$.outersizer,this.$.fixedsizer,this.$.items].forEach(element=>{element.style.borderTopWidth=headerHeight,element.style.borderBottomWidth=footerHeight}),(0,_renderStatus.afterNextRender)(this.$.header,()=>{this._pendingScrollToIndex&&this._scrollToIndex(this._pendingScrollToIndex)})}_onAnimationEnd(e){0===e.animationName.indexOf("vaadin-grid-appear")&&(this._render(),this._updateHeaderFooterMetrics(),e.stopPropagation(),this.notifyResize(),this.__setInitialColumnWidths())}_toggleAttribute(name,bool,node){node.hasAttribute(name)===!bool&&(bool?node.setAttribute(name,""):node.removeAttribute(name))}__getRowModel(row){return{index:row.index,item:row._item,level:this._getIndexLevel(row.index),expanded:this._isExpanded(row._item),selected:this._isSelected(row._item),detailsOpened:!(!this._rowDetailsTemplate&&!this.rowDetailsRenderer)&&this._isDetailsOpened(row._item)}}render(){this._columnTree&&(this._columnTree.forEach(level=>{level.forEach(column=>column._renderHeaderAndFooter())}),this._update())}notifyResize(){super.notifyResize()}_heightByRowsChanged(value,oldValue){(value||oldValue)&&this.notifyResize()}__forceReflow(){this._debouncerForceReflow=_debounce.Debouncer.debounce(this._debouncerForceReflow,_async.animationFrame,()=>{this.$.scroller.style.overflow="hidden",setTimeout(()=>this.$.scroller.style.overflow="")})}}_exports.GridElement=GridElement,customElements.define(GridElement.is,GridElement)}));