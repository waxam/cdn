define(["exports"],function(_exports){Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.KeyboardNavigationMixin=void 0;_exports.KeyboardNavigationMixin=superClass=>(class KeyboardNavigationMixin extends superClass{static get properties(){return{_headerFocusable:{type:Object,observer:"_focusableChanged"},_itemsFocusable:{type:Object,observer:"_focusableChanged"},_footerFocusable:{type:Object,observer:"_focusableChanged"},_navigatingIsHidden:Boolean,_focusedItemIndex:{type:Number,value:0},_focusedColumnOrder:Number}}ready(){super.ready(),this._ios||this._android||(this.addEventListener("keydown",this._onKeyDown),this.addEventListener("focusin",this._onFocusIn),this.addEventListener("focusout",this._onFocusOut),this.$.table.addEventListener("focusin",this._onCellFocusIn.bind(this)),this.$.table.addEventListener("focusout",this._onCellFocusOut.bind(this)),this.addEventListener("mousedown",()=>{this._toggleAttribute("navigating",!1,this),this._isMousedown=!0}),this.addEventListener("mouseup",()=>this._isMousedown=!1))}_focusableChanged(focusable,oldFocusable){oldFocusable&&oldFocusable.setAttribute("tabindex","-1"),focusable&&focusable.setAttribute("tabindex","0")}_onKeyDown(e){let keyGroup,key=e.key;switch("Up"!==key&&"Down"!==key&&"Left"!==key&&"Right"!==key||(key="Arrow"+key),"Esc"===key&&(key="Escape"),"Spacebar"===key&&(key=" "),key){case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":case"PageUp":case"PageDown":case"Home":case"End":keyGroup="Navigation";break;case"Enter":case"Escape":case"F2":keyGroup="Interaction";break;case"Tab":keyGroup="Tab";break;case" ":keyGroup="Space"}this._detectInteracting(e),this.hasAttribute("interacting")&&"Interaction"!==keyGroup&&(keyGroup=void 0),keyGroup&&this[`_on${keyGroup}KeyDown`](e,key)}_ensureScrolledToIndex(index){Array.from(this.$.items.children).filter(child=>child.index===index)[0]||this._scrollToIndex(index)}_onNavigationKeyDown(e,key){function indexOfChildElement(el){return Array.prototype.indexOf.call(el.parentNode.children,el)}e.preventDefault();const visibleItemsCount=this._lastVisibleIndex-this._firstVisibleIndex-1;let dx=0,dy=0;switch(key){case"ArrowRight":dx=1;break;case"ArrowLeft":dx=-1;break;case"Home":dx=-1/0,e.ctrlKey&&(dy=-1/0);break;case"End":dx=1/0,e.ctrlKey&&(dy=1/0);break;case"ArrowDown":dy=1;break;case"ArrowUp":dy=-1;break;case"PageDown":dy=visibleItemsCount;break;case"PageUp":dy=-visibleItemsCount}const activeCell=e.composedPath()[0],columnIndex=indexOfChildElement(activeCell),isRowDetails=this._elementMatches(activeCell,'[part~="details-cell"]'),activeRow=activeCell.parentNode,activeRowGroup=activeRow.parentNode,maxRowIndex=(activeRowGroup===this.$.items?this._effectiveSize:activeRowGroup.children.length)-1,rowIndex=activeRowGroup===this.$.items?void 0!==this._focusedItemIndex?this._focusedItemIndex:activeRow.index:indexOfChildElement(activeRow);let dstRowIndex=Math.max(0,Math.min(rowIndex+dy,maxRowIndex)),dstIsRowDetails=!1;if(activeRowGroup===this.$.items){const item=activeRow._item,dstItem=this._cache.getItemForIndex(dstRowIndex);(dstIsRowDetails=isRowDetails?0===dy:1===dy&&this._isDetailsOpened(item)||-1===dy&&dstRowIndex!==rowIndex&&this._isDetailsOpened(dstItem))!==isRowDetails&&(1===dy&&dstIsRowDetails||-1===dy&&!dstIsRowDetails)&&(dstRowIndex=rowIndex)}if(activeRowGroup!==this.$.items)if(dstRowIndex>rowIndex)for(;dstRowIndex<maxRowIndex&&activeRowGroup.children[dstRowIndex].hidden;)dstRowIndex++;else if(dstRowIndex<rowIndex)for(;dstRowIndex>0&&activeRowGroup.children[dstRowIndex].hidden;)dstRowIndex--;void 0===this._focusedColumnOrder&&(this._focusedColumnOrder=isRowDetails?0:this._getColumns(activeRowGroup,rowIndex)[columnIndex]._order);const dstColumns=this._getColumns(activeRowGroup,dstRowIndex),dstSortedColumnOrders=dstColumns.filter(c=>!c.hidden).map(c=>c._order).sort((b,a)=>b-a),maxOrderedColumnIndex=dstSortedColumnOrders.length-1,orderedColumnIndex=dstSortedColumnOrders.indexOf(dstSortedColumnOrders.slice(0).sort((b,a)=>Math.abs(b-this._focusedColumnOrder)-Math.abs(a-this._focusedColumnOrder))[0]),dstOrderedColumnIndex=0===dy&&isRowDetails?orderedColumnIndex:Math.max(0,Math.min(orderedColumnIndex+dx,maxOrderedColumnIndex));dstOrderedColumnIndex!==orderedColumnIndex&&(this._focusedColumnOrder=void 0),activeRowGroup===this.$.items&&this._ensureScrolledToIndex(dstRowIndex),this._toggleAttribute("navigating",!0,this);const dstColumnIndex=dstColumns.reduce((acc,col,i)=>(acc[col._order]=i,acc),{})[dstSortedColumnOrders[dstOrderedColumnIndex]],dstRow=activeRowGroup===this.$.items?Array.from(activeRowGroup.children).filter(el=>el.index===dstRowIndex)[0]:activeRowGroup.children[dstRowIndex];if(!dstRow)return;const dstCell=dstIsRowDetails?Array.from(dstRow.children).filter(el=>this._elementMatches(el,'[part~="details-cell"]'))[0]:dstRow.children[dstColumnIndex];if(this._scrollHorizontallyToCell(dstCell),activeRowGroup===this.$.items&&(this._focusedItemIndex=dstRowIndex),activeRowGroup===this.$.items){const dstRect=dstCell.getBoundingClientRect(),footerTop=this.$.footer.getBoundingClientRect().top,headerBottom=this.$.header.getBoundingClientRect().bottom;dstRect.bottom>footerTop?(this.$.table.scrollTop+=dstRect.bottom-footerTop,this._scrollHandler()):dstRect.top<headerBottom&&(this.$.table.scrollTop-=headerBottom-dstRect.top,this._scrollHandler())}dstCell.focus()}_parseEventPath(path){const tableIndex=path.indexOf(this.$.table);return{rowGroup:path[tableIndex-1],row:path[tableIndex-2],cell:path[tableIndex-3]}}_onInteractionKeyDown(e,key){const localTarget=e.composedPath()[0],localTargetIsTextInput="input"===localTarget.localName&&!/^(button|checkbox|color|file|image|radio|range|reset|submit)$/i.test(localTarget.type);let wantInteracting;switch(key){case"Enter":wantInteracting=!this.hasAttribute("interacting")||!localTargetIsTextInput;break;case"Escape":wantInteracting=!1;break;case"F2":wantInteracting=!this.hasAttribute("interacting")}const{cell:cell}=this._parseEventPath(e.composedPath());if(this.hasAttribute("interacting")!==wantInteracting)if(wantInteracting){const focusTarget=cell._content.querySelector("[focus-target]")||cell._content.firstElementChild;focusTarget&&(e.preventDefault(),focusTarget.focus(),this._toggleAttribute("interacting",!0,this),this._toggleAttribute("navigating",!1,this))}else e.preventDefault(),this._focusedColumnOrder=void 0,cell.focus(),this._toggleAttribute("interacting",!1,this),this._toggleAttribute("navigating",!0,this)}_predictFocusStepTarget(srcElement,step){const tabOrder=[this.$.table,this._headerFocusable,this._itemsFocusable,this._footerFocusable,this.$.focusexit];let index=tabOrder.indexOf(srcElement);for(index+=step;index>=0&&index<=tabOrder.length-1&&(!tabOrder[index]||tabOrder[index].parentNode.hidden);)index+=step;return tabOrder[index]}_onTabKeyDown(e){const focusTarget=this._predictFocusStepTarget(e.composedPath()[0],e.shiftKey?-1:1);if(focusTarget===this.$.table)this.$.table.focus();else if(focusTarget===this.$.focusexit)this.$.focusexit.focus();else if(focusTarget===this._itemsFocusable){let itemsFocusTarget=focusTarget;const targetRow=this._itemsFocusable.parentNode;if(this._ensureScrolledToIndex(this._focusedItemIndex),targetRow.index!==this._focusedItemIndex){const columnIndex=Array.from(targetRow.children).indexOf(this._itemsFocusable),focusedItemRow=Array.from(this.$.items.children).filter(row=>row.index===this._focusedItemIndex)[0];focusedItemRow&&(itemsFocusTarget=focusedItemRow.children[columnIndex])}e.preventDefault(),itemsFocusTarget.focus()}else e.preventDefault(),focusTarget.focus();this._toggleAttribute("navigating",!0,this)}_onSpaceKeyDown(e){e.preventDefault();const cell=e.composedPath()[0];if(cell._content&&cell._content.firstElementChild){const wasNavigating=this.hasAttribute("navigating");cell._content.firstElementChild.click(),this._toggleAttribute("navigating",wasNavigating,this)}else this.dispatchEvent(new CustomEvent("cell-activate",{detail:{model:this.__getRowModel(cell.parentElement)}}))}_onFocusIn(e){this._isMousedown||this._toggleAttribute("navigating",!0,this);const rootTarget=e.composedPath()[0];rootTarget===this.$.table||rootTarget===this.$.focusexit?(this._predictFocusStepTarget(rootTarget,rootTarget===this.$.table?1:-1).focus(),this._toggleAttribute("interacting",!1,this)):this._detectInteracting(e)}_onFocusOut(e){this._toggleAttribute("navigating",!1,this),this._detectInteracting(e)}_onCellFocusIn(e){if(this._detectInteracting(e),3===e.composedPath().indexOf(this.$.table)){const cell=e.composedPath()[0];this._activeRowGroup=cell.parentNode.parentNode,this._activeRowGroup===this.$.header?this._headerFocusable=cell:this._activeRowGroup===this.$.items?this._itemsFocusable=cell:this._activeRowGroup===this.$.footer&&(this._footerFocusable=cell),cell._content.dispatchEvent(new CustomEvent("cell-focusin",{bubbles:!1}))}this._detectFocusedItemIndex(e)}_onCellFocusOut(e){3===e.composedPath().indexOf(this.$.table)&&e.composedPath()[0]._content.dispatchEvent(new CustomEvent("cell-focusout",{bubbles:!1}))}_detectInteracting(e){this._toggleAttribute("interacting",e.composedPath().some(el=>"vaadin-grid-cell-content"===el.localName),this)}_detectFocusedItemIndex(e){const{rowGroup:rowGroup,row:row}=this._parseEventPath(e.composedPath());rowGroup===this.$.items&&(this._focusedItemIndex=row.index)}_preventScrollerRotatingCellFocus(item,index){item.index===this._focusedItemIndex&&this.hasAttribute("navigating")&&this._activeRowGroup===this.$.items&&(this._navigatingIsHidden=!0,this._toggleAttribute("navigating",!1,this)),index===this._focusedItemIndex&&this._navigatingIsHidden&&(this._navigatingIsHidden=!1,this._toggleAttribute("navigating",!0,this))}_getColumns(rowGroup,rowIndex){let columnTreeLevel=this._columnTree.length-1;return rowGroup===this.$.header?columnTreeLevel=rowIndex:rowGroup===this.$.footer&&(columnTreeLevel=this._columnTree.length-1-rowIndex),this._columnTree[columnTreeLevel]}_resetKeyboardNavigation(){if(this.$.header.firstElementChild&&(this._headerFocusable=Array.from(this.$.header.firstElementChild.children).filter(el=>!el.hidden)[0]),this.$.items.firstElementChild){const firstVisibleIndexRow=this._iterateItems((pidx,vidx)=>{if(this._firstVisibleIndex===vidx)return this.$.items.children[pidx]});firstVisibleIndexRow&&(this._itemsFocusable=Array.from(firstVisibleIndexRow.children).filter(el=>!el.hidden)[0])}this.$.footer.firstElementChild&&(this._footerFocusable=Array.from(this.$.footer.firstElementChild.children).filter(el=>!el.hidden)[0])}_scrollHorizontallyToCell(dstCell){if(dstCell.hasAttribute("frozen")||this._elementMatches(dstCell,'[part~="details-cell"]'))return;const dstCellRect=dstCell.getBoundingClientRect(),dstRow=dstCell.parentNode,dstCellIndex=Array.from(dstRow.children).indexOf(dstCell),tableRect=this.$.table.getBoundingClientRect();let leftBoundary=tableRect.left,rightBoundary=tableRect.right;for(let i=dstCellIndex-1;i>=0;i--){const cell=dstRow.children[i];if(!cell.hasAttribute("hidden")&&!this._elementMatches(cell,'[part~="details-cell"]')&&cell.hasAttribute("frozen")){leftBoundary=cell.getBoundingClientRect().right;break}}for(let i=dstCellIndex+1;i<dstRow.children.length;i++){const cell=dstRow.children[i];if(!cell.hasAttribute("hidden")&&!this._elementMatches(cell,'[part~="details-cell"]')&&cell.hasAttribute("frozen")){rightBoundary=cell.getBoundingClientRect().left;break}}dstCellRect.left<leftBoundary&&(this.$.table.scrollLeft+=Math.round(dstCellRect.left-leftBoundary)),dstCellRect.right>rightBoundary&&(this.$.table.scrollLeft+=Math.round(dstCellRect.right-rightBoundary))}_elementMatches(el,query){return el.matches?el.matches(query):-1!==Array.from(el.parentNode.querySelectorAll(query)).indexOf(el)}})});