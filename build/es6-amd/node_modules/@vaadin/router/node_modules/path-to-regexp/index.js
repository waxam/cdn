module.exports=pathToRegexp,module.exports.parse=parse,module.exports.compile=compile,module.exports.tokensToFunction=tokensToFunction,module.exports.tokensToRegExp=tokensToRegExp;var DEFAULT_DELIMITER="/",DEFAULT_DELIMITERS="./",PATH_REGEXP=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function parse(e,t){for(var r,n=[],o=0,p=0,a="",i=t&&t.delimiter||DEFAULT_DELIMITER,s=t&&t.delimiters||DEFAULT_DELIMITERS,l=!1;null!==(r=PATH_REGEXP.exec(e));){var g=r[0],c=r[1],f=r.index;if(a+=e.slice(p,f),p=f+g.length,c)a+=c[1],l=!0;else{var u="",x=e[p],E=r[2],T=r[3],h=r[4],m=r[5];if(!l&&a.length){var d=a.length-1;s.indexOf(a[d])>-1&&(u=a[d],a=a.slice(0,d))}a&&(n.push(a),a="",l=!1);var R=""!==u&&void 0!==x&&x!==u,y="+"===m||"*"===m,v="?"===m||"*"===m,w=u||i,A=T||h;n.push({name:E||o++,prefix:u,delimiter:w,optional:v,repeat:y,partial:R,pattern:A?escapeGroup(A):"[^"+escapeString(w)+"]+?"})}}return(a||p<e.length)&&n.push(a+e.substr(p)),n}function compile(e,t){return tokensToFunction(parse(e,t))}function tokensToFunction(e){for(var t=new Array(e.length),r=0;r<e.length;r++)"object"==typeof e[r]&&(t[r]=new RegExp("^(?:"+e[r].pattern+")$"));return function(r,n){for(var o="",p=n&&n.encode||encodeURIComponent,a=0;a<e.length;a++){var i=e[a];if("string"!=typeof i){var s,l=r?r[i.name]:void 0;if(Array.isArray(l)){if(!i.repeat)throw new TypeError('Expected "'+i.name+'" to not repeat, but got array');if(0===l.length){if(i.optional)continue;throw new TypeError('Expected "'+i.name+'" to not be empty')}for(var g=0;g<l.length;g++){if(s=p(l[g],i),!t[a].test(s))throw new TypeError('Expected all "'+i.name+'" to match "'+i.pattern+'"');o+=(0===g?i.prefix:i.delimiter)+s}}else if("string"!=typeof l&&"number"!=typeof l&&"boolean"!=typeof l){if(!i.optional)throw new TypeError('Expected "'+i.name+'" to be '+(i.repeat?"an array":"a string"));i.partial&&(o+=i.prefix)}else{if(s=p(String(l),i),!t[a].test(s))throw new TypeError('Expected "'+i.name+'" to match "'+i.pattern+'", but got "'+s+'"');o+=i.prefix+s}}else o+=i}return o}}function escapeString(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function escapeGroup(e){return e.replace(/([=!:$/()])/g,"\\$1")}function flags(e){return e&&e.sensitive?"":"i"}function regexpToRegexp(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return e}function arrayToRegexp(e,t,r){for(var n=[],o=0;o<e.length;o++)n.push(pathToRegexp(e[o],t,r).source);return new RegExp("(?:"+n.join("|")+")",flags(r))}function stringToRegexp(e,t,r){return tokensToRegExp(parse(e,r),t,r)}function tokensToRegExp(e,t,r){for(var n=(r=r||{}).strict,o=!1!==r.start,p=!1!==r.end,a=escapeString(r.delimiter||DEFAULT_DELIMITER),i=r.delimiters||DEFAULT_DELIMITERS,s=[].concat(r.endsWith||[]).map(escapeString).concat("$").join("|"),l=o?"^":"",g=0===e.length,c=0;c<e.length;c++){var f=e[c];if("string"==typeof f)l+=escapeString(f),g=c===e.length-1&&i.indexOf(f[f.length-1])>-1;else{var u=f.repeat?"(?:"+f.pattern+")(?:"+escapeString(f.delimiter)+"(?:"+f.pattern+"))*":f.pattern;t&&t.push(f),f.optional?f.partial?l+=escapeString(f.prefix)+"("+u+")?":l+="(?:"+escapeString(f.prefix)+"("+u+"))?":l+=escapeString(f.prefix)+"("+u+")"}}return p?(n||(l+="(?:"+a+")?"),l+="$"===s?"$":"(?="+s+")"):(n||(l+="(?:"+a+"(?="+s+"))?"),g||(l+="(?="+a+"|"+s+")")),new RegExp(l,flags(r))}function pathToRegexp(e,t,r){return e instanceof RegExp?regexpToRegexp(e,t):Array.isArray(e)?arrayToRegexp(e,t,r):stringToRegexp(e,t,r)}