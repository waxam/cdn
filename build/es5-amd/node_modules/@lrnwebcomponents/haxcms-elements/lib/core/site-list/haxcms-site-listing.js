define(["exports","require","../../../../../@polymer/polymer/polymer-element.js","../../../../../@polymer/polymer/lib/utils/settings.js","../../../../../@polymer/polymer/lib/utils/render-status.js","../../../../../@polymer/iron-ajax/iron-ajax.js","../../../../json-outline-schema/json-outline-schema.js","../../../../simple-toast/simple-toast.js","../../../../simple-modal/simple-modal.js","../../../../jwt-login/jwt-login.js","../../../../simple-colors/simple-colors.js","../../../../simple-colors/lib/simple-colors-picker.js","../../../../sites-listing/sites-listing.js","../../../../map-menu/map-menu.js"],function(_exports,_require,_polymerElement,_settings,_renderStatus,_ironAjax,_jsonOutlineSchema,_simpleToast,_simpleModal,_jwtLogin,_simpleColors,_simpleColorsPicker,_sitesListing,_mapMenu){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.HAXCMSSiteListing=void 0;_require=babelHelpers.interopRequireWildcard(_require);function _templateObject_8e15ed206a8f11e9a3fbc91c56f16a14(){var data=babelHelpers.taggedTemplateLiteral(["\n      <style include=\"simple-colors\">\n        app-toolbar {\n          background-color: rgba(255, 0, 116, 1);\n          color: #ffffff;\n        }\n        paper-icon-button {\n          --paper-icon-button-ink-color: #ffffff;\n        }\n        paper-icon-button + [main-title] {\n          margin-left: 24px;\n        }\n        app-header {\n          color: #ffffff;\n          @apply --layout-fixed-top;\n          --app-header-background-rear-layer: {\n            background-color: rgba(255, 0, 116, 1);\n          }\n        }\n        app-drawer {\n          --app-drawer-scrim-background: rgba(0, 0, 0, 0.6);\n          --app-drawer-content-container: {\n            background-color: rgba(255, 0, 116, 0.8);\n            overflow: scroll;\n            color: #ffffff;\n            padding-left: 8px;\n            padding-right: 8px;\n          }\n        }\n        sites-listing {\n          display: block;\n          margin: 100px 16px 0px 16px;\n        }\n        paper-dialog {\n          width: 60%;\n          min-height: 50%;\n          top: 10%;\n          border-radius: 16px;\n        }\n        paper-input {\n          --paper-input-container-focus-color: #3a0063;\n        }\n        #closedrawer {\n          float: left;\n          margin: 12px -20px 0 8px;\n        }\n        #add {\n          float: right;\n          margin: 12px 8px 0 -20px;\n        }\n        #newsitecolor {\n          padding: 4px;\n          margin: 0;\n          display: inline-flex;\n          vertical-align: middle;\n        }\n        #newsitecolor > * {\n          display: inline-flex;\n          align-self: center;\n          margin-right: 8px;\n          --simple-colors-picker-preview-size: 20px;\n        }\n        eco-json-schema-object {\n          --eco-json-schema-object-form : {\n            -ms-flex: unset;\n            -webkit-flex: unset;\n            flex: unset;\n            -webkit-flex-basis: unset;\n            flex-basis: unset;\n          }\n        }\n        #configform {\n        --eco-json-schema-object-form: {\n          display: block !important;\n        }\n      </style>\n      <jwt-login\n        id=\"jwt\"\n        url=\"[[__loginPath]]\"\n        logout-url=\"[[__logoutPath]]\"\n        jwt=\"{{jwt}}\"\n      ></jwt-login>\n      <iron-ajax\n        id=\"createrequest\"\n        method=\"[[method]]\"\n        body=\"[[createParams]]\"\n        headers='{\"Authorization\": \"Bearer [[jwt]]\"}'\n        content-type=\"application/json\"\n        url=\"[[__createNewSitePath]]\"\n        handle-as=\"json\"\n        on-response=\"handleCreateResponse\"\n      ></iron-ajax>\n      <iron-ajax\n        id=\"downloadrequest\"\n        method=\"[[method]]\"\n        body=\"[[downloadParams]]\"\n        headers='{\"Authorization\": \"Bearer [[jwt]]\"}'\n        content-type=\"application/json\"\n        url=\"[[__downloadSitePath]]\"\n        handle-as=\"json\"\n        on-response=\"handleDownloadResponse\"\n      ></iron-ajax>\n      <iron-ajax\n        id=\"getconfigrequest\"\n        method=\"[[method]]\"\n        body=\"[[configParams]]\"\n        headers='{\"Authorization\": \"Bearer [[jwt]]\"}'\n        content-type=\"application/json\"\n        url=\"[[__getConfigPath]]\"\n        handle-as=\"json\"\n        on-response=\"handleConfigResponse\"\n      ></iron-ajax>\n      <iron-ajax\n        id=\"setconfigrequest\"\n        method=\"[[method]]\"\n        body=\"[[setConfigParams]]\"\n        headers='{\"Authorization\": \"Bearer [[jwt]]\"}'\n        content-type=\"application/json\"\n        url=\"[[__setConfigPath]]\"\n        handle-as=\"json\"\n        on-response=\"handleSetConfigResponse\"\n      ></iron-ajax>\n      <sites-listing\n        id=\"siteslisting\"\n        sites-response=\"{{__sitesResponse}}\"\n        sites=\"{{__sites}}\"\n        data-source=\"[[_dataSource]]\"\n        edit-mode=\"[[editMode]]\"\n      ></sites-listing>\n      <app-header reveals>\n        <app-toolbar>\n          <paper-icon-button\n            icon=\"menu\"\n            on-tap=\"drawerToggle\"\n          ></paper-icon-button>\n          <div main-title>[[title]]</div>\n          <paper-icon-button\n            on-tap=\"_settingsTap\"\n            id=\"settings\"\n            icon=\"icons:settings\"\n            hidden$=\"[[!loggedIn]]\"\n          ></paper-icon-button>\n          <paper-tooltip\n            for=\"settings\"\n            position=\"bottom\"\n            offset=\"12\"\n            animation-delay=\"200\"\n            >Settings</paper-tooltip\n          >\n          <paper-icon-button\n            on-tap=\"_loginUserRoutine\"\n            id=\"login\"\n            icon=\"[[__loginIcon]]\"\n          ></paper-icon-button>\n          <paper-tooltip\n            for=\"login\"\n            position=\"bottom\"\n            offset=\"12\"\n            animation-delay=\"200\"\n            >[[__loginText]]</paper-tooltip\n          >\n        </app-toolbar>\n      </app-header>\n      <app-drawer id=\"drawer\" swipe-open>\n        <paper-icon-button\n          id=\"closedrawer\"\n          icon=\"icons:close\"\n          on-tap=\"drawerToggle\"\n        ></paper-icon-button>\n        <paper-tooltip\n          for=\"closedrawer\"\n          position=\"bottom\"\n          offset=\"12\"\n          animation-delay=\"200\"\n          >Close</paper-tooltip\n        >\n        <paper-icon-button\n          on-tap=\"_addTap\"\n          id=\"add\"\n          icon=\"icons:add\"\n        ></paper-icon-button>\n        <paper-tooltip\n          for=\"add\"\n          position=\"bottom\"\n          offset=\"12\"\n          animation-delay=\"200\"\n          >Add site</paper-tooltip\n        >\n        <h3\n          style=\"margin: 18px; padding: 6px; border-bottom: 1px solid #ffffff; text-align: center; font-weight: normal;\"\n        >\n          Site list\n        </h3>\n        <map-menu\n          id=\"mapmenu\"\n          items=\"{{outline}}\"\n          data=\"[[__sites]]\"\n          selected=\"{{activeItemID}}\"\n        ></map-menu>\n      </app-drawer>\n      <paper-dialog id=\"newdialog\" with-backdrop>\n        <h3>Create new site</h3>\n        <paper-dialog-scrollable>\n          <paper-input\n            id=\"newsitetitle\"\n            label=\"Title\"\n            required\n            autofocus\n            value=\"{{siteTitle}}\"\n          ></paper-input>\n          <paper-input\n            id=\"newsitedescription\"\n            label=\"Description\"\n          ></paper-input>\n          <paper-input\n            id=\"newsiteimage\"\n            label=\"Image\"\n            value=\"[[activeItem.metadata.image]]\"\n          ></paper-input>\n          <label for=\"newsitecolor\">Select a color:</label>\n          <simple-colors-picker id=\"newsitecolor\"></simple-colors-picker>\n          <simple-picker id=\"newsitetheme\" label=\"Theme\"></simple-picker>\n          <label for=\"newsiteicon\">Select an icon:</label>\n          <simple-icon-picker\n            id=\"newsiteicon\"\n            hide-option-labels\n            value=\"[[activeItem.metadata.icon]]\"\n          ></simple-icon-picker>\n        </paper-dialog-scrollable>\n        <div class=\"buttons\">\n          <paper-button on-tap=\"_createSite\" dialog-confirm id=\"create\" raised\n            >Let's go!</paper-button\n          >\n          <paper-button dialog-dismiss>cancel</paper-button>\n        </div>\n      </paper-dialog>\n      <paper-dialog id=\"itemdialog\" with-backdrop>\n        <paper-dialog-scrollable>\n          <magazine-cover\n            image=\"[[activeItem.metadata.image]]\"\n            header=\"[[activeItem.title]]\"\n            subheader=\"[[activeItem.description]]\"\n            action=\"Access site\"\n            icon=\"[[activeItem.metadata.icon]]\"\n            event-data=\"[[activeItem]]\"\n            event-name=\"haxcms-load-site\"\n          >\n          </magazine-cover>\n        </paper-dialog-scrollable>\n        <div class=\"buttons\">\n          <iron-icon\n            icon=\"editor:format-color-fill\"\n            style$=\"color:[[activeItem.metadata.hexCode]]\"\n          ></iron-icon\n          >[[activeItem.metadata.hexCode]]\n          <iron-icon icon=\"av:web\"></iron-icon>Theme:\n          [[activeItem.metadata.theme.name]]\n          <paper-icon-button\n            id=\"editsite\"\n            icon=\"icons:settings\"\n            style=\"color:black\"\n          ></paper-icon-button>\n          <paper-tooltip\n            for=\"edit\"\n            position=\"bottom\"\n            offset=\"12\"\n            animation-delay=\"200\"\n            >change details</paper-tooltip\n          >\n          <paper-icon-button\n            id=\"archivesite\"\n            icon=\"icons:archive\"\n            dialog-dismiss\n            style=\"color:grey\"\n          ></paper-icon-button>\n          <paper-tooltip\n            for=\"archivesite\"\n            position=\"top\"\n            offset=\"12\"\n            animation-delay=\"200\"\n            >archive site</paper-tooltip\n          >\n          <paper-icon-button\n            on-tap=\"_downloadSite\"\n            id=\"download\"\n            icon=\"icons:file-download\"\n            style=\"color:black\"\n          ></paper-icon-button>\n          <paper-tooltip\n            for=\"download\"\n            position=\"top\"\n            offset=\"12\"\n            animation-delay=\"200\"\n            >Download zip</paper-tooltip\n          >\n        </div>\n      </paper-dialog>\n      <paper-dialog id=\"settingsdialog\" with-backdrop>\n        <h3>Edit HAXCMS configuration</h3>\n        <paper-dialog-scrollable>\n          <eco-json-schema-object id=\"settingsform\"></eco-json-schema-object>\n        </paper-dialog-scrollable>\n        <div class=\"buttons\">\n          <paper-button\n            on-tap=\"_saveConfig\"\n            dialog-confirm\n            id=\"saveconfig\"\n            raised\n            >Save</paper-button\n          >\n          <paper-button dialog-dismiss>cancel</paper-button>\n        </div>\n      </paper-dialog>\n    "]);_templateObject_8e15ed206a8f11e9a3fbc91c56f16a14=function _templateObject_8e15ed206a8f11e9a3fbc91c56f16a14(){return data};return data}/**
 * `haxcms-site-listing`
 * `A listing of all sites being managed by this instance.`
 */var HAXCMSSiteListing=/*#__PURE__*/function(_PolymerElement){babelHelpers.inherits(HAXCMSSiteListing,_PolymerElement);/**
   * created life cycle
   */function HAXCMSSiteListing(){var _this;babelHelpers.classCallCheck(this,HAXCMSSiteListing);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(HAXCMSSiteListing).call(this));(0,_settings.setPassiveTouchGestures)(!0);new Promise(function(res,rej){return _require.default(["../../../../../@polymer/paper-button/paper-button.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/iron-icon/iron-icon.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/paper-icon-button/paper-icon-button.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/app-layout/app-header/app-header.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/app-layout/app-toolbar/app-toolbar.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/app-layout/app-drawer/app-drawer.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/iron-icons/iron-icons.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/iron-icons/editor-icons.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/iron-icons/notification-icons.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/iron-icons/av-icons.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/iron-icons/device-icons.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/iron-icons/image-icons.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/paper-item/paper-item.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/paper-input/paper-input.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/paper-dialog/paper-dialog.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/paper-dialog-scrollable/paper-dialog-scrollable.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../../@polymer/paper-tooltip/paper-tooltip.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../simple-picker/simple-picker.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../simple-icon-picker/simple-icon-picker.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../magazine-cover/magazine-cover.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../eco-json-schema-form/eco-json-schema-form.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../eco-json-schema-form/lib/eco-json-schema-object.js"],res,rej)});window.JSONOutlineSchema.requestAvailability();window.SimpleModal.requestAvailability();window.SimpleToast.requestAvailability();window.HAXCMS={};return _this}/**
   * Store the tag name to make it easier to obtain directly.
   * @notice function name must be here for tooling to operate correctly
   */babelHelpers.createClass(HAXCMSSiteListing,[{key:"drawerToggle",/**
   * Toggle drawer open
   */value:function drawerToggle(e){this.shadowRoot.querySelector("#drawer").toggle()}/**
   * Site response has changed.
   */},{key:"__sitesResponseChanged",value:function __sitesResponseChanged(newValue){var _this2=this;if(newValue){this.title=newValue.title;setTimeout(function(){if(_this2.jwt){_this2.shadowRoot.querySelector("#siteslisting").shadowRoot.querySelector("#list").querySelector("[data-site-id=\"item-new\"]").hidden=!1;_this2.shadowRoot.querySelector("#mapmenu").shadowRoot.querySelector("#builder").shadowRoot.querySelector("#item-new").hidden=!1;_this2.shadowRoot.querySelector("#add").hidden=!1}else{_this2.shadowRoot.querySelector("#siteslisting").shadowRoot.querySelector("#list").querySelector("[data-site-id=\"item-new\"]").hidden=!0;_this2.shadowRoot.querySelector("#mapmenu").shadowRoot.querySelector("#builder").shadowRoot.querySelector("#item-new").hidden=!0;_this2.shadowRoot.querySelector("#add").hidden=!0}},100)}}},{key:"_dataSourceChanged",value:function _dataSourceChanged(newValue){if(newValue){this._dataSource=newValue+"?"+Math.floor(Date.now()/1e3)}}/**
   * Request a user login if we need one or log out
   */},{key:"_jwtLoggedIn",value:function _jwtLoggedIn(e){if(e.detail){this.loggedIn=!0}else{this.loggedIn=!1}}/**
   * Request a user login if we need one or log out
   */},{key:"_editModeChanged",value:function _editModeChanged(newValue){if(newValue){this.__editIcon="icons:check"}else{this.__editIcon="icons:create"}}/**
   * Login state changed
   */},{key:"_loggedInChanged",value:function _loggedInChanged(newValue,oldValue){if(babelHelpers.typeof(oldValue)!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))){if(newValue){this.__loginText="Log out";this.__loginIcon="icons:account-circle";var evt=new CustomEvent("simple-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:"Welcome, log in successful!",duration:4e3}});this.dispatchEvent(evt);this.shadowRoot.querySelector("#add").hidden=!1;this.shadowRoot.querySelector("#siteslisting").shadowRoot.querySelector("#list").querySelector("[data-site-id=\"item-new\"]").hidden=!1;this.shadowRoot.querySelector("#mapmenu").shadowRoot.querySelector("#builder").shadowRoot.querySelector("#item-new").hidden=!1}else{this.__loginText="Log in";this.__loginIcon="icons:power-settings-new";var _evt=new CustomEvent("simple-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:"You logged out",duration:4e3}});this.dispatchEvent(_evt);this.shadowRoot.querySelector("#add").hidden=!0;if(this.shadowRoot.querySelector("#siteslisting").shadowRoot.querySelector("#list").querySelector("[data-site-id=\"item-new\"]")){this.shadowRoot.querySelector("#siteslisting").shadowRoot.querySelector("#list").querySelector("[data-site-id=\"item-new\"]").hidden=!0}if(this.shadowRoot.querySelector("#mapmenu").shadowRoot.querySelector("#builder").shadowRoot.querySelector("#item-new")){this.shadowRoot.querySelector("#mapmenu").shadowRoot.querySelector("#builder").shadowRoot.querySelector("#item-new").hidden=!0}}}}/**
   * Request a user login if we need one or log out
   */},{key:"_jwtChanged",value:function _jwtChanged(newValue){if(newValue){this.__loginText="Log out";this.__loginIcon="icons:account-circle"}else{this.__loginText="Log in";this.__loginIcon="icons:power-settings-new"}}/**
   * Request a user login if we need one or log out
   */},{key:"_loginUserRoutine",value:function _loginUserRoutine(e){this.shadowRoot.querySelector("#jwt").toggleLogin()}/**
   * Use events for real value in theme.
   */},{key:"_themeChanged",value:function _themeChanged(e){// while not the actual spec for our theme metadata, this is the primary key
// so the backend can update it correctly on response
if(e.detail.value){this.set("activeItem.metadata.theme",e.detail.value);this.notifyPath("activeItem.metadata.theme")}}/**
   * Use events for real value in color area.
   */},{key:"_colorChanged",value:function _colorChanged(e){this.set("activeItem.metadata.cssVariable",e.detail.value);this.notifyPath("activeItem.metadata.cssVariable");this.set("activeItem.metadata.hexCode",_simpleColors.SimpleColors.colors[e.detail.value.replace("--simple-colors-default-theme-","").replace("-7","")][6]);this.notifyPath("activeItem.metadata.hexCode")}/**
   * Add button clicked, trick DOM into clicking the add new site item.
   */},{key:"_addTap",value:function _addTap(e){var itemNew=this.shadowRoot.querySelector("#siteslisting").shadowRoot.querySelector("#list").querySelector("[data-site-id=\"item-new\"]");if(itemNew){itemNew.click()}}/**
   * Toggle edit state
   */},{key:"_editTap",value:function _editTap(e){this.editMode=!this.editMode}/**
   * _settingsTap
   */},{key:"_settingsTap",value:function _settingsTap(e){this._loadConfig();this.shadowRoot.querySelector("#settingsdialog").opened=!0}/**
   * User clicked on the flyout menu, set that item to active.
   */},{key:"_mapMenuSelection",value:function _mapMenuSelection(e){// run through available sites and find the matching ID
var findSite=this.__sites.filter(function(site){if(site.id!==e.detail){return!1}return!0});// if we found one, make it the top level item
if(0<findSite.length){this.set("activeItem",{});this.set("activeItem",findSite.pop());this.notifyPath("activeItem.*")}}/**
   * Selected item has changed
   */},{key:"_activeItemChanged",value:function _activeItemChanged(newValue,oldvalue){if(babelHelpers.typeof(newValue)!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))&&babelHelpers.typeof(newValue.id)!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))){// for new items we need the new item form
if("item-new"===newValue.id){this.shadowRoot.querySelector("#newdialog").opened=!0;this.shadowRoot.querySelector("#itemdialog").opened=!1}else{this.shadowRoot.querySelector("#newdialog").opened=!1;this.shadowRoot.querySelector("#itemdialog").opened=!0}}// it's possible to have NO item in scope, ensure everything closes :)
else if(babelHelpers.typeof(newValue)!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))&&babelHelpers.typeof(newValue.id)!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))){this.shadowRoot.querySelector("#newdialog").opened=!1;this.shadowRoot.querySelector("#itemdialog").opened=!1;this.shadowRoot.querySelector("#drawer").opened=!1}}/**
   * Attached life cycle
   */},{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(HAXCMSSiteListing.prototype),"connectedCallback",this).call(this);(0,_renderStatus.afterNextRender)(this,function(){this.__loginPath=window.appSettings.login;this.__logoutPath=window.appSettings.logout;var themeOptions=[],firstTheme=null;for(var theme in window.appSettings.themes){var item=[{alt:window.appSettings.themes[theme].name,value:theme}];themeOptions.push(item);if(!firstTheme){firstTheme=theme}}this.shadowRoot.querySelector("#newsitetheme").options=themeOptions;if(!this.shadowRoot.querySelector("#newsitetheme").value){this.shadowRoot.querySelector("#newsitetheme").value=firstTheme}this.__setConfigPath=window.appSettings.setConfigPath;this.__getConfigPath=window.appSettings.getConfigPath;this.__createNewSitePath=window.appSettings.createNewSitePath;this.__downloadSitePath=window.appSettings.downloadSitePath;// @todo support state routing for loadActiveSite
document.body.addEventListener("sites-listing-item-selected",this._itemSelected.bind(this));document.body.addEventListener("haxcms-load-site",this.loadActiveSite.bind(this));this.shadowRoot.querySelector("#mapmenu").addEventListener("selected",this._mapMenuSelection.bind(this));this.shadowRoot.querySelector("#newsitetheme").addEventListener("change",this._themeChanged.bind(this));this.shadowRoot.querySelector("#newsitecolor").addEventListener("change",this._colorChanged.bind(this));this.shadowRoot.querySelector("#jwt").addEventListener("jwt-logged-in",this._jwtLoggedIn.bind(this));this.shadowRoot.querySelector("#siteslisting").addEventListener("item-overlay-option-selected",this._itemOptionSelected.bind(this));this.shadowRoot.querySelector("#siteslisting").addEventListener("item-overlay-op-changed",this._itemOpChanged.bind(this))})}/**
   * detached life cycle
   */},{key:"disconnectedCallback",value:function disconnectedCallback(){// @todo support state routing for loadActiveSite
document.body.removeEventListener("sites-listing-item-selected",this._itemSelected.bind(this));document.body.removeEventListener("haxcms-load-site",this.loadActiveSite.bind(this));this.shadowRoot.querySelector("#mapmenu").removeEventListener("selected",this._mapMenuSelection.bind(this));this.shadowRoot.querySelector("#newsitetheme").removeEventListener("change",this._themeChanged.bind(this));this.shadowRoot.querySelector("#newsitecolor").removeEventListener("change",this._colorChanged.bind(this));this.shadowRoot.querySelector("#jwt").removeEventListener("jwt-logged-in",this._jwtLoggedIn.bind(this));this.shadowRoot.querySelector("#siteslisting").removeEventListener("item-overlay-option-selected",this._itemOptionSelected.bind(this));this.shadowRoot.querySelector("#siteslisting").removeEventListener("item-overlay-op-changed",this._itemOpChanged.bind(this));babelHelpers.get(babelHelpers.getPrototypeOf(HAXCMSSiteListing.prototype),"disconnectedCallback",this).call(this)}/**
   * Ready life cycle
   */},{key:"ready",value:function ready(){babelHelpers.get(babelHelpers.getPrototypeOf(HAXCMSSiteListing.prototype),"ready",this).call(this);// set jwt from local storage bin
this.jwt=localStorage.getItem("jwt")}/**
   * Simple method of loading whatever's been dictated as active.
   */},{key:"loadActiveSite",value:function loadActiveSite(e){var findSite=this.__sites.filter(function(site){if(site.id!==e.detail.id){return!1}return!0}),item=findSite.pop();// if location isn't there, push out to it
if(item.location){window.open(item.location)}else{window.open(this.basePath+"_sites/"+item.metadata.siteName+"/")}}/**
   * New button clicked, open modal
   */},{key:"_itemSelected",value:function _itemSelected(e){this.set("activeItem",{});this.set("activeItem",e.detail);this.notifyPath("activeItem.*")}/**
   * Create a new site button was clicked
   */},{key:"_createSite",value:function _createSite(e){// ship off a new call
this.set("createParams.siteName",this.shadowRoot.querySelector("#newsitetitle").value);this.notifyPath("createParams.siteName");this.set("createParams.description",this.shadowRoot.querySelector("#newsitedescription").value);this.notifyPath("createParams.description");// need to pull this from the active item bc of data binding silly
this.set("createParams.theme",this.activeItem.metadata.theme);this.notifyPath("createParams.theme");this.set("createParams.hexCode",this.activeItem.metadata.hexCode);this.notifyPath("createParams.hexCode");this.set("createParams.cssVariable",this.activeItem.metadata.cssVariable);this.notifyPath("createParams.cssVariable");this.set("createParams.image",this.shadowRoot.querySelector("#newsiteimage").value);this.notifyPath("createParams.image");this.set("createParams.icon",this.shadowRoot.querySelector("#newsiteicon").icon);this.notifyPath("createParams.icon");// pass along the jwt for user "session" purposes
this.set("createParams.jwt",this.jwt);this.notifyPath("createParams.jwt");this.shadowRoot.querySelector("#newsitetitle").value="";this.shadowRoot.querySelector("#newsitedescription").value=null;this.shadowRoot.querySelector("#createrequest").generateRequest()}/**
   * Download a new site button was clicked
   */},{key:"_downloadSite",value:function _downloadSite(e){// ship off a new call
this.set("downloadParams.siteName",this.activeItem.metadata.siteName);this.notifyPath("downloadParams.siteName");// pass along the jwt for user "session" purposes
this.set("downloadParams.jwt",this.jwt);this.notifyPath("downloadParams.jwt");this.shadowRoot.querySelector("#downloadrequest").generateRequest()}/**
   * Load configuration
   */},{key:"_loadConfig",value:function _loadConfig(){// pass along the jwt for user "session" purposes
this.set("configParams.jwt",this.jwt);this.notifyPath("configParams.jwt");this.set("configParams.token",this.createParams.token);this.notifyPath("configParams.token");this.shadowRoot.querySelector("#getconfigrequest").generateRequest()}/**
   * Save configuration
   */},{key:"_saveConfig",value:function _saveConfig(e){window.HAXCMS.config.values=this.shadowRoot.querySelector("#settingsform").value;// pass along the jwt for user "session" purposes
this.set("setConfigParams.values",{});this.set("setConfigParams.values",window.HAXCMS.config.values);this.notifyPath("setConfigParams.values.*");this.set("setConfigParams.jwt",this.jwt);this.notifyPath("setConfigParams.jwt");this.set("setConfigParams.token",this.createParams.token);this.notifyPath("setConfigParams.token");this.shadowRoot.querySelector("#setconfigrequest").generateRequest()}/**
   * Create a new site button was clicked
   */},{key:"handleCreateResponse",value:function handleCreateResponse(e){// update the listing data
this._dataSource=this.dataSource+"?"+Math.floor(Date.now()/1e3);this.dispatchEvent(new CustomEvent("sites-listing-refresh-data",{bubbles:!0,composed:!0,cancelable:!1,detail:e.detail.response}));var evt=new CustomEvent("simple-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:e.detail.response.title+" created successfully!",duration:4e3}});this.dispatchEvent(evt)}},{key:"handleConfigResponse",value:function handleConfigResponse(e){window.HAXCMS.config=e.detail.response;this.shadowRoot.querySelector("#settingsform").set("schema",window.HAXCMS.config.schema);this.shadowRoot.querySelector("#settingsform").set("value",window.HAXCMS.config.values)}},{key:"handleSetConfigResponse",value:function handleSetConfigResponse(e){this.shadowRoot.querySelector("#settingsdialog").opened=!1;var evt=new CustomEvent("simple-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:"HAXCMS configuration updated!",duration:4e3}});this.dispatchEvent(evt)}/**
   * Download a site
   */},{key:"handleDownloadResponse",value:function handleDownloadResponse(e){// fire incase anyone cares
this.dispatchEvent(new CustomEvent("download-site-listing",{bubbles:!0,composed:!0,cancelable:!1,detail:e.detail.response}));var element=document.createElement("a");element.setAttribute("href",e.detail.response.link);element.style.display="none";document.body.appendChild(element);element.click();document.body.removeChild(element);var evt=new CustomEvent("simple-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:this.activeItem.title+" downloaded successfully!",duration:4e3}});this.dispatchEvent(evt)}/**
   * Option selected in an operation in context
   */},{key:"_itemOptionSelected",value:function _itemOptionSelected(e){var element=e.detail.element;switch(e.detail.operation){case"remove":if("option1"===e.detail.option){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:"Deleting this",duration:4e3}});this.dispatchEvent(evt);// @todo send call out the door to delete callback
}break;case"duplicate":if("option1"===e.detail.option){var _evt2=new CustomEvent("simple-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:"Duplicating this",duration:4e3}});this.dispatchEvent(_evt2);// @todo send call out the door to duplicate callback
}break;case"move":if("option1"===e.detail.option){var _evt3=new CustomEvent("simple-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:"Move this item left",duration:4e3}});this.dispatchEvent(_evt3)}else{var _evt4=new CustomEvent("simple-toast-show",{bubbles:!0,composed:!0,cancelable:!0,detail:{text:"Move this item right",duration:4e3}});this.dispatchEvent(_evt4)}// @todo send call out the door to commit the move callback
break;}}/**
   * Selected operation changed; we use this for edit mode detection
   */},{key:"_itemOpChanged",value:function _itemOpChanged(e){var element=e.detail.element;if("edit"===e.detail.operation){var findSite=this.__sites.filter(function(site){if(site.id!==element.getAttribute("data-site-id")){return!1}return!0});// if we found one, make it the top level item
if(0<findSite.length){this.set("activeItem",{});this.set("activeItem",findSite.pop());this.notifyPath("activeItem.*");// simulate clicking on the edit button that's in this tab
this.shadowRoot.querySelector("#edit").click()}}}}],[{key:"tag",get:function get(){return"haxcms-site-listing"}// render function
},{key:"template",get:function get(){return(0,_polymerElement.html)(_templateObject_8e15ed206a8f11e9a3fbc91c56f16a14())}},{key:"properties",get:function get(){return{method:{type:String,value:"POST"},/**
       * Title
       */title:{type:String,value:"Site list"},/**
       * Site title
       */siteTitle:{type:String},/**
       * Sites response change
       */__sitesResponse:{type:String,observer:"__sitesResponseChanged"},/**
       * Base path of where this is located.
       */basePath:{type:String},/**
       * Data Source to power the loading of sites in JSON Outline Schema format.
       */dataSource:{type:String,observer:"_dataSourceChanged"},/**
       * JSON Web token
       */jwt:{type:String,observer:"_jwtChanged"},/**
       * Request params for creating a new site
       */createParams:{type:Object,value:{}},/**
       * Request params for downloading a new site
       */downloadParams:{type:Object,value:{}},/**
       * Request params for loading config
       */configParams:{type:Object,value:{}},/**
       * Request params for loading config
       */setConfigParams:{type:Object,value:{}},/**
       * Active item that's being reviewed / has bubbled up.
       */activeItem:{type:Object,notify:!0,observer:"_activeItemChanged"},/**
       * Logged in state
       */loggedIn:{type:Boolean,value:!1,notify:!0,reflectToAttribute:!0,observer:"_loggedInChanged"},/**
       * Edit mode
       */editMode:{type:Boolean,notify:!0,reflectToAttribute:!0,value:!1,observer:"_editModeChanged"}}}}]);return HAXCMSSiteListing}(_polymerElement.PolymerElement);_exports.HAXCMSSiteListing=HAXCMSSiteListing;window.customElements.define(HAXCMSSiteListing.tag,HAXCMSSiteListing)});