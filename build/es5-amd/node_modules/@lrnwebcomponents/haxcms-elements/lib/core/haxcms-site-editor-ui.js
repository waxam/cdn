define(["exports","require","../../../../@polymer/polymer/polymer-element.js","./haxcms-site-store.js","../../../../mobx/lib/mobx.module.js","../../../../@polymer/polymer/lib/legacy/polymer.dom.js","../../../../@polymer/polymer/lib/utils/render-status.js"],function(_exports,_require,_polymerElement,_haxcmsSiteStore,_mobxModule,_polymerDom,_renderStatus){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.HAXCMSSiteEditorUI=void 0;_require=babelHelpers.interopRequireWildcard(_require);function _templateObject_386d9ed0984e11e98da46dc60ea6a0fa(){var data=babelHelpers.taggedTemplateLiteral(["\n      <style>\n        :host {\n          display: block;\n          position: fixed;\n          right: 0;\n          bottom: 0;\n          opacity: 0.9;\n          transition: 0.3s all ease-in-out;\n          background-color: var(--haxcms-color, white);\n          padding: 0px 8px;\n          border-top-left-radius: 10px;\n          border-left: 2px solid black;\n          border-top: 2px solid black;\n          min-width: 154px;\n          width: 72px;\n          line-height: 54px;\n          height: 54px;\n          z-index: 10000;\n          visibility: visible;\n        }\n        :host([edit-mode]) {\n          min-width: 154px;\n        }\n        :host *[hidden] {\n          display: none;\n        }\n        paper-fab:not(:defined),\n        paper-tooltip:not(:defined),\n        paper-icon-button:not(:defined) {\n          display: none !important;\n        }\n        paper-fab {\n          display: inline-flex;\n          width: 48px;\n          height: 48px;\n          vertical-align: middle;\n          line-height: 48px;\n          background-color: black;\n          color: var(--haxcms-color, white);\n          transition: 0.3s all ease-in-out;\n          padding: 8px;\n          margin: 0;\n          position: relative;\n          @apply --shadow-elevation-8dp;\n        }\n        :host([painting]) {\n          opacity: 0;\n          visibility: hidden;\n        }\n        paper-icon-button {\n          padding: 8px;\n          width: 48px;\n          min-width: 48px;\n          height: 48px;\n          border-radius: 50%;\n          margin: 3px 3px 0 3px;\n          background-color: black;\n          color: var(--haxcms-color, rgba(255, 0, 116, 1));\n          transition: 0.3s all ease-in-out;\n          @apply --shadow-elevation-8dp;\n        }\n        paper-fab:hover,\n        paper-fab:focus,\n        paper-fab:active,\n        paper-icon-button:hover,\n        paper-icon-button:focus,\n        paper-icon-button:active {\n          background-color: black;\n          color: white;\n        }\n        #editbutton,\n        #editdetails,\n        #deletebutton {\n          visibility: hidden;\n          opacity: 0;\n        }\n        :host([page-allowed]) #editbutton,\n        :host([page-allowed]) #editdetails,\n        :host([page-allowed]) #deletebutton {\n          visibility: visible;\n          opacity: 1;\n        }\n        :host([edit-mode]) #editbutton {\n          width: 60px;\n          z-index: 1001;\n          border-radius: 0;\n          margin: 0;\n          padding: 0;\n          color: white;\n          background-color: var(--paper-blue-500, blue) !important;\n          position: absolute;\n          height: 54px;\n        }\n        .wrapper {\n          width: 0px;\n          height: 54px;\n          line-height: 54px;\n          color: black;\n          display: inline-flex;\n          transition: 0.3s all ease-in-out;\n          overflow: hidden;\n          padding: 0;\n          margin: 0;\n          vertical-align: top;\n        }\n        :host([menu-mode]) .wrapper {\n          width: 250px;\n        }\n        @media screen and (max-width: 600px) {\n          :host([menu-mode]) .wrapper {\n            width: 200px;\n          }\n          .active-title {\n            display: none;\n          }\n        }\n        :host([menu-mode]) {\n          opacity: 1;\n          width: unset;\n        }\n        :host([edit-mode][menu-mode]) #editbutton {\n          width: 100% !important;\n        }\n        :host(:hover),\n        :host(:active),\n        :host(:focus) {\n          opacity: 1;\n        }\n        .active-title {\n          font-size: 11px;\n          font-weight: bold;\n          width: 100px;\n          text-overflow: ellipsis;\n          overflow: hidden;\n          line-height: 54px;\n          padding: 0 8px;\n        }\n        paper-tooltip {\n          --paper-tooltip-background: #000000;\n          --paper-tooltip-opacity: 1;\n          --paper-tooltip-text-color: #ffffff;\n          --paper-tooltip-delay-in: 0;\n          --paper-tooltip: {\n            border-radius: 0;\n          }\n        }\n      </style>\n      <paper-fab\n        id=\"menubutton\"\n        icon=\"icons:menu\"\n        on-click=\"_menuButtonTap\"\n        title=\"Expand menu\"\n      ></paper-fab>\n      <paper-fab\n        id=\"cancelbutton\"\n        icon=\"icons:cancel\"\n        on-click=\"_cancelButtonTap\"\n        hidden$=\"[[!editMode]]\"\n        title=\"Cancel editing\"\n      ></paper-fab>\n      <paper-fab\n        id=\"editbutton\"\n        icon=\"[[__editIcon]]\"\n        on-click=\"_editButtonTap\"\n        title$=\"[[__editText]]\"\n      ></paper-fab>\n      <paper-fab\n        id=\"editdetails\"\n        icon=\"icons:fingerprint\"\n        on-click=\"_editDetailsButtonTap\"\n        title=\"Edit page details\"\n      ></paper-fab>\n      <paper-fab\n        id=\"deletebutton\"\n        icon=\"icons:delete\"\n        on-click=\"_deleteButtonTap\"\n        title=\"Delete current page\"\n      ></paper-fab>\n      <div class=\"wrapper\">\n        <div class=\"active-title\">[[activeTitle]]</div>\n        <paper-icon-button\n          id=\"addbutton\"\n          icon=\"icons:add\"\n          on-click=\"_addButtonTap\"\n          title=\"Add new page\"\n        ></paper-icon-button>\n        <paper-icon-button\n          id=\"outlinebutton\"\n          icon=\"icons:list\"\n          on-click=\"_outlineButtonTap\"\n          title=\"Edit site outline\"\n        ></paper-icon-button>\n        <paper-icon-button\n          id=\"manifestbutton\"\n          icon=\"icons:settings\"\n          on-click=\"_manifestButtonTap\"\n          title=\"Edit site settings\"\n        ></paper-icon-button>\n      </div>\n      <paper-tooltip for=\"menubutton\" position=\"top\" offset=\"14\"\n        >Menu</paper-tooltip\n      >\n      <paper-tooltip for=\"cancelbutton\" position=\"top\" offset=\"14\"\n        >Cancel</paper-tooltip\n      >\n      <paper-tooltip for=\"editbutton\" position=\"top\" offset=\"14\"\n        >[[__editText]]</paper-tooltip\n      >\n      <paper-tooltip for=\"editdetails\" position=\"top\" offset=\"14\"\n        >Details</paper-tooltip\n      >\n      <paper-tooltip for=\"deletebutton\" position=\"top\" offset=\"14\"\n        >Delete</paper-tooltip\n      >\n      <paper-tooltip for=\"addbutton\" position=\"top\" offset=\"14\"\n        >Add</paper-tooltip\n      >\n      <paper-tooltip for=\"outlinebutton\" position=\"top\" offset=\"14\"\n        >Outline</paper-tooltip\n      >\n      <paper-tooltip for=\"manifestbutton\" position=\"top\" offset=\"14\"\n        >Site details</paper-tooltip\n      >\n    "]);_templateObject_386d9ed0984e11e98da46dc60ea6a0fa=function _templateObject_386d9ed0984e11e98da46dc60ea6a0fa(){return data};return data}/**
 * `haxcms-site-editor-ui`
 * `haxcms editor element buttons that you see`
 *
 * @demo demo/index.html
 * @microcopy - the mental model for this element
 */var HAXCMSSiteEditorUI=/*#__PURE__*/function(_PolymerElement){babelHelpers.inherits(HAXCMSSiteEditorUI,_PolymerElement);babelHelpers.createClass(HAXCMSSiteEditorUI,null,[{key:"tag",/**
   * Store the tag name to make it easier to obtain directly.
   * @notice function name must be here for tooling to operate correctly
   */get:function get(){return"haxcms-site-editor-ui"}}]);function HAXCMSSiteEditorUI(){var _this;babelHelpers.classCallCheck(this,HAXCMSSiteEditorUI);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(HAXCMSSiteEditorUI).call(this));_this.__disposer=[];new Promise(function(res,rej){return _require.default(["../../../../@polymer/paper-icon-button/paper-icon-button.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../simple-modal/simple-modal.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../@polymer/iron-icons/editor-icons.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../../@polymer/paper-fab/paper-fab.js"],res,rej)});return _this}// render function
babelHelpers.createClass(HAXCMSSiteEditorUI,[{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(HAXCMSSiteEditorUI.prototype),"connectedCallback",this).call(this);(0,_renderStatus.afterNextRender)(this,function(){var _this2=this;new Promise(function(res,rej){return _require.default(["../../../../@polymer/paper-tooltip/paper-tooltip.js"],res,rej)});new Promise(function(res,rej){return _require.default(["./haxcms-outline-editor-dialog.js"],res,rej)});// this ensures that an initial paint won't get a cached copy of the site.json file
// this is more than possible given that it will register to most backends
// as a static file rather than dynamic end point as it is in this instance (sorta)
this.dispatchEvent(new CustomEvent("haxcms-trigger-update",{bubbles:!0,composed:!0,cancelable:!1,detail:!0}));(0,_mobxModule.autorun)(function(reaction){_this2.editMode=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.editMode);_this2.__disposer.push(reaction)});(0,_mobxModule.autorun)(function(reaction){var activeItem=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.activeItem);if(activeItem&&activeItem.id){_this2.activeTitle=activeItem.title;_this2.pageAllowed=!0}else{_this2.pageAllowed=!1}_this2.__disposer.push(reaction)})})}},{key:"disconnectedCallback",value:function disconnectedCallback(){for(var i in this.__disposer){this.__disposer[i].dispose()}babelHelpers.get(babelHelpers.getPrototypeOf(HAXCMSSiteEditorUI.prototype),"disconnectedCallback",this).call(this)}/**
   * toggle state on button tap
   */},{key:"_editButtonTap",value:function _editButtonTap(e){this.editMode=!this.editMode;// save button shifted to edit
if(!this.editMode){this.dispatchEvent(new CustomEvent("haxcms-save-node",{bubbles:!0,composed:!0,cancelable:!1,detail:_haxcmsSiteStore.store.activeItem}))}}},{key:"_editDetailsButtonTap",value:function _editDetailsButtonTap(e){var normalizedEvent=(0,_polymerDom.dom)(e),evt=new CustomEvent("haxcms-load-node-fields",{bubbles:!0,composed:!0,cancelable:!1,detail:normalizedEvent.localTarget});window.dispatchEvent(evt)}/**
   * toggle menu state
   */},{key:"_menuButtonTap",value:function _menuButtonTap(e){this.menuMode=!this.menuMode}},{key:"_cancelButtonTap",value:function _cancelButtonTap(e){this.editMode=!1;this.dispatchEvent(new CustomEvent("hax-cancel",{bubbles:!0,composed:!0,cancelable:!1,detail:e.detail}))}/**
   * Add button hit
   * @todo simplify this to just what's needed; no crazy options
   */},{key:"_addButtonTap",value:function _addButtonTap(e){this.__newForm=document.createElement("eco-json-schema-object");var outline=window.JSONOutlineSchema.requestAvailability();// get a prototype schema for an item
this.__newForm.schema=outline.getItemSchema("item");// drop these for now cause we just care about title
delete this.__newForm.schema.properties.id;delete this.__newForm.schema.properties.description;delete this.__newForm.schema.properties.order;delete this.__newForm.schema.properties.parent;delete this.__newForm.schema.properties.metadata;delete this.__newForm.schema.properties.indent;this.__newForm.schema.properties.title.value="";var b1=document.createElement("paper-button");b1.raised=!0;var icon=document.createElement("iron-icon");icon.icon="icons:add";b1.appendChild(icon);b1.appendChild(document.createTextNode("Create page"));b1.style.color="white";b1.style.backgroundColor="#2196f3";b1.addEventListener("click",this._createNewItem.bind(this));var b2=document.createElement("paper-button");b2.appendChild(document.createTextNode("cancel"));b2.setAttribute("dialog-dismiss","dialog-dismiss");var b=document.createElement("span");b.appendChild(b1);b.appendChild(b2);var evt=new CustomEvent("simple-modal-show",{bubbles:!0,composed:!0,cancelable:!1,detail:{title:"Add a new page",elements:{content:this.__newForm,buttons:b},invokedBy:this.$.addbutton,clone:!1,modal:!0}});window.dispatchEvent(evt)}/**
   * create new item
   */},{key:"_createNewItem",value:function _createNewItem(e){var evt=new CustomEvent("haxcms-create-node",{bubbles:!0,composed:!0,cancelable:!1,detail:{values:this.__newForm.value}});this.dispatchEvent(evt)}/**
   * Fire item
   */},{key:"_updateItem",value:function _updateItem(e){var normalizedEvent=(0,_polymerDom.dom)(e),local=normalizedEvent.localTarget,values;if(!local.__form){values=local.parentNode.__form.value}else{values=local.__form.value}// fire event with details for saving
window.dispatchEvent(new CustomEvent("haxcms-save-node-details",{bubbles:!0,composed:!0,cancelable:!0,detail:values}));// fire event to close the modal
window.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,composed:!0,cancelable:!0,detail:{}}))}/**
   * Delete button hit, confirm they want to do this
   */},{key:"_deleteButtonTap",value:function _deleteButtonTap(e){var c=document.createElement("span");c.innerHTML="\"".concat(_haxcmsSiteStore.store.activeItem.title,"\" will be removed from the outline but its content stays on the file system.");var b1=document.createElement("paper-button"),icon=document.createElement("iron-icon");icon.icon="icons:delete";b1.appendChild(icon);b1.raised=!0;b1.appendChild(document.createTextNode("Confirm"));b1.style.color="white";b1.style.backgroundColor="#ee0000";b1.addEventListener("click",this._deleteActive.bind(this));var b2=document.createElement("paper-button");b2.appendChild(document.createTextNode("cancel"));b2.setAttribute("dialog-dismiss","dialog-dismiss");var b=document.createElement("span");b.appendChild(b1);b.appendChild(b2);var evt=new CustomEvent("simple-modal-show",{bubbles:!0,composed:!0,cancelable:!1,detail:{title:"Are you sure you want to delete this page?",elements:{content:c,buttons:b},invokedBy:this.$.deletebutton,clone:!1,modal:!0}});window.dispatchEvent(evt)}/**
   * delete active item
   */},{key:"_deleteActive",value:function _deleteActive(e){var evt=new CustomEvent("haxcms-delete-node",{bubbles:!0,composed:!0,cancelable:!1,detail:{item:_haxcmsSiteStore.store.activeItem}});this.dispatchEvent(evt)}/**
   * toggle state on button tap
   */},{key:"_outlineButtonTap",value:function _outlineButtonTap(e){var evt=new CustomEvent("simple-modal-show",{bubbles:!0,composed:!0,cancelable:!1,detail:{title:"Edit site outline",elements:{content:document.createElement("haxcms-outline-editor-dialog")},invokedBy:this.$.outlinebutton,clone:!1,modal:!0}});window.dispatchEvent(evt)}/**
   * toggle state on button tap
   */},{key:"_manifestButtonTap",value:function _manifestButtonTap(e){window.dispatchEvent(new CustomEvent("haxcms-load-site-fields",{bubbles:!0,composed:!0,cancelable:!1,detail:e.target}))}/**
   * Edit state has changed.
   */},{key:"_editModeChanged",value:function _editModeChanged(newValue,oldValue){if(newValue){// enable it some how
this.__editIcon="icons:save";this.__editText="Save"}else{// disable it some how
this.__editIcon="editor:mode-edit";this.__editText="Edit"}if(babelHelpers.typeof(oldValue)!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))){_haxcmsSiteStore.store.editMode=newValue}}/**
   * Note changes to the outline / structure of the page's items
   */},{key:"_outlineEditModeChanged",value:function _outlineEditModeChanged(newValue,oldValue){this.dispatchEvent(new CustomEvent("haxcms-outline-edit-mode-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:newValue}))}/**
   * Note changes to the outline / structure of the page's items
   */},{key:"_manifestEditModeChanged",value:function _manifestEditModeChanged(newValue,oldValue){this.dispatchEvent(new CustomEvent("haxcms-manifest-edit-mode-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:newValue}))}}],[{key:"template",get:function get(){return(0,_polymerElement.html)(_templateObject_386d9ed0984e11e98da46dc60ea6a0fa())}},{key:"properties",get:function get(){return{/**
       * small visual lock that events break on initial paint
       */painting:{type:Boolean,value:!0,reflectToAttribute:!0},/**
       * page allowed
       */pageAllowed:{type:Boolean,value:!1,reflectToAttribute:!0},/**
       * if the page is in an edit state or not
       */editMode:{type:Boolean,reflectToAttribute:!0,observer:"_editModeChanged",value:!1,notify:!0},/**
       * if the menu is open or not
       */menuMode:{type:Boolean,reflectToAttribute:!0,value:!0},/**
       * Manifest editing state
       */manifestEditMode:{type:Boolean,reflectToAttribute:!0,observer:"_manifestEditModeChanged",value:!1,notify:!0},activeTitle:{type:String}}}}]);return HAXCMSSiteEditorUI}(_polymerElement.PolymerElement);_exports.HAXCMSSiteEditorUI=HAXCMSSiteEditorUI;window.customElements.define(HAXCMSSiteEditorUI.tag,HAXCMSSiteEditorUI)});