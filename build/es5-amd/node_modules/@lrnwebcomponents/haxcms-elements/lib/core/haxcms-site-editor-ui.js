define(["exports","../../../../@polymer/polymer/polymer-element.js","./haxcms-site-store.js","../../../../mobx/lib/mobx.module.js","../../../../@polymer/polymer/lib/legacy/polymer.dom.js","../../../../@polymer/polymer/lib/utils/render-status.js","../../../../@polymer/iron-icons/editor-icons.js","../../../../@polymer/paper-tooltip/paper-tooltip.js","../../../../@polymer/paper-fab/paper-fab.js","../../../simple-modal/simple-modal.js","./haxcms-outline-editor-dialog.js","./haxcms-manifest-editor-dialog.js"],function(_exports,_polymerElement,_haxcmsSiteStore,_mobxModule,_polymerDom,_renderStatus){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.HAXCMSSiteEditorUI=void 0;function _templateObject_33a9741054c311e99540492d34b1bf39(){var data=babelHelpers.taggedTemplateLiteral(["\n      <style>\n        :host {\n          display: block;\n          position: fixed;\n          right: 0;\n          bottom: 0;\n          opacity: 0.9;\n          transition: 0.6s all ease-in-out;\n          background-color: var(--haxcms-color, white);\n          padding: 0px 8px;\n          border-top-left-radius: 10px;\n          border-left: 2px solid black;\n          border-top: 2px solid black;\n          min-width: 154px;\n          width: 72px;\n          line-height: 54px;\n          height: 54px;\n          z-index: 10000;\n          visibility: visible;\n        }\n        :host([edit-mode]) {\n          min-width: 154px;\n        }\n        :host *[hidden] {\n          display: none;\n        }\n        paper-fab {\n          display: inline-flex;\n          width: 48px;\n          height: 48px;\n          vertical-align: middle;\n          line-height: 48px;\n          background-color: black;\n          color: var(--haxcms-color, white);\n          transition: 0.3s all ease-in-out;\n          padding: 8px;\n          margin: 0;\n          position: relative;\n          @apply --shadow-elevation-8dp;\n        }\n        :host([painting]) {\n          opacity: 0;\n          visibility: hidden;\n        }\n        paper-icon-button {\n          padding: 8px;\n          width: 48px;\n          min-width: 48px;\n          height: 48px;\n          border-radius: 50%;\n          margin: 3px 3px 0 3px;\n          background-color: black;\n          color: var(--haxcms-color, rgba(255, 0, 116, 1));\n          transition: 0.3s all ease-in-out;\n          @apply --shadow-elevation-8dp;\n        }\n        paper-fab:hover,\n        paper-fab:focus,\n        paper-fab:active,\n        paper-icon-button:hover,\n        paper-icon-button:focus,\n        paper-icon-button:active {\n          background-color: black;\n          color: white;\n        }\n        #editbutton,\n        #editdetails,\n        #deletebutton {\n          visibility: hidden;\n          opacity: 0;\n        }\n        :host([page-allowed]) #editbutton,\n        :host([page-allowed]) #editdetails,\n        :host([page-allowed]) #deletebutton {\n          visibility: visible;\n          opacity: 1;\n        }\n        :host([edit-mode]) #editbutton {\n          width: 60px;\n          z-index: 1001;\n          border-radius: 0;\n          margin: 0;\n          padding: 0;\n          color: white;\n          background-color: var(--paper-blue-500, blue) !important;\n          position: absolute;\n          height: 54px;\n        }\n        .wrapper {\n          width: 0px;\n          height: 54px;\n          line-height: 54px;\n          color: black;\n          display: inline-flex;\n          transition: 0.3s all ease-in-out;\n          overflow: hidden;\n          padding: 0;\n          margin: 0;\n          vertical-align: top;\n        }\n        :host([menu-mode]) .wrapper {\n          width: 250px;\n        }\n        @media screen and (max-width: 600px) {\n          :host([menu-mode]) .wrapper {\n            width: 200px;\n          }\n          .active-title {\n            display: none;\n          }\n        }\n        :host([menu-mode]) {\n          opacity: 1;\n          width: unset;\n        }\n        :host([edit-mode][menu-mode]) #editbutton {\n          width: 100% !important;\n        }\n        :host(:hover),\n        :host(:active),\n        :host(:focus) {\n          opacity: 1;\n        }\n        .active-title {\n          font-size: 11px;\n          font-weight: bold;\n          width: 100px;\n          text-overflow: ellipsis;\n          overflow: hidden;\n          line-height: 54px;\n          padding: 0 8px;\n        }\n        paper-tooltip {\n          --paper-tooltip-background: #000000;\n          --paper-tooltip-opacity: 1;\n          --paper-tooltip-text-color: #ffffff;\n          --paper-tooltip-delay-in: 0;\n          --paper-tooltip: {\n            border-radius: 0;\n          }\n        }\n      </style>\n      <paper-fab\n        id=\"menubutton\"\n        icon=\"icons:menu\"\n        on-tap=\"_menuButtonTap\"\n        title=\"Expand menu\"\n      ></paper-fab>\n      <paper-fab\n        id=\"cancelbutton\"\n        icon=\"icons:cancel\"\n        on-tap=\"_cancelButtonTap\"\n        hidden$=\"[[!editMode]]\"\n        title=\"Cancel editing\"\n      ></paper-fab>\n      <paper-fab\n        id=\"editbutton\"\n        icon=\"[[__editIcon]]\"\n        on-tap=\"_editButtonTap\"\n        title$=\"[[__editText]]\"\n      ></paper-fab>\n      <paper-fab\n        id=\"editdetails\"\n        icon=\"icons:fingerprint\"\n        on-tap=\"_editDetailsButtonTap\"\n        title=\"Edit page details\"\n      ></paper-fab>\n      <paper-fab\n        id=\"deletebutton\"\n        icon=\"icons:delete\"\n        on-tap=\"_deleteButtonTap\"\n        title=\"Delete current page\"\n      ></paper-fab>\n      <div class=\"wrapper\">\n        <div class=\"active-title\">[[activeTitle]]</div>\n        <paper-icon-button\n          id=\"addbutton\"\n          icon=\"icons:add\"\n          on-tap=\"_addButtonTap\"\n          title=\"Add new page\"\n        ></paper-icon-button>\n        <paper-icon-button\n          id=\"outlinebutton\"\n          icon=\"icons:list\"\n          on-tap=\"_outlineButtonTap\"\n          title=\"Edit site outline\"\n        ></paper-icon-button>\n        <paper-icon-button\n          id=\"manifestbutton\"\n          icon=\"icons:settings\"\n          on-tap=\"_manifestButtonTap\"\n          title=\"Edit site settings\"\n        ></paper-icon-button>\n      </div>\n      <paper-tooltip for=\"menubutton\" position=\"top\" offset=\"14\"\n        >Menu</paper-tooltip\n      >\n      <paper-tooltip for=\"cancelbutton\" position=\"top\" offset=\"14\"\n        >Cancel</paper-tooltip\n      >\n      <paper-tooltip for=\"editbutton\" position=\"top\" offset=\"14\"\n        >[[__editText]]</paper-tooltip\n      >\n      <paper-tooltip for=\"editdetails\" position=\"top\" offset=\"14\"\n        >Details</paper-tooltip\n      >\n      <paper-tooltip for=\"deletebutton\" position=\"top\" offset=\"14\"\n        >Delete</paper-tooltip\n      >\n      <paper-tooltip for=\"addbutton\" position=\"top\" offset=\"14\"\n        >Add</paper-tooltip\n      >\n      <paper-tooltip for=\"outlinebutton\" position=\"top\" offset=\"14\"\n        >Outline</paper-tooltip\n      >\n      <paper-tooltip for=\"manifestbutton\" position=\"top\" offset=\"14\"\n        >Site details</paper-tooltip\n      >\n    "]);_templateObject_33a9741054c311e99540492d34b1bf39=function(){return data};return data}var HAXCMSSiteEditorUI=function(_PolymerElement){babelHelpers.inherits(HAXCMSSiteEditorUI,_PolymerElement);function HAXCMSSiteEditorUI(){babelHelpers.classCallCheck(this,HAXCMSSiteEditorUI);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(HAXCMSSiteEditorUI).apply(this,arguments))}babelHelpers.createClass(HAXCMSSiteEditorUI,[{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(HAXCMSSiteEditorUI.prototype),"connectedCallback",this).call(this);this.__disposer=[];(0,_renderStatus.afterNextRender)(this,function(){var _this=this;(0,_mobxModule.autorun)(function(reaction){var activeItem=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.activeItem);if(activeItem&&activeItem.id){_this.activeTitle=activeItem.title;_this.pageAllowed=!0}else{_this.pageAllowed=!1}_this.__disposer.push(reaction)})})}},{key:"disconnectedCallback",value:function disconnectedCallback(){for(var i in this.__disposer){this.__disposer[i].dispose()}babelHelpers.get(babelHelpers.getPrototypeOf(HAXCMSSiteEditorUI.prototype),"disconnectedCallback",this).call(this)}},{key:"_editButtonTap",value:function _editButtonTap(){this.editMode=!this.editMode;window.cmsSiteEditor.instance.haxCmsSiteEditorElement.editMode=this.editMode;if(!this.editMode){this.dispatchEvent(new CustomEvent("haxcms-save-node",{bubbles:!0,composed:!0,cancelable:!1,detail:_haxcmsSiteStore.store.activeItem}))}}},{key:"_editDetailsButtonTap",value:function _editDetailsButtonTap(e){var normalizedEvent=(0,_polymerDom.dom)(e),evt=new CustomEvent("haxcms-load-node-fields",{bubbles:!0,composed:!0,cancelable:!1,detail:normalizedEvent.localTarget});window.dispatchEvent(evt)}},{key:"_menuButtonTap",value:function _menuButtonTap(){this.menuMode=!this.menuMode}},{key:"_cancelButtonTap",value:function _cancelButtonTap(e){this.editMode=!1;window.cmsSiteEditor.instance.haxCmsSiteEditorElement.editMode=!1;this.dispatchEvent(new CustomEvent("hax-cancel",{bubbles:!0,composed:!0,cancelable:!1,detail:e.detail}))}},{key:"_addButtonTap",value:function _addButtonTap(){this.__newForm=document.createElement("eco-json-schema-object");var outline=window.JSONOutlineSchema.requestAvailability();this.__newForm.schema=outline.getItemSchema("item");delete this.__newForm.schema.properties.id;delete this.__newForm.schema.properties.description;delete this.__newForm.schema.properties.order;delete this.__newForm.schema.properties.parent;delete this.__newForm.schema.properties.metadata;delete this.__newForm.schema.properties.indent;this.__newForm.schema.properties.title.value="";var b1=document.createElement("paper-button");b1.raised=!0;var icon=document.createElement("iron-icon");icon.icon="icons:add";b1.appendChild(icon);b1.appendChild(document.createTextNode("Create page"));b1.style.color="white";b1.style.backgroundColor="#2196f3";b1.addEventListener("click",this._createNewItem.bind(this));var b2=document.createElement("paper-button");b2.appendChild(document.createTextNode("cancel"));b2.setAttribute("dialog-dismiss","dialog-dismiss");var b=document.createElement("span");b.appendChild(b1);b.appendChild(b2);var evt=new CustomEvent("simple-modal-show",{bubbles:!0,composed:!0,cancelable:!1,detail:{title:"Add a new page",elements:{content:this.__newForm,buttons:b},invokedBy:this.$.addbutton,clone:!1}});window.dispatchEvent(evt)}},{key:"_createNewItem",value:function _createNewItem(){var evt=new CustomEvent("haxcms-create-node",{bubbles:!0,composed:!0,cancelable:!1,detail:{values:this.__newForm.value}});this.dispatchEvent(evt)}},{key:"_updateItem",value:function _updateItem(e){var normalizedEvent=(0,_polymerDom.dom)(e),local=normalizedEvent.localTarget,values;if(!local.__form){values=local.parentNode.__form.value}else{values=local.__form.value}window.dispatchEvent(new CustomEvent("haxcms-save-node-details",{bubbles:!0,composed:!0,cancelable:!0,detail:values}));window.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,composed:!0,cancelable:!0,detail:{}}))}},{key:"_deleteButtonTap",value:function _deleteButtonTap(){var c=document.createElement("span");c.innerHTML="\"".concat(_haxcmsSiteStore.store.activeItem.title,"\" will be removed from the outline but its content stays on the file system.");var b1=document.createElement("paper-button"),icon=document.createElement("iron-icon");icon.icon="icons:delete";b1.appendChild(icon);b1.raised=!0;b1.appendChild(document.createTextNode("Confirm"));b1.style.color="white";b1.style.backgroundColor="#ee0000";b1.addEventListener("tap",this._deleteActive.bind(this));var b2=document.createElement("paper-button");b2.appendChild(document.createTextNode("cancel"));b2.setAttribute("dialog-dismiss","dialog-dismiss");var b=document.createElement("span");b.appendChild(b1);b.appendChild(b2);var evt=new CustomEvent("simple-modal-show",{bubbles:!0,composed:!0,cancelable:!1,detail:{title:"Are you sure you want to delete this page?",elements:{content:c,buttons:b},invokedBy:this.$.deletebutton,clone:!1}});window.dispatchEvent(evt)}},{key:"_deleteActive",value:function _deleteActive(){var evt=new CustomEvent("haxcms-delete-node",{bubbles:!0,composed:!0,cancelable:!1,detail:{item:_haxcmsSiteStore.store.activeItem}});this.dispatchEvent(evt)}},{key:"_outlineButtonTap",value:function _outlineButtonTap(){var evt=new CustomEvent("simple-modal-show",{bubbles:!0,composed:!0,cancelable:!1,detail:{title:"Edit site outline",elements:{content:document.createElement("haxcms-outline-editor-dialog")},invokedBy:this.$.outlinebutton,clone:!1}});window.dispatchEvent(evt)}},{key:"_manifestButtonTap",value:function _manifestButtonTap(){if(!this.__manifestEditor){this.__manifestEditor=document.createElement("haxcms-manifest-editor-dialog")}var evt=new CustomEvent("simple-modal-show",{bubbles:!0,composed:!0,cancelable:!1,detail:{title:_haxcmsSiteStore.store.routerManifest.title+": site details",elements:{content:this.__manifestEditor},invokedBy:this.$.manifestbutton,clone:!1}});window.dispatchEvent(evt)}},{key:"_editModeChanged",value:function _editModeChanged(newValue,oldValue){if(newValue){this.__editIcon="icons:save";this.__editText="Save"}else{this.__editIcon="editor:mode-edit";this.__editText="Edit"}if(babelHelpers.typeof(oldValue)!=="undefined"){this.dispatchEvent(new CustomEvent("haxcms-edit-mode-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:newValue}));window.HaxStore.write("editMode",newValue,this)}}},{key:"_outlineEditModeChanged",value:function _outlineEditModeChanged(newValue){this.dispatchEvent(new CustomEvent("haxcms-outline-edit-mode-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:newValue}))}},{key:"_manifestEditModeChanged",value:function _manifestEditModeChanged(newValue){this.dispatchEvent(new CustomEvent("haxcms-manifest-edit-mode-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:newValue}))}}],[{key:"tag",get:function get(){return"haxcms-site-editor-ui"}},{key:"template",get:function get(){return(0,_polymerElement.html)(_templateObject_33a9741054c311e99540492d34b1bf39())}},{key:"properties",get:function get(){return{painting:{type:Boolean,value:!0,reflectToAttribute:!0},pageAllowed:{type:Boolean,value:!1,reflectToAttribute:!0},editMode:{type:Boolean,reflectToAttribute:!0,observer:"_editModeChanged",value:!1,notify:!0},menuMode:{type:Boolean,reflectToAttribute:!0,value:!0},manifestEditMode:{type:Boolean,reflectToAttribute:!0,observer:"_manifestEditModeChanged",value:!1,notify:!0},activeTitle:{type:String}}}}]);return HAXCMSSiteEditorUI}(_polymerElement.PolymerElement);_exports.HAXCMSSiteEditorUI=HAXCMSSiteEditorUI;window.customElements.define(HAXCMSSiteEditorUI.tag,HAXCMSSiteEditorUI)});