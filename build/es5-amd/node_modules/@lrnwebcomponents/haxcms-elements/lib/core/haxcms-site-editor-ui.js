define(["../../../../@polymer/polymer/polymer-legacy.js","../../../../@polymer/polymer/lib/legacy/polymer.dom.js","../../../../@polymer/iron-icons/editor-icons.js","../../../../@polymer/paper-tooltip/paper-tooltip.js","../../../../@polymer/paper-fab/paper-fab.js","../../../eco-json-schema-form/eco-json-schema-form.js","../../../simple-modal/simple-modal.js","./haxcms-outline-editor-dialog.js","./haxcms-manifest-editor-dialog.js","./haxcms-site-store.js","../../../../mobx/lib/mobx.module.js"],function(_polymerLegacy,_polymerDom,_editorIcons,_paperTooltip,_paperFab,_ecoJsonSchemaForm,_simpleModal,_haxcmsOutlineEditorDialog,_haxcmsManifestEditorDialog,_haxcmsSiteStore,_mobxModule){"use strict";function _templateObject_3df0aa30490411e990ee3fd35bb8725b(){var data=babelHelpers.taggedTemplateLiteral(["\n    <style>\n      :host {\n        display: block;\n        position: fixed;\n        right: 0;\n        bottom: 0;\n        opacity: 0.6;\n        transition: 0.6s all ease-in-out;\n        background-color: var(--haxcms-color, rgba(255, 0, 116, 1));\n        padding: 0px 10px;\n        border-top-left-radius: 10px;\n        border-left: 2px solid black;\n        border-top: 2px solid black;\n        min-width: 84px;\n        width: 90px;\n        line-height: 50px;\n        height: 50px;\n        z-index: 10000;\n        visibility: visible;\n      }\n      :host([edit-mode]) {\n        min-width: 126px;\n      }\n      :host *[hidden] {\n        display: none;\n      }\n      paper-fab {\n        display: inline-flex;\n        width: 40px;\n        height: 40px;\n        vertical-align: middle;\n        line-height: 40px;\n        background-color: black;\n        color: var(--haxcms-color, rgba(255, 0, 116, 1));\n        transition: 0.3s all ease-in-out;\n        padding: 8px;\n        margin: 0;\n        position: relative;\n        @apply --shadow-elevation-8dp;\n      }\n      :host([painting]) {\n        opacity: 0;\n        visibility: hidden;\n      }\n      paper-icon-button {\n        padding: 8px;\n        width: 40px;\n        min-width: 40px;\n        height: 40px;\n        border-radius: 50%;\n        margin: 5px 2px 0 2px;\n        background-color: rgba(0, 0, 0, 0.2);\n        transition: 0.3s all ease-in-out;\n        @apply --shadow-elevation-8dp;\n      }\n      paper-icon-button:hover,\n      paper-icon-button:focus,\n      paper-icon-button:active {\n        background-color: rgba(0, 0, 0, 0.4);\n      }\n      #editbutton,\n      #editdetails,\n      #deletebutton {\n        visibility: hidden;\n        opacity: 0;\n      }\n      :host([page-allowed]) #editbutton,\n      :host([page-allowed]) #editdetails,\n      :host([page-allowed]) #deletebutton {\n        visibility: visible;\n        opacity: 1;\n      }\n      :host([edit-mode]) #editbutton {\n        width: 50px;\n        z-index: 1001;\n        border-radius: 0;\n        margin: 0;\n        padding: 0;\n        color: white;\n        background-color: var(--paper-blue-500, blue) !important;\n        position: absolute;\n        height: 50px;\n      }\n      .wrapper {\n        width: 0px;\n        height: 50px;\n        line-height: 50px;\n        color: black;\n        display: inline-flex;\n        transition: 0.3s all ease-in-out;\n        overflow: hidden;\n        padding: 0;\n        margin: 0;\n        vertical-align: top;\n      }\n      :host([menu-mode]) .wrapper {\n        width: 275px;\n      }\n      :host([menu-mode]) {\n        opacity: 0.8;\n        width: unset;\n      }\n      :host([edit-mode][menu-mode]) #editbutton {\n        width: 100% !important;\n      }\n      :host(:hover),\n      :host(:active),\n      :host(:focus) {\n        opacity: 1;\n      }\n      .main-title {\n        font-size: 11px;\n        font-weight: bold;\n        width: 150px;\n        text-overflow: ellipsis;\n        overflow: hidden;\n        line-height: 50px;\n        padding: 0 10px;\n      }\n    </style>\n    <paper-fab\n      id=\"menubutton\"\n      icon=\"icons:menu\"\n      on-tap=\"_menuButtonTap\"\n      aria-label=\"Expand menu\"\n    ></paper-fab>\n    <paper-fab\n      id=\"cancelbutton\"\n      icon=\"icons:cancel\"\n      on-tap=\"_cancelButtonTap\"\n      hidden$=\"[[!editMode]]\"\n      aria-label=\"Cancel editing\"\n    ></paper-fab>\n    <paper-fab\n      id=\"editbutton\"\n      icon=\"[[__editIcon]]\"\n      on-tap=\"_editButtonTap\"\n      aria-label$=\"[[__editText]]\"\n    ></paper-fab>\n    <paper-fab\n      id=\"editdetails\"\n      icon=\"icons:fingerprint\"\n      on-tap=\"_editDetailsButtonTap\"\n      aria-label$=\"Edit page details\"\n    ></paper-fab>\n    <paper-fab\n      id=\"deletebutton\"\n      icon=\"icons:delete\"\n      on-tap=\"_deleteButtonTap\"\n      aria-label=\"Delete current page\"\n    ></paper-fab>\n    <div class=\"wrapper\">\n      <div class=\"main-title\">[[activeItem.title]]</div>\n      <paper-icon-button\n        id=\"addbutton\"\n        icon=\"icons:add\"\n        on-tap=\"_addButtonTap\"\n        aria-label=\"Add new page\"\n      ></paper-icon-button>\n      <paper-icon-button\n        id=\"outlinebutton\"\n        icon=\"icons:list\"\n        on-tap=\"_outlineButtonTap\"\n        aria-label=\"Edit site outline\"\n      ></paper-icon-button>\n      <paper-icon-button\n        id=\"manifestbutton\"\n        icon=\"icons:settings\"\n        on-tap=\"_manifestButtonTap\"\n        aria-label=\"Edit site settings\"\n      ></paper-icon-button>\n    </div>\n    <paper-tooltip for=\"menubutton\" position=\"top\" offset=\"14\"\n      >Menu</paper-tooltip\n    >\n    <paper-tooltip for=\"cancelbutton\" position=\"top\" offset=\"14\"\n      >Cancel</paper-tooltip\n    >\n    <paper-tooltip for=\"editbutton\" position=\"top\" offset=\"14\"\n      >[[__editText]]</paper-tooltip\n    >\n    <paper-tooltip for=\"editdetails\" position=\"top\" offset=\"14\"\n      >Details</paper-tooltip\n    >\n    <paper-tooltip for=\"deletebutton\" position=\"top\" offset=\"14\"\n      >Delete</paper-tooltip\n    >\n    <paper-tooltip for=\"addbutton\" position=\"top\" offset=\"14\"\n      >Add</paper-tooltip\n    >\n    <paper-tooltip for=\"outlinebutton\" position=\"top\" offset=\"14\"\n      >Outline</paper-tooltip\n    >\n    <paper-tooltip for=\"manifestbutton\" position=\"top\" offset=\"14\"\n      >Site details</paper-tooltip\n    >\n  "]);_templateObject_3df0aa30490411e990ee3fd35bb8725b=function(){return data};return data}(0,_polymerLegacy.Polymer)({_template:(0,_polymerLegacy.html)(_templateObject_3df0aa30490411e990ee3fd35bb8725b()),is:"haxcms-site-editor-ui",properties:{painting:{type:Boolean,value:!0,reflectToAttribute:!0},activeItem:{type:Object,observer:"_activeItemChanged"},pageAllowed:{type:Boolean,value:!1,reflectToAttribute:!0},editMode:{type:Boolean,reflectToAttribute:!0,observer:"_editModeChanged",value:!1,notify:!0},menuMode:{type:Boolean,reflectToAttribute:!0,value:!1},manifestEditMode:{type:Boolean,reflectToAttribute:!0,observer:"_manifestEditModeChanged",value:!1,notify:!0}},attached:function attached(){var _this=this;this.__disposer=(0,_mobxModule.autorun)(function(){_this.manifest=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.routerManifest)})},detached:function detached(){this.__disposer()},_activeItemChanged:function _activeItemChanged(newValue){if(newValue.id){this.pageAllowed=!0}else{this.pageAllowed=!1}},_editButtonTap:function _editButtonTap(){this.editMode=!this.editMode;window.cmsSiteEditor.instance.haxCmsSiteEditorElement.editMode=this.editMode;if(!this.editMode){this.fire("haxcms-save-page",this.activeItem)}},_editDetailsButtonTap:function _editDetailsButtonTap(){this.__newForm=document.createElement("eco-json-schema-object");var outline=window.JSONOutlineSchema.requestAvailability();this.__newForm.schema=outline.getItemSchema("item");delete this.__newForm.schema.properties.id;delete this.__newForm.schema.properties.description;delete this.__newForm.schema.properties.order;delete this.__newForm.schema.properties.parent;delete this.__newForm.schema.properties.metadata;delete this.__newForm.schema.properties.details;delete this.__newForm.schema.properties.indent;for(var n in this.activeItem){if("undefined"!==typeof this.__newForm.schema.properties[n]){if("location"===n){this.__newForm.schema.properties[n].value=this.activeItem[n].replace("pages/","").replace("/index.html","")}else{this.__newForm.schema.properties[n].value=this.activeItem[n]}}}var b1=document.createElement("paper-button");b1.raised=!0;var icon=document.createElement("iron-icon");icon.icon="icons:save";b1.appendChild(icon);b1.appendChild(document.createTextNode("Update page"));b1.style.backgroundColor=document.body.style.getPropertyValue("--haxcms-color");b1.__form=this.__newForm;b1.addEventListener("click",this._updateItem.bind(this));var b2=document.createElement("paper-button");b2.appendChild(document.createTextNode("cancel"));b2.setAttribute("dialog-dismiss","dialog-dismiss");var b=document.createElement("span");b.appendChild(b1);b.appendChild(b2);var evt=new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!1,detail:{title:this.activeItem.title+": edit details",elements:{content:this.__newForm,buttons:b},invokedBy:this.$.editdetails,clone:!1}});window.dispatchEvent(evt)},_menuButtonTap:function _menuButtonTap(){this.menuMode=!this.menuMode},_cancelButtonTap:function _cancelButtonTap(e){this.editMode=!1;window.cmsSiteEditor.instance.haxCmsSiteEditorElement.editMode=!1;this.fire("hax-cancel",e.detail)},_addButtonTap:function _addButtonTap(){this.__newForm=document.createElement("eco-json-schema-object");var outline=window.JSONOutlineSchema.requestAvailability();this.__newForm.schema=outline.getItemSchema("item");delete this.__newForm.schema.properties.id;delete this.__newForm.schema.properties.description;delete this.__newForm.schema.properties.order;delete this.__newForm.schema.properties.parent;delete this.__newForm.schema.properties.metadata;delete this.__newForm.schema.properties.indent;this.__newForm.schema.properties.title.value="";var b1=document.createElement("paper-button");b1.raised=!0;b1.appendChild(document.createTextNode("Create page"));b1.addEventListener("click",this._createNewItem.bind(this));var b2=document.createElement("paper-button");b2.appendChild(document.createTextNode("cancel"));b2.setAttribute("dialog-dismiss","dialog-dismiss");var b=document.createElement("span");b.appendChild(b1);b.appendChild(b2);var evt=new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!1,detail:{title:"Add a new page",elements:{content:this.__newForm,buttons:b},invokedBy:this.$.addbutton,clone:!1}});window.dispatchEvent(evt)},_createNewItem:function _createNewItem(){var evt=new CustomEvent("haxcms-create-page",{bubbles:!0,cancelable:!1,detail:{values:this.__newForm.value}});this.dispatchEvent(evt)},_updateItem:function _updateItem(e){var normalizedEvent=(0,_polymerDom.dom)(e),local=normalizedEvent.localTarget,values;if(!local.__form){values=local.parentNode.__form.value}else{values=local.__form.value}values.id=this.activeItem.id;window.dispatchEvent(new CustomEvent("haxcms-save-page-details",{bubbles:!0,cancelable:!0,detail:values}));window.dispatchEvent(new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}}))},_deleteButtonTap:function _deleteButtonTap(){var c=document.createElement("span");c.innerHTML="\"".concat(this.activeItem.title,"\" will be removed from the outline but its content stays on the file system.");var b1=document.createElement("paper-button");b1.raised=!0;b1.appendChild(document.createTextNode("Confirm"));b1.addEventListener("tap",this._deleteActive.bind(this));var b2=document.createElement("paper-button");b2.appendChild(document.createTextNode("cancel"));b2.setAttribute("dialog-dismiss","dialog-dismiss");var b=document.createElement("span");b.appendChild(b1);b.appendChild(b2);var evt=new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!1,detail:{title:"Are you sure you want to delete this page?",elements:{content:c,buttons:b},invokedBy:this.$.deletebutton,clone:!1}});window.dispatchEvent(evt)},_deleteActive:function _deleteActive(){var evt=new CustomEvent("haxcms-delete-page",{bubbles:!0,cancelable:!1,detail:{item:this.activeItem}});this.dispatchEvent(evt)},_outlineButtonTap:function _outlineButtonTap(){var c=document.createElement("haxcms-outline-editor-dialog");c.set("manifest",window.cmsSiteEditor.instance.haxCmsSiteEditorElement.manifest);var evt=new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!1,detail:{title:"Edit site outline",elements:{content:c},invokedBy:this.$.outlinebutton,clone:!1}});window.dispatchEvent(evt)},_manifestButtonTap:function _manifestButtonTap(){if(!this.__manifestEditor){this.__manifestEditor=document.createElement("haxcms-manifest-editor-dialog")}var evt=new CustomEvent("simple-modal-show",{bubbles:!0,cancelable:!1,detail:{title:this.manifest.title+": site details",elements:{content:this.__manifestEditor},invokedBy:this.$.manifestbutton,clone:!1}});window.dispatchEvent(evt)},_editModeChanged:function _editModeChanged(newValue){if(newValue){this.__editIcon="icons:save";this.__editText="Save"}else{this.__editIcon="editor:mode-edit";this.__editText="Edit"}this.fire("haxcms-edit-mode-changed",newValue);window.HaxStore.write("editMode",newValue,this)},_outlineEditModeChanged:function _outlineEditModeChanged(newValue){this.fire("haxcms-outline-edit-mode-changed",newValue)},_manifestEditModeChanged:function _manifestEditModeChanged(newValue){this.fire("haxcms-manifest-edit-mode-changed",newValue)}})});