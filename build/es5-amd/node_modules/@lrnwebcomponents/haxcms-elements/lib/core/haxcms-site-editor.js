define(["../../../../@polymer/polymer/polymer-legacy.js","../../../../@polymer/polymer/lib/utils/async.js","../../../../@polymer/paper-fab/paper-fab.js","../../../../@polymer/paper-tooltip/paper-tooltip.js","../../../../@polymer/paper-button/paper-button.js","../../../../@polymer/iron-ajax/iron-ajax.js","../../../../@polymer/iron-icons/editor-icons.js","../../../jwt-login/jwt-login.js","../../../h-a-x/h-a-x.js","../../../simple-toast/simple-toast.js","../../../simple-modal/simple-modal.js"],function(_polymerLegacy,async){"use strict";async=babelHelpers.interopRequireWildcard(async);var _properties;function _templateObject_3e1c4e10490411e990ee3fd35bb8725b(){var data=babelHelpers.taggedTemplateLiteral(["\n    <style>\n      :host {\n        display: block;\n      }\n      #editbutton {\n        position: fixed;\n        bottom: 0;\n        right: 0;\n        margin: 16px;\n        padding: 2px;\n        width: 40px;\n        height: 40px;\n        visibility: visible;\n        opacity: 1;\n        transition: all 0.4s ease;\n        z-index: 1000;\n      }\n      #outlinebutton {\n        position: fixed;\n        bottom: 0;\n        right: 46px;\n        margin: 16px;\n        padding: 2px;\n        width: 40px;\n        height: 40px;\n        visibility: visible;\n        opacity: 1;\n        transition: all 0.4s ease;\n        z-index: 1000;\n      }\n      :host([edit-mode]) #editbutton {\n        width: 100%;\n        z-index: 100;\n        right: 0;\n        bottom: 0;\n        border-radius: 0;\n        height: 80px;\n        margin: 0;\n        padding: 8px;\n        background-color: var(--paper-blue-500) !important;\n      }\n      h-a-x {\n        padding: 48px;\n        max-width: 1040px;\n        margin: auto;\n        display: none;\n      }\n      :host([edit-mode]) h-a-x {\n        display: block;\n        padding: 0 !important;\n      }\n    </style>\n    <iron-ajax\n      headers='{\"Authorization\": \"Bearer [[jwt]]\"}'\n      id=\"pageupdateajax\"\n      url=\"[[savePagePath]]\"\n      method=\"POST\"\n      body=\"[[updatePageData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handlePageResponse\"\n    ></iron-ajax>\n    <iron-ajax\n      headers='{\"Authorization\": \"Bearer [[jwt]]\"}'\n      id=\"outlineupdateajax\"\n      url=\"[[saveOutlinePath]]\"\n      method=\"POST\"\n      body=\"[[updateOutlineData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleOutlineResponse\"\n    ></iron-ajax>\n    <iron-ajax\n      headers='{\"Authorization\": \"Bearer [[jwt]]\"}'\n      id=\"manifestupdateajax\"\n      url=\"[[saveManifestPath]]\"\n      method=\"POST\"\n      body=\"[[updateManifestData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleManifestResponse\"\n    ></iron-ajax>\n    <iron-ajax\n      headers='{\"Authorization\": \"Bearer [[jwt]]\"}'\n      id=\"publishajax\"\n      loading=\"{{publishing}}\"\n      url=\"[[publishSitePath]]\"\n      method=\"POST\"\n      body=\"[[publishSiteData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handlePublishResponse\"\n    ></iron-ajax>\n    <iron-ajax\n      headers='{\"Authorization\": \"Bearer [[jwt]]\"}'\n      id=\"createajax\"\n      url=\"[[createPagePath]]\"\n      method=\"POST\"\n      body=\"[[createData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleCreateResponse\"\n      last-response=\"{{__createPageResponse}}\"\n    ></iron-ajax>\n    <iron-ajax\n      headers='{\"Authorization\": \"Bearer [[jwt]]\"}'\n      id=\"deleteajax\"\n      url=\"[[deletePagePath]]\"\n      method=\"POST\"\n      body=\"[[deleteData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleDeleteResponse\"\n      last-response=\"{{__deletePageResponse}}\"\n    ></iron-ajax>\n    <h-a-x app-store$=\"[[appStore]]\"></h-a-x>\n  "]);_templateObject_3e1c4e10490411e990ee3fd35bb8725b=function(){return data};return data}(0,_polymerLegacy.Polymer)({is:"haxcms-site-editor",_template:(0,_polymerLegacy.html)(_templateObject_3e1c4e10490411e990ee3fd35bb8725b()),properties:(_properties={jwt:{type:String},savePagePath:{type:String},createPagePath:{type:String},deletePagePath:{type:String},saveManifestPath:{type:String},publishSitePath:{type:String},publishing:{type:Boolean,observer:"_publishingChanged"},saveOutlinePath:{type:String},appStore:{type:Object},editMode:{type:Boolean,reflectToAttribute:!0,value:!1},updatePageData:{type:Object,value:{}},deleteData:{type:Object,value:{}},createData:{type:Object,value:{}},publishSiteData:{type:Object,value:{}},updateManifestData:{type:Object,value:{}},updateOutlineData:{type:Object,value:{}}},babelHelpers.defineProperty(_properties,"updateManifestData",{type:Object,value:{}}),babelHelpers.defineProperty(_properties,"activeItem",{type:Object,notify:!0,observer:"_activeItemChanged"}),babelHelpers.defineProperty(_properties,"manifest",{type:Object,notify:!0}),_properties),_attachDom:function _attachDom(dom){this.appendChild(dom)},ready:function ready(){window.SimpleToast.requestAvailability();window.SimpleModal.requestAvailability();window.addEventListener("hax-store-ready",this._storeReadyToGo.bind(this));window.addEventListener("json-outline-schema-active-item-changed",this._newActiveItem.bind(this));window.addEventListener("json-outline-schema-changed",this._manifestChanged.bind(this));window.addEventListener("json-outline-schema-active-body-changed",this._bodyChanged.bind(this));window.addEventListener("haxcms-save-outline",this.saveOutline.bind(this));window.addEventListener("haxcms-save-page",this.savePage.bind(this));window.addEventListener("haxcms-save-page-details",this.savePageDetails.bind(this));window.addEventListener("haxcms-save-site-data",this.saveManifest.bind(this));window.addEventListener("haxcms-create-page",this.createPage.bind(this));window.addEventListener("haxcms-delete-page",this.deletePage.bind(this));window.addEventListener("haxcms-publish-site",this.publishSite.bind(this));var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"You are logged in, edit tools shown."}});window.dispatchEvent(evt)},attached:function attached(){var _this=this;async.microTask.run(function(){if(babelHelpers.typeof(window.cmsSiteEditor.jsonOutlineSchema)!=="undefined"){_this.set("manifest",window.cmsSiteEditor.jsonOutlineSchema);_this.notifyPath("manifest.*")}if(babelHelpers.typeof(window.cmsSiteEditor.initialActiveItem)!=="undefined"){_this.set("activeItem",window.cmsSiteEditor.initialActiveItem);_this.notifyPath("activeItem.*")}_this.updateStyles();if(window.HaxStore.ready){_this._storeReadyToGo({detail:!0})}})},detached:function detached(){window.removeEventListener("hax-store-ready",this._storeReadyToGo.bind(this));window.removeEventListener("haxcms-save-outline",this.saveOutline.bind(this));window.removeEventListener("haxcms-save-page",this.savePage.bind(this));window.removeEventListener("haxcms-save-page-details",this.savePageDetails.bind(this));window.removeEventListener("haxcms-save-site-data",this.saveManifest.bind(this));window.removeEventListener("haxcms-publish-site",this.publishSite.bind(this));window.removeEventListener("json-outline-schema-active-item-changed",this._newActiveItem.bind(this));window.removeEventListener("json-outline-schema-changed",this._manifestChanged.bind(this));window.removeEventListener("json-outline-schema-active-body-changed",this._bodyChanged.bind(this));window.removeEventListener("haxcms-create-page",this.createPage.bind(this));window.removeEventListener("haxcms-delete-page",this.deletePage.bind(this))},createPage:function createPage(e){if(e.detail.values){this.set("createData",{});this.set("createData",e.detail.values);this.notifyPath("createData.*");this.set("createData.siteName",this.manifest.metadata.siteName);this.notifyPath("createData.siteName");this.set("createData.jwt",this.jwt);this.notifyPath("createData.jwt");this.$.createajax.generateRequest();var evt=new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}});window.dispatchEvent(evt)}},_handleCreateResponse:function _handleCreateResponse(){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Created ".concat(this.__createPageResponse.title,"!"),duration:3e3}});window.dispatchEvent(evt);this.fire("haxcms-trigger-update",!0)},deletePage:function deletePage(e){this.set("deleteData",{});this.set("deleteData.pageid",e.detail.item.id);this.notifyPath("deleteData.pageid");this.set("deleteData.siteName",this.manifest.metadata.siteName);this.notifyPath("deleteData.siteName");this.set("deleteData.jwt",this.jwt);this.notifyPath("deleteData.jwt");this.$.deleteajax.generateRequest();var evt=new CustomEvent("simple-modal-hide",{bubbles:!0,cancelable:!0,detail:{}});window.dispatchEvent(evt)},_handleDeleteResponse:function _handleDeleteResponse(){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Deleted ".concat(this.__deletePageResponse.title),duration:3e3}});this.dispatchEvent(evt);this.fire("haxcms-trigger-update",!0)},_storeReadyToGo:function _storeReadyToGo(event){if(event.detail){window.HaxStore.instance.haxManager.appendJwt="jwt";window.HaxStore.instance.haxPanel.align="left";window.HaxStore.instance.haxPanel.hidePanelOps=!0}},_publishingChanged:function _publishingChanged(newValue,oldValue){if(newValue){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Publishing...",duration:0}});window.dispatchEvent(evt)}else if(!newValue&&oldValue){var _evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Publishing...",duration:3e3}});window.dispatchEvent(_evt)}},_manifestChanged:function _manifestChanged(e){this.set("manifest",{});this.set("manifest",e.detail);this.notifyPath("manifest.*");if(this.activeItem&&e.detail.metadata){window.HaxStore.instance.haxManager.appendUploadEndPoint="siteName="+e.detail.metadata.siteName+"&page="+this.activeItem.id}},_newActiveItem:function _newActiveItem(e){this.set("activeItem",e.detail);this.notifyPath("activeItem.*")},_activeItemChanged:function _activeItemChanged(newValue){if(newValue&&this.manifest){window.HaxStore.instance.haxManager.appendUploadEndPoint="siteName="+this.manifest.metadata.siteName+"&page="+newValue.id}},_handlePageResponse:function _handlePageResponse(e){if("undefined"!==typeof e.detail.location&&this.activeItem.location!==e.detail.location){window.location(e.detail.location);window.history.pushState({},null,e.detail.location);window.dispatchEvent(new PopStateEvent("popstate"));var active=this.manifest.items.find(function(i){return i.id===e.detail.id});this.activeItem=active;this.dispatchEvent(new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,cancelable:!0,detail:active}))}var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Page saved!",duration:4e3}});window.dispatchEvent(evt);this.fire("haxcms-trigger-update",!0);this.fire("haxcms-trigger-update-page",!0)},_handleOutlineResponse:function _handleOutlineResponse(){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Outline saved!",duration:3e3}});window.dispatchEvent(evt);this.fire("haxcms-trigger-update",!0)},_handleManifestResponse:function _handleManifestResponse(){var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:"Site details saved!",duration:3e3}});this.dispatchEvent(evt);this.fire("haxcms-trigger-update",!0)},_handlePublishResponse:function _handlePublishResponse(e){var data=e.detail.response,content=document.createElement("span");content.innerHTML="\n    <a href=\"".concat(data.url,"\" target=\"_blank\">\n      <paper-button raised style=\"color:yellow;text-transform: none;font-weight: bold;\">\n      ").concat(data.label,"\n      </paper-button>\n    </a>");var evt=new CustomEvent("simple-toast-show",{bubbles:!0,cancelable:!0,detail:{text:data.response,duration:5e3,slot:content.cloneNode(!0)}});window.dispatchEvent(evt)},savePage:function savePage(){this.set("updatePageData",{});this.set("updatePageData.siteName",this.manifest.metadata.siteName);this.notifyPath("updatePageData.siteName");this.set("updatePageData.body",window.HaxStore.instance.activeHaxBody.haxToContent());this.notifyPath("updatePageData.body");this.set("updatePageData.page",this.activeItem.id);this.notifyPath("updatePageData.page");this.set("updatePageData.jwt",this.jwt);this.notifyPath("updatePageData.jwt");if(this.savePagePath){this.$.pageupdateajax.generateRequest()}},savePageDetails:function savePageDetails(e){this.set("updatePageData",{});this.set("updatePageData.siteName",this.manifest.metadata.siteName);this.notifyPath("updatePageData.siteName");this.set("updatePageData.page",e.detail.id);this.notifyPath("updatePageData.page");this.set("updatePageData.details",e.detail);this.notifyPath("updatePageData.details");this.set("updatePageData.jwt",this.jwt);this.notifyPath("updatePageData.jwt");if(this.savePagePath){this.$.pageupdateajax.generateRequest()}},saveOutline:function saveOutline(e){this.set("updateOutlineData.siteName",this.manifest.metadata.siteName);this.notifyPath("updateOutlineData.siteName");this.set("updateOutlineData.items",e.detail);this.notifyPath("updateOutlineData.items");this.set("updateOutlineData.jwt",this.jwt);this.notifyPath("updateOutlineData.jwt");if(this.saveOutlinePath){this.$.outlineupdateajax.generateRequest()}},saveManifest:function saveManifest(e){this.set("updateManifestData.siteName",this.manifest.metadata.siteName);this.notifyPath("updateManifestData.siteName");this.set("updateManifestData.manifest",e.detail);this.notifyPath("updateManifestData.manifest");this.set("updateManifestData.jwt",this.jwt);this.notifyPath("updateManifestData.jwt");if(this.saveManifestPath){this.$.manifestupdateajax.generateRequest()}},publishSite:function publishSite(){this.set("publishSiteData.siteName",this.manifest.metadata.siteName);this.notifyPath("publishSiteData.siteName");this.set("publishSiteData.jwt",this.jwt);this.notifyPath("publishSiteData.jwt");if(this.publishSitePath){this.$.publishajax.generateRequest()}},_bodyChanged:function _bodyChanged(e){window.HaxStore.instance.activeHaxBody.importContent(e.detail)}})});