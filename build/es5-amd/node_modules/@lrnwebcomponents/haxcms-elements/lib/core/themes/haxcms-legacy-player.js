define(["exports","meta","require","../../../../../@polymer/polymer/polymer-element.js","../../../../../@vaadin/router/dist/vaadin-router.js","../../../../../@polymer/polymer/lib/legacy/polymer.dom.js","../../../../../@polymer/polymer/lib/utils/async.js","../../../../../@polymer/polymer/lib/utils/resolve-url.js","../../../../../@polymer/polymer/lib/utils/render-status.js","../../../../../@polymer/app-layout/app-header/app-header.js","../../../../../@polymer/app-layout/app-toolbar/app-toolbar.js","../../../../../@polymer/app-layout/app-drawer/app-drawer.js","../../../../../@polymer/app-layout/app-drawer-layout/app-drawer-layout.js","../../../../../@polymer/app-layout/app-header-layout/app-header-layout.js","../../../../../@polymer/iron-ajax/iron-ajax.js","../../../../simple-colors/simple-colors.js","../../../../hax-body/lib/hax-shared-styles.js","../../../../map-menu/map-menu.js"],function(_exports,meta,_require,_polymerElement,_vaadinRouter,_polymerDom,_async,_resolveUrl,_renderStatus){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.HAXCMSLegacyPlayer=void 0;meta=babelHelpers.interopRequireWildcard(meta);_require=babelHelpers.interopRequireWildcard(_require);function _templateObject_ce4e8e00517c11e983ecdd8e67e0bc45(){var data=babelHelpers.taggedTemplateLiteral(["\n      <style include=\"simple-colors hax-shared-styles\">\n        :host {\n          display: block;\n          font-family: libre baskerville;\n          position: relative;\n          overflow: hidden;\n          --outline-player-min-height: 100vh;\n          --app-drawer-width: 300px;\n          --outline-player-dark: #222222;\n          --outline-player-light: #f8f8f8;\n          background-color: var(--outline-player-light);\n        }\n\n        :host([closed]) {\n          --app-drawer-width: 0px;\n        }\n\n        h1 {\n          font-size: 48px;\n          line-height: 16px;\n        }\n\n        h2 {\n          font-size: 32px;\n        }\n\n        h3 {\n          font-size: 28px;\n        }\n\n        p {\n          line-height: 26px;\n          min-height: 26px;\n        }\n\n        a,\n        a:visited,\n        a:active {\n          color: #000;\n        }\n\n        a:hover {\n          color: #2196f3;\n        }\n\n        ul li {\n          padding-bottom: 24px;\n          line-height: 1.5;\n          color: #424242;\n          max-width: 448px;\n        }\n\n        ul li:last-child {\n          padding-bottom: 16px;\n        }\n\n        app-drawer-layout {\n          min-height: 100vh;\n          min-height: -moz-available; /* WebKit-based browsers will ignore this. */\n          min-height: -webkit-fill-available; /* Mozilla-based browsers will ignore this. */\n          min-height: fill-available;\n          /* if the user has set a specific value then override the defaults */\n          min-height: var(--outline-player-min-height);\n        }\n\n        .outline-title {\n          font-size: 24px;\n          font-weight: normal;\n          line-height: 32px;\n          vertical-align: middle;\n          padding: 16px;\n          height: 32px;\n          margin: 0;\n          text-align: center;\n          text-overflow: ellipsis;\n          overflow: hidden;\n          word-break: break-word;\n          border-bottom: 1px solid #eeeeee;\n          position: sticky;\n        }\n\n        site-menu {\n          padding: 8px;\n        }\n\n        outline-player-navigation {\n          --outline-player-dark: var(--outline-player-dark);\n        }\n\n        div[main-title] {\n          margin-left: 16px;\n          font-size: 20px;\n          line-height: 20px;\n          overflow-wrap: break-word;\n          text-overflow: ellipsis;\n          display: inline-block;\n          word-break: break-word;\n        }\n\n        paper-progress {\n          display: block;\n          width: 100%;\n          --paper-progress-active-color: rgba(255, 255, 255, 0.5);\n          --paper-progress-container-color: transparent;\n        }\n\n        app-header {\n          color: var(--outline-player-dark);\n          /* Enable outline to be placed anywhere in the dom */\n          /* This will override the app-header-layout forcing fixed mode */\n          /*position: absolute !important;\n        left: 0 !important;*/\n          --app-header-background-rear-layer: {\n            /* app-header-layout will force fixed */\n            background-color: var(--outline-player-light);\n          }\n        }\n\n        app-toolbar {\n          border-bottom: none;\n          background-color: #ffffff;\n          box-shadow: 0 0 6px -3px var(--outline-player-dark);\n        }\n        app-drawer {\n          box-shadow: 0 0 6px -3px var(--outline-player-dark);\n          overflow: hidden;\n          --app-drawer-scrim-background: rgba(80, 80, 80, 0.8);\n          --app-drawer-content-container: {\n            overflow: hidden;\n            background-color: var(--outline-player-light);\n          }\n        }\n        app-drawer-layout[narrow] app-toolbar {\n          position: fixed !important;\n          left: 0;\n          right: 0;\n        }\n        app-drawer-layout[narrow] #contentcontainer {\n          padding-top: 64px;\n        }\n        #content {\n          justify-content: center;\n          padding: 8px 8px 8px 8px;\n        }\n\n        #content > * {\n          display: flex;\n          flex-direction: column;\n          align-items: center;\n        }\n\n        /* Required for HAX */\n        :host([edit-mode]) #slot {\n          display: none !important;\n        }\n        :host([edit-mode]) #content {\n          padding: 32px 8px 8px 8px;\n        }\n        #contentcontainer {\n          max-width: 840px;\n          margin: 0 auto;\n          padding: 0 16px 16px 16px;\n          flex: 1 1 auto;\n          order: 1;\n          display: flex;\n        }\n        #contentcontainer > * {\n          flex: 1 1 auto;\n          display: flex;\n          flex-direction: column;\n          width: 100%;\n        }\n        #contentcontainer h-a-x {\n          margin: 0;\n        }\n        site-menu {\n          height: calc(100vh - 64px);\n          color: #000000;\n          padding: 0;\n          background-color: #ffffff;\n          --site-menu-active-color: rgba(0, 0, 0, 0.1);\n          --site-menu-scrolltrack-bg-color: rgba(0, 0, 0, 0.3);\n          --site-menu-bg-shadow: rgba(0, 0, 0, 0.3);\n          --site-menu-bg-color: #fafafa;\n          --site-menu: {\n            padding: 0;\n            background-color: #ffffff;\n            color: #000000;\n          }\n          --site-menu-container: {\n            padding: 0;\n            background-color: #ffffff;\n            color: #000000;\n          }\n          --site-menu-item-active-item: {\n            color: #000000;\n          }\n        }\n        site-menu-button {\n          --site-menu-button-button: {\n            border-radius: 50%;\n            background-color: rgba(0, 0, 0, 0.1);\n            height: 40px;\n            width: 40px;\n          }\n          --site-menu-button-button-hover: {\n            background-color: rgba(0, 0, 0, 0.2);\n          }\n        }\n      </style>\n      <iron-ajax\n        id=\"manifest\"\n        url=\"[[outlineLocation]][[file]]\"\n        handle-as=\"json\"\n        debounce-duration=\"250\"\n        last-response=\"{{manifest}}\"\n      ></iron-ajax>\n      <iron-ajax\n        id=\"activecontent\"\n        url=\"[[outlineLocation]][[activeItemLocation]]\"\n        handle-as=\"text\"\n        loading=\"{{loading}}\"\n        debounce-duration=\"250\"\n        last-response=\"{{activeItemContent}}\"\n      ></iron-ajax>\n      <!-- Begin Layout -->\n      <app-drawer-layout narrow=\"{{narrow}}\">\n        <app-drawer id=\"drawer\" swipe-open slot=\"drawer\" opened=\"{{opened}}\">\n          <template is=\"dom-if\" if=\"[[__hasTitle(manifest.title)]]\">\n            <h2 class=\"outline-title\">[[manifest.title]]</h2>\n          </template>\n          <map-menu\n            id=\"menu\"\n            selected=\"[[activeItem.id]]\"\n            manifest=\"[[routerManifest]]\"\n            active-indicator\n            auto-scroll\n          ></map-menu>\n        </app-drawer>\n        <app-header-layout>\n          <app-header slot=\"header\" reveals>\n            <app-toolbar>\n              <paper-icon-button\n                icon=\"menu\"\n                on-click=\"_toggleMenu\"\n              ></paper-icon-button>\n              <div main-title>\n                [[activeItem.title]]\n                <div id=\"slotTitle\"><slot name=\"title\"></slot></div>\n              </div>\n              <site-menu-button\n                type=\"prev\"\n                position=\"bottom\"\n                label=\"Prev\"\n                raised\n              ></site-menu-button>\n              <site-menu-button\n                type=\"next\"\n                position=\"bottom\"\n                label=\"Next\"\n                raised\n              ></site-menu-button>\n              <site-print-button></site-print-button>\n            </app-toolbar>\n          </app-header>\n          <div id=\"content\">\n            <div id=\"contentcontainer\">\n              <div id=\"slot\"><slot></slot></div>\n            </div>\n          </div>\n        </app-header-layout>\n      </app-drawer-layout>\n    "]);_templateObject_ce4e8e00517c11e983ecdd8e67e0bc45=function(){return data};return data}var HAXCMSLegacyPlayer=function(_PolymerElement){babelHelpers.inherits(HAXCMSLegacyPlayer,_PolymerElement);babelHelpers.createClass(HAXCMSLegacyPlayer,[{key:"_activeItemLocationChanged",value:function _activeItemLocationChanged(newValue){if(newValue){this.$.activecontent.generateRequest()}}},{key:"_fileChanged",value:function _fileChanged(newValue){if(babelHelpers.typeof(newValue)!=="undefined"){this.$.manifest.generateRequest()}}}],[{key:"tag",get:function get(){return"haxcms-legacy-player"}},{key:"properties",get:function get(){return{file:{type:String,observer:"_fileChanged"},activeItemContent:{type:String,notify:!0,observer:"_activeItemContentChanged"},activeItemLocation:{type:String,computed:"computeActiveItemLocation(activeItem)",observer:"_activeItemLocationChanged"},activeItem:{type:Object},manifest:{type:Object},routerManifest:{type:Object,computed:"computeRouterManifest(manifest)",observer:"_updateRouter"}}}},{key:"template",get:function get(){return(0,_polymerElement.html)(_templateObject_ce4e8e00517c11e983ecdd8e67e0bc45())}}]);function HAXCMSLegacyPlayer(){var _this;babelHelpers.classCallCheck(this,HAXCMSLegacyPlayer);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(HAXCMSLegacyPlayer).call(this));var options={};if(_this.baseURI){options.baseUrl=_this.baseURI}_this.router=new _vaadinRouter.Router(babelHelpers.assertThisInitialized(babelHelpers.assertThisInitialized(_this)),options);window.addEventListener("vaadin-router-location-changed",_this._routerLocationChanged.bind(babelHelpers.assertThisInitialized(babelHelpers.assertThisInitialized(_this))));return _this}babelHelpers.createClass(HAXCMSLegacyPlayer,[{key:"wipeSlot",value:function wipeSlot(element){var slot=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"*";if("*"===slot){while(null!==(0,_polymerDom.dom)(element).firstChild){(0,_polymerDom.dom)(element).removeChild((0,_polymerDom.dom)(element).firstChild)}}else{for(var i in(0,_polymerDom.dom)(element).childNodes){if(babelHelpers.typeof((0,_polymerDom.dom)(element).childNodes[i])!=="undefined"&&(0,_polymerDom.dom)(element).childNodes[i].slot===slot){(0,_polymerDom.dom)(element).removeChild((0,_polymerDom.dom)(element).childNodes[i])}}}}},{key:"encapScript",value:function encapScript(html){html=html.replace(/<script[\s\S]*?>/gi,"&lt;script&gt;");html=html.replace(/<\/script>/gi,"&lt;/script&gt;");html=html.replace(/<style[\s\S]*?>/gi,"&lt;style&gt;");html=html.replace(/<\/style>/gi,"&lt;/style&gt;");html=html.replace(/<template[\s\S]*?>[\s\S]*?&lt;script[\s\S]*?&gt;[\s\S]*?&lt;\/script&gt;/gi,function(match){match=match.replace("&lt;script&gt;","<script>");match=match.replace("&lt;/script&gt;","</script>");match=match.replace("&lt;style&gt;","<style>");match=match.replace("&lt;/style&gt;","</style>");return match});return html}},{key:"findTagsInHTML",value:function findTagsInHTML(html){var tags={},tag="",matches=html.match(/<\/(\S*?)-(\S*?)>/g);for(var i in matches){tag=matches[i].replace("</","").replace(">","");tags[tag]=tag}return tags}},{key:"_activeItemContentChanged",value:function _activeItemContentChanged(newValue){var _this2=this;if(newValue){var html=newValue;if(null!==html){this.wipeSlot(this,"*");html=this.encapScript(newValue);_async.microTask.run(function(){setTimeout(function(){var frag=document.createRange().createContextualFragment(html);(0,_polymerDom.dom)(_this2).appendChild(frag);new CustomEvent("json-outline-schema-active-body-changed",{bubbles:!0,cancelable:!1,detail:{html:html}})},5)});if(this.manifest.metadata.dynamicElementLoader){var i;(function(){var tagsFound=_this2.findTagsInHTML(html),basePath=(0,_resolveUrl.pathFromUrl)(decodeURIComponent(meta.url)),_loop=function(){var tagName=tagsFound[i];if(_this2.manifest.metadata.dynamicElementLoader[tagName]&&!window.customElements.get(tagName)){new Promise(function(res,rej){return _require.default(["".concat(basePath,"../../../../../").concat(_this2.manifest.metadata.dynamicElementLoader[tagName])],res,rej)}).then(function(){}).catch(function(error){console.log(error)})}};for(i in tagsFound){_loop()}})()}}}}},{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(HAXCMSLegacyPlayer.prototype),"connectedCallback",this).call(this);(0,_renderStatus.afterNextRender)(this,function(){if(document.getElementById("haxcmsoutdatedfallbacksuperold")){document.getElementById("haxcmsoutdatedfallback").removeChild(document.getElementById("haxcmsoutdatedfallbacksuperold"))}})}},{key:"disconnectedCallback",value:function disconnectedCallback(){window.removeEventListener("vaadin-router-location-changed",this._routerLocationChanged.bind(this));babelHelpers.get(babelHelpers.getPrototypeOf(HAXCMSLegacyPlayer.prototype),"disconnectedCallback",this).call(this)}},{key:"computeActiveItemLocation",value:function computeActiveItemLocation(activeItem){return"pages/"+activeItem.location+"/index.html"}},{key:"computeRouterManifest",value:function computeRouterManifest(manifest){document.body.dispatchEvent(new CustomEvent("json-outline-schema-changed",{bubbles:!0,detail:manifest}));if(manifest&&"undefined"!==typeof manifest.items){var manifestItems=manifest.items.map(function(i){var location=i.location.replace("pages/","").replace("/index.html","");return Object.assign({},i,{location:location})});return Object.assign({},manifest,{items:manifestItems})}}},{key:"_updateRouter",value:function _updateRouter(routerManifest){if(!routerManifest||"undefined"===typeof routerManifest.items)return;var routerItems=routerManifest.items.map(function(i){return{path:i.location,name:i.id,component:"fake-".concat(i.id,"-e")}});this.router.setRoutes(babelHelpers.toConsumableArray(routerItems).concat([{path:"/",component:"fake-home-e",name:"home"},{path:"/(.*)",component:"fake-404-e",name:"404"}]))}},{key:"_routerLocationChanged",value:function _routerLocationChanged(e){var _this3=this;setTimeout(function(){if(_this3.routerManifest.items.find){var tmpItem=_this3.routerManifest.items.find(function(i){return i.location==e.detail.location.route.path});if(tmpItem){_this3.set("activeItem",tmpItem)}}},100)}}]);return HAXCMSLegacyPlayer}(_polymerElement.PolymerElement);_exports.HAXCMSLegacyPlayer=HAXCMSLegacyPlayer;window.customElements.define(HAXCMSLegacyPlayer.tag,HAXCMSLegacyPlayer)});