define(["exports","./haxcms-site-store.js","../../../../mobx/lib/mobx.module.js","../../../../@polymer/polymer/lib/utils/async.js","../../../../@polymer/polymer/lib/legacy/polymer.dom.js","../../../../@polymer/polymer/lib/utils/render-status.js","../../../../@polymer/polymer/lib/mixins/element-mixin.js"],function(_exports,_haxcmsSiteStore,_mobxModule,_async,_polymerDom,_renderStatus,_elementMixin){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.HAXCMSThemeWiring=_exports.HAXCMSTheme=void 0;_exports.HAXCMSTheme=function HAXCMSTheme(SuperClass){return function(_SuperClass){babelHelpers.inherits(_class,_SuperClass);function _class(){var _this;babelHelpers.classCallCheck(this,_class);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(_class).call(this));_this.HAXCMSThemeWiring=new HAXCMSThemeWiring(babelHelpers.assertThisInitialized(babelHelpers.assertThisInitialized(_this)));return _this}babelHelpers.createClass(_class,[{key:"_editModeChanged",value:function _editModeChanged(newValue){if(babelHelpers.typeof(newValue)!=="undefined"){_async.microTask.run(function(){window.dispatchEvent(new Event("resize"));(0,_elementMixin.updateStyles)()})}}},{key:"_contentContainerChanged",value:function _contentContainerChanged(newValue,oldValue){if(newValue&&null===oldValue){this.HAXCMSThemeWiring.connect(this,newValue)}else if(newValue&&oldValue){this.HAXCMSThemeWiring.disconnect(this);this.HAXCMSThemeWiring.connect(this,newValue)}else if(oldValue&&null===newValue){this.HAXCMSThemeWiring.disconnect(this)}}},{key:"_locationChanged",value:function _locationChanged(newValue){if(!newValue||"undefined"===typeof newValue.route)return;var name=newValue.route.name;if("home"===name||"404"===name){var firstItem=_haxcmsSiteStore.store.routerManifest.items.find(function(i){return"undefined"!==typeof i.id});if(firstItem){_haxcmsSiteStore.store.activeId=firstItem.id}}}},{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(_class.prototype),"connectedCallback",this).call(this);if(null===this.contentContainer){this.contentContainer=this.shadowRoot.querySelector("#contentcontainer")}this.__disposer=[];(0,_renderStatus.afterNextRender)(this,function(){var _this2=this;if(0===(0,_polymerDom.dom)(this).getEffectiveChildNodes().length){var frag=document.createRange().createContextualFragment(_haxcmsSiteStore.store.activeItemContent);(0,_polymerDom.dom)(this).appendChild(frag)}(0,_elementMixin.updateStyles)();(0,_mobxModule.autorun)(function(reaction){var __routerManifest=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.routerManifest);if(babelHelpers.typeof(__routerManifest.title)!=="undefined"){document.title=__routerManifest.title}if(babelHelpers.typeof(__routerManifest.metadata)!=="undefined"&&babelHelpers.typeof(__routerManifest.metadata.cssVariable)!=="undefined"){var ary=__routerManifest.metadata.cssVariable.replace("--simple-colors-default-theme-","").split("-");ary.pop();_this2.accentColor=ary.join("-");document.body.style.setProperty("--haxcms-color",__routerManifest.metadata.hexCode)}_this2.__disposer.push(reaction)});(0,_mobxModule.autorun)(function(reaction){_this2._location=_haxcmsSiteStore.store.location;_this2.__disposer.push(reaction)})})}},{key:"disconnectedCallback",value:function disconnectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(_class.prototype),"disconnectedCallback",this).call(this);delete this.contentContainer;for(var i in this.__disposer){this.__disposer[i].dispose()}}},{key:"resetActive",value:function resetActive(){window.history.pushState(null,null,_haxcmsSiteStore.store.location.baseUrl);window.dispatchEvent(new PopStateEvent("popstate"));this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,composed:!0,cancelable:!0,detail:{}}))}}],[{key:"properties",get:function get(){return{editMode:{type:Boolean,reflectToAttribute:!0,notify:!0,observer:"_editModeChanged"},contentContainer:{type:Object,notify:!0,value:null,observer:"_contentContainerChanged"},_location:{type:Object,observer:"_locationChanged"}}}}]);return _class}(SuperClass)};var HAXCMSThemeWiring=function(){function HAXCMSThemeWiring(element){var load=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;babelHelpers.classCallCheck(this,HAXCMSThemeWiring);if(load){document.body.addEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element));document.body.addEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element));document.body.addEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element));if(null==window.localStorage.getItem("HAXCMSSystemData")){window.localStorage.setItem("HAXCMSSystemData",JSON.stringify({}))}}}babelHelpers.createClass(HAXCMSThemeWiring,[{key:"connect",value:function connect(element,injector){if(babelHelpers.typeof(window.cmsSiteEditor)!=="undefined"){window.cmsSiteEditor.requestAvailability(element,injector)}}},{key:"disconnect",value:function disconnect(element){document.body.removeEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element));document.body.removeEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element));document.body.removeEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element))}},{key:"_globalEditChanged",value:function _globalEditChanged(e){this.editMode=e.detail}},{key:"_activeItemUpdate",value:function _activeItemUpdate(e){var newValue=e.detail;if(newValue&&babelHelpers.typeof(newValue.id)!=="undefined"){_haxcmsSiteStore.store.activeId=newValue.id;var evt=new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,composed:!0,cancelable:!0,detail:newValue});this.dispatchEvent(evt);if(babelHelpers.typeof(newValue.title)!=="undefined"){document.title=_haxcmsSiteStore.store.routerManifest.title+" - "+newValue.title}else{document.title=_haxcmsSiteStore.store.routerManifest.title}}else{document.title=_haxcmsSiteStore.store.routerManifest.title}}},{key:"_triggerUpdate",value:function _triggerUpdate(){this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,composed:!0,cancelable:!0,detail:{}}))}}]);return HAXCMSThemeWiring}();_exports.HAXCMSThemeWiring=HAXCMSThemeWiring});