define(["../../../@polymer/polymer/polymer-legacy.js","../../../@polymer/paper-fab/paper-fab.js","../../../@polymer/paper-toast/paper-toast.js","../../../@polymer/paper-tooltip/paper-tooltip.js","../../../@polymer/iron-ajax/iron-ajax.js","../../../@polymer/iron-icons/editor-icons.js","../../jwt-login/jwt-login.js","../../hax-body/lib/hax-store.js","../../hax-body/hax-body.js","../../hax-body/lib/hax-autoloader.js","../../hax-body/lib/hax-manager.js","../../hax-body/lib/hax-app-picker.js","../../hax-body/lib/hax-app.js","../../hax-body/lib/hax-panel.js","../../hax-body/lib/hax-export-dialog.js","../../hax-body/lib/hax-toolbar.js","./haxcms-outline-editor-dialog.js","./haxcms-manifest-editor-dialog.js","./haxcms-site-editor-ui.js"],function(_polymerLegacy){"use strict";function _templateObject_e7354090f80211e8896a0fdd3e86f213(){var data=babelHelpers.taggedTemplateLiteral(["\n    <style is=\"custom-style\">\n      :host {\n        display: block;\n      }\n      #editbutton {\n        position: fixed;\n        bottom: 0;\n        right: 0;\n        margin: 16px;\n        padding: 2px;\n        width: 40px;\n        height: 40px;\n        visibility: visible;\n        opacity: 1;\n        transition: all 0.4s ease;\n        z-index: 1000;\n      }\n      #outlinebutton {\n        position: fixed;\n        bottom: 0;\n        right: 46px;\n        margin: 16px;\n        padding: 2px;\n        width: 40px;\n        height: 40px;\n        visibility: visible;\n        opacity: 1;\n        transition: all 0.4s ease;\n        z-index: 1000;\n      }\n      :host([edit-mode]) #editbutton {\n        width: 100%;\n        z-index: 100;\n        right: 0;\n        bottom: 0;\n        border-radius: 0;\n        height: 80px;\n        margin: 0;\n        padding: 8px;\n        background-color: var(--paper-blue-500) !important;\n      }\n      hax-body {\n        padding: 48px;\n        max-width: 1040px;\n        margin: auto;\n        display: none;\n      }\n      :host([edit-mode]) hax-body {\n        display: block;\n        padding: 0 !important;\n      }\n    </style>\n    <iron-ajax\n      headers=\"{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}\"\n      id=\"pageupdateajax\"\n      url=\"[[savePagePath]]\"\n      method=\"POST\"\n      body=\"[[updatePageData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handlePageResponse\"\n    ></iron-ajax>\n    <iron-ajax\n      headers=\"{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}\"\n      id=\"outlineupdateajax\"\n      url=\"[[saveOutlinePath]]\"\n      method=\"POST\"\n      body=\"[[updateOutlineData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleOutlineResponse\"\n    ></iron-ajax>\n    <iron-ajax\n      headers=\"{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}\"\n      id=\"manifestupdateajax\"\n      url=\"[[saveManifestPath]]\"\n      method=\"POST\"\n      body=\"[[updateManifestData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handleManifestResponse\"\n    ></iron-ajax>\n    <iron-ajax\n      headers=\"{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}\"\n      id=\"publishajax\"\n      loading=\"{{publishing}}\"\n      url=\"[[publishPath]]\"\n      method=\"POST\"\n      body=\"[[publishSiteData]]\"\n      content-type=\"application/json\"\n      handle-as=\"json\"\n      on-response=\"_handlePublishResponse\"\n    ></iron-ajax>\n    <hax-store app-store=\"[[appStore]]\"></hax-store>\n    <hax-app-picker></hax-app-picker>\n    <hax-body id=\"body\"></hax-body>\n    <hax-autoloader hidden></hax-autoloader>\n    <hax-panel align=\"left\" hide-panel-ops></hax-panel>\n    <hax-manager append-jwt=\"jwt\" id=\"haxmanager\"></hax-manager>\n    <hax-export-dialog></hax-export-dialog>\n    <haxcms-site-editor-ui\n      id=\"ui\"\n      active-item=\"[[activeItem]]\"\n      manifest=\"[[manifest]]\"\n      edit-mode=\"{{editMode}}\"\n      outline-edit-mode=\"{{outlineEditMode}}\"\n      manifest-edit-mode=\"{{manifestEditMode}}\"\n    ></haxcms-site-editor-ui>\n    <haxcms-outline-editor-dialog\n      id=\"outlineeditor\"\n    ></haxcms-outline-editor-dialog>\n    <haxcms-manifest-editor-dialog\n      id=\"manifesteditor\"\n    ></haxcms-manifest-editor-dialog>\n    <paper-toast id=\"toast\"> </paper-toast>\n    <paper-toast id=\"publishtoast\" duration=\"0\">\n      <a href$=\"[[__publishLink]]\" target=\"_blank\"\n        ><paper-button\n          raised\n          style=\"color:yellow;text-transform: none;font-weight: bold;\"\n          >[[__publishLabel]]</paper-button\n        ></a\n      >\n    </paper-toast>\n  "]);_templateObject_e7354090f80211e8896a0fdd3e86f213=function(){return data};return data}(0,_polymerLegacy.Polymer)({is:"haxcms-site-editor",_template:(0,_polymerLegacy.html)(_templateObject_e7354090f80211e8896a0fdd3e86f213()),listeners:{"haxcms-save-outline":"saveOutline","haxcms-save-site-data":"saveManifest","haxcms-publish-site":"publishSite"},properties:{jwt:{type:String},savePagePath:{type:String},saveManifestPath:{type:String},publishPath:{type:String},publishing:{type:Boolean,observer:"_publishingChanged"},saveOutlinePath:{type:String},appStore:{type:Object},editMode:{type:Boolean,reflectToAttribute:!0,observer:"_editModeChanged",value:!1},outlineEditMode:{type:Boolean,reflectToAttribute:!0,observer:"_outlineEditModeChanged",value:!1},manifestEditMode:{type:Boolean,reflectToAttribute:!0,observer:"_manifestEditModeChanged",value:!1},updatePageData:{type:Object,value:{}},publishSiteData:{type:Object,value:{}},updateOutlineData:{type:Object,value:{}},updateManifestData:{type:Object,value:{}},activeItem:{type:Object,notify:!0,observer:"_activeItemChanged"},manifest:{type:Object,notify:!0}},created:function created(){document.body.addEventListener("json-outline-schema-active-item-changed",this._newActiveItem.bind(this));document.body.addEventListener("json-outline-schema-changed",this._manifestChanged.bind(this));document.body.addEventListener("json-outline-schema-active-body-changed",this._bodyChanged.bind(this))},ready:function ready(){document.body.appendChild(this.$.toast);document.body.appendChild(this.$.publishtoast);document.body.appendChild(this.$.ui);document.body.appendChild(this.$.outlineeditor);document.body.appendChild(this.$.manifesteditor)},attached:function attached(){this.$.toast.show("You are logged in, edit tools shown.");if(babelHelpers.typeof(this.__body)!=="undefined"){this.$.body.importContent(this.__body)}if(babelHelpers.typeof(window.cmsSiteEditor.jsonOutlineSchema)!=="undefined"){this.set("manifest",window.cmsSiteEditor.jsonOutlineSchema)}if(babelHelpers.typeof(window.cmsSiteEditor.initialActiveItem)!=="undefined"){this.set("activeItem",window.cmsSiteEditor.initialActiveItem)}this.updateStyles()},detached:function detached(){document.body.removeEventListener("json-outline-schema-active-item-changed",this._newActiveItem.bind(this));document.body.removeEventListener("json-outline-schema-changed",this._manifestChanged.bind(this));document.body.removeEventListener("json-outline-schema-active-body-changed",this._bodyChanged.bind(this))},_publishingChanged:function _publishingChanged(newValue,oldValue){if(newValue){this.$.toast.duration=0;this.$.toast.show("Publishing...")}else if(!newValue&&oldValue){this.$.toast.duration=3e3}},_manifestChanged:function _manifestChanged(e){this.set("manifest",{});this.set("manifest",e.detail);this.notifyPath("manifest.*")},_newActiveItem:function _newActiveItem(e){this.set("activeItem",e.detail);this.notifyPath("activeItem.*")},_activeItemChanged:function _activeItemChanged(newValue){if(newValue){var parts=window.location.pathname.split("/");parts.pop();var site=parts.pop();this.$.haxmanager.appendUploadEndPoint="siteName="+site+"&page="+newValue.id}},_handlePageResponse:function _handlePageResponse(){this.$.toast.show("Page saved!");this.fire("haxcms-trigger-update-page",!0)},_handleOutlineResponse:function _handleOutlineResponse(){this.$.toast.show("Outline saved!");this.fire("haxcms-trigger-update",!0)},_handleManifestResponse:function _handleManifestResponse(){this.$.toast.show("Site details saved!");this.fire("haxcms-trigger-update",!0)},_handlePublishResponse:function _handlePublishResponse(e){console.log(e.detail.response);var data=e.detail.response;this.__publishLink=data.url;this.__publishLabel=data.label;this.$.publishtoast.show(data.response)},_editModeChanged:function _editModeChanged(newValue,oldValue){if(!newValue&&oldValue){var parts=window.location.pathname.split("/");parts.pop();var site=parts.pop();this.set("updatePageData.siteName",site);this.set("updatePageData.body",window.HaxStore.instance.activeHaxBody.haxToContent());this.set("updatePageData.page",this.activeItem.id);this.set("updatePageData.jwt",this.jwt);if(this.savePagePath){this.$.pageupdateajax.generateRequest()}this.fire("haxcms-save-page",this.activeItem);this.notifyPath("updatePageData.*")}},_outlineEditModeChanged:function _outlineEditModeChanged(newValue){if(newValue){this.$.outlineeditor.opened=!0}else{this.$.outlineeditor.opened=!1}},_manifestEditModeChanged:function _manifestEditModeChanged(newValue){if(newValue){this.$.manifesteditor.opened=!0}else{this.$.manifesteditor.opened=!1}},saveOutline:function saveOutline(e){var parts=window.location.pathname.split("/");parts.pop();var site=parts.pop();this.set("updateOutlineData.siteName",site);this.set("updateOutlineData.items",e.detail);this.set("updateOutlineData.jwt",this.jwt);if(this.saveOutlinePath){this.$.outlineupdateajax.generateRequest()}this.notifyPath("updateOutlineData.*")},saveManifest:function saveManifest(e){var parts=window.location.pathname.split("/");parts.pop();var site=parts.pop();this.set("updateManifestData.siteName",site);this.set("updateManifestData.manifest",e.detail);this.set("updateManifestData.jwt",this.jwt);if(this.saveManifestPath){this.$.manifestupdateajax.generateRequest()}this.notifyPath("updateManifestData.*")},publishSite:function publishSite(){var parts=window.location.pathname.split("/");parts.pop();var site=parts.pop();this.set("publishSiteData.siteName",site);this.set("publishSiteData.jwt",this.jwt);if(this.publishPath){this.$.publishajax.generateRequest()}this.notifyPath("publishSiteData.*")},_bodyChanged:function _bodyChanged(e){window.HaxStore.instance.activeHaxBody.importContent(e.detail)}})});