define(["exports","meta","require","../../../../../@polymer/polymer/polymer-element.js","../../../../../@polymer/polymer/lib/utils/resolve-url.js","../../../../../@polymer/polymer/lib/legacy/polymer.dom.js","../../../../hax-body/lib/haxutils.js","../../../../../@polymer/polymer/lib/utils/async.js","../../core/haxcms-site-store.js","../../../../../@polymer/iron-ajax/iron-ajax.js","../../../../../mobx/lib/mobx.module.js"],function(_exports,meta,_require,_polymerElement,_resolveUrl,_polymerDom,_haxutils,_async,_haxcmsSiteStore,_ironAjax,_mobxModule){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.SiteRenderItem=void 0;meta=babelHelpers.interopRequireWildcard(meta);_require=babelHelpers.interopRequireWildcard(_require);function _templateObject_0fec96b054c311e99540492d34b1bf39(){var data=babelHelpers.taggedTemplateLiteral(["\n      <style>\n        :host {\n          display: block;\n        }\n      </style>\n      <iron-ajax\n        id=\"content\"\n        url=\"[[location]]\"\n        handle-as=\"text\"\n        loading=\"{{loading}}\"\n        debounce-duration=\"250\"\n        last-response=\"{{itemContent}}\"\n      ></iron-ajax>\n      <slot></slot>\n    "]);_templateObject_0fec96b054c311e99540492d34b1bf39=function(){return data};return data}var SiteRenderItem=function(_PolymerElement){babelHelpers.inherits(SiteRenderItem,_PolymerElement);function SiteRenderItem(){babelHelpers.classCallCheck(this,SiteRenderItem);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(SiteRenderItem).apply(this,arguments))}babelHelpers.createClass(SiteRenderItem,[{key:"_computeLocation",value:function _computeLocation(itemId,render){if(itemId&&render){var item=_haxcmsSiteStore.store.findItem(itemId);return item.location+"?"+Math.floor(Date.now()/1e3)}}},{key:"locationChanged",value:function locationChanged(newValue){if(newValue){this.$.content.generateRequest()}}},{key:"_itemContentChanged",value:function _itemContentChanged(newValue){var _this=this;if(newValue){var html=newValue;if(null!==html){html=(0,_haxutils.encapScript)(newValue);(0,_haxutils.wipeSlot)(this,"*");_async.microTask.run(function(){setTimeout(function(){var frag=document.createRange().createContextualFragment(html);(0,_polymerDom.dom)(_this).appendChild(frag)},5)});if(this.manifest.metadata.dynamicElementLoader){var i;(function(){var tagsFound=(0,_haxutils.findTagsInHTML)(html),basePath=(0,_resolveUrl.pathFromUrl)(decodeURIComponent(meta.url)),_loop=function(){var tagName=tagsFound[i];if(_this.manifest.metadata.dynamicElementLoader[tagName]&&!window.customElements.get(tagName)){new Promise(function(res,rej){return _require.default(["".concat(basePath,"../../../../../").concat(_this.manifest.metadata.dynamicElementLoader[tagName])],res,rej)}).then(function(){}).catch(function(error){console.log(error)})}};for(i in tagsFound){_loop()}})()}}}}},{key:"connectedCallback",value:function connectedCallback(){var _this2=this;babelHelpers.get(babelHelpers.getPrototypeOf(SiteRenderItem.prototype),"connectedCallback",this).call(this);this.__disposer=[];(0,_mobxModule.autorun)(function(reaction){_this2.manifest=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.manifest);_this2.__disposer.push(reaction)})}},{key:"disconnectedCallback",value:function disconnectedCallback(){for(var i in this.__disposer){this.__disposer[i]}babelHelpers.get(babelHelpers.getPrototypeOf(SiteRenderItem.prototype),"disconnectedCallback",this).call(this)}}],[{key:"tag",get:function get(){return"site-render-item"}},{key:"template",get:function get(){return(0,_polymerElement.html)(_templateObject_0fec96b054c311e99540492d34b1bf39())}},{key:"properties",get:function get(){return{render:{type:Boolean,value:!1},itemId:{type:String},location:{type:String,computed:"_computeLocation(itemId, render)",observer:"locationChanged"},itemContent:{type:String,notify:!0,observer:"_itemContentChanged"}}}}]);return SiteRenderItem}(_polymerElement.PolymerElement);_exports.SiteRenderItem=SiteRenderItem;window.customElements.define(SiteRenderItem.tag,SiteRenderItem)});