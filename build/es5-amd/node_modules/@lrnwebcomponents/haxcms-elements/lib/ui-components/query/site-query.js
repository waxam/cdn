define(["exports","../../../../../@polymer/polymer/polymer-element.js","../../../../../@polymer/polymer/lib/mixins/mutable-data.js","../../core/haxcms-site-store.js","../../../../../mobx/lib/mobx.module.js"],function(_exports,_polymerElement,_mutableData,_haxcmsSiteStore,_mobxModule){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.SiteQuery=void 0;Object.byString=function(o,s){s=s.replace(/\[(\w+)\]/g,".$1");s=s.replace(/^\./,"");for(var a=s.split("."),i=0,n=a.length,k;i<n;++i){k=a[i];if(k in o){o=o[k]}else{return}}return o};var SiteQuery=function(_MutableData){babelHelpers.inherits(SiteQuery,_MutableData);function SiteQuery(){babelHelpers.classCallCheck(this,SiteQuery);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(SiteQuery).apply(this,arguments))}babelHelpers.createClass(SiteQuery,[{key:"_computeResult",value:function _computeResult(entityType,conditions,sorts,routerManifest,activeId,limit,startIndex,random){if(routerManifest.items){var i,i,i,_ret=function(){var items=Object.assign([],(0,_mobxModule.toJS)(routerManifest.items));if("node"!==entityType){var oldItems=Object.assign([],items);for(i in oldItems){if(babelHelpers.typeof(oldItems[i][entityType])!=="undefined"){oldItems[i]=oldItems[i][entityType];oldItems[i]._node=items[i]}}items=oldItems}if(conditions&&items){for(i in conditions){items=items.filter(function(item){if("$activeId"===conditions[i]){if(item[i]!==activeId){return!1}return!0}else if("$firstId"===conditions[i]){if(item[i]!==items[0].id){return!1}return!0}else{if(Object.byString(item,i)!==conditions[i]){return!1}return!0}})}}if(sorts){for(i in sorts){items.sort(function(item1,item2){if("ASC"===sorts[i]){if(item1[i]<item2[i]){return-1}else if(item1[i]>item2[i]){return 1}else{return 0}}else{if(item1[i]>item2[i]){return-1}else if(item1[i]<item2[i]){return 1}else{return 0}}})}}if(random){items.sort(function(){if(Math.random()<Math.random()){return-1}else if(Math.random()>Math.random()){return 1}else{return 0}})}if(0!==startIndex&&items.length>startIndex){while(0<startIndex){items.shift();startIndex--}}else if(items.length<startIndex){return{v:[]}}if(0!==limit){while(items.length>limit){items.pop()}}return{v:items}}();if("object"===babelHelpers.typeof(_ret))return _ret.v}return[]}},{key:"_noticeResultChange",value:function _noticeResultChange(newValue){this.set("result",newValue);this.notifyPath("result")}},{key:"connectedCallback",value:function connectedCallback(){var _this=this;babelHelpers.get(babelHelpers.getPrototypeOf(SiteQuery.prototype),"connectedCallback",this).call(this);this.__disposer=(0,_mobxModule.autorun)(function(){_this.routerManifest=Object.assign({},(0,_mobxModule.toJS)(_haxcmsSiteStore.store.routerManifest))});this.__disposer2=(0,_mobxModule.autorun)(function(){_this.activeId=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.activeId)})}},{key:"disconnectedCallback",value:function disconnectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(SiteQuery.prototype),"disconnectedCallback",this).call(this);this.__disposer();this.__disposer2()}}],[{key:"tag",get:function get(){return"site-query"}},{key:"properties",get:function get(){return{routerManifest:{type:Object},activeId:{type:String},result:{type:Array,notify:!0},__result:{type:Array,computed:"_computeResult(entityType, conditions, sort, routerManifest, activeId, limit, startIndex, random, forceRebuild)",observer:"_noticeResultChange"},conditions:{type:Object,notify:!0,value:{}},sort:{type:Object,notify:!0,value:{order:"ASC"}},forceRebuild:{type:Boolean,notify:!0,value:!1},limit:{type:Number,value:0},startIndex:{type:Number,value:0},random:{type:Boolean,value:!1},entityType:{type:String,value:"node"}}}}]);return SiteQuery}((0,_mutableData.MutableData)(_polymerElement.PolymerElement));_exports.SiteQuery=SiteQuery;window.customElements.define(SiteQuery.tag,SiteQuery)});