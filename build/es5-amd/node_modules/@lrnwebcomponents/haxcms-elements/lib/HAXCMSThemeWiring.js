define(["exports","./haxcms-site-store.js","../../../mobx/lib/mobx.module.js"],function(_exports,_haxcmsSiteStore,_mobxModule){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.HAXCMSThemeWiring=_exports.HAXCMSTheme=void 0;_exports.HAXCMSTheme=function HAXCMSTheme(SuperClass){return function(_SuperClass){babelHelpers.inherits(_class,_SuperClass);function _class(){var _this;babelHelpers.classCallCheck(this,_class);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(_class).call(this));_this.HAXCMSThemeWiring=new HAXCMSThemeWiring(babelHelpers.assertThisInitialized(babelHelpers.assertThisInitialized(_this)));return _this}babelHelpers.createClass(_class,[{key:"_contentContainerChanged",value:function _contentContainerChanged(newValue,oldValue){if(newValue&&null===oldValue){this.HAXCMSThemeWiring.connect(this,newValue)}else if(newValue&&oldValue){this.HAXCMSThemeWiring.disconnect(this);this.HAXCMSThemeWiring.connect(this,newValue)}else if(oldValue&&null===newValue){this.HAXCMSThemeWiring.disconnect(this)}}},{key:"connectedCallback",value:function connectedCallback(){var _this2=this;babelHelpers.get(babelHelpers.getPrototypeOf(_class.prototype),"connectedCallback",this).call(this);if(null===this.contentContainer){this.contentContainer=this.shadowRoot.querySelector("#contentcontainer")}this.__disposer=(0,_mobxModule.autorun)(function(){_this2.manifest=(0,_mobxModule.toJS)(_haxcmsSiteStore.store.routerManifest)})}},{key:"disconnectedCallback",value:function disconnectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(_class.prototype),"disconnectedCallback",this).call(this);delete this.contentContainer;this.__disposer()}},{key:"setActiveItemFromID",value:function setActiveItemFromID(activeId){var item=this.manifest.items.filter(function(d){if(activeId===d.id){return d}}).pop();this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:item}));return item}},{key:"resetActive",value:function resetActive(){window.history.pushState(null,null,_haxcmsSiteStore.store.location.baseUrl);window.dispatchEvent(new PopStateEvent("popstate"));this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:{}}))}},{key:"disablePrevPage",value:function disablePrevPage(index){if(0===index||-1===index){return!0}return!1}},{key:"disableNextPage",value:function disableNextPage(index){if(index>=this.manifest.items.length-1){return!0}return!1}},{key:"prevPage",value:function prevPage(){this.changePage("previous")}},{key:"nextPage",value:function nextPage(){this.changePage("next")}},{key:"changePage",value:function changePage(direction){if("next"==direction&&this.activeManifestIndex<this.manifest.items.length-1){window.history.pushState({},null,this.manifest.items[this.activeManifestIndex+1].location);window.dispatchEvent(new PopStateEvent("popstate"));this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:this.manifest.items[this.activeManifestIndex+1]}))}else if("previous"==direction&&0<this.activeManifestIndex){window.history.pushState({},null,this.manifest.items[this.activeManifestIndex-1].location);window.dispatchEvent(new PopStateEvent("popstate"));this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:this.manifest.items[this.activeManifestIndex-1]}))}}}],[{key:"properties",get:function get(){return{editMode:{type:Boolean,reflectToAttribute:!0},activeItem:{type:Object},manifest:{type:Object},contentContainer:{type:Object,value:null,observer:"_contentContainerChanged"},activeManifestIndex:{type:Number,value:-1}}}}]);return _class}(SuperClass)};var HAXCMSThemeWiring=function(){function HAXCMSThemeWiring(element){var _this3=this,load=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;babelHelpers.classCallCheck(this,HAXCMSThemeWiring);if(load){document.body.addEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element));document.body.addEventListener("json-outline-schema-changed",this._manifestUpdate.bind(element));document.body.addEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element));document.body.addEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element));this.__disposer=(0,_mobxModule.autorun)(function(){_this3._manifestUpdate({detail:(0,_mobxModule.toJS)(_haxcmsSiteStore.store.routerManifest)})})}}babelHelpers.createClass(HAXCMSThemeWiring,[{key:"connect",value:function connect(element,injector){if(babelHelpers.typeof(window.cmsSiteEditor)!=="undefined"){window.cmsSiteEditor.requestAvailability(element,injector)}}},{key:"disconnect",value:function disconnect(element){document.body.removeEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element));document.body.removeEventListener("json-outline-schema-changed",this._manifestUpdate.bind(element));document.body.removeEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element));document.body.removeEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element));this.__disposer()}},{key:"_globalEditChanged",value:function _globalEditChanged(e){this.editMode=e.detail}},{key:"_activeItemUpdate",value:function _activeItemUpdate(e){var _this4=this,newValue=e.detail;if(newValue&&babelHelpers.typeof(newValue.id)!=="undefined"){var evt=new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,cancelable:!0,detail:newValue});this.dispatchEvent(evt);this.manifest.items.filter(function(d,i){if(newValue.id===d.id){_this4.activeManifestIndex=i;return d}}).pop();if(babelHelpers.typeof(newValue.title)!=="undefined"){document.title=this.manifest.title+" - "+newValue.title}else{document.title=this.manifest.title}}else{this.activeManifestIndex=-1;document.title=this.manifest.title}}},{key:"_triggerUpdate",value:function _triggerUpdate(){this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:{}}))}},{key:"_manifestUpdate",value:function _manifestUpdate(e){var newValue=e.detail;if(babelHelpers.typeof(newValue.title)!=="undefined"){document.title=newValue.title}if(babelHelpers.typeof(newValue.metadata)!=="undefined"&&babelHelpers.typeof(newValue.metadata.cssVariable)!=="undefined"){var ary=newValue.metadata.cssVariable.replace("--simple-colors-default-theme-","").split("-");ary.pop();this.accentColor=ary.join("-");document.body.style.setProperty("--haxcms-color",newValue.metadata.hexCode)}}}]);return HAXCMSThemeWiring}();_exports.HAXCMSThemeWiring=HAXCMSThemeWiring});