/* global H5PAdminIntegration H5PUtils */var H5PLibraryList=H5PLibraryList||{};(function($){/**
   * Initializing
   */H5PLibraryList.init=function(){var $adminContainer=H5P.jQuery(H5PAdminIntegration.containerSelector).html(""),libraryList=H5PAdminIntegration.libraryList;if(libraryList.notCached){$adminContainer.append(H5PUtils.getRebuildCache(libraryList.notCached))}// Create library list
$adminContainer.append(H5PLibraryList.createLibraryList(H5PAdminIntegration.libraryList))};/**
   * Create the library list
   *
   * @param {object} libraries List of libraries and headers
   */H5PLibraryList.createLibraryList=function(libraries){var t=H5PAdminIntegration.l10n;if(libraries.listData===void 0||0===libraries.listData.length){return $("<div>"+t.NA+"</div>")}// Create table
var $table=H5PUtils.createTable(libraries.listHeaders);$table.addClass("libraries");// Add libraries
$.each(libraries.listData,function(index,library){var $libraryRow=H5PUtils.createTableRow([library.title,"<input class=\"h5p-admin-restricted\" type=\"checkbox\"/>",{text:library.numContent,class:"h5p-admin-center"},{text:library.numContentDependencies,class:"h5p-admin-center"},{text:library.numLibraryDependencies,class:"h5p-admin-center"},"<div class=\"h5p-admin-buttons-wrapper\">"+"<button class=\"h5p-admin-upgrade-library\"></button>"+(library.detailsUrl?"<button class=\"h5p-admin-view-library\" title=\""+t.viewLibrary+"\"></button>":"")+(library.deleteUrl?"<button class=\"h5p-admin-delete-library\"></button>":"")+"</div>"]);H5PLibraryList.addRestricted($(".h5p-admin-restricted",$libraryRow),library.restrictedUrl,library.restricted);var hasContent=!(""===library.numContent||0===library.numContent);if(null===library.upgradeUrl){$(".h5p-admin-upgrade-library",$libraryRow).remove()}else if(!1===library.upgradeUrl||!hasContent){$(".h5p-admin-upgrade-library",$libraryRow).attr("disabled",!0)}else{$(".h5p-admin-upgrade-library",$libraryRow).attr("title",t.upgradeLibrary).click(function(){window.location.href=library.upgradeUrl})}// Open details view when clicked
$(".h5p-admin-view-library",$libraryRow).on("click",function(){window.location.href=library.detailsUrl});var $deleteButton=$(".h5p-admin-delete-library",$libraryRow);if(libraries.notCached!==void 0||hasContent||""!==library.numContentDependencies&&0!==library.numContentDependencies||""!==library.numLibraryDependencies&&0!==library.numLibraryDependencies){// Disabled delete if content.
$deleteButton.attr("disabled",!0)}else{// Go to delete page om click.
$deleteButton.attr("title",t.deleteLibrary).on("click",function(){window.location.href=library.deleteUrl})}$table.append($libraryRow)});return $table};H5PLibraryList.addRestricted=function($checkbox,url,selected){if(null===selected){$checkbox.remove()}else{$checkbox.change(function(){$checkbox.attr("disabled",!0);$.ajax({dataType:"json",url:url,cache:!1}).fail(function(){$checkbox.attr("disabled",!1);// Reset
$checkbox.attr("checked",!$checkbox.is(":checked"))}).done(function(result){url=result.url;$checkbox.attr("disabled",!1)})});if(selected){$checkbox.attr("checked",!0)}}};// Initialize me:
$(document).ready(function(){if(!H5PLibraryList.initialized){H5PLibraryList.initialized=!0;H5PLibraryList.init()}})})(H5P.jQuery);