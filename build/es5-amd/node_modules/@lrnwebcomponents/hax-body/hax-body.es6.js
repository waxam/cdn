import{html,Polymer}from"./node_modules/@polymer/polymer/polymer-legacy.js";import{dom}from"./node_modules/@polymer/polymer/lib/legacy/polymer.dom.js";import{FlattenedNodesObserver}from"./node_modules/@polymer/polymer/lib/utils/flattened-nodes-observer.js";import{flush}from"./node_modules/@polymer/polymer/lib/utils/flush.js";import*as async from"./node_modules/@polymer/polymer/lib/utils/async.js";import"./node_modules/@polymer/paper-item/paper-item.js";import"./node_modules/@lrnwebcomponents/simple-colors/simple-colors.js";import"./node_modules/@polymer/iron-a11y-keys/iron-a11y-keys.js";import"./node_modules/@lrnwebcomponents/grid-plate/grid-plate.js";import"./lib/hax-text-context.js";import"./lib/hax-ce-context.js";import"./lib/hax-plate-context.js";import"./lib/hax-input-mixer.js";var $_documentContainer=document.createElement("div");$_documentContainer.setAttribute("style","display: none;"),$_documentContainer.innerHTML="<dom-module id=\"hax-body\">\n  <template strip-whitespace=\"\">\n    <style include=\"simple-colors\">\n      :host {\n        display: block;\n        min-height: 32px;\n        min-width: 32px;\n        /*font-family: sans-serif;*/\n      }\n      :host #bodycontainer ::slotted(.hax-context-menu) {\n        padding: 0;\n        margin: 0;\n        position: absolute;\n        visibility: hidden;\n        opacity: 0;\n        transition: all .3s ease;\n        z-index: 100;\n        float: left;\n        display: block;\n      }\n      :host #bodycontainer ::slotted(#haxinputmixer) {\n        z-index: 10000000;\n      }\n      :host #bodycontainer ::slotted(.hax-context-visible) {\n        visibility: visible;\n        opacity: 1;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {\n        outline: none;\n        transition:\n          .6s width ease-in-out,\n          .6s height ease-in-out,\n          .6s margin ease-in-out;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(p):empty {\n        background: #f8f8f8;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]):hover {\n        outline: 1px dotted #d3d3d3;\n        outline-offset: 2px;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(* [data-editable]):hover {\n        outline: 1px dotted #d3d3d3;\n        outline-offset: 2px;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]):before {\n        content: '';\n        display: block;\n        position: absolute;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        width: 32px;\n        transition: .6s all ease;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]):hover:before {\n        content: '';\n        display: block;\n        position: absolute;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        width: 32px;\n        transition: .6s all ease;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*.hax-active[data-editable]) {\n        cursor: text !important;\n        outline: 1px dashed #c3c3c3 !important;\n        outline-offset: 4px;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable] .hax-active) {\n        cursor: text !important;\n        outline: 1px dashed #c3c3c3 !important;\n        outline-offset: 4px;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*.hax-active[data-editable]):before {\n        content: '';\n        display: block;\n        position: absolute;\n        top: 0;\n        left: 0;\n        bottom: 0;\n        width: 32px;\n        transition: .6s all ease;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(code.hax-active[data-editable]) {\n        display: block;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(hr[data-editable]) {\n        height:4px;\n        background-color: #EEEEEE;\n        padding-top: 8px;\n        padding-bottom: 8px;\n      }\n      /** Fix to support safari as it defaults to none */\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {\n        -webkit-user-select: text;\n        cursor:pointer;\n      }\n\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]::-moz-selection),\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable] *::-moz-selection) {\n        background-color: var(--hax-body-highlight, --paper-yellow-300);\n        color: black;\n      }\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]::selection),\n      :host([edit-mode]) #bodycontainer ::slotted(*[data-editable] *::selection) {\n        background-color: var(--hax-body-highlight, --paper-yellow-300);\n        color: black;\n      }\n      #bodycontainer {\n        -webkit-user-select: text;\n        user-select: text;\n      }\n\n      #contextcontainer {\n        display: none;\n      }\n      :host([edit-mode])[hax-ray-mode] #bodycontainer ::slotted(*[data-editable]) {\n        outline: 1px dashed #d3d3d3;\n        outline-offset: 4px;\n      }\n      :host([edit-mode])[hax-ray-mode] #bodycontainer ::slotted(*[data-editable]):before {\n        content: attr(data-hax-ray) \" \" attr(resource) \" \" attr(typeof) \" \" attr(property) \" \" attr(content);\n        font-size: 10px;\n        font-style: italic;\n        left: unset;\n        right: unset;\n        top: unset;\n        background-color: #d3d3d3;\n        color: #000000;\n        bottom: unset;\n        width: auto;\n        padding: 8px;\n        margin: 0;\n        z-index: 1;\n        margin: -16px 0 0 0;\n        float: left;\n        line-height: 2;\n      }\n    </style>\n    <div id=\"bodycontainer\" class=\"ignore-activation\">\n      <slot id=\"body\"></slot>\n    </div>\n    <div id=\"contextcontainer\">\n      <hax-text-context id=\"textcontextmenu\" class=\"hax-context-menu ignore-activation\"></hax-text-context>\n      <hax-ce-context id=\"cecontextmenu\" class=\"hax-context-menu ignore-activation\"></hax-ce-context>\n      <hax-plate-context id=\"platecontextmenu\" class=\"hax-context-menu ignore-activation\"></hax-plate-context>\n      <hax-input-mixer id=\"haxinputmixer\" class=\"hax-context-menu ignore-activation\"></hax-input-mixer>\n    </div>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"esc\" on-keys-pressed=\"_escKeyPressed\" stop-keyboard-event-propagation=\"\"></iron-a11y-keys>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"del backspace\" on-keys-pressed=\"_delKeyPressed\"></iron-a11y-keys>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"shift+tab\" on-keys-pressed=\"_tabBackKeyPressed\" stop-keyboard-event-propagation=\"\"></iron-a11y-keys>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"tab\" on-keys-pressed=\"_tabKeyPressed\" stop-keyboard-event-propagation=\"\"></iron-a11y-keys>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"up\" on-keys-pressed=\"_upKeyPressed\" stop-keyboard-event-propagation=\"\"></iron-a11y-keys>\n    <iron-a11y-keys target=\"[[activeContainerNode]]\" keys=\"down\" on-keys-pressed=\"_downKeyPressed\" stop-keyboard-event-propagation=\"\"></iron-a11y-keys>\n\n  </template>\n\n  \n</dom-module>",document.head.appendChild($_documentContainer);var HaxBody=Polymer({is:"hax-body",listeners:{focusin:"_focusIn",mousedown:"_focusIn","hax-context-item-selected":"_haxContextOperation","hax-input-mixer-update":"_haxInputMixerOperation","place-holder-replace":"replacePlaceholder"},properties:{editMode:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_editModeChanged"},globalPreferences:{type:Object,value:{},observer:"_globalPreferencesUpdated"},haxRayMode:{type:Boolean,value:!1,reflectToAttribute:!0},activeNode:{type:Object,value:null,notify:!0,observer:"_activeNodeChanged"},activeContainerNode:{type:Object,value:null,notify:!0,observer:"_activeContainerNodeChanged"}},ready:function(){var b=this;this.polyfillSafe=window.HaxStore.instance.computePolyfillSafe(),this._observer=new FlattenedNodesObserver(this,function(c){flush(),0<c.addedNodes.length&&c.addedNodes.map(function(d){b._haxElementTest(d)&&(b._HTMLPrimativeTest(d)&&(d.contentEditable=b.editMode),d.setAttribute("data-editable",b.editMode),d.setAttribute("data-hax-ray",d.tagName),b.fire("hax-body-tag-added",{node:d}))}),0<c.removedNodes.length&&c.removedNodes.map(function(d){b._haxElementTest(d)&&!d.classList.contains("hax-active")&&b.fire("hax-body-tag-removed",{node:d})})})},attached:function(){this.__tabTrap=!1,this.fire("hax-register-body",this),document.body.addEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),document.body.addEventListener("selectstart",this._selectionChange.bind(this)),document.body.addEventListener("mouseup",this._selectionMouseUp.bind(this)),window.addEventListener("scroll",this._keepContextVisible.bind(this))},detached:function(){document.body.removeEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),document.body.removeEventListener("selectstart",this._selectionChange.bind(this)),document.body.removeEventListener("mouseup",this._selectionMouseUp.bind(this)),window.removeEventListener("scroll",this._keepContextVisible.bind(this))},_keepContextVisible:function(){var c=!1;this.$.textcontextmenu.classList.contains("hax-context-visible")?c=this.$.textcontextmenu:this.$.cecontextmenu.classList.contains("hax-context-visible")&&(c=this.$.cecontextmenu),c&&(this.elementInViewport(c)?(c.classList.remove("hax-context-pin-bottom"),c.classList.remove("hax-context-pin-top")):this.__OffBottom?c.classList.add("hax-context-pin-top"):c.classList.add("hax-context-pin-bottom"))},elementInViewport:function(b){for(var c=b.offsetTop-32-window.HaxStore.instance.haxPanel.$.drawer.offsetHeight,d=b.offsetLeft,f=b.offsetWidth,g=b.offsetHeight;b.offsetParent;)b=b.offsetParent,c+=b.offsetTop,d+=b.offsetLeft;return this.__OffBottom=c<window.pageYOffset+window.innerHeight,c<window.pageYOffset+window.innerHeight&&d<window.pageXOffset+window.innerWidth&&c+g>window.pageYOffset&&d+f>window.pageXOffset},_selectionChange:function(){window.__startedSelection=!0},_selectionMouseUp:function(){if(window.__startedSelection&&this.editMode)try{var c=window.getSelection(),d=c.getRangeAt(0),f=d.cloneRange();window.__startedSelection=!1,("HAX-BODY"===f.startContainer.parentNode.parentNode.parentElement.tagName||"HAX-BODY"===f.startContainer.parentNode.parentElement.tagName)&&window.HaxStore.write("activePlaceHolder",f,this)}catch(g){}},replacePlaceholder:function(b){var c=this;if("text"===b.detail){var d=document.createElement("p");this.haxReplaceNode(this.activeNode,d,dom(this.activeNode).parentNode),setTimeout(function(){window.HaxStore.write("activeNode",d,c),d.focus()},100)}else this.replaceElementWorkflow()},replaceElementWorkflow:function(){var b=window.HaxStore.nodeToHaxElement(this.activeNode,null),c="*",d=!1;"place-holder"===b.tag&&babelHelpers.typeof(b.properties.type)!==babelHelpers.typeof(void 0)&&(c=b.properties.type,d=!0);var f={};if(babelHelpers.typeof(window.HaxStore.instance.elementList[b.tag])!==babelHelpers.typeof(void 0)&&!1!==window.HaxStore.instance.elementList[b.tag].gizmo&&babelHelpers.typeof(window.HaxStore.instance.elementList[b.tag].gizmo.handles)!==babelHelpers.typeof(void 0)&&0<window.HaxStore.instance.elementList[b.tag].gizmo.handles.length)for(var g=window.HaxStore.instance.elementList[b.tag].gizmo,h=0;h<g.handles.length;h++)for(var k in g.handles[h])"type"!==k&&babelHelpers.typeof(b.properties[g.handles[h][k]])!==babelHelpers.typeof(void 0)&&(f[k]=b.properties[g.handles[h][k]]);var m=window.HaxStore.guessGizmo(c,f,d);if(0<m.length){var n=this.activeNode.tagName.toLowerCase(),o=n.replace("-"," ");babelHelpers.typeof(window.HaxStore.instance.elementList[n])!==babelHelpers.typeof(void 0)&&!1!==window.HaxStore.instance.elementList[n].gizmo&&(o=window.HaxStore.instance.elementList[n].gizmo.title),window.HaxStore.instance.haxAppPicker.presentOptions(m,"__convert","Transform "+o+" to..","gizmo")}else window.HaxStore.toast("Sorry, this can not be transformed!",5e3)},_globalPreferencesUpdated:function(b){("undefined"===typeof b?"undefined":babelHelpers.typeof(b))!==babelHelpers.typeof(void 0)&&null!=b&&(this.haxRayMode=b.haxRayMode)},_haxStorePropertyUpdated:function(b){b.detail&&babelHelpers.typeof(b.detail.value)!==babelHelpers.typeof(void 0)&&b.detail.property&&("object"===babelHelpers.typeof(b.detail.value)&&this.set(b.detail.property,null),this.set(b.detail.property,b.detail.value))},haxClearBody:function(){var b=0<arguments.length&&arguments[0]!==void 0?arguments[0]:!0,c=!0;b&&(c=prompt("Are you sure you want to delete all content?")),c&&window.HaxStore.wipeSlot(this)},haxInsert:function(b,c){var d=this,f=2<arguments.length&&arguments[2]!==void 0?arguments[2]:{},g=window.HaxStore.instance.validTagList;if(g.includes(b)){var h=document.createElement(b);h.innerHTML=c;var k=h.cloneNode(!0);for(var m in f){var n=window.HaxStore.camelToDash(m);f.hasOwnProperty(m)&&(!0===f[m]?k.setAttribute(n,f[m]):!1===f[m]?k.removeAttribute(n):null==f[m]||f[m].constructor!==Array||k.properties[m].readOnly?null==f[m]||f[m].constructor!==Object||k.properties[m].readOnly?k.setAttribute(n,f[m]):k.set(n,f[m]):k.set(n,f[m]))}return null!==window.HaxStore.instance.activePlaceHolder&&babelHelpers.typeof(window.HaxStore.instance.activePlaceHolder.style)!==babelHelpers.typeof(void 0)?(k.style.width=window.HaxStore.instance.activePlaceHolder.style.width,k.style.float=window.HaxStore.instance.activePlaceHolder.style.float,k.style.margin=window.HaxStore.instance.activePlaceHolder.style.margin,k.style.display=window.HaxStore.instance.activePlaceHolder.style.display,this.haxReplaceNode(window.HaxStore.instance.activePlaceHolder,k,dom(window.HaxStore.instance.activePlaceHolder).parentNode),window.HaxStore.instance.activePlaceHolder=null):null===this.activeContainerNode?dom(this).appendChild(k):"GRID-PLATE"!==k.tagName&&"GRID-PLATE"===this.activeContainerNode.tagName&&this.activeContainerNode!==this.activeNode?(k.setAttribute("slot",this.activeNode.getAttribute("slot")),dom(this.activeContainerNode).insertBefore(k,this.activeNode)):dom(this).insertBefore(k,this.activeContainerNode.nextElementSibling),this.$.textcontextmenu.highlightOps=!1,setTimeout(function(){window.HaxStore.write("activeContainerNode",k,d),window.HaxStore.write("activeNode",k,d),k.focus(),"function"===typeof k.scrollIntoViewIfNeeded?k.scrollIntoViewIfNeeded(!0):k.scrollIntoView({behavior:"smooth",inline:"center"})},100),!0}return!1},haxToContent:function(){this.hideContextMenus();var b=this.activeNode;window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this);var c=dom(this.$.body).getDistributedNodes();this.globalPreferences.haxDeveloperMode&&console.log(c);for(var d="",f=0,g=c.length;f<g;f++)this._haxElementTest(c[f])?(c[f].removeAttribute("data-editable"),c[f].removeAttribute("data-hax-ray"),c[f].contentEditable=!1,d+=window.HaxStore.haxNodeToContent(c[f]),"grid-plate"===c[f].tagName.toLowerCase()&&this._applyContentEditable(this.editMode,c[f])):8===c[f].nodeType?d+="<!-- "+c[f].textContent+" -->":1!==c[f].nodeType&&babelHelpers.typeof(c[f].textContent)!==babelHelpers.typeof(void 0)&&"undefined"!==c[f].textContent&&(d+=c[f].textContent);if(d=d.replace(/\scontenteditable=\"false\"/g,""),d=d.replace(/\sdata-editable=\"true\"/g,""),d=d.replace(/\sdata-editable=\"false\"/g,""),d=d.replace(/\sdata-editable=\""/g,""),d=d.replace(/\sdata-editable/g,""),d=d.replace(/\scontenteditable/g,""),d=d.replace(/\sdraggable/g,""),d=d.replace(/\sdata-draggable/g,""),d=d.replace(/\sdata-hax-ray=\".*?\"/g,""),this.parentNode.tagName){var h=this.parentNode.tagName.toLowerCase(),k="style-scope "+h+" x-scope",m=new RegExp(k,"g");d=d.replace(m,""),k="style-scope "+h,m=new RegExp(k,"g"),d=d.replace(m,""),k="x-scope "+h+"-0",m=new RegExp(k,"g"),d=d.replace(m,"");var n=window.HaxStore.instance.validTagList;for(var f in n.push("hax-preview"),n)k="style-scope "+n[f],m=new RegExp(k,"g"),d=d.replace(m,""),k="x-scope "+n[f]+"-0 ",m=new RegExp(k,"g"),d=d.replace(m,""),k="x-scope "+n[f]+"-0",m=new RegExp(k,"g"),d=d.replace(m,"")}return d=d.replace(/\sclass=\"\"/g,""),d=d.replace(/\sclass=\"\s\"/g,""),this._applyContentEditable(this.editMode),window.HaxStore.write("activeNode",b,this),window.HaxStore.write("activeContainerNode",b,this),d=window.HaxStore.encapScript(d),this.globalPreferences.haxDeveloperMode&&console.log(d),d},haxDuplicateNode:function(b){var c=this,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this;this.hideContextMenus();var f=dom(b).cloneNode(!0);return"webview"===f.tagName.toLowerCase()&&window.HaxStore.instance._isSandboxed&&babelHelpers.typeof(f.guestinstance)!==babelHelpers.typeof(void 0)&&delete f.guestinstance,null===b?dom(d).appendChild(f):dom(d).insertBefore(f,dom(b).nextSibling),setTimeout(function(){d===c&&window.HaxStore.write("activeContainerNode",f,c),window.HaxStore.write("activeNode",f,c)},100),!0},hideContextMenus:function(){this._hideContextMenu(this.$.textcontextmenu),this._hideContextMenu(this.$.cecontextmenu),this._hideContextMenu(this.$.platecontextmenu),this._hideContextMenu(this.$.haxinputmixer),this.$.textcontextmenu.highlightOps=!1},positionContextMenus:function(b,c){var d=b.tagName.toLowerCase();window.HaxStore.instance._isSandboxed&&"webview"===d&&(d="iframe");var f=window.HaxStore.instance.elementList[d],g=Math.max(document.documentElement.clientWidth,window.innerWidth||0),h=-39,k=-31;800>g&&(h=0,k=0),("undefined"===typeof f?"undefined":babelHelpers.typeof(f))!==babelHelpers.typeof(void 0)&&"P"!==b.tagName?(this.__activeContextType=this.$.cecontextmenu,f.element=b,this.__activeContextType.setHaxProperties(f)):this.__activeContextType=this.$.textcontextmenu,this._positionContextMenu(this.__activeContextType,c,h,-37),this._positionContextMenu(this.$.platecontextmenu,c,k,0,!1),this._HTMLPrimativeTest(b)||b===c?this._HTMLPrimativeTest(c)&&(c.contentEditable=!0):c.contentEditable=!1},haxMoveGridPlate:function(b,c,d){return this.hideContextMenus(),"first"===b?null!==d.previousElementSibling&&dom(this).insertBefore(d,dom(this).firstChild):"up"===b?null!==d.previousElementSibling&&dom(this).insertBefore(d,d.previousElementSibling):"down"===b?null!==d.nextElementSibling&&dom(this).insertBefore(d.nextElementSibling,d):"last"===b?null!==d.nextElementSibling&&dom(this).appendChild(d):void 0,(this.positionContextMenus(c,d),setTimeout(function(){"function"===typeof d.scrollIntoViewIfNeeded?d.scrollIntoViewIfNeeded(!0):d.scrollIntoView({behavior:"smooth",inline:"center"})},250),!0)},haxReplaceNode:function(b,c){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:this;this.hideContextMenus();try{null!=b.getAttribute("slot")&&c.setAttribute("slot",b.getAttribute("slot")),dom(d).replaceChild(c,b)}catch(f){console.log(f)}return c},haxChangeTagName:function(b,c){this.hideContextMenus();for(var f=document.createElement(c),g=0,h=b.attributes.length;g<h;++g){var k=b.attributes.item(g).nodeName,m=b.attributes.item(g).value;f.setAttribute(k,m)}return f.innerHTML=b.innerHTML,dom(this).replaceChild(f,b),f},haxDeleteNode:function(b){var c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this;if(this.hideContextMenus(),null==this.activeContainerNode||null===this.activeContainerNode.previousElementSibling)null!=this.activeContainerNode&&null!==this.activeContainerNode.nextElementSibling?this.activeContainerNode.nextElementSibling.focus():(window.HaxStore.write("activeContainerNode",null,this),window.HaxStore.write("activeNode",null,this));else if(this.activeContainerNode.previousElementSibling.focus(),null!=this.activeContainerNode&&window.HaxStore.instance.isTextElement(this.activeContainerNode)&&""!==dom(this.activeContainerNode).textContent)try{var d=document.createRange(),f=window.getSelection();d.setStart(this.activeContainerNode,1),d.collapse(!0),f.removeAllRanges(),f.addRange(d),this.activeContainerNode.focus()}catch(g){console.log(g)}try{return dom(c).removeChild(b)}catch(g){console.log(g)}},importContent:function(b){var c=this,d=1<arguments.length&&arguments[1]!==void 0?arguments[1]:!0;d&&window.HaxStore.wipeSlot(this,"*"),setTimeout(function(){b=window.HaxStore.encapScript(b);var f=window.HaxStore.instance.validTagList,g=document.createElement("div");for(g.insertAdjacentHTML("beforeend",b);null!==g.firstChild;)if(!(babelHelpers.typeof(g.firstChild.tagName)!==babelHelpers.typeof(void 0)&&f.includes(g.firstChild.tagName.toLowerCase())))g.removeChild(g.firstChild);else if(window.HaxStore.instance._isSandboxed&&"iframe"===g.firstChild.tagName.toLowerCase()){for(var h=document.createElement("webview"),k=0,m=g.firstChild.attributes.length;k<m;++k){var n=g.firstChild.attributes.item(k).nodeName,o=g.firstChild.attributes.item(k).value;"height"!==n&&"width"!==n||h.style[n]!=o,h.setAttribute(n,o)}dom(c).appendChild(h)}else dom(c).appendChild(g.firstChild)},200)},_haxContextOperation:function(b){var c=this,d=b.detail,f;switch(d.eventName){case"p":case"h2":case"h3":case"h4":case"h5":case"h6":case"code":case"blockquote":this.$.textcontextmenu.selectedValue=d.eventName,window.HaxStore.write("activeContainerNode",this.haxChangeTagName(this.activeContainerNode,d.eventName),this);break;case"text-align-left":this.activeNode.style.textAlign=null,this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"text-align-right":this.activeNode.style.textAlign="right",this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"grid-plate-convert":this.replaceElementWorkflow();break;case"grid-plate-duplicate":this.activeNode===this.activeContainerNode?this.haxDuplicateNode(this.activeNode):this.haxDuplicateNode(this.activeNode,this.activeContainerNode);break;case"grid-plate-delete":var h=this.activeNode.tagName.toLowerCase(),k=h.replace("-"," ");babelHelpers.typeof(window.HaxStore.instance.elementList[h])!==babelHelpers.typeof(void 0)&&!1!==window.HaxStore.instance.elementList[h].gizmo&&(k=window.HaxStore.instance.elementList[h].gizmo.title),window.HaxStore.instance.haxAppPicker.presentOptions([{icon:"thumb-up",color:"green",title:"Yes"},{icon:"thumb-down",color:"red",title:"No"}],"","Remove this `"+k+"`?","delete");break;case"grid-plate-first":this.haxMoveGridPlate("first",this.activeNode,this.activeContainerNode);break;case"grid-plate-up":this.haxMoveGridPlate("up",this.activeNode,this.activeContainerNode);break;case"hax-manager-open":window.HaxStore.write("activeHaxElement",{},this),window.HaxStore.instance.haxManager.resetManager(parseInt(d.value)),window.HaxStore.instance.haxManager.toggleDialog();break;case"grid-plate-down":this.haxMoveGridPlate("down",this.activeNode,this.activeContainerNode);break;case"grid-plate-last":this.haxMoveGridPlate("last",this.activeNode,this.activeContainerNode);break;case"close-menu":window.HaxStore.write("activeContainerNode",null,this),window.HaxStore.write("activeNode",null,this);break;case"hax-edit-property":var m=this.$.haxinputmixer;m.label=d.target.label,m.options=d.target.options,m.icon=d.target.icon,m.description=d.target.description,m.required=d.target.required,m.validation=d.target.validation,m.validationType=d.target.validationType,m.inputMethod=d.target.inputMethod,m.value="",babelHelpers.typeof(d.target.propertyToBind)!==babelHelpers.typeof(void 0)&&null!=d.target.propertyToBind&&!1!=d.target.propertyToBind&&(m.propertyToBind=d.target.propertyToBind,m.value=babelHelpers.typeof(this.activeNode[d.target.propertyToBind])===babelHelpers.typeof(void 0)?this.activeNode.getAttribute(d.target.propertyToBind):this.activeNode[d.target.propertyToBind]),this._positionContextMenu(m,this.$.cecontextmenu,-6,-116),m.style.width=null;break;case"hax-align-left":this.activeNode.style.float=null,this.activeNode.style.margin=null,this.activeNode.style.display=null,this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"hax-align-center":this.activeNode.style.float=null,this.activeNode.style.margin="0 auto",this.activeNode.style.display="block",this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"hax-align-right":this.activeNode.style.float="right",this.activeNode.style.margin=null,this.activeNode.style.display=null,this.positionContextMenus(this.activeNode,this.activeContainerNode);break;case"hax-size-change":this.activeNode.style.width=d.value+"%",setTimeout(function(){c.positionContextMenus(c.activeNode,c.activeContainerNode)},1e3);break;case"hax-manager-configure":this._hideContextMenu(this.$.haxinputmixer),window.HaxStore.instance.haxManager.resetManager(),f=window.HaxStore.nodeToHaxElement(window.HaxStore.instance.activeNode),window.HaxStore.write("activeHaxElement",f,this),window.HaxStore.instance.haxManager.editExistingNode=!0,window.HaxStore.instance.haxManager.selectStep("configure"),window.HaxStore.instance.haxManager.toggleDialog(),setTimeout(function(){window.HaxStore.instance.haxManager.$.preview.$.configurebutton.focus()},100);break;case"hax-manager-configure-container":window.HaxStore.write("activeNode",window.HaxStore.instance.activeContainerNode,this),this._hideContextMenu(this.$.haxinputmixer),window.HaxStore.instance.haxManager.resetManager(),f=window.HaxStore.nodeToHaxElement(window.HaxStore.instance.activeNode),window.HaxStore.write("activeHaxElement",f,this),window.HaxStore.instance.haxManager.editExistingNode=!0,window.HaxStore.instance.haxManager.selectStep("configure"),window.HaxStore.instance.haxManager.toggleDialog(),setTimeout(function(){window.HaxStore.instance.haxManager.$.preview.$.configurebutton.focus()},100);}},_haxInputMixerOperation:function(b){var c=b.detail.inputMixer;null==c.propertyToBind?null!=c.slotToBind&&(item=document.createElement("span"),item.style.height="inherit",item.innerHTML=c.value,item.slot=c.slotToBind,this.activeNode.appendChild(item)):this.activeNode[c.propertyToBind]=c.value,this._hideContextMenu(this.$.haxinputmixer)},_focusIn:function(b){var c=this;if(this.editMode&&!this.__tabTrap){var d=dom(b),f=d.localTarget,g=window.HaxStore.instance.validTagList,h=f,k=null;if(this._haxElementTest(h)&&null!=h.parentNode){for(;"HAX-BODY"!=h.parentNode.tagName;)null===k&&g.includes(h.tagName.toLowerCase())&&"LI"!==h.tagName&&"B"!==h.tagName&&"I"!==h.tagName&&"STRONG"!==h.tagName&&"EM"!==h.tagName&&(k=h),h=h.parentNode;null===k?k=h:window.HaxStore.instance.isGridPlateElement(h)?["UL","OL","LI","P","GRID-PLATE"].includes(h.tagName)&&["UL","OL","LI"].includes(k.tagName)&&(k=h):k=h,this.activeContainerNode!==h&&g.includes(h.tagName.toLowerCase())&&!h.classList.contains("ignore-activation")?(window.HaxStore.write("activeContainerNode",h,this),b.stopPropagation()):h.classList.contains("ignore-activation")&&b.stopPropagation(),this.activeNode!==k&&g.includes(h.tagName.toLowerCase())&&!k.classList.contains("ignore-activation")&&(setTimeout(function(){window.HaxStore.write("activeNode",k,c)},50),b.stopPropagation())}}else this.__tabTrap=!1},_editModeChanged:function(b,c){("undefined"===typeof c?"undefined":babelHelpers.typeof(c))!==babelHelpers.typeof(void 0)&&(this._applyContentEditable(b),!1!==b&&babelHelpers.typeof(this.activeNode)!==babelHelpers.typeof(void 0)&&null!==this.activeNode&&this.positionContextMenus(this.activeNode,this.activeContainerNode)),!1===b&&this.hideContextMenus()},_haxResolvePreviousElement:function(b){for(b=dom(b).previousElementSibling;babelHelpers.typeof(b.tagName)!==babelHelpers.typeof(void 0)&&"HAX-"===b.tagName.substring(0,4);)b=dom(b).previousElementSibling;return b},_haxElementTest:function(b){return babelHelpers.typeof(b.tagName)!==babelHelpers.typeof(void 0)&&"HAX-"!==b.tagName.substring(0,4)},_HTMLPrimativeTest:function(b){return babelHelpers.typeof(b.tagName)!==babelHelpers.typeof(void 0)&&-1==b.tagName.indexOf("-")},_applyContentEditable:function(b){var c=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this.$.body,d=dom(c).getDistributedNodes();0===d.length&&(d=dom(c).getEffectiveChildNodes());for(var f=0,g=d.length;f<g;f++)this._HTMLPrimativeTest(d[f])&&(d[f].contentEditable=b),this._haxElementTest(d[f])&&(b?(d[f].setAttribute("data-editable",b),d[f].setAttribute("data-hax-ray",d[f].tagName)):(d[f].removeAttribute("data-editable"),d[f].removeAttribute("data-hax-ray")))},_activeContainerNodeChanged:function(b){if(this.editMode&&("undefined"===typeof b?"undefined":babelHelpers.typeof(b))!==babelHelpers.typeof(void 0)&&null!==b){var d=b.tagName.toLowerCase();"grid-plate"===d&&(b.editMode=this.editMode,this._applyContentEditable(this.editMode,b))}},_activeNodeChanged:function(b,c){var d=this;if(("undefined"===typeof c?"undefined":babelHelpers.typeof(c))!==babelHelpers.typeof(void 0)&&null!=c&&c.classList.remove("hax-active"),this.editMode&&("undefined"===typeof b?"undefined":babelHelpers.typeof(b))!==babelHelpers.typeof(void 0)&&null!==b){var f=b.tagName.toLowerCase();b.classList.add("hax-active"),this.$.textcontextmenu.selectedValue=f,setTimeout(function(){d.positionContextMenus(b,window.HaxStore.instance.activeContainerNode)},25),"right"==b.style.textAlign?(this.$.textcontextmenu.justifyIcon="editor:format-align-right",this.$.textcontextmenu.justifyValue="text-align-right"):"left"==b.style.textAlign?(this.$.textcontextmenu.justifyIcon="editor:format-align-left",this.$.textcontextmenu.justifyValue="text-align-left"):"left"==b.style.float?(this.$.cecontextmenu.justifyIcon="editor:format-align-left",this.$.cecontextmenu.justifyValue="hax-align-left"):"right"==b.style.float?(this.$.cecontextmenu.justifyIcon="editor:format-align-right",this.$.cecontextmenu.justifyValue="hax-align-right"):"0 auto"==b.style.margin&&(this.$.cecontextmenu.justifyIcon="editor:format-align-center",this.$.cecontextmenu.justifyValue="hax-align-center")}else null===b&&(this.hideContextMenus(),this.$.textcontextmenu.justifyIcon="editor:format-align-left",this.$.textcontextmenu.justifyValue="text-align-left")},_positionContextMenu:function(b,c,d,f){var g=4<arguments.length&&arguments[4]!==void 0?arguments[4]:!0;try{dom(this).insertBefore(b,c)}catch(k){try{dom(c.parentNode).insertBefore(b,c)}catch(m){}}g&&(b.style.width=c.style.width);var h=c.currentStyle||window.getComputedStyle(c);0==parseInt(h.marginLeft)?d=d+parseInt(c.offsetLeft)-this.offsetLeft:d+=parseInt(h.marginLeft),null!=d&&(b.style["margin-left"]=d+"px"),null!=f&&(b.style["margin-top"]=f+"px"),b.classList.add("hax-context-visible"),async.microTask.run(this._keepContextVisible())},_hideContextMenu:function(b){b.classList.remove("hax-context-visible"),b.classList.remove("hax-context-pin-top"),b.classList.remove("hax-context-pin-bottom"),dom(this.$.contextcontainer).appendChild(b)},_escKeyPressed:function(b){this.editMode&&(b.preventDefault(),b.stopPropagation(),this.$.textcontextmenu.highlightOps?(this.$.textcontextmenu.highlightOps=!1,window.HaxStore.write("activeNode",this.activeContainerNode,this),this.activeContainerNode.focus()):this.activeNode===this.activeContainerNode?(window.HaxStore.write("activeContainerNode",null,this),window.HaxStore.write("activeNode",null,this),document.body.focus()):(window.HaxStore.write("activeNode",this.activeContainerNode,this),this.activeContainerNode.focus()))},_delKeyPressed:function(b){var c=this;if(this.editMode){var d=dom(this.activeContainerNode).textContent;if(""===d)b.preventDefault(),b.stopPropagation(),this.haxDeleteNode(this.activeContainerNode);else if(window.HaxStore.instance.isTextElement(this._haxResolvePreviousElement(this.activeContainerNode))){var f=window.getSelection(),g=f.getRangeAt(0).cloneRange(),h=g.commonAncestorContainer.tagName;if(("undefined"===typeof h?"undefined":babelHelpers.typeof(h))===babelHelpers.typeof(void 0)&&(h=g.commonAncestorContainer.parentNode.tagName),0===g.startOffset&&0===g.endOffset&&!["UL","OL","LI"].includes(h)){for(b.preventDefault(),b.stopPropagation();this.activeContainerNode.firstChild;)this._haxResolvePreviousElement(this.activeContainerNode).appendChild(this.activeContainerNode.firstChild);setTimeout(function(){c.haxDeleteNode(c.activeContainerNode)},100)}}}},_upKeyPressed:function(){if(this.editMode&&""===dom(this.activeContainerNode).textContent){var c=this._haxResolvePreviousElement(this.activeContainerNode);try{c.focus()}catch(d){}}},_downKeyPressed:function(){if(this.editMode&&""===dom(this.activeContainerNode).textContent){var c=dom(this.activeContainerNode);try{c.nextElementSibling.focus()}catch(d){}}},_tabKeyPressed:function(b){if(this.editMode){b.preventDefault(),b.stopPropagation(),b.stopImmediatePropagation();var c=!1,d=this.activeContainerNode,f=this.activeContainerNode.tagName;try{var g=window.getSelection(),h=g.getRangeAt(0).cloneRange(),k=h.commonAncestorContainer.tagName;if(("undefined"===typeof k?"undefined":babelHelpers.typeof(k))===babelHelpers.typeof(void 0)&&(k=h.commonAncestorContainer.parentNode.tagName),["UL","OL","LI"].includes(f)||["UL","OL","LI"].includes(k))this.polyfillSafe&&(document.execCommand("indent"),this.__tabTrap=!0);else for(;!c;)null==dom(d).nextSibling?c=!0:"function"===dom(d).nextSibling.focus?(dom(d).nextSibling.focus(),c=!0):d=dom(d).nextSibling}catch(m){}}},_tabBackKeyPressed:function(b){if(this.editMode){b.preventDefault(),b.stopPropagation(),b.stopImmediatePropagation();var c=dom(this.activeContainerNode).previousSibling,d=this.activeContainerNode.tagName,f=window.getSelection();try{var g=f.getRangeAt(0).cloneRange();if(["UL","OL","LI"].includes(d)||["UL","OL","LI"].includes(g.commonAncestorContainer.parentElement.tagName))this.polyfillSafe&&(document.execCommand("outdent"),this.__tabTrap=!0);else{if(null!=c)for(;null!=c&&!this._haxElementTest(c);)c=dom(c).previousSibling;null!=c&&setTimeout(function(){c.focus()},100)}}catch(h){}}}});export{HaxBody};