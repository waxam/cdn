define(["exports","../../../@polymer/polymer/polymer-element.js","../../../@polymer/paper-input/paper-input.js","../../../@vaadin/vaadin-upload/vaadin-upload.js","../../simple-colors/simple-colors.js","./hax-shared-styles.js"],function(_exports,_polymerElement){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.HaxUploadField=void 0;function _templateObject_2d80270054c311e99540492d34b1bf39(){var data=babelHelpers.taggedTemplateLiteral(["\n      <style is=\"custom-style\" include=\"simple-colors hax-shared-styles\">\n        :host {\n          display: block;\n          justify-content: flex-start;\n          visibility: visible;\n          transition: 0.3s all ease;\n          box-sizing: border-box;\n          pointer-events: all;\n        }\n        vaadin-upload {\n          --primary-color: var(--hax-color-accent1);\n          --primary-font-color: #ffffff;\n          --dark-primary-color: #ffffff;\n          --light-primary-color: var(--hax-color-accent1);\n          --error-color: darkred;\n          padding: 0;\n          margin: 0;\n          border: none;\n          --vaadin-upload-button-add-wrapper: {\n            border: none;\n            background-color: var(--hax-color-accent1);\n            color: #ffffff;\n            display: block;\n          }\n          --vaadin-upload-buttons-primary: {\n            display: block;\n            width: 100%;\n            flex: unset;\n            -webkit-flex: unset;\n          }\n          --vaadin-upload-button-add: {\n            color: #000000;\n            display: block;\n            flex: unset;\n            -webkit-flex: unset;\n            text-align: center;\n          }\n          --vaadin-upload-drop-label: {\n            color: #ffffff;\n            display: block;\n            padding: 0;\n            margin: 0;\n          }\n          --vaadin-upload-drop-label-dragover: {\n            color: #ffffff;\n          }\n          --vaadin-upload-file-list: {\n            padding: 0;\n            margin: 0;\n            color: #ffffff;\n          }\n          --vaadin-upload-file: {\n            color: #ffffff;\n          }\n        }\n        vaadin-upload[dragover] {\n          border-color: #396;\n        }\n        vaadin-upload-file {\n          --disabled-text-color: #222222;\n        }\n        paper-input {\n          color: var(--hax-color-text);\n        }\n      </style>\n      <paper-input\n        id=\"url\"\n        value=\"{{value}}\"\n        label=\"URL\"\n        type=\"url\"\n        auto-validate=\"\"\n      ></paper-input>\n      <vaadin-upload\n        form-data-name=\"file-upload\"\n        id=\"fileupload\"\n      ></vaadin-upload>\n    "]);_templateObject_2d80270054c311e99540492d34b1bf39=function(){return data};return data}var HaxUploadField=function(_PolymerElement){babelHelpers.inherits(HaxUploadField,_PolymerElement);function HaxUploadField(){babelHelpers.classCallCheck(this,HaxUploadField);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(HaxUploadField).apply(this,arguments))}babelHelpers.createClass(HaxUploadField,[{key:"_fileAboutToUpload",value:function _fileAboutToUpload(e){if(!this.__allowUpload){e.preventDefault();e.stopPropagation();var values={source:e.detail.file.name,type:e.detail.file.type},type=window.HaxStore.guessGizmoType(values),targets=window.HaxStore.getHaxAppStoreTargets(type);if(1===targets.length){this._haxAppPickerSelection({detail:targets[0]})}else if(0!==targets.length){window.HaxStore.instance.haxAppPicker.presentOptions(targets,type,"Where would you like to upload this "+type+"?","app")}else{window.HaxStore.toast("Sorry, you don't have a storage location that can handle "+type+" uploads!",5e3)}}else{this.__allowUpload=!1}}},{key:"_fileUploadResponse",value:function _fileUploadResponse(e){var response=JSON.parse(e.detail.xhr.response),map=this.__appUsed.connection.operations.add.resultMap,data={},item={};if(babelHelpers.typeof(this._resolveObjectPath(map.item,response))!=="undefined"){data=this._resolveObjectPath(map.item,response)}item.type=map.defaultGizmoType;for(var prop in map.gizmo){item[prop]=this._resolveObjectPath(map.gizmo[prop],data)}if(babelHelpers.typeof(item.url)==="undefined"&&babelHelpers.typeof(item.source)!=="undefined"){item.url=item.source}if(babelHelpers.typeof(map.gizmo.type)!=="undefined"){item.type=this._resolveObjectPath(map.gizmo.type,data)}this.$.url.value=item.url}},{key:"_haxAppPickerSelection",value:function _haxAppPickerSelection(e){var connection=e.detail.connection;this.__appUsed=e.detail;this.$.fileupload.method=connection.operations.add.method;var requestEndPoint=connection.protocol+"://"+connection.url;if("/"!=requestEndPoint.substr(requestEndPoint.length-1)){requestEndPoint+="/"}if(babelHelpers.typeof(connection.operations.add.endPoint)!=="undefined"){requestEndPoint+=connection.operations.add.endPoint}if(null!=window.HaxStore.instance.connectionRewrites.appendUploadEndPoint){requestEndPoint+="?"+window.HaxStore.instance.connectionRewrites.appendUploadEndPoint}if(null!=window.HaxStore.instance.connectionRewrites.appendJwt){requestEndPoint+="&"+window.HaxStore.instance.connectionRewrites.appendJwt+"="+localStorage.getItem(window.HaxStore.instance.connectionRewrites.appendJwt)}this.$.fileupload.headers=connection.headers;this.$.fileupload.target=requestEndPoint;this.__allowUpload=!0;this.$.fileupload.uploadFiles()}},{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(HaxUploadField.prototype),"connectedCallback",this).call(this);this.$.fileupload.addEventListener("upload-before",this._fileAboutToUpload.bind(this));this.$.fileupload.addEventListener("upload-response",this._fileUploadResponse.bind(this));document.body.addEventListener("hax-app-picker-selection",this._haxAppPickerSelection.bind(this))}},{key:"disconnectedCallback",value:function disconnectedCallback(){this.$.fileupload.removeEventListener("upload-before",this._fileAboutToUpload.bind(this));this.$.fileupload.removeEventListener("upload-response",this._fileUploadResponse.bind(this));document.body.removeEventListener("hax-app-picker-selection",this._haxAppPickerSelection.bind(this));babelHelpers.get(babelHelpers.getPrototypeOf(HaxUploadField.prototype),"disconnectedCallback",this).call(this)}},{key:"_resolveObjectPath",value:function _resolveObjectPath(path,obj){return path.split(".").reduce(function(prev,curr){return prev?prev[curr]:null},obj||self)}}],[{key:"template",get:function get(){return(0,_polymerElement.html)(_templateObject_2d80270054c311e99540492d34b1bf39())}},{key:"properties",get:function get(){return{value:{type:String,notify:!0}}}}]);return HaxUploadField}(_polymerElement.PolymerElement);_exports.HaxUploadField=HaxUploadField;window.customElements.define("hax-upload-field",HaxUploadField)});