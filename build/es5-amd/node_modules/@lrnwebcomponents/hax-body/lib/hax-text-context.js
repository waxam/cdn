define(["exports", "require", "../../../@polymer/polymer/polymer-element.js", "../../../@polymer/polymer/lib/utils/render-status.js", "../../simple-colors/simple-colors.js", "./hax-shared-styles.js"], function (_exports, _require, _polymerElement, _renderStatus, _simpleColors, _haxSharedStyles) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.HaxTextContext = void 0;
  _require = babelHelpers.interopRequireWildcard(_require);

  function _templateObject_54095450b3b911e9b58d79562a23326c() {
    var data = babelHelpers.taggedTemplateLiteral(["\n      <style include=\"hax-shared-styles\">\n        :host {\n          display: block;\n          pointer-events: none;\n          background-color: white;\n        }\n        :host [hidden] {\n          display: none;\n        }\n        paper-item {\n          -webkit-justify-content: flex-start;\n          justify-content: flex-start;\n          height: 36px;\n          padding: 0 8px;\n          min-height: 36px;\n        }\n        paper-item:hover {\n          background-color: #d3d3d3;\n          cursor: pointer;\n        }\n        iron-icon {\n          padding: 8px;\n        }\n        paper-item strong {\n          padding: 8px;\n          font-size: 12px;\n        }\n        :host(.hax-context-pin-top) hax-toolbar {\n          position: fixed;\n          top: 64px;\n          opacity: 0.95;\n        }\n        :host(.hax-context-pin-bottom) hax-toolbar {\n          position: fixed;\n          bottom: 0;\n          opacity: 0.95;\n        }\n      </style>\n      <hax-toolbar selected=\"[[selection]]\" hide-transform=\"\" id=\"toolbar\">\n        <hax-context-item-menu\n          slot=\"primary\"\n          selected-value=\"{{selectedValue}}\"\n          id=\"formatsize\"\n          icon=\"text-format\"\n          label=\"Format\"\n          event-name=\"text-tag\"\n        >\n          <paper-item value=\"p\"\n            ><iron-icon icon=\"editor:format-textdirection-l-to-r\"></iron-icon\n            >Normal text <strong>&lt;P&gt;</strong></paper-item\n          >\n          <paper-item value=\"ul\"\n            ><iron-icon icon=\"editor:format-list-bulleted\"></iron-icon>Bulleted\n            list <strong>&lt;UL&gt;</strong></paper-item\n          >\n          <paper-item value=\"ol\"\n            ><iron-icon icon=\"editor:format-list-numbered\"></iron-icon>Numbered\n            list <strong>&lt;OL&gt;</strong></paper-item\n          >\n          <paper-item value=\"h2\"\n            ><iron-icon icon=\"editor:title\"></iron-icon>Title\n            <strong>&lt;H2&gt;</strong></paper-item\n          >\n          <paper-item value=\"h3\"\n            ><iron-icon icon=\"editor:title\"></iron-icon>Content heading\n            <strong>&lt;H3&gt;</strong></paper-item\n          >\n          <paper-item value=\"h4\"\n            ><iron-icon icon=\"editor:text-fields\"></iron-icon>Subheading\n            <strong>&lt;H4&gt;</strong></paper-item\n          >\n          <paper-item value=\"h5\"\n            ><iron-icon icon=\"editor:text-fields\"></iron-icon>Deeper subheading\n            <strong>&lt;H5&gt;</strong></paper-item\n          >\n          <paper-item value=\"blockquote\"\n            ><iron-icon icon=\"editor:format-quote\"></iron-icon>Quote<strong\n              >&lt;blockquote&gt;</strong\n            ></paper-item\n          >\n          <paper-item value=\"code\"\n            ><iron-icon icon=\"icons:code\"></iron-icon>Code block<strong\n              >&lt;code&gt;</strong\n            ></paper-item\n          >\n        </hax-context-item-menu>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-bold\"\n          label=\"Bold\"\n          event-name=\"text-bold\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-italic\"\n          label=\"Italic\"\n          event-name=\"text-italic\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:insert-link\"\n          label=\"Link\"\n          event-name=\"text-link\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-list-bulleted\"\n          event-name=\"text-list-bulleted\"\n          label=\"Bulleted list\"\n          hidden$=\"[[!_showIndent]]\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-list-numbered\"\n          label=\"Numbered list\"\n          event-name=\"text-list-numbered\"\n          hidden$=\"[[!_showIndent]]\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-indent-decrease\"\n          label=\"Outdent\"\n          event-name=\"text-outdent\"\n          hidden$=\"[[!_showIndent]]\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-indent-increase\"\n          label=\"Indent\"\n          event-name=\"text-indent\"\n          hidden$=\"[[!_showIndent]]\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-clear\"\n          label=\"Remove format\"\n          event-name=\"text-remove-format\"\n        ></hax-context-item-textop>\n        <hax-context-item\n          slot=\"primary\"\n          icon=\"device:graphic-eq\"\n          label=\"Advanced item\"\n          event-name=\"insert-inline-gizmo\"\n          hidden$=\"[[isSafari]]\"\n        ></hax-context-item>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"device:graphic-eq\"\n          label=\"Advanced item\"\n          event-name=\"insert-inline-gizmo\"\n          hidden$=\"[[!isSafari]]\"\n        ></hax-context-item-textop>\n\n        <hax-context-item-textop\n          menu\n          slot=\"more\"\n          icon=\"mdextra:unlink\"\n          event-name=\"text-unlink\"\n          >Remove link</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          menu\n          slot=\"more\"\n          icon=\"mdextra:subscript\"\n          event-name=\"text-subscript\"\n          >Subscript</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          menu\n          slot=\"more\"\n          icon=\"mdextra:superscript\"\n          event-name=\"text-superscript\"\n          >Superscript</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          menu\n          slot=\"more\"\n          icon=\"editor:format-underlined\"\n          event-name=\"text-underline\"\n          >Underline</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          menu\n          slot=\"more\"\n          icon=\"editor:format-strikethrough\"\n          event-name=\"text-strikethrough\"\n          >Cross out</hax-context-item-textop\n        >\n      </hax-toolbar>\n    "], ["\n      <style include=\"hax-shared-styles\">\n        :host {\n          display: block;\n          pointer-events: none;\n          background-color: white;\n        }\n        :host [hidden] {\n          display: none;\n        }\n        paper-item {\n          -webkit-justify-content: flex-start;\n          justify-content: flex-start;\n          height: 36px;\n          padding: 0 8px;\n          min-height: 36px;\n        }\n        paper-item:hover {\n          background-color: #d3d3d3;\n          cursor: pointer;\n        }\n        iron-icon {\n          padding: 8px;\n        }\n        paper-item strong {\n          padding: 8px;\n          font-size: 12px;\n        }\n        :host(.hax-context-pin-top) hax-toolbar {\n          position: fixed;\n          top: 64px;\n          opacity: 0.95;\n        }\n        :host(.hax-context-pin-bottom) hax-toolbar {\n          position: fixed;\n          bottom: 0;\n          opacity: 0.95;\n        }\n      </style>\n      <hax-toolbar selected=\"[[selection]]\" hide-transform=\"\" id=\"toolbar\">\n        <hax-context-item-menu\n          slot=\"primary\"\n          selected-value=\"{{selectedValue}}\"\n          id=\"formatsize\"\n          icon=\"text-format\"\n          label=\"Format\"\n          event-name=\"text-tag\"\n        >\n          <paper-item value=\"p\"\n            ><iron-icon icon=\"editor:format-textdirection-l-to-r\"></iron-icon\n            >Normal text <strong>&lt;P&gt;</strong></paper-item\n          >\n          <paper-item value=\"ul\"\n            ><iron-icon icon=\"editor:format-list-bulleted\"></iron-icon>Bulleted\n            list <strong>&lt;UL&gt;</strong></paper-item\n          >\n          <paper-item value=\"ol\"\n            ><iron-icon icon=\"editor:format-list-numbered\"></iron-icon>Numbered\n            list <strong>&lt;OL&gt;</strong></paper-item\n          >\n          <paper-item value=\"h2\"\n            ><iron-icon icon=\"editor:title\"></iron-icon>Title\n            <strong>&lt;H2&gt;</strong></paper-item\n          >\n          <paper-item value=\"h3\"\n            ><iron-icon icon=\"editor:title\"></iron-icon>Content heading\n            <strong>&lt;H3&gt;</strong></paper-item\n          >\n          <paper-item value=\"h4\"\n            ><iron-icon icon=\"editor:text-fields\"></iron-icon>Subheading\n            <strong>&lt;H4&gt;</strong></paper-item\n          >\n          <paper-item value=\"h5\"\n            ><iron-icon icon=\"editor:text-fields\"></iron-icon>Deeper subheading\n            <strong>&lt;H5&gt;</strong></paper-item\n          >\n          <paper-item value=\"blockquote\"\n            ><iron-icon icon=\"editor:format-quote\"></iron-icon>Quote<strong\n              >&lt;blockquote&gt;</strong\n            ></paper-item\n          >\n          <paper-item value=\"code\"\n            ><iron-icon icon=\"icons:code\"></iron-icon>Code block<strong\n              >&lt;code&gt;</strong\n            ></paper-item\n          >\n        </hax-context-item-menu>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-bold\"\n          label=\"Bold\"\n          event-name=\"text-bold\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-italic\"\n          label=\"Italic\"\n          event-name=\"text-italic\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:insert-link\"\n          label=\"Link\"\n          event-name=\"text-link\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-list-bulleted\"\n          event-name=\"text-list-bulleted\"\n          label=\"Bulleted list\"\n          hidden$=\"[[!_showIndent]]\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-list-numbered\"\n          label=\"Numbered list\"\n          event-name=\"text-list-numbered\"\n          hidden\\$=\"[[!_showIndent]]\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-indent-decrease\"\n          label=\"Outdent\"\n          event-name=\"text-outdent\"\n          hidden$=\"[[!_showIndent]]\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-indent-increase\"\n          label=\"Indent\"\n          event-name=\"text-indent\"\n          hidden$=\"[[!_showIndent]]\"\n        ></hax-context-item-textop>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"editor:format-clear\"\n          label=\"Remove format\"\n          event-name=\"text-remove-format\"\n        ></hax-context-item-textop>\n        <hax-context-item\n          slot=\"primary\"\n          icon=\"device:graphic-eq\"\n          label=\"Advanced item\"\n          event-name=\"insert-inline-gizmo\"\n          hidden$=\"[[isSafari]]\"\n        ></hax-context-item>\n        <hax-context-item-textop\n          slot=\"primary\"\n          icon=\"device:graphic-eq\"\n          label=\"Advanced item\"\n          event-name=\"insert-inline-gizmo\"\n          hidden$=\"[[!isSafari]]\"\n        ></hax-context-item-textop>\n\n        <hax-context-item-textop\n          menu\n          slot=\"more\"\n          icon=\"mdextra:unlink\"\n          event-name=\"text-unlink\"\n          >Remove link</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          menu\n          slot=\"more\"\n          icon=\"mdextra:subscript\"\n          event-name=\"text-subscript\"\n          >Subscript</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          menu\n          slot=\"more\"\n          icon=\"mdextra:superscript\"\n          event-name=\"text-superscript\"\n          >Superscript</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          menu\n          slot=\"more\"\n          icon=\"editor:format-underlined\"\n          event-name=\"text-underline\"\n          >Underline</hax-context-item-textop\n        >\n        <hax-context-item-textop\n          menu\n          slot=\"more\"\n          icon=\"editor:format-strikethrough\"\n          event-name=\"text-strikethrough\"\n          >Cross out</hax-context-item-textop\n        >\n      </hax-toolbar>\n    "]);

    _templateObject_54095450b3b911e9b58d79562a23326c = function _templateObject_54095450b3b911e9b58d79562a23326c() {
      return data;
    };

    return data;
  }

  /**
   * `hax-text-context`
   * `A context menu that provides common text based authoring options.`
   * @microcopy - the mental model for this element
   * - context menu - this is a menu of text based buttons and events for use in a larger solution.
   */
  var HaxTextContext =
  /*#__PURE__*/
  function (_PolymerElement) {
    babelHelpers.inherits(HaxTextContext, _PolymerElement);

    function HaxTextContext() {
      var _this;

      babelHelpers.classCallCheck(this, HaxTextContext);
      _this = babelHelpers.possibleConstructorReturn(this, babelHelpers.getPrototypeOf(HaxTextContext).call(this));
      new Promise(function (res, rej) {
        return _require.default(["../../../@polymer/paper-item/paper-item.js"], res, rej);
      });
      new Promise(function (res, rej) {
        return _require.default(["../../../@polymer/iron-icons/iron-icons.js"], res, rej);
      });
      new Promise(function (res, rej) {
        return _require.default(["../../../@polymer/iron-icon/iron-icon.js"], res, rej);
      });
      new Promise(function (res, rej) {
        return _require.default(["../../md-extra-icons/md-extra-icons.js"], res, rej);
      });
      new Promise(function (res, rej) {
        return _require.default(["./hax-context-item-menu.js"], res, rej);
      });
      new Promise(function (res, rej) {
        return _require.default(["./hax-context-item.js"], res, rej);
      });
      new Promise(function (res, rej) {
        return _require.default(["./hax-context-item-textop.js"], res, rej);
      });
      new Promise(function (res, rej) {
        return _require.default(["./hax-toolbar.js"], res, rej);
      });

      _this.addEventListener("hax-context-item-selected", _this._haxContextOperation.bind(babelHelpers.assertThisInitialized(_this)));

      return _this;
    }

    babelHelpers.createClass(HaxTextContext, [{
      key: "_computeShowIndent",
      value: function _computeShowIndent(selectedValue, polyfillSafe) {
        if (polyfillSafe && (selectedValue === "ol" || selectedValue === "ul")) {
          return true;
        }

        return false;
      }
    }, {
      key: "ready",
      value: function ready() {
        babelHelpers.get(babelHelpers.getPrototypeOf(HaxTextContext.prototype), "ready", this).call(this);
      }
      /**
       * life cycle, figure out polyfill
       */

    }, {
      key: "connectedCallback",
      value: function connectedCallback() {
        babelHelpers.get(babelHelpers.getPrototypeOf(HaxTextContext.prototype), "connectedCallback", this).call(this);
        (0, _renderStatus.afterNextRender)(this, function () {
          this.polyfillSafe = window.HaxStore.instance.computePolyfillSafe();
        });
      }
    }, {
      key: "disconnectedCallback",
      value: function disconnectedCallback() {
        babelHelpers.get(babelHelpers.getPrototypeOf(HaxTextContext.prototype), "disconnectedCallback", this).call(this);
      }
      /**
       * Respond to simple modifications.
       */

    }, {
      key: "_haxContextOperation",
      value: function _haxContextOperation(e) {
        var _this2 = this;

        var detail = e.detail;
        var selection = window.HaxStore.getSelection(); // support a simple insert event to bubble up or everything else

        switch (detail.eventName) {
          case "close-menu":
            setTimeout(function () {
              _this2.shadowRoot.querySelector("#formatsize").shadowRoot.querySelector("#menu").hideMenu();
            }, 200);
            break;

          case "insert-inline-gizmo":
            if (window.HaxStore._tmpSelection && window.HaxStore.instance.editMode) {
              var localRange = false;

              try {
                if (window.HaxStore._tmpRange.startContainer.parentNode.parentNode.tagName === "HAX-BODY" || window.HaxStore._tmpRange.startContainer.parentNode.parentNode.parentNode.tagName === "HAX-BODY") {
                  window.HaxStore.write("activePlaceHolder", window.HaxStore._tmpRange, this);
                  localRange = window.HaxStore._tmpRange;
                }
              } catch (err) {}
            }

            if (localRange || window.HaxStore.instance.activePlaceHolder != null) {
              // store placeholder because if this all goes through we'll want
              // to kill the originating text
              var values = {
                text: window.HaxStore.instance.activePlaceHolder.toString()
              };
              var type = "inline";
              var haxElements = window.HaxStore.guessGizmo(type, values); // see if we got anything

              if (haxElements.length > 0) {
                // hand off to hax-app-picker to deal with the rest of this
                window.HaxStore.instance.haxAppPicker.presentOptions(haxElements, type, "Transform selected text to..", "gizmo");
              }
            }

            break;
          // wow these are way too easy

          case "text-bold":
            document.execCommand("bold");
            e.preventDefault();
            e.stopPropagation();
            break;

          case "text-italic":
            document.execCommand("italic");
            e.preventDefault();
            e.stopPropagation();
            break;

          case "text-underline":
            document.execCommand("underline");
            e.preventDefault();
            e.stopPropagation(); // silly hack to account for trigging a selection from
            // inside the menu that isn't from a paper-item

            this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();
            break;

          case "text-subscript":
            document.execCommand("subscript");
            e.preventDefault();
            e.stopPropagation(); // silly hack to account for trigging a selection from
            // inside the menu that isn't from a paper-item

            this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();
            break;

          case "text-superscript":
            document.execCommand("superscript");
            e.preventDefault();
            e.stopPropagation(); // silly hack to account for trigging a selection from
            // inside the menu that isn't from a paper-item

            this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();
            break;

          case "text-remove-format":
            document.execCommand("removeFormat");
            e.preventDefault();
            e.stopPropagation();
            break;

          case "text-strikethrough":
            document.execCommand("strikeThrough");
            e.preventDefault();
            e.stopPropagation(); // silly hack to account for trigging a selection from
            // inside the menu that isn't from a paper-item

            this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();
            break;

          case "text-link":
            var href = "";

            if (babelHelpers.typeof(selection.focusNode.parentNode.href) !== (typeof undefined === "undefined" ? "undefined" : babelHelpers.typeof(undefined))) {
              href = selection.focusNode.parentNode.href;
            } // @todo put in a dialog instead of this


            var url = prompt("Enter a URL:", href);

            if (url) {
              document.execCommand("createLink", false, url);

              if (selection.focusNode.parentNode) {
                selection.focusNode.parentNode.setAttribute("contenteditable", true);
                selection.focusNode.parentNode.setAttribute("data-editable", true); // just to be safe

                selection.focusNode.parentNode.removeEventListener("click", function (e) {
                  e.preventDefault();
                  e.stopPropagation();
                  e.stopImmediatePropagation();
                });
                selection.focusNode.parentNode.addEventListener("click", function (e) {
                  e.preventDefault();
                  e.stopPropagation();
                  e.stopImmediatePropagation();
                });
              }

              e.preventDefault();
              e.stopPropagation();
            }

            break;

          case "text-unlink":
            document.execCommand("unlink");
            e.preventDefault();
            e.stopPropagation();
            break;

          /**
           * Our bad actors when it comes to polyfill'ed shadowDOM.
           * Naughty, naughty shadyDOM. Fortunately this is only IE11/Edge
           */

          case "text-indent":
            document.execCommand("indent");
            e.preventDefault();
            e.stopPropagation();
            break;

          case "text-outdent":
            document.execCommand("outdent");
            e.preventDefault();
            e.stopPropagation();
            break;

          case "text-list-numbered":
            try {
              document.execCommand("insertOrderedList");
              e.preventDefault();
              e.stopPropagation();
            } catch (e) {}

            break;

          case "text-list-bulleted":
            try {
              document.execCommand("insertUnorderedList");
              e.preventDefault();
              e.stopPropagation();
            } catch (e) {}

            break;
        }
      }
      /**
       * Test for safari, if it is don't place things in the menu
       */

    }, {
      key: "_isSafari",
      value: function _isSafari() {
        var ua = navigator.userAgent.toLowerCase(); // test to find safari to account for it's handling
        // of what's been selected. This isn't great UX but
        // there's literally nothing we can do for Safari
        // because of https://github.com/LRNWebComponents/hax-body/issues/38

        if (ua.indexOf("safari") != -1) {
          if (ua.indexOf("chrome") > -1) {} else {
            return true;
          }
        }

        return false;
      }
    }], [{
      key: "template",
      get: function get() {
        return (0, _polymerElement.html)(_templateObject_54095450b3b911e9b58d79562a23326c());
      }
    }, {
      key: "tag",
      get: function get() {
        return "hax-text-context";
      }
    }, {
      key: "properties",
      get: function get() {
        return {
          _showIndent: {
            type: Boolean,
            computed: "_computeShowIndent(selectedValue, polyfillSafe)"
          },

          /**
           * Polyfill safe; this helps remove options from polyfilled platforms
           * as far as text manipulation operations.
           */
          polyfillSafe: {
            type: Boolean
          },

          /**
           * Selected value to match format of the tag currently.
           */
          selectedValue: {
            type: String,
            value: "p",
            notify: true
          },

          /**
           * Selection tracking
           */
          selection: {
            type: Boolean,
            value: false
          },

          /**
           * Is this safari
           */
          isSafari: {
            type: Boolean,
            notify: true,
            computed: "_isSafari()"
          }
        };
      }
    }]);
    return HaxTextContext;
  }(_polymerElement.PolymerElement);

  _exports.HaxTextContext = HaxTextContext;
  window.customElements.define(HaxTextContext.tag, HaxTextContext);
});