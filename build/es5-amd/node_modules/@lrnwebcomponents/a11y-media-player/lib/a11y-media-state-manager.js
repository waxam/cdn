define(["exports","meta","../../../@polymer/polymer/polymer-element.js","../../../@polymer/iron-resizable-behavior/iron-resizable-behavior.js","../../es-global-bridge/es-global-bridge.js","../../../@polymer/polymer/lib/utils/resolve-url.js"],function(_exports,meta,_polymerElement,_ironResizableBehavior,_esGlobalBridge,_resolveUrl){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.A11yMediaStateManager=void 0;meta=babelHelpers.interopRequireWildcard(meta);window.A11yMediaStateManager=window.A11yMediaStateManager||{};window.A11yMediaStateManager.requestAvailability=function(){if(!window.A11yMediaStateManager.instance){window.A11yMediaStateManager.instance=document.createElement("a11y-media-state-manager");document.body.appendChild(window.A11yMediaStateManager.instance)}return window.A11yMediaStateManager.instance};var A11yMediaStateManager=function(_PolymerElement){babelHelpers.inherits(A11yMediaStateManager,_PolymerElement);babelHelpers.createClass(A11yMediaStateManager,null,[{key:"tag",get:function get(){return"a11y-media-state-manager"}},{key:"properties",get:function get(){return{players:{type:Array,value:[]},screenfullLoaded:{type:Boolean,value:!1},stickyPlayer:{type:Object,value:null}}}}]);function A11yMediaStateManager(){var _this;babelHelpers.classCallCheck(this,A11yMediaStateManager);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(A11yMediaStateManager).call(this));var root=babelHelpers.assertThisInitialized(babelHelpers.assertThisInitialized(_this));root.__playerLoader=function(e){root.players.push(e.detail)};if(!window.A11yMediaStateManager.instance){window.A11yMediaStateManager.instance=babelHelpers.assertThisInitialized(babelHelpers.assertThisInitialized(_this));window.addEventListener("a11y-player",root.__playerLoader)}return _this}babelHelpers.createClass(A11yMediaStateManager,[{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(A11yMediaStateManager.prototype),"connectedCallback",this).call(this);var root=this,basePath=(0,_resolveUrl.pathFromUrl)(decodeURIComponent(meta.url)),location="".concat(basePath,"screenfull/dist/screenfull.js");window.addEventListener("es-bridge-".concat("screenfullLib","-loaded"),root._onScreenfullLoaded.bind(root));this.__stickyManager=function(e){root.setStickyPlayer(e.detail)};this.__scrollChecker=function(){root._checkScroll()};window.addEventListener("a11y-player-playing",root.__stickyManager);window.addEventListener("scroll",root.__scrollChecker)}},{key:"checkConcurrentPlayers",value:function checkConcurrentPlayers(){for(var root=this,player=root.stickyPlayer,i=0,playeri;i<root.players.length;i++){playeri=root.players[i];if(playeri!==player&&(!player.allowConcurrent||!playeri.allowConcurrent)){playeri.pause()}}}},{key:"setStickyPlayer",value:function setStickyPlayer(player){var root=this,parent=root._getParentNode(player);root.__playerTop=parent.offsetTop;root.__playerUpperMiddle=root.__playerTop+.9*parent.offsetHeight;root.__playerLowerMiddle=root.__playerTop+.1*parent.offsetHeight;if(player!==root.stickyPlayer&&root.stickyPlayer!==void 0&&null!==root.stickyPlayer){root.stickyPlayer.toggleSticky(!1);root.__parent.style.height="unset"}parent.style.height=parent.offsetHeight+"px";root.__parent=parent;root.stickyPlayer=player;if(!player.allowConcurrent)root.checkConcurrentPlayers();root._checkScroll()}},{key:"_checkScroll",value:function _checkScroll(){var root=this,wintop=window.pageYOffset,winbottom=wintop+window.innerHeight;if(root.stickyPlayer!==void 0&&null!==root.stickyPlayer){if(root.stickyPlayer.__playing&&(root.__playerLowerMiddle>winbottom||root.__playerUpperMiddle<wintop)){root.stickyPlayer.toggleSticky(!0)}else{root.stickyPlayer.toggleSticky(!1)}}}},{key:"_getParentNode",value:function _getParentNode(node){var parent=node.parentNode;if(parent!==void 0&&null!==parent&&parent.nodeType===Node.DOCUMENT_FRAGMENT_NODE){parent=parent.host}return parent}},{key:"_onScreenfullLoaded",value:function _onScreenfullLoaded(){this.screenfullLoaded=!0}},{key:"disconnectedCallback",value:function disconnectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(A11yMediaStateManager.prototype),"disconnectedCallback",this).call(this);var root=this;window.removeEventListener("a11y-player",root.__playerLoader);window.removeEventListener("a11y-player-playing",root.__stickyManager);window.removeEventListener("scroll",root.__scrollChecker)}}]);return A11yMediaStateManager}(_polymerElement.PolymerElement);_exports.A11yMediaStateManager=A11yMediaStateManager;window.customElements.define(A11yMediaStateManager.tag,A11yMediaStateManager)});