define(["exports", "meta", "require", "../../lit-element/lit-element.js", "../es-global-bridge/es-global-bridge.js", "../../@polymer/iron-ajax/iron-ajax.js"], function (_exports, meta, _require, _litElement, _esGlobalBridge, _ironAjax) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.RssItems = void 0;
  meta = babelHelpers.interopRequireWildcard(meta);
  _require = babelHelpers.interopRequireWildcard(_require);

  function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

  function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { babelHelpers.defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

  function _templateObject5_648ce800d34d11ea880ba1e93364c49c() {
    var data = babelHelpers.taggedTemplateLiteral(["\n        :host([hidden]) {\n          display: none;\n        }\n        :host {\n          display: flex;\n          flex-wrap: wrap;\n          flex-direction: row;\n          align-items: flex-start;\n          justify-content: space-between;\n        }\n\n        :host * {\n          box-sizing: border-box;\n        }\n\n        h3,\n        p {\n          margin: 0;\n        }\n\n        a {\n          color: var(--primary-color, inherit);\n          text-decoration: none;\n        }\n\n        article {\n          margin-bottom: 2em;\n        }\n\n        .thumbnail-container {\n          display: block;\n          overflow: hidden;\n          width: 100%;\n          height: 180px;\n        }\n\n        .thumbnail {\n          width: 100%;\n          height: 100%;\n          transition: transform 0.5s ease-out;\n        }\n\n        .thumbnail-container:hover .thumbnail,\n        .thumbnail-container:focus .thumbnail {\n          transform: scale3d(1.3, 1.3, 1);\n        }\n\n        .title {\n          min-height: 3em;\n          margin: 1em 0 0.5em;\n        }\n\n        .excerpt {\n          min-height: 6em;\n          margin: 0.5em 0 2em;\n        }\n\n        @media (max-width: 599px) {\n          .title,\n          .excerpt {\n            min-height: 0;\n          }\n        }\n\n        @media (min-width: 600px) {\n          article {\n            flex: 1 1 40%;\n            margin-right: 2em;\n          }\n\n          article:nth-of-type(2n),\n          article:last-of-type {\n            margin-right: 0;\n          }\n        }\n\n        @media (min-width: 900px) {\n          article {\n            flex: 1 1 30%;\n          }\n\n          article:nth-of-type(2n) {\n            margin-right: 2em;\n          }\n\n          article:nth-of-type(3n) {\n            margin-right: 0;\n          }\n        }\n      "]);

    _templateObject5_648ce800d34d11ea880ba1e93364c49c = function _templateObject5_648ce800d34d11ea880ba1e93364c49c() {
      return data;
    };

    return data;
  }

  function _templateObject4_648ce800d34d11ea880ba1e93364c49c() {
    var data = babelHelpers.taggedTemplateLiteral(["\n                  <a\n                    tabindex=\"-1\"\n                    href=\"", "\"\n                    class=\"read-more\"\n                    title=\"", "\"\n                    >", "\n                    <paper-icon-button\n                      icon=\"icons:arrow-forward\"\n                      class=\"read-more-icon\"\n                      alt=\"", "\"\n                    ></paper-icon-button>\n                  </a>\n                "]);

    _templateObject4_648ce800d34d11ea880ba1e93364c49c = function _templateObject4_648ce800d34d11ea880ba1e93364c49c() {
      return data;
    };

    return data;
  }

  function _templateObject3_648ce800d34d11ea880ba1e93364c49c() {
    var data = babelHelpers.taggedTemplateLiteral(["\n                  <a\n                    class=\"thumbnail-container\"\n                    href=\"", "\"\n                    title=\"", "\"\n                  >\n                    <iron-image\n                      class=\"thumbnail\"\n                      src=\"", "\"\n                      alt=\"", "\"\n                      sizing=\"cover\"\n                    ></iron-image>\n                  </a>\n                "]);

    _templateObject3_648ce800d34d11ea880ba1e93364c49c = function _templateObject3_648ce800d34d11ea880ba1e93364c49c() {
      return data;
    };

    return data;
  }

  function _templateObject2_648ce800d34d11ea880ba1e93364c49c() {
    var data = babelHelpers.taggedTemplateLiteral(["\n          <article>\n            ", "\n            <a href=\"", "\" title=\"", "\">\n              <span class=\"title\"\n                >", "</span\n              >\n            </a>\n            <div class=\"excerpt\">\n              ", "\n            </div>\n            ", "\n          </article>\n        "]);

    _templateObject2_648ce800d34d11ea880ba1e93364c49c = function _templateObject2_648ce800d34d11ea880ba1e93364c49c() {
      return data;
    };

    return data;
  }

  function _templateObject_648ce800d34d11ea880ba1e93364c49c() {
    var data = babelHelpers.taggedTemplateLiteral(["\n      <iron-ajax\n        id=\"rssajax\"\n        url=\"", "\"\n        handle-as=\"xml\"\n        @last-response-changed=\"", "\"\n      ></iron-ajax>\n      ", "\n    "]);

    _templateObject_648ce800d34d11ea880ba1e93364c49c = function _templateObject_648ce800d34d11ea880ba1e93364c49c() {
      return data;
    };

    return data;
  }

  /**
   * `rss-items`
   * `visualize RSS items`
   * 
   * Example:
    ```html
    <rss-items
      url="https://content.therapychat.com/rss.xml"
      max="4"
      auto
    ></rss-items>
    ```
   * It will retrieve the items from the url automatically.
   * @demo demo/index.html
   * @element rss-items
   */
  var RssItems =
  /*#__PURE__*/
  function (_LitElement) {
    babelHelpers.inherits(RssItems, _LitElement);
    babelHelpers.createClass(RssItems, [{
      key: "render",
      // render function
      value: function render() {
        var _this2 = this;

        return (0, _litElement.html)(_templateObject_648ce800d34d11ea880ba1e93364c49c(), this.url, this.xmlEvent, this.items.map(function (item) {
          return (0, _litElement.html)(_templateObject2_648ce800d34d11ea880ba1e93364c49c(), item.imageSrc ? (0, _litElement.html)(_templateObject3_648ce800d34d11ea880ba1e93364c49c(), item.link, item.title, item.imageSrc, item.title) : "", item.link, item.title, _this2._truncateText(item.title, _this2.maxTitleLength), _this2._truncateText(item.excerpt, _this2.maxExcerptLength), _this2.showReadMore ? (0, _litElement.html)(_templateObject4_648ce800d34d11ea880ba1e93364c49c(), item.link, item.title, _this2.readMoreAnchorText, _this2.readMoreImageAlt) : "");
        }));
      } // haxProperty definition

    }, {
      key: "initRequest",

      /**
       * Init ajax request to get rss.
       */
      value: function initRequest() {
        this.shadowRoot.querySelector("#rssajax").generateRequest();
      }
    }, {
      key: "_maxChanged",
      value: function _maxChanged(newValue) {
        if (this.xml && newValue && this._x2js && this.__ready) {
          this.xmlToItems(this.xml);
        }
      }
      /**
       * Receives a xml and set this.items as json.
       * @param {Object} xml XML element.
       */

    }, {
      key: "xmlToItems",
      value: function xmlToItems(newValue) {
        if (newValue && this._x2js && this.__ready) {
          // parse xml to json and get items
          var conversor = new X2JS();
          var json = conversor.xml2json(newValue);

          if (json) {
            var items = json.rss ? json.rss.channel.item : json.channel.item; // truncate with this.max and parse items

            items = this.max === undefined ? items : items.splice(0, this.max);
            this.items = babelHelpers.toConsumableArray(this._parseItems(items));
          }
        }
      }
    }, {
      key: "_urlChanged",
      value: function _urlChanged(newValue) {
        if (newValue && this._x2js && this.__ready) {
          this.initRequest();
        }
      }
    }, {
      key: "xmlEvent",
      value: function xmlEvent(e) {
        var _this3 = this;

        this.xml = {};
        setTimeout(function () {
          _this3.xml = e.detail.value;
        }, 0);
      }
      /**
       * Parse items by getting excerpt and image source.
       * @param {Array} items RSS items.
       */

    }, {
      key: "_parseItems",
      value: function _parseItems(items) {
        var _this4 = this;

        return items.map(function (item) {
          item.excerpt = _this4._getItemExcerpt(item);
          item.imageSrc = _this4._getItemImageScr(item);
          return item;
        });
      }
      /**
       * Get excerpt from item description.
       * @param {Object} item Item where find excerpt.
       */

    }, {
      key: "_getItemExcerpt",
      value: function _getItemExcerpt(item) {
        var element = document.createElement("div");
        element.innerHTML = item.description;
        return element.textContent.trim();
      }
      /**
       * Get image source from item description.
       * @param {Object} item Item where find image.
       */

    }, {
      key: "_getItemImageScr",
      value: function _getItemImageScr(item) {
        if (item.thumbnail && item.thumbnail._url) {
          return item.thumbnail._url;
        } else {
          var element = document.createElement("div");
          element.innerHTML = item.description;
          var image = element.querySelector("img") || {};
          return image.src || "";
        }
      }
      /**
       * Truncate a text and concatenate with ellipsis if needed.
       * @param {String} text Text to truncate.
       * @param {Number} maxLength Max length of the text.
       * @return {String} Truncated text.
       */

    }, {
      key: "_truncateText",
      value: function _truncateText(text, maxLength) {
        if (text) {
          return maxLength && text.length > maxLength ? text.substr(0, maxLength) + "..." : text;
        }
      } // simple path from a url modifier

    }, {
      key: "pathFromUrl",
      value: function pathFromUrl(url) {
        return url.substring(0, url.lastIndexOf("/") + 1);
      }
    }, {
      key: "updated",
      value: function updated(changedProperties) {
        var _this5 = this;

        changedProperties.forEach(function (oldValue, propName) {
          var notifiedProps = ["items"];

          if (notifiedProps.includes(propName)) {
            // notify
            var eventName = "".concat(propName.replace(/([a-z0-9]|(?=[A-Z]))([A-Z])/g, "$1-$2").toLowerCase(), "-changed");

            _this5.dispatchEvent(new CustomEvent(eventName, {
              detail: {
                value: _this5[propName]
              }
            }));
          }

          if (propName == "max") {
            _this5._maxChanged(_this5[propName], oldValue);
          }

          if (propName == "url") {
            _this5._urlChanged(_this5[propName], oldValue);
          }

          if (propName == "xml") {
            _this5.xmlToItems(_this5[propName], oldValue);
          }
        });
      }
    }], [{
      key: "styles",
      //styles function
      get: function get() {
        return [(0, _litElement.css)(_templateObject5_648ce800d34d11ea880ba1e93364c49c())];
      }
    }, {
      key: "haxProperties",
      get: function get() {
        return {
          canScale: true,
          canPosition: true,
          canEditSource: false,
          gizmo: {
            title: "Rss feed",
            description: "visualize RSS items",
            icon: "communication:rss-feed",
            color: "orange",
            groups: ["RSS"],
            handles: [{
              type: "rss",
              source: "source"
            }],
            meta: {
              author: "btopro",
              owner: "The Pennsylvania State University"
            }
          },
          settings: {
            quick: [],
            configure: [{
              property: "url",
              title: "Feed URL",
              description: "URL to the XML feed",
              inputMethod: "textfield"
            }, {
              property: "max",
              title: "Max items",
              description: "Max number of feed items to display",
              inputMethod: "number"
            }],
            advanced: []
          }
        };
      } // properties available to the custom element for data binding

    }, {
      key: "properties",
      get: function get() {
        return _objectSpread({}, babelHelpers.get(babelHelpers.getPrototypeOf(RssItems), "properties", this), {
          /**
           * If true init rss request.
           */
          auto: {
            type: Boolean
          },

          /**
           * The retrieved items array.
           */
          items: {
            type: Array
          },

          /**
           * Max number of items to show. If it is undefined shows all items.
           */
          max: {
            type: Number
          },

          /**
           * Max length for item excerpts. If the excerpt exceeds this length it will be trimed and will have an ellipsis appended.
           */
          maxExcerptLength: {
            type: Number,
            attribute: "max-excerpt-length"
          },

          /**
           * Max length for item titles. If the title exceeds this length it will be trimed and will have an ellipsis appended.
           */
          maxTitleLength: {
            type: Number,
            attribute: "max-title-length"
          },

          /**
           * Read more anchor text.
           */
          readMoreAnchorText: {
            type: Boolean,
            attribute: "read-more-anchor-text"
          },

          /**
           * Read more image alternative text.
           */
          readMoreImageAlt: {
            type: Boolean,
            attribute: "read-more-image-alt"
          },

          /**
           * If true the items elements will display a read more link.
           */
          showReadMore: {
            type: Boolean,
            attribute: "show-read-more"
          },

          /**
           * The URL of the RSS.
           */
          url: {
            type: String
          },
          xml: {
            type: Object
          }
        });
      }
      /**
       * Store the tag name to make it easier to obtain directly.
       * @notice function name must be here for tooling to operate correctly
       */

    }, {
      key: "tag",
      get: function get() {
        return "rss-items";
      }
    }]);

    function RssItems() {
      var _this;

      babelHelpers.classCallCheck(this, RssItems);
      _this = babelHelpers.possibleConstructorReturn(this, babelHelpers.getPrototypeOf(RssItems).call(this));
      _this.items = [];
      _this.auto = false;
      _this.max = 10;
      _this.maxExcerptLength = 100;
      _this.maxTitleLength = 50;
      _this.readMoreAnchorText = "Read more";
      _this.readMoreImageAlt = "";
      _this.showReadMore = false;
      new Promise(function (res, rej) {
        return _require.default(["../../@polymer/iron-image/iron-image.js"], res, rej);
      });
      new Promise(function (res, rej) {
        return _require.default(["../../@polymer/paper-icon-button/paper-icon-button.js"], res, rej);
      });
      new Promise(function (res, rej) {
        return _require.default(["../../@polymer/iron-icons/iron-icons.js"], res, rej);
      });
      var name = "x2js";

      var basePath = _this.pathFromUrl(decodeURIComponent(meta.url));

      var location = "".concat(basePath, "lib/x2js.js");
      window.ESGlobalBridge.requestAvailability();
      window.ESGlobalBridge.instance.load(name, location);
      window.addEventListener("es-bridge-".concat(name, "-loaded"), _this._x2jsLoaded.bind(babelHelpers.assertThisInitialized(_this)));
      return _this;
    }

    babelHelpers.createClass(RssItems, [{
      key: "_x2jsLoaded",
      value: function _x2jsLoaded(e) {
        this._x2js = true;

        if (this.__ready) {
          if (this.auto) {
            this.shadowRoot.querySelector("#rssajax").auto = this.auto;
          } else {
            this.initRequest();
          }
        }
      }
      /**
       * life cycle, element is afixed to the DOM
       */

    }, {
      key: "firstUpdated",
      value: function firstUpdated() {
        this.__ready = true;

        if (this._x2js) {
          if (this.auto) {
            this.shadowRoot.querySelector("#rssajax").auto = this.auto;
          } else {
            this.initRequest();
          }
        }
      }
      /**
       * life cycle, element is removed from the DOM
       */

    }, {
      key: "disconnectedCallback",
      value: function disconnectedCallback() {
        window.removeEventListener("es-bridge-".concat(name, "-loaded"), this._x2jsLoaded.bind(this));
        babelHelpers.get(babelHelpers.getPrototypeOf(RssItems.prototype), "disconnectedCallback", this).call(this);
      }
    }]);
    return RssItems;
  }(_litElement.LitElement);

  _exports.RssItems = RssItems;
  window.customElements.define(RssItems.tag, RssItems);
});