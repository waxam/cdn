if("object"===("undefined"===typeof module?"undefined":babelHelpers.typeof(module))){ICAL=module.exports}else if("object"!==("undefined"===typeof ICAL?"undefined":babelHelpers.typeof(ICAL))){this.ICAL={}}ICAL.foldLength=75;ICAL.newLineChar="\r\n";ICAL.helpers={isStrictlyNaN:function isStrictlyNaN(number){return"number"===typeof number&&isNaN(number)},strictParseInt:function strictParseInt(string){var result=parseInt(string,10);if(ICAL.helpers.isStrictlyNaN(result)){throw new Error("Could not extract integer from \""+string+"\"")}return result},formatClassType:function(data,type){if("undefined"===typeof data){return}if(babelHelpers.instanceof(data,type)){return data}return new type(data)},unescapedIndexOf:function unescapedIndexOf(buffer,search,pos){while(-1!==(pos=buffer.indexOf(search,pos))){if(0<pos&&"\\"===buffer[pos-1]){pos+=1}else{return pos}}return-1},binsearchInsert:function binsearchInsert(list,seekVal,cmpfunc){if(!list.length)return 0;var low=0,high=list.length-1,mid,cmpval;while(low<=high){mid=low+Math.floor((high-low)/2);cmpval=cmpfunc(seekVal,list[mid]);if(0>cmpval)high=mid-1;else if(0<cmpval)low=mid+1;else break}if(0>cmpval)return mid;else if(0<cmpval)return mid+1;else return mid},dumpn:function dumpn(){if(!ICAL.debug){return}if("undefined"!==typeof console&&"log"in console){ICAL.helpers.dumpn=function(input){console.log(input)}}else{ICAL.helpers.dumpn=function(input){dump(input+"\n")}}ICAL.helpers.dumpn(arguments[0])},clone:function clone(aSrc,aDeep){if(!aSrc||"object"!=babelHelpers.typeof(aSrc)){return aSrc}else if(babelHelpers.instanceof(aSrc,Date)){return new Date(aSrc.getTime())}else if("clone"in aSrc){return aSrc.clone()}else if(Array.isArray(aSrc)){for(var arr=[],i=0;i<aSrc.length;i++){arr.push(aDeep?ICAL.helpers.clone(aSrc[i],!0):aSrc[i])}return arr}else{var obj={};for(var name in aSrc){if(Object.prototype.hasOwnProperty.call(aSrc,name)){if(aDeep){obj[name]=ICAL.helpers.clone(aSrc[name],!0)}else{obj[name]=aSrc[name]}}}return obj}},foldline:function(aLine){var result="",line=aLine||"";while(line.length){result+=ICAL.newLineChar+" "+line.substr(0,ICAL.foldLength);line=line.substr(ICAL.foldLength)}return result.substr(ICAL.newLineChar.length+1)},pad2:function(data){if("string"!==typeof data){if("number"===typeof data){data=parseInt(data)}data=data+""}var len=data.length;switch(len){case 0:return"00";case 1:return"0"+data;default:return data;}},trunc:function(number){return 0>number?Math.ceil(number):Math.floor(number)},inherits:function inherits(base,child,extra){function F(){}F.prototype=base.prototype;child.prototype=new F;if(extra){ICAL.helpers.extend(extra,child.prototype)}},extend:function extend(source,target){for(var key in source){var descr=Object.getOwnPropertyDescriptor(source,key);if(descr&&!Object.getOwnPropertyDescriptor(target,key)){Object.defineProperty(target,key,descr)}}return target}};ICAL.design=function(){"use strict";var FROM_ICAL_NEWLINE=/\\\\|\\;|\\,|\\[Nn]/g,TO_ICAL_NEWLINE=/\\|;|,|\n/g,FROM_VCARD_NEWLINE=/\\\\|\\,|\\[Nn]/g,TO_VCARD_NEWLINE=/\\|,|\n/g;function createTextType(fromNewline,toNewline){var result={matches:/.*/,fromICAL:function fromICAL(aValue,structuredEscape){return replaceNewline(aValue,fromNewline,structuredEscape)},toICAL:function toICAL(aValue,structuredEscape){var regEx=toNewline;if(structuredEscape)regEx=new RegExp(regEx.source+"|"+structuredEscape);return aValue.replace(regEx,function(str){switch(str){case"\\":return"\\\\";case";":return"\\;";case",":return"\\,";case"\n":return"\\n";default:return str;}})}};return result}var DEFAULT_TYPE_TEXT={defaultType:"text"},DEFAULT_TYPE_TEXT_MULTI={defaultType:"text",multiValue:","},DEFAULT_TYPE_TEXT_STRUCTURED={defaultType:"text",structuredValue:";"},DEFAULT_TYPE_INTEGER={defaultType:"integer"},DEFAULT_TYPE_DATETIME_DATE={defaultType:"date-time",allowedTypes:["date-time","date"]},DEFAULT_TYPE_DATETIME={defaultType:"date-time"},DEFAULT_TYPE_URI={defaultType:"uri"},DEFAULT_TYPE_UTCOFFSET={defaultType:"utc-offset"},DEFAULT_TYPE_RECUR={defaultType:"recur"},DEFAULT_TYPE_DATE_ANDOR_TIME={defaultType:"date-and-or-time",allowedTypes:["date-time","date","text"]};function replaceNewlineReplace(string){switch(string){case"\\\\":return"\\";case"\\;":return";";case"\\,":return",";case"\\n":case"\\N":return"\n";default:return string;}}function replaceNewline(value,newline,structuredEscape){if(-1===value.indexOf("\\")){return value}if(structuredEscape)newline=new RegExp(newline.source+"|\\\\"+structuredEscape);return value.replace(newline,replaceNewlineReplace)}var commonProperties={categories:DEFAULT_TYPE_TEXT_MULTI,url:DEFAULT_TYPE_URI,version:DEFAULT_TYPE_TEXT,uid:DEFAULT_TYPE_TEXT},commonValues={boolean:{values:["TRUE","FALSE"],fromICAL:function fromICAL(aValue){switch(aValue){case"TRUE":return!0;case"FALSE":return!1;default:return!1;}},toICAL:function toICAL(aValue){if(aValue){return"TRUE"}return"FALSE"}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function fromICAL(aValue){var parsed=parseFloat(aValue);if(ICAL.helpers.isStrictlyNaN(parsed)){return 0}return parsed},toICAL:function toICAL(aValue){return aValue+""}},integer:{fromICAL:function fromICAL(aValue){var parsed=parseInt(aValue);if(ICAL.helpers.isStrictlyNaN(parsed)){return 0}return parsed},toICAL:function toICAL(aValue){return aValue+""}},"utc-offset":{toICAL:function toICAL(aValue){if(7>aValue.length){return aValue.substr(0,3)+aValue.substr(4,2)}else{return aValue.substr(0,3)+aValue.substr(4,2)+aValue.substr(7,2)}},fromICAL:function fromICAL(aValue){if(6>aValue.length){return aValue.substr(0,3)+":"+aValue.substr(3,2)}else{return aValue.substr(0,3)+":"+aValue.substr(3,2)+":"+aValue.substr(5,2)}},decorate:function decorate(aValue){return ICAL.UtcOffset.fromString(aValue)},undecorate:function undecorate(aValue){return aValue.toString()}}},icalParams={cutype:{values:["INDIVIDUAL","GROUP","RESOURCE","ROOM","UNKNOWN"],allowXName:!0,allowIanaToken:!0},"delegated-from":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},"delegated-to":{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},encoding:{values:["8BIT","BASE64"]},fbtype:{values:["FREE","BUSY","BUSY-UNAVAILABLE","BUSY-TENTATIVE"],allowXName:!0,allowIanaToken:!0},member:{valueType:"cal-address",multiValue:",",multiValueSeparateDQuote:!0},partstat:{values:["NEEDS-ACTION","ACCEPTED","DECLINED","TENTATIVE","DELEGATED","COMPLETED","IN-PROCESS"],allowXName:!0,allowIanaToken:!0},range:{values:["THISLANDFUTURE"]},related:{values:["START","END"]},reltype:{values:["PARENT","CHILD","SIBLING"],allowXName:!0,allowIanaToken:!0},role:{values:["REQ-PARTICIPANT","CHAIR","OPT-PARTICIPANT","NON-PARTICIPANT"],allowXName:!0,allowIanaToken:!0},rsvp:{values:["TRUE","FALSE"]},"sent-by":{valueType:"cal-address"},tzid:{matches:/^\//},value:{values:["binary","boolean","cal-address","date","date-time","duration","float","integer","period","recur","text","time","uri","utc-offset"],allowXName:!0,allowIanaToken:!0}},icalValues=ICAL.helpers.extend(commonValues,{text:createTextType(FROM_ICAL_NEWLINE,TO_ICAL_NEWLINE),uri:{},binary:{decorate:function decorate(aString){return ICAL.Binary.fromString(aString)},undecorate:function undecorate(aBinary){return aBinary.toString()}},"cal-address":{},date:{decorate:function decorate(aValue,aProp){return ICAL.Time.fromDateString(aValue,aProp)},undecorate:function undecorate(aValue){return aValue.toString()},fromICAL:function fromICAL(aValue){return aValue.substr(0,4)+"-"+aValue.substr(4,2)+"-"+aValue.substr(6,2)},toICAL:function toICAL(aValue){if(11<aValue.length){return aValue}return aValue.substr(0,4)+aValue.substr(5,2)+aValue.substr(8,2)}},"date-time":{fromICAL:function fromICAL(aValue){var result=aValue.substr(0,4)+"-"+aValue.substr(4,2)+"-"+aValue.substr(6,2)+"T"+aValue.substr(9,2)+":"+aValue.substr(11,2)+":"+aValue.substr(13,2);if(aValue[15]&&"Z"===aValue[15]){result+="Z"}return result},toICAL:function toICAL(aValue){if(19>aValue.length){return aValue}var result=aValue.substr(0,4)+aValue.substr(5,2)+aValue.substr(8,5)+aValue.substr(14,2)+aValue.substr(17,2);if(aValue[19]&&"Z"===aValue[19]){result+="Z"}return result},decorate:function decorate(aValue,aProp){return ICAL.Time.fromDateTimeString(aValue,aProp)},undecorate:function undecorate(aValue){return aValue.toString()}},duration:{decorate:function decorate(aValue){return ICAL.Duration.fromString(aValue)},undecorate:function undecorate(aValue){return aValue.toString()}},period:{fromICAL:function fromICAL(string){var parts=string.split("/");parts[0]=icalValues["date-time"].fromICAL(parts[0]);if(!ICAL.Duration.isValueString(parts[1])){parts[1]=icalValues["date-time"].fromICAL(parts[1])}return parts},toICAL:function toICAL(parts){parts[0]=icalValues["date-time"].toICAL(parts[0]);if(!ICAL.Duration.isValueString(parts[1])){parts[1]=icalValues["date-time"].toICAL(parts[1])}return parts.join("/")},decorate:function decorate(aValue,aProp){return ICAL.Period.fromJSON(aValue,aProp)},undecorate:function undecorate(aValue){return aValue.toJSON()}},recur:{fromICAL:function fromICAL(string){return ICAL.Recur._stringToData(string,!0)},toICAL:function toICAL(data){var str="";for(var k in data){if(!Object.prototype.hasOwnProperty.call(data,k)){continue}var val=data[k];if("until"==k){if(10<val.length){val=icalValues["date-time"].toICAL(val)}else{val=icalValues.date.toICAL(val)}}else if("wkst"==k){if("number"===typeof val){val=ICAL.Recur.numericDayToIcalDay(val)}}else if(Array.isArray(val)){val=val.join(",")}str+=k.toUpperCase()+"="+val+";"}return str.substr(0,str.length-1)},decorate:function(aValue){return ICAL.Recur.fromData(aValue)},undecorate:function undecorate(aRecur){return aRecur.toJSON()}},time:{fromICAL:function fromICAL(aValue){if(6>aValue.length){return aValue}var result=aValue.substr(0,2)+":"+aValue.substr(2,2)+":"+aValue.substr(4,2);if("Z"===aValue[6]){result+="Z"}return result},toICAL:function toICAL(aValue){if(8>aValue.length){return aValue}var result=aValue.substr(0,2)+aValue.substr(3,2)+aValue.substr(6,2);if("Z"===aValue[8]){result+="Z"}return result}}}),icalProperties=ICAL.helpers.extend(commonProperties,{action:DEFAULT_TYPE_TEXT,attach:{defaultType:"uri"},attendee:{defaultType:"cal-address"},calscale:DEFAULT_TYPE_TEXT,class:DEFAULT_TYPE_TEXT,comment:DEFAULT_TYPE_TEXT,completed:DEFAULT_TYPE_DATETIME,contact:DEFAULT_TYPE_TEXT,created:DEFAULT_TYPE_DATETIME,description:DEFAULT_TYPE_TEXT,dtend:DEFAULT_TYPE_DATETIME_DATE,dtstamp:DEFAULT_TYPE_DATETIME,dtstart:DEFAULT_TYPE_DATETIME_DATE,due:DEFAULT_TYPE_DATETIME_DATE,duration:{defaultType:"duration"},exdate:{defaultType:"date-time",allowedTypes:["date-time","date"],multiValue:","},exrule:DEFAULT_TYPE_RECUR,freebusy:{defaultType:"period",multiValue:","},geo:{defaultType:"float",structuredValue:";"},"last-modified":DEFAULT_TYPE_DATETIME,location:DEFAULT_TYPE_TEXT,method:DEFAULT_TYPE_TEXT,organizer:{defaultType:"cal-address"},"percent-complete":DEFAULT_TYPE_INTEGER,priority:DEFAULT_TYPE_INTEGER,prodid:DEFAULT_TYPE_TEXT,"related-to":DEFAULT_TYPE_TEXT,repeat:DEFAULT_TYPE_INTEGER,rdate:{defaultType:"date-time",allowedTypes:["date-time","date","period"],multiValue:",",detectType:function detectType(string){if(-1!==string.indexOf("/")){return"period"}return-1===string.indexOf("T")?"date":"date-time"}},"recurrence-id":DEFAULT_TYPE_DATETIME_DATE,resources:DEFAULT_TYPE_TEXT_MULTI,"request-status":DEFAULT_TYPE_TEXT_STRUCTURED,rrule:DEFAULT_TYPE_RECUR,sequence:DEFAULT_TYPE_INTEGER,status:DEFAULT_TYPE_TEXT,summary:DEFAULT_TYPE_TEXT,transp:DEFAULT_TYPE_TEXT,trigger:{defaultType:"duration",allowedTypes:["duration","date-time"]},tzoffsetfrom:DEFAULT_TYPE_UTCOFFSET,tzoffsetto:DEFAULT_TYPE_UTCOFFSET,tzurl:DEFAULT_TYPE_URI,tzid:DEFAULT_TYPE_TEXT,tzname:DEFAULT_TYPE_TEXT}),vcardValues=ICAL.helpers.extend(commonValues,{text:createTextType(FROM_VCARD_NEWLINE,TO_VCARD_NEWLINE),uri:createTextType(FROM_VCARD_NEWLINE,TO_VCARD_NEWLINE),date:{decorate:function decorate(aValue){return ICAL.VCardTime.fromDateAndOrTimeString(aValue,"date")},undecorate:function undecorate(aValue){return aValue.toString()},fromICAL:function fromICAL(aValue){if(8==aValue.length){return icalValues.date.fromICAL(aValue)}else if("-"==aValue[0]&&6==aValue.length){return aValue.substr(0,4)+"-"+aValue.substr(4)}else{return aValue}},toICAL:function toICAL(aValue){if(10==aValue.length){return icalValues.date.toICAL(aValue)}else if("-"==aValue[0]&&7==aValue.length){return aValue.substr(0,4)+aValue.substr(5)}else{return aValue}}},time:{decorate:function decorate(aValue){return ICAL.VCardTime.fromDateAndOrTimeString("T"+aValue,"time")},undecorate:function undecorate(aValue){return aValue.toString()},fromICAL:function fromICAL(aValue){var splitzone=vcardValues.time._splitZone(aValue,!0),zone=splitzone[0],value=splitzone[1];if(6==value.length){value=value.substr(0,2)+":"+value.substr(2,2)+":"+value.substr(4,2)}else if(4==value.length&&"-"!=value[0]){value=value.substr(0,2)+":"+value.substr(2,2)}else if(5==value.length){value=value.substr(0,3)+":"+value.substr(3,2)}if(5==zone.length&&("-"==zone[0]||"+"==zone[0])){zone=zone.substr(0,3)+":"+zone.substr(3)}return value+zone},toICAL:function toICAL(aValue){var splitzone=vcardValues.time._splitZone(aValue),zone=splitzone[0],value=splitzone[1];if(8==value.length){value=value.substr(0,2)+value.substr(3,2)+value.substr(6,2)}else if(5==value.length&&"-"!=value[0]){value=value.substr(0,2)+value.substr(3,2)}else if(6==value.length){value=value.substr(0,3)+value.substr(4,2)}if(6==zone.length&&("-"==zone[0]||"+"==zone[0])){zone=zone.substr(0,3)+zone.substr(4)}return value+zone},_splitZone:function _splitZone(aValue,isFromIcal){var lastChar=aValue.length-1,signChar=aValue.length-(isFromIcal?5:6),sign=aValue[signChar],zone,value;if("Z"==aValue[lastChar]){zone=aValue[lastChar];value=aValue.substr(0,lastChar)}else if(6<aValue.length&&("-"==sign||"+"==sign)){zone=aValue.substr(signChar);value=aValue.substr(0,signChar)}else{zone="";value=aValue}return[zone,value]}},"date-time":{decorate:function decorate(aValue){return ICAL.VCardTime.fromDateAndOrTimeString(aValue,"date-time")},undecorate:function undecorate(aValue){return aValue.toString()},fromICAL:function fromICAL(aValue){return vcardValues["date-and-or-time"].fromICAL(aValue)},toICAL:function toICAL(aValue){return vcardValues["date-and-or-time"].toICAL(aValue)}},"date-and-or-time":{decorate:function decorate(aValue){return ICAL.VCardTime.fromDateAndOrTimeString(aValue,"date-and-or-time")},undecorate:function undecorate(aValue){return aValue.toString()},fromICAL:function fromICAL(aValue){var parts=aValue.split("T");return(parts[0]?vcardValues.date.fromICAL(parts[0]):"")+(parts[1]?"T"+vcardValues.time.fromICAL(parts[1]):"")},toICAL:function toICAL(aValue){var parts=aValue.split("T");return vcardValues.date.toICAL(parts[0])+(parts[1]?"T"+vcardValues.time.toICAL(parts[1]):"")}},timestamp:icalValues["date-time"],"language-tag":{matches:/^[a-zA-Z0-9\-]+$/}}),vcardProperties=ICAL.helpers.extend(commonProperties,{adr:{defaultType:"text",structuredValue:";",multiValue:","},anniversary:DEFAULT_TYPE_DATE_ANDOR_TIME,bday:DEFAULT_TYPE_DATE_ANDOR_TIME,caladruri:DEFAULT_TYPE_URI,caluri:DEFAULT_TYPE_URI,clientpidmap:DEFAULT_TYPE_TEXT_STRUCTURED,email:DEFAULT_TYPE_TEXT,fburl:DEFAULT_TYPE_URI,fn:DEFAULT_TYPE_TEXT,gender:DEFAULT_TYPE_TEXT_STRUCTURED,geo:DEFAULT_TYPE_URI,impp:DEFAULT_TYPE_URI,key:DEFAULT_TYPE_URI,kind:DEFAULT_TYPE_TEXT,lang:{defaultType:"language-tag"},logo:DEFAULT_TYPE_URI,member:DEFAULT_TYPE_URI,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:DEFAULT_TYPE_TEXT_MULTI,note:DEFAULT_TYPE_TEXT,org:{defaultType:"text",structuredValue:";"},photo:DEFAULT_TYPE_URI,related:DEFAULT_TYPE_URI,rev:{defaultType:"timestamp"},role:DEFAULT_TYPE_TEXT,sound:DEFAULT_TYPE_URI,source:DEFAULT_TYPE_URI,tel:{defaultType:"uri",allowedTypes:["uri","text"]},title:DEFAULT_TYPE_TEXT,tz:{defaultType:"text",allowedTypes:["text","utc-offset","uri"]},xml:DEFAULT_TYPE_TEXT}),vcard3Values=ICAL.helpers.extend(commonValues,{binary:icalValues.binary,date:vcardValues.date,"date-time":vcardValues["date-time"],"phone-number":{},uri:icalValues.uri,text:icalValues.text,time:icalValues.time,vcard:icalValues.text,"utc-offset":{toICAL:function toICAL(aValue){return aValue.substr(0,7)},fromICAL:function fromICAL(aValue){return aValue.substr(0,7)},decorate:function decorate(aValue){return ICAL.UtcOffset.fromString(aValue)},undecorate:function undecorate(aValue){return aValue.toString()}}}),vcard3Properties=ICAL.helpers.extend(commonProperties,{fn:DEFAULT_TYPE_TEXT,n:{defaultType:"text",structuredValue:";",multiValue:","},nickname:DEFAULT_TYPE_TEXT_MULTI,photo:{defaultType:"binary",allowedTypes:["binary","uri"]},bday:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function detectType(string){return-1===string.indexOf("T")?"date":"date-time"}},adr:{defaultType:"text",structuredValue:";",multiValue:","},label:DEFAULT_TYPE_TEXT,tel:{defaultType:"phone-number"},email:DEFAULT_TYPE_TEXT,mailer:DEFAULT_TYPE_TEXT,tz:{defaultType:"utc-offset",allowedTypes:["utc-offset","text"]},geo:{defaultType:"float",structuredValue:";"},title:DEFAULT_TYPE_TEXT,role:DEFAULT_TYPE_TEXT,logo:{defaultType:"binary",allowedTypes:["binary","uri"]},agent:{defaultType:"vcard",allowedTypes:["vcard","text","uri"]},org:DEFAULT_TYPE_TEXT_STRUCTURED,note:DEFAULT_TYPE_TEXT_MULTI,prodid:DEFAULT_TYPE_TEXT,rev:{defaultType:"date-time",allowedTypes:["date-time","date"],detectType:function detectType(string){return-1===string.indexOf("T")?"date":"date-time"}},"sort-string":DEFAULT_TYPE_TEXT,sound:{defaultType:"binary",allowedTypes:["binary","uri"]},class:DEFAULT_TYPE_TEXT,key:{defaultType:"binary",allowedTypes:["binary","text"]}}),icalSet={value:icalValues,param:icalParams,property:icalProperties},vcardSet={value:vcardValues,param:{type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","time","date-time","date-and-or-time","timestamp","boolean","integer","float","utc-offset","language-tag"],allowXName:!0,allowIanaToken:!0}},property:vcardProperties},vcard3Set={value:vcard3Values,param:{type:{valueType:"text",multiValue:","},value:{values:["text","uri","date","date-time","phone-number","time","boolean","integer","float","utc-offset","vcard","binary"],allowXName:!0,allowIanaToken:!0}},property:vcard3Properties},design={defaultSet:icalSet,defaultType:"unknown",components:{vcard:vcardSet,vcard3:vcard3Set,vevent:icalSet,vtodo:icalSet,vjournal:icalSet,valarm:icalSet,vtimezone:icalSet,daylight:icalSet,standard:icalSet},icalendar:icalSet,vcard:vcardSet,vcard3:vcard3Set,getDesignSet:function getDesignSet(componentName){var isInDesign=componentName&&componentName in design.components;return isInDesign?design.components[componentName]:design.defaultSet}};return design}();ICAL.stringify=function(){"use strict";var LINE_ENDING="\r\n",DEFAULT_VALUE_TYPE="unknown",design=ICAL.design,helpers=ICAL.helpers;function stringify(jCal){if("string"==typeof jCal[0]){jCal=[jCal]}var i=0,len=jCal.length,result="";for(;i<len;i++){result+=stringify.component(jCal[i])+LINE_ENDING}return result}stringify.component=function(component,designSet){var name=component[0].toUpperCase(),result="BEGIN:"+name+LINE_ENDING,props=component[1],propIdx=0,propLen=props.length,designSetName=component[0];if("vcard"===designSetName&&0<component[1].length&&!("version"===component[1][0][0]&&"4.0"===component[1][0][3])){designSetName="vcard3"}designSet=designSet||design.getDesignSet(designSetName);for(;propIdx<propLen;propIdx++){result+=stringify.property(props[propIdx],designSet)+LINE_ENDING}var comps=component[2],compIdx=0,compLen=comps.length;for(;compIdx<compLen;compIdx++){result+=stringify.component(comps[compIdx],designSet)+LINE_ENDING}result+="END:"+name;return result};stringify.property=function(property,designSet,noFold){var name=property[0].toUpperCase(),jsName=property[0],params=property[1],line=name,paramName;for(paramName in params){var value=params[paramName];if(params.hasOwnProperty(paramName)){var multiValue=paramName in designSet.param&&designSet.param[paramName].multiValue;if(multiValue&&Array.isArray(value)){if(designSet.param[paramName].multiValueSeparateDQuote){multiValue="\""+multiValue+"\""}value=value.map(stringify._rfc6868Unescape);value=stringify.multiValue(value,multiValue,"unknown",null,designSet)}else{value=stringify._rfc6868Unescape(value)}line+=";"+paramName.toUpperCase();line+="="+stringify.propertyValue(value)}}if(3===property.length){return line+":"}var valueType=property[2];if(!designSet){designSet=design.defaultSet}var propDetails,multiValue=!1,structuredValue=!1,isDefault=!1;if(jsName in designSet.property){propDetails=designSet.property[jsName];if("multiValue"in propDetails){multiValue=propDetails.multiValue}if("structuredValue"in propDetails&&Array.isArray(property[3])){structuredValue=propDetails.structuredValue}if("defaultType"in propDetails){if(valueType===propDetails.defaultType){isDefault=!0}}else{if(valueType===DEFAULT_VALUE_TYPE){isDefault=!0}}}else{if(valueType===DEFAULT_VALUE_TYPE){isDefault=!0}}if(!isDefault){line+=";VALUE="+valueType.toUpperCase()}line+=":";if(multiValue&&structuredValue){line+=stringify.multiValue(property[3],structuredValue,valueType,multiValue,designSet,structuredValue)}else if(multiValue){line+=stringify.multiValue(property.slice(3),multiValue,valueType,null,designSet,!1)}else if(structuredValue){line+=stringify.multiValue(property[3],structuredValue,valueType,null,designSet,structuredValue)}else{line+=stringify.value(property[3],valueType,designSet,!1)}return noFold?line:ICAL.helpers.foldline(line)};stringify.propertyValue=function(value){if(-1===helpers.unescapedIndexOf(value,",")&&-1===helpers.unescapedIndexOf(value,":")&&-1===helpers.unescapedIndexOf(value,";")){return value}return"\""+value+"\""};stringify.multiValue=function(values,delim,type,innerMulti,designSet,structuredValue){var result="",len=values.length,i=0;for(;i<len;i++){if(innerMulti&&Array.isArray(values[i])){result+=stringify.multiValue(values[i],innerMulti,type,null,designSet,structuredValue)}else{result+=stringify.value(values[i],type,designSet,structuredValue)}if(i!==len-1){result+=delim}}return result};stringify.value=function(value,type,designSet,structuredValue){if(type in designSet.value&&"toICAL"in designSet.value[type]){return designSet.value[type].toICAL(value,structuredValue)}return value};stringify._rfc6868Unescape=function(val){return val.replace(/[\n^"]/g,function(x){return RFC6868_REPLACE_MAP[x]})};var RFC6868_REPLACE_MAP={'"':"^'","\n":"^n","^":"^^"};return stringify}();ICAL.parse=function(){"use strict";var CHAR=/[^ \t]/,VALUE_DELIMITER=":",PARAM_DELIMITER=";",design=ICAL.design,helpers=ICAL.helpers;function ParserError(message){this.message=message;this.name="ParserError";try{throw new Error}catch(e){if(e.stack){var split=e.stack.split("\n");split.shift();this.stack=split.join("\n")}}}ParserError.prototype=Error.prototype;function parser(input){var state={},root=state.component=[];state.stack=[root];parser._eachLine(input,function(err,line){parser._handleContentLine(line,state)});if(1<state.stack.length){throw new ParserError("invalid ical body. component began but did not end")}state=null;return 1==root.length?root[0]:root}parser.property=function(str,designSet){var state={component:[[],[]],designSet:designSet||design.defaultSet};parser._handleContentLine(str,state);return state.component[1][0]};parser.component=function(str){return parser(str)};parser.ParserError=ParserError;parser._handleContentLine=function(line,state){var valuePos=line.indexOf(VALUE_DELIMITER),paramPos=line.indexOf(PARAM_DELIMITER),lastParamIndex,lastValuePos,name,value,params={};if(-1!==paramPos&&-1!==valuePos){if(paramPos>valuePos){paramPos=-1}}var parsedParams;if(-1!==paramPos){name=line.substring(0,paramPos).toLowerCase();parsedParams=parser._parseParameters(line.substring(paramPos),0,state.designSet);if(-1==parsedParams[2]){throw new ParserError("Invalid parameters in '"+line+"'")}params=parsedParams[0];lastParamIndex=parsedParams[1].length+parsedParams[2]+paramPos;if(-1!==(lastValuePos=line.substring(lastParamIndex).indexOf(VALUE_DELIMITER))){value=line.substring(lastParamIndex+lastValuePos+1)}else{throw new ParserError("Missing parameter value in '"+line+"'")}}else if(-1!==valuePos){name=line.substring(0,valuePos).toLowerCase();value=line.substring(valuePos+1);if("begin"===name){var newComponent=[value.toLowerCase(),[],[]];if(1===state.stack.length){state.component.push(newComponent)}else{state.component[2].push(newComponent)}state.stack.push(state.component);state.component=newComponent;if(!state.designSet){state.designSet=design.getDesignSet(state.component[0])}return}else if("end"===name){state.component=state.stack.pop();return}}else{throw new ParserError("invalid line (no token \";\" or \":\") \""+line+"\"")}var valueType,multiValue=!1,structuredValue=!1,propertyDetails;if(name in state.designSet.property){propertyDetails=state.designSet.property[name];if("multiValue"in propertyDetails){multiValue=propertyDetails.multiValue}if("structuredValue"in propertyDetails){structuredValue=propertyDetails.structuredValue}if(value&&"detectType"in propertyDetails){valueType=propertyDetails.detectType(value)}}if(!valueType){if(!("value"in params)){if(propertyDetails){valueType=propertyDetails.defaultType}else{valueType="unknown"}}else{valueType=params.value.toLowerCase()}}delete params.value;var result;if(multiValue&&structuredValue){value=parser._parseMultiValue(value,structuredValue,valueType,[],multiValue,state.designSet,structuredValue);result=[name,params,valueType,value]}else if(multiValue){result=[name,params,valueType];parser._parseMultiValue(value,multiValue,valueType,result,null,state.designSet,!1)}else if(structuredValue){value=parser._parseMultiValue(value,structuredValue,valueType,[],null,state.designSet,structuredValue);result=[name,params,valueType,value]}else{value=parser._parseValue(value,valueType,state.designSet,!1);result=[name,params,valueType,value]}if("vcard"===state.component[0]&&0===state.component[1].length&&!("version"===name&&"4.0"===value)){state.designSet=design.getDesignSet("vcard3")}state.component[1].push(result)};parser._parseValue=function(value,type,designSet,structuredValue){if(type in designSet.value&&"fromICAL"in designSet.value[type]){return designSet.value[type].fromICAL(value,structuredValue)}return value};parser._parseParameters=function(line,start,designSet){var lastParam=start,pos=0,result={},name,lcname,value,valuePos=-1,type,multiValue,mvdelim;while(!1!==pos&&-1!==(pos=helpers.unescapedIndexOf(line,"=",pos+1))){name=line.substr(lastParam+1,pos-lastParam-1);if(0==name.length){throw new ParserError("Empty parameter name in '"+line+"'")}lcname=name.toLowerCase();if(lcname in designSet.param&&designSet.param[lcname].valueType){type=designSet.param[lcname].valueType}else{type="text"}if(lcname in designSet.param){multiValue=designSet.param[lcname].multiValue;if(designSet.param[lcname].multiValueSeparateDQuote){mvdelim=parser._rfc6868Escape("\""+multiValue+"\"")}}var nextChar=line[pos+1];if("\""===nextChar){valuePos=pos+2;pos=helpers.unescapedIndexOf(line,"\"",valuePos);if(multiValue&&-1!=pos){var extendedValue=!0;while(extendedValue){if(line[pos+1]==multiValue&&"\""==line[pos+2]){pos=helpers.unescapedIndexOf(line,"\"",pos+3)}else{extendedValue=!1}}}if(-1===pos){throw new ParserError("invalid line (no matching double quote) \""+line+"\"")}value=line.substr(valuePos,pos-valuePos);lastParam=helpers.unescapedIndexOf(line,PARAM_DELIMITER,pos);if(-1===lastParam){pos=!1}}else{valuePos=pos+1;var nextPos=helpers.unescapedIndexOf(line,PARAM_DELIMITER,valuePos),propValuePos=helpers.unescapedIndexOf(line,VALUE_DELIMITER,valuePos);if(-1!==propValuePos&&nextPos>propValuePos){nextPos=propValuePos;pos=!1}else if(-1===nextPos){if(-1===propValuePos){nextPos=line.length}else{nextPos=propValuePos}pos=!1}else{lastParam=nextPos;pos=nextPos}value=line.substr(valuePos,nextPos-valuePos)}value=parser._rfc6868Escape(value);if(multiValue){var delimiter=mvdelim||multiValue;result[lcname]=parser._parseMultiValue(value,delimiter,type,[],null,designSet)}else{result[lcname]=parser._parseValue(value,type,designSet)}}return[result,value,valuePos]};parser._rfc6868Escape=function(val){return val.replace(/\^['n^]/g,function(x){return RFC6868_REPLACE_MAP[x]})};var RFC6868_REPLACE_MAP={"^'":"\"","^n":"\n","^^":"^"};parser._parseMultiValue=function(buffer,delim,type,result,innerMulti,designSet,structuredValue){var pos=0,lastPos=0,value;if(0===delim.length){return buffer}while(-1!==(pos=helpers.unescapedIndexOf(buffer,delim,lastPos))){value=buffer.substr(lastPos,pos-lastPos);if(innerMulti){value=parser._parseMultiValue(value,innerMulti,type,[],null,designSet,structuredValue)}else{value=parser._parseValue(value,type,designSet,structuredValue)}result.push(value);lastPos=pos+delim.length}value=buffer.substr(lastPos);if(innerMulti){value=parser._parseMultiValue(value,innerMulti,type,[],null,designSet,structuredValue)}else{value=parser._parseValue(value,type,designSet,structuredValue)}result.push(value);return 1==result.length?result[0]:result};parser._eachLine=function(buffer,callback){var len=buffer.length,lastPos=buffer.search(CHAR),pos=lastPos,line,firstChar,newlineOffset;do{pos=buffer.indexOf("\n",lastPos)+1;if(1<pos&&"\r"===buffer[pos-2]){newlineOffset=2}else{newlineOffset=1}if(0===pos){pos=len;newlineOffset=0}firstChar=buffer[lastPos];if(" "===firstChar||"\t"===firstChar){line+=buffer.substr(lastPos+1,pos-lastPos-(newlineOffset+1))}else{if(line)callback(null,line);line=buffer.substr(lastPos,pos-lastPos-newlineOffset)}lastPos=pos}while(pos!==len);line=line.trim();if(line.length)callback(null,line)};return parser}();ICAL.Component=function(){"use strict";var PROPERTY_INDEX=1,COMPONENT_INDEX=2,NAME_INDEX=0;function Component(jCal,parent){if("string"===typeof jCal){jCal=[jCal,[],[]]}this.jCal=jCal;this.parent=parent||null}Component.prototype={_hydratedPropertyCount:0,_hydratedComponentCount:0,get name(){return this.jCal[NAME_INDEX]},get _designSet(){var parentDesign=this.parent&&this.parent._designSet;return parentDesign||ICAL.design.getDesignSet(this.name)},_hydrateComponent:function _hydrateComponent(index){if(!this._components){this._components=[];this._hydratedComponentCount=0}if(this._components[index]){return this._components[index]}var comp=new Component(this.jCal[COMPONENT_INDEX][index],this);this._hydratedComponentCount++;return this._components[index]=comp},_hydrateProperty:function _hydrateProperty(index){if(!this._properties){this._properties=[];this._hydratedPropertyCount=0}if(this._properties[index]){return this._properties[index]}var prop=new ICAL.Property(this.jCal[PROPERTY_INDEX][index],this);this._hydratedPropertyCount++;return this._properties[index]=prop},getFirstSubcomponent:function getFirstSubcomponent(name){if(name){var i=0,comps=this.jCal[COMPONENT_INDEX],len=comps.length;for(;i<len;i++){if(comps[i][NAME_INDEX]===name){var result=this._hydrateComponent(i);return result}}}else{if(this.jCal[COMPONENT_INDEX].length){return this._hydrateComponent(0)}}return null},getAllSubcomponents:function getAllSubcomponents(name){var jCalLen=this.jCal[COMPONENT_INDEX].length,i=0;if(name){var comps=this.jCal[COMPONENT_INDEX],result=[];for(;i<jCalLen;i++){if(name===comps[i][NAME_INDEX]){result.push(this._hydrateComponent(i))}}return result}else{if(!this._components||this._hydratedComponentCount!==jCalLen){for(;i<jCalLen;i++){this._hydrateComponent(i)}}return this._components||[]}},hasProperty:function hasProperty(name){var props=this.jCal[PROPERTY_INDEX],len=props.length,i=0;for(;i<len;i++){if(props[i][NAME_INDEX]===name){return!0}}return!1},getFirstProperty:function getFirstProperty(name){if(name){var i=0,props=this.jCal[PROPERTY_INDEX],len=props.length;for(;i<len;i++){if(props[i][NAME_INDEX]===name){var result=this._hydrateProperty(i);return result}}}else{if(this.jCal[PROPERTY_INDEX].length){return this._hydrateProperty(0)}}return null},getFirstPropertyValue:function getFirstPropertyValue(name){var prop=this.getFirstProperty(name);if(prop){return prop.getFirstValue()}return null},getAllProperties:function getAllProperties(name){var jCalLen=this.jCal[PROPERTY_INDEX].length,i=0;if(name){var props=this.jCal[PROPERTY_INDEX],result=[];for(;i<jCalLen;i++){if(name===props[i][NAME_INDEX]){result.push(this._hydrateProperty(i))}}return result}else{if(!this._properties||this._hydratedPropertyCount!==jCalLen){for(;i<jCalLen;i++){this._hydrateProperty(i)}}return this._properties||[]}},_removeObjectByIndex:function _removeObjectByIndex(jCalIndex,cache,index){cache=cache||[];if(cache[index]){var obj=cache[index];if("parent"in obj){obj.parent=null}}cache.splice(index,1);this.jCal[jCalIndex].splice(index,1)},_removeObject:function _removeObject(jCalIndex,cache,nameOrObject){var i=0,objects=this.jCal[jCalIndex],len=objects.length,cached=this[cache];if("string"===typeof nameOrObject){for(;i<len;i++){if(objects[i][NAME_INDEX]===nameOrObject){this._removeObjectByIndex(jCalIndex,cached,i);return!0}}}else if(cached){for(;i<len;i++){if(cached[i]&&cached[i]===nameOrObject){this._removeObjectByIndex(jCalIndex,cached,i);return!0}}}return!1},_removeAllObjects:function _removeAllObjects(jCalIndex,cache,name){var cached=this[cache],objects=this.jCal[jCalIndex],i=objects.length-1;for(;0<=i;i--){if(!name||objects[i][NAME_INDEX]===name){this._removeObjectByIndex(jCalIndex,cached,i)}}},addSubcomponent:function addSubcomponent(component){if(!this._components){this._components=[];this._hydratedComponentCount=0}if(component.parent){component.parent.removeSubcomponent(component)}var idx=this.jCal[COMPONENT_INDEX].push(component.jCal);this._components[idx-1]=component;this._hydratedComponentCount++;component.parent=this;return component},removeSubcomponent:function removeSubcomponent(nameOrComp){var removed=this._removeObject(COMPONENT_INDEX,"_components",nameOrComp);if(removed){this._hydratedComponentCount--}return removed},removeAllSubcomponents:function removeAllSubcomponents(name){var removed=this._removeAllObjects(COMPONENT_INDEX,"_components",name);this._hydratedComponentCount=0;return removed},addProperty:function addProperty(property){if(!babelHelpers.instanceof(property,ICAL.Property)){throw new TypeError("must instance of ICAL.Property")}if(!this._properties){this._properties=[];this._hydratedPropertyCount=0}if(property.parent){property.parent.removeProperty(property)}var idx=this.jCal[PROPERTY_INDEX].push(property.jCal);this._properties[idx-1]=property;this._hydratedPropertyCount++;property.parent=this;return property},addPropertyWithValue:function addPropertyWithValue(name,value){var prop=new ICAL.Property(name);prop.setValue(value);this.addProperty(prop);return prop},updatePropertyWithValue:function updatePropertyWithValue(name,value){var prop=this.getFirstProperty(name);if(prop){prop.setValue(value)}else{prop=this.addPropertyWithValue(name,value)}return prop},removeProperty:function removeProperty(nameOrProp){var removed=this._removeObject(PROPERTY_INDEX,"_properties",nameOrProp);if(removed){this._hydratedPropertyCount--}return removed},removeAllProperties:function removeAllProperties(name){var removed=this._removeAllObjects(PROPERTY_INDEX,"_properties",name);this._hydratedPropertyCount=0;return removed},toJSON:function toJSON(){return this.jCal},toString:function toString(){return ICAL.stringify.component(this.jCal,this._designSet)}};Component.fromString=function(str){return new Component(ICAL.parse.component(str))};return Component}();ICAL.Property=function(){"use strict";var NAME_INDEX=0,PROP_INDEX=1,TYPE_INDEX=2,VALUE_INDEX=3,design=ICAL.design;function Property(jCal,parent){this._parent=parent||null;if("string"===typeof jCal){this.jCal=[jCal,{},design.defaultType];this.jCal[TYPE_INDEX]=this.getDefaultType()}else{this.jCal=jCal}this._updateType()}Property.prototype={get type(){return this.jCal[TYPE_INDEX]},get name(){return this.jCal[NAME_INDEX]},get parent(){return this._parent},set parent(p){var designSetChanged=!this._parent||p&&p._designSet!=this._parent._designSet;this._parent=p;if(this.type==design.defaultType&&designSetChanged){this.jCal[TYPE_INDEX]=this.getDefaultType();this._updateType()}return p},get _designSet(){return this.parent?this.parent._designSet:design.defaultSet},_updateType:function _updateType(){var designSet=this._designSet;if(this.type in designSet.value){designSet.value[this.type];if("decorate"in designSet.value[this.type]){this.isDecorated=!0}else{this.isDecorated=!1}if(this.name in designSet.property){this.isMultiValue="multiValue"in designSet.property[this.name];this.isStructuredValue="structuredValue"in designSet.property[this.name]}}},_hydrateValue:function _hydrateValue(index){if(this._values&&this._values[index]){return this._values[index]}if(this.jCal.length<=VALUE_INDEX+index){return null}if(this.isDecorated){if(!this._values){this._values=[]}return this._values[index]=this._decorate(this.jCal[VALUE_INDEX+index])}else{return this.jCal[VALUE_INDEX+index]}},_decorate:function _decorate(value){return this._designSet.value[this.type].decorate(value,this)},_undecorate:function _undecorate(value){return this._designSet.value[this.type].undecorate(value,this)},_setDecoratedValue:function _setDecoratedValue(value,index){if(!this._values){this._values=[]}if("object"===babelHelpers.typeof(value)&&"icaltype"in value){this.jCal[VALUE_INDEX+index]=this._undecorate(value);this._values[index]=value}else{this.jCal[VALUE_INDEX+index]=value;this._values[index]=this._decorate(value)}},getParameter:function getParameter(name){if(name in this.jCal[PROP_INDEX]){return this.jCal[PROP_INDEX][name]}else{}},setParameter:function setParameter(name,value){var lcname=name.toLowerCase();if("string"===typeof value&&lcname in this._designSet.param&&"multiValue"in this._designSet.param[lcname]){value=[value]}this.jCal[PROP_INDEX][name]=value},removeParameter:function removeParameter(name){delete this.jCal[PROP_INDEX][name]},getDefaultType:function getDefaultType(){var name=this.jCal[NAME_INDEX],designSet=this._designSet;if(name in designSet.property){var details=designSet.property[name];if("defaultType"in details){return details.defaultType}}return design.defaultType},resetType:function resetType(type){this.removeAllValues();this.jCal[TYPE_INDEX]=type;this._updateType()},getFirstValue:function getFirstValue(){return this._hydrateValue(0)},getValues:function getValues(){var len=this.jCal.length-VALUE_INDEX;if(1>len){return[]}var i=0,result=[];for(;i<len;i++){result[i]=this._hydrateValue(i)}return result},removeAllValues:function removeAllValues(){if(this._values){this._values.length=0}this.jCal.length=3},setValues:function setValues(values){if(!this.isMultiValue){throw new Error(this.name+": does not not support mulitValue.\n"+"override isMultiValue")}var len=values.length,i=0;this.removeAllValues();if(0<len&&"object"===babelHelpers.typeof(values[0])&&"icaltype"in values[0]){this.resetType(values[0].icaltype)}if(this.isDecorated){for(;i<len;i++){this._setDecoratedValue(values[i],i)}}else{for(;i<len;i++){this.jCal[VALUE_INDEX+i]=values[i]}}},setValue:function setValue(value){this.removeAllValues();if("object"===babelHelpers.typeof(value)&&"icaltype"in value){this.resetType(value.icaltype)}if(this.isDecorated){this._setDecoratedValue(value,0)}else{this.jCal[VALUE_INDEX]=value}},toJSON:function toJSON(){return this.jCal},toICALString:function toICALString(){return ICAL.stringify.property(this.jCal,this._designSet,!0)}};Property.fromString=function(str,designSet){return new Property(ICAL.parse.property(str,designSet))};return Property}();ICAL.UtcOffset=function(){function UtcOffset(aData){this.fromData(aData)}UtcOffset.prototype={hours:0,minutes:0,factor:1,icaltype:"utc-offset",clone:function clone(){return ICAL.UtcOffset.fromSeconds(this.toSeconds())},fromData:function fromData(aData){if(aData){for(var key in aData){if(aData.hasOwnProperty(key)){this[key]=aData[key]}}}this._normalize()},fromSeconds:function fromSeconds(aSeconds){var secs=Math.abs(aSeconds);this.factor=0>aSeconds?-1:1;this.hours=ICAL.helpers.trunc(secs/3600);secs-=3600*this.hours;this.minutes=ICAL.helpers.trunc(secs/60);return this},toSeconds:function toSeconds(){return this.factor*(60*this.minutes+3600*this.hours)},compare:function(other){var a=this.toSeconds(),b=other.toSeconds();return(a>b)-(b>a)},_normalize:function _normalize(){var secs=this.toSeconds(),factor=this.factor;while(-43200>secs){secs+=97200}while(50400<secs){secs-=97200}this.fromSeconds(secs);if(0==secs){this.factor=factor}},toICALString:function toICALString(){return ICAL.design.icalendar.value["utc-offset"].toICAL(this.toString())},toString:function(){return(1==this.factor?"+":"-")+ICAL.helpers.pad2(this.hours)+":"+ICAL.helpers.pad2(this.minutes)}};UtcOffset.fromString=function(aString){var options={factor:"+"===aString[0]?1:-1,hours:ICAL.helpers.strictParseInt(aString.substr(1,2)),minutes:ICAL.helpers.strictParseInt(aString.substr(4,2))};return new ICAL.UtcOffset(options)};UtcOffset.fromSeconds=function(aSeconds){var instance=new UtcOffset;instance.fromSeconds(aSeconds);return instance};return UtcOffset}();ICAL.Binary=function(){function Binary(aValue){this.value=aValue}Binary.prototype={icaltype:"binary",decodeValue:function(){return this._b64_decode(this.value)},setEncodedValue:function(aValue){this.value=this._b64_encode(aValue)},_b64_encode:function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZ"+"abcdefghijklmnopqrstuvwxyz0123456789+/=",o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data}do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=63&bits>>18;h2=63&bits>>12;h3=63&bits>>6;h4=63&bits;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join("");var r=data.length%3;return(r?enc.slice(0,r-3):enc)+"===".slice(r||3)},_b64_decode:function(data){var _StringfromCharCode=String.fromCharCode,b64="ABCDEFGHIJKLMNOPQRSTUVWXYZ"+"abcdefghijklmnopqrstuvwxyz0123456789+/=",o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!data){return data}data+="";do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=255&bits>>16;o2=255&bits>>8;o3=255&bits;if(64==h3){tmp_arr[ac++]=_StringfromCharCode(o1)}else if(64==h4){tmp_arr[ac++]=_StringfromCharCode(o1,o2)}else{tmp_arr[ac++]=_StringfromCharCode(o1,o2,o3)}}while(i<data.length);dec=tmp_arr.join("");return dec},toString:function toString(){return this.value}};Binary.fromString=function(aString){return new Binary(aString)};return Binary}();(function(){ICAL.Period=function(aData){this.wrappedJSObject=this;if(aData&&"start"in aData){if(aData.start&&!babelHelpers.instanceof(aData.start,ICAL.Time)){throw new TypeError(".start must be an instance of ICAL.Time")}this.start=aData.start}if(aData&&aData.end&&aData.duration){throw new Error("cannot accept both end and duration")}if(aData&&"end"in aData){if(aData.end&&!babelHelpers.instanceof(aData.end,ICAL.Time)){throw new TypeError(".end must be an instance of ICAL.Time")}this.end=aData.end}if(aData&&"duration"in aData){if(aData.duration&&!babelHelpers.instanceof(aData.duration,ICAL.Duration)){throw new TypeError(".duration must be an instance of ICAL.Duration")}this.duration=aData.duration}};ICAL.Period.prototype={start:null,end:null,duration:null,icalclass:"icalperiod",icaltype:"period",clone:function clone(){return ICAL.Period.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})},getDuration:function(){if(this.duration){return this.duration}else{return this.end.subtractDate(this.start)}},getEnd:function getEnd(){if(this.end){return this.end}else{var end=this.start.clone();end.addDuration(this.duration);return end}},toString:function(){return this.start+"/"+(this.end||this.duration)},toJSON:function toJSON(){return[this.start.toString(),(this.end||this.duration).toString()]},toICALString:function toICALString(){return this.start.toICALString()+"/"+(this.end||this.duration).toICALString()}};ICAL.Period.fromString=function(str,prop){var parts=str.split("/");if(2!==parts.length){throw new Error("Invalid string value: \""+str+"\" must contain a \"/\" char.")}var options={start:ICAL.Time.fromDateTimeString(parts[0],prop)},end=parts[1];if(ICAL.Duration.isValueString(end)){options.duration=ICAL.Duration.fromString(end)}else{options.end=ICAL.Time.fromDateTimeString(end,prop)}return new ICAL.Period(options)};ICAL.Period.fromData=function(aData){return new ICAL.Period(aData)};ICAL.Period.fromJSON=function(aData,aProp){if(ICAL.Duration.isValueString(aData[1])){return ICAL.Period.fromData({start:ICAL.Time.fromDateTimeString(aData[0],aProp),duration:ICAL.Duration.fromString(aData[1])})}else{return ICAL.Period.fromData({start:ICAL.Time.fromDateTimeString(aData[0],aProp),end:ICAL.Time.fromDateTimeString(aData[1],aProp)})}}})();(function(){var DURATION_LETTERS=/([PDWHMTS]{1,1})/;ICAL.Duration=function(data){this.wrappedJSObject=this;this.fromData(data)};ICAL.Duration.prototype={weeks:0,days:0,hours:0,minutes:0,seconds:0,isNegative:!1,icalclass:"icalduration",icaltype:"duration",clone:function(){return ICAL.Duration.fromData(this)},toSeconds:function(){var seconds=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+86400*7*this.weeks;return this.isNegative?-seconds:seconds},fromSeconds:function(aSeconds){var secs=Math.abs(aSeconds);this.isNegative=0>aSeconds;this.days=ICAL.helpers.trunc(secs/86400);if(0==this.days%7){this.weeks=this.days/7;this.days=0}else{this.weeks=0}secs-=86400*(this.days+7*this.weeks);this.hours=ICAL.helpers.trunc(secs/3600);secs-=3600*this.hours;this.minutes=ICAL.helpers.trunc(secs/60);secs-=60*this.minutes;this.seconds=secs;return this},fromData:function(aData){var propsToCopy=["weeks","days","hours","minutes","seconds","isNegative"];for(var key in propsToCopy){if(!propsToCopy.hasOwnProperty(key)){continue}var prop=propsToCopy[key];if(aData&&prop in aData){this[prop]=aData[prop]}else{this[prop]=0}}},reset:function(){this.isNegative=!1;this.weeks=0;this.days=0;this.hours=0;this.minutes=0;this.seconds=0},compare:function(aOther){var thisSeconds=this.toSeconds(),otherSeconds=aOther.toSeconds();return(thisSeconds>otherSeconds)-(thisSeconds<otherSeconds)},normalize:function(){this.fromSeconds(this.toSeconds())},toString:function(){if(0==this.toSeconds()){return"PT0S"}else{var str="";if(this.isNegative)str+="-";str+="P";if(this.weeks)str+=this.weeks+"W";if(this.days)str+=this.days+"D";if(this.hours||this.minutes||this.seconds){str+="T";if(this.hours)str+=this.hours+"H";if(this.minutes)str+=this.minutes+"M";if(this.seconds)str+=this.seconds+"S"}return str}},toICALString:function toICALString(){return this.toString()}};ICAL.Duration.fromSeconds=function(aSeconds){return new ICAL.Duration().fromSeconds(aSeconds)};function parseDurationChunk(letter,number,object){var type;switch(letter){case"P":if(number&&"-"===number){object.isNegative=!0}else{object.isNegative=!1}break;case"D":type="days";break;case"W":type="weeks";break;case"H":type="hours";break;case"M":type="minutes";break;case"S":type="seconds";break;default:return 0;}if(type){if(!number&&0!==number){throw new Error("invalid duration value: Missing number before \""+letter+"\"")}var num=parseInt(number,10);if(ICAL.helpers.isStrictlyNaN(num)){throw new Error("invalid duration value: Invalid number \""+number+"\" before \""+letter+"\"")}object[type]=num}return 1}ICAL.Duration.isValueString=function(string){return"P"===string[0]||"P"===string[1]};ICAL.Duration.fromString=function(aStr){var pos=0,dict=Object.create(null),chunks=0;while(-1!==(pos=aStr.search(DURATION_LETTERS))){var type=aStr[pos],numeric=aStr.substr(0,pos);aStr=aStr.substr(pos+1);chunks+=parseDurationChunk(type,numeric,dict)}if(2>chunks){throw new Error("invalid duration value: Not enough duration components in \""+aStr+"\"")}return new ICAL.Duration(dict)};ICAL.Duration.fromData=function(aData){return new ICAL.Duration(aData)}})();(function(){var OPTIONS=["tzid","location","tznames","latitude","longitude"];ICAL.Timezone=function(data){this.wrappedJSObject=this;this.fromData(data)};ICAL.Timezone.prototype={tzid:"",location:"",tznames:"",latitude:0,longitude:0,component:null,expandedUntilYear:0,icalclass:"icaltimezone",fromData:function(aData){this.expandedUntilYear=0;this.changes=[];if(babelHelpers.instanceof(aData,ICAL.Component)){this.component=aData}else{if(aData&&"component"in aData){if("string"==typeof aData.component){var jCal=ICAL.parse(aData.component);this.component=new ICAL.Component(jCal)}else if(babelHelpers.instanceof(aData.component,ICAL.Component)){this.component=aData.component}else{this.component=null}}for(var key in OPTIONS){if(OPTIONS.hasOwnProperty(key)){var prop=OPTIONS[key];if(aData&&prop in aData){this[prop]=aData[prop]}}}}if(babelHelpers.instanceof(this.component,ICAL.Component)&&!this.tzid){this.tzid=this.component.getFirstPropertyValue("tzid")}return this},utcOffset:function(tt){if(this==ICAL.Timezone.utcTimezone||this==ICAL.Timezone.localTimezone){return 0}this._ensureCoverage(tt.year);if(!this.changes.length){return 0}var tt_change={year:tt.year,month:tt.month,day:tt.day,hour:tt.hour,minute:tt.minute,second:tt.second},change_num=this._findNearbyChange(tt_change),change_num_to_use=-1,step=1;for(;;){var change=ICAL.helpers.clone(this.changes[change_num],!0);if(change.utcOffset<change.prevUtcOffset){ICAL.Timezone.adjust_change(change,0,0,0,change.utcOffset)}else{ICAL.Timezone.adjust_change(change,0,0,0,change.prevUtcOffset)}var cmp=ICAL.Timezone._compare_change_fn(tt_change,change);if(0<=cmp){change_num_to_use=change_num}else{step=-1}if(-1==step&&-1!=change_num_to_use){break}change_num+=step;if(0>change_num){return 0}if(change_num>=this.changes.length){break}}var zone_change=this.changes[change_num_to_use],utcOffset_change=zone_change.utcOffset-zone_change.prevUtcOffset;if(0>utcOffset_change&&0<change_num_to_use){var tmp_change=ICAL.helpers.clone(zone_change,!0);ICAL.Timezone.adjust_change(tmp_change,0,0,0,tmp_change.prevUtcOffset);if(0>ICAL.Timezone._compare_change_fn(tt_change,tmp_change)){var prev_zone_change=this.changes[change_num_to_use-1],want_daylight=!1;if(zone_change.is_daylight!=want_daylight&&prev_zone_change.is_daylight==want_daylight){zone_change=prev_zone_change}}}return zone_change.utcOffset},_findNearbyChange:function(change){var idx=ICAL.helpers.binsearchInsert(this.changes,change,ICAL.Timezone._compare_change_fn);if(idx>=this.changes.length){return this.changes.length-1}return idx},_ensureCoverage:function _ensureCoverage(aYear){if(-1==ICAL.Timezone._minimumExpansionYear){var today=ICAL.Time.now();ICAL.Timezone._minimumExpansionYear=today.year}var changesEndYear=aYear;if(changesEndYear<ICAL.Timezone._minimumExpansionYear){changesEndYear=ICAL.Timezone._minimumExpansionYear}changesEndYear+=ICAL.Timezone.EXTRA_COVERAGE;if(changesEndYear>ICAL.Timezone.MAX_YEAR){changesEndYear=ICAL.Timezone.MAX_YEAR}if(!this.changes.length||this.expandedUntilYear<aYear){var subcomps=this.component.getAllSubcomponents(),compLen=subcomps.length,compIdx=0;for(;compIdx<compLen;compIdx++){this._expandComponent(subcomps[compIdx],changesEndYear,this.changes)}this.changes.sort(ICAL.Timezone._compare_change_fn);this.expandedUntilYear=changesEndYear}},_expandComponent:function _expandComponent(aComponent,aYear,changes){if(!aComponent.hasProperty("dtstart")||!aComponent.hasProperty("tzoffsetto")||!aComponent.hasProperty("tzoffsetfrom")){return null}var dtstart=aComponent.getFirstProperty("dtstart").getFirstValue(),change;function convert_tzoffset(offset){return offset.factor*(3600*offset.hours+60*offset.minutes)}function init_changes(){var changebase={is_daylight:"daylight"==aComponent.name,utcOffset:convert_tzoffset(aComponent.getFirstProperty("tzoffsetto").getFirstValue()),prevUtcOffset:convert_tzoffset(aComponent.getFirstProperty("tzoffsetfrom").getFirstValue())};return changebase}if(!aComponent.hasProperty("rrule")&&!aComponent.hasProperty("rdate")){change=init_changes();change.year=dtstart.year;change.month=dtstart.month;change.day=dtstart.day;change.hour=dtstart.hour;change.minute=dtstart.minute;change.second=dtstart.second;ICAL.Timezone.adjust_change(change,0,0,0,-change.prevUtcOffset);changes.push(change)}else{var props=aComponent.getAllProperties("rdate");for(var rdatekey in props){if(!props.hasOwnProperty(rdatekey)){continue}var rdate=props[rdatekey],time=rdate.getFirstValue();change=init_changes();change.year=time.year;change.month=time.month;change.day=time.day;if(time.isDate){change.hour=dtstart.hour;change.minute=dtstart.minute;change.second=dtstart.second;if(dtstart.zone!=ICAL.Timezone.utcTimezone){ICAL.Timezone.adjust_change(change,0,0,0,-change.prevUtcOffset)}}else{change.hour=time.hour;change.minute=time.minute;change.second=time.second;if(time.zone!=ICAL.Timezone.utcTimezone){ICAL.Timezone.adjust_change(change,0,0,0,-change.prevUtcOffset)}}changes.push(change)}var rrule=aComponent.getFirstProperty("rrule");if(rrule){rrule=rrule.getFirstValue();change=init_changes();if(rrule.until&&rrule.until.zone==ICAL.Timezone.utcTimezone){rrule.until.adjust(0,0,0,change.prevUtcOffset);rrule.until.zone=ICAL.Timezone.localTimezone}var iterator=rrule.iterator(dtstart),occ;while(occ=iterator.next()){change=init_changes();if(occ.year>aYear||!occ){break}change.year=occ.year;change.month=occ.month;change.day=occ.day;change.hour=occ.hour;change.minute=occ.minute;change.second=occ.second;change.isDate=occ.isDate;ICAL.Timezone.adjust_change(change,0,0,0,-change.prevUtcOffset);changes.push(change)}}}return changes},toString:function(){return this.tznames?this.tznames:this.tzid}};ICAL.Timezone._compare_change_fn=function(a,b){if(a.year<b.year)return-1;else if(a.year>b.year)return 1;if(a.month<b.month)return-1;else if(a.month>b.month)return 1;if(a.day<b.day)return-1;else if(a.day>b.day)return 1;if(a.hour<b.hour)return-1;else if(a.hour>b.hour)return 1;if(a.minute<b.minute)return-1;else if(a.minute>b.minute)return 1;if(a.second<b.second)return-1;else if(a.second>b.second)return 1;return 0};ICAL.Timezone.convert_time=function(tt,from_zone,to_zone){if(tt.isDate||from_zone.tzid==to_zone.tzid||from_zone==ICAL.Timezone.localTimezone||to_zone==ICAL.Timezone.localTimezone){tt.zone=to_zone;return tt}var utcOffset=from_zone.utcOffset(tt);tt.adjust(0,0,0,-utcOffset);utcOffset=to_zone.utcOffset(tt);tt.adjust(0,0,0,utcOffset);return null};ICAL.Timezone.fromData=function(aData){var tt=new ICAL.Timezone;return tt.fromData(aData)};ICAL.Timezone.utcTimezone=ICAL.Timezone.fromData({tzid:"UTC"});ICAL.Timezone.localTimezone=ICAL.Timezone.fromData({tzid:"floating"});ICAL.Timezone.adjust_change=function(change,days,hours,minutes,seconds){return ICAL.Time.prototype.adjust.call(change,days,hours,minutes,seconds,change)};ICAL.Timezone._minimumExpansionYear=-1;ICAL.Timezone.MAX_YEAR=2035;ICAL.Timezone.EXTRA_COVERAGE=5})();ICAL.TimezoneService=function(){var zones,TimezoneService={reset:function reset(){zones=Object.create(null);var utc=ICAL.Timezone.utcTimezone;zones.Z=utc;zones.UTC=utc;zones.GMT=utc},has:function has(tzid){return!!zones[tzid]},get:function get(tzid){return zones[tzid]},register:function register(name,timezone){if(babelHelpers.instanceof(name,ICAL.Component)){if("vtimezone"===name.name){timezone=new ICAL.Timezone(name);name=timezone.tzid}}if(babelHelpers.instanceof(timezone,ICAL.Timezone)){zones[name]=timezone}else{throw new TypeError("timezone must be ICAL.Timezone or ICAL.Component")}},remove:function remove(tzid){return delete zones[tzid]}};TimezoneService.reset();return TimezoneService}();(function(){ICAL.Time=function(data,zone){this.wrappedJSObject=this;var time=this._time=Object.create(null);time.year=0;time.month=1;time.day=1;time.hour=0;time.minute=0;time.second=0;time.isDate=!1;this.fromData(data,zone)};ICAL.Time._dowCache={};ICAL.Time._wnCache={};ICAL.Time.prototype={icalclass:"icaltime",_cachedUnixTime:null,get icaltype(){return this.isDate?"date":"date-time"},zone:null,_pendingNormalization:!1,clone:function clone(){return new ICAL.Time(this._time,this.zone)},reset:function(){this.fromData(ICAL.Time.epochTime);this.zone=ICAL.Timezone.utcTimezone},resetTo:function(year,month,day,hour,minute,second,timezone){this.fromData({year:year,month:month,day:day,hour:hour,minute:minute,second:second,zone:timezone})},fromJSDate:function(aDate,useUTC){if(!aDate){this.reset()}else{if(useUTC){this.zone=ICAL.Timezone.utcTimezone;this.year=aDate.getUTCFullYear();this.month=aDate.getUTCMonth()+1;this.day=aDate.getUTCDate();this.hour=aDate.getUTCHours();this.minute=aDate.getUTCMinutes();this.second=aDate.getUTCSeconds()}else{this.zone=ICAL.Timezone.localTimezone;this.year=aDate.getFullYear();this.month=aDate.getMonth()+1;this.day=aDate.getDate();this.hour=aDate.getHours();this.minute=aDate.getMinutes();this.second=aDate.getSeconds()}}this._cachedUnixTime=null;return this},fromData:function(aData,aZone){if(aData){for(var key in aData){if(Object.prototype.hasOwnProperty.call(aData,key)){if("icaltype"===key)continue;this[key]=aData[key]}}}if(aZone){this.zone=aZone}if(aData&&!("isDate"in aData)){this.isDate=!("hour"in aData)}else if(aData&&"isDate"in aData){this.isDate=aData.isDate}if(aData&&"timezone"in aData){var zone=ICAL.TimezoneService.get(aData.timezone);this.zone=zone||ICAL.Timezone.localTimezone}if(aData&&"zone"in aData){this.zone=aData.zone}if(!this.zone){this.zone=ICAL.Timezone.localTimezone}this._cachedUnixTime=null;return this},dayOfWeek:function(){var dowCacheKey=(this.year<<9)+(this.month<<5)+this.day;if(dowCacheKey in ICAL.Time._dowCache){return ICAL.Time._dowCache[dowCacheKey]}var q=this.day,m=this.month+(3>this.month?12:0),Y=this.year-(3>this.month?1:0),h=q+Y+ICAL.helpers.trunc(26*(m+1)/10)+ICAL.helpers.trunc(Y/4);h+=6*ICAL.helpers.trunc(Y/100)+ICAL.helpers.trunc(Y/400);h=(h+6)%7+1;ICAL.Time._dowCache[dowCacheKey]=h;return h},dayOfYear:function(){var is_leap=ICAL.Time.isLeapYear(this.year)?1:0,diypm=ICAL.Time.daysInYearPassedMonth;return diypm[is_leap][this.month-1]+this.day},startOfWeek:function(aWeekStart){var firstDow=aWeekStart||ICAL.Time.SUNDAY,result=this.clone();result.day-=(this.dayOfWeek()+7-firstDow)%7;result.isDate=!0;result.hour=0;result.minute=0;result.second=0;return result},endOfWeek:function(aWeekStart){var firstDow=aWeekStart||ICAL.Time.SUNDAY,result=this.clone();result.day+=(7-this.dayOfWeek()+firstDow-ICAL.Time.SUNDAY)%7;result.isDate=!0;result.hour=0;result.minute=0;result.second=0;return result},startOfMonth:function(){var result=this.clone();result.day=1;result.isDate=!0;result.hour=0;result.minute=0;result.second=0;return result},endOfMonth:function(){var result=this.clone();result.day=ICAL.Time.daysInMonth(result.month,result.year);result.isDate=!0;result.hour=0;result.minute=0;result.second=0;return result},startOfYear:function(){var result=this.clone();result.day=1;result.month=1;result.isDate=!0;result.hour=0;result.minute=0;result.second=0;return result},endOfYear:function(){var result=this.clone();result.day=31;result.month=12;result.isDate=!0;result.hour=0;result.minute=0;result.second=0;return result},startDoyWeek:function(aFirstDayOfWeek){var firstDow=aFirstDayOfWeek||ICAL.Time.SUNDAY,delta=this.dayOfWeek()-firstDow;if(0>delta)delta+=7;return this.dayOfYear()-delta},getDominicalLetter:function getDominicalLetter(){return ICAL.Time.getDominicalLetter(this.year)},nthWeekDay:function(aDayOfWeek,aPos){var daysInMonth=ICAL.Time.daysInMonth(this.month,this.year),weekday,pos=aPos,start=0,otherDay=this.clone();if(0<=pos){otherDay.day=1;if(0!=pos){pos--}start=otherDay.day;var startDow=otherDay.dayOfWeek(),offset=aDayOfWeek-startDow;if(0>offset)offset+=7;start+=offset;start-=aDayOfWeek;weekday=aDayOfWeek}else{otherDay.day=daysInMonth;var endDow=otherDay.dayOfWeek();pos++;weekday=endDow-aDayOfWeek;if(0>weekday){weekday+=7}weekday=daysInMonth-weekday}weekday+=7*pos;return start+weekday},isNthWeekDay:function isNthWeekDay(aDayOfWeek,aPos){var dow=this.dayOfWeek();if(0===aPos&&dow===aDayOfWeek){return!0}var day=this.nthWeekDay(aDayOfWeek,aPos);if(day===this.day){return!0}return!1},weekNumber:function(aWeekStart){var wnCacheKey=(this.year<<12)+(this.month<<8)+(this.day<<3)+aWeekStart;if(wnCacheKey in ICAL.Time._wnCache){return ICAL.Time._wnCache[wnCacheKey]}var week1,dt=this.clone();dt.isDate=!0;var isoyear=this.year;if(12==dt.month&&25<dt.day){week1=ICAL.Time.weekOneStarts(isoyear+1,aWeekStart);if(0>dt.compare(week1)){week1=ICAL.Time.weekOneStarts(isoyear,aWeekStart)}else{isoyear++}}else{week1=ICAL.Time.weekOneStarts(isoyear,aWeekStart);if(0>dt.compare(week1)){week1=ICAL.Time.weekOneStarts(--isoyear,aWeekStart)}}var daysBetween=dt.subtractDate(week1).toSeconds()/86400,answer=ICAL.helpers.trunc(daysBetween/7)+1;ICAL.Time._wnCache[wnCacheKey]=answer;return answer},addDuration:function(aDuration){var mult=aDuration.isNegative?-1:1,second=this.second,minute=this.minute,hour=this.hour,day=this.day;second+=mult*aDuration.seconds;minute+=mult*aDuration.minutes;hour+=mult*aDuration.hours;day+=mult*aDuration.days;day+=7*mult*aDuration.weeks;this.second=second;this.minute=minute;this.hour=hour;this.day=day;this._cachedUnixTime=null},subtractDate:function(aDate){var unixTime=this.toUnixTime()+this.utcOffset(),other=aDate.toUnixTime()+aDate.utcOffset();return ICAL.Duration.fromSeconds(unixTime-other)},subtractDateTz:function(aDate){var unixTime=this.toUnixTime(),other=aDate.toUnixTime();return ICAL.Duration.fromSeconds(unixTime-other)},compare:function(other){var a=this.toUnixTime(),b=other.toUnixTime();if(a>b)return 1;if(b>a)return-1;return 0},compareDateOnlyTz:function(other,tz){function cmp(attr){return ICAL.Time._cmp_attr(a,b,attr)}var a=this.convertToZone(tz),b=other.convertToZone(tz),rc=0;if(0!=(rc=cmp("year")))return rc;if(0!=(rc=cmp("month")))return rc;if(0!=(rc=cmp("day")))return rc;return rc},convertToZone:function(zone){var copy=this.clone(),zone_equals=this.zone.tzid==zone.tzid;if(!this.isDate&&!zone_equals){ICAL.Timezone.convert_time(copy,this.zone,zone)}copy.zone=zone;return copy},utcOffset:function(){if(this.zone==ICAL.Timezone.localTimezone||this.zone==ICAL.Timezone.utcTimezone){return 0}else{return this.zone.utcOffset(this)}},toICALString:function toICALString(){var string=this.toString();if(10<string.length){return ICAL.design.icalendar.value["date-time"].toICAL(string)}else{return ICAL.design.icalendar.value.date.toICAL(string)}},toString:function(){var result=this.year+"-"+ICAL.helpers.pad2(this.month)+"-"+ICAL.helpers.pad2(this.day);if(!this.isDate){result+="T"+ICAL.helpers.pad2(this.hour)+":"+ICAL.helpers.pad2(this.minute)+":"+ICAL.helpers.pad2(this.second);if(this.zone===ICAL.Timezone.utcTimezone){result+="Z"}}return result},toJSDate:function(){if(this.zone==ICAL.Timezone.localTimezone){if(this.isDate){return new Date(this.year,this.month-1,this.day)}else{return new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0)}}else{return new Date(1e3*this.toUnixTime())}},_normalize:function(){this._time.isDate;if(this._time.isDate){this._time.hour=0;this._time.minute=0;this._time.second=0}this.adjust(0,0,0,0);return this},adjust:function(aExtraDays,aExtraHours,aExtraMinutes,aExtraSeconds,aTime){var minutesOverflow,hoursOverflow,daysOverflow=0,yearsOverflow=0,second,minute,hour,day,daysInMonth,time=aTime||this._time;if(!time.isDate){second=time.second+aExtraSeconds;time.second=second%60;minutesOverflow=ICAL.helpers.trunc(second/60);if(0>time.second){time.second+=60;minutesOverflow--}minute=time.minute+aExtraMinutes+minutesOverflow;time.minute=minute%60;hoursOverflow=ICAL.helpers.trunc(minute/60);if(0>time.minute){time.minute+=60;hoursOverflow--}hour=time.hour+aExtraHours+hoursOverflow;time.hour=hour%24;daysOverflow=ICAL.helpers.trunc(hour/24);if(0>time.hour){time.hour+=24;daysOverflow--}}if(12<time.month){yearsOverflow=ICAL.helpers.trunc((time.month-1)/12)}else if(1>time.month){yearsOverflow=ICAL.helpers.trunc(time.month/12)-1}time.year+=yearsOverflow;time.month-=12*yearsOverflow;day=time.day+aExtraDays+daysOverflow;if(0<day){for(;;){daysInMonth=ICAL.Time.daysInMonth(time.month,time.year);if(day<=daysInMonth){break}time.month++;if(12<time.month){time.year++;time.month=1}day-=daysInMonth}}else{while(0>=day){if(1==time.month){time.year--;time.month=12}else{time.month--}day+=ICAL.Time.daysInMonth(time.month,time.year)}}time.day=day;this._cachedUnixTime=null;return this},fromUnixTime:function(seconds){this.zone=ICAL.Timezone.utcTimezone;var epoch=ICAL.Time.epochTime.clone();epoch.adjust(0,0,0,seconds);this.year=epoch.year;this.month=epoch.month;this.day=epoch.day;this.hour=epoch.hour;this.minute=epoch.minute;this.second=Math.floor(epoch.second);this._cachedUnixTime=null},toUnixTime:function(){if(null!==this._cachedUnixTime){return this._cachedUnixTime}var offset=this.utcOffset(),ms=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-offset);this._cachedUnixTime=ms/1e3;return this._cachedUnixTime},toJSON:function toJSON(){var copy=["year","month","day","hour","minute","second","isDate"],result=Object.create(null),i=0,len=copy.length,prop;for(;i<len;i++){prop=copy[i];result[prop]=this[prop]}if(this.zone){result.timezone=this.zone.tzid}return result}};(function(){function defineAttr(attr){Object.defineProperty(ICAL.Time.prototype,attr,{get:function(){if(this._pendingNormalization){this._normalize();this._pendingNormalization=!1}return this._time[attr]},set:function(val){this._cachedUnixTime=null;this._pendingNormalization=!0;this._time[attr]=val;return val}})}if("defineProperty"in Object){defineAttr("year");defineAttr("month");defineAttr("day");defineAttr("hour");defineAttr("minute");defineAttr("second");defineAttr("isDate")}})();ICAL.Time.daysInMonth=function(month,year){var days=30;if(1>month||12<month)return days;days=[0,31,28,31,30,31,30,31,31,30,31,30,31][month];if(2==month){days+=ICAL.Time.isLeapYear(year)}return days};ICAL.Time.isLeapYear=function(year){if(1752>=year){return 0==year%4}else{return 0==year%4&&0!=year%100||0==year%400}};ICAL.Time.fromDayOfYear=function(aDayOfYear,aYear){var year=aYear,doy=aDayOfYear,tt=new ICAL.Time;tt.auto_normalize=!1;var is_leap=ICAL.Time.isLeapYear(year)?1:0;if(1>doy){year--;is_leap=ICAL.Time.isLeapYear(year)?1:0;doy+=ICAL.Time.daysInYearPassedMonth[is_leap][12];return ICAL.Time.fromDayOfYear(doy,year)}else if(doy>ICAL.Time.daysInYearPassedMonth[is_leap][12]){is_leap=ICAL.Time.isLeapYear(year)?1:0;doy-=ICAL.Time.daysInYearPassedMonth[is_leap][12];year++;return ICAL.Time.fromDayOfYear(doy,year)}tt.year=year;tt.isDate=!0;for(var month=11;0<=month;month--){if(doy>ICAL.Time.daysInYearPassedMonth[is_leap][month]){tt.month=month+1;tt.day=doy-ICAL.Time.daysInYearPassedMonth[is_leap][month];break}}tt.auto_normalize=!0;return tt};ICAL.Time.fromStringv2=function(str){return new ICAL.Time({year:parseInt(str.substr(0,4),10),month:parseInt(str.substr(5,2),10),day:parseInt(str.substr(8,2),10),isDate:!0})};ICAL.Time.fromDateString=function(aValue){return new ICAL.Time({year:ICAL.helpers.strictParseInt(aValue.substr(0,4)),month:ICAL.helpers.strictParseInt(aValue.substr(5,2)),day:ICAL.helpers.strictParseInt(aValue.substr(8,2)),isDate:!0})};ICAL.Time.fromDateTimeString=function(aValue,prop){if(19>aValue.length){throw new Error("invalid date-time value: \""+aValue+"\"")}var zone;if(aValue[19]&&"Z"===aValue[19]){zone="Z"}else if(prop){zone=prop.getParameter("tzid")}var time=new ICAL.Time({year:ICAL.helpers.strictParseInt(aValue.substr(0,4)),month:ICAL.helpers.strictParseInt(aValue.substr(5,2)),day:ICAL.helpers.strictParseInt(aValue.substr(8,2)),hour:ICAL.helpers.strictParseInt(aValue.substr(11,2)),minute:ICAL.helpers.strictParseInt(aValue.substr(14,2)),second:ICAL.helpers.strictParseInt(aValue.substr(17,2)),timezone:zone});return time};ICAL.Time.fromString=function(aValue){if(10<aValue.length){return ICAL.Time.fromDateTimeString(aValue)}else{return ICAL.Time.fromDateString(aValue)}};ICAL.Time.fromJSDate=function(aDate,useUTC){var tt=new ICAL.Time;return tt.fromJSDate(aDate,useUTC)};ICAL.Time.fromData=function(aData,aZone){var t=new ICAL.Time;return t.fromData(aData,aZone)};ICAL.Time.now=function(){return ICAL.Time.fromJSDate(new Date,!1)};ICAL.Time.weekOneStarts=function(aYear,aWeekStart){var t=ICAL.Time.fromData({year:aYear,month:1,day:1,isDate:!0}),dow=t.dayOfWeek(),wkst=aWeekStart||ICAL.Time.DEFAULT_WEEK_START;if(dow>ICAL.Time.THURSDAY){t.day+=7}if(wkst>ICAL.Time.THURSDAY){t.day-=7}t.day-=dow-wkst;return t};ICAL.Time.getDominicalLetter=function(yr){var LTRS="GFEDCBA",dom=(yr+(0|yr/4)+(0|yr/400)-(0|yr/100)-1)%7,isLeap=ICAL.Time.isLeapYear(yr);if(isLeap){return LTRS[(dom+6)%7]+LTRS[dom]}else{return LTRS[dom]}};ICAL.Time.epochTime=ICAL.Time.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:!1,timezone:"Z"});ICAL.Time._cmp_attr=function(a,b,attr){if(a[attr]>b[attr])return 1;if(a[attr]<b[attr])return-1;return 0};ICAL.Time.daysInYearPassedMonth=[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]];ICAL.Time.SUNDAY=1;ICAL.Time.MONDAY=2;ICAL.Time.TUESDAY=3;ICAL.Time.WEDNESDAY=4;ICAL.Time.THURSDAY=5;ICAL.Time.FRIDAY=6;ICAL.Time.SATURDAY=7;ICAL.Time.DEFAULT_WEEK_START=ICAL.Time.MONDAY})();(function(){ICAL.VCardTime=function(data,zone,icaltype){this.wrappedJSObject=this;var time=this._time=Object.create(null);time.year=null;time.month=null;time.day=null;time.hour=null;time.minute=null;time.second=null;this.icaltype=icaltype||"date-and-or-time";this.fromData(data,zone)};ICAL.helpers.inherits(ICAL.Time,ICAL.VCardTime,{icalclass:"vcardtime",icaltype:"date-and-or-time",zone:null,clone:function clone(){return new ICAL.VCardTime(this._time,this.zone,this.icaltype)},_normalize:function _normalize(){return this},utcOffset:function utcOffset(){if(babelHelpers.instanceof(this.zone,ICAL.UtcOffset)){return this.zone.toSeconds()}else{return ICAL.Time.prototype.utcOffset.apply(this,arguments)}},toICALString:function toICALString(){return ICAL.design.vcard.value[this.icaltype].toICAL(this.toString())},toString:function(){var p2=ICAL.helpers.pad2,y=this.year,m=this.month,d=this.day,h=this.hour,mm=this.minute,s=this.second,hasMonth=null!==m,hasDay=null!==d,hasHour=null!==h,hasMinute=null!==mm,hasSecond=null!==s,datepart=(null!==y?p2(y)+(hasMonth||hasDay?"-":""):hasMonth||hasDay?"--":"")+(hasMonth?p2(m):"")+(hasDay?"-"+p2(d):""),timepart=(hasHour?p2(h):"-")+(hasHour&&hasMinute?":":"")+(hasMinute?p2(mm):"")+(!hasHour&&!hasMinute?"-":"")+(hasMinute&&hasSecond?":":"")+(hasSecond?p2(s):""),zone;if(this.zone===ICAL.Timezone.utcTimezone){zone="Z"}else if(babelHelpers.instanceof(this.zone,ICAL.UtcOffset)){zone=this.zone.toString()}else if(this.zone===ICAL.Timezone.localTimezone){zone=""}else if(babelHelpers.instanceof(this.zone,ICAL.Timezone)){var offset=ICAL.UtcOffset.fromSeconds(this.zone.utcOffset(this));zone=offset.toString()}else{zone=""}switch(this.icaltype){case"time":return timepart+zone;case"date-and-or-time":case"date-time":return datepart+("--"==timepart?"":"T"+timepart+zone);case"date":return datepart;}return null}});ICAL.VCardTime.fromDateAndOrTimeString=function(aValue,aIcalType){function part(v,s,e){return v?ICAL.helpers.strictParseInt(v.substr(s,e)):null}var parts=aValue.split("T"),dt=parts[0],tmz=parts[1],splitzone=tmz?ICAL.design.vcard.value.time._splitZone(tmz):[],zone=splitzone[0],tm=splitzone[1],stoi=ICAL.helpers.strictParseInt,dtlen=dt?dt.length:0,tmlen=tm?tm.length:0,hasDashDate=dt&&"-"==dt[0]&&"-"==dt[1],hasDashTime=tm&&"-"==tm[0],o={year:hasDashDate?null:part(dt,0,4),month:hasDashDate&&(4==dtlen||7==dtlen)?part(dt,2,2):7==dtlen?part(dt,5,2):10==dtlen?part(dt,5,2):null,day:5==dtlen?part(dt,3,2):7==dtlen&&hasDashDate?part(dt,5,2):10==dtlen?part(dt,8,2):null,hour:hasDashTime?null:part(tm,0,2),minute:hasDashTime&&3==tmlen?part(tm,1,2):4<tmlen?hasDashTime?part(tm,1,2):part(tm,3,2):null,second:4==tmlen?part(tm,2,2):6==tmlen?part(tm,4,2):8==tmlen?part(tm,6,2):null};if("Z"==zone){zone=ICAL.Timezone.utcTimezone}else if(zone&&":"==zone[3]){zone=ICAL.UtcOffset.fromString(zone)}else{zone=null}return new ICAL.VCardTime(o,zone,aIcalType)}})();(function(){var DOW_MAP={SU:ICAL.Time.SUNDAY,MO:ICAL.Time.MONDAY,TU:ICAL.Time.TUESDAY,WE:ICAL.Time.WEDNESDAY,TH:ICAL.Time.THURSDAY,FR:ICAL.Time.FRIDAY,SA:ICAL.Time.SATURDAY},REVERSE_DOW_MAP={};for(var key in DOW_MAP){if(DOW_MAP.hasOwnProperty(key)){REVERSE_DOW_MAP[DOW_MAP[key]]=key}}ICAL.Recur=function(data){this.wrappedJSObject=this;this.parts={};if(data&&"object"===babelHelpers.typeof(data)){this.fromData(data)}};ICAL.Recur.prototype={parts:null,interval:1,wkst:ICAL.Time.MONDAY,until:null,count:null,freq:null,icalclass:"icalrecur",icaltype:"recur",iterator:function iterator(aStart){return new ICAL.RecurIterator({rule:this,dtstart:aStart})},clone:function(){return new ICAL.Recur(this.toJSON())},isFinite:function(){return!!(this.count||this.until)},isByCount:function(){return!!(this.count&&!this.until)},addComponent:function(aType,aValue){var ucname=aType.toUpperCase();if(ucname in this.parts){this.parts[ucname].push(aValue)}else{this.parts[ucname]=[aValue]}},setComponent:function(aType,aValues){this.parts[aType.toUpperCase()]=aValues.slice()},getComponent:function(aType){var ucname=aType.toUpperCase();return ucname in this.parts?this.parts[ucname].slice():[]},getNextOccurrence:function(aStartTime,aRecurrenceId){var iter=this.iterator(aStartTime),next;do{next=iter.next()}while(next&&0>=next.compare(aRecurrenceId));if(next&&aRecurrenceId.zone){next.zone=aRecurrenceId.zone}return next},fromData:function fromData(data){for(var key in data){var uckey=key.toUpperCase();if(uckey in partDesign){if(Array.isArray(data[key])){this.parts[uckey]=data[key]}else{this.parts[uckey]=[data[key]]}}else{this[key]=data[key]}}if(this.wkst&&"number"!=typeof this.wkst){this.wkst=ICAL.Recur.icalDayToNumericDay(this.wkst)}if(this.until&&!babelHelpers.instanceof(this.until,ICAL.Time)){this.until=ICAL.Time.fromString(this.until)}},toJSON:function toJSON(){var res=Object.create(null);res.freq=this.freq;if(this.count){res.count=this.count}if(1<this.interval){res.interval=this.interval}for(var k in this.parts){if(!this.parts.hasOwnProperty(k)){continue}var kparts=this.parts[k];if(Array.isArray(kparts)&&1==kparts.length){res[k.toLowerCase()]=kparts[0]}else{res[k.toLowerCase()]=ICAL.helpers.clone(this.parts[k])}}if(this.until){res.until=this.until.toString()}if("wkst"in this&&this.wkst!==ICAL.Time.DEFAULT_WEEK_START){res.wkst=ICAL.Recur.numericDayToIcalDay(this.wkst)}return res},toString:function(){var str="FREQ="+this.freq;if(this.count){str+=";COUNT="+this.count}if(1<this.interval){str+=";INTERVAL="+this.interval}for(var k in this.parts){if(this.parts.hasOwnProperty(k)){str+=";"+k+"="+this.parts[k]}}if(this.until){str+=";UNTIL="+this.until.toString()}if("wkst"in this&&this.wkst!==ICAL.Time.DEFAULT_WEEK_START){str+=";WKST="+ICAL.Recur.numericDayToIcalDay(this.wkst)}return str}};function parseNumericValue(type,min,max,value){var result=value;if("+"===value[0]){result=value.substr(1)}result=ICAL.helpers.strictParseInt(result);if(min!==void 0&&value<min){throw new Error(type+": invalid value \""+value+"\" must be > "+min)}if(max!==void 0&&value>max){throw new Error(type+": invalid value \""+value+"\" must be < "+min)}return result}ICAL.Recur.icalDayToNumericDay=function(string){return DOW_MAP[string]};ICAL.Recur.numericDayToIcalDay=function(num){return REVERSE_DOW_MAP[num]};var VALID_DAY_NAMES=/^(SU|MO|TU|WE|TH|FR|SA)$/,VALID_BYDAY_PART=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/,ALLOWED_FREQ=["SECONDLY","MINUTELY","HOURLY","DAILY","WEEKLY","MONTHLY","YEARLY"],optionDesign={FREQ:function FREQ(value,dict){if(-1!==ALLOWED_FREQ.indexOf(value)){dict.freq=value}else{throw new Error("invalid frequency \""+value+"\" expected: \""+ALLOWED_FREQ.join(", ")+"\"")}},COUNT:function COUNT(value,dict){dict.count=ICAL.helpers.strictParseInt(value)},INTERVAL:function INTERVAL(value,dict){dict.interval=ICAL.helpers.strictParseInt(value);if(1>dict.interval){dict.interval=1}},UNTIL:function UNTIL(value,dict,fmtIcal){if(fmtIcal){if(10<value.length){dict.until=ICAL.design.icalendar.value["date-time"].fromICAL(value)}else{dict.until=ICAL.design.icalendar.value.date.fromICAL(value)}}else{dict.until=ICAL.Time.fromString(value)}},WKST:function WKST(value,dict){if(VALID_DAY_NAMES.test(value)){dict.wkst=ICAL.Recur.icalDayToNumericDay(value)}else{throw new Error("invalid WKST value \""+value+"\"")}}},partDesign={BYSECOND:parseNumericValue.bind(this,"BYSECOND",0,60),BYMINUTE:parseNumericValue.bind(this,"BYMINUTE",0,59),BYHOUR:parseNumericValue.bind(this,"BYHOUR",0,23),BYDAY:function BYDAY(value){if(VALID_BYDAY_PART.test(value)){return value}else{throw new Error("invalid BYDAY value \""+value+"\"")}},BYMONTHDAY:parseNumericValue.bind(this,"BYMONTHDAY",-31,31),BYYEARDAY:parseNumericValue.bind(this,"BYYEARDAY",-366,366),BYWEEKNO:parseNumericValue.bind(this,"BYWEEKNO",-53,53),BYMONTH:parseNumericValue.bind(this,"BYMONTH",0,12),BYSETPOS:parseNumericValue.bind(this,"BYSETPOS",-366,366)};ICAL.Recur.fromString=function(string){var data=ICAL.Recur._stringToData(string,!1);return new ICAL.Recur(data)};ICAL.Recur.fromData=function(aData){return new ICAL.Recur(aData)};ICAL.Recur._stringToData=function(string,fmtIcal){for(var dict=Object.create(null),values=string.split(";"),len=values.length,i=0;i<len;i++){var parts=values[i].split("="),ucname=parts[0].toUpperCase(),lcname=parts[0].toLowerCase(),name=fmtIcal?lcname:ucname,value=parts[1];if(ucname in partDesign){var partArr=value.split(","),partArrIdx=0,partArrLen=partArr.length;for(;partArrIdx<partArrLen;partArrIdx++){partArr[partArrIdx]=partDesign[ucname](partArr[partArrIdx])}dict[name]=1==partArr.length?partArr[0]:partArr}else if(ucname in optionDesign){optionDesign[ucname](value,dict,fmtIcal)}else{dict[lcname]=value}}return dict}})();ICAL.RecurIterator=function(){function icalrecur_iterator(options){this.fromData(options)}icalrecur_iterator.prototype={completed:!1,rule:null,dtstart:null,last:null,occurrence_number:0,by_indices:null,initialized:!1,by_data:null,days:null,days_index:0,fromData:function fromData(options){this.rule=ICAL.helpers.formatClassType(options.rule,ICAL.Recur);if(!this.rule){throw new Error("iterator requires a (ICAL.Recur) rule")}this.dtstart=ICAL.helpers.formatClassType(options.dtstart,ICAL.Time);if(!this.dtstart){throw new Error("iterator requires a (ICAL.Time) dtstart")}if(options.by_data){this.by_data=options.by_data}else{this.by_data=ICAL.helpers.clone(this.rule.parts,!0)}if(options.occurrence_number)this.occurrence_number=options.occurrence_number;this.days=options.days||[];if(options.last){this.last=ICAL.helpers.formatClassType(options.last,ICAL.Time)}this.by_indices=options.by_indices;if(!this.by_indices){this.by_indices={BYSECOND:0,BYMINUTE:0,BYHOUR:0,BYDAY:0,BYMONTH:0,BYWEEKNO:0,BYMONTHDAY:0}}this.initialized=options.initialized||!1;if(!this.initialized){this.init()}},init:function(){this.initialized=!0;this.last=this.dtstart.clone();var parts=this.by_data;if("BYDAY"in parts){this.sort_byday_rules(parts.BYDAY,this.rule.wkst)}if("BYYEARDAY"in parts){if("BYMONTH"in parts||"BYWEEKNO"in parts||"BYMONTHDAY"in parts||"BYDAY"in parts){throw new Error("Invalid BYYEARDAY rule")}}if("BYWEEKNO"in parts&&"BYMONTHDAY"in parts){throw new Error("BYWEEKNO does not fit to BYMONTHDAY")}if("MONTHLY"==this.rule.freq&&("BYYEARDAY"in parts||"BYWEEKNO"in parts)){throw new Error("For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear")}if("WEEKLY"==this.rule.freq&&("BYYEARDAY"in parts||"BYMONTHDAY"in parts)){throw new Error("For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear")}if("YEARLY"!=this.rule.freq&&"BYYEARDAY"in parts){throw new Error("BYYEARDAY may only appear in YEARLY rules")}this.last.second=this.setup_defaults("BYSECOND","SECONDLY",this.dtstart.second);this.last.minute=this.setup_defaults("BYMINUTE","MINUTELY",this.dtstart.minute);this.last.hour=this.setup_defaults("BYHOUR","HOURLY",this.dtstart.hour);this.last.day=this.setup_defaults("BYMONTHDAY","DAILY",this.dtstart.day);this.last.month=this.setup_defaults("BYMONTH","MONTHLY",this.dtstart.month);if("WEEKLY"==this.rule.freq){if("BYDAY"in parts){var bydayParts=this.ruleDayOfWeek(parts.BYDAY[0]),pos=bydayParts[0],dow=bydayParts[1],wkdy=dow-this.last.dayOfWeek();if(this.last.dayOfWeek()<dow&&0<=wkdy||0>wkdy){this.last.day+=wkdy}}else{var dayName=ICAL.Recur.numericDayToIcalDay(this.dtstart.dayOfWeek());parts.BYDAY=[dayName]}}if("YEARLY"==this.rule.freq){for(;;){this.expand_year_days(this.last.year);if(0<this.days.length){break}this.increment_year(this.rule.interval)}this._nextByYearDay()}if("MONTHLY"==this.rule.freq&&this.has_by_data("BYDAY")){var tempLast=null,initLast=this.last.clone(),daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);for(var i in this.by_data.BYDAY){if(!this.by_data.BYDAY.hasOwnProperty(i)){continue}this.last=initLast.clone();var bydayParts=this.ruleDayOfWeek(this.by_data.BYDAY[i]),pos=bydayParts[0],dow=bydayParts[1],dayOfMonth=this.last.nthWeekDay(dow,pos);if(6<=pos||-6>=pos){throw new Error("Malformed values in BYDAY part")}if(dayOfMonth>daysInMonth||0>=dayOfMonth){if(tempLast&&tempLast.month==initLast.month){continue}while(dayOfMonth>daysInMonth||0>=dayOfMonth){this.increment_month();daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);dayOfMonth=this.last.nthWeekDay(dow,pos)}}this.last.day=dayOfMonth;if(!tempLast||0>this.last.compare(tempLast)){tempLast=this.last.clone()}}this.last=tempLast.clone();if(this.has_by_data("BYMONTHDAY")){this._byDayAndMonthDay(!0)}if(this.last.day>daysInMonth||0==this.last.day){throw new Error("Malformed values in BYDAY part")}}else if(this.has_by_data("BYMONTHDAY")){if(0>this.last.day){var daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);this.last.day=daysInMonth+this.last.day+1}}},next:function(){var before=this.last?this.last.clone():null;if(this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&0<this.last.compare(this.rule.until)){this.completed=!0;return null}if(0==this.occurrence_number&&0<=this.last.compare(this.dtstart)){this.occurrence_number++;return this.last}var valid;do{valid=1;switch(this.rule.freq){case"SECONDLY":this.next_second();break;case"MINUTELY":this.next_minute();break;case"HOURLY":this.next_hour();break;case"DAILY":this.next_day();break;case"WEEKLY":this.next_week();break;case"MONTHLY":valid=this.next_month();break;case"YEARLY":this.next_year();break;default:return null;}}while(!this.check_contracting_rules()||0>this.last.compare(this.dtstart)||!valid);if(0==this.last.compare(before)){throw new Error("Same occurrence found twice, protecting "+"you from death by recursion")}if(this.rule.until&&0<this.last.compare(this.rule.until)){this.completed=!0;return null}else{this.occurrence_number++;return this.last}},next_second:function(){return this.next_generic("BYSECOND","SECONDLY","second","minute")},increment_second:function(inc){return this.increment_generic(inc,"second",60,"minute")},next_minute:function(){return this.next_generic("BYMINUTE","MINUTELY","minute","hour","next_second")},increment_minute:function(inc){return this.increment_generic(inc,"minute",60,"hour")},next_hour:function(){return this.next_generic("BYHOUR","HOURLY","hour","monthday","next_minute")},increment_hour:function(inc){this.increment_generic(inc,"hour",24,"monthday")},next_day:function(){var has_by_day="BYDAY"in this.by_data,this_freq="DAILY"==this.rule.freq;if(0==this.next_hour()){return 0}if(this_freq){this.increment_monthday(this.rule.interval)}else{this.increment_monthday(1)}return 0},next_week:function(){var end_of_data=0;if(0==this.next_weekday_by_week()){return end_of_data}if(this.has_by_data("BYWEEKNO")){++this.by_indices.BYWEEKNO;if(this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length){this.by_indices.BYWEEKNO=0;end_of_data=1}this.last.month=1;this.last.day=1;var week_no=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*week_no;if(end_of_data){this.increment_year(1)}}else{this.increment_monthday(7*this.rule.interval)}return end_of_data},normalizeByMonthDayRules:function normalizeByMonthDayRules(year,month,rules){var daysInMonth=ICAL.Time.daysInMonth(month,year),newRules=[],ruleIdx=0,len=rules.length,rule;for(;ruleIdx<len;ruleIdx++){rule=rules[ruleIdx];if(Math.abs(rule)>daysInMonth){continue}if(0>rule){rule=daysInMonth+(rule+1)}else if(0===rule){continue}if(-1===newRules.indexOf(rule)){newRules.push(rule)}}return newRules.sort(function(a,b){return a-b})},_byDayAndMonthDay:function _byDayAndMonthDay(isInit){var byMonthDay,byDay=this.by_data.BYDAY,date,dateIdx=0,dateLen,dayLen=byDay.length,dataIsValid=0,daysInMonth,self=this,lastDay=this.last.day;function initMonth(){daysInMonth=ICAL.Time.daysInMonth(self.last.month,self.last.year);byMonthDay=self.normalizeByMonthDayRules(self.last.year,self.last.month,self.by_data.BYMONTHDAY);dateLen=byMonthDay.length;while(byMonthDay[dateIdx]<=lastDay&&!(isInit&&byMonthDay[dateIdx]==lastDay)&&dateIdx<dateLen-1){dateIdx++}}function nextMonth(){lastDay=0;self.increment_month();dateIdx=0;initMonth()}initMonth();if(isInit){lastDay-=1}var monthsCounter=48;while(!dataIsValid&&monthsCounter){monthsCounter--;date=lastDay+1;if(date>daysInMonth){nextMonth();continue}var next=byMonthDay[dateIdx++];if(next>=date){lastDay=next}else{nextMonth();continue}for(var dayIdx=0;dayIdx<dayLen;dayIdx++){var parts=this.ruleDayOfWeek(byDay[dayIdx]),pos=parts[0],dow=parts[1];this.last.day=lastDay;if(this.last.isNthWeekDay(dow,pos)){dataIsValid=1;break}}if(!dataIsValid&&dateIdx===dateLen){nextMonth();continue}}if(0>=monthsCounter){throw new Error("Malformed values in BYDAY combined with BYMONTHDAY parts")}return dataIsValid},next_month:function(){var this_freq="MONTHLY"==this.rule.freq,data_valid=1;if(0==this.next_hour()){return data_valid}if(this.has_by_data("BYDAY")&&this.has_by_data("BYMONTHDAY")){data_valid=this._byDayAndMonthDay()}else if(this.has_by_data("BYDAY")){var daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year),setpos=0,setpos_total=0;if(this.has_by_data("BYSETPOS")){for(var last_day=this.last.day,day=1;day<=daysInMonth;day++){this.last.day=day;if(this.is_day_in_byday(this.last)){setpos_total++;if(day<=last_day){setpos++}}}this.last.day=last_day}data_valid=0;for(var day=this.last.day+1;day<=daysInMonth;day++){this.last.day=day;if(this.is_day_in_byday(this.last)){if(!this.has_by_data("BYSETPOS")||this.check_set_position(++setpos)||this.check_set_position(setpos-setpos_total-1)){data_valid=1;break}}}if(day>daysInMonth){this.last.day=1;this.increment_month();if(this.is_day_in_byday(this.last)){if(!this.has_by_data("BYSETPOS")||this.check_set_position(1)){data_valid=1}}else{data_valid=0}}}else if(this.has_by_data("BYMONTHDAY")){this.by_indices.BYMONTHDAY++;if(this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length){this.by_indices.BYMONTHDAY=0;this.increment_month()}var daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year),day=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];if(0>day){day=daysInMonth+day+1}if(day>daysInMonth){this.last.day=1;data_valid=this.is_day_in_byday(this.last)}else{this.last.day=day}}else{this.increment_month();var daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);if(this.by_data.BYMONTHDAY[0]>daysInMonth){data_valid=0}else{this.last.day=this.by_data.BYMONTHDAY[0]}}return data_valid},next_weekday_by_week:function(){var end_of_data=0;if(0==this.next_hour()){return end_of_data}if(!this.has_by_data("BYDAY")){return 1}for(;;){var tt=new ICAL.Time;this.by_indices.BYDAY++;if(this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length){this.by_indices.BYDAY=0;end_of_data=1}var coded_day=this.by_data.BYDAY[this.by_indices.BYDAY],parts=this.ruleDayOfWeek(coded_day),dow=parts[1];dow-=this.rule.wkst;if(0>dow){dow+=7}tt.year=this.last.year;tt.month=this.last.month;tt.day=this.last.day;var startOfWeek=tt.startDoyWeek(this.rule.wkst);if(1>dow+startOfWeek){if(!end_of_data){continue}}var next=ICAL.Time.fromDayOfYear(startOfWeek+dow,this.last.year);this.last.year=next.year;this.last.month=next.month;this.last.day=next.day;return end_of_data}},next_year:function(){if(0==this.next_hour()){return 0}if(++this.days_index==this.days.length){this.days_index=0;do{this.increment_year(this.rule.interval);this.expand_year_days(this.last.year)}while(0==this.days.length)}this._nextByYearDay();return 1},_nextByYearDay:function(){var doy=this.days[this.days_index],year=this.last.year;if(1>doy){doy+=1;year+=1}var next=ICAL.Time.fromDayOfYear(doy,year);this.last.day=next.day;this.last.month=next.month},ruleDayOfWeek:function(dow){var matches=dow.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(matches){var pos=parseInt(matches[1]||0,10);dow=ICAL.Recur.icalDayToNumericDay(matches[2]);return[pos,dow]}else{return[0,0]}},next_generic:function(aRuleType,aInterval,aDateAttr,aFollowingAttr,aPreviousIncr){var has_by_rule=aRuleType in this.by_data,this_freq=this.rule.freq==aInterval,end_of_data=0;if(aPreviousIncr&&0==this[aPreviousIncr]()){return end_of_data}if(has_by_rule){this.by_indices[aRuleType]++;var idx=this.by_indices[aRuleType],dta=this.by_data[aRuleType];if(this.by_indices[aRuleType]==dta.length){this.by_indices[aRuleType]=0;end_of_data=1}this.last[aDateAttr]=dta[this.by_indices[aRuleType]]}else if(this_freq){this["increment_"+aDateAttr](this.rule.interval)}if(has_by_rule&&end_of_data&&this_freq){this["increment_"+aFollowingAttr](1)}return end_of_data},increment_monthday:function(inc){for(var i=0,daysInMonth;i<inc;i++){daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);this.last.day++;if(this.last.day>daysInMonth){this.last.day-=daysInMonth;this.increment_month()}}},increment_month:function(){this.last.day=1;if(this.has_by_data("BYMONTH")){this.by_indices.BYMONTH++;if(this.by_indices.BYMONTH==this.by_data.BYMONTH.length){this.by_indices.BYMONTH=0;this.increment_year(1)}this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH]}else{if("MONTHLY"==this.rule.freq){this.last.month+=this.rule.interval}else{this.last.month++}this.last.month--;var years=ICAL.helpers.trunc(this.last.month/12);this.last.month%=12;this.last.month++;if(0!=years){this.increment_year(years)}}},increment_year:function(inc){this.last.year+=inc},increment_generic:function(inc,aDateAttr,aFactor,aNextIncrement){this.last[aDateAttr]+=inc;var nextunit=ICAL.helpers.trunc(this.last[aDateAttr]/aFactor);this.last[aDateAttr]%=aFactor;if(0!=nextunit){this["increment_"+aNextIncrement](nextunit)}},has_by_data:function(aRuleType){return aRuleType in this.rule.parts},expand_year_days:function(aYear){var t=new ICAL.Time;this.days=[];var parts={},rules=["BYDAY","BYWEEKNO","BYMONTHDAY","BYMONTH","BYYEARDAY"];for(var p in rules){if(rules.hasOwnProperty(p)){var part=rules[p];if(part in this.rule.parts){parts[part]=this.rule.parts[part]}}}if("BYMONTH"in parts&&"BYWEEKNO"in parts){var valid=1,validWeeks={};t.year=aYear;t.isDate=!0;for(var monthIdx=0,month;monthIdx<this.by_data.BYMONTH.length;monthIdx++){month=this.by_data.BYMONTH[monthIdx];t.month=month;t.day=1;var first_week=t.weekNumber(this.rule.wkst);t.day=ICAL.Time.daysInMonth(month,aYear);var last_week=t.weekNumber(this.rule.wkst);for(monthIdx=first_week;monthIdx<last_week;monthIdx++){validWeeks[monthIdx]=1}}for(var weekIdx=0,weekno;weekIdx<this.by_data.BYWEEKNO.length&&valid;weekIdx++){weekno=this.by_data.BYWEEKNO[weekIdx];if(52>weekno){valid&=validWeeks[weekIdx]}else{valid=0}}if(valid){delete parts.BYMONTH}else{delete parts.BYWEEKNO}}var partCount=Object.keys(parts).length;if(0==partCount){var t1=this.dtstart.clone();t1.year=this.last.year;this.days.push(t1.dayOfYear())}else if(1==partCount&&"BYMONTH"in parts){for(var monthkey in this.by_data.BYMONTH){if(!this.by_data.BYMONTH.hasOwnProperty(monthkey)){continue}var t2=this.dtstart.clone();t2.year=aYear;t2.month=this.by_data.BYMONTH[monthkey];t2.isDate=!0;this.days.push(t2.dayOfYear())}}else if(1==partCount&&"BYMONTHDAY"in parts){for(var monthdaykey in this.by_data.BYMONTHDAY){if(!this.by_data.BYMONTHDAY.hasOwnProperty(monthdaykey)){continue}var t3=this.dtstart.clone(),day_=this.by_data.BYMONTHDAY[monthdaykey];if(0>day_){var daysInMonth=ICAL.Time.daysInMonth(t3.month,aYear);day_=day_+daysInMonth+1}t3.day=day_;t3.year=aYear;t3.isDate=!0;this.days.push(t3.dayOfYear())}}else if(2==partCount&&"BYMONTHDAY"in parts&&"BYMONTH"in parts){for(var monthkey in this.by_data.BYMONTH){if(!this.by_data.BYMONTH.hasOwnProperty(monthkey)){continue}var month_=this.by_data.BYMONTH[monthkey],daysInMonth=ICAL.Time.daysInMonth(month_,aYear);for(var monthdaykey in this.by_data.BYMONTHDAY){if(!this.by_data.BYMONTHDAY.hasOwnProperty(monthdaykey)){continue}var day_=this.by_data.BYMONTHDAY[monthdaykey];if(0>day_){day_=day_+daysInMonth+1}t.day=day_;t.month=month_;t.year=aYear;t.isDate=!0;this.days.push(t.dayOfYear())}}}else if(1==partCount&&"BYWEEKNO"in parts){}else if(2==partCount&&"BYWEEKNO"in parts&&"BYMONTHDAY"in parts){}else if(1==partCount&&"BYDAY"in parts){this.days=this.days.concat(this.expand_by_day(aYear))}else if(2==partCount&&"BYDAY"in parts&&"BYMONTH"in parts){for(var monthkey in this.by_data.BYMONTH){if(!this.by_data.BYMONTH.hasOwnProperty(monthkey)){continue}var month=this.by_data.BYMONTH[monthkey],daysInMonth=ICAL.Time.daysInMonth(month,aYear);t.year=aYear;t.month=this.by_data.BYMONTH[monthkey];t.day=1;t.isDate=!0;var first_dow=t.dayOfWeek(),doy_offset=t.dayOfYear()-1;t.day=daysInMonth;var last_dow=t.dayOfWeek();if(this.has_by_data("BYSETPOS")){for(var by_month_day=[],day=1;day<=daysInMonth;day++){t.day=day;if(this.is_day_in_byday(t)){by_month_day.push(day)}}for(var spIndex=0;spIndex<by_month_day.length;spIndex++){if(this.check_set_position(spIndex+1)||this.check_set_position(spIndex-by_month_day.length)){this.days.push(doy_offset+by_month_day[spIndex])}}}else{for(var daycodedkey in this.by_data.BYDAY){if(!this.by_data.BYDAY.hasOwnProperty(daycodedkey)){continue}var coded_day=this.by_data.BYDAY[daycodedkey],bydayParts=this.ruleDayOfWeek(coded_day),pos=bydayParts[0],dow=bydayParts[1],month_day,first_matching_day=(dow+7-first_dow)%7+1,last_matching_day=daysInMonth-(last_dow+7-dow)%7;if(0==pos){for(var day=first_matching_day;day<=daysInMonth;day+=7){this.days.push(doy_offset+day)}}else if(0<pos){month_day=first_matching_day+7*(pos-1);if(month_day<=daysInMonth){this.days.push(doy_offset+month_day)}}else{month_day=last_matching_day+7*(pos+1);if(0<month_day){this.days.push(doy_offset+month_day)}}}}}this.days.sort(function(a,b){return a-b})}else if(2==partCount&&"BYDAY"in parts&&"BYMONTHDAY"in parts){var expandedDays=this.expand_by_day(aYear);for(var daykey in expandedDays){if(!expandedDays.hasOwnProperty(daykey)){continue}var day=expandedDays[daykey],tt=ICAL.Time.fromDayOfYear(day,aYear);if(0<=this.by_data.BYMONTHDAY.indexOf(tt.day)){this.days.push(day)}}}else if(3==partCount&&"BYDAY"in parts&&"BYMONTHDAY"in parts&&"BYMONTH"in parts){var expandedDays=this.expand_by_day(aYear);for(var daykey in expandedDays){if(!expandedDays.hasOwnProperty(daykey)){continue}var day=expandedDays[daykey],tt=ICAL.Time.fromDayOfYear(day,aYear);if(0<=this.by_data.BYMONTH.indexOf(tt.month)&&0<=this.by_data.BYMONTHDAY.indexOf(tt.day)){this.days.push(day)}}}else if(2==partCount&&"BYDAY"in parts&&"BYWEEKNO"in parts){var expandedDays=this.expand_by_day(aYear);for(var daykey in expandedDays){if(!expandedDays.hasOwnProperty(daykey)){continue}var day=expandedDays[daykey],tt=ICAL.Time.fromDayOfYear(day,aYear),weekno=tt.weekNumber(this.rule.wkst);if(this.by_data.BYWEEKNO.indexOf(weekno)){this.days.push(day)}}}else if(3==partCount&&"BYDAY"in parts&&"BYWEEKNO"in parts&&"BYMONTHDAY"in parts){}else if(1==partCount&&"BYYEARDAY"in parts){this.days=this.days.concat(this.by_data.BYYEARDAY)}else{this.days=[]}return 0},expand_by_day:function(aYear){var days_list=[],tmp=this.last.clone();tmp.year=aYear;tmp.month=1;tmp.day=1;tmp.isDate=!0;var start_dow=tmp.dayOfWeek();tmp.month=12;tmp.day=31;tmp.isDate=!0;var end_dow=tmp.dayOfWeek(),end_year_day=tmp.dayOfYear();for(var daykey in this.by_data.BYDAY){if(!this.by_data.BYDAY.hasOwnProperty(daykey)){continue}var day=this.by_data.BYDAY[daykey],parts=this.ruleDayOfWeek(day),pos=parts[0],dow=parts[1];if(0==pos){for(var doy=(dow+7-start_dow)%7+1;doy<=end_year_day;doy+=7){days_list.push(doy)}}else if(0<pos){var first;if(dow>=start_dow){first=dow-start_dow+1}else{first=dow-start_dow+8}days_list.push(first+7*(pos-1))}else{var last;pos=-pos;if(dow<=end_dow){last=end_year_day-end_dow+dow}else{last=end_year_day-end_dow+dow-7}days_list.push(last-7*(pos-1))}}return days_list},is_day_in_byday:function(tt){for(var daykey in this.by_data.BYDAY){if(!this.by_data.BYDAY.hasOwnProperty(daykey)){continue}var day=this.by_data.BYDAY[daykey],parts=this.ruleDayOfWeek(day),pos=parts[0],dow=parts[1],this_dow=tt.dayOfWeek();if(0==pos&&dow==this_dow||tt.nthWeekDay(dow,pos)==tt.day){return 1}}return 0},check_set_position:function(aPos){if(this.has_by_data("BYSETPOS")){var idx=this.by_data.BYSETPOS.indexOf(aPos);return-1!==idx}return!1},sort_byday_rules:function(aRules,aWeekStart){for(var i=0;i<aRules.length;i++){for(var j=0;j<i;j++){var one=this.ruleDayOfWeek(aRules[j])[1],two=this.ruleDayOfWeek(aRules[i])[1];one-=aWeekStart;two-=aWeekStart;if(0>one)one+=7;if(0>two)two+=7;if(one>two){var tmp=aRules[i];aRules[i]=aRules[j];aRules[j]=tmp}}}},check_contract_restriction:function(aRuleType,v){var indexMapValue=icalrecur_iterator._indexMap[aRuleType],ruleMapValue=icalrecur_iterator._expandMap[this.rule.freq][indexMapValue],pass=!1;if(aRuleType in this.by_data&&ruleMapValue==icalrecur_iterator.CONTRACT){var ruleType=this.by_data[aRuleType];for(var bydatakey in ruleType){if(ruleType.hasOwnProperty(bydatakey)){if(ruleType[bydatakey]==v){pass=!0;break}}}}else{pass=!0}return pass},check_contracting_rules:function(){var dow=this.last.dayOfWeek(),weekNo=this.last.weekNumber(this.rule.wkst),doy=this.last.dayOfYear();return this.check_contract_restriction("BYSECOND",this.last.second)&&this.check_contract_restriction("BYMINUTE",this.last.minute)&&this.check_contract_restriction("BYHOUR",this.last.hour)&&this.check_contract_restriction("BYDAY",ICAL.Recur.numericDayToIcalDay(dow))&&this.check_contract_restriction("BYWEEKNO",weekNo)&&this.check_contract_restriction("BYMONTHDAY",this.last.day)&&this.check_contract_restriction("BYMONTH",this.last.month)&&this.check_contract_restriction("BYYEARDAY",doy)},setup_defaults:function(aRuleType,req,deftime){var indexMapValue=icalrecur_iterator._indexMap[aRuleType],ruleMapValue=icalrecur_iterator._expandMap[this.rule.freq][indexMapValue];if(ruleMapValue!=icalrecur_iterator.CONTRACT){if(!(aRuleType in this.by_data)){this.by_data[aRuleType]=[deftime]}if(this.rule.freq!=req){return this.by_data[aRuleType][0]}}return deftime},toJSON:function toJSON(){var result=Object.create(null);result.initialized=this.initialized;result.rule=this.rule.toJSON();result.dtstart=this.dtstart.toJSON();result.by_data=this.by_data;result.days=this.days;result.last=this.last.toJSON();result.by_indices=this.by_indices;result.occurrence_number=this.occurrence_number;return result}};icalrecur_iterator._indexMap={BYSECOND:0,BYMINUTE:1,BYHOUR:2,BYDAY:3,BYMONTHDAY:4,BYYEARDAY:5,BYWEEKNO:6,BYMONTH:7,BYSETPOS:8};icalrecur_iterator._expandMap={SECONDLY:[1,1,1,1,1,1,1,1],MINUTELY:[2,1,1,1,1,1,1,1],HOURLY:[2,2,1,1,1,1,1,1],DAILY:[2,2,2,1,1,1,1,1],WEEKLY:[2,2,2,2,3,3,1,1],MONTHLY:[2,2,2,2,2,3,3,1],YEARLY:[2,2,2,2,2,2,2,2]};icalrecur_iterator.UNKNOWN=0;icalrecur_iterator.CONTRACT=1;icalrecur_iterator.EXPAND=2;icalrecur_iterator.ILLEGAL=3;return icalrecur_iterator}();ICAL.RecurExpansion=function(){function formatTime(item){return ICAL.helpers.formatClassType(item,ICAL.Time)}function compareTime(a,b){return a.compare(b)}function isRecurringComponent(comp){return comp.hasProperty("rdate")||comp.hasProperty("rrule")||comp.hasProperty("recurrence-id")}function RecurExpansion(options){this.ruleDates=[];this.exDates=[];this.fromData(options)}RecurExpansion.prototype={complete:!1,ruleIterators:null,ruleDates:null,exDates:null,ruleDateInc:0,exDateInc:0,exDate:null,ruleDate:null,dtstart:null,last:null,fromData:function fromData(options){var start=ICAL.helpers.formatClassType(options.dtstart,ICAL.Time);if(!start){throw new Error(".dtstart (ICAL.Time) must be given")}else{this.dtstart=start}if(options.component){this._init(options.component)}else{this.last=formatTime(options.last)||start.clone();if(!options.ruleIterators){throw new Error(".ruleIterators or .component must be given")}this.ruleIterators=options.ruleIterators.map(function(item){return ICAL.helpers.formatClassType(item,ICAL.RecurIterator)});this.ruleDateInc=options.ruleDateInc;this.exDateInc=options.exDateInc;if(options.ruleDates){this.ruleDates=options.ruleDates.map(formatTime);this.ruleDate=this.ruleDates[this.ruleDateInc]}if(options.exDates){this.exDates=options.exDates.map(formatTime);this.exDate=this.exDates[this.exDateInc]}if("undefined"!==typeof options.complete){this.complete=options.complete}}},next:function(){var iter,next,compare,currentTry=0;while(!0){if(currentTry++>500){throw new Error("max tries have occured, rule may be impossible to forfill.")}next=this.ruleDate;iter=this._nextRecurrenceIter(this.last);if(!next&&!iter){this.complete=!0;break}if(!next||iter&&0<next.compare(iter.last)){next=iter.last.clone();iter.next()}if(this.ruleDate===next){this._nextRuleDay()}this.last=next;if(this.exDate){compare=this.exDate.compare(this.last);if(0>compare){this._nextExDay()}if(0===compare){this._nextExDay();continue}}return this.last}},toJSON:function(){function toJSON(item){return item.toJSON()}var result=Object.create(null);result.ruleIterators=this.ruleIterators.map(toJSON);if(this.ruleDates){result.ruleDates=this.ruleDates.map(toJSON)}if(this.exDates){result.exDates=this.exDates.map(toJSON)}result.ruleDateInc=this.ruleDateInc;result.exDateInc=this.exDateInc;result.last=this.last.toJSON();result.dtstart=this.dtstart.toJSON();result.complete=this.complete;return result},_extractDates:function _extractDates(component,propertyName){function handleProp(prop){idx=ICAL.helpers.binsearchInsert(result,prop,compareTime);result.splice(idx,0,prop)}var result=[],props=component.getAllProperties(propertyName),len=props.length,i=0,idx;for(;i<len;i++){props[i].getValues().forEach(handleProp)}return result},_init:function _init(component){this.ruleIterators=[];this.last=this.dtstart.clone();if(!isRecurringComponent(component)){this.ruleDate=this.last.clone();this.complete=!0;return}if(component.hasProperty("rdate")){this.ruleDates=this._extractDates(component,"rdate");if(this.ruleDates[0]&&0>this.ruleDates[0].compare(this.dtstart)){this.ruleDateInc=0;this.last=this.ruleDates[0].clone()}else{this.ruleDateInc=ICAL.helpers.binsearchInsert(this.ruleDates,this.last,compareTime)}this.ruleDate=this.ruleDates[this.ruleDateInc]}if(component.hasProperty("rrule")){var rules=component.getAllProperties("rrule"),i=0,len=rules.length,rule,iter;for(;i<len;i++){rule=rules[i].getFirstValue();iter=rule.iterator(this.dtstart);this.ruleIterators.push(iter);iter.next()}}if(component.hasProperty("exdate")){this.exDates=this._extractDates(component,"exdate");this.exDateInc=ICAL.helpers.binsearchInsert(this.exDates,this.last,compareTime);this.exDate=this.exDates[this.exDateInc]}},_nextExDay:function _nextExDay(){this.exDate=this.exDates[++this.exDateInc]},_nextRuleDay:function _nextRuleDay(){this.ruleDate=this.ruleDates[++this.ruleDateInc]},_nextRecurrenceIter:function _nextRecurrenceIter(){var iters=this.ruleIterators;if(0===iters.length){return null}var len=iters.length,iter,iterTime,iterIdx=0,chosenIter;for(;iterIdx<len;iterIdx++){iter=iters[iterIdx];iterTime=iter.last;if(iter.completed){len--;if(0!==iterIdx){iterIdx--}iters.splice(iterIdx,1);continue}if(!chosenIter||0<chosenIter.last.compare(iterTime)){chosenIter=iter}}return chosenIter}};return RecurExpansion}();ICAL.Event=function(){function Event(component,options){if(!babelHelpers.instanceof(component,ICAL.Component)){options=component;component=null}if(component){this.component=component}else{this.component=new ICAL.Component("vevent")}this._rangeExceptionCache=Object.create(null);this.exceptions=Object.create(null);this.rangeExceptions=[];if(options&&options.strictExceptions){this.strictExceptions=options.strictExceptions}if(options&&options.exceptions){options.exceptions.forEach(this.relateException,this)}}Event.prototype={THISANDFUTURE:"THISANDFUTURE",exceptions:null,strictExceptions:!1,relateException:function relateException(obj){if(this.isRecurrenceException()){throw new Error("cannot relate exception to exceptions")}if(babelHelpers.instanceof(obj,ICAL.Component)){obj=new ICAL.Event(obj)}if(this.strictExceptions&&obj.uid!==this.uid){throw new Error("attempted to relate unrelated exception")}var id=obj.recurrenceId.toString();this.exceptions[id]=obj;if(obj.modifiesFuture()){var item=[obj.recurrenceId.toUnixTime(),id],idx=ICAL.helpers.binsearchInsert(this.rangeExceptions,item,compareRangeException);this.rangeExceptions.splice(idx,0,item)}},modifiesFuture:function modifiesFuture(){var range=this.component.getFirstPropertyValue("range");return range===this.THISANDFUTURE},findRangeException:function findRangeException(time){if(!this.rangeExceptions.length){return null}var utc=time.toUnixTime(),idx=ICAL.helpers.binsearchInsert(this.rangeExceptions,[utc],compareRangeException);idx-=1;if(0>idx){return null}var rangeItem=this.rangeExceptions[idx];if(utc<rangeItem[0]){return null}return rangeItem[1]},getOccurrenceDetails:function getOccurrenceDetails(occurrence){var id=occurrence.toString(),utcId=occurrence.convertToZone(ICAL.Timezone.utcTimezone).toString(),item,result={recurrenceId:occurrence};if(id in this.exceptions){item=result.item=this.exceptions[id];result.startDate=item.startDate;result.endDate=item.endDate;result.item=item}else if(utcId in this.exceptions){item=this.exceptions[utcId];result.startDate=item.startDate;result.endDate=item.endDate;result.item=item}else{var rangeExceptionId=this.findRangeException(occurrence),end;if(rangeExceptionId){var exception=this.exceptions[rangeExceptionId];result.item=exception;var startDiff=this._rangeExceptionCache[rangeExceptionId];if(!startDiff){var original=exception.recurrenceId.clone(),newStart=exception.startDate.clone();original.zone=newStart.zone;startDiff=newStart.subtractDate(original);this._rangeExceptionCache[rangeExceptionId]=startDiff}var start=occurrence.clone();start.zone=exception.startDate.zone;start.addDuration(startDiff);end=start.clone();end.addDuration(exception.duration);result.startDate=start;result.endDate=end}else{end=occurrence.clone();end.addDuration(this.duration);result.endDate=end;result.startDate=occurrence;result.item=this}}return result},iterator:function iterator(startTime){return new ICAL.RecurExpansion({component:this.component,dtstart:startTime||this.startDate})},isRecurring:function isRecurring(){var comp=this.component;return comp.hasProperty("rrule")||comp.hasProperty("rdate")},isRecurrenceException:function isRecurrenceException(){return this.component.hasProperty("recurrence-id")},getRecurrenceTypes:function getRecurrenceTypes(){var rules=this.component.getAllProperties("rrule"),i=0,len=rules.length,result=Object.create(null);for(;i<len;i++){var value=rules[i].getFirstValue();result[value.freq]=!0}return result},get uid(){return this._firstProp("uid")},set uid(value){this._setProp("uid",value)},get startDate(){return this._firstProp("dtstart")},set startDate(value){this._setTime("dtstart",value)},get endDate(){var endDate=this._firstProp("dtend");if(!endDate){var duration=this._firstProp("duration");endDate=this.startDate.clone();if(duration){endDate.addDuration(duration)}else if(endDate.isDate){endDate.day+=1}}return endDate},set endDate(value){this._setTime("dtend",value)},get duration(){var duration=this._firstProp("duration");if(!duration){return this.endDate.subtractDate(this.startDate)}return duration},get location(){return this._firstProp("location")},set location(value){return this._setProp("location",value)},get attendees(){return this.component.getAllProperties("attendee")},get summary(){return this._firstProp("summary")},set summary(value){this._setProp("summary",value)},get description(){return this._firstProp("description")},set description(value){this._setProp("description",value)},get organizer(){return this._firstProp("organizer")},set organizer(value){this._setProp("organizer",value)},get sequence(){return this._firstProp("sequence")},set sequence(value){this._setProp("sequence",value)},get recurrenceId(){return this._firstProp("recurrence-id")},set recurrenceId(value){this._setProp("recurrence-id",value)},_setTime:function _setTime(propName,time){var prop=this.component.getFirstProperty(propName);if(!prop){prop=new ICAL.Property(propName);this.component.addProperty(prop)}if(time.zone===ICAL.Timezone.localTimezone||time.zone===ICAL.Timezone.utcTimezone){prop.removeParameter("tzid")}else{prop.setParameter("tzid",time.zone.tzid)}prop.setValue(time)},_setProp:function _setProp(name,value){this.component.updatePropertyWithValue(name,value)},_firstProp:function _firstProp(name){return this.component.getFirstPropertyValue(name)},toString:function toString(){return this.component.toString()}};function compareRangeException(a,b){if(a[0]>b[0])return 1;if(b[0]>a[0])return-1;return 0}return Event}();ICAL.ComponentParser=function(){function ComponentParser(options){if("undefined"===typeof options){options={}}for(var key in options){if(options.hasOwnProperty(key)){this[key]=options[key]}}}ComponentParser.prototype={parseEvent:!0,parseTimezone:!0,oncomplete:function oncomplete(){},onerror:function onerror(){},ontimezone:function ontimezone(){},onevent:function onevent(){},process:function process(ical){if("string"===typeof ical){ical=ICAL.parse(ical)}if(!babelHelpers.instanceof(ical,ICAL.Component)){ical=new ICAL.Component(ical)}var components=ical.getAllSubcomponents(),i=0,len=components.length,component;for(;i<len;i++){component=components[i];switch(component.name){case"vtimezone":if(this.parseTimezone){var tzid=component.getFirstPropertyValue("tzid");if(tzid){this.ontimezone(new ICAL.Timezone({tzid:tzid,component:component}))}}break;case"vevent":if(this.parseEvent){this.onevent(new ICAL.Event(component))}break;default:continue;}}this.oncomplete()}};return ComponentParser}();