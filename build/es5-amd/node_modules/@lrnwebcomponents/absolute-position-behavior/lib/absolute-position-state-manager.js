define(["exports","../../../@polymer/polymer/polymer-element.js","../../../@polymer/iron-resizable-behavior/iron-resizable-behavior.js"],function(_exports,_polymerElement,_ironResizableBehavior){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.AbsolutePositionStateManager=void 0;/**
 * Copyright 2018 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */ // register globally so we can make sure there is only one
window.AbsolutePositionStateManager=window.AbsolutePositionStateManager||{};// request if this exists. This helps invoke the el existing in the dom
// as well as that there is only one of them. That way we can ensure everything
// is rendered through the same modal
window.AbsolutePositionStateManager.requestAvailability=function(){if(!window.AbsolutePositionStateManager.instance){window.AbsolutePositionStateManager.instance=document.createElement("absolute-position-state-manager");document.body.appendChild(window.AbsolutePositionStateManager.instance)}return window.AbsolutePositionStateManager.instance};/**
 * `absolute-position-state-manager`
 * `A utility that manages the state of multiple a11y-media-players on a single page.`
 *
 * @microcopy - language worth noting:
 *  -
 *
 * @customElement
 * @polymer
 */var AbsolutePositionStateManager=/*#__PURE__*/function(_PolymerElement){babelHelpers.inherits(AbsolutePositionStateManager,_PolymerElement);babelHelpers.createClass(AbsolutePositionStateManager,null,[{key:"tag",/* REQUIRED FOR TOOLING DO NOT TOUCH */ /**
   * Store the tag name to make it easier to obtain directly.
   * @notice function name must be here for tooling to operate correctly
   */get:function get(){return"absolute-position-state-manager"}// properties available to the custom el for data binding
},{key:"properties",get:function get(){return{/**
       * Stores an array of all the players on the page.
       */els:{type:Array,value:[]}}}/**
   * Makes sure there is a utility ready and listening for els.
   */}]);function AbsolutePositionStateManager(){var _this;babelHelpers.classCallCheck(this,AbsolutePositionStateManager);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(AbsolutePositionStateManager).call(this));var root=babelHelpers.assertThisInitialized(_this);// sets the instance to the current instance
if(!window.AbsolutePositionStateManager.instance){window.AbsolutePositionStateManager.instance=babelHelpers.assertThisInitialized(_this);return babelHelpers.possibleConstructorReturn(_this,babelHelpers.assertThisInitialized(_this))}return _this}/**
   * life cycle, el is afixed to the DOM
   * Makes sure there is a utility ready and listening for els.
   */babelHelpers.createClass(AbsolutePositionStateManager,[{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(AbsolutePositionStateManager.prototype),"connectedCallback",this).call(this)}/**
   * Loads el into array
   */},{key:"loadElement",value:function loadElement(el){var root=this;root.__on=root.__on!==void 0?root.__on:!1;root.els.push(el);root.positionElement(el);if(!root.__on)root.addEventListeners();root.__on=!0}/**
   * Unloads el from array
   */},{key:"unloadElement",value:function unloadElement(el){var root=this;root.els.filter(function(el){return el===el});root.__on=0<root.els;if(!root.__on)root.removeEventListeners()}/**
   * Adds event listeners
   */},{key:"addEventListeners",value:function addEventListeners(){var root=this;root.__timeout=!1;root.updateElements();document.addEventListener("load",root.updateElements());window.addEventListener("resize",function(){clearTimeout(root.__timeout);root.__timeout=setTimeout(root.updateElements(),250)});root.__observer=new MutationObserver(function(mutations){root.checkMutations(mutations)});root.__observer.observe(document,{attributes:!0,childList:!0,subtree:!0,characterData:!0})}/**
   * Checks if there are any chances other than to
   * the element's position and updates accordioning.
   * This is needed so that positioning the elements
   * doesn't trigger an infinite loop of updates.
   *
   * @param {array} mutation records
   * @return {void}
   */},{key:"checkMutations",value:function checkMutations(mutations){var _this2=this,update=!1;mutations.forEach(function(mutation){if(update)return;update=update||!("attributes"===mutation.type&&"style"===mutation.attributeName&&_this2.els.includes(mutation.target))});if(update)this.updateElements()}/**
   * Returns the target el that this el is anchored to. It is
   * either the el given by the `for` attribute, or the immediate parent
   * of the el.
   *
   * @param {object} element using absolute-position behavior
   * @return {object} target element for positioning
   */},{key:"findTarget",value:function findTarget(el){var selector="#"+el.for,docQuery=1===document.querySelectorAll(selector).length?document.querySelector(selector):null,target=el.target||docQuery,ancestor=el;/**
     * Use `target` object if specified.
     * If not, query the document for elements with the id specified in the `for` attribute.
     * If there is more than one element that matches, find the closest matching element.
     */while(el.for!==void 0&&null===target&&null!==ancestor&&ancestor!==document){ancestor=ancestor.parentNode;if(11===ancestor.nodeType)ancestor=ancestor.host;target=ancestor?ancestor.querySelector(selector):null}return target}/**
   * Removes event listeners
   * @return {void}
   */},{key:"removeEventListeners",value:function removeEventListeners(){var root=this;document.removeEventListener("load",root.updateElements());window.removeEventListener("resize",function(){clearTimeout(root.__timeout);root.__timeout=setTimeout(root.updateElements(),250)});if(root.__observer){root.__observer.disconnect()}}/**
   * Updates position for all elements on the page.
   * @return {void}
   */},{key:"updateElements",value:function updateElements(){var root=this;root.els.forEach(function(el){root.positionElement(el)})}/**
   * Gets an updated position based on target.
   * @param {object} the element using absolute-position behavior
   * @return {void}
   */},{key:"positionElement",value:function positionElement(el){var target=this.findTarget(el);if(!target||!el.offsetParent)return;var offset=el.offset,parentRect=el.offsetParent.getBoundingClientRect(),targetRect=target.getBoundingClientRect(),elRect=el.getBoundingClientRect(),centerOffset=(targetRect.width-elRect.width)/2,middleOffset=(targetRect.height-elRect.height)/2,elLeft,elTop,styleLeft,styleRight,styleTop,styleBottom;switch(el.position){case"top":elLeft=targetRect.left+centerOffset;elTop=targetRect.top-elRect.height-offset;break;case"bottom":elLeft=targetRect.left+centerOffset;elTop=targetRect.top+targetRect.height+offset;break;case"left":elLeft=targetRect.left-elRect.width-offset;elTop=targetRect.top+middleOffset;break;case"right":elLeft=targetRect.left+targetRect.width+offset;elTop=targetRect.top+middleOffset;break;}el.style.position="absolute";// TODO(noms): This should use IronFitBehavior if possible.
styleLeft=elLeft+"px";styleTop=elTop+"px";if(el.fitToVisibleBounds){/// if the left side is off-screen
if(elLeft-offset<parentRect.left||elRect.width>parentRect.width){styleLeft=parentRect.left+"px";/// if the right side is off-screen
}else if(elRect.right>parentRect.right){styleLeft=targetRect.right-elRect.width+"px"}//if the top is off screen
if(elTop-offset<parentRect.top||elRect.height>parentRect.height){styleTop=parentRect.top+"px";// if the bottom is off screen
}else if(elRect.bottom>parentRect.bottom){styleLeft=targetRect.bottom-elRect.height+"px"}}el.style.left=styleLeft;el.style.top=styleTop;//provide positions for el and target (in case furthor positioning adjustments are needed)
el.__positions={self:elRect,parent:parentRect,target:targetRect}}/**
   * life cycle, el is removed from the DOM
   */},{key:"disconnectedCallback",value:function disconnectedCallback(){this.removeEventListeners();babelHelpers.get(babelHelpers.getPrototypeOf(AbsolutePositionStateManager.prototype),"disconnectedCallback",this).call(this)}}]);return AbsolutePositionStateManager}(_polymerElement.PolymerElement);_exports.AbsolutePositionStateManager=AbsolutePositionStateManager;window.customElements.define(AbsolutePositionStateManager.tag,AbsolutePositionStateManager)});