define(["exports","../../../@polymer/polymer/polymer-element.js","../../../@polymer/iron-resizable-behavior/iron-resizable-behavior.js"],function(_exports,_polymerElement,_ironResizableBehavior){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.AbsolutePositionStateManager=void 0;/**
 * Copyright 2018 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */ // register globally so we can make sure there is only one
window.AbsolutePositionStateManager=window.AbsolutePositionStateManager||{};// request if this exists. This helps invoke the element existing in the dom
// as well as that there is only one of them. That way we can ensure everything
// is rendered through the same modal
window.AbsolutePositionStateManager.requestAvailability=function(){if(!window.AbsolutePositionStateManager.instance){window.AbsolutePositionStateManager.instance=document.createElement("absolute-position-state-manager");document.body.appendChild(window.AbsolutePositionStateManager.instance)}return window.AbsolutePositionStateManager.instance};/**
 * `absolute-position-state-manager`
 * `A utility that manages the state of multiple a11y-media-players on a single page.`
 *
 * @microcopy - language worth noting:
 *  -
 *
 * @customElement
 * @polymer
 */var AbsolutePositionStateManager=/*#__PURE__*/function(_PolymerElement){babelHelpers.inherits(AbsolutePositionStateManager,_PolymerElement);babelHelpers.createClass(AbsolutePositionStateManager,null,[{key:"tag",/* REQUIRED FOR TOOLING DO NOT TOUCH */ /**
   * Store the tag name to make it easier to obtain directly.
   * @notice function name must be here for tooling to operate correctly
   */get:function get(){return"absolute-position-state-manager"}// properties available to the custom element for data binding
},{key:"properties",get:function get(){return{/**
       * Stores an array of all the players on the page.
       */elements:{type:Array,value:[]}}}/**
   * Makes sure there is a utility ready and listening for elements.
   */}]);function AbsolutePositionStateManager(){var _this;babelHelpers.classCallCheck(this,AbsolutePositionStateManager);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(AbsolutePositionStateManager).call(this));var root=babelHelpers.assertThisInitialized(_this);// sets the instance to the current instance
if(!window.AbsolutePositionStateManager.instance){window.AbsolutePositionStateManager.instance=babelHelpers.assertThisInitialized(_this);return babelHelpers.possibleConstructorReturn(_this,babelHelpers.assertThisInitialized(_this))}return _this}/**
   * life cycle, element is afixed to the DOM
   * Makes sure there is a utility ready and listening for elements.
   */babelHelpers.createClass(AbsolutePositionStateManager,[{key:"connectedCallback",value:function connectedCallback(){babelHelpers.get(babelHelpers.getPrototypeOf(AbsolutePositionStateManager.prototype),"connectedCallback",this).call(this)}/**
   * Loads element into array
   */},{key:"loadElement",value:function loadElement(el){var root=this;root.__on=root.__on!==void 0?root.__on:!1;root.elements.push(el);root.updatePosition(el);if(!root.__on)root.addEventListeners();root.__on=!0}/**
   * Unloads element from array
   */},{key:"unloadElement",value:function unloadElement(el){var root=this;root.elements.filter(function(element){return element===el});root.__on=0<root.elements;if(!root.__on)root.removeEventListeners()}/**
   * Adds event listeners
   */},{key:"addEventListeners",value:function addEventListeners(){var root=this;root.__timeout=!1;root.updateElements();document.addEventListener("load",root.updateElements());window.addEventListener("resize",function(){clearTimeout(root.__timeout);root.__timeout=setTimeout(root.updateElements(),250)});root.__observer=new MutationObserver(function(mutations){root.updateElements()});root.__observer.observe(document,{attributes:!0,childList:!0,subtree:!0,characterData:!0})}/**
   * Returns the target element that this tooltip is anchored to. It is
   * either the element given by the `for` attribute, or the immediate parent
   * of the tooltip.
   *
   * @type {Node}
   */},{key:"findTarget",value:function findTarget(el){var target,parentNode=this.parentNode;if(el.target){target=el.target}else if(el.for){target=parentNode.querySelector("#"+el.for)}else{var ownerRoot=el.shadowRoot;target=parentNode.nodeType==Node.DOCUMENT_FRAGMENT_NODE?ownerRoot.host:parentNode}return target}/**
   * Removes event listeners
   */},{key:"removeEventListeners",value:function removeEventListeners(){var root=this;document.removeEventListener("load",root.updateElements());window.removeEventListener("resize",function(){clearTimeout(root.__timeout);root.__timeout=setTimeout(root.updateElements(),250)});root.__observer.disconnect()}/**
   * stops all other players on the page
   */},{key:"updateElements",value:function updateElements(){var root=this;root.elements.forEach(function(element){root.updatePosition(element)})}/**
   * @return {void}
   */},{key:"updatePosition",value:function updatePosition(element){var target=this.findTarget(element);if(!target||!element.offsetParent)return;var offset=element.offset,parentRect=element.offsetParent.getBoundingClientRect(),targetRect=target.getBoundingClientRect(),elementRect=element.getBoundingClientRect(),horizontalCenterOffset=(targetRect.width-elementRect.width)/2,verticalCenterOffset=(targetRect.height-elementRect.height)/2,tooltipLeft,tooltipTop;switch(element.position){case"top":tooltipLeft=targetRect.left+horizontalCenterOffset;tooltipTop=targetRect.top-elementRect.height-offset;break;case"bottom":tooltipLeft=targetRect.left+horizontalCenterOffset;tooltipTop=targetRect.top+targetRect.height+offset;break;case"left":tooltipLeft=targetRect.left-elementRect.width-offset;tooltipTop=targetRect.top+verticalCenterOffset;break;case"right":tooltipLeft=targetRect.left+targetRect.width+offset;tooltipTop=targetRect.top+verticalCenterOffset;break;}element.style.position="absolute";// TODO(noms): This should use IronFitBehavior if possible.
if(element.fitToVisibleBounds){// Clip the left/right side
if(parentRect.left+tooltipLeft+elementRect.width>window.innerWidth){element.style.right="0px";element.style.left="auto"}else{element.style.left=Math.max(0,tooltipLeft)+"px";element.style.right="auto"}// Clip the top/bottom side.
if(parentRect.top+tooltipTop+elementRect.height>window.innerHeight){element.style.bottom=parentRect.height-targetRect.top+offset+"px";element.style.top="auto"}else{element.style.top=Math.max(-parentRect.top,tooltipTop)+"px";element.style.bottom="auto"}}else{element.style.left=tooltipLeft+"px";element.style.top=tooltipTop+"px"}}/**
   * life cycle, element is removed from the DOM
   */},{key:"disconnectedCallback",value:function disconnectedCallback(){this.removeEventListeners();babelHelpers.get(babelHelpers.getPrototypeOf(AbsolutePositionStateManager.prototype),"disconnectedCallback",this).call(this)}}]);return AbsolutePositionStateManager}(_polymerElement.PolymerElement);_exports.AbsolutePositionStateManager=AbsolutePositionStateManager;window.customElements.define(AbsolutePositionStateManager.tag,AbsolutePositionStateManager)});