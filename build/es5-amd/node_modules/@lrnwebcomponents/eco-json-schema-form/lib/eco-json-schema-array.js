define(["exports","../../../@polymer/polymer/polymer-element.js","../../../@polymer/polymer/lib/legacy/polymer.dom.js","../../../@polymer/iron-flex-layout/iron-flex-layout-classes.js","../../../@polymer/iron-icons/iron-icons.js","../../../@polymer/iron-icons/editor-icons.js","../../../@polymer/paper-icon-button/paper-icon-button.js","../../../paper-collapse-item/paper-collapse-item.js","../../../paper-collapse-item/paper-collapse-group.js","../../../@polymer/app-localize-behavior/app-localize-behavior.js","../../../@polymer/polymer/lib/legacy/class.js","./eco-json-schema-boolean.js","./eco-json-schema-enum.js","./eco-json-schema-input.js","./eco-json-schema-object.js","./eco-json-schema-file.js"],function(_exports,_polymerElement,_polymerDom,_ironFlexLayoutClasses,_ironIcons,_editorIcons,_paperIconButton,_paperCollapseItem,_paperCollapseGroup,_appLocalizeBehavior,_class,_ecoJsonSchemaBoolean,_ecoJsonSchemaEnum,_ecoJsonSchemaInput,_ecoJsonSchemaObject,_ecoJsonSchemaFile){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.EcoJsonSchemaArray=void 0;function _templateObject_8a6a8550a44b11e98c881fc26e93d8f9(){var data=babelHelpers.taggedTemplateLiteral(["\n      <custom-style>\n        <style is=\"custom-style\" include=\"iron-flex iron-flex-alignment\">\n          paper-input {\n            padding: 2px;\n\n            --paper-input-container-label: {\n              white-space: normal;\n              position: static;\n              font-size: 22px;\n              color: #212121;\n            }\n          }\n\n          paper-collapse-item {\n            --paper-collapse-item-header: {\n              font-weight: bold;\n              padding: 8px 0 0 8px;\n            }\n          }\n\n          #form {\n            border: 1px solid #aaaaaa;\n          }\n\n          #form div:nth-child(odd) {\n            background-color: #f2f2f2;\n            padding: 4px;\n          }\n\n          #form div:nth-child(even) {\n            background-color: #e2e2e2;\n            border-top: 1px solid #aaaaaa;\n            border-bottom: 1px solid #aaaaaa;\n            padding: 4px;\n          }\n\n          #form div:focus,\n          #form div:hover,\n          #form div:active {\n            background-color: #ffffff !important;\n          }\n\n          paper-icon-button {\n            float: right;\n            border-radius: 50%;\n          }\n\n          .array-add {\n            color: #34e79a;\n            background-color: #f8f8f8;\n          }\n\n          .array-remove-element {\n            color: #f44336;\n            background-color: #f8f8f8;\n          }\n\n          .label {\n            @apply --paper-input-container-label;\n            white-space: normal;\n            position: static;\n            font-size: 22px;\n            color: #212121;\n          }\n\n          :host {\n            display: block;\n          }\n          .label {\n            white-space: normal;\n            position: static;\n            font-size: 22px;\n            color: #212121;\n            @apply --paper-input-container-label;\n          }\n        </style>\n      </custom-style>\n      <div class=\"horizontal layout\">\n        <div class=\"flex\" hidden$=\"[[!label]]\">[[label]]</div>\n        <paper-icon-button\n          id=\"addarray\"\n          title=\"Add another item\"\n          class=\"array-add\"\n          icon=\"add\"\n          on-click=\"_onAddItem\"\n          role=\"button\"\n          aria-label=\"Add another item\"\n        ></paper-icon-button>\n      </div>\n\n      <paper-collapse-group id=\"form\" class=\"vertical flex layout\"\n        ><slot></slot\n      ></paper-collapse-group>\n    "],["\n      <custom-style>\n        <style is=\"custom-style\" include=\"iron-flex iron-flex-alignment\">\n          paper-input {\n            padding: 2px;\n\n            --paper-input-container-label: {\n              white-space: normal;\n              position: static;\n              font-size: 22px;\n              color: #212121;\n            }\n          }\n\n          paper-collapse-item {\n            --paper-collapse-item-header: {\n              font-weight: bold;\n              padding: 8px 0 0 8px;\n            }\n          }\n\n          #form {\n            border: 1px solid #aaaaaa;\n          }\n\n          #form div:nth-child(odd) {\n            background-color: #f2f2f2;\n            padding: 4px;\n          }\n\n          #form div:nth-child(even) {\n            background-color: #e2e2e2;\n            border-top: 1px solid #aaaaaa;\n            border-bottom: 1px solid #aaaaaa;\n            padding: 4px;\n          }\n\n          #form div:focus,\n          #form div:hover,\n          #form div:active {\n            background-color: #ffffff !important;\n          }\n\n          paper-icon-button {\n            float: right;\n            border-radius: 50%;\n          }\n\n          .array-add {\n            color: #34e79a;\n            background-color: #f8f8f8;\n          }\n\n          .array-remove-element {\n            color: #f44336;\n            background-color: #f8f8f8;\n          }\n\n          .label {\n            @apply --paper-input-container-label;\n            white-space: normal;\n            position: static;\n            font-size: 22px;\n            color: #212121;\n          }\n\n          :host {\n            display: block;\n          }\n          .label {\n            white-space: normal;\n            position: static;\n            font-size: 22px;\n            color: #212121;\n            @apply --paper-input-container-label;\n          }\n        </style>\n      </custom-style>\n      <div class=\"horizontal layout\">\n        <div class=\"flex\" hidden\\$=\"[[!label]]\">[[label]]</div>\n        <paper-icon-button\n          id=\"addarray\"\n          title=\"Add another item\"\n          class=\"array-add\"\n          icon=\"add\"\n          on-click=\"_onAddItem\"\n          role=\"button\"\n          aria-label=\"Add another item\"\n        ></paper-icon-button>\n      </div>\n\n      <paper-collapse-group id=\"form\" class=\"vertical flex layout\"\n        ><slot></slot\n      ></paper-collapse-group>\n    "]);_templateObject_8a6a8550a44b11e98c881fc26e93d8f9=function _templateObject_8a6a8550a44b11e98c881fc26e93d8f9(){return data};return data}/**
`eco-json-schema-array` takes in a JSON schema of type array and builds a form,
exposing a `value` property that represents an array described by the schema.

Please see the `eco-json-schema-object` documentation for further information.

@group eco Elements
@element eco-json-schema-array
* @demo demo/index.html
*/var EcoJsonSchemaArray=/*#__PURE__*/function(_mixinBehaviors){babelHelpers.inherits(EcoJsonSchemaArray,_mixinBehaviors);function EcoJsonSchemaArray(){babelHelpers.classCallCheck(this,EcoJsonSchemaArray);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(EcoJsonSchemaArray).apply(this,arguments))}babelHelpers.createClass(EcoJsonSchemaArray,[{key:"_valueChanged",/**
   * Notice values have changed and rebuild the form
   * to match (potentially).
   */value:function _valueChanged(newValue,oldValue){var _this=this;if(newValue!==oldValue&&babelHelpers.typeof(newValue)!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))&&babelHelpers.typeof(this.schema)!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))){setTimeout(function(){_this._buildSchemaArrayItems();// wipe schema array and go from there
// this only fires when the element initially builds
for(var i in newValue){_this._onAddItemWithValue(newValue[i],parseInt(i))}},325)}}},{key:"disconnectedCallback",value:function disconnectedCallback(){this._clearForm();babelHelpers.get(babelHelpers.getPrototypeOf(EcoJsonSchemaArray.prototype),"disconnectedCallback",this).call(this)}},{key:"_buildSchemaArrayItems",value:function _buildSchemaArrayItems(){this.set("_schemaArrayItems",[])}},{key:"_setValue",value:function _setValue(){var newValue=this._schemaArrayItems.map(function(item){return item.value});this.set("value",[]);this.set("value",newValue);this.notifyPath("value.*")}},{key:"_schemaArraySplicesChanged",value:function _schemaArraySplicesChanged(detail){var _this2=this;if(!detail){return!1}if(detail.keySplices){console.warn("Got keySplices, don't know what to do with them!")}detail.indexSplices.forEach(function(splice){var args=["value",splice.index,splice.removed.length];if(splice.removed&&splice.removed.length){for(var i=splice.index,ii=splice.index+splice.removed.length;i<ii;i++){_this2._removeArrayEl(_this2.children[i])}}if(splice.addedCount){for(var i=splice.index,ii=splice.index+splice.addedCount;i<ii;i++){var item=splice.object[i],componentEl=_this2.create(item.component.name,{label:item.label,schema:item.schema,schemaArrayItem:item}),containerEl=_this2.create("paper-collapse-item",{header:"Item "+(i+1)}),buttonEl=_this2.create("paper-icon-button",{icon:"remove",title:"Remove item"});_this2.listen(buttonEl,"click","_onRemoveItem");buttonEl.classList.add("array-remove-element");componentEl.classList.add("flex","horizontal","layout");(0,_polymerDom.dom)(containerEl).appendChild(componentEl);(0,_polymerDom.dom)(containerEl).appendChild(buttonEl);var beforeEl=_this2.children[i];if(beforeEl){(0,_polymerDom.dom)(_this2).insertBefore(containerEl,beforeEl)}else{(0,_polymerDom.dom)(_this2).appendChild(containerEl)}_this2.listen(componentEl,item.component.valueProperty.replace(/([A-Z])/g,"-$1").toLowerCase()+"-changed","_schemaArrayItemChanged");args.push(_this2._deepClone(componentEl[item.component.valueProperty]))}}_this2.splice.apply(_this2,args)})}},{key:"_schemaArrayItemChanged",value:function _schemaArrayItemChanged(event,detail){var _this3=this;if(detail.path&&/\.length$/.test(detail.path)){return}var item=event.target.schemaArrayItem,index=this._schemaArrayItems.indexOf(item),path=["value",index];if(detail.path&&/\.splices$/.test(detail.path)){path=path.concat(detail.path.split(".").slice(1,-1));if(detail.value.keySplices){console.warn("Got keySplices, don't know what to do with them!")}detail.value.indexSplices.forEach(function(splice){var args=[path.join("."),splice.index,splice.removed.length];if(splice.addedCount){for(var i=splice.index,ii=splice.index+splice.addedCount;i<ii;i++){args.push(_this3._deepClone(splice.object[i]))}}_this3.splice.apply(_this3,args)})}else if(detail.path){path=path.concat(detail.path.split(".").slice(1));this.set(path,this._deepClone(detail.value));this.notifyPath(path)}else{this.splice("value",index,1,this._deepClone(detail.value));this.notifyPath("value.1")}}},{key:"_removeArrayEl",value:function _removeArrayEl(el){var polyEl=(0,_polymerDom.dom)(el);if(babelHelpers.typeof(polyEl.childNodes[0])!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))){this.unlisten(polyEl.childNodes[0],polyEl.firstChild.schemaArrayItem.component.valueProperty.replace(/([A-Z])/g,"-$1").toLowerCase()+"-changed","_schemaArrayItemChanged");if(babelHelpers.typeof(polyEl.childNodes[1])!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))){this.unlisten(polyEl.childNodes[1],"click","_onRemoveItem")}}el.schemaArrayItem=null;(0,_polymerDom.dom)(this).removeChild(el)}},{key:"_clearForm",value:function _clearForm(){var formEl=(0,_polymerDom.dom)(this);while(formEl.firstChild){this._removeArrayEl(formEl.firstChild)}}},{key:"_schemaChanged",value:function _schemaChanged(){this._clearForm();this._buildSchemaArrayItems()}},{key:"_errorChanged",value:function _errorChanged(){var _this4=this;(0,_polymerDom.dom)(this).childNodes.forEach(function(rowEl,idx){if(_this4.error&&_this4.error[idx]){(0,_polymerDom.dom)(rowEl).childNodes[0].error=_this4.error[idx]}else{(0,_polymerDom.dom)(rowEl).childNodes[0].error=null}})}},{key:"_onAddItemWithValue",value:function _onAddItemWithValue(values,pointer){var schema=this.schema.items,i=0;// try to set values if we have them
if(babelHelpers.typeof(values)!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))){for(i in values){if(babelHelpers.typeof(schema.properties[i])!==("undefined"===typeof void 0?"undefined":babelHelpers.typeof(void 0))){schema.properties[i].value=values[i]}}}var item={schema:schema,component:schema.component||{}};if(schema.title){item.label=schema.title}if(!item.component.valueProperty){item.component.valueProperty="value"}if(!item.component.name){if(this._isSchemaEnum(schema)){item.component.name="eco-json-schema-enum"}else if(this._isSchemaBoolean(schema.type)){item.component.name="eco-json-schema-boolean"}else if(this._isSchemaFile(schema.type)){item.component.name="eco-json-schema-file"}else if(this._isSchemaValue(schema.type)){item.component.name="eco-json-schema-input"}else if(this._isSchemaObject(schema.type)){item.component.name="eco-json-schema-object"}else if(this._isSchemaArray(schema.type)){item.component.name="eco-json-schema-array"}else{return console.error("Unknown item type %s",schema.type)}}var componentEl=this.create(item.component.name,{label:item.label,schema:item.schema,schemaArrayItem:item}),containerEl=this.create("paper-collapse-item",{header:"Item "+(this.children.length+1)}),buttonEl=this.create("paper-icon-button",{icon:"remove",title:"Remove item"});this.listen(buttonEl,"click","_onRemoveItem");buttonEl.classList.add("array-remove-element");componentEl.classList.add("flex","horizontal","layout");(0,_polymerDom.dom)(containerEl).appendChild(componentEl);(0,_polymerDom.dom)(containerEl).appendChild(buttonEl);var beforeEl=this.children[this.children.length];if(beforeEl){(0,_polymerDom.dom)(this).insertBefore(containerEl,beforeEl)}else{(0,_polymerDom.dom)(this).appendChild(containerEl)}this.listen(componentEl,item.component.valueProperty.replace(/([A-Z])/g,"-$1").toLowerCase()+"-changed","_schemaArrayItemChanged");// this will add it to the array but not force a splice mutation
this._schemaArrayItems.push(item)}},{key:"_onAddItem",value:function _onAddItem(e){var schema=this.schema.items,item={label:schema.title,schema:schema,component:schema.component||{}};if(!item.component.valueProperty){item.component.valueProperty="value"}for(var i in item.schema.properties){item.schema.properties[i].value=null}if(!item.component.name){if(this._isSchemaEnum(schema)){item.component.name="eco-json-schema-enum"}else if(this._isSchemaBoolean(schema.type)){item.component.name="eco-json-schema-boolean"}else if(this._isSchemaFile(schema.type)){item.component.name="eco-json-schema-file"}else if(this._isSchemaValue(schema.type)){item.component.name="eco-json-schema-input"}else if(this._isSchemaObject(schema.type)){item.component.name="eco-json-schema-object"}else if(this._isSchemaArray(schema.type)){item.component.name="eco-json-schema-array"}else{return console.error("Unknown item type %s",schema.type)}}this.push("_schemaArrayItems",item)}},{key:"_onRemoveItem",value:function _onRemoveItem(e){var item=(0,_polymerDom.dom)(e).localTarget.previousSibling.schemaArrayItem,index=this._schemaArrayItems.indexOf(item);this.splice("_schemaArrayItems",index,1)}},{key:"_deepClone",value:function _deepClone(o){return JSON.parse(JSON.stringify(o))}},{key:"_isSchemaValue",value:function _isSchemaValue(type){return this._isSchemaBoolean(type)||this._isSchemaNumber(type)||this._isSchemaString(type)||this._isSchemaFile(type)}},{key:"_isSchemaFile",value:function _isSchemaFile(type){if(Array.isArray(type)){return-1!==type.indexOf("file")}else{return"file"===type}}},{key:"_isSchemaBoolean",value:function _isSchemaBoolean(type){if(Array.isArray(type)){return-1!==type.indexOf("boolean")}else{return"boolean"===type}}},{key:"_isSchemaEnum",value:function _isSchemaEnum(schema){return!!schema.enum}},{key:"_isSchemaNumber",value:function _isSchemaNumber(type){if(Array.isArray(type)){return-1!==type.indexOf("number")||-1!==type.indexOf("integer")}else{return"number"===type||"integer"===type}}},{key:"_isSchemaString",value:function _isSchemaString(type){if(Array.isArray(type)){return-1!==type.indexOf("string")}else{return"string"===type}}},{key:"_isSchemaObject",value:function _isSchemaObject(type){return"object"===type}},{key:"_isSchemaArray",value:function _isSchemaArray(type){return"array"===type}}],[{key:"tag",get:function get(){return"eco-json-schema-array"}},{key:"template",get:function get(){return(0,_polymerElement.html)(_templateObject_8a6a8550a44b11e98c881fc26e93d8f9())}},{key:"properties",get:function get(){return{schema:{type:Object,notify:!0,observer:"_schemaChanged"},label:{type:String},value:{type:Array,notify:!0,value:function value(){return[]},observer:"_valueChanged"},error:{type:Object,observer:"_errorChanged"},_schemaArrayItems:{type:Array,notify:!0}}}},{key:"observers",get:function get(){return["_schemaArraySplicesChanged(_schemaArrayItems.splices)"]}}]);return EcoJsonSchemaArray}((0,_class.mixinBehaviors)([_appLocalizeBehavior.AppLocalizeBehavior],_polymerElement.PolymerElement));_exports.EcoJsonSchemaArray=EcoJsonSchemaArray;window.customElements.define(EcoJsonSchemaArray.tag,EcoJsonSchemaArray)});