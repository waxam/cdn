(function(root,factory){if("object"===("undefined"===typeof exports?"undefined":babelHelpers.typeof(exports))&&"object"===("undefined"===typeof module?"undefined":babelHelpers.typeof(module)))module.exports=factory();else if("function"===typeof define&&define.amd)define("WaveSurfer",[],factory);else if("object"===("undefined"===typeof exports?"undefined":babelHelpers.typeof(exports)))exports.WaveSurfer=factory();else root.WaveSurfer=factory()})(window,function(){var _Mathround=Math.round,_Mathmax=Math.max,_Mathmin=Math.min;return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=!0;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{enumerable:!0,get:getter})}};__webpack_require__.r=function(exports){if("undefined"!==typeof Symbol&&Symbol.toStringTag){Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"})}Object.defineProperty(exports,"__esModule",{value:!0})};__webpack_require__.t=function(value,mode){if(1&mode)value=__webpack_require__(value);if(8&mode)return value;if(4&mode&&"object"===babelHelpers.typeof(value)&&value&&value.__esModule)return value;var ns=Object.create(null);__webpack_require__.r(ns);Object.defineProperty(ns,"default",{enumerable:!0,value:value});if(2&mode&&"string"!=typeof value)for(var key in value){__webpack_require__.d(ns,key,function(key){return value[key]}.bind(null,key))}return ns};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module["default"]}:function(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s="./src/wavesurfer.js")}({"./node_modules/debounce/index.js":function node_modulesDebounceIndexJs(module){function debounce(func,wait,immediate){var timeout,args,context,timestamp,result;if(null==wait)wait=100;function later(){var last=Date.now()-timestamp;if(last<wait&&0<=last){timeout=setTimeout(later,wait-last)}else{timeout=null;if(!immediate){result=func.apply(context,args);context=args=null}}}var debounced=function(){context=this;args=arguments;timestamp=Date.now();var callNow=immediate&&!timeout;if(!timeout)timeout=setTimeout(later,wait);if(callNow){result=func.apply(context,args);context=args=null}return result};debounced.clear=function(){if(timeout){clearTimeout(timeout);timeout=null}};debounced.flush=function(){if(timeout){result=func.apply(context,args);context=args=null;clearTimeout(timeout);timeout=null}};return debounced}debounce.debounce=debounce;module.exports=debounce},"./src/drawer.js":function srcDrawerJs(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var util=function(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(null!=obj){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}(__webpack_require__("./src/util/index.js"));function _typeof(obj){if("function"===typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)){_typeof=function(obj){return babelHelpers.typeof(obj)}}else{_typeof=function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":babelHelpers.typeof(obj)}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!babelHelpers.instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"===typeof call)){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var Drawer=function(_util$Observer){_inherits(Drawer,_util$Observer);function Drawer(container,params){var _this;_classCallCheck(this,Drawer);_this=_possibleConstructorReturn(this,_getPrototypeOf(Drawer).call(this));_this.container=container;_this.params=params;_this.width=0;_this.height=params.height*_this.params.pixelRatio;_this.lastPos=0;_this.wrapper=null;return _this}_createClass(Drawer,[{key:"style",value:function(el,styles){return util.style(el,styles)}},{key:"createWrapper",value:function(){this.wrapper=this.container.appendChild(document.createElement("wave"));this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"});if(this.params.fillParent||this.params.scrollParent){this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"})}this.setupWrapperEvents()}},{key:"handleEvent",value:function(e,noPrevent){noPrevent||e.preventDefault();var clientX=e.targetTouches?e.targetTouches[0].clientX:e.clientX,bbox=this.wrapper.getBoundingClientRect(),nominalWidth=this.width,parentWidth=this.getWidth(),progress;if(!this.params.fillParent&&nominalWidth<parentWidth){progress=(clientX-bbox.left)*(this.params.pixelRatio/nominalWidth)||0;if(1<progress){progress=1}}else{progress=(clientX-bbox.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0}return progress}},{key:"setupWrapperEvents",value:function(){var _this2=this;this.wrapper.addEventListener("click",function(e){var scrollbarHeight=_this2.wrapper.offsetHeight-_this2.wrapper.clientHeight;if(0!=scrollbarHeight){var bbox=_this2.wrapper.getBoundingClientRect();if(e.clientY>=bbox.bottom-scrollbarHeight){return}}if(_this2.params.interact){_this2.fireEvent("click",e,_this2.handleEvent(e))}});this.wrapper.addEventListener("scroll",function(e){return _this2.fireEvent("scroll",e)})}},{key:"drawPeaks",value:function(peaks,length,start,end){if(!this.setWidth(length)){this.clearWave()}this.params.barWidth?this.drawBars(peaks,0,start,end):this.drawWave(peaks,0,start,end)}},{key:"resetScroll",value:function(){if(null!==this.wrapper){this.wrapper.scrollLeft=0}}},{key:"recenter",value:function(percent){var position=this.wrapper.scrollWidth*percent;this.recenterOnPosition(position,!0)}},{key:"recenterOnPosition",value:function(position,immediate){var scrollLeft=this.wrapper.scrollLeft,half=~~(this.wrapper.clientWidth/2),maxScroll=this.wrapper.scrollWidth-this.wrapper.clientWidth,target=position-half,offset=target-scrollLeft;if(0==maxScroll){return}if(!immediate&&-half<=offset&&offset<half){var rate=5;offset=_Mathmax(-rate,_Mathmin(rate,offset));target=scrollLeft+offset}target=_Mathmax(0,_Mathmin(maxScroll,target));if(target!=scrollLeft){this.wrapper.scrollLeft=target}}},{key:"getScrollX",value:function(){var pixelRatio=this.params.pixelRatio,x=_Mathround(this.wrapper.scrollLeft*pixelRatio);if(this.params.scrollParent){var maxScroll=~~(this.wrapper.scrollWidth*pixelRatio-this.getWidth());x=_Mathmin(maxScroll,_Mathmax(0,x))}return x}},{key:"getWidth",value:function(){return _Mathround(this.container.clientWidth*this.params.pixelRatio)}},{key:"setWidth",value:function(width){if(this.width==width){return!1}this.width=width;if(this.params.fillParent||this.params.scrollParent){this.style(this.wrapper,{width:""})}else{this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"})}this.updateSize();return!0}},{key:"setHeight",value:function(height){if(height==this.height){return!1}this.height=height;this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"});this.updateSize();return!0}},{key:"progress",value:function(_progress){var minPxDelta=1/this.params.pixelRatio,pos=_Mathround(_progress*this.width)*minPxDelta;if(pos<this.lastPos||pos-this.lastPos>=minPxDelta){this.lastPos=pos;if(this.params.scrollParent&&this.params.autoCenter){var newPos=~~(this.wrapper.scrollWidth*_progress);this.recenterOnPosition(newPos)}this.updateProgress(pos)}}},{key:"destroy",value:function(){this.unAll();if(this.wrapper){if(this.wrapper.parentNode==this.container){this.container.removeChild(this.wrapper)}this.wrapper=null}}},{key:"updateCursor",value:function(){}},{key:"updateSize",value:function(){}},{key:"drawBars",value:function(){}},{key:"drawWave",value:function(){}},{key:"clearWave",value:function(){}},{key:"updateProgress",value:function(){}}]);return Drawer}(util.Observer);exports.default=Drawer;module.exports=exports.default},"./src/drawer.multicanvas.js":function srcDrawerMulticanvasJs(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var _drawer=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__("./src/drawer.js")),util=function(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(null!=obj){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}(__webpack_require__("./src/util/index.js"));function _typeof(obj){if("function"===typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)){_typeof=function(obj){return babelHelpers.typeof(obj)}}else{_typeof=function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":babelHelpers.typeof(obj)}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!babelHelpers.instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"===typeof call)){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var MultiCanvas=function(_Drawer){var _Mathfloor=Math.floor,_Mathceil=Math.ceil;_inherits(MultiCanvas,_Drawer);function MultiCanvas(container,params){var _this;_classCallCheck(this,MultiCanvas);_this=_possibleConstructorReturn(this,_getPrototypeOf(MultiCanvas).call(this,container,params));_this.maxCanvasWidth=params.maxCanvasWidth;_this.maxCanvasElementWidth=_Mathround(params.maxCanvasWidth/params.pixelRatio);_this.hasProgressCanvas=params.waveColor!=params.progressColor;_this.halfPixel=.5/params.pixelRatio;_this.canvases=[];_this.progressWave=null;return _this}_createClass(MultiCanvas,[{key:"init",value:function(){this.createWrapper();this.createElements()}},{key:"createElements",value:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:3,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",pointerEvents:"none"}));this.addCanvas();this.updateCursor()}},{key:"updateCursor",value:function(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}},{key:"updateSize",value:function(){var _this2=this,totalWidth=_Mathround(this.width/this.params.pixelRatio),requiredCanvases=_Mathceil(totalWidth/this.maxCanvasElementWidth);while(this.canvases.length<requiredCanvases){this.addCanvas()}while(this.canvases.length>requiredCanvases){this.removeCanvas()}this.canvases.forEach(function(entry,i){var canvasWidth=_this2.maxCanvasWidth+2*_Mathceil(_this2.params.pixelRatio/2);if(i==_this2.canvases.length-1){canvasWidth=_this2.width-_this2.maxCanvasWidth*(_this2.canvases.length-1)}_this2.updateDimensions(entry,canvasWidth,_this2.height);_this2.clearWaveForEntry(entry)})}},{key:"addCanvas",value:function(){var entry={},leftOffset=this.maxCanvasElementWidth*this.canvases.length;entry.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:2,left:leftOffset+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"}));entry.waveCtx=entry.wave.getContext("2d");if(this.hasProgressCanvas){entry.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:leftOffset+"px",top:0,bottom:0,height:"100%"}));entry.progressCtx=entry.progress.getContext("2d")}this.canvases.push(entry)}},{key:"removeCanvas",value:function(){var lastEntry=this.canvases.pop();lastEntry.wave.parentElement.removeChild(lastEntry.wave);if(this.hasProgressCanvas){lastEntry.progress.parentElement.removeChild(lastEntry.progress)}}},{key:"updateDimensions",value:function(entry,width,height){var elementWidth=_Mathround(width/this.params.pixelRatio),totalWidth=_Mathround(this.width/this.params.pixelRatio);entry.start=entry.waveCtx.canvas.offsetLeft/totalWidth||0;entry.end=entry.start+elementWidth/totalWidth;entry.waveCtx.canvas.width=width;entry.waveCtx.canvas.height=height;this.style(entry.waveCtx.canvas,{width:elementWidth+"px"});this.style(this.progressWave,{display:"block"});if(this.hasProgressCanvas){entry.progressCtx.canvas.width=width;entry.progressCtx.canvas.height=height;this.style(entry.progressCtx.canvas,{width:elementWidth+"px"})}}},{key:"clearWave",value:function(){var _this3=this;this.canvases.forEach(function(entry){return _this3.clearWaveForEntry(entry)})}},{key:"clearWaveForEntry",value:function(entry){entry.waveCtx.clearRect(0,0,entry.waveCtx.canvas.width,entry.waveCtx.canvas.height);if(this.hasProgressCanvas){entry.progressCtx.clearRect(0,0,entry.progressCtx.canvas.width,entry.progressCtx.canvas.height)}}},{key:"drawBars",value:function(peaks,channelIndex,start,end){var _this4=this;return this.prepareDraw(peaks,channelIndex,start,end,function(_ref){var absmax=_ref.absmax,hasMinVals=_ref.hasMinVals,height=_ref.height,offsetY=_ref.offsetY,halfH=_ref.halfH,peaks=_ref.peaks;if(void 0===start){return}var peakIndexScale=hasMinVals?2:1,length=peaks.length/peakIndexScale,bar=_this4.params.barWidth*_this4.params.pixelRatio,gap=null===_this4.params.barGap?_Mathmax(_this4.params.pixelRatio,~~(bar/2)):_Mathmax(_this4.params.pixelRatio,_this4.params.barGap*_this4.params.pixelRatio),scale=length/_this4.width,i;for(i=start;i<end;i+=bar+gap){var peak=peaks[_Mathfloor(i*scale*peakIndexScale)]||0,h=_Mathround(peak/absmax*halfH);_this4.fillRect(i+_this4.halfPixel,halfH-h+offsetY,bar+_this4.halfPixel,2*h)}})}},{key:"drawWave",value:function(peaks,channelIndex,start,end){var _this5=this;return this.prepareDraw(peaks,channelIndex,start,end,function(_ref2){var absmax=_ref2.absmax,hasMinVals=_ref2.hasMinVals,height=_ref2.height,offsetY=_ref2.offsetY,halfH=_ref2.halfH,peaks=_ref2.peaks;if(!hasMinVals){var reflectedPeaks=[],len=peaks.length,i;for(i=0;i<len;i++){reflectedPeaks[2*i]=peaks[i];reflectedPeaks[2*i+1]=-peaks[i]}peaks=reflectedPeaks}if(void 0!==start){_this5.drawLine(peaks,absmax,halfH,offsetY,start,end)}_this5.fillRect(0,halfH+offsetY-_this5.halfPixel,_this5.width,_this5.halfPixel)})}},{key:"drawLine",value:function(peaks,absmax,halfH,offsetY,start,end){var _this6=this;this.canvases.forEach(function(entry){_this6.setFillStyles(entry);_this6.drawLineToContext(entry,entry.waveCtx,peaks,absmax,halfH,offsetY,start,end);_this6.drawLineToContext(entry,entry.progressCtx,peaks,absmax,halfH,offsetY,start,end)})}},{key:"drawLineToContext",value:function(entry,ctx,peaks,absmax,halfH,offsetY,start,end){if(!ctx){return}var length=peaks.length/2,scale=this.params.fillParent&&this.width!=length?this.width/length:1,first=_Mathround(length*entry.start),last=_Mathround(length*entry.end)+1;if(first>end||last<start){return}var canvasStart=_Mathmin(first,start),canvasEnd=_Mathmax(last,end),i,j;ctx.beginPath();ctx.moveTo((canvasStart-first)*scale+this.halfPixel,halfH+offsetY);for(i=canvasStart;i<canvasEnd;i++){var peak=peaks[2*i]||0,h=_Mathround(peak/absmax*halfH);ctx.lineTo((i-first)*scale+this.halfPixel,halfH-h+offsetY)}for(j=canvasEnd-1;j>=canvasStart;j--){var _peak=peaks[2*j+1]||0,_h=_Mathround(_peak/absmax*halfH);ctx.lineTo((j-first)*scale+this.halfPixel,halfH-_h+offsetY)}ctx.closePath();ctx.fill()}},{key:"fillRect",value:function(x,y,width,height){var startCanvas=_Mathfloor(x/this.maxCanvasWidth),endCanvas=_Mathmin(_Mathceil((x+width)/this.maxCanvasWidth)+1,this.canvases.length),i;for(i=startCanvas;i<endCanvas;i++){var entry=this.canvases[i],leftOffset=i*this.maxCanvasWidth,intersection={x1:_Mathmax(x,i*this.maxCanvasWidth),y1:y,x2:_Mathmin(x+width,i*this.maxCanvasWidth+entry.waveCtx.canvas.width),y2:y+height};if(intersection.x1<intersection.x2){this.setFillStyles(entry);this.fillRectToContext(entry.waveCtx,intersection.x1-leftOffset,intersection.y1,intersection.x2-intersection.x1,intersection.y2-intersection.y1);this.fillRectToContext(entry.progressCtx,intersection.x1-leftOffset,intersection.y1,intersection.x2-intersection.x1,intersection.y2-intersection.y1)}}}},{key:"prepareDraw",value:function(peaks,channelIndex,start,end,fn){var _this7=this;return util.frame(function(){if(babelHelpers.instanceof(peaks[0],Array)){var channels=peaks;if(_this7.params.splitChannels){_this7.setHeight(channels.length*_this7.params.height*_this7.params.pixelRatio);return channels.forEach(function(channelPeaks,i){return _this7.prepareDraw(channelPeaks,i,start,end,fn)})}peaks=channels[0]}var absmax=1/_this7.params.barHeight;if(_this7.params.normalize){var max=util.max(peaks),min=util.min(peaks);absmax=-min>max?-min:max}var hasMinVals=[].some.call(peaks,function(val){return 0>val}),height=_this7.params.height*_this7.params.pixelRatio;return fn({absmax:absmax,hasMinVals:hasMinVals,height:height,offsetY:height*channelIndex||0,halfH:height/2,peaks:peaks})})()}},{key:"fillRectToContext",value:function(ctx,x,y,width,height){if(!ctx){return}ctx.fillRect(x,y,width,height)}},{key:"setFillStyles",value:function(entry){entry.waveCtx.fillStyle=this.params.waveColor;if(this.hasProgressCanvas){entry.progressCtx.fillStyle=this.params.progressColor}}},{key:"getImage",value:function(type,quality){var images=this.canvases.map(function(entry){return entry.wave.toDataURL(type,quality)});return 1<images.length?images:images[0]}},{key:"updateProgress",value:function(position){this.style(this.progressWave,{width:position+"px"})}}]);return MultiCanvas}(_drawer.default);exports.default=MultiCanvas;module.exports=exports.default},"./src/mediaelement.js":function srcMediaelementJs(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var _webaudio=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__("./src/webaudio.js")),util=function(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(null!=obj){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}(__webpack_require__("./src/util/index.js"));function _typeof(obj){if("function"===typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)){_typeof=function(obj){return babelHelpers.typeof(obj)}}else{_typeof=function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":babelHelpers.typeof(obj)}}return _typeof(obj)}function _classCallCheck(instance,Constructor){if(!babelHelpers.instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"===typeof call)){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _get(target,property,receiver){if("undefined"!==typeof Reflect&&Reflect.get){_get=Reflect.get}else{_get=function(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver)}return desc.value}}return _get(target,property,receiver||target)}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(null===object)break}return object}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var MediaElement=function(_WebAudio){_inherits(MediaElement,_WebAudio);function MediaElement(params){var _this;_classCallCheck(this,MediaElement);_this=_possibleConstructorReturn(this,_getPrototypeOf(MediaElement).call(this,params));_this.params=params;_this.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){},volume:0};_this.mediaType=params.mediaType.toLowerCase();_this.elementPosition=params.elementPosition;_this.peaks=null;_this.playbackRate=1;_this.volume=1;_this.buffer=null;_this.onPlayEnd=null;return _this}_createClass(MediaElement,[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate);this.createTimer()}},{key:"createTimer",value:function(){var _this2=this;this.on("play",function onAudioProcess(){if(_this2.isPaused()){return}_this2.fireEvent("audioprocess",_this2.getCurrentTime());var requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame;requestAnimationFrame(onAudioProcess)});this.on("pause",function(){_this2.fireEvent("audioprocess",_this2.getCurrentTime())})}},{key:"load",value:function(url,container,peaks,preload){var media=document.createElement(this.mediaType);media.controls=this.params.mediaControls;media.autoplay=this.params.autoplay||!1;media.preload=null==preload?"auto":preload;media.src=url;media.style.width="100%";var prevMedia=container.querySelector(this.mediaType);if(prevMedia){container.removeChild(prevMedia)}container.appendChild(media);this._load(media,peaks)}},{key:"loadElt",value:function(elt,peaks){elt.controls=this.params.mediaControls;elt.autoplay=this.params.autoplay||!1;this._load(elt,peaks)}},{key:"_load",value:function(media,peaks){var _this3=this;if("function"==typeof media.load){media.load()}media.addEventListener("error",function(){_this3.fireEvent("error","Error loading media element")});media.addEventListener("canplay",function(){_this3.fireEvent("canplay")});media.addEventListener("ended",function(){_this3.fireEvent("finish")});media.addEventListener("play",function(){_this3.fireEvent("play")});media.addEventListener("pause",function(){_this3.fireEvent("pause")});this.media=media;this.peaks=peaks;this.onPlayEnd=null;this.buffer=null;this.setPlaybackRate(this.playbackRate);this.setVolume(this.volume)}},{key:"isPaused",value:function(){return!this.media||this.media.paused}},{key:"getDuration",value:function(){if(this.explicitDuration){return this.explicitDuration}var duration=(this.buffer||this.media).duration;if(duration>=1/0){duration=this.media.seekable.end(0)}return duration}},{key:"getCurrentTime",value:function(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function(value){this.playbackRate=value||1;this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function(start){if(null!=start){this.media.currentTime=start}this.clearPlayEnd()}},{key:"play",value:function(start,end){this.seekTo(start);var promise=this.media.play();end&&this.setPlayEnd(end);return promise}},{key:"pause",value:function(){var promise;if(this.media){promise=this.media.pause()}this.clearPlayEnd();return promise}},{key:"setPlayEnd",value:function(end){var _this4=this;this._onPlayEnd=function(time){if(time>=end){_this4.pause();_this4.seekTo(end)}};this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function(){if(this._onPlayEnd){this.un("audioprocess",this._onPlayEnd);this._onPlayEnd=null}}},{key:"getPeaks",value:function(length,first,last){if(this.buffer){return _get(_getPrototypeOf(MediaElement.prototype),"getPeaks",this).call(this,length,first,last)}return this.peaks||[]}},{key:"setSinkId",value:function(deviceId){if(deviceId){if(!this.media.setSinkId){return Promise.reject(new Error("setSinkId is not supported in your browser"))}return this.media.setSinkId(deviceId)}return Promise.reject(new Error("Invalid deviceId: "+deviceId))}},{key:"getVolume",value:function(){return this.volume||this.media.volume}},{key:"setVolume",value:function(value){this.volume=value;this.media.volume=this.volume}},{key:"destroy",value:function(){this.pause();this.unAll();if(this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode){this.media.parentNode.removeChild(this.media)}this.media=null}}]);return MediaElement}(_webaudio.default);exports.default=MediaElement;module.exports=exports.default},"./src/peakcache.js":function srcPeakcacheJs(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;function _classCallCheck(instance,Constructor){if(!babelHelpers.instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var PeakCache=function(){function PeakCache(){_classCallCheck(this,PeakCache);this.clearPeakCache()}_createClass(PeakCache,[{key:"clearPeakCache",value:function(){this.peakCacheRanges=[];this.peakCacheLength=-1}},{key:"addRangeToPeakCache",value:function(length,start,end){if(length!=this.peakCacheLength){this.clearPeakCache();this.peakCacheLength=length}var uncachedRanges=[],i=0;while(i<this.peakCacheRanges.length&&this.peakCacheRanges[i]<start){i++}if(0==i%2){uncachedRanges.push(start)}while(i<this.peakCacheRanges.length&&this.peakCacheRanges[i]<=end){uncachedRanges.push(this.peakCacheRanges[i]);i++}if(0==i%2){uncachedRanges.push(end)}uncachedRanges=uncachedRanges.filter(function(item,pos,arr){if(0==pos){return item!=arr[pos+1]}else if(pos==arr.length-1){return item!=arr[pos-1]}return item!=arr[pos-1]&&item!=arr[pos+1]});this.peakCacheRanges=this.peakCacheRanges.concat(uncachedRanges);this.peakCacheRanges=this.peakCacheRanges.sort(function(a,b){return a-b}).filter(function(item,pos,arr){if(0==pos){return item!=arr[pos+1]}else if(pos==arr.length-1){return item!=arr[pos-1]}return item!=arr[pos-1]&&item!=arr[pos+1]});var uncachedRangePairs=[];for(i=0;i<uncachedRanges.length;i+=2){uncachedRangePairs.push([uncachedRanges[i],uncachedRanges[i+1]])}return uncachedRangePairs}},{key:"getCacheRanges",value:function(){var peakCacheRangePairs=[],i;for(i=0;i<this.peakCacheRanges.length;i+=2){peakCacheRangePairs.push([this.peakCacheRanges[i],this.peakCacheRanges[i+1]])}return peakCacheRangePairs}}]);return PeakCache}();exports.default=PeakCache;module.exports=exports.default},"./src/util/ajax.js":function srcUtilAjaxJs(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(options){var instance=new _observer.default,xhr=new XMLHttpRequest,fired100=!1;xhr.open(options.method||"GET",options.url,!0);xhr.responseType=options.responseType||"json";if(options.xhr){if(options.xhr.requestHeaders){options.xhr.requestHeaders.forEach(function(header){xhr.setRequestHeader(header.key,header.value)})}if(options.xhr.withCredentials){xhr.withCredentials=!0}}xhr.addEventListener("progress",function(e){instance.fireEvent("progress",e);if(e.lengthComputable&&e.loaded==e.total){fired100=!0}});xhr.addEventListener("load",function(e){if(!fired100){instance.fireEvent("progress",e)}instance.fireEvent("load",e);if(200==xhr.status||206==xhr.status){instance.fireEvent("success",xhr.response,e)}else{instance.fireEvent("error",e)}});xhr.addEventListener("error",function(e){return instance.fireEvent("error",e)});xhr.send();instance.xhr=xhr;return instance};var _observer=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__("./src/util/observer.js"));module.exports=exports.default},"./src/util/extend.js":function srcUtilExtendJs(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(dest){for(var _len=arguments.length,sources=Array(1<_len?_len-1:0),_key=1;_key<_len;_key++){sources[_key-1]=arguments[_key]}sources.forEach(function(source){Object.keys(source).forEach(function(key){dest[key]=source[key]})});return dest};module.exports=exports.default},"./src/util/frame.js":function srcUtilFrameJs(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(func){return function(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}return(0,_requestAnimationFrame.default)(function(){return func.apply(void 0,args)})}};var _requestAnimationFrame=function(obj){return obj&&obj.__esModule?obj:{default:obj}}(__webpack_require__("./src/util/request-animation-frame.js"));module.exports=exports.default},"./src/util/get-id.js":function srcUtilGetIdJs(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(){return"wavesurfer_"+Math.random().toString(32).substring(2)};module.exports=exports.default},"./src/util/index.js":function srcUtilIndexJs(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});Object.defineProperty(exports,"ajax",{enumerable:!0,get:function(){return _ajax.default}});Object.defineProperty(exports,"getId",{enumerable:!0,get:function(){return _getId.default}});Object.defineProperty(exports,"max",{enumerable:!0,get:function(){return _max.default}});Object.defineProperty(exports,"min",{enumerable:!0,get:function(){return _min.default}});Object.defineProperty(exports,"Observer",{enumerable:!0,get:function(){return _observer.default}});Object.defineProperty(exports,"extend",{enumerable:!0,get:function(){return _extend.default}});Object.defineProperty(exports,"style",{enumerable:!0,get:function(){return _style.default}});Object.defineProperty(exports,"requestAnimationFrame",{enumerable:!0,get:function(){return _requestAnimationFrame.default}});Object.defineProperty(exports,"frame",{enumerable:!0,get:function(){return _frame.default}});Object.defineProperty(exports,"debounce",{enumerable:!0,get:function(){return _debounce.default}});Object.defineProperty(exports,"preventClick",{enumerable:!0,get:function(){return _preventClick.default}});var _ajax=_interopRequireDefault(__webpack_require__("./src/util/ajax.js")),_getId=_interopRequireDefault(__webpack_require__("./src/util/get-id.js")),_max=_interopRequireDefault(__webpack_require__("./src/util/max.js")),_min=_interopRequireDefault(__webpack_require__("./src/util/min.js")),_observer=_interopRequireDefault(__webpack_require__("./src/util/observer.js")),_extend=_interopRequireDefault(__webpack_require__("./src/util/extend.js")),_style=_interopRequireDefault(__webpack_require__("./src/util/style.js")),_requestAnimationFrame=_interopRequireDefault(__webpack_require__("./src/util/request-animation-frame.js")),_frame=_interopRequireDefault(__webpack_require__("./src/util/frame.js")),_debounce=_interopRequireDefault(__webpack_require__("./node_modules/debounce/index.js")),_preventClick=_interopRequireDefault(__webpack_require__("./src/util/prevent-click.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},"./src/util/max.js":function srcUtilMaxJs(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(values){var largest=-Infinity;Object.keys(values).forEach(function(i){if(values[i]>largest){largest=values[i]}});return largest};module.exports=exports.default},"./src/util/min.js":function srcUtilMinJs(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(values){var smallest=+Infinity;Object.keys(values).forEach(function(i){if(values[i]<smallest){smallest=values[i]}});return smallest};module.exports=exports.default},"./src/util/observer.js":function srcUtilObserverJs(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;function _classCallCheck(instance,Constructor){if(!babelHelpers.instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var Observer=function(){function Observer(){_classCallCheck(this,Observer);this.handlers=null}_createClass(Observer,[{key:"on",value:function(event,fn){var _this=this;if(!this.handlers){this.handlers={}}var handlers=this.handlers[event];if(!handlers){handlers=this.handlers[event]=[]}handlers.push(fn);return{name:event,callback:fn,un:function(e,fn){return _this.un(e,fn)}}}},{key:"un",value:function(event,fn){if(!this.handlers){return}var handlers=this.handlers[event],i;if(handlers){if(fn){for(i=handlers.length-1;0<=i;i--){if(handlers[i]==fn){handlers.splice(i,1)}}}else{handlers.length=0}}}},{key:"unAll",value:function(){this.handlers=null}},{key:"once",value:function(event,handler){var _this2=this;return this.on(event,function fn(){for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key]}handler.apply(_this2,args);setTimeout(function(){_this2.un(event,fn)},0)})}},{key:"fireEvent",value:function(event){for(var _len2=arguments.length,args=Array(1<_len2?_len2-1:0),_key2=1;_key2<_len2;_key2++){args[_key2-1]=arguments[_key2]}if(!this.handlers){return}var handlers=this.handlers[event];handlers&&handlers.forEach(function(fn){fn.apply(void 0,args)})}}]);return Observer}();exports.default=Observer;module.exports=exports.default},"./src/util/prevent-click.js":function srcUtilPreventClickJs(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(){document.body.addEventListener("click",preventClickHandler,!0)};function preventClickHandler(e){e.stopPropagation();document.body.removeEventListener("click",preventClickHandler,!0)}module.exports=exports.default},"./src/util/request-animation-frame.js":function srcUtilRequestAnimationFrameJs(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var _default=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){return setTimeout(callback,1e3/60)}).bind(window);exports.default=_default;module.exports=exports.default},"./src/util/style.js":function srcUtilStyleJs(module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=function(el,styles){Object.keys(styles).forEach(function(prop){if(el.style[prop]!==styles[prop]){el.style[prop]=styles[prop]}});return el};module.exports=exports.default},"./src/wavesurfer.js":function srcWavesurferJs(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var util=function(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(null!=obj){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}(__webpack_require__("./src/util/index.js")),_drawer=_interopRequireDefault(__webpack_require__("./src/drawer.multicanvas.js")),_webaudio=_interopRequireDefault(__webpack_require__("./src/webaudio.js")),_mediaelement=_interopRequireDefault(__webpack_require__("./src/mediaelement.js")),_peakcache=_interopRequireDefault(__webpack_require__("./src/peakcache.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _typeof(obj){if("function"===typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)){_typeof=function(obj){return babelHelpers.typeof(obj)}}else{_typeof=function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":babelHelpers.typeof(obj)}}return _typeof(obj)}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"===typeof call)){return call}return _assertThisInitialized(self)}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}function _assertThisInitialized(self){if(void 0===self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _classCallCheck(instance,Constructor){if(!babelHelpers.instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}var PluginClass=function(){_createClass(PluginClass,[{key:"create",value:function(){}}]);function PluginClass(){_classCallCheck(this,PluginClass)}_createClass(PluginClass,[{key:"init",value:function(){}},{key:"destroy",value:function(){}}]);return PluginClass}(),WaveSurfer=function(_util$Observer){_inherits(WaveSurfer,_util$Observer);_createClass(WaveSurfer,null,[{key:"create",value:function(params){var wavesurfer=new WaveSurfer(params);return wavesurfer.init()}}]);function WaveSurfer(params){var _this;_classCallCheck(this,WaveSurfer);_this=_possibleConstructorReturn(this,_getPrototypeOf(WaveSurfer).call(this));_this.defaultParams={audioContext:null,audioRate:1,autoCenter:!0,backend:"WebAudio",barHeight:1,barGap:null,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,loopSelection:!0,maxCanvasWidth:4e3,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,normalize:!1,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"#555",removeMediaElementOnDestroy:!0,renderer:_drawer.default,responsive:!1,scrollParent:!1,skipLength:2,splitChannels:!1,waveColor:"#999",xhr:{}};_this.backends={MediaElement:_mediaelement.default,WebAudio:_webaudio.default};_this.util=util;_this.params=util.extend({},_this.defaultParams,params);_this.container="string"==typeof params.container?document.querySelector(_this.params.container):_this.params.container;if(!_this.container){throw new Error("Container element not found")}if(null==_this.params.mediaContainer){_this.mediaContainer=_this.container}else if("string"==typeof _this.params.mediaContainer){_this.mediaContainer=document.querySelector(_this.params.mediaContainer)}else{_this.mediaContainer=_this.params.mediaContainer}if(!_this.mediaContainer){throw new Error("Media Container element not found")}if(1>=_this.params.maxCanvasWidth){throw new Error("maxCanvasWidth must be greater than 1")}else if(1==_this.params.maxCanvasWidth%2){throw new Error("maxCanvasWidth must be an even number")}_this.savedVolume=0;_this.isMuted=!1;_this.tmpEvents=[];_this.currentAjax=null;_this.arraybuffer=null;_this.drawer=null;_this.backend=null;_this.peakCache=null;if("function"!==typeof _this.params.renderer){throw new Error("Renderer parameter is invalid")}_this.Drawer=_this.params.renderer;_this.Backend=_this.backends[_this.params.backend];_this.initialisedPluginList={};_this.isDestroyed=!1;_this.isReady=!1;var prevWidth=0;_this._onResize=util.debounce(function(){if(prevWidth!=_this.drawer.wrapper.clientWidth&&!_this.params.scrollParent){prevWidth=_this.drawer.wrapper.clientWidth;_this.drawer.fireEvent("redraw")}},"number"===typeof _this.params.responsive?_this.params.responsive:100);return _possibleConstructorReturn(_this,_assertThisInitialized(_assertThisInitialized(_this)))}_createClass(WaveSurfer,[{key:"init",value:function(){this.registerPlugins(this.params.plugins);this.createDrawer();this.createBackend();this.createPeakCache();return this}},{key:"registerPlugins",value:function(plugins){var _this2=this;plugins.forEach(function(plugin){return _this2.addPlugin(plugin)});plugins.forEach(function(plugin){if(!plugin.deferInit){_this2.initPlugin(plugin.name)}});this.fireEvent("plugins-registered",plugins);return this}},{key:"addPlugin",value:function(plugin){var _this3=this;if(!plugin.name){throw new Error("Plugin does not have a name!")}if(!plugin.instance){throw new Error("Plugin ".concat(plugin.name," does not have an instance property!"))}if(plugin.staticProps){Object.keys(plugin.staticProps).forEach(function(pluginStaticProp){_this3[pluginStaticProp]=plugin.staticProps[pluginStaticProp]})}var Instance=plugin.instance,observerPrototypeKeys=Object.getOwnPropertyNames(util.Observer.prototype);observerPrototypeKeys.forEach(function(key){Instance.prototype[key]=util.Observer.prototype[key]});this[plugin.name]=new Instance(plugin.params||{},this);this.fireEvent("plugin-added",plugin.name);return this}},{key:"initPlugin",value:function(name){if(!this[name]){throw new Error("Plugin ".concat(name," has not been added yet!"))}if(this.initialisedPluginList[name]){this.destroyPlugin(name)}this[name].init();this.initialisedPluginList[name]=!0;this.fireEvent("plugin-initialised",name);return this}},{key:"destroyPlugin",value:function(name){if(!this[name]){throw new Error("Plugin ".concat(name," has not been added yet and cannot be destroyed!"))}if(!this.initialisedPluginList[name]){throw new Error("Plugin ".concat(name," is not active and cannot be destroyed!"))}if("function"!==typeof this[name].destroy){throw new Error("Plugin ".concat(name," does not have a destroy function!"))}this[name].destroy();delete this.initialisedPluginList[name];this.fireEvent("plugin-destroyed",name);return this}},{key:"destroyAllPlugins",value:function(){var _this4=this;Object.keys(this.initialisedPluginList).forEach(function(name){return _this4.destroyPlugin(name)})}},{key:"createDrawer",value:function(){var _this5=this;this.drawer=new this.Drawer(this.container,this.params);this.drawer.init();this.fireEvent("drawer-created",this.drawer);if(!1!==this.params.responsive){window.addEventListener("resize",this._onResize,!0);window.addEventListener("orientationchange",this._onResize,!0)}this.drawer.on("redraw",function(){_this5.drawBuffer();_this5.drawer.progress(_this5.backend.getPlayedPercents())});this.drawer.on("click",function(e,progress){setTimeout(function(){return _this5.seekTo(progress)},0)});this.drawer.on("scroll",function(e){if(_this5.params.partialRender){_this5.drawBuffer()}_this5.fireEvent("scroll",e)})}},{key:"createBackend",value:function(){var _this6=this;if(this.backend){this.backend.destroy()}if("AudioElement"==this.params.backend){this.params.backend="MediaElement"}if("WebAudio"==this.params.backend&&!this.Backend.prototype.supportsWebAudio.call(null)){this.params.backend="MediaElement"}this.backend=new this.Backend(this.params);this.backend.init();this.fireEvent("backend-created",this.backend);this.backend.on("finish",function(){return _this6.fireEvent("finish")});this.backend.on("play",function(){return _this6.fireEvent("play")});this.backend.on("pause",function(){return _this6.fireEvent("pause")});this.backend.on("audioprocess",function(time){_this6.drawer.progress(_this6.backend.getPlayedPercents());_this6.fireEvent("audioprocess",time)})}},{key:"createPeakCache",value:function(){if(this.params.partialRender){this.peakCache=new _peakcache.default}}},{key:"getDuration",value:function(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function(seconds){if(seconds>=this.getDuration()){this.seekTo(1)}else{this.seekTo(seconds/this.getDuration())}}},{key:"play",value:function(start,end){var _this7=this;this.fireEvent("interaction",function(){return _this7.play(start,end)});return this.backend.play(start,end)}},{key:"pause",value:function(){if(!this.backend.isPaused()){return this.backend.pause()}}},{key:"playPause",value:function(){return this.backend.isPaused()?this.play():this.pause()}},{key:"isPlaying",value:function(){return!this.backend.isPaused()}},{key:"skipBackward",value:function(seconds){this.skip(-seconds||-this.params.skipLength)}},{key:"skipForward",value:function(seconds){this.skip(seconds||this.params.skipLength)}},{key:"skip",value:function(offset){var duration=this.getDuration()||1,position=this.getCurrentTime()||0;position=_Mathmax(0,_Mathmin(duration,position+(offset||0)));this.seekAndCenter(position/duration)}},{key:"seekAndCenter",value:function(progress){this.seekTo(progress);this.drawer.recenter(progress)}},{key:"seekTo",value:function(progress){var _this8=this;if("number"!==typeof progress||!isFinite(progress)||0>progress||1<progress){return console.error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!")}this.fireEvent("interaction",function(){return _this8.seekTo(progress)});var paused=this.backend.isPaused();if(!paused){this.backend.pause()}var oldScrollParent=this.params.scrollParent;this.params.scrollParent=!1;this.backend.seekTo(progress*this.getDuration());this.drawer.progress(progress);if(!paused){this.backend.play()}this.params.scrollParent=oldScrollParent;this.fireEvent("seek",progress)}},{key:"stop",value:function(){this.pause();this.seekTo(0);this.drawer.progress(0)}},{key:"setSinkId",value:function(deviceId){return this.backend.setSinkId(deviceId)}},{key:"setVolume",value:function(newVolume){this.backend.setVolume(newVolume);this.fireEvent("volume",newVolume)}},{key:"getVolume",value:function(){return this.backend.getVolume()}},{key:"setPlaybackRate",value:function(rate){this.backend.setPlaybackRate(rate)}},{key:"getPlaybackRate",value:function(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function(){this.setMute(!this.isMuted)}},{key:"setMute",value:function(mute){if(mute===this.isMuted){this.fireEvent("mute",this.isMuted);return}if(mute){this.savedVolume=this.backend.getVolume();this.backend.setVolume(0);this.isMuted=!0;this.fireEvent("volume",0)}else{this.backend.setVolume(this.savedVolume);this.isMuted=!1;this.fireEvent("volume",this.savedVolume)}this.fireEvent("mute",this.isMuted)}},{key:"getMute",value:function(){return this.isMuted}},{key:"isReady",value:function(){return this.isReady}},{key:"getFilters",value:function(){return this.backend.filters||[]}},{key:"toggleScroll",value:function(){this.params.scrollParent=!this.params.scrollParent;this.drawBuffer()}},{key:"toggleInteraction",value:function(){this.params.interact=!this.params.interact}},{key:"getWaveColor",value:function(){return this.params.waveColor}},{key:"setWaveColor",value:function(color){this.params.waveColor=color;this.drawBuffer()}},{key:"getProgressColor",value:function(){return this.params.progressColor}},{key:"setProgressColor",value:function(color){this.params.progressColor=color;this.drawBuffer()}},{key:"getCursorColor",value:function(){return this.params.cursorColor}},{key:"setCursorColor",value:function(color){this.params.cursorColor=color;this.drawer.updateCursor()}},{key:"getHeight",value:function(){return this.params.height}},{key:"setHeight",value:function(height){this.params.height=height;this.drawer.setHeight(height*this.params.pixelRatio);this.drawBuffer()}},{key:"drawBuffer",value:function(){var nominalWidth=_Mathround(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),parentWidth=this.drawer.getWidth(),width=nominalWidth,start=this.drawer.getScrollX(),end=_Mathmax(start+parentWidth,width);if(this.params.fillParent&&(!this.params.scrollParent||nominalWidth<parentWidth)){width=parentWidth;start=0;end=width}var peaks;if(this.params.partialRender){var newRanges=this.peakCache.addRangeToPeakCache(width,start,end),i;for(i=0;i<newRanges.length;i++){peaks=this.backend.getPeaks(width,newRanges[i][0],newRanges[i][1]);this.drawer.drawPeaks(peaks,width,newRanges[i][0],newRanges[i][1])}}else{peaks=this.backend.getPeaks(width,start,end);this.drawer.drawPeaks(peaks,width,start,end)}this.fireEvent("redraw",peaks,width)}},{key:"zoom",value:function(pxPerSec){if(!pxPerSec){this.params.minPxPerSec=this.defaultParams.minPxPerSec;this.params.scrollParent=!1}else{this.params.minPxPerSec=pxPerSec;this.params.scrollParent=!0}this.drawBuffer();this.drawer.progress(this.backend.getPlayedPercents());this.drawer.recenter(this.getCurrentTime()/this.getDuration());this.fireEvent("zoom",pxPerSec)}},{key:"loadArrayBuffer",value:function(arraybuffer){var _this9=this;this.decodeArrayBuffer(arraybuffer,function(data){if(!_this9.isDestroyed){_this9.loadDecodedBuffer(data)}})}},{key:"loadDecodedBuffer",value:function(buffer){this.backend.load(buffer);this.drawBuffer();this.fireEvent("ready");this.isReady=!0}},{key:"loadBlob",value:function(blob){var _this10=this,reader=new FileReader;reader.addEventListener("progress",function(e){return _this10.onProgress(e)});reader.addEventListener("load",function(e){return _this10.loadArrayBuffer(e.target.result)});reader.addEventListener("error",function(){return _this10.fireEvent("error","Error reading file")});reader.readAsArrayBuffer(blob);this.empty()}},{key:"load",value:function(url,peaks,preload,duration){this.empty();if(preload){var preloadIgnoreReasons={"Preload is not 'auto', 'none' or 'metadata'":-1===["auto","metadata","none"].indexOf(preload),"Peaks are not provided":!peaks,"Backend is not of type MediaElement":"MediaElement"!==this.params.backend,"Url is not of type string":"string"!==typeof url},activeReasons=Object.keys(preloadIgnoreReasons).filter(function(reason){return preloadIgnoreReasons[reason]});if(activeReasons.length){console.warn("Preload parameter of wavesurfer.load will be ignored because:\n\t- "+activeReasons.join("\n\t- "));preload=null}}switch(this.params.backend){case"WebAudio":return this.loadBuffer(url,peaks,duration);case"MediaElement":return this.loadMediaElement(url,peaks,preload,duration);}}},{key:"loadBuffer",value:function(url,peaks,duration){var _this11=this,load=function(action){if(action){_this11.tmpEvents.push(_this11.once("ready",action))}return _this11.getArrayBuffer(url,function(data){return _this11.loadArrayBuffer(data)})};if(peaks){this.backend.setPeaks(peaks,duration);this.drawBuffer();this.tmpEvents.push(this.once("interaction",load))}else{return load()}}},{key:"loadMediaElement",value:function(urlOrElt,peaks,preload,duration){var _this12=this,url=urlOrElt;if("string"===typeof urlOrElt){this.backend.load(url,this.mediaContainer,peaks,preload)}else{var elt=urlOrElt;this.backend.loadElt(elt,peaks);url=elt.src}this.tmpEvents.push(this.backend.once("canplay",function(){_this12.drawBuffer();_this12.fireEvent("ready");_this12.isReady=!0}),this.backend.once("error",function(err){return _this12.fireEvent("error",err)}));if(peaks){this.backend.setPeaks(peaks,duration)}if((!peaks||this.params.forceDecode)&&this.backend.supportsWebAudio()){this.getArrayBuffer(url,function(arraybuffer){_this12.decodeArrayBuffer(arraybuffer,function(buffer){_this12.backend.buffer=buffer;_this12.backend.setPeaks(null);_this12.drawBuffer();_this12.fireEvent("waveform-ready")})})}}},{key:"decodeArrayBuffer",value:function(arraybuffer,callback){var _this13=this;this.arraybuffer=arraybuffer;this.backend.decodeArrayBuffer(arraybuffer,function(data){if(!_this13.isDestroyed&&_this13.arraybuffer==arraybuffer){callback(data);_this13.arraybuffer=null}},function(){return _this13.fireEvent("error","Error decoding audiobuffer")})}},{key:"getArrayBuffer",value:function(url,callback){var _this14=this,ajax=util.ajax({url:url,responseType:"arraybuffer",xhr:this.params.xhr});this.currentAjax=ajax;this.tmpEvents.push(ajax.on("progress",function(e){_this14.onProgress(e)}),ajax.on("success",function(data){callback(data);_this14.currentAjax=null}),ajax.on("error",function(e){_this14.fireEvent("error","XHR error: "+e.target.statusText);_this14.currentAjax=null}));return ajax}},{key:"onProgress",value:function(e){var percentComplete;if(e.lengthComputable){percentComplete=e.loaded/e.total}else{percentComplete=e.loaded/(e.loaded+1e6)}this.fireEvent("loading",_Mathround(100*percentComplete),e.target)}},{key:"exportPCM",value:function(length,accuracy,noWindow,start){length=length||1024;start=start||0;accuracy=accuracy||1e4;noWindow=noWindow||!1;var peaks=this.backend.getPeaks(length,start),arr=[].map.call(peaks,function(val){return _Mathround(val*accuracy)/accuracy}),json=JSON.stringify(arr);if(!noWindow){window.open("data:application/json;charset=utf-8,"+encodeURIComponent(json))}return json}},{key:"exportImage",value:function(format,quality){if(!format){format="image/png"}if(!quality){quality=1}return this.drawer.getImage(format,quality)}},{key:"cancelAjax",value:function(){if(this.currentAjax){this.currentAjax.xhr.abort();this.currentAjax=null}}},{key:"clearTmpEvents",value:function(){this.tmpEvents.forEach(function(e){return e.un()})}},{key:"empty",value:function(){if(!this.backend.isPaused()){this.stop();this.backend.disconnectSource()}this.isReady=!1;this.cancelAjax();this.clearTmpEvents();this.drawer.progress(0);this.drawer.setWidth(0);this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}},{key:"destroy",value:function(){this.destroyAllPlugins();this.fireEvent("destroy");this.cancelAjax();this.clearTmpEvents();this.unAll();if(!1!==this.params.responsive){window.removeEventListener("resize",this._onResize,!0);window.removeEventListener("orientationchange",this._onResize,!0)}this.backend.destroy();this.drawer.destroy();this.isDestroyed=!0;this.isReady=!1;this.arraybuffer=null}}]);return WaveSurfer}(util.Observer);exports.default=WaveSurfer;WaveSurfer.VERSION="2.1.0";WaveSurfer.util=util;module.exports=exports.default},"./src/webaudio.js":function srcWebaudioJs(module,exports,__webpack_require__){"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.default=void 0;var util=function(obj){if(obj&&obj.__esModule){return obj}else{var newObj={};if(null!=obj){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key)){var desc=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):{};if(desc.get||desc.set){Object.defineProperty(newObj,key,desc)}else{newObj[key]=obj[key]}}}}newObj.default=obj;return newObj}}(__webpack_require__("./src/util/index.js"));function _typeof(obj){if("function"===typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)){_typeof=function(obj){return babelHelpers.typeof(obj)}}else{_typeof=function(obj){return obj&&"function"===typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":babelHelpers.typeof(obj)}}return _typeof(obj)}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0})}else{obj[key]=value}return obj}function _classCallCheck(instance,Constructor){if(!babelHelpers.instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}function _possibleConstructorReturn(self,call){if(call&&("object"===_typeof(call)||"function"===typeof call)){return call}return _assertThisInitialized(self)}function _assertThisInitialized(self){if(void 0===self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return self}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)};return _getPrototypeOf(o)}function _defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor}function _inherits(subClass,superClass){if("function"!==typeof superClass&&null!==superClass){throw new TypeError("Super expression must either be null or a function")}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}});if(superClass)_setPrototypeOf(subClass,superClass)}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function(o,p){o.__proto__=p;return o};return _setPrototypeOf(o,p)}var PLAYING="playing",PAUSED="paused",FINISHED="finished",WebAudio=function(_util$Observer){_inherits(WebAudio,_util$Observer);_createClass(WebAudio,[{key:"supportsWebAudio",value:function(){return!!(window.AudioContext||window.webkitAudioContext)}},{key:"getAudioContext",value:function(){if(!window.WaveSurferAudioContext){window.WaveSurferAudioContext=new(window.AudioContext||window.webkitAudioContext)}return window.WaveSurferAudioContext}},{key:"getOfflineAudioContext",value:function(sampleRate){if(!window.WaveSurferOfflineAudioContext){window.WaveSurferOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,sampleRate)}return window.WaveSurferOfflineAudioContext}}]);function WebAudio(params){var _this$stateBehaviors,_this$states,_this;_classCallCheck(this,WebAudio);_this=_possibleConstructorReturn(this,_getPrototypeOf(WebAudio).call(this));_this.audioContext=null;_this.offlineAudioContext=null;_this.stateBehaviors=(_this$stateBehaviors={},_defineProperty(_this$stateBehaviors,PLAYING,{init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var duration=this.getDuration();return this.getCurrentTime()/duration||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}}),_defineProperty(_this$stateBehaviors,PAUSED,{init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var duration=this.getDuration();return this.getCurrentTime()/duration||0},getCurrentTime:function(){return this.startPosition}}),_defineProperty(_this$stateBehaviors,FINISHED,{init:function(){this.removeOnAudioProcess();this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}}),_this$stateBehaviors);_this.params=params;_this.ac=params.audioContext||_this.getAudioContext();_this.lastPlay=_this.ac.currentTime;_this.startPosition=0;_this.scheduledPause=null;_this.states=(_this$states={},_defineProperty(_this$states,PLAYING,Object.create(_this.stateBehaviors[PLAYING])),_defineProperty(_this$states,PAUSED,Object.create(_this.stateBehaviors[PAUSED])),_defineProperty(_this$states,FINISHED,Object.create(_this.stateBehaviors[FINISHED])),_this$states);_this.analyser=null;_this.buffer=null;_this.filters=[];_this.gainNode=null;_this.mergedPeaks=null;_this.offlineAc=null;_this.peaks=null;_this.playbackRate=1;_this.analyser=null;_this.scriptNode=null;_this.source=null;_this.splitPeaks=[];_this.state=null;_this.explicitDuration=null;return _this}_createClass(WebAudio,[{key:"init",value:function(){this.createVolumeNode();this.createScriptNode();this.createAnalyserNode();this.setState(PAUSED);this.setPlaybackRate(this.params.audioRate);this.setLength(0)}},{key:"disconnectFilters",value:function(){if(this.filters){this.filters.forEach(function(filter){filter&&filter.disconnect()});this.filters=null;this.analyser.connect(this.gainNode)}}},{key:"setState",value:function(state){if(this.state!==this.states[state]){this.state=this.states[state];this.state.init.call(this)}}},{key:"setFilter",value:function(){for(var _len=arguments.length,filters=Array(_len),_key=0;_key<_len;_key++){filters[_key]=arguments[_key]}this.setFilters(filters)}},{key:"setFilters",value:function(filters){this.disconnectFilters();if(filters&&filters.length){this.filters=filters;this.analyser.disconnect();filters.reduce(function(prev,curr){prev.connect(curr);return curr},this.analyser).connect(this.gainNode)}}},{key:"createScriptNode",value:function(){if(this.params.audioScriptProcessor){this.scriptNode=this.params.audioScriptProcessor}else{if(this.ac.createScriptProcessor){this.scriptNode=this.ac.createScriptProcessor(WebAudio.scriptBufferSize)}else{this.scriptNode=this.ac.createJavaScriptNode(WebAudio.scriptBufferSize)}}this.scriptNode.connect(this.ac.destination)}},{key:"addOnAudioProcess",value:function(){var _this2=this;this.scriptNode.onaudioprocess=function(){var time=_this2.getCurrentTime();if(time>=_this2.getDuration()){_this2.setState(FINISHED);_this2.fireEvent("pause")}else if(time>=_this2.scheduledPause){_this2.pause()}else if(_this2.state===_this2.states[PLAYING]){_this2.fireEvent("audioprocess",time)}}}},{key:"removeOnAudioProcess",value:function(){this.scriptNode.onaudioprocess=null}},{key:"createAnalyserNode",value:function(){this.analyser=this.ac.createAnalyser();this.analyser.connect(this.gainNode)}},{key:"createVolumeNode",value:function(){if(this.ac.createGain){this.gainNode=this.ac.createGain()}else{this.gainNode=this.ac.createGainNode()}this.gainNode.connect(this.ac.destination)}},{key:"setSinkId",value:function(deviceId){if(deviceId){var audio=new window.Audio;if(!audio.setSinkId){return Promise.reject(new Error("setSinkId is not supported in your browser"))}audio.autoplay=!0;var dest=this.ac.createMediaStreamDestination();this.gainNode.disconnect();this.gainNode.connect(dest);audio.srcObject=dest.stream;return audio.setSinkId(deviceId)}else{return Promise.reject(new Error("Invalid deviceId: "+deviceId))}}},{key:"setVolume",value:function(value){this.gainNode.gain.setValueAtTime(value,this.ac.currentTime)}},{key:"getVolume",value:function(){return this.gainNode.gain.value}},{key:"decodeArrayBuffer",value:function(arraybuffer,callback,errback){if(!this.offlineAc){this.offlineAc=this.getOfflineAudioContext(this.ac&&this.ac.sampleRate?this.ac.sampleRate:44100)}this.offlineAc.decodeAudioData(arraybuffer,function(data){return callback(data)},errback)}},{key:"setPeaks",value:function(peaks,duration){this.explicitDuration=duration;this.peaks=peaks}},{key:"setLength",value:function(length){if(this.mergedPeaks&&length==2*this.mergedPeaks.length-1+2){return}this.splitPeaks=[];this.mergedPeaks=[];var channels=this.buffer?this.buffer.numberOfChannels:1,c;for(c=0;c<channels;c++){this.splitPeaks[c]=[];this.splitPeaks[c][2*(length-1)]=0;this.splitPeaks[c][2*(length-1)+1]=0}this.mergedPeaks[2*(length-1)]=0;this.mergedPeaks[2*(length-1)+1]=0}},{key:"getPeaks",value:function(length,first,last){if(this.peaks){return this.peaks}first=first||0;last=last||length-1;this.setLength(length);if(!this.buffer.length){var newBuffer=this.createBuffer(1,4096,this.sampleRate);this.buffer=newBuffer.buffer}var sampleSize=this.buffer.length/length,channels=this.buffer.numberOfChannels,c;for(c=0;c<channels;c++){var peaks=this.splitPeaks[c],chan=this.buffer.getChannelData(c),i=void 0;for(i=first;i<=last;i++){var start=~~(i*sampleSize),min=0,max=0,j=void 0;for(j=start;j<~~(start+sampleSize);j+=~~(sampleSize/10)||1){var value=chan[j];if(value>max){max=value}if(value<min){min=value}}peaks[2*i]=max;peaks[2*i+1]=min;if(0==c||max>this.mergedPeaks[2*i]){this.mergedPeaks[2*i]=max}if(0==c||min<this.mergedPeaks[2*i+1]){this.mergedPeaks[2*i+1]=min}}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}},{key:"getPlayedPercents",value:function(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function(){if(this.source){this.source.disconnect()}}},{key:"destroy",value:function(){if(!this.isPaused()){this.pause()}this.unAll();this.buffer=null;this.disconnectFilters();this.disconnectSource();this.gainNode.disconnect();this.scriptNode.disconnect();this.analyser.disconnect();if(this.params.closeAudioContext){if("function"===typeof this.ac.close&&"closed"!=this.ac.state){this.ac.close()}this.ac=null;if(!this.params.audioContext){window.WaveSurferAudioContext=null}else{this.params.audioContext=null}window.WaveSurferOfflineAudioContext=null}}},{key:"load",value:function(buffer){this.startPosition=0;this.lastPlay=this.ac.currentTime;this.buffer=buffer;this.createSource()}},{key:"createSource",value:function(){this.disconnectSource();this.source=this.ac.createBufferSource();this.source.start=this.source.start||this.source.noteGrainOn;this.source.stop=this.source.stop||this.source.noteOff;this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime);this.source.buffer=this.buffer;this.source.connect(this.analyser)}},{key:"isPaused",value:function(){return this.state!==this.states[PLAYING]}},{key:"getDuration",value:function(){if(!this.buffer){if(this.explicitDuration){return this.explicitDuration}return 0}return this.buffer.duration}},{key:"seekTo",value:function(start,end){if(!this.buffer){return}this.scheduledPause=null;if(null==start){start=this.getCurrentTime();if(start>=this.getDuration()){start=0}}if(null==end){end=this.getDuration()}this.startPosition=start;this.lastPlay=this.ac.currentTime;if(this.state===this.states[FINISHED]){this.setState(PAUSED)}return{start:start,end:end}}},{key:"getPlayedTime",value:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function(start,end){if(!this.buffer){return}this.createSource();var adjustedTime=this.seekTo(start,end);start=adjustedTime.start;end=adjustedTime.end;this.scheduledPause=end;this.source.start(0,start,end-start);if("suspended"==this.ac.state){this.ac.resume&&this.ac.resume()}this.setState(PLAYING);this.fireEvent("play")}},{key:"pause",value:function(){this.scheduledPause=null;this.startPosition+=this.getPlayedTime();this.source&&this.source.stop(0);this.setState(PAUSED);this.fireEvent("pause")}},{key:"getCurrentTime",value:function(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setPlaybackRate",value:function(value){value=value||1;if(this.isPaused()){this.playbackRate=value}else{this.pause();this.playbackRate=value;this.play()}}}]);return WebAudio}(util.Observer);exports.default=WebAudio;WebAudio.scriptBufferSize=256;module.exports=exports.default}})});