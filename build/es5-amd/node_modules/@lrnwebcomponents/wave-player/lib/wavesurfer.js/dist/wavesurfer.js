(function(r,n){"object"===("undefined"===typeof exports?"undefined":babelHelpers.typeof(exports))&&"object"===("undefined"===typeof module?"undefined":babelHelpers.typeof(module))?module.exports=n():"function"===typeof define&&define.amd?define("WaveSurfer",[],n):"object"===("undefined"===typeof exports?"undefined":babelHelpers.typeof(exports))?exports.WaveSurfer=n():r.WaveSurfer=n()})(window,function(){return function(t){function r(s){if(n[s])return n[s].exports;var l=n[s]={i:s,l:!1,exports:{}};return t[s].call(l.exports,l,l.exports,r),l.l=!0,l.exports}var n={};return r.m=t,r.c=n,r.d=function(s,l,d){r.o(s,l)||Object.defineProperty(s,l,{enumerable:!0,get:d})},r.r=function(s){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},r.t=function(s,l){if(1&l&&(s=r(s)),8&l)return s;if(4&l&&"object"===("undefined"===typeof s?"undefined":babelHelpers.typeof(s))&&s&&s.__esModule)return s;var d=Object.create(null);if(r.r(d),Object.defineProperty(d,"default",{enumerable:!0,value:s}),2&l&&"string"!=typeof s)for(var u in s)r.d(d,u,function(f){return s[f]}.bind(null,u));return d},r.n=function(s){var l=s&&s.__esModule?function(){return s["default"]}:function(){return s};return r.d(l,"a",l),l},r.o=function(s,l){return Object.prototype.hasOwnProperty.call(s,l)},r.p="",r(r.s="./src/wavesurfer.js")}({"./node_modules/debounce/index.js":function(r){function s(l,d,u){function f(){var C=Date.now()-g;C<d&&0<=C?m=setTimeout(f,d-C):(m=null,!u&&(P=l.apply(k,v),k=v=null))}var m,v,k,g,P;null==d&&(d=100);var w=function(){k=this,v=arguments,g=Date.now();var E=u&&!m;return m||(m=setTimeout(f,d)),E&&(P=l.apply(k,v),k=v=null),P};return w.clear=function(){m&&(clearTimeout(m),m=null)},w.flush=function(){m&&(P=l.apply(k,v),k=v=null,clearTimeout(m),m=null)},w}s.debounce=s,r.exports=s},"./src/drawer.js":function(r,n,s){"use strict";function d(_){return d="function"===typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(S){return"undefined"===typeof S?"undefined":babelHelpers.typeof(S)}:function(S){return S&&"function"===typeof Symbol&&S.constructor===Symbol&&S!==Symbol.prototype?"symbol":"undefined"===typeof S?"undefined":babelHelpers.typeof(S)},d(_)}function u(_,R){if(!(_ instanceof R))throw new TypeError("Cannot call a class as a function")}function f(_,R){for(var A,S=0;S<R.length;S++)A=R[S],A.enumerable=A.enumerable||!1,A.configurable=!0,"value"in A&&(A.writable=!0),Object.defineProperty(_,A.key,A)}function m(_,R,S){return R&&f(_.prototype,R),S&&f(_,S),_}function v(_,R){return R&&("object"===d(R)||"function"===typeof R)?R:k(_)}function k(_){if(void 0===_)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return _}function g(_){return g=Object.setPrototypeOf?Object.getPrototypeOf:function(S){return S.__proto__||Object.getPrototypeOf(S)},g(_)}function P(_,R){if("function"!==typeof R&&null!==R)throw new TypeError("Super expression must either be null or a function");_.prototype=Object.create(R&&R.prototype,{constructor:{value:_,writable:!0,configurable:!0}}),R&&w(_,R)}function w(_,R){return w=Object.setPrototypeOf||function(A,W){return A.__proto__=W,A},w(_,R)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var C=function(_){if(_&&_.__esModule)return _;var R={};if(null!=_)for(var S in _)if(Object.prototype.hasOwnProperty.call(_,S)){var A=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(_,S):{};A.get||A.set?Object.defineProperty(R,S,A):R[S]=_[S]}return R.default=_,R}(s("./src/util/index.js")),E=function(_){function R(S,A){var W;return u(this,R),W=v(this,g(R).call(this)),W.container=S,W.params=A,W.width=0,W.height=A.height*W.params.pixelRatio,W.lastPos=0,W.wrapper=null,W}return P(R,_),m(R,[{key:"style",value:function(A,W){return C.style(A,W)}},{key:"createWrapper",value:function(){this.wrapper=this.container.appendChild(document.createElement("wave")),this.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:this.params.height+"px"}),(this.params.fillParent||this.params.scrollParent)&&this.style(this.wrapper,{width:"100%",overflowX:this.params.hideScrollbar?"hidden":"auto",overflowY:"hidden"}),this.setupWrapperEvents()}},{key:"handleEvent",value:function(A,W){W||A.preventDefault();var B,T=A.targetTouches?A.targetTouches[0].clientX:A.clientX,O=this.wrapper.getBoundingClientRect(),D=this.width,M=this.getWidth();return!this.params.fillParent&&D<M?(B=(T-O.left)*(this.params.pixelRatio/D)||0,1<B&&(B=1)):B=(T-O.left+this.wrapper.scrollLeft)/this.wrapper.scrollWidth||0,B}},{key:"setupWrapperEvents",value:function(){var A=this;this.wrapper.addEventListener("click",function(W){var T=A.wrapper.offsetHeight-A.wrapper.clientHeight;if(0!=T){var O=A.wrapper.getBoundingClientRect();if(W.clientY>=O.bottom-T)return}A.params.interact&&A.fireEvent("click",W,A.handleEvent(W))}),this.wrapper.addEventListener("scroll",function(W){return A.fireEvent("scroll",W)})}},{key:"drawPeaks",value:function(A,W,T,O){this.setWidth(W)||this.clearWave(),this.params.barWidth?this.drawBars(A,0,T,O):this.drawWave(A,0,T,O)}},{key:"resetScroll",value:function(){null!==this.wrapper&&(this.wrapper.scrollLeft=0)}},{key:"recenter",value:function(A){var W=this.wrapper.scrollWidth*A;this.recenterOnPosition(W,!0)}},{key:"recenterOnPosition",value:function(A,W){var T=this.wrapper.scrollLeft,O=~~(this.wrapper.clientWidth/2),D=this.wrapper.scrollWidth-this.wrapper.clientWidth,M=A-O,B=M-T;if(0!=D){if(!W&&-O<=B&&B<O){var L=5;B=Math.max(-L,Math.min(L,B)),M=T+B}M=Math.max(0,Math.min(D,M)),M!=T&&(this.wrapper.scrollLeft=M)}}},{key:"getScrollX",value:function(){var A=this.params.pixelRatio,W=Math.round(this.wrapper.scrollLeft*A);if(this.params.scrollParent){var T=~~(this.wrapper.scrollWidth*A-this.getWidth());W=Math.min(T,Math.max(0,W))}return W}},{key:"getWidth",value:function(){return Math.round(this.container.clientWidth*this.params.pixelRatio)}},{key:"setWidth",value:function(A){return this.width!=A&&(this.width=A,this.params.fillParent||this.params.scrollParent?this.style(this.wrapper,{width:""}):this.style(this.wrapper,{width:~~(this.width/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}},{key:"setHeight",value:function(A){return A!=this.height&&(this.height=A,this.style(this.wrapper,{height:~~(this.height/this.params.pixelRatio)+"px"}),this.updateSize(),!0)}},{key:"progress",value:function(A){var W=1/this.params.pixelRatio,T=Math.round(A*this.width)*W;if(T<this.lastPos||T-this.lastPos>=W){if(this.lastPos=T,this.params.scrollParent&&this.params.autoCenter){var O=~~(this.wrapper.scrollWidth*A);this.recenterOnPosition(O)}this.updateProgress(T)}}},{key:"destroy",value:function(){this.unAll(),this.wrapper&&(this.wrapper.parentNode==this.container&&this.container.removeChild(this.wrapper),this.wrapper=null)}},{key:"updateCursor",value:function(){}},{key:"updateSize",value:function(){}},{key:"drawBars",value:function(){}},{key:"drawWave",value:function(){}},{key:"clearWave",value:function(){}},{key:"updateProgress",value:function(){}}]),R}(C.Observer);n.default=E,r.exports=n.default},"./src/drawer.multicanvas.js":function(r,n,s){"use strict";function u(S){return u="function"===typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(W){return"undefined"===typeof W?"undefined":babelHelpers.typeof(W)}:function(W){return W&&"function"===typeof Symbol&&W.constructor===Symbol&&W!==Symbol.prototype?"symbol":"undefined"===typeof W?"undefined":babelHelpers.typeof(W)},u(S)}function f(S,A){if(!(S instanceof A))throw new TypeError("Cannot call a class as a function")}function m(S,A){for(var T,W=0;W<A.length;W++)T=A[W],T.enumerable=T.enumerable||!1,T.configurable=!0,"value"in T&&(T.writable=!0),Object.defineProperty(S,T.key,T)}function v(S,A,W){return A&&m(S.prototype,A),W&&m(S,W),S}function k(S,A){return A&&("object"===u(A)||"function"===typeof A)?A:g(S)}function g(S){if(void 0===S)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return S}function P(S){return P=Object.setPrototypeOf?Object.getPrototypeOf:function(W){return W.__proto__||Object.getPrototypeOf(W)},P(S)}function w(S,A){if("function"!==typeof A&&null!==A)throw new TypeError("Super expression must either be null or a function");S.prototype=Object.create(A&&A.prototype,{constructor:{value:S,writable:!0,configurable:!0}}),A&&C(S,A)}function C(S,A){return C=Object.setPrototypeOf||function(T,O){return T.__proto__=O,T},C(S,A)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var E=function(S){return S&&S.__esModule?S:{default:S}}(s("./src/drawer.js")),_=function(S){if(S&&S.__esModule)return S;var A={};if(null!=S)for(var W in S)if(Object.prototype.hasOwnProperty.call(S,W)){var T=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(S,W):{};T.get||T.set?Object.defineProperty(A,W,T):A[W]=S[W]}return A.default=S,A}(s("./src/util/index.js")),R=function(S){function A(W,T){var O;return f(this,A),O=k(this,P(A).call(this,W,T)),O.maxCanvasWidth=T.maxCanvasWidth,O.maxCanvasElementWidth=Math.round(T.maxCanvasWidth/T.pixelRatio),O.hasProgressCanvas=T.waveColor!=T.progressColor,O.halfPixel=0.5/T.pixelRatio,O.canvases=[],O.progressWave=null,O}return w(A,S),v(A,[{key:"init",value:function(){this.createWrapper(),this.createElements()}},{key:"createElements",value:function(){this.progressWave=this.wrapper.appendChild(this.style(document.createElement("wave"),{position:"absolute",zIndex:3,left:0,top:0,bottom:0,overflow:"hidden",width:"0",display:"none",boxSizing:"border-box",borderRightStyle:"solid",pointerEvents:"none"})),this.addCanvas(),this.updateCursor()}},{key:"updateCursor",value:function(){this.style(this.progressWave,{borderRightWidth:this.params.cursorWidth+"px",borderRightColor:this.params.cursorColor})}},{key:"updateSize",value:function(){for(var T=this,O=Math.round(this.width/this.params.pixelRatio),D=Math.ceil(O/this.maxCanvasElementWidth);this.canvases.length<D;)this.addCanvas();for(;this.canvases.length>D;)this.removeCanvas();this.canvases.forEach(function(M,B){var L=T.maxCanvasWidth+2*Math.ceil(T.params.pixelRatio/2);B==T.canvases.length-1&&(L=T.width-T.maxCanvasWidth*(T.canvases.length-1)),T.updateDimensions(M,L,T.height),T.clearWaveForEntry(M)})}},{key:"addCanvas",value:function(){var T={},O=this.maxCanvasElementWidth*this.canvases.length;T.wave=this.wrapper.appendChild(this.style(document.createElement("canvas"),{position:"absolute",zIndex:2,left:O+"px",top:0,bottom:0,height:"100%",pointerEvents:"none"})),T.waveCtx=T.wave.getContext("2d"),this.hasProgressCanvas&&(T.progress=this.progressWave.appendChild(this.style(document.createElement("canvas"),{position:"absolute",left:O+"px",top:0,bottom:0,height:"100%"})),T.progressCtx=T.progress.getContext("2d")),this.canvases.push(T)}},{key:"removeCanvas",value:function(){var T=this.canvases.pop();T.wave.parentElement.removeChild(T.wave),this.hasProgressCanvas&&T.progress.parentElement.removeChild(T.progress)}},{key:"updateDimensions",value:function(T,O,D){var M=Math.round(O/this.params.pixelRatio),B=Math.round(this.width/this.params.pixelRatio);T.start=T.waveCtx.canvas.offsetLeft/B||0,T.end=T.start+M/B,T.waveCtx.canvas.width=O,T.waveCtx.canvas.height=D,this.style(T.waveCtx.canvas,{width:M+"px"}),this.style(this.progressWave,{display:"block"}),this.hasProgressCanvas&&(T.progressCtx.canvas.width=O,T.progressCtx.canvas.height=D,this.style(T.progressCtx.canvas,{width:M+"px"}))}},{key:"clearWave",value:function(){var T=this;this.canvases.forEach(function(O){return T.clearWaveForEntry(O)})}},{key:"clearWaveForEntry",value:function(T){T.waveCtx.clearRect(0,0,T.waveCtx.canvas.width,T.waveCtx.canvas.height),this.hasProgressCanvas&&T.progressCtx.clearRect(0,0,T.progressCtx.canvas.width,T.progressCtx.canvas.height)}},{key:"drawBars",value:function(T,O,D,M){var B=this;return this.prepareDraw(T,O,D,M,function(L){var N=L.absmax,I=L.hasMinVals,V=L.height,F=L.offsetY,z=L.halfH,H=L.peaks;if(void 0!==D){var $,q=I?2:1,G=H.length/q,X=B.params.barWidth*B.params.pixelRatio,Y=null===B.params.barGap?Math.max(B.params.pixelRatio,~~(X/2)):Math.max(B.params.pixelRatio,B.params.barGap*B.params.pixelRatio),J=G/B.width;for($=D;$<M;$+=X+Y){var K=H[Math.floor($*J*q)]||0,ee=Math.round(K/N*z);B.fillRect($+B.halfPixel,z-ee+F,X+B.halfPixel,2*ee)}}})}},{key:"drawWave",value:function(T,O,D,M){var B=this;return this.prepareDraw(T,O,D,M,function(L){var N=L.absmax,I=L.hasMinVals,V=L.height,F=L.offsetY,z=L.halfH,H=L.peaks;if(!I){var X,q=[],G=H.length;for(X=0;X<G;X++)q[2*X]=H[X],q[2*X+1]=-H[X];H=q}void 0!==D&&B.drawLine(H,N,z,F,D,M),B.fillRect(0,z+F-B.halfPixel,B.width,B.halfPixel)})}},{key:"drawLine",value:function(T,O,D,M,B,L){var N=this;this.canvases.forEach(function(I){N.setFillStyles(I),N.drawLineToContext(I,I.waveCtx,T,O,D,M,B,L),N.drawLineToContext(I,I.progressCtx,T,O,D,M,B,L)})}},{key:"drawLineToContext",value:function(T,O,D,M,B,L,N,I){if(O){var V=D.length/2,F=this.params.fillParent&&this.width!=V?this.width/V:1,z=Math.round(V*T.start),H=Math.round(V*T.end)+1;if(!(z>I||H<N)){var X,Y,q=Math.min(z,N),G=Math.max(H,I);for(O.beginPath(),O.moveTo((q-z)*F+this.halfPixel,B+L),X=q;X<G;X++){var U=D[2*X]||0,J=Math.round(U/M*B);O.lineTo((X-z)*F+this.halfPixel,B-J+L)}for(Y=G-1;Y>=q;Y--){var Q=D[2*Y+1]||0,Z=Math.round(Q/M*B);O.lineTo((Y-z)*F+this.halfPixel,B-Z+L)}O.closePath(),O.fill()}}}},{key:"fillRect",value:function(T,O,D,M){var N,B=Math.floor(T/this.maxCanvasWidth),L=Math.min(Math.ceil((T+D)/this.maxCanvasWidth)+1,this.canvases.length);for(N=B;N<L;N++){var I=this.canvases[N],V=N*this.maxCanvasWidth,F={x1:Math.max(T,N*this.maxCanvasWidth),y1:O,x2:Math.min(T+D,N*this.maxCanvasWidth+I.waveCtx.canvas.width),y2:O+M};F.x1<F.x2&&(this.setFillStyles(I),this.fillRectToContext(I.waveCtx,F.x1-V,F.y1,F.x2-F.x1,F.y2-F.y1),this.fillRectToContext(I.progressCtx,F.x1-V,F.y1,F.x2-F.x1,F.y2-F.y1))}}},{key:"prepareDraw",value:function(T,O,D,M,B){var L=this;return _.frame(function(){if(T[0]instanceof Array){var N=T;if(L.params.splitChannels)return L.setHeight(N.length*L.params.height*L.params.pixelRatio),N.forEach(function(X,Y){return L.prepareDraw(X,Y,D,M,B)});T=N[0]}var I=1/L.params.barHeight;if(L.params.normalize){var V=_.max(T),F=_.min(T);I=-F>V?-F:V}var z=[].some.call(T,function(X){return 0>X}),H=L.params.height*L.params.pixelRatio;return B({absmax:I,hasMinVals:z,height:H,offsetY:H*O||0,halfH:H/2,peaks:T})})()}},{key:"fillRectToContext",value:function(T,O,D,M,B){T&&T.fillRect(O,D,M,B)}},{key:"setFillStyles",value:function(T){T.waveCtx.fillStyle=this.params.waveColor,this.hasProgressCanvas&&(T.progressCtx.fillStyle=this.params.progressColor)}},{key:"getImage",value:function(T,O){var D=this.canvases.map(function(M){return M.wave.toDataURL(T,O)});return 1<D.length?D:D[0]}},{key:"updateProgress",value:function(T){this.style(this.progressWave,{width:T+"px"})}}]),A}(E.default);n.default=R,r.exports=n.default},"./src/mediaelement.js":function(r,n,s){"use strict";function u(W){return u="function"===typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(O){return"undefined"===typeof O?"undefined":babelHelpers.typeof(O)}:function(O){return O&&"function"===typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":"undefined"===typeof O?"undefined":babelHelpers.typeof(O)},u(W)}function f(W,T){if(!(W instanceof T))throw new TypeError("Cannot call a class as a function")}function m(W,T){for(var D,O=0;O<T.length;O++)D=T[O],D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(W,D.key,D)}function v(W,T,O){return T&&m(W.prototype,T),O&&m(W,O),W}function k(W,T){return T&&("object"===u(T)||"function"===typeof T)?T:g(W)}function g(W){if(void 0===W)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return W}function P(W,T,O){return P="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(M,B,L){var N=w(M,B);if(N){var I=Object.getOwnPropertyDescriptor(N,B);return I.get?I.get.call(L):I.value}},P(W,T,O||W)}function w(W,T){for(;!Object.prototype.hasOwnProperty.call(W,T)&&(W=C(W),null!==W););return W}function C(W){return C=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)},C(W)}function E(W,T){if("function"!==typeof T&&null!==T)throw new TypeError("Super expression must either be null or a function");W.prototype=Object.create(T&&T.prototype,{constructor:{value:W,writable:!0,configurable:!0}}),T&&_(W,T)}function _(W,T){return _=Object.setPrototypeOf||function(D,M){return D.__proto__=M,D},_(W,T)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var R=function(W){return W&&W.__esModule?W:{default:W}}(s("./src/webaudio.js")),S=function(W){if(W&&W.__esModule)return W;var T={};if(null!=W)for(var O in W)if(Object.prototype.hasOwnProperty.call(W,O)){var D=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(W,O):{};D.get||D.set?Object.defineProperty(T,O,D):T[O]=W[O]}return T.default=W,T}(s("./src/util/index.js")),A=function(W){function T(O){var D;return f(this,T),D=k(this,C(T).call(this,O)),D.params=O,D.media={currentTime:0,duration:0,paused:!0,playbackRate:1,play:function(){},pause:function(){},volume:0},D.mediaType=O.mediaType.toLowerCase(),D.elementPosition=O.elementPosition,D.peaks=null,D.playbackRate=1,D.volume=1,D.buffer=null,D.onPlayEnd=null,D}return E(T,W),v(T,[{key:"init",value:function(){this.setPlaybackRate(this.params.audioRate),this.createTimer()}},{key:"createTimer",value:function(){var D=this;this.on("play",function B(){if(!D.isPaused()){D.fireEvent("audioprocess",D.getCurrentTime());var L=window.requestAnimationFrame||window.webkitRequestAnimationFrame;L(B)}}),this.on("pause",function(){D.fireEvent("audioprocess",D.getCurrentTime())})}},{key:"load",value:function(D,M,B,L){var N=document.createElement(this.mediaType);N.controls=this.params.mediaControls,N.autoplay=this.params.autoplay||!1,N.preload=null==L?"auto":L,N.src=D,N.style.width="100%";var I=M.querySelector(this.mediaType);I&&M.removeChild(I),M.appendChild(N),this._load(N,B)}},{key:"loadElt",value:function(D,M){D.controls=this.params.mediaControls,D.autoplay=this.params.autoplay||!1,this._load(D,M)}},{key:"_load",value:function(D,M){var B=this;"function"==typeof D.load&&D.load(),D.addEventListener("error",function(){B.fireEvent("error","Error loading media element")}),D.addEventListener("canplay",function(){B.fireEvent("canplay")}),D.addEventListener("ended",function(){B.fireEvent("finish")}),D.addEventListener("play",function(){B.fireEvent("play")}),D.addEventListener("pause",function(){B.fireEvent("pause")}),this.media=D,this.peaks=M,this.onPlayEnd=null,this.buffer=null,this.setPlaybackRate(this.playbackRate),this.setVolume(this.volume)}},{key:"isPaused",value:function(){return!this.media||this.media.paused}},{key:"getDuration",value:function(){if(this.explicitDuration)return this.explicitDuration;var D=(this.buffer||this.media).duration;return D>=Infinity&&(D=this.media.seekable.end(0)),D}},{key:"getCurrentTime",value:function(){return this.media&&this.media.currentTime}},{key:"getPlayedPercents",value:function(){return this.getCurrentTime()/this.getDuration()||0}},{key:"getPlaybackRate",value:function(){return this.playbackRate||this.media.playbackRate}},{key:"setPlaybackRate",value:function(D){this.playbackRate=D||1,this.media.playbackRate=this.playbackRate}},{key:"seekTo",value:function(D){null!=D&&(this.media.currentTime=D),this.clearPlayEnd()}},{key:"play",value:function(D,M){this.seekTo(D);var B=this.media.play();return M&&this.setPlayEnd(M),B}},{key:"pause",value:function(){var D;return this.media&&(D=this.media.pause()),this.clearPlayEnd(),D}},{key:"setPlayEnd",value:function(D){var M=this;this._onPlayEnd=function(B){B>=D&&(M.pause(),M.seekTo(D))},this.on("audioprocess",this._onPlayEnd)}},{key:"clearPlayEnd",value:function(){this._onPlayEnd&&(this.un("audioprocess",this._onPlayEnd),this._onPlayEnd=null)}},{key:"getPeaks",value:function(D,M,B){return this.buffer?P(C(T.prototype),"getPeaks",this).call(this,D,M,B):this.peaks||[]}},{key:"setSinkId",value:function(D){return D?this.media.setSinkId?this.media.setSinkId(D):Promise.reject(new Error("setSinkId is not supported in your browser")):Promise.reject(new Error("Invalid deviceId: "+D))}},{key:"getVolume",value:function(){return this.volume||this.media.volume}},{key:"setVolume",value:function(D){this.volume=D,this.media.volume=this.volume}},{key:"destroy",value:function(){this.pause(),this.unAll(),this.params.removeMediaElementOnDestroy&&this.media&&this.media.parentNode&&this.media.parentNode.removeChild(this.media),this.media=null}}]),T}(R.default);n.default=A,r.exports=n.default},"./src/peakcache.js":function(r,n){"use strict";function l(m,v){if(!(m instanceof v))throw new TypeError("Cannot call a class as a function")}function d(m,v){for(var g,k=0;k<v.length;k++)g=v[k],g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(m,g.key,g)}function u(m,v,k){return v&&d(m.prototype,v),k&&d(m,k),m}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var f=function(){function m(){l(this,m),this.clearPeakCache()}return u(m,[{key:"clearPeakCache",value:function(){this.peakCacheRanges=[],this.peakCacheLength=-1}},{key:"addRangeToPeakCache",value:function(k,g,P){k!=this.peakCacheLength&&(this.clearPeakCache(),this.peakCacheLength=k);for(var w=[],C=0;C<this.peakCacheRanges.length&&this.peakCacheRanges[C]<g;)C++;for(0==C%2&&w.push(g);C<this.peakCacheRanges.length&&this.peakCacheRanges[C]<=P;)w.push(this.peakCacheRanges[C]),C++;0==C%2&&w.push(P),w=w.filter(function(_,R,S){return 0==R?_!=S[R+1]:R==S.length-1?_!=S[R-1]:_!=S[R-1]&&_!=S[R+1]}),this.peakCacheRanges=this.peakCacheRanges.concat(w),this.peakCacheRanges=this.peakCacheRanges.sort(function(_,R){return _-R}).filter(function(_,R,S){return 0==R?_!=S[R+1]:R==S.length-1?_!=S[R-1]:_!=S[R-1]&&_!=S[R+1]});var E=[];for(C=0;C<w.length;C+=2)E.push([w[C],w[C+1]]);return E}},{key:"getCacheRanges",value:function(){var g,k=[];for(g=0;g<this.peakCacheRanges.length;g+=2)k.push([this.peakCacheRanges[g],this.peakCacheRanges[g+1]]);return k}}]),m}();n.default=f,r.exports=n.default},"./src/util/ajax.js":function(r,n,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(f){var m=new u.default,v=new XMLHttpRequest,k=!1;return v.open(f.method||"GET",f.url,!0),v.responseType=f.responseType||"json",f.xhr&&(f.xhr.requestHeaders&&f.xhr.requestHeaders.forEach(function(g){v.setRequestHeader(g.key,g.value)}),f.xhr.withCredentials&&(v.withCredentials=!0)),v.addEventListener("progress",function(g){m.fireEvent("progress",g),g.lengthComputable&&g.loaded==g.total&&(k=!0)}),v.addEventListener("load",function(g){k||m.fireEvent("progress",g),m.fireEvent("load",g),200==v.status||206==v.status?m.fireEvent("success",v.response,g):m.fireEvent("error",g)}),v.addEventListener("error",function(g){return m.fireEvent("error",g)}),v.send(),m.xhr=v,m};var u=function(f){return f&&f.__esModule?f:{default:f}}(s("./src/util/observer.js"));r.exports=n.default},"./src/util/extend.js":function(r,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(d){for(var u=arguments.length,f=Array(1<u?u-1:0),m=1;m<u;m++)f[m-1]=arguments[m];return f.forEach(function(v){Object.keys(v).forEach(function(k){d[k]=v[k]})}),d},r.exports=n.default},"./src/util/frame.js":function(r,n,s){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(f){return function(){for(var m=arguments.length,v=Array(m),k=0;k<m;k++)v[k]=arguments[k];return(0,u.default)(function(){return f.apply(void 0,v)})}};var u=function(f){return f&&f.__esModule?f:{default:f}}(s("./src/util/request-animation-frame.js"));r.exports=n.default},"./src/util/get-id.js":function(r,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){return"wavesurfer_"+Math.random().toString(32).substring(2)},r.exports=n.default},"./src/util/index.js":function(r,n,s){"use strict";function l(_){return _&&_.__esModule?_:{default:_}}Object.defineProperty(n,"__esModule",{value:!0}),Object.defineProperty(n,"ajax",{enumerable:!0,get:function(){return d.default}}),Object.defineProperty(n,"getId",{enumerable:!0,get:function(){return u.default}}),Object.defineProperty(n,"max",{enumerable:!0,get:function(){return f.default}}),Object.defineProperty(n,"min",{enumerable:!0,get:function(){return m.default}}),Object.defineProperty(n,"Observer",{enumerable:!0,get:function(){return v.default}}),Object.defineProperty(n,"extend",{enumerable:!0,get:function(){return k.default}}),Object.defineProperty(n,"style",{enumerable:!0,get:function(){return g.default}}),Object.defineProperty(n,"requestAnimationFrame",{enumerable:!0,get:function(){return P.default}}),Object.defineProperty(n,"frame",{enumerable:!0,get:function(){return w.default}}),Object.defineProperty(n,"debounce",{enumerable:!0,get:function(){return C.default}}),Object.defineProperty(n,"preventClick",{enumerable:!0,get:function(){return E.default}});var d=l(s("./src/util/ajax.js")),u=l(s("./src/util/get-id.js")),f=l(s("./src/util/max.js")),m=l(s("./src/util/min.js")),v=l(s("./src/util/observer.js")),k=l(s("./src/util/extend.js")),g=l(s("./src/util/style.js")),P=l(s("./src/util/request-animation-frame.js")),w=l(s("./src/util/frame.js")),C=l(s("./node_modules/debounce/index.js")),E=l(s("./src/util/prevent-click.js"))},"./src/util/max.js":function(r,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(d){var u=-Infinity;return Object.keys(d).forEach(function(f){d[f]>u&&(u=d[f])}),u},r.exports=n.default},"./src/util/min.js":function(r,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(d){var u=+Infinity;return Object.keys(d).forEach(function(f){d[f]<u&&(u=d[f])}),u},r.exports=n.default},"./src/util/observer.js":function(r,n){"use strict";function l(m,v){if(!(m instanceof v))throw new TypeError("Cannot call a class as a function")}function d(m,v){for(var g,k=0;k<v.length;k++)g=v[k],g.enumerable=g.enumerable||!1,g.configurable=!0,"value"in g&&(g.writable=!0),Object.defineProperty(m,g.key,g)}function u(m,v,k){return v&&d(m.prototype,v),k&&d(m,k),m}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var f=function(){function m(){l(this,m),this.handlers=null}return u(m,[{key:"on",value:function(k,g){var P=this;this.handlers||(this.handlers={});var w=this.handlers[k];return w||(w=this.handlers[k]=[]),w.push(g),{name:k,callback:g,un:function(E,_){return P.un(E,_)}}}},{key:"un",value:function(k,g){if(this.handlers){var w,P=this.handlers[k];if(P)if(g)for(w=P.length-1;0<=w;w--)P[w]==g&&P.splice(w,1);else P.length=0}}},{key:"unAll",value:function(){this.handlers=null}},{key:"once",value:function(k,g){var P=this;return this.on(k,function C(){for(var E=arguments.length,_=Array(E),R=0;R<E;R++)_[R]=arguments[R];g.apply(P,_),setTimeout(function(){P.un(k,C)},0)})}},{key:"fireEvent",value:function(k){for(var g=arguments.length,P=Array(1<g?g-1:0),w=1;w<g;w++)P[w-1]=arguments[w];if(this.handlers){var C=this.handlers[k];C&&C.forEach(function(E){E.apply(void 0,P)})}}}]),m}();n.default=f,r.exports=n.default},"./src/util/prevent-click.js":function(r,n){"use strict";function l(u){u.stopPropagation(),document.body.removeEventListener("click",l,!0)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(){document.body.addEventListener("click",l,!0)},r.exports=n.default},"./src/util/request-animation-frame.js":function(r,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var l=(window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(d){return setTimeout(d,1e3/60)}).bind(window);n.default=l,r.exports=n.default},"./src/util/style.js":function(r,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=function(d,u){return Object.keys(u).forEach(function(f){d.style[f]!==u[f]&&(d.style[f]=u[f])}),d},r.exports=n.default},"./src/wavesurfer.js":function(r,n,s){"use strict";function l(O){return O&&O.__esModule?O:{default:O}}function u(O){return u="function"===typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(M){return"undefined"===typeof M?"undefined":babelHelpers.typeof(M)}:function(M){return M&&"function"===typeof Symbol&&M.constructor===Symbol&&M!==Symbol.prototype?"symbol":"undefined"===typeof M?"undefined":babelHelpers.typeof(M)},u(O)}function f(O,D){return D&&("object"===u(D)||"function"===typeof D)?D:g(O)}function m(O){return m=Object.setPrototypeOf?Object.getPrototypeOf:function(M){return M.__proto__||Object.getPrototypeOf(M)},m(O)}function v(O,D){if("function"!==typeof D&&null!==D)throw new TypeError("Super expression must either be null or a function");O.prototype=Object.create(D&&D.prototype,{constructor:{value:O,writable:!0,configurable:!0}}),D&&k(O,D)}function k(O,D){return k=Object.setPrototypeOf||function(B,L){return B.__proto__=L,B},k(O,D)}function g(O){if(void 0===O)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return O}function P(O,D){if(!(O instanceof D))throw new TypeError("Cannot call a class as a function")}function w(O,D){for(var B,M=0;M<D.length;M++)B=D[M],B.enumerable=B.enumerable||!1,B.configurable=!0,"value"in B&&(B.writable=!0),Object.defineProperty(O,B.key,B)}function C(O,D,M){return D&&w(O.prototype,D),M&&w(O,M),O}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var E=function(O){if(O&&O.__esModule)return O;var D={};if(null!=O)for(var M in O)if(Object.prototype.hasOwnProperty.call(O,M)){var B=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(O,M):{};B.get||B.set?Object.defineProperty(D,M,B):D[M]=O[M]}return D.default=O,D}(s("./src/util/index.js")),_=l(s("./src/drawer.multicanvas.js")),R=l(s("./src/webaudio.js")),S=l(s("./src/mediaelement.js")),A=l(s("./src/peakcache.js")),W=function(){function O(){P(this,O)}return C(O,[{key:"create",value:function(){}}]),C(O,[{key:"init",value:function(){}},{key:"destroy",value:function(){}}]),O}(),T=function(O){function D(M){var B;if(P(this,D),B=f(this,m(D).call(this)),B.defaultParams={audioContext:null,audioRate:1,autoCenter:!0,backend:"WebAudio",barHeight:1,barGap:null,container:null,cursorColor:"#333",cursorWidth:1,dragSelection:!0,fillParent:!0,forceDecode:!1,height:128,hideScrollbar:!1,interact:!0,loopSelection:!0,maxCanvasWidth:4e3,mediaContainer:null,mediaControls:!1,mediaType:"audio",minPxPerSec:20,normalize:!1,partialRender:!1,pixelRatio:window.devicePixelRatio||screen.deviceXDPI/screen.logicalXDPI,plugins:[],progressColor:"#555",removeMediaElementOnDestroy:!0,renderer:_.default,responsive:!1,scrollParent:!1,skipLength:2,splitChannels:!1,waveColor:"#999",xhr:{}},B.backends={MediaElement:S.default,WebAudio:R.default},B.util=E,B.params=E.extend({},B.defaultParams,M),B.container="string"==typeof M.container?document.querySelector(B.params.container):B.params.container,!B.container)throw new Error("Container element not found");if(B.mediaContainer=null==B.params.mediaContainer?B.container:"string"==typeof B.params.mediaContainer?document.querySelector(B.params.mediaContainer):B.params.mediaContainer,!B.mediaContainer)throw new Error("Media Container element not found");if(1>=B.params.maxCanvasWidth)throw new Error("maxCanvasWidth must be greater than 1");else if(1==B.params.maxCanvasWidth%2)throw new Error("maxCanvasWidth must be an even number");if(B.savedVolume=0,B.isMuted=!1,B.tmpEvents=[],B.currentAjax=null,B.arraybuffer=null,B.drawer=null,B.backend=null,B.peakCache=null,"function"!==typeof B.params.renderer)throw new Error("Renderer parameter is invalid");B.Drawer=B.params.renderer,B.Backend=B.backends[B.params.backend],B.initialisedPluginList={},B.isDestroyed=!1,B.isReady=!1;var L=0;return B._onResize=E.debounce(function(){L==B.drawer.wrapper.clientWidth||B.params.scrollParent||(L=B.drawer.wrapper.clientWidth,B.drawer.fireEvent("redraw"))},"number"===typeof B.params.responsive?B.params.responsive:100),f(B,g(g(B)))}return v(D,O),C(D,null,[{key:"create",value:function(B){var L=new D(B);return L.init()}}]),C(D,[{key:"init",value:function(){return this.registerPlugins(this.params.plugins),this.createDrawer(),this.createBackend(),this.createPeakCache(),this}},{key:"registerPlugins",value:function(B){var L=this;return B.forEach(function(N){return L.addPlugin(N)}),B.forEach(function(N){N.deferInit||L.initPlugin(N.name)}),this.fireEvent("plugins-registered",B),this}},{key:"addPlugin",value:function(B){var L=this;if(!B.name)throw new Error("Plugin does not have a name!");if(!B.instance)throw new Error("Plugin ".concat(B.name," does not have an instance property!"));B.staticProps&&Object.keys(B.staticProps).forEach(function(V){L[V]=B.staticProps[V]});var N=B.instance,I=Object.getOwnPropertyNames(E.Observer.prototype);return I.forEach(function(V){N.prototype[V]=E.Observer.prototype[V]}),this[B.name]=new N(B.params||{},this),this.fireEvent("plugin-added",B.name),this}},{key:"initPlugin",value:function(B){if(!this[B])throw new Error("Plugin ".concat(B," has not been added yet!"));return this.initialisedPluginList[B]&&this.destroyPlugin(B),this[B].init(),this.initialisedPluginList[B]=!0,this.fireEvent("plugin-initialised",B),this}},{key:"destroyPlugin",value:function(B){if(!this[B])throw new Error("Plugin ".concat(B," has not been added yet and cannot be destroyed!"));if(!this.initialisedPluginList[B])throw new Error("Plugin ".concat(B," is not active and cannot be destroyed!"));if("function"!==typeof this[B].destroy)throw new Error("Plugin ".concat(B," does not have a destroy function!"));return this[B].destroy(),delete this.initialisedPluginList[B],this.fireEvent("plugin-destroyed",B),this}},{key:"destroyAllPlugins",value:function(){var B=this;Object.keys(this.initialisedPluginList).forEach(function(L){return B.destroyPlugin(L)})}},{key:"createDrawer",value:function(){var B=this;this.drawer=new this.Drawer(this.container,this.params),this.drawer.init(),this.fireEvent("drawer-created",this.drawer),!1!==this.params.responsive&&(window.addEventListener("resize",this._onResize,!0),window.addEventListener("orientationchange",this._onResize,!0)),this.drawer.on("redraw",function(){B.drawBuffer(),B.drawer.progress(B.backend.getPlayedPercents())}),this.drawer.on("click",function(L,N){setTimeout(function(){return B.seekTo(N)},0)}),this.drawer.on("scroll",function(L){B.params.partialRender&&B.drawBuffer(),B.fireEvent("scroll",L)})}},{key:"createBackend",value:function(){var B=this;this.backend&&this.backend.destroy(),"AudioElement"==this.params.backend&&(this.params.backend="MediaElement"),"WebAudio"!=this.params.backend||this.Backend.prototype.supportsWebAudio.call(null)||(this.params.backend="MediaElement"),this.backend=new this.Backend(this.params),this.backend.init(),this.fireEvent("backend-created",this.backend),this.backend.on("finish",function(){return B.fireEvent("finish")}),this.backend.on("play",function(){return B.fireEvent("play")}),this.backend.on("pause",function(){return B.fireEvent("pause")}),this.backend.on("audioprocess",function(L){B.drawer.progress(B.backend.getPlayedPercents()),B.fireEvent("audioprocess",L)})}},{key:"createPeakCache",value:function(){this.params.partialRender&&(this.peakCache=new A.default)}},{key:"getDuration",value:function(){return this.backend.getDuration()}},{key:"getCurrentTime",value:function(){return this.backend.getCurrentTime()}},{key:"setCurrentTime",value:function(B){B>=this.getDuration()?this.seekTo(1):this.seekTo(B/this.getDuration())}},{key:"play",value:function(B,L){var N=this;return this.fireEvent("interaction",function(){return N.play(B,L)}),this.backend.play(B,L)}},{key:"pause",value:function(){if(!this.backend.isPaused())return this.backend.pause()}},{key:"playPause",value:function(){return this.backend.isPaused()?this.play():this.pause()}},{key:"isPlaying",value:function(){return!this.backend.isPaused()}},{key:"skipBackward",value:function(B){this.skip(-B||-this.params.skipLength)}},{key:"skipForward",value:function(B){this.skip(B||this.params.skipLength)}},{key:"skip",value:function(B){var L=this.getDuration()||1,N=this.getCurrentTime()||0;N=Math.max(0,Math.min(L,N+(B||0))),this.seekAndCenter(N/L)}},{key:"seekAndCenter",value:function(B){this.seekTo(B),this.drawer.recenter(B)}},{key:"seekTo",value:function(B){var L=this;if("number"!==typeof B||!isFinite(B)||0>B||1<B)return console.error("Error calling wavesurfer.seekTo, parameter must be a number between 0 and 1!");this.fireEvent("interaction",function(){return L.seekTo(B)});var N=this.backend.isPaused();N||this.backend.pause();var I=this.params.scrollParent;this.params.scrollParent=!1,this.backend.seekTo(B*this.getDuration()),this.drawer.progress(B),N||this.backend.play(),this.params.scrollParent=I,this.fireEvent("seek",B)}},{key:"stop",value:function(){this.pause(),this.seekTo(0),this.drawer.progress(0)}},{key:"setSinkId",value:function(B){return this.backend.setSinkId(B)}},{key:"setVolume",value:function(B){this.backend.setVolume(B),this.fireEvent("volume",B)}},{key:"getVolume",value:function(){return this.backend.getVolume()}},{key:"setPlaybackRate",value:function(B){this.backend.setPlaybackRate(B)}},{key:"getPlaybackRate",value:function(){return this.backend.getPlaybackRate()}},{key:"toggleMute",value:function(){this.setMute(!this.isMuted)}},{key:"setMute",value:function(B){return B===this.isMuted?void this.fireEvent("mute",this.isMuted):void(B?(this.savedVolume=this.backend.getVolume(),this.backend.setVolume(0),this.isMuted=!0,this.fireEvent("volume",0)):(this.backend.setVolume(this.savedVolume),this.isMuted=!1,this.fireEvent("volume",this.savedVolume)),this.fireEvent("mute",this.isMuted))}},{key:"getMute",value:function(){return this.isMuted}},{key:"isReady",value:function(){return this.isReady}},{key:"getFilters",value:function(){return this.backend.filters||[]}},{key:"toggleScroll",value:function(){this.params.scrollParent=!this.params.scrollParent,this.drawBuffer()}},{key:"toggleInteraction",value:function(){this.params.interact=!this.params.interact}},{key:"getWaveColor",value:function(){return this.params.waveColor}},{key:"setWaveColor",value:function(B){this.params.waveColor=B,this.drawBuffer()}},{key:"getProgressColor",value:function(){return this.params.progressColor}},{key:"setProgressColor",value:function(B){this.params.progressColor=B,this.drawBuffer()}},{key:"getCursorColor",value:function(){return this.params.cursorColor}},{key:"setCursorColor",value:function(B){this.params.cursorColor=B,this.drawer.updateCursor()}},{key:"getHeight",value:function(){return this.params.height}},{key:"setHeight",value:function(B){this.params.height=B,this.drawer.setHeight(B*this.params.pixelRatio),this.drawBuffer()}},{key:"drawBuffer",value:function(){var B=Math.round(this.getDuration()*this.params.minPxPerSec*this.params.pixelRatio),L=this.drawer.getWidth(),N=B,I=this.drawer.getScrollX(),V=Math.max(I+L,N);this.params.fillParent&&(!this.params.scrollParent||B<L)&&(N=L,I=0,V=N);var F;if(this.params.partialRender){var H,z=this.peakCache.addRangeToPeakCache(N,I,V);for(H=0;H<z.length;H++)F=this.backend.getPeaks(N,z[H][0],z[H][1]),this.drawer.drawPeaks(F,N,z[H][0],z[H][1])}else F=this.backend.getPeaks(N,I,V),this.drawer.drawPeaks(F,N,I,V);this.fireEvent("redraw",F,N)}},{key:"zoom",value:function(B){B?(this.params.minPxPerSec=B,this.params.scrollParent=!0):(this.params.minPxPerSec=this.defaultParams.minPxPerSec,this.params.scrollParent=!1),this.drawBuffer(),this.drawer.progress(this.backend.getPlayedPercents()),this.drawer.recenter(this.getCurrentTime()/this.getDuration()),this.fireEvent("zoom",B)}},{key:"loadArrayBuffer",value:function(B){var L=this;this.decodeArrayBuffer(B,function(N){L.isDestroyed||L.loadDecodedBuffer(N)})}},{key:"loadDecodedBuffer",value:function(B){this.backend.load(B),this.drawBuffer(),this.fireEvent("ready"),this.isReady=!0}},{key:"loadBlob",value:function(B){var L=this,N=new FileReader;N.addEventListener("progress",function(I){return L.onProgress(I)}),N.addEventListener("load",function(I){return L.loadArrayBuffer(I.target.result)}),N.addEventListener("error",function(){return L.fireEvent("error","Error reading file")}),N.readAsArrayBuffer(B),this.empty()}},{key:"load",value:function(B,L,N,I){if(this.empty(),N){var V={"Preload is not 'auto', 'none' or 'metadata'":-1===["auto","metadata","none"].indexOf(N),"Peaks are not provided":!L,"Backend is not of type MediaElement":"MediaElement"!==this.params.backend,"Url is not of type string":"string"!==typeof B},F=Object.keys(V).filter(function(z){return V[z]});F.length&&(console.warn("Preload parameter of wavesurfer.load will be ignored because:\n\t- "+F.join("\n\t- ")),N=null)}switch(this.params.backend){case"WebAudio":return this.loadBuffer(B,L,I);case"MediaElement":return this.loadMediaElement(B,L,N,I);}}},{key:"loadBuffer",value:function(B,L,N){var I=this,V=function(z){return z&&I.tmpEvents.push(I.once("ready",z)),I.getArrayBuffer(B,function(H){return I.loadArrayBuffer(H)})};return L?void(this.backend.setPeaks(L,N),this.drawBuffer(),this.tmpEvents.push(this.once("interaction",V))):V()}},{key:"loadMediaElement",value:function(B,L,N,I){var V=this,F=B;if("string"===typeof B)this.backend.load(F,this.mediaContainer,L,N);else{var z=B;this.backend.loadElt(z,L),F=z.src}this.tmpEvents.push(this.backend.once("canplay",function(){V.drawBuffer(),V.fireEvent("ready"),V.isReady=!0}),this.backend.once("error",function(H){return V.fireEvent("error",H)})),L&&this.backend.setPeaks(L,I),(!L||this.params.forceDecode)&&this.backend.supportsWebAudio()&&this.getArrayBuffer(F,function(H){V.decodeArrayBuffer(H,function(q){V.backend.buffer=q,V.backend.setPeaks(null),V.drawBuffer(),V.fireEvent("waveform-ready")})})}},{key:"decodeArrayBuffer",value:function(B,L){var N=this;this.arraybuffer=B,this.backend.decodeArrayBuffer(B,function(I){N.isDestroyed||N.arraybuffer!=B||(L(I),N.arraybuffer=null)},function(){return N.fireEvent("error","Error decoding audiobuffer")})}},{key:"getArrayBuffer",value:function(B,L){var N=this,I=E.ajax({url:B,responseType:"arraybuffer",xhr:this.params.xhr});return this.currentAjax=I,this.tmpEvents.push(I.on("progress",function(V){N.onProgress(V)}),I.on("success",function(V){L(V),N.currentAjax=null}),I.on("error",function(V){N.fireEvent("error","XHR error: "+V.target.statusText),N.currentAjax=null})),I}},{key:"onProgress",value:function(B){var L;L=B.lengthComputable?B.loaded/B.total:B.loaded/(B.loaded+1e6),this.fireEvent("loading",Math.round(100*L),B.target)}},{key:"exportPCM",value:function(B,L,N,I){B=B||1024,I=I||0,L=L||1e4,N=N||!1;var V=this.backend.getPeaks(B,I),F=[].map.call(V,function(H){return Math.round(H*L)/L}),z=JSON.stringify(F);return N||window.open("data:application/json;charset=utf-8,"+encodeURIComponent(z)),z}},{key:"exportImage",value:function(B,L){return B||(B="image/png"),L||(L=1),this.drawer.getImage(B,L)}},{key:"cancelAjax",value:function(){this.currentAjax&&(this.currentAjax.xhr.abort(),this.currentAjax=null)}},{key:"clearTmpEvents",value:function(){this.tmpEvents.forEach(function(B){return B.un()})}},{key:"empty",value:function(){this.backend.isPaused()||(this.stop(),this.backend.disconnectSource()),this.isReady=!1,this.cancelAjax(),this.clearTmpEvents(),this.drawer.progress(0),this.drawer.setWidth(0),this.drawer.drawPeaks({length:this.drawer.getWidth()},0)}},{key:"destroy",value:function(){this.destroyAllPlugins(),this.fireEvent("destroy"),this.cancelAjax(),this.clearTmpEvents(),this.unAll(),!1!==this.params.responsive&&(window.removeEventListener("resize",this._onResize,!0),window.removeEventListener("orientationchange",this._onResize,!0)),this.backend.destroy(),this.drawer.destroy(),this.isDestroyed=!0,this.isReady=!1,this.arraybuffer=null}}]),D}(E.Observer);n.default=T,T.VERSION="2.1.0",T.util=E,r.exports=n.default},"./src/webaudio.js":function(r,n,s){"use strict";function d(W){return d="function"===typeof Symbol&&"symbol"===babelHelpers.typeof(Symbol.iterator)?function(O){return"undefined"===typeof O?"undefined":babelHelpers.typeof(O)}:function(O){return O&&"function"===typeof Symbol&&O.constructor===Symbol&&O!==Symbol.prototype?"symbol":"undefined"===typeof O?"undefined":babelHelpers.typeof(O)},d(W)}function u(W,T,O){return T in W?Object.defineProperty(W,T,{value:O,enumerable:!0,configurable:!0,writable:!0}):W[T]=O,W}function f(W,T){if(!(W instanceof T))throw new TypeError("Cannot call a class as a function")}function m(W,T){return T&&("object"===d(T)||"function"===typeof T)?T:v(W)}function v(W){if(void 0===W)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return W}function k(W){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(O){return O.__proto__||Object.getPrototypeOf(O)},k(W)}function g(W,T){for(var D,O=0;O<T.length;O++)D=T[O],D.enumerable=D.enumerable||!1,D.configurable=!0,"value"in D&&(D.writable=!0),Object.defineProperty(W,D.key,D)}function P(W,T,O){return T&&g(W.prototype,T),O&&g(W,O),W}function w(W,T){if("function"!==typeof T&&null!==T)throw new TypeError("Super expression must either be null or a function");W.prototype=Object.create(T&&T.prototype,{constructor:{value:W,writable:!0,configurable:!0}}),T&&C(W,T)}function C(W,T){return C=Object.setPrototypeOf||function(D,M){return D.__proto__=M,D},C(W,T)}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var E=function(W){if(W&&W.__esModule)return W;var T={};if(null!=W)for(var O in W)if(Object.prototype.hasOwnProperty.call(W,O)){var D=Object.defineProperty&&Object.getOwnPropertyDescriptor?Object.getOwnPropertyDescriptor(W,O):{};D.get||D.set?Object.defineProperty(T,O,D):T[O]=W[O]}return T.default=W,T}(s("./src/util/index.js")),_="playing",R="paused",S="finished",A=function(W){function T(O){var D,M,B;return f(this,T),B=m(this,k(T).call(this)),B.audioContext=null,B.offlineAudioContext=null,B.stateBehaviors=(D={},u(D,_,{init:function(){this.addOnAudioProcess()},getPlayedPercents:function(){var N=this.getDuration();return this.getCurrentTime()/N||0},getCurrentTime:function(){return this.startPosition+this.getPlayedTime()}}),u(D,R,{init:function(){this.removeOnAudioProcess()},getPlayedPercents:function(){var N=this.getDuration();return this.getCurrentTime()/N||0},getCurrentTime:function(){return this.startPosition}}),u(D,S,{init:function(){this.removeOnAudioProcess(),this.fireEvent("finish")},getPlayedPercents:function(){return 1},getCurrentTime:function(){return this.getDuration()}}),D),B.params=O,B.ac=O.audioContext||B.getAudioContext(),B.lastPlay=B.ac.currentTime,B.startPosition=0,B.scheduledPause=null,B.states=(M={},u(M,_,Object.create(B.stateBehaviors[_])),u(M,R,Object.create(B.stateBehaviors[R])),u(M,S,Object.create(B.stateBehaviors[S])),M),B.analyser=null,B.buffer=null,B.filters=[],B.gainNode=null,B.mergedPeaks=null,B.offlineAc=null,B.peaks=null,B.playbackRate=1,B.analyser=null,B.scriptNode=null,B.source=null,B.splitPeaks=[],B.state=null,B.explicitDuration=null,B}return w(T,W),P(T,[{key:"supportsWebAudio",value:function(){return!!(window.AudioContext||window.webkitAudioContext)}},{key:"getAudioContext",value:function(){return window.WaveSurferAudioContext||(window.WaveSurferAudioContext=new(window.AudioContext||window.webkitAudioContext)),window.WaveSurferAudioContext}},{key:"getOfflineAudioContext",value:function(D){return window.WaveSurferOfflineAudioContext||(window.WaveSurferOfflineAudioContext=new(window.OfflineAudioContext||window.webkitOfflineAudioContext)(1,2,D)),window.WaveSurferOfflineAudioContext}}]),P(T,[{key:"init",value:function(){this.createVolumeNode(),this.createScriptNode(),this.createAnalyserNode(),this.setState(R),this.setPlaybackRate(this.params.audioRate),this.setLength(0)}},{key:"disconnectFilters",value:function(){this.filters&&(this.filters.forEach(function(D){D&&D.disconnect()}),this.filters=null,this.analyser.connect(this.gainNode))}},{key:"setState",value:function(D){this.state!==this.states[D]&&(this.state=this.states[D],this.state.init.call(this))}},{key:"setFilter",value:function(){for(var D=arguments.length,M=Array(D),B=0;B<D;B++)M[B]=arguments[B];this.setFilters(M)}},{key:"setFilters",value:function(D){this.disconnectFilters(),D&&D.length&&(this.filters=D,this.analyser.disconnect(),D.reduce(function(M,B){return M.connect(B),B},this.analyser).connect(this.gainNode))}},{key:"createScriptNode",value:function(){this.scriptNode=this.params.audioScriptProcessor?this.params.audioScriptProcessor:this.ac.createScriptProcessor?this.ac.createScriptProcessor(T.scriptBufferSize):this.ac.createJavaScriptNode(T.scriptBufferSize),this.scriptNode.connect(this.ac.destination)}},{key:"addOnAudioProcess",value:function(){var D=this;this.scriptNode.onaudioprocess=function(){var M=D.getCurrentTime();M>=D.getDuration()?(D.setState(S),D.fireEvent("pause")):M>=D.scheduledPause?D.pause():D.state===D.states[_]&&D.fireEvent("audioprocess",M)}}},{key:"removeOnAudioProcess",value:function(){this.scriptNode.onaudioprocess=null}},{key:"createAnalyserNode",value:function(){this.analyser=this.ac.createAnalyser(),this.analyser.connect(this.gainNode)}},{key:"createVolumeNode",value:function(){this.gainNode=this.ac.createGain?this.ac.createGain():this.ac.createGainNode(),this.gainNode.connect(this.ac.destination)}},{key:"setSinkId",value:function(D){if(D){var M=new window.Audio;if(!M.setSinkId)return Promise.reject(new Error("setSinkId is not supported in your browser"));M.autoplay=!0;var B=this.ac.createMediaStreamDestination();return this.gainNode.disconnect(),this.gainNode.connect(B),M.srcObject=B.stream,M.setSinkId(D)}return Promise.reject(new Error("Invalid deviceId: "+D))}},{key:"setVolume",value:function(D){this.gainNode.gain.setValueAtTime(D,this.ac.currentTime)}},{key:"getVolume",value:function(){return this.gainNode.gain.value}},{key:"decodeArrayBuffer",value:function(D,M,B){this.offlineAc||(this.offlineAc=this.getOfflineAudioContext(this.ac&&this.ac.sampleRate?this.ac.sampleRate:44100)),this.offlineAc.decodeAudioData(D,function(L){return M(L)},B)}},{key:"setPeaks",value:function(D,M){this.explicitDuration=M,this.peaks=D}},{key:"setLength",value:function(D){if(!(this.mergedPeaks&&D==2*this.mergedPeaks.length-1+2)){this.splitPeaks=[],this.mergedPeaks=[];var B,M=this.buffer?this.buffer.numberOfChannels:1;for(B=0;B<M;B++)this.splitPeaks[B]=[],this.splitPeaks[B][2*(D-1)]=0,this.splitPeaks[B][2*(D-1)+1]=0;this.mergedPeaks[2*(D-1)]=0,this.mergedPeaks[2*(D-1)+1]=0}}},{key:"getPeaks",value:function(D,M,B){if(this.peaks)return this.peaks;if(M=M||0,B=B||D-1,this.setLength(D),!this.buffer.length){var L=this.createBuffer(1,4096,this.sampleRate);this.buffer=L.buffer}var F,N=this.buffer.length/D,V=this.buffer.numberOfChannels;for(F=0;F<V;F++){var z=this.splitPeaks[F],H=this.buffer.getChannelData(F),q=void 0;for(q=M;q<=B;q++){var G=~~(q*N),Y=0,U=0,J=void 0;for(J=G;J<~~(G+N);J+=~~(N/10)||1){var Q=H[J];Q>U&&(U=Q),Q<Y&&(Y=Q)}z[2*q]=U,z[2*q+1]=Y,(0==F||U>this.mergedPeaks[2*q])&&(this.mergedPeaks[2*q]=U),(0==F||Y<this.mergedPeaks[2*q+1])&&(this.mergedPeaks[2*q+1]=Y)}}return this.params.splitChannels?this.splitPeaks:this.mergedPeaks}},{key:"getPlayedPercents",value:function(){return this.state.getPlayedPercents.call(this)}},{key:"disconnectSource",value:function(){this.source&&this.source.disconnect()}},{key:"destroy",value:function(){this.isPaused()||this.pause(),this.unAll(),this.buffer=null,this.disconnectFilters(),this.disconnectSource(),this.gainNode.disconnect(),this.scriptNode.disconnect(),this.analyser.disconnect(),this.params.closeAudioContext&&("function"===typeof this.ac.close&&"closed"!=this.ac.state&&this.ac.close(),this.ac=null,this.params.audioContext?this.params.audioContext=null:window.WaveSurferAudioContext=null,window.WaveSurferOfflineAudioContext=null)}},{key:"load",value:function(D){this.startPosition=0,this.lastPlay=this.ac.currentTime,this.buffer=D,this.createSource()}},{key:"createSource",value:function(){this.disconnectSource(),this.source=this.ac.createBufferSource(),this.source.start=this.source.start||this.source.noteGrainOn,this.source.stop=this.source.stop||this.source.noteOff,this.source.playbackRate.setValueAtTime(this.playbackRate,this.ac.currentTime),this.source.buffer=this.buffer,this.source.connect(this.analyser)}},{key:"isPaused",value:function(){return this.state!==this.states[_]}},{key:"getDuration",value:function(){return this.buffer?this.buffer.duration:this.explicitDuration?this.explicitDuration:0}},{key:"seekTo",value:function(D,M){if(this.buffer)return this.scheduledPause=null,null==D&&(D=this.getCurrentTime(),D>=this.getDuration()&&(D=0)),null==M&&(M=this.getDuration()),this.startPosition=D,this.lastPlay=this.ac.currentTime,this.state===this.states[S]&&this.setState(R),{start:D,end:M}}},{key:"getPlayedTime",value:function(){return(this.ac.currentTime-this.lastPlay)*this.playbackRate}},{key:"play",value:function(D,M){if(this.buffer){this.createSource();var B=this.seekTo(D,M);D=B.start,M=B.end,this.scheduledPause=M,this.source.start(0,D,M-D),"suspended"==this.ac.state&&this.ac.resume&&this.ac.resume(),this.setState(_),this.fireEvent("play")}}},{key:"pause",value:function(){this.scheduledPause=null,this.startPosition+=this.getPlayedTime(),this.source&&this.source.stop(0),this.setState(R),this.fireEvent("pause")}},{key:"getCurrentTime",value:function(){return this.state.getCurrentTime.call(this)}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"setPlaybackRate",value:function(D){D=D||1,this.isPaused()?this.playbackRate=D:(this.pause(),this.playbackRate=D,this.play())}}]),T}(E.Observer);n.default=A,A.scriptBufferSize=256,r.exports=n.default}})});