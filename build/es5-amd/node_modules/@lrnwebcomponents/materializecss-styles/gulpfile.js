var gulp=require("gulp"),fs=require("fs"),path=require("path"),_=require("lodash"),rename=require("gulp-rename"),replace=require("gulp-replace"),stripCssComments=require("strip-css-comments"),decomment=require("decomment"),sourcemaps=require("gulp-sourcemaps"),packageJson=require("./package.json");gulp.task("merge",function(){return gulp.src("./src/"+packageJson.wcfactory.elementName+".js").pipe(replace(/extends\s+PolymerElement\s+{/g,function(classStatement,character,jsFile){var oneLineFile=jsFile.slice(character).split("\n").join(" "),_$exec=/templateUrl\([^)]*\)\s*{\s*return\s+"([^"]+)"/.exec(oneLineFile),_$exec2=babelHelpers.slicedToArray(_$exec,2),templateUrl=_$exec2[1],html=fs.readFileSync(path.join("./src",templateUrl)).toString().trim();html=decomment(html);var _$exec3=/styleUrl\([^)]*\)\s*{\s*return\s+"([^"]+)"/.exec(oneLineFile),_$exec4=babelHelpers.slicedToArray(_$exec3,2),styleUrl=_$exec4[1],styleFilePath=path.join("./src",styleUrl),cssResult=fs.readFileSync(styleFilePath);cssResult=stripCssComments(cssResult).trim();return"".concat(classStatement,"\n  static get template() {\n    return html`\n<style>\n").concat(cssResult,"\n</style>\n").concat(html,"`;\n  }\n  // properties available to the custom element for data binding\n  static get properties() {\n    return ").concat("{}",";\n  }")})).pipe(gulp.dest("./"))});gulp.task("build",function(){var spawn=require("child_process").spawn,child=spawn("polymer",["build"]);return child.on("close",function(code){console.log("child process exited with code "+code)})});gulp.task("analyze",function(){var exec=require("child_process").exec;return exec("polymer analyze --input demo/index.html > analysis.json",function(error){if(null!==error){console.log("exec error: "+error)}})});gulp.task("compile",function(){gulp.src("./build/es6/"+packageJson.wcfactory.elementName+".js").pipe(rename({suffix:".es6"})).pipe(gulp.dest("./"));gulp.src("./build/es5-amd/"+packageJson.wcfactory.elementName+".js").pipe(rename({suffix:".amd"})).pipe(gulp.dest("./"));return gulp.src("./"+packageJson.wcfactory.elementName+".js").pipe(replace(/^(import .*?)(['"]\.\.\/(?!\.\.\/).*)(\.js['"];)$/gm,"$1$2.umd$3")).pipe(rename({suffix:".umd"})).pipe(gulp.dest("./"))});gulp.task("watch",function(){return gulp.watch("./src/*",gulp.series("merge","analyze"))});gulp.task("sourcemaps",function(){return gulp.src("./"+packageJson.wcfactory.elementName+".es6.js").pipe(sourcemaps.init()).pipe(sourcemaps.write("./"))});gulp.task("dev",gulp.series("merge","analyze","watch"));gulp.task("default",gulp.series("merge","analyze","build","compile","sourcemaps"));