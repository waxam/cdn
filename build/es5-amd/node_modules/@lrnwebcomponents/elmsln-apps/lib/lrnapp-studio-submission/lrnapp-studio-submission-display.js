define(["exports", "../../../../@polymer/polymer/polymer-element.js", "../../../../@polymer/paper-card/paper-card.js", "../../../../@polymer/marked-element/marked-element.js", "../../../../@polymer/iron-image/iron-image.js", "../../../../@polymer/polymer/lib/elements/dom-if.js", "../../../image-inspector/image-inspector.js", "../../../lrndesign-avatar/lrndesign-avatar.js", "../../../word-count/word-count.js", "../../../../@polymer/polymer/lib/elements/dom-repeat.js", "../../../lrnsys-button/lrnsys-button.js", "../../../lrndesign-contentblock/lrndesign-contentblock.js", "../../../lrnsys-layout/lib/lrnsys-dialog.js", "../../../utils/utils.js"], function (_exports, _polymerElement, _paperCard, _markedElement, _ironImage, _domIf, _imageInspector, _lrndesignAvatar, _wordCount, _domRepeat, _lrnsysButton, _lrndesignContentblock, _lrnsysDialog, _utils) {
  "use strict";

  Object.defineProperty(_exports, "__esModule", {
    value: true
  });
  _exports.LrnappStudioSubmissionDisplay = void 0;

  function _templateObject_70942140d34d11ea880ba1e93364c49c() {
    var data = babelHelpers.taggedTemplateLiteral(["\n      <style>\n        [hidden] {\n          display: none !important;\n        }\n        :host {\n          display: block;\n        }\n        p {\n          font-size: 14px;\n          line-height: 18px;\n        }\n        h1,\n        h2,\n        h3 {\n          margin: 0;\n          text-align: left;\n        }\n        iron-selector {\n          line-height: 1em;\n        }\n        iron-selector lrnsys-button {\n          display: inline-flex;\n        }\n        marked-element {\n          display: block;\n          margin: 0 5em 0 5em;\n        }\n        iron-image {\n          margin: 0 0.5em;\n        }\n        lrnsys-dialog {\n          display: inline;\n        }\n        .contain {\n          width: 10em;\n          height: 10em;\n          background: #ddd;\n        }\n        .center {\n          margin: auto;\n          width: 100%;\n        }\n        .title {\n          color: #222;\n          font-size: 2rem;\n          font-weight: 600;\n          line-height: 2.5rem;\n          padding: 0.25rem 0;\n          white-space: nowrap;\n          overflow-x: hidden;\n          text-overflow: ellipsis;\n          margin-top: 1rem;\n          text-align: center;\n        }\n        .author {\n          color: #555;\n          font-size: 1rem;\n          font-weight: 500;\n          font-style: normal;\n          line-height: 1rem;\n          padding: 0.25rem 0 0.5rem 0;\n          margin: 0;\n          text-transform: capitalize;\n        }\n        .date {\n          color: #555;\n          font-size: 16px;\n          font-style: normal;\n          padding: 0.25rem 0 0.5rem 0;\n          margin: 0;\n        }\n        .flex-wrap {\n          display: flex;\n        }\n        .submission-page-card {\n          width: 100%;\n          margin: 0;\n        }\n        :host([edit-page]) .submission-page {\n          width: 100%;\n        }\n        .image-dialog-header {\n          display: flex;\n        }\n        app-toolbar {\n          width: 36em;\n          background: #ddd;\n        }\n        lrnsys-button {\n          padding: 0.75em;\n        }\n        .top {\n          top: 8em;\n        }\n      </style>\n      <div class=\"submission-page\">\n        <paper-card class=\"submission-page-card ferpa-protect\">\n          <div class=\"card-content\">\n            <lrndesign-avatar\n              class=\"center\"\n              label=\"[[submission.relationships.author.data.name]]\"\n              src=\"[[submission.relationships.author.data.avatar]]\"\n            ></lrndesign-avatar>\n            <div class=\"author center\">\n              [[submission.relationships.author.data.display_name]]\n            </div>\n            <h2 class=\"title center\">[[submission.attributes.title]]</h2>\n            <div class=\"date center\">\n              Created: [[date(submission.meta.created)]]\n            </div>\n            <div class=\"date center\">\n              Last updated: [[date(submission.meta.changed)]]\n            </div>\n            <!-- ----- Text Submission ----- -->\n            <word-count>\n              <marked-element id=\"markedarea\"> </marked-element>\n            </word-count>\n            <!-- ----- Images Submission ----- -->\n            <template is=\"dom-if\" if=\"[[submission.attributes.images]]\">\n              <lrndesign-contentblock class=\"center\">\n                <template\n                  is=\"dom-repeat\"\n                  items=\"[[_toArray(submission.attributes.images)]]\"\n                  as=\"image\"\n                >\n                  <lrnsys-dialog alt=\"View Image\" dynamic-images=\"\">\n                    <div class=\"image-dialog-header\"></div>\n                    <span slot=\"button\">\n                      <iron-image\n                        style=\"width:200px; height:200px; background-color: lightgray;\"\n                        sizing=\"contain\"\n                        class=\"contain\"\n                        src$=\"[[_getImageThumbnail(image)]]\"\n                        preload=\"\"\n                        fade=\"\"\n                      ></iron-image>\n                    </span>\n                    <div style=\"text-align: center;\">\n                      <div hidden$=\"[[_isGif(image)]]\">\n                        <image-inspector src$=\"[[_getImageUrl(image)]]\">\n                          <span slot=\"toolbar\" style=\"display: inline-flex;\">\n                            <lrnsys-button\n                              alt=\"Download all images\"\n                              icon=\"icons:file-download\"\n                              href=\"[[submission.attributes.download_files]]\"\n                              target=\"_blank\"\n                            ></lrnsys-button>\n                          </span>\n                        </image-inspector>\n                      </div>\n                      <div hidden$=\"[[!_isGif(image)]]\">\n                        <lrnsys-button\n                          alt=\"Download all images\"\n                          icon=\"icons:file-download\"\n                          href=\"[[submission.attributes.download_files]]\"\n                          target=\"_blank\"\n                        ></lrnsys-button>\n                        <iron-image\n                          style=\"width:500px; height:500px; background-color: lightgray;\"\n                          sizing=\"contain\"\n                          class=\"contain\"\n                          src$=\"[[_getImageUrl(image)]]\"\n                          preload=\"\"\n                          fade=\"\"\n                        ></iron-image>\n                      </div>\n                    </div>\n                  </lrnsys-dialog>\n                </template>\n              </lrndesign-contentblock>\n            </template>\n            <!-- ----- Video Submission ----- -->\n            <template is=\"dom-if\" if=\"[[submission.attributes.video]]\">\n              <lrndesign-contentblock class=\"center\">\n                <template\n                  is=\"dom-repeat\"\n                  items=\"[[_toArray(submission.attributes.video)]]\"\n                  as=\"video\"\n                >\n                  <iframe\n                    width=\"460\"\n                    height=\"249\"\n                    src=\"[[video.video_src]]\"\n                  ></iframe>\n                </template>\n              </lrndesign-contentblock>\n            </template>\n            <!-- ----- Links Submission ----- -->\n            <template is=\"dom-if\" if=\"[[submission.attributes.links]]\">\n              <lrndesign-contentblock>\n                <template\n                  is=\"dom-repeat\"\n                  items=\"[[_toArray(submission.attributes.links)]]\"\n                  as=\"link\"\n                >\n                  <p>\n                    <strong>[[link.title]]:</strong>\n                    <a class=\"link\" href=\"[[link.url]]\" target=\"_blank\"\n                      >[[link.url]]</a\n                    >\n                  </p>\n                </template>\n              </lrndesign-contentblock>\n            </template>\n            <!-- ----- Files Submission ----- -->\n            <template is=\"dom-if\" if=\"[[submission.attributes.files]]\">\n              <lrndesign-contentblock title=\"Files Submitted\">\n                <template\n                  is=\"dom-repeat\"\n                  items=\"[[_toArray(submission.attributes.files)]]\"\n                  as=\"file\"\n                >\n                  <p>\n                    <strong>[[file.filename]]:</strong>\n                    <a class=\"link\" href=\"[[file.url]]\" target=\"_blank\"\n                      >[[file.url]]</a\n                    >\n                  </p>\n                </template>\n              </lrndesign-contentblock>\n            </template>\n          </div>\n        </paper-card>\n      </div>\n    "]);

    _templateObject_70942140d34d11ea880ba1e93364c49c = function _templateObject_70942140d34d11ea880ba1e93364c49c() {
      return data;
    };

    return data;
  }

  var LrnappStudioSubmissionDisplay =
  /*#__PURE__*/
  function (_PolymerElement) {
    babelHelpers.inherits(LrnappStudioSubmissionDisplay, _PolymerElement);

    function LrnappStudioSubmissionDisplay() {
      babelHelpers.classCallCheck(this, LrnappStudioSubmissionDisplay);
      return babelHelpers.possibleConstructorReturn(this, babelHelpers.getPrototypeOf(LrnappStudioSubmissionDisplay).apply(this, arguments));
    }

    babelHelpers.createClass(LrnappStudioSubmissionDisplay, [{
      key: "_submissionLoaded",
      value: function _submissionLoaded(newValue) {
        // wipe the slot of the marked area
        if (this.shadowRoot && this.shadowRoot.querySelector("#markedarea")) {
          (0, _utils.wipeSlot)(this.shadowRoot.querySelector("#markedarea"));
        }

        if (newValue && newValue.attributes && newValue.attributes.body) {
          var mdscript = document.createElement("script");
          mdscript.type = "text/markdown";
          mdscript.innerHTML = newValue.attributes.body;
          this.shadowRoot.querySelector("#markedarea").appendChild(mdscript);
          this.shadowRoot.querySelector("#markedarea").markdown = newValue.attributes.body;
        }
      }
    }, {
      key: "date",
      value: function date(time) {
        if (time) {
          var parts = time.split("-");
          var times = time.split("T");
          var month = parts[2].split("T");
          times = times[1].split("-");
          return parts[1] + "/" + month[0] + " - " + times[0];
        }
      }
      /**
       * Simple way to convert from object to array.
       */

    }, {
      key: "_toArray",
      value: function _toArray(obj) {
        if (babelHelpers.typeof(obj) === "object" && obj !== null) {
          return Object.keys(obj).map(function (key) {
            return obj[key];
          });
        }

        return [];
      }
      /**
       * get thumbnail or just the image data directly based on truncated data
       */

    }, {
      key: "_getImageThumbnail",
      value: function _getImageThumbnail(image) {
        if (image) {
          if (image.thumbnail) {
            return image.thumbnail;
          }

          return image;
        }

        return "";
      }
      /**
       * get url or just the image data directly based on truncated data
       */

    }, {
      key: "_getImageUrl",
      value: function _getImageUrl(image) {
        if (image) {
          if (image.url) {
            return image.url;
          }

          return image;
        }

        return "";
      }
      /**
       * See if this is a GIF, if it is then report back so we
       * know which player to display.
       */

    }, {
      key: "_isGif",
      value: function _isGif(image) {
        // get url from image normalizing for simplified data
        var url = this._getImageUrl(image);

        if (url != "" && url.indexOf(".gif") != -1) {
          return true;
        }

        return false;
      }
    }], [{
      key: "template",
      get: function get() {
        return (0, _polymerElement.html)(_templateObject_70942140d34d11ea880ba1e93364c49c());
      }
    }, {
      key: "tag",
      get: function get() {
        return "lrnapp-studio-submission-display";
      }
    }, {
      key: "properties",
      get: function get() {
        return {
          /**
           * Object that has all the details of a submission that
           * is being viewed.
           */
          submission: {
            type: Object,
            notify: true,
            observer: "_submissionLoaded"
          },
          elmslnCourse: {
            type: String
          },
          elmslnSection: {
            type: String
          },
          basePath: {
            type: String
          },
          csrfToken: {
            type: String
          },
          endPoint: {
            type: String
          }
        };
      }
    }]);
    return LrnappStudioSubmissionDisplay;
  }(_polymerElement.PolymerElement);

  _exports.LrnappStudioSubmissionDisplay = LrnappStudioSubmissionDisplay;
  window.customElements.define(LrnappStudioSubmissionDisplay.tag, LrnappStudioSubmissionDisplay);
});