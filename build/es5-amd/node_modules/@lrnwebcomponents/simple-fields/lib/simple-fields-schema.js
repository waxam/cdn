define(["exports","require","../../../lit-element/lit-element.js","./simple-fields-array.js"],function(_exports,_require,_litElement,_simpleFieldsArray){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.SimpleFieldsSchema=void 0;_require=babelHelpers.interopRequireWildcard(_require);function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable});keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1,source;i<arguments.length;i++){source=null!=arguments[i]?arguments[i]:{};if(i%2){ownKeys(Object(source),!0).forEach(function(key){babelHelpers.defineProperty(target,key,source[key])})}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source))}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))})}}return target}function _templateObject2_9b885730600811eaa16cad22a3013b8c(){var data=babelHelpers.taggedTemplateLiteral([""]);_templateObject2_9b885730600811eaa16cad22a3013b8c=function _templateObject2_9b885730600811eaa16cad22a3013b8c(){return data};return data}function _templateObject_9b885730600811eaa16cad22a3013b8c(){var data=babelHelpers.taggedTemplateLiteral(["\n      <div id=\"schema-fields\" aria-live=\"polite\">\n        <slot></slot>\n      </div>\n    "]);_templateObject_9b885730600811eaa16cad22a3013b8c=function _templateObject_9b885730600811eaa16cad22a3013b8c(){return data};return data}/**
 * `simple-fields-schema`
 * 
### Styling

`<simple-fields-schema>` provides the following custom properties
for styling:

Custom property | Description | Default
----------------|-------------|----------
`--simple-fields-schema-margin` | margin around the simple-fields-schema | 15px 0
 *
 * @demo ./demo/schema.html
 * @customElement simple-fields-schema
 */var SimpleFieldsSchema=/*#__PURE__*/function(_LitElement){babelHelpers.inherits(SimpleFieldsSchema,_LitElement);babelHelpers.createClass(SimpleFieldsSchema,[{key:"render",value:function render(){return(0,_litElement.html)(_templateObject_9b885730600811eaa16cad22a3013b8c())}}],[{key:"styles",get:function get(){return[(0,_litElement.css)(_templateObject2_9b885730600811eaa16cad22a3013b8c())]}}]);function SimpleFieldsSchema(){var _this;babelHelpers.classCallCheck(this,SimpleFieldsSchema);_this=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(SimpleFieldsSchema).call(this));_this.autofocus=!1;_this.codeTheme="vs-light-2";_this.dataTypes={array:{element:"simple-fields-array",defaultValue:[],isArray:!0,previewSlot:"preview",sortSlot:"sort"},boolean:{element:"simple-fields-boolean",defaultValue:!1},fieldset:{element:"simple-fields-fieldset",defaultValue:{},isFieldset:!0},file:{element:"simple-fields-file",defaultValue:{}},integer:{element:"paper-input",defaultValue:"",type:"number",step:1},markup:{element:"simple-fields-markup",defaultValue:""},number:{element:"paper-input",type:"number",defaultValue:""},object:{element:"simple-fields-fieldset",defaultValue:{},isFieldset:!0},string:{element:"paper-input"},tabs:{element:"a11y-tabs",defaultValue:{},isFieldset:!0}};_this.language="en";_this.resources={};_this.value={};setTimeout(function(){new Promise(function(res,rej){return _require.default(["./simple-fields-fieldset.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../@polymer/iron-icons/iron-icons.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../@polymer/iron-icons/editor-icons.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../@polymer/paper-input/paper-input.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../../@polymer/paper-icon-button/paper-icon-button.js"],res,rej)});new Promise(function(res,rej){return _require.default(["../../simple-tooltip/simple-tooltip.js"],res,rej)})},0);return _this}babelHelpers.createClass(SimpleFieldsSchema,[{key:"_buildFormElement",/**
   * adds form element to page
   *
   * @param {object} config properties object for the element
   * @param {object} [parent=this] parent where element will be appended
   * @param {number} index if in array, element's index
   * @param {string} string name of slot
   * @returns {object} form element
   */value:function _buildFormElement(config){var _this2=this,parent=1<arguments.length&&arguments[1]!==void 0?arguments[1]:this,index=2<arguments.length&&arguments[2]!==void 0?arguments[2]:-1,slot=3<arguments.length?arguments[3]:void 0,el=document.createElement(config.component.type.element),elname=-1<index?config.name.replace("..",".".concat(index,".")):config.name,elval=this._getValue(elname),keys=config.schema.properties?Object.keys(config.schema.properties):[];el.label=config.label||config.title;el.schema=config.schema;el.resources=this.resources;el.setAttribute("language",this.language);el.setAttribute("name",elname);Object.keys(config.component.type).forEach(function(key){if("element"!==key||"valueProperty")el.setAttribute(key,config.component.type[key])});if(config.schema.hidden)el.setAttribute("hidden",!0);if(slot)el.slot=slot;parent.append(el);if(config.component.type.isArray&&0>index){el.addEventListener("add",function(e){return _this2._setValue("".concat(elname,".").concat(elval.length),{})});el.addEventListener("remove",function(e){var temp=_this2._deepClone(elval);temp.splice(parseInt(e.detail.id.replace(/item-/,"")),1);console.log(temp,parseInt(e.detail.id.replace(/item-/,"")));_this2._setValue("".concat(elname),temp)});if(config.sortBy)elval=elval.sort(function(a,b){var i=0,ai=0,bi=0;while(i<config.sortBy.length&&ai===bi){ai=a[config.sortBy[i]];bi=b[config.sortBy[i]];i++}return ai===bi?0:ai<bi?-1:1});/* gets array items */if(elval)elval.forEach(function(item,i){/* gets array item config */var id="item-".concat(i),child=el.buildItem(id),sortSlot=config.component.type.sortSlot,previewSlot=config.component.type.previewSlot,previewKeys=keys.filter(function(key){return!0===config.schema.properties[key].previewField});if(1>previewKeys.length)previewKeys.push(keys[0]);/* adds fields to array items */keys.forEach(function(key){var childname=config.schema.properties[key].name.replace("".concat(elname,".."),"");_this2._buildFormElement(config.schema.properties[key],child,i,sortSlot&&config.sortBy[0]===childname?sortSlot:previewKeys.includes(key)?previewSlot:void 0)})})}else if(config.schema&&config.schema.properties){/* gets nested fields for a fieldset */Object.keys(config.schema.properties).forEach(function(key){return _this2._buildFormElement(config.schema.properties[key],el)})}else{el[config.component.valueProperty]=elval;el.onchange=function(e){return _this2._setValue(elname,el[config.component.valueProperty])}}}/**
   * returns an array of properties for a given schema object
   * @param {object} target parent of nested properties
   * @returns {array} form properties
   */},{key:"_getProperties",value:function _getProperties(){var _this3=this,target=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.schema,prefix=1<arguments.length?arguments[1]:void 0,root=this;return Object.keys(target.properties||[]).map(function(key){var schema=target.properties[key],property={name:prefix?"".concat(prefix,".").concat(key):key,schema:schema,component:schema.component||{},description:schema.description,label:schema.title||key,previewField:schema.previewField,sortBy:schema.sortBy};property.component.valueProperty=property.component.valueProperty||"value";property.component.slot=property.component.slot||"";/* match the schema type to the correct data type */Object.keys(root.dataTypes).forEach(function(key){if(Array.isArray(schema.type)&&-1!==schema.type.indexOf(key)||schema.type===key){property.component.type=_this3._deepClone(root.dataTypes[key]);property.component.type.element=property.component.name||property.component.type.element;property.component.type.type=schema.format;/* handle fieldsets by getting nested properties */if(property.component.type.isFieldset||property.component.type.isArray){if(!schema.items||!schema.items.properties)schema.items={properties:schema.properties?_this3._deepClone(schema.properties):{}};if(schema.items&&schema.items.properties){//console.log('schema.items',schema.items);
property.schema.properties=_this3._getProperties(schema.items,property.component.type.isArray?"".concat(property.name,"."):property.name)}}}});if(!property.component.type||!property.component.type.element)console.error("Unknown property type %s",schema.type);return property})}/**
   * sets value of a property
   *
   * @param {string} propName property to set
   * @param {*} propVal value of the property
   */},{key:"_setValue",value:function _setValue(propName,propVal){//console.log('_setValue',propName,propVal);
for(var oldValue=this._deepClone(this.value),newValue=this.value,props=propName.split("."),l=props.length,i=0,pointer;i<l-1;i++){pointer=props[i];if(!newValue[pointer])newValue[pointer]={};newValue=newValue[pointer]}newValue[props[l-1]]=propVal;this._valueChanged(this.value,oldValue)}/**
   * gets value of a property
   *
   * @param {string} propName property to set
   * @returns {*}
   */},{key:"_getValue",value:function _getValue(propName){var path=propName.split("."),pointer=this.value;path.forEach(function(prop){if(pointer&&pointer[prop]){pointer=pointer[prop]}else{pointer=void 0;return}});return pointer}/**
   * Updates a11y-collapse item when properties change
   */},{key:"updated",value:function updated(changedProperties){var _this4=this;changedProperties.forEach(function(oldValue,propName){//console.log('changedProperties',propName,oldValue,this[propName]);
if("schema"===propName)_this4._schemaChanged(_this4.schema,oldValue);if("value"===propName)_this4._valueChanged(_this4.value,oldValue)})}/**
   * clears the form
   */},{key:"_clearForm",value:function _clearForm(){this.querySelectorAll("*").forEach(function(child){return child.remove()})}/**
   * clones an object and all its subproperties
   * @param {object} o the object to clone
   * @returns {object} the cloned object
   */},{key:"_deepClone",value:function _deepClone(o){return JSON.parse(JSON.stringify(o))}/**
   * clears and rebuilds the form
   */},{key:"_rebuildForm",value:function _rebuildForm(){var _this5=this;//console.log("_rebuildForm",this.value,this.schema);
this._clearForm();if(this.schema){var formProperties=this._getProperties(this.schema);formProperties.forEach(function(property){return _this5._buildFormElement(property)})}}/**
   * updates the form  and fires event when the value changes
   * @param {object} newValue the new value for the schema
   * @param {object} oldValue the old value for the schema
   * @event value-changed
   */},{key:"_valueChanged",value:function _valueChanged(newValue,oldValue){console.log("this._valueChanged",this.value,oldValue);if(newValue&&newValue!==oldValue){this._rebuildForm();this.dispatchEvent(new CustomEvent("value-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}}/**
   * updates the form and fires event when the schema changes
   * @param {object} newValue the new value for the schema
   * @param {object} oldValue the old value for the schema
   * @event schema-changed
   */},{key:"_schemaChanged",value:function _schemaChanged(newValue,oldValue){//console.log("this._schemaChanged",this.schema,oldValue);
if(newValue&&newValue!==oldValue){this._rebuildForm();this.dispatchEvent(new CustomEvent("schema-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}}},{key:"disconnectedCallback",value:function disconnectedCallback(){this._clearForm();babelHelpers.get(babelHelpers.getPrototypeOf(SimpleFieldsSchema.prototype),"disconnectedCallback",this).call(this)}}],[{key:"tag",get:function get(){return"simple-fields-schema"}},{key:"properties",get:function get(){return _objectSpread({},babelHelpers.get(babelHelpers.getPrototypeOf(SimpleFieldsSchema),"properties",this),{/**
       * automatically set focus on the first field if that field has autofocus
       */autofocus:{type:Boolean},/**
       * the name of the code-editor theme
       */codeTheme:{type:String},dataTypes:{type:Object},error:{type:Object},label:{type:String},language:{type:String,attribute:"lang",reflect:!0},resources:{type:Object},schema:{type:Object},value:{type:Object},wizard:{type:Boolean}})}}]);return SimpleFieldsSchema}(_litElement.LitElement);_exports.SimpleFieldsSchema=SimpleFieldsSchema;window.customElements.define(SimpleFieldsSchema.tag,SimpleFieldsSchema)});