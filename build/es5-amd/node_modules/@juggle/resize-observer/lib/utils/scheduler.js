define(["exports","./process.js","./global.js","./queueResizeObserver.js"],function(_exports,_process,_global,_queueResizeObserver){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.updateCount=_exports.scheduler=void 0;var watching=0,isWatching=function isWatching(){return!!watching},CATCH_FRAMES=60/5,observerConfig={attributes:!0,characterData:!0,childList:!0,subtree:!0},events=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],scheduled=!1,Scheduler=function(){function Scheduler(){var _this=this;this.stopped=!0;this.listener=function(){return _this.schedule()}}Scheduler.prototype.run=function(frames){var _this=this;if(scheduled){return}scheduled=!0;(0,_queueResizeObserver.queueResizeObserver)(function(){var elementsHaveResized=!1;try{elementsHaveResized=(0,_process.process)()}finally{scheduled=!1;if(!isWatching()){return}if(elementsHaveResized){_this.run(60)}else if(frames){_this.run(frames-1)}else{_this.start()}}})};Scheduler.prototype.schedule=function(){this.stop();this.run(CATCH_FRAMES)};Scheduler.prototype.observe=function(){var _this=this,cb=function cb(){return _this.observer&&_this.observer.observe(document.body,observerConfig)};document.body?cb():_global.global.addEventListener("DOMContentLoaded",cb)};Scheduler.prototype.start=function(){var _this=this;if(this.stopped){this.stopped=!1;this.observer=new MutationObserver(this.listener);this.observe();events.forEach(function(name){return _global.global.addEventListener(name,_this.listener,!0)})}};Scheduler.prototype.stop=function(){var _this=this;if(!this.stopped){this.observer&&this.observer.disconnect();events.forEach(function(name){return _global.global.removeEventListener(name,_this.listener,!0)});this.stopped=!0}};return Scheduler}(),scheduler=new Scheduler;_exports.scheduler=scheduler;var updateCount=function updateCount(n){!watching&&0<n&&scheduler.start();watching+=n;watching||scheduler.stop()};_exports.updateCount=updateCount});