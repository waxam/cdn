define(["exports","../../../@polymer/polymer/lib/utils/debounce.js","../../../@polymer/polymer/lib/utils/async.js"],function(_exports,_debounce,_async){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.ScrollMixin=void 0;_exports.ScrollMixin=function ScrollMixin(superClass){return function(_superClass){babelHelpers.inherits(ScrollMixin,_superClass);function ScrollMixin(){babelHelpers.classCallCheck(this,ScrollMixin);return babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(ScrollMixin).apply(this,arguments))}babelHelpers.createClass(ScrollMixin,[{key:"ready",value:function ready(){var _this=this;babelHelpers.get(babelHelpers.getPrototypeOf(ScrollMixin.prototype),"ready",this).call(this);this.scrollTarget=this.$.table;this.addEventListener("wheel",function(e){_this._wheelScrolling=!0;_this._debouncerWheelScrolling=_debounce.Debouncer.debounce(_this._debouncerWheelScrolling,_async.timeOut.after(_this._timeouts.WHEEL_SCROLLING),function(){return _this._wheelScrolling=!1});_this._onWheel(e)});this.$.table.addEventListener("scroll",function(e){if(_this.$.outerscroller.outerScrolling){e.stopImmediatePropagation()}},!0);this.$.items.addEventListener("focusin",function(e){var itemsIndex=e.composedPath().indexOf(_this.$.items);_this._rowWithFocusedElement=e.composedPath()[itemsIndex-1]});this.$.items.addEventListener("focusout",function(){return _this._rowWithFocusedElement=void 0})}},{key:"_onWheel",value:function _onWheel(e){var _Mathabs=Math.abs,_this2=this;if(e.ctrlKey||this._hasScrolledAncestor(e.target,e.deltaX,e.deltaY)){return}var table=this.$.table,deltaY=e.deltaY;if(1===e.deltaMode){deltaY*=this._physicalAverage}var momentum=_Mathabs(e.deltaX)+_Mathabs(deltaY);if(this._canScroll(table,e.deltaX,deltaY)){e.preventDefault();table.scrollTop+=deltaY;table.scrollLeft+=e.deltaX;this._scrollHandler();this._hasResidualMomentum=!0;this._ignoreNewWheel=!0;this._debouncerIgnoreNewWheel=_debounce.Debouncer.debounce(this._debouncerIgnoreNewWheel,_async.timeOut.after(this._timeouts.IGNORE_WHEEL),function(){return _this2._ignoreNewWheel=!1})}else if(this._hasResidualMomentum&&momentum<=this._previousMomentum||this._ignoreNewWheel){e.preventDefault()}else if(momentum>this._previousMomentum){this._hasResidualMomentum=!1}this._previousMomentum=momentum}},{key:"_hasScrolledAncestor",value:function _hasScrolledAncestor(el,deltaX,deltaY){if(this._canScroll(el,deltaX,deltaY)){return!0}else if("vaadin-grid-cell-content"!==el.localName&&el!==this&&el.parentElement){return this._hasScrolledAncestor(el.parentElement,deltaX,deltaY)}}},{key:"_canScroll",value:function _canScroll(el,deltaX,deltaY){return 0<deltaY&&el.scrollTop<el.scrollHeight-el.offsetHeight||0>deltaY&&0<el.scrollTop||0<deltaX&&el.scrollLeft<el.scrollWidth-el.offsetWidth||0>deltaX&&0<el.scrollLeft}},{key:"_scheduleScrolling",value:function _scheduleScrolling(){var _this3=this;if(!this._scrollingFrame){this._scrollingFrame=requestAnimationFrame(function(){return _this3._toggleAttribute("scrolling",!0,_this3.$.scroller)})}this._debounceScrolling=_debounce.Debouncer.debounce(this._debounceScrolling,_async.timeOut.after(this._timeouts.SCROLLING),function(){cancelAnimationFrame(_this3._scrollingFrame);delete _this3._scrollingFrame;_this3._toggleAttribute("scrolling",!1,_this3.$.scroller);if(!_this3.$.outerscroller.outerScrolling){_this3._reorderRows()}});if(!this._scrollPeriodFrame){this._scrollPeriodFrame=requestAnimationFrame(function(){return _this3._toggleAttribute("scroll-period",!0,_this3.$.scroller)})}this._debounceScrollPeriod=_debounce.Debouncer.debounce(this._debounceScrollPeriod,_async.timeOut.after(this._timeouts.SCROLL_PERIOD),function(){cancelAnimationFrame(_this3._scrollPeriodFrame);delete _this3._scrollPeriodFrame;_this3._toggleAttribute("scroll-period",!1,_this3.$.scroller)})}},{key:"_afterScroll",value:function _afterScroll(){this._translateStationaryElements();if(!this.hasAttribute("reordering")){this._scheduleScrolling()}var os=this.$.outerscroller;if(!this._ios&&(this._wheelScrolling||os.passthrough)){os.syncOuterScroller()}if(this._ios){var overScroll=Math.max(-os.scrollTop,0)||Math.min(0,os.scrollHeight-os.scrollTop-os.offsetHeight);this.$.items.style.transform="translateY(".concat(overScroll,"px)")}this._updateOverflow()}},{key:"_updateOverflow",value:function _updateOverflow(){var _this4=this,overflow="",table=this.$.table;if(table.scrollTop<table.scrollHeight-table.clientHeight){overflow+=" bottom"}if(0<table.scrollTop){overflow+=" top"}if(table.scrollLeft<table.scrollWidth-table.clientWidth){overflow+=" right"}if(0<table.scrollLeft){overflow+=" left"}this._debounceOverflow=_debounce.Debouncer.debounce(this._debounceOverflow,_async.animationFrame,function(){var value=overflow.trim();if(0<value.length&&_this4.getAttribute("overflow")!==value){_this4.setAttribute("overflow",value)}else if(0==value.length&&_this4.hasAttribute("overflow")){_this4.removeAttribute("overflow")}})}},{key:"_reorderRows",value:function _reorderRows(){var body=this.$.items,items=body.querySelectorAll("tr");if(!items.length){return}var adjustedVirtualStart=this._virtualStart+this._vidxOffset,targetRow=this._rowWithFocusedElement||Array.from(items).filter(function(row){return!row.hidden})[0];if(!targetRow){return}var targetPhysicalIndex=targetRow.index-adjustedVirtualStart,delta=Array.from(items).indexOf(targetRow)-targetPhysicalIndex;if(0<delta){for(var i=0;i<delta;i++){body.appendChild(items[i])}}else if(0>delta){for(var _i=items.length+delta;_i<items.length;_i++){body.insertBefore(items[_i],items[0])}}}},{key:"_frozenCellsChanged",value:function _frozenCellsChanged(){var _this5=this;this._debouncerCacheElements=_debounce.Debouncer.debounce(this._debouncerCacheElements,_async.microTask,function(){Array.from(_this5.root.querySelectorAll("[part~=\"cell\"]")).forEach(function(cell){cell.style.transform=""});_this5._frozenCells=Array.prototype.slice.call(_this5.$.table.querySelectorAll("[frozen]"));_this5._translateStationaryElements()});this._updateLastFrozen()}},{key:"_updateLastFrozen",value:function _updateLastFrozen(){if(!this._columnTree){return}var columnsRow=this._columnTree[this._columnTree.length-1].slice(0);columnsRow.sort(function(a,b){return a._order-b._order});var lastFrozen=columnsRow.reduce(function(prev,col,index){col._lastFrozen=!1;return col.frozen&&!col.hidden?index:prev},void 0);if(lastFrozen!==void 0){columnsRow[lastFrozen]._lastFrozen=!0}}},{key:"_translateStationaryElements",value:function _translateStationaryElements(){if(this._edge&&!this._scrollbarWidth){this.$.items.style.transform=this._getTranslate(-this._scrollLeft||0,-this._scrollTop||0);this.$.footer.style.transform=this.$.header.style.transform=this._getTranslate(-this._scrollLeft||0,0)}else{this.$.footer.style.transform=this.$.header.style.transform=this._getTranslate(0,this._scrollTop)}for(var frozenCellTransform=this._getTranslate(this._scrollLeft,0),i=0;i<this._frozenCells.length;i++){this._frozenCells[i].style.transform=frozenCellTransform}}},{key:"_getTranslate",value:function _getTranslate(x,y){return"translate("+x+"px,"+y+"px)"}},{key:"_scrollHeightUpdated",value:function _scrollHeightUpdated(_estScrollHeight){this.$.outersizer.style.top=this.$.fixedsizer.style.top=_estScrollHeight+"px"}},{key:"_timeouts",get:function get(){return{SCROLL_PERIOD:1e3,WHEEL_SCROLLING:200,SCROLLING:100,IGNORE_WHEEL:500}}}],[{key:"properties",get:function get(){return{_frozenCells:{type:Array,value:function value(){return[]}},_scrollbarWidth:{type:Number,value:function value(){var scrollDiv=document.createElement("div");scrollDiv.style.width="100px";scrollDiv.style.height="100px";scrollDiv.style.overflow="scroll";scrollDiv.style.position="absolute";scrollDiv.style.top="-9999px";document.body.appendChild(scrollDiv);var scrollbarWidth=scrollDiv.offsetWidth-scrollDiv.clientWidth;document.body.removeChild(scrollDiv);return scrollbarWidth}},_rowWithFocusedElement:Element}}},{key:"observers",get:function get(){return["_scrollHeightUpdated(_estScrollHeight)"]}}]);return ScrollMixin}(superClass)}});