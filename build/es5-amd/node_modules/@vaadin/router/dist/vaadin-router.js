define(["exports"],function(_exports){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.Resolver=_exports.Router=void 0;function toArray(objectOrArray){objectOrArray=objectOrArray||[];return Array.isArray(objectOrArray)?objectOrArray:[objectOrArray]}function log(msg){return"[Vaadin.Router] ".concat(msg)}function logValue(value){if("object"!==babelHelpers.typeof(value)){return value+""}var stringType=Object.prototype.toString.call(value).match(/ (.*)\]$/)[1];if("Object"===stringType||"Array"===stringType){return"".concat(stringType," ").concat(JSON.stringify(value))}else{return stringType}}var MODULE="module",NOMODULE="nomodule",bundleKeys=[MODULE,NOMODULE];function ensureBundle(src){if(!src.match(/.+\.[m]?js$/)){throw new Error(log("Unsupported type for bundle \"".concat(src,"\": .js or .mjs expected.")))}}function ensureRoute(route){if(!route||!isString(route.path)){throw new Error(log("Expected route config to be an object with a \"path\" string property, or an array of such objects"))}var bundle=route.bundle,stringKeys=["component","redirect","bundle"];if(!isFunction(route.action)&&!Array.isArray(route.children)&&!isFunction(route.children)&&!isObject(bundle)&&!stringKeys.some(function(key){return isString(route[key])})){throw new Error(log("Expected route config \"".concat(route.path,"\" to include either \"").concat(stringKeys.join("\", \""),"\" ")+"or \"action\" function but none found."))}if(bundle){if(isString(bundle)){ensureBundle(bundle)}else if(!bundleKeys.some(function(key){return key in bundle})){throw new Error(log("Expected route bundle to include either \""+NOMODULE+"\" or \""+MODULE+"\" keys, or both"))}else{bundleKeys.forEach(function(key){return key in bundle&&ensureBundle(bundle[key])})}}if(route.redirect){["bundle","component"].forEach(function(overriddenProp){if(overriddenProp in route){console.warn(log("Route config \"".concat(route.path,"\" has both \"redirect\" and \"").concat(overriddenProp,"\" properties, ")+"and \"redirect\" will always override the latter. Did you mean to only use \"".concat(overriddenProp,"\"?")))}})}}function ensureRoutes(routes){toArray(routes).forEach(function(route){return ensureRoute(route)})}function loadScript(src,key){var script=document.head.querySelector("script[src=\""+src+"\"][async]");if(!script){script=document.createElement("script");script.setAttribute("src",src);if(key===MODULE){script.setAttribute("type",MODULE)}else if(key===NOMODULE){script.setAttribute(NOMODULE,"")}script.async=!0}return new Promise(function(resolve,reject){script.onreadystatechange=script.onload=function(e){script.__dynamicImportLoaded=!0;resolve(e)};script.onerror=function(e){if(script.parentNode){script.parentNode.removeChild(script)}reject(e)};if(null===script.parentNode){document.head.appendChild(script)}else if(script.__dynamicImportLoaded){resolve()}})}function loadBundle(bundle){if(isString(bundle)){return loadScript(bundle)}else{return Promise.race(bundleKeys.filter(function(key){return key in bundle}).map(function(key){return loadScript(bundle[key],key)}))}}function fireRouterEvent(type,detail){return!window.dispatchEvent(new CustomEvent("vaadin-router-".concat(type),{cancelable:"go"===type,detail:detail}))}function isObject(o){return"object"===babelHelpers.typeof(o)&&!!o}function isFunction(f){return"function"===typeof f}function isString(s){return"string"===typeof s}function getNotFoundError(context){var error=new Error(log("Page not found (".concat(context.pathname,")")));error.context=context;error.code=404;return error}var notFoundResult=new function NotFoundResult(){babelHelpers.classCallCheck(this,NotFoundResult)};function getAnchorOrigin(anchor){var port=anchor.port,protocol=anchor.protocol,host="http:"===protocol&&"80"===port||"https:"===protocol&&"443"===port?anchor.hostname:anchor.host;return"".concat(protocol,"//").concat(host)}function vaadinRouterGlobalClickHandler(event){if(event.defaultPrevented){return}if(0!==event.button){return}if(event.shiftKey||event.ctrlKey||event.altKey||event.metaKey){return}for(var anchor=event.target,path=event.composedPath?event.composedPath():event.path||[],i=0,target;i<path.length;i++){target=path[i];if(target.nodeName&&"a"===target.nodeName.toLowerCase()){anchor=target;break}}while(anchor&&"a"!==anchor.nodeName.toLowerCase()){anchor=anchor.parentNode}if(!anchor||"a"!==anchor.nodeName.toLowerCase()){return}if(anchor.target&&"_self"!==anchor.target.toLowerCase()){return}if(anchor.hasAttribute("download")){return}if(anchor.pathname===window.location.pathname&&""!==anchor.hash){return}var origin=anchor.origin||getAnchorOrigin(anchor);if(origin!==window.location.origin){return}if(fireRouterEvent("go",{pathname:anchor.pathname})){event.preventDefault()}}var isIE=/Trident/.test(navigator.userAgent);if(isIE&&!isFunction(window.PopStateEvent)){window.PopStateEvent=function(inType,params){params=params||{};var e=document.createEvent("Event");e.initEvent(inType,!!params.bubbles,!!params.cancelable);e.state=params.state||null;return e};window.PopStateEvent.prototype=window.Event.prototype}function vaadinRouterGlobalPopstateHandler(event){if("vaadin-router-ignore"===event.state){return}fireRouterEvent("go",{pathname:window.location.pathname})}var pathToRegexp_1=pathToRegexp,DEFAULT_DELIMITER="/",DEFAULT_DELIMITERS="./",PATH_REGEXP=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function parse(str,options){var tokens=[],key=0,index=0,path="",defaultDelimiter=options&&options.delimiter||DEFAULT_DELIMITER,delimiters=options&&options.delimiters||DEFAULT_DELIMITERS,pathEscaped=!1,res;while(null!==(res=PATH_REGEXP.exec(str))){var m=res[0],escaped=res[1],offset=res.index;path+=str.slice(index,offset);index=offset+m.length;if(escaped){path+=escaped[1];pathEscaped=!0;continue}var prev="",next=str[index],name=res[2],capture=res[3],group=res[4],modifier=res[5];if(!pathEscaped&&path.length){var k=path.length-1;if(-1<delimiters.indexOf(path[k])){prev=path[k];path=path.slice(0,k)}}if(path){tokens.push(path);path="";pathEscaped=!1}var partial=""!==prev&&next!==void 0&&next!==prev,delimiter=prev||defaultDelimiter,pattern=capture||group;tokens.push({name:name||key++,prefix:prev,delimiter:delimiter,optional:"?"===modifier||"*"===modifier,repeat:"+"===modifier||"*"===modifier,partial:partial,pattern:pattern?escapeGroup(pattern):"[^"+escapeString(delimiter)+"]+?"})}if(path||index<str.length){tokens.push(path+str.substr(index))}return tokens}function tokensToFunction(tokens){for(var matches=Array(tokens.length),i=0;i<tokens.length;i++){if("object"===babelHelpers.typeof(tokens[i])){matches[i]=new RegExp("^(?:"+tokens[i].pattern+")$")}}return function(data,options){for(var path="",encode=options&&options.encode||encodeURIComponent,i=0,token;i<tokens.length;i++){token=tokens[i];if("string"===typeof token){path+=token;continue}var value=data?data[token.name]:void 0,segment;if(Array.isArray(value)){if(!token.repeat){throw new TypeError("Expected \""+token.name+"\" to not repeat, but got array")}if(0===value.length){if(token.optional)continue;throw new TypeError("Expected \""+token.name+"\" to not be empty")}for(var j=0;j<value.length;j++){segment=encode(value[j],token);if(!matches[i].test(segment)){throw new TypeError("Expected all \""+token.name+"\" to match \""+token.pattern+"\"")}path+=(0===j?token.prefix:token.delimiter)+segment}continue}if("string"===typeof value||"number"===typeof value||"boolean"===typeof value){segment=encode(value+"",token);if(!matches[i].test(segment)){throw new TypeError("Expected \""+token.name+"\" to match \""+token.pattern+"\", but got \""+segment+"\"")}path+=token.prefix+segment;continue}if(token.optional){if(token.partial)path+=token.prefix;continue}throw new TypeError("Expected \""+token.name+"\" to be "+(token.repeat?"an array":"a string"))}return path}}function escapeString(str){return str.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function escapeGroup(group){return group.replace(/([=!:$/()])/g,"\\$1")}function flags(options){return options&&options.sensitive?"":"i"}function regexpToRegexp(path,keys){if(!keys)return path;var groups=path.source.match(/\((?!\?)/g);if(groups){for(var i=0;i<groups.length;i++){keys.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null})}}return path}function arrayToRegexp(path,keys,options){for(var parts=[],i=0;i<path.length;i++){parts.push(pathToRegexp(path[i],keys,options).source)}return new RegExp("(?:"+parts.join("|")+")",flags(options))}function stringToRegexp(path,keys,options){return tokensToRegExp(parse(path,options),keys,options)}function tokensToRegExp(tokens,keys,options){options=options||{};for(var strict=options.strict,end=!1!==options.end,delimiter=escapeString(options.delimiter||DEFAULT_DELIMITER),delimiters=options.delimiters||DEFAULT_DELIMITERS,endsWith=[].concat(options.endsWith||[]).map(escapeString).concat("$").join("|"),route="",isEndDelimited=0===tokens.length,i=0,token;i<tokens.length;i++){token=tokens[i];if("string"===typeof token){route+=escapeString(token);isEndDelimited=i===tokens.length-1&&-1<delimiters.indexOf(token[token.length-1])}else{var prefix=escapeString(token.prefix),capture=token.repeat?"(?:"+token.pattern+")(?:"+prefix+"(?:"+token.pattern+"))*":token.pattern;if(keys)keys.push(token);if(token.optional){if(token.partial){route+=prefix+"("+capture+")?"}else{route+="(?:"+prefix+"("+capture+"))?"}}else{route+=prefix+"("+capture+")"}}}if(end){if(!strict)route+="(?:"+delimiter+")?";route+="$"===endsWith?"$":"(?="+endsWith+")"}else{if(!strict)route+="(?:"+delimiter+"(?="+endsWith+"))?";if(!isEndDelimited)route+="(?="+delimiter+"|"+endsWith+")"}return new RegExp("^"+route,flags(options))}function pathToRegexp(path,keys,options){if(babelHelpers.instanceof(path,RegExp)){return regexpToRegexp(path,keys)}if(Array.isArray(path)){return arrayToRegexp(path,keys,options)}return stringToRegexp(path,keys,options)}pathToRegexp_1.parse=parse;pathToRegexp_1.compile=function(str,options){return tokensToFunction(parse(str,options))};pathToRegexp_1.tokensToFunction=tokensToFunction;pathToRegexp_1.tokensToRegExp=tokensToRegExp;var hasOwnProperty=Object.prototype.hasOwnProperty,cache=new Map;cache.set("|false",{keys:[],pattern:/(?:)/});function decodeParam(val){try{return decodeURIComponent(val)}catch(err){return val}}function matchPath(routepath,path,exact,parentKeys,parentParams){exact=!!exact;var cacheKey="".concat(routepath,"|").concat(exact),regexp=cache.get(cacheKey);if(!regexp){var keys=[];regexp={keys:keys,pattern:pathToRegexp_1(routepath,keys,{end:exact,strict:""===routepath})};cache.set(cacheKey,regexp)}var m=regexp.pattern.exec(path);if(!m){return null}for(var params=Object.assign({},parentParams),i=1;i<m.length;i++){var key=regexp.keys[i-1],prop=key.name,value=m[i];if(value!==void 0||!hasOwnProperty.call(params,prop)){if(key.repeat){params[prop]=value?value.split(key.delimiter).map(decodeParam):[]}else{params[prop]=value?decodeParam(value):value}}}return{path:m[0],keys:(parentKeys||[]).concat(regexp.keys),params:params}}function matchRoute(route,pathname,ignoreLeadingSlash,parentKeys,parentParams){var match,childMatches,childIndex=0,routepath=route.path||"";if("/"===routepath.charAt(0)){if(ignoreLeadingSlash){routepath=routepath.substr(1)}ignoreLeadingSlash=!0}return{next:function next(routeToSkip){if(route===routeToSkip){return{done:!0}}var children=route.__children=route.__children||route.children;if(!match){match=matchPath(routepath,pathname,!children,parentKeys,parentParams);if(match){return{done:!1,value:{route:route,keys:match.keys,params:match.params,path:match.path}}}}if(match&&children){while(childIndex<children.length){if(!childMatches){var childRoute=children[childIndex];childRoute.parent=route;var matchedLength=match.path.length;if(0<matchedLength&&"/"===pathname.charAt(matchedLength)){matchedLength+=1}childMatches=matchRoute(childRoute,pathname.substr(matchedLength),ignoreLeadingSlash,match.keys,match.params)}var childMatch=childMatches.next(routeToSkip);if(!childMatch.done){return{done:!1,value:childMatch.value}}childMatches=null;childIndex++}}return{done:!0}}}}function resolveRoute(context){if(isFunction(context.route.action)){return context.route.action(context)}}function isChildRoute(parentRoute,childRoute){var route=childRoute;while(route){route=route.parent;if(route===parentRoute){return!0}}return!1}function generateErrorMessage(currentContext){var errorMessage="Path '".concat(currentContext.pathname,"' is not properly resolved due to an error."),routePath=(currentContext.route||{}).path;if(routePath){errorMessage+=" Resolution had failed on route: '".concat(routePath,"'")}return errorMessage}function addRouteToChain(context,match){var route=match.route,path=match.path;function shouldDiscardOldChain(oldChain,route){return!route.parent||!oldChain||!oldChain.length||oldChain[oldChain.length-1].route!==route.parent}if(route&&!route.__synthetic){var item={path:path,route:route};if(shouldDiscardOldChain(context.chain,route)){context.chain=[item]}else{context.chain.push(item)}}}var Resolver=function(){function Resolver(routes){var options=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};babelHelpers.classCallCheck(this,Resolver);if(Object(routes)!==routes){throw new TypeError("Invalid routes")}this.baseUrl=options.baseUrl||"";this.errorHandler=options.errorHandler;this.resolveRoute=options.resolveRoute||resolveRoute;this.context=Object.assign({resolver:this},options.context);this.root=Array.isArray(routes)?{path:"",__children:routes,parent:null,__synthetic:!0}:routes;this.root.parent=null}babelHelpers.createClass(Resolver,[{key:"getRoutes",value:function getRoutes(){return babelHelpers.toConsumableArray(this.root.__children)}},{key:"setRoutes",value:function setRoutes(routes){ensureRoutes(routes);var newRoutes=babelHelpers.toConsumableArray(toArray(routes));this.root.__children=newRoutes}},{key:"addRoutes",value:function addRoutes(routes){var _this$root$__children;ensureRoutes(routes);(_this$root$__children=this.root.__children).push.apply(_this$root$__children,babelHelpers.toConsumableArray(toArray(routes)));return this.getRoutes()}},{key:"removeRoutes",value:function removeRoutes(){this.setRoutes([])}},{key:"resolve",value:function(pathnameOrContext){var _this=this,context=Object.assign({},this.context,isString(pathnameOrContext)?{pathname:pathnameOrContext}:pathnameOrContext),match=matchRoute(this.root,this.__normalizePathname(context.pathname),this.baseUrl),resolve=this.resolveRoute,matches=null,nextMatches=null,currentContext=context;function next(resume){var parent=1<arguments.length&&arguments[1]!==void 0?arguments[1]:matches.value.route,prevResult=2<arguments.length?arguments[2]:void 0,routeToSkip=null===prevResult&&matches.value.route;matches=nextMatches||match.next(routeToSkip);nextMatches=null;if(!resume){if(matches.done||!isChildRoute(parent,matches.value.route)){nextMatches=matches;return Promise.resolve(notFoundResult)}}if(matches.done){return Promise.reject(getNotFoundError(context))}addRouteToChain(context,matches.value);currentContext=Object.assign({},context,matches.value);return Promise.resolve(resolve(currentContext)).then(function(resolution){if(null!==resolution&&resolution!==void 0&&resolution!==notFoundResult){currentContext.result=resolution.result||resolution;return currentContext}return next(resume,parent,resolution)})}context.next=next;return Promise.resolve().then(function(){return next(!0,_this.root)}).catch(function(error){var errorMessage=generateErrorMessage(currentContext);if(!error){error=new Error(errorMessage)}else{console.warn(errorMessage)}error.context=error.context||currentContext;if(!babelHelpers.instanceof(error,DOMException)){error.code=error.code||500}if(_this.errorHandler){currentContext.result=_this.errorHandler(error);return currentContext}throw error})}},{key:"__normalizePathname",value:function __normalizePathname(pathname){if(!this.baseUrl){return pathname}var base=this.__effectiveBaseUrl,normalizedUrl=this.constructor.__createUrl(pathname,base).href;if(normalizedUrl.slice(0,base.length)===base){return normalizedUrl.slice(base.length)}}},{key:"__effectiveBaseUrl",get:function get(){return this.baseUrl?this.constructor.__createUrl(this.baseUrl,document.baseURI||document.URL).href.replace(/[^\/]*$/,""):""}}],[{key:"__createUrl",value:function __createUrl(url,base){return new URL(url,base)}}]);return Resolver}();_exports.Resolver=Resolver;Resolver.pathToRegexp=pathToRegexp_1;var pathToRegexp$1=Resolver.pathToRegexp,cache$1=new Map;function cacheRoutes(routesByName,route,routes){var name=route.name||route.component;if(name){if(routesByName.has(name)){routesByName.get(name).push(route)}else{routesByName.set(name,[route])}}if(Array.isArray(routes)){for(var i=0,childRoute;i<routes.length;i++){childRoute=routes[i];childRoute.parent=route;cacheRoutes(routesByName,childRoute,childRoute.__children||childRoute.children)}}}function getRouteByName(routesByName,routeName){var routes=routesByName.get(routeName);if(routes&&1<routes.length){throw new Error("Duplicate route with name \"".concat(routeName,"\".")+" Try seting unique 'name' route properties.")}return routes&&routes[0]}function getRoutePath(route){var path=route.path;path=Array.isArray(path)?path[0]:path;return path!==void 0?path:""}function generateUrls(router){var options=1<arguments.length&&arguments[1]!==void 0?arguments[1]:{};if(!babelHelpers.instanceof(router,Resolver)){throw new TypeError("An instance of Resolver is expected")}var routesByName=new Map;return function(routeName,params){var route=getRouteByName(routesByName,routeName);if(!route){routesByName.clear();cacheRoutes(routesByName,router.root,router.root.__children);route=getRouteByName(routesByName,routeName);if(!route){throw new Error("Route \"".concat(routeName,"\" not found"))}}var regexp=cache$1.get(route.fullPath);if(!regexp){var fullPath=getRoutePath(route),rt=route.parent;while(rt){var path=getRoutePath(rt);if(path){fullPath=path.replace(/\/$/,"")+"/"+fullPath.replace(/^\//,"")}rt=rt.parent}for(var tokens=pathToRegexp$1.parse(fullPath),toPath=pathToRegexp$1.tokensToFunction(tokens),keys=Object.create(null),i=0;i<tokens.length;i++){if(!isString(tokens[i])){keys[tokens[i].name]=!0}}regexp={toPath:toPath,keys:keys};cache$1.set(fullPath,regexp);route.fullPath=fullPath}var url=regexp.toPath(params,options)||"/";if(options.stringifyQueryParams&&params){for(var queryParams={},_keys=Object.keys(params),_i=0,key;_i<_keys.length;_i++){key=_keys[_i];if(!regexp.keys[key]){queryParams[key]=params[key]}}var query=options.stringifyQueryParams(queryParams);if(query){url+="?"===query.charAt(0)?query:"?".concat(query)}}return url}}var triggers=[];function setNavigationTriggers(newTriggers){triggers.forEach(function(trigger){return trigger.inactivate()});newTriggers.forEach(function(trigger){return trigger.activate()});triggers=newTriggers}var willAnimate=function(elem){var name=getComputedStyle(elem).getPropertyValue("animation-name");return name&&"none"!==name},waitForAnimation=function(elem,cb){var listener=function(){elem.removeEventListener("animationend",listener);cb()};elem.addEventListener("animationend",listener)};function animate(elem,className){elem.classList.add(className);return new Promise(function(resolve){if(willAnimate(elem)){var rect=elem.getBoundingClientRect(),size="height: ".concat(rect.bottom-rect.top,"px; width: ").concat(rect.right-rect.left,"px");elem.setAttribute("style","position: absolute; ".concat(size));waitForAnimation(elem,function(){elem.classList.remove(className);elem.removeAttribute("style");resolve()})}else{elem.classList.remove(className);resolve()}})}function isResultNotEmpty(result){return null!==result&&result!==void 0}function copyContextWithoutNext(context){var copy=Object.assign({},context);delete copy.next;return copy}function createLocation(_ref,route){var _ref$pathname=_ref.pathname,pathname=void 0===_ref$pathname?"":_ref$pathname,_ref$chain=_ref.chain,chain=void 0===_ref$chain?[]:_ref$chain,_ref$params=_ref.params,params=void 0===_ref$params?{}:_ref$params,redirectFrom=_ref.redirectFrom,resolver=_ref.resolver,routes=chain.map(function(item){return item.route});return{baseUrl:resolver&&resolver.baseUrl||"",pathname:pathname,routes:routes,route:route||routes.length&&routes[routes.length-1]||null,params:params,redirectFrom:redirectFrom,getUrl:function getUrl(){var userParams=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{};return getPathnameForRouter(Router.pathToRegexp.compile(getMatchedPath(routes))(Object.assign({},params,userParams)),resolver)}}}function createRedirect(context,pathname){var params=Object.assign({},context.params);return{redirect:{pathname:pathname,from:context.pathname,params:params}}}function renderComponent(context,component){var element=document.createElement(component);element.location=createLocation(context);var index=context.chain.map(function(item){return item.route}).indexOf(context.route);context.chain[index].element=element;return element}function runCallbackIfPossible(callback,args,thisArg){if(isFunction(callback)){return callback.apply(thisArg,args)}}function amend(amendmentFunction,args,element){return function(amendmentResult){if(amendmentResult&&(amendmentResult.cancel||amendmentResult.redirect)){return amendmentResult}if(element){return runCallbackIfPossible(element[amendmentFunction],args,element)}}}function processNewChildren(newChildren,route){if(!Array.isArray(newChildren)&&!isObject(newChildren)){throw new Error(log("Incorrect \"children\" value for the route ".concat(route.path,": expected array or object, but got ").concat(newChildren)))}route.__children=[];for(var childRoutes=toArray(newChildren),i=0;i<childRoutes.length;i++){ensureRoute(childRoutes[i]);route.__children.push(childRoutes[i])}}function removeDomNodes(nodes){if(nodes&&nodes.length){for(var parent=nodes[0].parentNode,i=0;i<nodes.length;i++){parent.removeChild(nodes[i])}}}function getPathnameForRouter(pathname,router){var base=router.__effectiveBaseUrl;return base?router.constructor.__createUrl(pathname.replace(/^\//,""),base).pathname:pathname}function getMatchedPath(chain){return chain.map(function(item){return item.path}).reduce(function(a,b){if(b.length){return a.replace(/\/$/,"")+"/"+b.replace(/^\//,"")}return a},"")}var Router=function(_Resolver){babelHelpers.inherits(Router,_Resolver);function Router(outlet,options){var _this2;babelHelpers.classCallCheck(this,Router);var baseElement=document.head.querySelector("base");_this2=babelHelpers.possibleConstructorReturn(this,babelHelpers.getPrototypeOf(Router).call(this,[],Object.assign({baseUrl:baseElement&&baseElement.getAttribute("href")},options)));_this2.resolveRoute=function(context){return _this2.__resolveRoute(context)};var triggers=Router.NavigationTrigger;Router.setTriggers.apply(Router,Object.keys(triggers).map(function(key){return triggers[key]}));_this2.baseUrl;_this2.ready;_this2.ready=Promise.resolve(outlet);_this2.location;_this2.location=createLocation({resolver:babelHelpers.assertThisInitialized(babelHelpers.assertThisInitialized(_this2))});_this2.__lastStartedRenderId=0;_this2.__navigationEventHandler=_this2.__onNavigationEvent.bind(babelHelpers.assertThisInitialized(babelHelpers.assertThisInitialized(_this2)));_this2.setOutlet(outlet);_this2.subscribe();return _this2}babelHelpers.createClass(Router,[{key:"__resolveRoute",value:function __resolveRoute(context){var route=context.route,callbacks=Promise.resolve();if(isFunction(route.children)){callbacks=callbacks.then(function(){return route.children(copyContextWithoutNext(context))}).then(function(children){if(!isResultNotEmpty(children)&&!isFunction(route.children)){children=route.children}processNewChildren(children,route)})}var commands={redirect:function redirect(path){return createRedirect(context,path)},component:function component(_component){return renderComponent(context,_component)}};return callbacks.then(function(){return runCallbackIfPossible(route.action,[context,commands],route)}).then(function(result){if(isResultNotEmpty(result)){if(babelHelpers.instanceof(result,HTMLElement)||result.redirect||result===notFoundResult){return result}}if(isString(route.redirect)){return commands.redirect(route.redirect)}if(route.bundle){return loadBundle(route.bundle).then(function(){},function(){throw new Error(log("Bundle not found: ".concat(route.bundle,". Check if the file name is correct")))})}}).then(function(result){if(isResultNotEmpty(result)){return result}if(isString(route.component)){return commands.component(route.component)}})}},{key:"setOutlet",value:function setOutlet(outlet){if(outlet){this.__ensureOutlet(outlet)}this.__outlet=outlet}},{key:"getOutlet",value:function getOutlet(){return this.__outlet}},{key:"setRoutes",value:function setRoutes(routes){this.__urlForName=void 0;babelHelpers.get(babelHelpers.getPrototypeOf(Router.prototype),"setRoutes",this).call(this,routes);this.__onNavigationEvent()}},{key:"render",value:function render(pathnameOrContext,shouldUpdateHistory){var _this3=this,renderId=++this.__lastStartedRenderId,pathname=pathnameOrContext.pathname||pathnameOrContext;this.ready=this.resolve(pathnameOrContext).then(function(context){return _this3.__fullyResolveChain(context)}).then(function(context){if(renderId===_this3.__lastStartedRenderId){var previousContext=_this3.__previousContext;if(context===previousContext){return _this3.location}_this3.location=createLocation(context);fireRouterEvent("location-changed",{router:_this3,location:_this3.location});if(shouldUpdateHistory){_this3.__updateBrowserHistory(context.pathname,context.redirectFrom)}_this3.__addAppearingContent(context,previousContext);var animationDone=_this3.__animateIfNeeded(context);_this3.__runOnAfterEnterCallbacks(context);_this3.__runOnAfterLeaveCallbacks(context,previousContext);return animationDone.then(function(){if(renderId===_this3.__lastStartedRenderId){_this3.__removeDisappearingContent();_this3.__previousContext=context;return _this3.location}})}}).catch(function(error){if(renderId===_this3.__lastStartedRenderId){if(shouldUpdateHistory){_this3.__updateBrowserHistory(pathname)}removeDomNodes(_this3.__outlet&&_this3.__outlet.children);_this3.location=createLocation({pathname:pathname,resolver:_this3});fireRouterEvent("error",{router:_this3,error:error,pathname:pathname});throw error}});return this.ready}},{key:"__fullyResolveChain",value:function __fullyResolveChain(originalContext){var _this4=this,currentContext=1<arguments.length&&arguments[1]!==void 0?arguments[1]:originalContext;return this.__amendWithResolutionResult(currentContext).then(function(amendedContext){var initialContext=amendedContext!==currentContext?amendedContext:originalContext;return amendedContext.next().then(function(nextContext){if(null===nextContext||nextContext===notFoundResult){var matchedPath=getPathnameForRouter(getMatchedPath(amendedContext.chain),amendedContext.resolver);if(matchedPath!==amendedContext.pathname){throw getNotFoundError(initialContext)}}return nextContext&&nextContext!==notFoundResult?_this4.__fullyResolveChain(initialContext,nextContext):_this4.__amendWithOnBeforeCallbacks(initialContext)})})}},{key:"__amendWithResolutionResult",value:function __amendWithResolutionResult(context){var _this5=this,result=context.result;if(babelHelpers.instanceof(result,HTMLElement)){return Promise.resolve(context)}else if(result.redirect){return this.__redirect(result.redirect,context.__redirectCount).then(function(context){return _this5.__amendWithResolutionResult(context)})}else if(babelHelpers.instanceof(result,Error)){return Promise.reject(result)}else{return Promise.reject(new Error(log("Invalid route resolution result for path \"".concat(context.pathname,"\". ")+"Expected redirect object or HTML element, but got: \"".concat(logValue(result),"\". ")+"Double check the action return value for the route.")))}}},{key:"__amendWithOnBeforeCallbacks",value:function __amendWithOnBeforeCallbacks(contextWithFullChain){var _this6=this;return this.__runOnBeforeCallbacks(contextWithFullChain).then(function(amendedContext){if(amendedContext===_this6.__previousContext||amendedContext===contextWithFullChain){return amendedContext}return _this6.__fullyResolveChain(amendedContext)})}},{key:"__runOnBeforeCallbacks",value:function __runOnBeforeCallbacks(newContext){var _this7=this,previousContext=this.__previousContext||{},previousChain=previousContext.chain||[],newChain=newContext.chain,callbacks=Promise.resolve(),prevent=function(){return{cancel:!0}},redirect=function(pathname){return createRedirect(newContext,pathname)};newContext.__divergedChainIndex=0;if(previousChain.length){for(var i=0;i<Math.min(previousChain.length,newChain.length);i=++newContext.__divergedChainIndex){if(previousChain[i].route!==newChain[i].route||previousChain[i].path!==newChain[i].path||(previousChain[i].element&&previousChain[i].element.localName)!==(newChain[i].element&&newChain[i].element.localName)){break}}for(var _i2=previousChain.length-1,location;_i2>=newContext.__divergedChainIndex;_i2--){location=createLocation(newContext);callbacks=callbacks.then(amend("onBeforeLeave",[location,{prevent:prevent},this],previousChain[_i2].element)).then(function(result){if(!(result||{}).redirect){return result}})}}for(var _i3=newContext.__divergedChainIndex,_location;_i3<newChain.length;_i3++){_location=createLocation(newContext,newChain[_i3].route);callbacks=callbacks.then(amend("onBeforeEnter",[_location,{prevent:prevent,redirect:redirect},this],newChain[_i3].element))}return callbacks.then(function(amendmentResult){if(amendmentResult){if(amendmentResult.cancel){return _this7.__previousContext}if(amendmentResult.redirect){return _this7.__redirect(amendmentResult.redirect,newContext.__redirectCount)}}return newContext})}},{key:"__redirect",value:function __redirect(redirectData,counter){if(counter>256){throw new Error(log("Too many redirects when rendering ".concat(redirectData.from)))}return this.resolve({pathname:this.urlForPath(redirectData.pathname,redirectData.params),redirectFrom:redirectData.from,__redirectCount:(counter||0)+1})}},{key:"__ensureOutlet",value:function __ensureOutlet(){var outlet=0<arguments.length&&arguments[0]!==void 0?arguments[0]:this.__outlet;if(!babelHelpers.instanceof(outlet,Node)){throw new TypeError(log("Expected router outlet to be a valid DOM Node (but got ".concat(outlet,")")))}}},{key:"__updateBrowserHistory",value:function __updateBrowserHistory(pathname,replace){if(window.location.pathname!==pathname){var changeState=replace?"replaceState":"pushState";window.history[changeState](null,document.title,pathname);window.dispatchEvent(new PopStateEvent("popstate",{state:"vaadin-router-ignore"}))}}},{key:"__addAppearingContent",value:function __addAppearingContent(context,previousContext){this.__ensureOutlet();this.__removeAppearingContent();for(var deepestCommonParent=this.__outlet,i=0,unchangedElement;i<context.__divergedChainIndex;i++){unchangedElement=previousContext&&previousContext.chain[i].element;if(unchangedElement){if(unchangedElement.parentNode===deepestCommonParent){context.chain[i].element=unchangedElement;deepestCommonParent=unchangedElement}else{break}}}this.__disappearingContent=Array.from(deepestCommonParent.children);this.__appearingContent=[];for(var parentElement=deepestCommonParent,_i4=context.__divergedChainIndex,elementToAdd;_i4<context.chain.length;_i4++){elementToAdd=context.chain[_i4].element;if(elementToAdd){parentElement.appendChild(elementToAdd);if(parentElement===deepestCommonParent){this.__appearingContent.push(elementToAdd)}parentElement=elementToAdd}}}},{key:"__removeDisappearingContent",value:function __removeDisappearingContent(){if(this.__disappearingContent){removeDomNodes(this.__disappearingContent)}this.__disappearingContent=null;this.__appearingContent=null}},{key:"__removeAppearingContent",value:function __removeAppearingContent(){if(this.__disappearingContent&&this.__appearingContent){removeDomNodes(this.__appearingContent);this.__disappearingContent=null;this.__appearingContent=null}}},{key:"__runOnAfterLeaveCallbacks",value:function __runOnAfterLeaveCallbacks(currentContext,targetContext){if(!targetContext){return}for(var i=targetContext.chain.length-1,currentComponent;i>=currentContext.__divergedChainIndex;i--){currentComponent=targetContext.chain[i].element;if(!currentComponent){continue}try{var location=createLocation(currentContext);runCallbackIfPossible(currentComponent.onAfterLeave,[location,{},targetContext.resolver],currentComponent)}finally{removeDomNodes(currentComponent.children)}}}},{key:"__runOnAfterEnterCallbacks",value:function __runOnAfterEnterCallbacks(currentContext){for(var i=currentContext.__divergedChainIndex;i<currentContext.chain.length;i++){var currentComponent=currentContext.chain[i].element||{},location=createLocation(currentContext,currentContext.chain[i].route);runCallbackIfPossible(currentComponent.onAfterEnter,[location,{},currentContext.resolver],currentComponent)}}},{key:"__animateIfNeeded",value:function __animateIfNeeded(context){for(var from=(this.__disappearingContent||[])[0],to=(this.__appearingContent||[])[0],promises=[],chain=context.chain,config,i=chain.length;0<i;i--){if(chain[i-1].route.animate){config=chain[i-1].route.animate;break}}if(from&&to&&config){var leave=isObject(config)&&config.leave||"leaving",enter=isObject(config)&&config.enter||"entering";promises.push(animate(from,leave));promises.push(animate(to,enter))}return Promise.all(promises).then(function(){return context})}},{key:"subscribe",value:function subscribe(){window.addEventListener("vaadin-router-go",this.__navigationEventHandler)}},{key:"unsubscribe",value:function unsubscribe(){window.removeEventListener("vaadin-router-go",this.__navigationEventHandler)}},{key:"__onNavigationEvent",value:function __onNavigationEvent(event){var pathname=event?event.detail.pathname:window.location.pathname;if(isString(this.__normalizePathname(pathname))){if(event&&event.preventDefault){event.preventDefault()}this.render(pathname,!0)}}},{key:"urlForName",value:function urlForName(name,params){if(!this.__urlForName){this.__urlForName=generateUrls(this)}return getPathnameForRouter(this.__urlForName(name,params),this)}},{key:"urlForPath",value:function urlForPath(path,params){return getPathnameForRouter(Router.pathToRegexp.compile(path)(params),this)}}],[{key:"setTriggers",value:function setTriggers(){for(var _len=arguments.length,triggers=Array(_len),_key=0;_key<_len;_key++){triggers[_key]=arguments[_key]}setNavigationTriggers(triggers)}},{key:"go",value:function go(pathname){return fireRouterEvent("go",{pathname:pathname})}}]);return Router}(Resolver);_exports.Router=Router;var DEV_MODE_CODE_REGEXP=/\/\*\*\s+vaadin-dev-mode:start([\s\S]*)vaadin-dev-mode:end\s+\*\*\//i;function isMinified(){return uncommentAndRun(function(){return!0})}function isDevelopmentMode(){try{return isForcedDevelopmentMode()||isLocalhost()&&!isMinified()&&!isFlowProductionMode()}catch(e){return!1}}function isForcedDevelopmentMode(){return localStorage.getItem("vaadin.developmentmode.force")}function isLocalhost(){return 0<=["localhost","127.0.0.1"].indexOf(window.location.hostname)}function isFlowProductionMode(){if(window.Vaadin&&window.Vaadin.Flow&&window.Vaadin.Flow.clients){var productionModeApps=Object.keys(window.Vaadin.Flow.clients).map(function(key){return window.Vaadin.Flow.clients[key]}).filter(function(client){return client.productionMode});if(0<productionModeApps.length){return!0}}return!1}function uncommentAndRun(callback,args){if("function"!==typeof callback){return}var match=DEV_MODE_CODE_REGEXP.exec(callback.toString());if(match){try{callback=new Function(match[1])}catch(e){console.log("vaadin-development-mode-detector: uncommentAndRun() failed",e)}}return callback(args)}window.Vaadin=window.Vaadin||{};var runIfDevelopmentMode=function(callback,args){if(window.Vaadin.developmentMode){return uncommentAndRun(callback,args)}};if(window.Vaadin.developmentMode===void 0){window.Vaadin.developmentMode=isDevelopmentMode()}function maybeGatherAndSendStats(){}window.Vaadin=window.Vaadin||{};window.Vaadin.registrations=window.Vaadin.registrations||[];window.Vaadin.registrations.push({is:"@vaadin/router",version:"1.2.0"});(function usageStatistics(){if("function"===typeof runIfDevelopmentMode){return runIfDevelopmentMode(maybeGatherAndSendStats)}})();Router.NavigationTrigger={POPSTATE:{activate:function activate(){window.addEventListener("popstate",vaadinRouterGlobalPopstateHandler)},inactivate:function inactivate(){window.removeEventListener("popstate",vaadinRouterGlobalPopstateHandler)}},CLICK:{activate:function activate(){window.document.addEventListener("click",vaadinRouterGlobalClickHandler)},inactivate:function inactivate(){window.document.removeEventListener("click",vaadinRouterGlobalClickHandler)}}}});