define(["../src/apply-shim.js","../src/template-map.js","../src/style-util.js","../src/apply-shim-utils.js","../src/common-utils.js","../src/custom-style-interface.js","../src/style-settings.js"],function(_applyShim,_templateMap,_styleUtil,ApplyShimUtils,_commonUtils,_customStyleInterface,_styleSettings){"use strict";_applyShim=babelHelpers.interopRequireDefault(_applyShim);_templateMap=babelHelpers.interopRequireDefault(_templateMap);ApplyShimUtils=babelHelpers.interopRequireWildcard(ApplyShimUtils);var applyShim=new _applyShim.default,ApplyShimInterface=function(){function ApplyShimInterface(){babelHelpers.classCallCheck(this,ApplyShimInterface);this.customStyleInterface=null;applyShim.invalidCallback=ApplyShimUtils.invalidate}babelHelpers.createClass(ApplyShimInterface,[{key:"ensure",value:function ensure(){var _this=this;if(this.customStyleInterface){return}if(window.ShadyCSS.CustomStyleInterface){this.customStyleInterface=window.ShadyCSS.CustomStyleInterface;this.customStyleInterface.transformCallback=function(style){applyShim.transformCustomStyle(style)};this.customStyleInterface.validateCallback=function(){requestAnimationFrame(function(){if(_this.customStyleInterface.enqueued){_this.flushCustomStyles()}})}}}},{key:"prepareTemplate",value:function prepareTemplate(template,elementName){this.ensure();if((0,_styleUtil.elementHasBuiltCss)(template)){return}_templateMap.default[elementName]=template;var ast=applyShim.transformTemplate(template,elementName);template._styleAst=ast}},{key:"flushCustomStyles",value:function flushCustomStyles(){this.ensure();if(!this.customStyleInterface){return}var styles=this.customStyleInterface.processStyles();if(!this.customStyleInterface.enqueued){return}for(var i=0;i<styles.length;i++){var cs=styles[i],style=this.customStyleInterface.getStyleForCustomStyle(cs);if(style){applyShim.transformCustomStyle(style)}}this.customStyleInterface.enqueued=!1}},{key:"styleSubtree",value:function styleSubtree(element,properties){this.ensure();if(properties){(0,_commonUtils.updateNativeProperties)(element,properties)}if(element.shadowRoot){this.styleElement(element);for(var shadowChildren=element.shadowRoot.children||element.shadowRoot.childNodes,i=0;i<shadowChildren.length;i++){this.styleSubtree(shadowChildren[i])}}else{for(var children=element.children||element.childNodes,_i=0;_i<children.length;_i++){this.styleSubtree(children[_i])}}}},{key:"styleElement",value:function styleElement(element){this.ensure();var _getIsExtends=(0,_styleUtil.getIsExtends)(element),is=_getIsExtends.is,template=_templateMap.default[is];if(template&&(0,_styleUtil.elementHasBuiltCss)(template)){return}if(template&&!ApplyShimUtils.templateIsValid(template)){if(!ApplyShimUtils.templateIsValidating(template)){this.prepareTemplate(template,is);ApplyShimUtils.startValidatingTemplate(template)}var root=element.shadowRoot;if(root){var style=root.querySelector("style");if(style){style.__cssRules=template._styleAst;style.textContent=(0,_styleUtil.toCssText)(template._styleAst)}}}}},{key:"styleDocument",value:function styleDocument(properties){this.ensure();this.styleSubtree(document.body,properties)}}]);return ApplyShimInterface}();if(!window.ShadyCSS||!window.ShadyCSS.ScopingShim){var applyShimInterface=new ApplyShimInterface,CustomStyleInterface=window.ShadyCSS&&window.ShadyCSS.CustomStyleInterface;window.ShadyCSS={prepareTemplate:function prepareTemplate(template,elementName){applyShimInterface.flushCustomStyles();applyShimInterface.prepareTemplate(template,elementName)},prepareTemplateStyles:function prepareTemplateStyles(template,elementName,elementExtends){window.ShadyCSS.prepareTemplate(template,elementName,elementExtends)},prepareTemplateDom:function prepareTemplateDom(){},styleSubtree:function styleSubtree(element,properties){applyShimInterface.flushCustomStyles();applyShimInterface.styleSubtree(element,properties)},styleElement:function styleElement(element){applyShimInterface.flushCustomStyles();applyShimInterface.styleElement(element)},styleDocument:function styleDocument(properties){applyShimInterface.flushCustomStyles();applyShimInterface.styleDocument(properties)},getComputedStyleValue:function getComputedStyleValue(element,property){return(0,_commonUtils.getComputedStyleValue)(element,property)},flushCustomStyles:function flushCustomStyles(){applyShimInterface.flushCustomStyles()},nativeCss:_styleSettings.nativeCssVariables,nativeShadow:_styleSettings.nativeShadow,cssBuild:_styleSettings.cssBuild};if(CustomStyleInterface){window.ShadyCSS.CustomStyleInterface=CustomStyleInterface}}window.ShadyCSS.ApplyShim=applyShim});