define(["exports","../Observable.js","../util/identity.js","../util/isScheduler.js"],function(_exports,_Observable,_identity,_isScheduler){"use strict";Object.defineProperty(_exports,"__esModule",{value:!0});_exports.generate=function(initialStateOrOptions,condition,iterate,resultSelectorOrObservable,scheduler){var resultSelector,initialState;if(1==arguments.length){var options=initialStateOrOptions;initialState=options.initialState;condition=options.condition;iterate=options.iterate;resultSelector=options.resultSelector||_identity.identity;scheduler=options.scheduler}else if(resultSelectorOrObservable===void 0||(0,_isScheduler.isScheduler)(resultSelectorOrObservable)){initialState=initialStateOrOptions;resultSelector=_identity.identity;scheduler=resultSelectorOrObservable}else{initialState=initialStateOrOptions;resultSelector=resultSelectorOrObservable}return new _Observable.Observable(function(subscriber){var state=initialState;if(scheduler){return scheduler.schedule(dispatch,0,{subscriber:subscriber,iterate:iterate,condition:condition,resultSelector:resultSelector,state:state})}do{if(condition){var conditionResult=void 0;try{conditionResult=condition(state)}catch(err){subscriber.error(err);return}if(!conditionResult){subscriber.complete();break}}var value=void 0;try{value=resultSelector(state)}catch(err){subscriber.error(err);return}subscriber.next(value);if(subscriber.closed){break}try{state=iterate(state)}catch(err){subscriber.error(err);return}}while(!0)})};function dispatch(state){var subscriber=state.subscriber,condition=state.condition;if(subscriber.closed){return}if(state.needIterate){try{state.state=state.iterate(state.state)}catch(err){subscriber.error(err);return}}else{state.needIterate=!0}if(condition){var conditionResult;try{conditionResult=condition(state.state)}catch(err){subscriber.error(err);return}if(!conditionResult){subscriber.complete();return}if(subscriber.closed){return}}var value;try{value=state.resultSelector(state.state)}catch(err){subscriber.error(err);return}if(subscriber.closed){return}subscriber.next(value);if(subscriber.closed){return}return this.schedule(state)}});