(function(f){if("object"===("undefined"===typeof exports?"undefined":babelHelpers.typeof(exports))&&"undefined"!==typeof module){module.exports=f()}else if("function"===typeof define&&define.amd){define([],f)}else{var g;if("undefined"!==typeof window){g=window}else if("undefined"!==typeof global){g=global}else if("undefined"!==typeof self){g=self}else{g=this}g.AFRAME=f()}})(function(){var _NumberMAX_VALUE=Number.MAX_VALUE,_Mathtan=Math.tan,_Mathatan2=Math.atan,_Mathacos=Math.acos,_Mathround=Math.round,_Mathsign=Math.sign,_Mathmax=Math.max,_MathLN=Math.LN2,_Mathlog=Math.log,_Mathabs=Math.abs,_StringfromCharCode=String.fromCharCode,_Mathmin=Math.min,_Mathfloor=Math.floor,_Mathsqrt=Math.sqrt,_Mathpow=Math.pow,_Mathsin=Math.sin,_Mathcos=Math.cos,_MathPI=Math.PI,define;return function(){function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++){s(r[o])}return s}return e}()({1:[function(_dereq_,module,exports){(function(process){var _Group=function(){this._tweens={};this._tweensAddedDuringUpdate={}};_Group.prototype={getAll:function getAll(){return Object.keys(this._tweens).map(function(tweenId){return this._tweens[tweenId]}.bind(this))},removeAll:function removeAll(){this._tweens={}},add:function add(tween){this._tweens[tween.getId()]=tween;this._tweensAddedDuringUpdate[tween.getId()]=tween},remove:function remove(tween){delete this._tweens[tween.getId()];delete this._tweensAddedDuringUpdate[tween.getId()]},update:function update(time,preserve){var tweenIds=Object.keys(this._tweens);if(0===tweenIds.length){return!1}time=time!==void 0?time:TWEEN.now();while(0<tweenIds.length){this._tweensAddedDuringUpdate={};for(var i=0;i<tweenIds.length;i++){if(!1===this._tweens[tweenIds[i]].update(time)){this._tweens[tweenIds[i]]._isPlaying=!1;if(!preserve){delete this._tweens[tweenIds[i]]}}}tweenIds=Object.keys(this._tweensAddedDuringUpdate)}return!0}};var TWEEN=new _Group;TWEEN.Group=_Group;TWEEN._nextId=0;TWEEN.nextId=function(){return TWEEN._nextId++};if("undefined"===typeof window&&"undefined"!==typeof process){TWEEN.now=function(){var time=process.hrtime();return 1e3*time[0]+time[1]/1e6}}else if("undefined"!==typeof window&&window.performance!==void 0&&window.performance.now!==void 0){TWEEN.now=window.performance.now.bind(window.performance)}else if(Date.now!==void 0){TWEEN.now=Date.now}else{TWEEN.now=function(){return new Date().getTime()}}TWEEN.Tween=function(object,group){this._object=object;this._valuesStart={};this._valuesEnd={};this._valuesStartRepeat={};this._duration=1e3;this._repeat=0;this._repeatDelayTime=void 0;this._yoyo=!1;this._isPlaying=!1;this._reversed=!1;this._delayTime=0;this._startTime=null;this._easingFunction=TWEEN.Easing.Linear.None;this._interpolationFunction=TWEEN.Interpolation.Linear;this._chainedTweens=[];this._onStartCallback=null;this._onStartCallbackFired=!1;this._onUpdateCallback=null;this._onCompleteCallback=null;this._onStopCallback=null;this._group=group||TWEEN;this._id=TWEEN.nextId()};TWEEN.Tween.prototype={getId:function(){return this._id},isPlaying:function(){return this._isPlaying},to:function(properties,duration){this._valuesEnd=properties;if(duration!==void 0){this._duration=duration}return this},start:function(time){this._group.add(this);this._isPlaying=!0;this._onStartCallbackFired=!1;this._startTime=time!==void 0?time:TWEEN.now();this._startTime+=this._delayTime;for(var property in this._valuesEnd){if(babelHelpers.instanceof(this._valuesEnd[property],Array)){if(0===this._valuesEnd[property].length){continue}this._valuesEnd[property]=[this._object[property]].concat(this._valuesEnd[property])}if(this._object[property]===void 0){continue}this._valuesStart[property]=this._object[property];if(!1===babelHelpers.instanceof(this._valuesStart[property],Array)){this._valuesStart[property]*=1}this._valuesStartRepeat[property]=this._valuesStart[property]||0}return this},stop:function(){if(!this._isPlaying){return this}this._group.remove(this);this._isPlaying=!1;if(null!==this._onStopCallback){this._onStopCallback.call(this._object,this._object)}this.stopChainedTweens();return this},end:function(){this.update(this._startTime+this._duration);return this},stopChainedTweens:function(){for(var i=0,numChainedTweens=this._chainedTweens.length;i<numChainedTweens;i++){this._chainedTweens[i].stop()}},delay:function(amount){this._delayTime=amount;return this},repeat:function(times){this._repeat=times;return this},repeatDelay:function(amount){this._repeatDelayTime=amount;return this},yoyo:function yoyo(yoyo){this._yoyo=yoyo;return this},easing:function easing(easing){this._easingFunction=easing;return this},interpolation:function interpolation(interpolation){this._interpolationFunction=interpolation;return this},chain:function(){this._chainedTweens=arguments;return this},onStart:function(callback){this._onStartCallback=callback;return this},onUpdate:function(callback){this._onUpdateCallback=callback;return this},onComplete:function(callback){this._onCompleteCallback=callback;return this},onStop:function(callback){this._onStopCallback=callback;return this},update:function(time){var property,elapsed,value;if(time<this._startTime){return!0}if(!1===this._onStartCallbackFired){if(null!==this._onStartCallback){this._onStartCallback.call(this._object,this._object)}this._onStartCallbackFired=!0}elapsed=(time-this._startTime)/this._duration;elapsed=1<elapsed?1:elapsed;value=this._easingFunction(elapsed);for(property in this._valuesEnd){if(this._valuesStart[property]===void 0){continue}var start=this._valuesStart[property]||0,end=this._valuesEnd[property];if(babelHelpers.instanceof(end,Array)){this._object[property]=this._interpolationFunction(end,value)}else{if("string"===typeof end){if("+"===end.charAt(0)||"-"===end.charAt(0)){end=start+parseFloat(end)}else{end=parseFloat(end)}}if("number"===typeof end){this._object[property]=start+(end-start)*value}}}if(null!==this._onUpdateCallback){this._onUpdateCallback.call(this._object,value)}if(1===elapsed){if(0<this._repeat){if(isFinite(this._repeat)){this._repeat--}for(property in this._valuesStartRepeat){if("string"===typeof this._valuesEnd[property]){this._valuesStartRepeat[property]=this._valuesStartRepeat[property]+parseFloat(this._valuesEnd[property])}if(this._yoyo){var tmp=this._valuesStartRepeat[property];this._valuesStartRepeat[property]=this._valuesEnd[property];this._valuesEnd[property]=tmp}this._valuesStart[property]=this._valuesStartRepeat[property]}if(this._yoyo){this._reversed=!this._reversed}if(this._repeatDelayTime!==void 0){this._startTime=time+this._repeatDelayTime}else{this._startTime=time+this._delayTime}return!0}else{if(null!==this._onCompleteCallback){this._onCompleteCallback.call(this._object,this._object)}for(var i=0,numChainedTweens=this._chainedTweens.length;i<numChainedTweens;i++){this._chainedTweens[i].start(this._startTime+this._duration)}return!1}}return!0}};TWEEN.Easing={Linear:{None:function None(k){return k}},Quadratic:{In:function In(k){return k*k},Out:function Out(k){return k*(2-k)},InOut:function InOut(k){if(1>(k*=2)){return .5*k*k}return-.5*(--k*(k-2)-1)}},Cubic:{In:function In(k){return k*k*k},Out:function Out(k){return--k*k*k+1},InOut:function InOut(k){if(1>(k*=2)){return .5*k*k*k}return .5*((k-=2)*k*k+2)}},Quartic:{In:function In(k){return k*k*k*k},Out:function Out(k){return 1- --k*k*k*k},InOut:function InOut(k){if(1>(k*=2)){return .5*k*k*k*k}return-.5*((k-=2)*k*k*k-2)}},Quintic:{In:function In(k){return k*k*k*k*k},Out:function Out(k){return--k*k*k*k*k+1},InOut:function InOut(k){if(1>(k*=2)){return .5*k*k*k*k*k}return .5*((k-=2)*k*k*k*k+2)}},Sinusoidal:{In:function In(k){return 1-_Mathcos(k*_MathPI/2)},Out:function Out(k){return _Mathsin(k*_MathPI/2)},InOut:function InOut(k){return .5*(1-_Mathcos(_MathPI*k))}},Exponential:{In:function In(k){return 0===k?0:_Mathpow(1024,k-1)},Out:function Out(k){return 1===k?1:1-_Mathpow(2,-10*k)},InOut:function InOut(k){if(0===k){return 0}if(1===k){return 1}if(1>(k*=2)){return .5*_Mathpow(1024,k-1)}return .5*(-_Mathpow(2,-10*(k-1))+2)}},Circular:{In:function In(k){return 1-_Mathsqrt(1-k*k)},Out:function Out(k){return _Mathsqrt(1- --k*k)},InOut:function InOut(k){if(1>(k*=2)){return-.5*(_Mathsqrt(1-k*k)-1)}return .5*(_Mathsqrt(1-(k-=2)*k)+1)}},Elastic:{In:function In(k){if(0===k){return 0}if(1===k){return 1}return-_Mathpow(2,10*(k-1))*_Mathsin(5*(k-1.1)*_MathPI)},Out:function Out(k){if(0===k){return 0}if(1===k){return 1}return _Mathpow(2,-10*k)*_Mathsin(5*(k-.1)*_MathPI)+1},InOut:function InOut(k){if(0===k){return 0}if(1===k){return 1}k*=2;if(1>k){return-.5*_Mathpow(2,10*(k-1))*_Mathsin(5*(k-1.1)*_MathPI)}return .5*_Mathpow(2,-10*(k-1))*_Mathsin(5*(k-1.1)*_MathPI)+1}},Back:{In:function In(k){var s=1.70158;return k*k*((s+1)*k-s)},Out:function Out(k){var s=1.70158;return--k*k*((s+1)*k+s)+1},InOut:function InOut(k){var s=1.525*1.70158;if(1>(k*=2)){return .5*(k*k*((s+1)*k-s))}return .5*((k-=2)*k*((s+1)*k+s)+2)}},Bounce:{In:function In(k){return 1-TWEEN.Easing.Bounce.Out(1-k)},Out:function Out(k){if(k<1/2.75){return 7.5625*k*k}else if(k<2/2.75){return 7.5625*(k-=1.5/2.75)*k+.75}else if(k<2.5/2.75){return 7.5625*(k-=2.25/2.75)*k+.9375}else{return 7.5625*(k-=2.625/2.75)*k+.984375}},InOut:function InOut(k){if(.5>k){return .5*TWEEN.Easing.Bounce.In(2*k)}return .5*TWEEN.Easing.Bounce.Out(2*k-1)+.5}}};TWEEN.Interpolation={Linear:function Linear(v,k){var m=v.length-1,f=m*k,i=_Mathfloor(f),fn=TWEEN.Interpolation.Utils.Linear;if(0>k){return fn(v[0],v[1],f)}if(1<k){return fn(v[m],v[m-1],m-f)}return fn(v[i],v[i+1>m?m:i+1],f-i)},Bezier:function Bezier(v,k){for(var b=0,n=v.length-1,pw=_Mathpow,bn=TWEEN.Interpolation.Utils.Bernstein,i=0;i<=n;i++){b+=pw(1-k,n-i)*pw(k,i)*v[i]*bn(n,i)}return b},CatmullRom:function CatmullRom(v,k){var m=v.length-1,f=m*k,i=_Mathfloor(f),fn=TWEEN.Interpolation.Utils.CatmullRom;if(v[0]===v[m]){if(0>k){i=_Mathfloor(f=m*(1+k))}return fn(v[(i-1+m)%m],v[i],v[(i+1)%m],v[(i+2)%m],f-i)}else{if(0>k){return v[0]-(fn(v[0],v[0],v[1],v[1],-f)-v[0])}if(1<k){return v[m]-(fn(v[m],v[m],v[m-1],v[m-1],f-m)-v[m])}return fn(v[i?i-1:0],v[i],v[m<i+1?m:i+1],v[m<i+2?m:i+2],f-i)}},Utils:{Linear:function Linear(p0,p1,t){return(p1-p0)*t+p0},Bernstein:function Bernstein(n,i){var fc=TWEEN.Interpolation.Utils.Factorial;return fc(n)/fc(i)/fc(n-i)},Factorial:function(){var a=[1];return function(n){var s=1;if(a[n]){return a[n]}for(var i=n;1<i;i--){s*=i}a[n]=s;return s}}(),CatmullRom:function CatmullRom(p0,p1,p2,p3,t){var v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t;return(2*p1-2*p2+v0+v1)*(t*t2)+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}}};(function(root){if("function"===typeof define&&define.amd){define([],function(){return TWEEN})}else if("undefined"!==typeof module&&"object"===babelHelpers.typeof(exports)){module.exports=TWEEN}else if(root!==void 0){root.TWEEN=TWEEN}})(this)}).call(this,_dereq_("_process"))},{_process:32}],2:[function(_dereq_,module){var str=Object.prototype.toString;module.exports=function(arr){return arr.BYTES_PER_ELEMENT&&"[object ArrayBuffer]"===str.call(arr.buffer)||Array.isArray(arr)}},{}],3:[function(_dereq_,module){module.exports=function(num,def){return"number"===typeof num?num:"number"===typeof def?def:0}},{}],4:[function(_dereq_,module,exports){"use strict";exports.byteLength=function(b64){return 3*b64.length/4-placeHoldersCount(b64)};exports.toByteArray=toByteArray;exports.fromByteArray=fromByteArray;for(var lookup=[],revLookup=[],Arr="undefined"!==typeof Uint8Array?Uint8Array:Array,code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,len=code.length;i<len;++i){lookup[i]=code[i];revLookup[code.charCodeAt(i)]=i}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len=b64.length;if(0<len%4){throw new Error("Invalid string. Length must be a multiple of 4")}return"="===b64[len-2]?2:"="===b64[len-1]?1:0}function toByteArray(b64){var i,l,tmp,placeHolders,arr,len=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(3*len/4-placeHolders);l=0<placeHolders?len-4:len;var L=0;for(i=0;i<l;i+=4){tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)];arr[L++]=255&tmp>>16;arr[L++]=255&tmp>>8;arr[L++]=255&tmp}if(2===placeHolders){tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4;arr[L++]=255&tmp}else if(1===placeHolders){tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2;arr[L++]=255&tmp>>8;arr[L++]=255&tmp}return arr}function tripletToBase64(num){return lookup[63&num>>18]+lookup[63&num>>12]+lookup[63&num>>6]+lookup[63&num]}function encodeChunk(uint8,start,end){for(var tmp,output=[],i=start;i<end;i+=3){tmp=(16711680&uint8[i]<<16)+(65280&uint8[i+1]<<8)+(255&uint8[i+2]);output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,output="",parts=[],maxChunkLength=16383,i=0,len2=len-extraBytes;i<len2;i+=maxChunkLength){parts.push(encodeChunk(uint8,i,i+maxChunkLength>len2?len2:i+maxChunkLength))}if(1===extraBytes){tmp=uint8[len-1];output+=lookup[tmp>>2];output+=lookup[63&tmp<<4];output+="=="}else if(2===extraBytes){tmp=(uint8[len-2]<<8)+uint8[len-1];output+=lookup[tmp>>10];output+=lookup[63&tmp>>4];output+=lookup[63&tmp<<2];output+="="}parts.push(output);return parts.join("")}},{}],5:[function(_dereq_,module){"use strict";module.exports={createLink:function createLink(href,attributes){var head=document.head||document.getElementsByTagName("head")[0],link=document.createElement("link");link.href=href;link.rel="stylesheet";for(var key in attributes){if(!attributes.hasOwnProperty(key)){continue}var value=attributes[key];link.setAttribute("data-"+key,value)}head.appendChild(link)},createStyle:function createStyle(cssText,attributes){var head=document.head||document.getElementsByTagName("head")[0],style=document.createElement("style");style.type="text/css";for(var key in attributes){if(!attributes.hasOwnProperty(key)){continue}var value=attributes[key];style.setAttribute("data-"+key,value)}if(style.sheet){style.innerHTML=cssText;style.sheet.cssText=cssText;head.appendChild(style)}else if(style.styleSheet){head.appendChild(style);style.styleSheet.cssText=cssText}else{style.appendChild(document.createTextNode(cssText));head.appendChild(style)}}}},{}],6:[function(_dereq_,module){var Buffer=_dereq_("buffer").Buffer;module.exports=function(a,b){if(!Buffer.isBuffer(a))return;if(!Buffer.isBuffer(b))return;if("function"===typeof a.equals)return a.equals(b);if(a.length!==b.length)return!1;for(var i=0;i<a.length;i++){if(a[i]!==b[i])return!1}return!0}},{buffer:7}],7:[function(_dereq_,module,exports){(function(global){"use strict";var base64=_dereq_("base64-js"),ieee754=_dereq_("ieee754"),isArray=_dereq_("isarray");exports.Buffer=Buffer;exports.SlowBuffer=function(length){if(+length!=length){length=0}return Buffer.alloc(+length)};exports.INSPECT_MAX_BYTES=50;Buffer.TYPED_ARRAY_SUPPORT=global.TYPED_ARRAY_SUPPORT!==void 0?global.TYPED_ARRAY_SUPPORT:function(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function foo(){return 42}};return 42===arr.foo()&&"function"===typeof arr.subarray&&0===arr.subarray(1,1).byteLength}catch(e){return!1}}();exports.kMaxLength=kMaxLength();function kMaxLength(){return Buffer.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function createBuffer(that,length){if(kMaxLength()<length){throw new RangeError("Invalid typed array length")}if(Buffer.TYPED_ARRAY_SUPPORT){that=new Uint8Array(length);that.__proto__=Buffer.prototype}else{if(null===that){that=new Buffer(length)}that.length=length}return that}function Buffer(arg,encodingOrOffset,length){if(!Buffer.TYPED_ARRAY_SUPPORT&&!babelHelpers.instanceof(this,Buffer)){return new Buffer(arg,encodingOrOffset,length)}if("number"===typeof arg){if("string"===typeof encodingOrOffset){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(this,arg)}return from(this,arg,encodingOrOffset,length)}Buffer.poolSize=8192;Buffer._augment=function(arr){arr.__proto__=Buffer.prototype;return arr};function from(that,value,encodingOrOffset,length){if("number"===typeof value){throw new TypeError("\"value\" argument must not be a number")}if("undefined"!==typeof ArrayBuffer&&babelHelpers.instanceof(value,ArrayBuffer)){return fromArrayBuffer(that,value,encodingOrOffset,length)}if("string"===typeof value){return fromString(that,value,encodingOrOffset)}return fromObject(that,value)}Buffer.from=function(value,encodingOrOffset,length){return from(null,value,encodingOrOffset,length)};if(Buffer.TYPED_ARRAY_SUPPORT){Buffer.prototype.__proto__=Uint8Array.prototype;Buffer.__proto__=Uint8Array;if("undefined"!==typeof Symbol&&Symbol.species&&Buffer[Symbol.species]===Buffer){Object.defineProperty(Buffer,Symbol.species,{value:null,configurable:!0})}}function assertSize(size){if("number"!==typeof size){throw new TypeError("\"size\" argument must be a number")}else if(0>size){throw new RangeError("\"size\" argument must not be negative")}}function alloc(that,size,fill,encoding){assertSize(size);if(0>=size){return createBuffer(that,size)}if(fill!==void 0){return"string"===typeof encoding?createBuffer(that,size).fill(fill,encoding):createBuffer(that,size).fill(fill)}return createBuffer(that,size)}Buffer.alloc=function(size,fill,encoding){return alloc(null,size,fill,encoding)};function allocUnsafe(that,size){assertSize(size);that=createBuffer(that,0>size?0:0|checked(size));if(!Buffer.TYPED_ARRAY_SUPPORT){for(var i=0;i<size;++i){that[i]=0}}return that}Buffer.allocUnsafe=function(size){return allocUnsafe(null,size)};Buffer.allocUnsafeSlow=function(size){return allocUnsafe(null,size)};function fromString(that,string,encoding){if("string"!==typeof encoding||""===encoding){encoding="utf8"}if(!Buffer.isEncoding(encoding)){throw new TypeError("\"encoding\" must be a valid string encoding")}var length=0|byteLength(string,encoding);that=createBuffer(that,length);var actual=that.write(string,encoding);if(actual!==length){that=that.slice(0,actual)}return that}function fromArrayLike(that,array){var length=0>array.length?0:0|checked(array.length);that=createBuffer(that,length);for(var i=0;i<length;i+=1){that[i]=255&array[i]}return that}function fromArrayBuffer(that,array,byteOffset,length){array.byteLength;if(0>byteOffset||array.byteLength<byteOffset){throw new RangeError("'offset' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("'length' is out of bounds")}if(byteOffset===void 0&&length===void 0){array=new Uint8Array(array)}else if(length===void 0){array=new Uint8Array(array,byteOffset)}else{array=new Uint8Array(array,byteOffset,length)}if(Buffer.TYPED_ARRAY_SUPPORT){that=array;that.__proto__=Buffer.prototype}else{that=fromArrayLike(that,array)}return that}function fromObject(that,obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length);that=createBuffer(that,len);if(0===that.length){return that}obj.copy(that,0,0,len);return that}if(obj){if("undefined"!==typeof ArrayBuffer&&babelHelpers.instanceof(obj.buffer,ArrayBuffer)||"length"in obj){if("number"!==typeof obj.length||isnan(obj.length)){return createBuffer(that,0)}return fromArrayLike(that,obj)}if("Buffer"===obj.type&&isArray(obj.data)){return fromArrayLike(that,obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=kMaxLength()){throw new RangeError("Attempt to allocate Buffer larger than maximum "+"size: 0x"+kMaxLength().toString(16)+" bytes")}return 0|length}Buffer.isBuffer=function(b){return!!(null!=b&&b._isBuffer)};Buffer.compare=function(a,b){if(!Buffer.isBuffer(a)||!Buffer.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=_Mathmin(x,y);i<len;++i){if(a[i]!==b[i]){x=a[i];y=b[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};Buffer.isEncoding=function(encoding){switch((encoding+"").toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1;}};Buffer.concat=function(list,length){if(!isArray(list)){throw new TypeError("\"list\" argument must be an Array of Buffers")}if(0===list.length){return Buffer.alloc(0)}var i;if(length===void 0){length=0;for(i=0;i<list.length;++i){length+=list[i].length}}var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(!Buffer.isBuffer(buf)){throw new TypeError("\"list\" argument must be an Array of Buffers")}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer.isBuffer(string)){return string.length}if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(string)||babelHelpers.instanceof(string,ArrayBuffer))){return string.byteLength}if("string"!==typeof string){string=""+string}var len=string.length;if(0===len)return 0;var loweredCase=!1;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*len;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=!0;}}}Buffer.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=!1;if(start===void 0||0>start){start=0}if(start>this.length){return""}if(end===void 0||end>this.length){end=this.length}if(0>=end){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(!0){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=!0;}}}Buffer.prototype._isBuffer=!0;function swap(b,n,m){var i=b[n];b[n]=b[m];b[m]=i}Buffer.prototype.swap16=function(){var len=this.length;if(0!==len%2){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i=0;i<len;i+=2){swap(this,i,i+1)}return this};Buffer.prototype.swap32=function(){var len=this.length;if(0!==len%4){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i=0;i<len;i+=4){swap(this,i,i+3);swap(this,i+1,i+2)}return this};Buffer.prototype.swap64=function(){var len=this.length;if(0!==len%8){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i=0;i<len;i+=8){swap(this,i,i+7);swap(this,i+1,i+6);swap(this,i+2,i+5);swap(this,i+3,i+4)}return this};Buffer.prototype.toString=function(){var length=0|this.length;if(0===length)return"";if(0===arguments.length)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return!0;return 0===Buffer.compare(this,b)};Buffer.prototype.inspect=function(){var str="",max=exports.INSPECT_MAX_BYTES;if(0<this.length){str=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str+=" ... "}return"<Buffer "+str+">"};Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(!Buffer.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===void 0){start=0}if(end===void 0){end=target?target.length:0}if(thisStart===void 0){thisStart=0}if(thisEnd===void 0){thisEnd=this.length}if(0>start||end>target.length||0>thisStart||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=_Mathmin(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i){if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i];y=targetCopy[i];break}}if(x<y)return-1;if(y<x)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if("string"===typeof byteOffset){encoding=byteOffset;byteOffset=0}else if(2147483647<byteOffset){byteOffset=2147483647}else if(-2147483648>byteOffset){byteOffset=-2147483648}byteOffset=+byteOffset;if(isNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(0>byteOffset)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(0>byteOffset){if(dir)byteOffset=0;else return-1}if("string"===typeof val){val=Buffer.from(val,encoding)}if(Buffer.isBuffer(val)){if(0===val.length){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if("number"===typeof val){val=255&val;if(Buffer.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1,arrLength=arr.length,valLength=val.length;if(encoding!==void 0){encoding=(encoding+"").toLowerCase();if("ucs2"===encoding||"ucs-2"===encoding||"utf16le"===encoding||"utf-16le"===encoding){if(2>arr.length||2>val.length){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i){if(1===indexSize){return buf[i]}else{return buf.readUInt16BE(i*indexSize)}}var i;if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++){if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex)foundIndex=i;if(i-foundIndex+1===valLength)return foundIndex*indexSize}else{if(-1!==foundIndex)i-=i-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i=byteOffset;0<=i;i--){for(var found=!0,j=0;j<valLength;j++){if(read(arr,i+j)!==read(val,j)){found=!1;break}}if(found)return i}}return-1}Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)};Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)};Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)};function hexWrite(buf,string,offset,length){offset=+offset||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=+length;if(length>remaining){length=remaining}}var strLen=string.length;if(0!==strLen%2)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i=0,parsed;i<length;++i){parsed=parseInt(string.substr(2*i,2),16);if(isNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer.prototype.write=function(string,offset,length,encoding){if(offset===void 0){encoding="utf8";length=this.length;offset=0}else if(length===void 0&&"string"===typeof offset){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=0|offset;if(isFinite(length)){length=0|length;if(encoding===void 0)encoding="utf8"}else{encoding=length;length=void 0}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===void 0||length>remaining)length=remaining;if(0<string.length&&(0>length||0>offset)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=!1;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=!0;}}};Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(0===start&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=_Mathmin(buf.length,end);var res=[],i=start;while(i<end){var firstByte=buf[i],codePoint=null,bytesPerSequence=239<firstByte?4:223<firstByte?3:191<firstByte?2:1;if(i+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(128>firstByte){codePoint=firstByte}break;case 2:secondByte=buf[i+1];if(128===(192&secondByte)){tempCodePoint=(31&firstByte)<<6|63&secondByte;if(127<tempCodePoint){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i+1];thirdByte=buf[i+2];if(128===(192&secondByte)&&128===(192&thirdByte)){tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte;if(2047<tempCodePoint&&(55296>tempCodePoint||57343<tempCodePoint)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i+1];thirdByte=buf[i+2];fourthByte=buf[i+3];if(128===(192&secondByte)&&128===(192&thirdByte)&&128===(192&fourthByte)){tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte;if(65535<tempCodePoint&&1114112>tempCodePoint){codePoint=tempCodePoint}}}}if(null===codePoint){codePoint=65533;bytesPerSequence=1}else if(65535<codePoint){codePoint-=65536;res.push(55296|1023&codePoint>>>10);codePoint=56320|1023&codePoint}res.push(codePoint);i+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return _StringfromCharCode.apply(String,codePoints)}var res="",i=0;while(i<len){res+=_StringfromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=_Mathmin(buf.length,end);for(var i=start;i<end;++i){ret+=_StringfromCharCode(127&buf[i])}return ret}function latin1Slice(buf,start,end){var ret="";end=_Mathmin(buf.length,end);for(var i=start;i<end;++i){ret+=_StringfromCharCode(buf[i])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||0>start)start=0;if(!end||0>end||end>len)end=len;for(var out="",i=start;i<end;++i){out+=toHex(buf[i])}return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res="",i=0;i<bytes.length;i+=2){res+=_StringfromCharCode(bytes[i]+256*bytes[i+1])}return res}Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start;end=end===void 0?len:~~end;if(0>start){start+=len;if(0>start)start=0}else if(start>len){start=len}if(0>end){end+=len;if(0>end)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf;if(Buffer.TYPED_ARRAY_SUPPORT){newBuf=this.subarray(start,end);newBuf.__proto__=Buffer.prototype}else{var sliceLen=end-start;newBuf=new Buffer(sliceLen,void 0);for(var i=0;i<sliceLen;++i){newBuf[i]=this[i+start]}}return newBuf};function checkOffset(offset,ext,length){if(0!==offset%1||0>offset)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset=0|offset;byteLength=0|byteLength;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset],mul=1,i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}return val};Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset=0|offset;byteLength=0|byteLength;if(!noAssert){checkOffset(offset,byteLength,this.length)}var val=this[offset+--byteLength],mul=1;while(0<byteLength&&(mul*=256)){val+=this[offset+--byteLength]*mul}return val};Buffer.prototype.readUInt8=function(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer.prototype.readUInt16LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer.prototype.readUInt16BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer.prototype.readUInt32LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]};Buffer.prototype.readUInt32BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return 16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset=0|offset;byteLength=0|byteLength;if(!noAssert)checkOffset(offset,byteLength,this.length);var val=this[offset],mul=1,i=0;while(++i<byteLength&&(mul*=256)){val+=this[offset+i]*mul}mul*=128;if(val>=mul)val-=_Mathpow(2,8*byteLength);return val};Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset=0|offset;byteLength=0|byteLength;if(!noAssert)checkOffset(offset,byteLength,this.length);var i=byteLength,mul=1,val=this[offset+--i];while(0<i&&(mul*=256)){val+=this[offset+--i]*mul}mul*=128;if(val>=mul)val-=_Mathpow(2,8*byteLength);return val};Buffer.prototype.readInt8=function(offset,noAssert){if(!noAssert)checkOffset(offset,1,this.length);if(!(128&this[offset]))return this[offset];return-1*(255-this[offset]+1)};Buffer.prototype.readInt16LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val};Buffer.prototype.readInt16BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val};Buffer.prototype.readInt32LE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer.prototype.readInt32BE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer.prototype.readFloatLE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,!0,23,4)};Buffer.prototype.readFloatBE=function(offset,noAssert){if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,!1,23,4)};Buffer.prototype.readDoubleLE=function(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,!0,52,8)};Buffer.prototype.readDoubleBE=function(offset,noAssert){if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,!1,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError("\"buffer\" argument must be a Buffer instance");if(value>max||value<min)throw new RangeError("\"value\" argument is out of bounds");if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){value=+value;offset=0|offset;byteLength=0|byteLength;if(!noAssert){var maxBytes=_Mathpow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var mul=1,i=0;this[offset]=255&value;while(++i<byteLength&&(mul*=256)){this[offset+i]=255&value/mul}return offset+byteLength};Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){value=+value;offset=0|offset;byteLength=0|byteLength;if(!noAssert){var maxBytes=_Mathpow(2,8*byteLength)-1;checkInt(this,value,offset,byteLength,maxBytes,0)}var i=byteLength-1,mul=1;this[offset+i]=255&value;while(0<=--i&&(mul*=256)){this[offset+i]=255&value/mul}return offset+byteLength};Buffer.prototype.writeUInt8=function(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,1,255,0);if(!Buffer.TYPED_ARRAY_SUPPORT)value=_Mathfloor(value);this[offset]=255&value;return offset+1};function objectWriteUInt16(buf,value,offset,littleEndian){if(0>value)value=65535+value+1;for(var i=0,j=_Mathmin(buf.length-offset,2);i<j;++i){buf[offset+i]=(value&255<<8*(littleEndian?i:1-i))>>>8*(littleEndian?i:1-i)}}Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=255&value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,!0)}return offset+2};Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,2,65535,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=255&value}else{objectWriteUInt16(this,value,offset,!1)}return offset+2};function objectWriteUInt32(buf,value,offset,littleEndian){if(0>value)value=4294967295+value+1;for(var i=0,j=_Mathmin(buf.length-offset,4);i<j;++i){buf[offset+i]=255&value>>>8*(littleEndian?i:3-i)}}Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=255&value}else{objectWriteUInt32(this,value,offset,!0)}return offset+4};Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=255&value}else{objectWriteUInt32(this,value,offset,!1)}return offset+4};Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){value=+value;offset=0|offset;if(!noAssert){var limit=_Mathpow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;this[offset]=255&value;while(++i<byteLength&&(mul*=256)){if(0>value&&0===sub&&0!==this[offset+i-1]){sub=1}this[offset+i]=255&(value/mul>>0)-sub}return offset+byteLength};Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){value=+value;offset=0|offset;if(!noAssert){var limit=_Mathpow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;this[offset+i]=255&value;while(0<=--i&&(mul*=256)){if(0>value&&0===sub&&0!==this[offset+i+1]){sub=1}this[offset+i]=255&(value/mul>>0)-sub}return offset+byteLength};Buffer.prototype.writeInt8=function(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(!Buffer.TYPED_ARRAY_SUPPORT)value=_Mathfloor(value);if(0>value)value=255+value+1;this[offset]=255&value;return offset+1};Buffer.prototype.writeInt16LE=function(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=255&value;this[offset+1]=value>>>8}else{objectWriteUInt16(this,value,offset,!0)}return offset+2};Buffer.prototype.writeInt16BE=function(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>8;this[offset+1]=255&value}else{objectWriteUInt16(this,value,offset,!1)}return offset+2};Buffer.prototype.writeInt32LE=function(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=255&value;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24}else{objectWriteUInt32(this,value,offset,!0)}return offset+4};Buffer.prototype.writeInt32BE=function(value,offset,noAssert){value=+value;offset=0|offset;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(0>value)value=4294967295+value+1;if(Buffer.TYPED_ARRAY_SUPPORT){this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=255&value}else{objectWriteUInt32(this,value,offset,!1)}return offset+4};function checkIEEE754(buf,value,offset,ext){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(0>offset)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,4,34028234663852886e22,-34028234663852886e22)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)};Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){if(!noAssert){checkIEEE754(buf,value,offset,8,17976931348623157e292,-17976931348623157e292)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)};Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)};Buffer.prototype.copy=function(target,targetStart,start,end){if(!start)start=0;if(!end&&0!==end)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(0<end&&end<start)end=start;if(end===start)return 0;if(0===target.length||0===this.length)return 0;if(0>targetStart){throw new RangeError("targetStart out of bounds")}if(0>start||start>=this.length)throw new RangeError("sourceStart out of bounds");if(0>end)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start,i;if(this===target&&start<targetStart&&targetStart<end){for(i=len-1;0<=i;--i){target[i+targetStart]=this[i+start]}}else if(1e3>len||!Buffer.TYPED_ARRAY_SUPPORT){for(i=0;i<len;++i){target[i+targetStart]=this[i+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer.prototype.fill=function(val,start,end,encoding){if("string"===typeof val){if("string"===typeof start){encoding=start;start=0;end=this.length}else if("string"===typeof end){encoding=end;end=this.length}if(1===val.length){var code=val.charCodeAt(0);if(256>code){val=code}}if(encoding!==void 0&&"string"!==typeof encoding){throw new TypeError("encoding must be a string")}if("string"===typeof encoding&&!Buffer.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if("number"===typeof val){val=255&val}if(0>start||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===void 0?this.length:end>>>0;if(!val)val=0;var i;if("number"===typeof val){for(i=start;i<end;++i){this[i]=val}}else{var bytes=Buffer.isBuffer(val)?val:utf8ToBytes(new Buffer(val,encoding).toString()),len=bytes.length;for(i=0;i<end-start;++i){this[i+start]=bytes[i%len]}}return this};var INVALID_BASE64_RE=/[^+\/0-9A-Za-z-_]/g;function base64clean(str){str=stringtrim(str).replace(INVALID_BASE64_RE,"");if(2>str.length)return"";while(0!==str.length%4){str=str+"="}return str}function stringtrim(str){if(str.trim)return str.trim();return str.replace(/^\s+|\s+$/g,"")}function toHex(n){if(16>n)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||1/0;for(var codePoint,length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){codePoint=string.charCodeAt(i);if(55295<codePoint&&57344>codePoint){if(!leadSurrogate){if(56319<codePoint){if(-1<(units-=3))bytes.push(239,191,189);continue}else if(i+1===length){if(-1<(units-=3))bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(56320>codePoint){if(-1<(units-=3))bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if(-1<(units-=3))bytes.push(239,191,189)}leadSurrogate=null;if(128>codePoint){if(0>(units-=1))break;bytes.push(codePoint)}else if(2048>codePoint){if(0>(units-=2))break;bytes.push(192|codePoint>>6,128|63&codePoint)}else if(65536>codePoint){if(0>(units-=3))break;bytes.push(224|codePoint>>12,128|63&codePoint>>6,128|63&codePoint)}else if(1114112>codePoint){if(0>(units-=4))break;bytes.push(240|codePoint>>18,128|63&codePoint>>12,128|63&codePoint>>6,128|63&codePoint)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str){for(var byteArray=[],i=0;i<str.length;++i){byteArray.push(255&str.charCodeAt(i))}return byteArray}function utf16leToBytes(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length;++i){if(0>(units-=2))break;c=str.charCodeAt(i);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str){return base64.toByteArray(base64clean(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length;++i){if(i+offset>=dst.length||i>=src.length)break;dst[i+offset]=src[i]}return i}function isnan(val){return val!==val}}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{"base64-js":4,ieee754:16,isarray:21}],8:[function(_dereq_,module,exports){exports=module.exports=_dereq_("./debug");exports.log=function(){return"object"===("undefined"===typeof console?"undefined":babelHelpers.typeof(console))&&console.log&&Function.prototype.apply.call(console.log,console,arguments)};exports.formatArgs=function(){var args=arguments,useColors=this.useColors;args[0]=(useColors?"%c":"")+this.namespace+(useColors?" %c":" ")+args[0]+(useColors?"%c ":" ");if(!useColors)return args;var c="color: "+this.color;args=[args[0],c,"color: inherit"].concat(Array.prototype.slice.call(args,1));var index=0,lastC=0;args[0].replace(/%[a-z%]/g,function(match){if("%%"===match)return;index++;if("%c"===match){lastC=index}});args.splice(lastC,0,c);return args};exports.save=save;exports.load=load;exports.useColors=useColors;exports.storage="undefined"!=typeof chrome&&"undefined"!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}();exports.colors=["lightseagreen","forestgreen","goldenrod","dodgerblue","darkorchid","crimson"];function useColors(){return"WebkitAppearance"in document.documentElement.style||window.console&&(console.firebug||console.exception&&console.table)||navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)}exports.formatters.j=function(v){return JSON.stringify(v)};function save(namespaces){try{if(null==namespaces){exports.storage.removeItem("debug")}else{exports.storage.debug=namespaces}}catch(e){}}function load(){var r;try{r=exports.storage.debug}catch(e){}return r}exports.enable(load())},{"./debug":9}],9:[function(_dereq_,module,exports){exports=module.exports=debug;exports.coerce=function(val){if(babelHelpers.instanceof(val,Error))return val.stack||val.message;return val};exports.disable=disable;exports.enable=enable;exports.enabled=enabled;exports.names=[];exports.skips=[];exports.formatters={};var prevColor=0;function selectColor(){return exports.colors[prevColor++%exports.colors.length]}function debug(namespace){function disabled(){}disabled.enabled=!1;function enabled(){var self=enabled;if(null==self.useColors)self.useColors=exports.useColors();if(null==self.color&&self.useColors)self.color=selectColor();var args=Array.prototype.slice.call(arguments);args[0]=exports.coerce(args[0]);if("string"!==typeof args[0]){args=["%o"].concat(args)}var index=0;args[0]=args[0].replace(/%([a-z%])/g,function(match,format){if("%%"===match)return match;index++;var formatter=exports.formatters[format];if("function"===typeof formatter){var val=args[index];match=formatter.call(self,val);args.splice(index,1);index--}return match});if("function"===typeof exports.formatArgs){args=exports.formatArgs.apply(self,args)}var logFn=enabled.log||exports.log||console.log.bind(console);logFn.apply(self,args)}enabled.enabled=!0;var fn=exports.enabled(namespace)?enabled:disabled;fn.namespace=namespace;return fn}function enable(namespaces){exports.save(namespaces);for(var split=(namespaces||"").split(/[\s,]+/),len=split.length,i=0;i<len;i++){if(!split[i])continue;namespaces=split[i].replace(/\*/g,".*?");if("-"===namespaces[0]){exports.skips.push(new RegExp("^"+namespaces.substr(1)+"$"))}else{exports.names.push(new RegExp("^"+namespaces+"$"))}}}function disable(){exports.enable("")}function enabled(name){var i,len;for(i=0,len=exports.skips.length;i<len;i++){if(exports.skips[i].test(name)){return!1}}for(i=0,len=exports.names.length;i<len;i++){if(exports.names[i].test(name)){return!0}}return!1}},{}],10:[function(_dereq_,module){"use strict";var isObj=_dereq_("is-obj"),hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(null===val||val===void 0){throw new TypeError("Sources cannot be null or undefined")}return Object(val)}function assignKey(to,from,key){var val=from[key];if(val===void 0||null===val){return}if(hasOwnProperty.call(to,key)){if(to[key]===void 0||null===to[key]){throw new TypeError("Cannot convert undefined or null to object ("+key+")")}}if(!hasOwnProperty.call(to,key)||!isObj(val)){to[key]=val}else{to[key]=assign(Object(to[key]),from[key])}}function assign(to,from){if(to===from){return to}from=Object(from);for(var key in from){if(hasOwnProperty.call(from,key)){assignKey(to,from,key)}}if(Object.getOwnPropertySymbols){for(var symbols=Object.getOwnPropertySymbols(from),i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){assignKey(to,from,symbols[i])}}}return to}module.exports=function(target){target=toObject(target);for(var s=1;s<arguments.length;s++){assign(target,arguments[s])}return target}},{"is-obj":20}],11:[function(){(function(t,n,r,i){"use strict";function st(e,t){for(var n=0,r=e.length;n<r;n++){gt(e[n],t)}}function ot(e){for(var t=0,n=e.length,r;t<n;t++){r=e[t],it(r,w[at(r)])}}function ut(e){return function(t){F(t)&&(gt(t,e),st(t.querySelectorAll(E),e))}}function at(e){var t=R.call(e,"is"),n=e.nodeName.toUpperCase(),r=x.call(b,t?m+t.toUpperCase():v+n);return t&&-1<r&&!ft(n,t)?-1:r}function ft(e,t){return-1<E.indexOf(e+"[is=\""+t+"\"]")}function lt(e){var t=e.currentTarget,n=e.attrChange,r=e.attrName,i=e.target;Y&&(!i||i===t)&&t.attributeChangedCallback&&"style"!==r&&e.prevValue!==e.newValue&&t.attributeChangedCallback(r,n===e[f]?null:e.prevValue,n===e[c]?null:e.newValue)}function ct(e){var t=ut(e);return function(e){$.push(t,e.target)}}function ht(e){G&&(G=!1,e.currentTarget.removeEventListener(p,ht)),st((e.target||n).querySelectorAll(E),e.detail===u?u:o),j&&vt()}function pt(e,t){var n=this;U.call(n,e,t),Z.call(n,{target:n})}function dt(e,t){P(e,t),nt?nt.observe(e,X):(Q&&(e.setAttribute=pt,e[s]=tt(e),e.addEventListener(d,Z)),e.addEventListener(h,lt)),e.createdCallback&&Y&&(e.created=!0,e.createdCallback(),e.created=!1)}function vt(){for(var e,t=0,n=I.length;t<n;t++){e=I[t],S.contains(e)||(n--,I.splice(t--,1),gt(e,u))}}function mt(e){throw new Error("A "+e+" type is already registered")}function gt(e,t){var n,r=at(e);-1<r&&(rt(e,w[r]),r=0,t===o&&!e[o]?(e[u]=!1,e[o]=!0,r=1,j&&0>x.call(I,e)&&I.push(e)):t===u&&!e[u]&&(e[o]=!1,e[u]=!0,r=1),r&&(n=e[t+"Callback"])&&n.call(e))}if(i in n)return;var s="__"+i+(1e5*Math.random()>>0),o="attached",u="detached",a="extends",f="ADDITION",l="MODIFICATION",c="REMOVAL",h="DOMAttrModified",p="DOMContentLoaded",d="DOMSubtreeModified",v="<",m="=",g=/^[A-Z][A-Z0-9]*(?:-[A-Z0-9]+)+$/,y=["ANNOTATION-XML","COLOR-PROFILE","FONT-FACE","FONT-FACE-SRC","FONT-FACE-URI","FONT-FACE-FORMAT","FONT-FACE-NAME","MISSING-GLYPH"],b=[],w=[],E="",S=n.documentElement,x=b.indexOf||function(e){for(var t=this.length;t--&&this[t]!==e;){}return t},T=r.prototype,N=T.hasOwnProperty,C=T.isPrototypeOf,k=r.defineProperty,L=r.getOwnPropertyDescriptor,A=r.getOwnPropertyNames,O=r.getPrototypeOf,M=r.setPrototypeOf,_=!!r.__proto__,D=r.create||function yt(e){return e?(yt.prototype=e,new yt):this},P=M||(_?function(e,t){return e.__proto__=t,e}:A&&L?function(){function e(e,t){for(var n,r=A(t),i=0,s=r.length;i<s;i++){n=r[i],N.call(e,n)||k(e,n,L(t,n))}}return function(t,n){do{e(t,n)}while((n=O(n))&&!C.call(n,t));return t}}():function(e,t){for(var n in t){e[n]=t[n]}return e}),H=t.MutationObserver||t.WebKitMutationObserver,B=(t.HTMLElement||t.Element||t.Node).prototype,j=!C.call(B,S),F=j?function(e){return 1===e.nodeType}:function(e){return C.call(B,e)},I=j&&[],q=B.cloneNode,R=B.getAttribute,U=B.setAttribute,z=B.removeAttribute,W=n.createElement,X=H&&{attributes:!0,characterData:!0,attributeOldValue:!0},V=H||function(){Q=!1,S.removeEventListener(h,V)},$,J=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.msRequestAnimationFrame||function(e){setTimeout(e,10)},K=!1,Q=!0,G=!0,Y=!0,Z,et,tt,nt,rt,it;M||_?(rt=function(e,t){C.call(t,e)||dt(e,t)},it=dt):(rt=function(e,t){e[s]||(e[s]=r(!0),dt(e,t))},it=rt),j?(Q=!1,function(){var t=L(B,"addEventListener"),n=t.value,r=function(e){var t=new CustomEvent(h,{bubbles:!0});t.attrName=e,t.prevValue=R.call(this,e),t.newValue=null,t[c]=t.attrChange=2,z.call(this,e),this.dispatchEvent(t)},i=function(t,n){var r=this.hasAttribute(t),i=r&&R.call(this,t);e=new CustomEvent(h,{bubbles:!0}),U.call(this,t,n),e.attrName=t,e.prevValue=r?i:null,e.newValue=n,r?e[l]=e.attrChange=1:e[f]=e.attrChange=0,this.dispatchEvent(e)},o=function(e){var t=e.currentTarget,n=t[s],r=e.propertyName,i;n.hasOwnProperty(r)&&(n=n[r],i=new CustomEvent(h,{bubbles:!0}),i.attrName=n.name,i.prevValue=n.value||null,i.newValue=n.value=t[r]||null,null==i.prevValue?i[f]=i.attrChange=0:i[l]=i.attrChange=1,t.dispatchEvent(i))};t.value=function(e,t,u){e===h&&this.attributeChangedCallback&&this.setAttribute!==i&&(this[s]={className:{name:"class",value:this.className}},this.setAttribute=i,this.removeAttribute=r,n.call(this,"propertychange",o)),n.call(this,e,t,u)},k(B,"addEventListener",t)}()):H||(S.addEventListener(h,V),S.setAttribute(s,1),S.removeAttribute(s),Q&&(Z=function(e){var t=this,n,r,i;if(t===e.target){n=t[s],t[s]=r=tt(t);for(i in r){if(!(i in n))return et(0,t,i,n[i],r[i],f);if(r[i]!==n[i])return et(1,t,i,n[i],r[i],l)}for(i in n){if(!(i in r))return et(2,t,i,n[i],r[i],c)}}},et=function(e,t,n,r,i,s){var o={attrChange:e,currentTarget:t,attrName:n,prevValue:r,newValue:i};o[s]=e,lt(o)},tt=function(e){for(var t,n,r={},i=e.attributes,s=0,o=i.length;s<o;s++){t=i[s],n=t.name,"setAttribute"!==n&&(r[n]=t.value)}return r})),n[i]=function(t,r){c=t.toUpperCase(),K||(K=!0,H?(nt=function(e,t){function n(e,t){for(var n=0,r=e.length;n<r;t(e[n++])){}}return new H(function(r){for(var i,s,o,u=0,a=r.length;u<a;u++){i=r[u],"childList"===i.type?(n(i.addedNodes,e),n(i.removedNodes,t)):(s=i.target,Y&&s.attributeChangedCallback&&"style"!==i.attributeName&&(o=R.call(s,i.attributeName),o!==i.oldValue&&s.attributeChangedCallback(i.attributeName,i.oldValue,o)))}})}(ut(o),ut(u)),nt.observe(n,{childList:!0,subtree:!0})):($=[],J(function d(){while($.length){$.shift().call(null,$.shift())}J(d)}),n.addEventListener("DOMNodeInserted",ct(o)),n.addEventListener("DOMNodeRemoved",ct(u))),n.addEventListener(p,ht),n.addEventListener("readystatechange",ht),n.createElement=function(e,t){var r=W.apply(n,arguments),i=""+e,s=x.call(b,(t?m:v)+(t||i).toUpperCase()),o=-1<s;return t&&(r.setAttribute("is",t=t.toLowerCase()),o&&(o=ft(i.toUpperCase(),t))),Y=!n.createElement.innerHTMLHelper,o&&it(r,w[s]),r},B.cloneNode=function(e){var t=q.call(this,!!e),n=at(t);return-1<n&&it(t,w[n]),e&&ot(t.querySelectorAll(E)),t}),-2<x.call(b,m+c)+x.call(b,v+c)&&mt(t);if(!g.test(c)||-1<x.call(y,c))throw new Error("The type "+t+" is invalid");var i=function(){return f?n.createElement(l,c):n.createElement(l)},s=r||T,f=N.call(s,a),l=f?r[a].toUpperCase():c,c,h;return f&&-1<x.call(b,v+l)&&mt(l),h=b.push((f?m:v)+c)-1,E=E.concat(E.length?",":"",f?l+"[is=\""+t.toLowerCase()+"\"]":l),i.prototype=w[h]=N.call(s,"prototype")?s.prototype:D(B),st(n.querySelectorAll(E),o),i}})(window,document,Object,"registerElement")},{}],12:[function(_dereq_,module){module.exports=function(dtype){switch(dtype){case"int8":return Int8Array;case"int16":return Int16Array;case"int32":return Int32Array;case"uint8":return Uint8Array;case"uint16":return Uint16Array;case"uint32":return Uint32Array;case"float32":return Float32Array;case"float64":return Float64Array;case"array":return Array;case"uint8_clamped":return Uint8ClampedArray;}}},{}],13:[function(_dereq_,module){var dtype=_dereq_("dtype");module.exports=function(data,output,offset){if(!data)throw new TypeError("must specify data as first parameter");offset=0|+(offset||0);if(Array.isArray(data)&&Array.isArray(data[0])){var dim=data[0].length,length=data.length*dim;if(!output||"string"===typeof output){output=new(dtype(output||"float32"))(length+offset)}var dstLength=output.length-offset;if(length!==dstLength){throw new Error("source length "+length+" ("+dim+"x"+data.length+")"+" does not match destination length "+dstLength)}for(var i=0,k=offset;i<data.length;i++){for(var j=0;j<dim;j++){output[k++]=data[i][j]}}}else{if(!output||"string"===typeof output){var Ctor=dtype(output||"float32");if(0===offset){output=new Ctor(data)}else{output=new Ctor(data.length+offset);output.set(data,offset)}}else{output.set(data,offset)}}return output}},{dtype:12}],14:[function(_dereq_,module){var isFunction=_dereq_("is-function");module.exports=function(list,iterator,context){if(!isFunction(iterator)){throw new TypeError("iterator must be a function")}if(3>arguments.length){context=this}if("[object Array]"===toString.call(list))forEachArray(list,iterator,context);else if("string"===typeof list)forEachString(list,iterator,context);else forEachObject(list,iterator,context)};var toString=Object.prototype.toString,hasOwnProperty=Object.prototype.hasOwnProperty;function forEachArray(array,iterator,context){for(var i=0,len=array.length;i<len;i++){if(hasOwnProperty.call(array,i)){iterator.call(context,array[i],i,array)}}}function forEachString(string,iterator,context){for(var i=0,len=string.length;i<len;i++){iterator.call(context,string.charAt(i),i,string)}}function forEachObject(object,iterator,context){for(var k in object){if(hasOwnProperty.call(object,k)){iterator.call(context,object[k],k,object)}}}},{"is-function":19}],15:[function(_dereq_,module){(function(global){var win;if("undefined"!==typeof window){win=window}else if("undefined"!==typeof global){win=global}else if("undefined"!==typeof self){win=self}else{win={}}module.exports=win}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],16:[function(_dereq_,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];i+=d;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;0<nBits;e=256*e+buffer[offset+i],i+=d,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;0<nBits;m=256*m+buffer[offset+i],i+=d,nBits-=8){}if(0===e){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*(1/0)}else{m=m+_Mathpow(2,mLen);e=e-eBias}return(s?-1:1)*m*_Mathpow(2,e-mLen)};exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?5.960464477539063e-8-6.617444900424222e-24:0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=0>value||0===value&&0>1/value?1:0;value=_Mathabs(value);if(isNaN(value)||value===1/0){m=isNaN(value)?1:0;e=eMax}else{e=_Mathfloor(_Mathlog(value)/_MathLN);if(1>value*(c=_Mathpow(2,-e))){e--;c*=2}if(1<=e+eBias){value+=rt/c}else{value+=rt*_Mathpow(2,1-eBias)}if(2<=value*c){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(1<=e+eBias){m=(value*c-1)*_Mathpow(2,mLen);e=e+eBias}else{m=value*_Mathpow(2,eBias-1)*_Mathpow(2,mLen);e=0}}for(;8<=mLen;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;0<eLen;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8){}buffer[offset+i-d]|=128*s}},{}],17:[function(_dereq_,module){if("function"===typeof Object.create){module.exports=function(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}}else{module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},{}],18:[function(_dereq_,module){module.exports=function(obj){return null!=obj&&(isBuffer(obj)||isSlowBuffer(obj)||!!obj._isBuffer)};function isBuffer(obj){return!!obj.constructor&&"function"===typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}function isSlowBuffer(obj){return"function"===typeof obj.readFloatLE&&"function"===typeof obj.slice&&isBuffer(obj.slice(0,0))}},{}],19:[function(_dereq_,module){module.exports=function(fn){var string=toString.call(fn);return"[object Function]"===string||"function"===typeof fn&&"[object RegExp]"!==string||"undefined"!==typeof window&&(fn===window.setTimeout||fn===window.alert||fn===window.confirm||fn===window.prompt)};var toString=Object.prototype.toString},{}],20:[function(_dereq_,module){"use strict";module.exports=function(x){var type=babelHelpers.typeof(x);return null!==x&&("object"===type||"function"===type)}},{}],21:[function(_dereq_,module){var toString={}.toString;module.exports=Array.isArray||function(arr){return"[object Array]"==toString.call(arr)}},{}],22:[function(_dereq_,module){var wordWrap=_dereq_("word-wrapper"),xtend=_dereq_("xtend"),number=_dereq_("as-number"),X_HEIGHTS=["x","e","a","o","n","s","r","c","u","m","v","w","z"],M_WIDTHS=["m","w"],CAP_HEIGHTS=["H","I","N","E","F","K","L","T","U","V","W","X","Y","Z"],TAB_ID="\t".charCodeAt(0),SPACE_ID=" ".charCodeAt(0),ALIGN_CENTER=1,ALIGN_RIGHT=2;module.exports=function(opt){return new TextLayout(opt)};function TextLayout(opt){this.glyphs=[];this._measure=this.computeMetrics.bind(this);this.update(opt)}TextLayout.prototype.update=function(opt){opt=xtend({measure:this._measure},opt);this._opt=opt;this._opt.tabSize=number(this._opt.tabSize,4);if(!opt.font)throw new Error("must provide a valid bitmap font");var glyphs=this.glyphs,text=opt.text||"",font=opt.font;this._setupSpaceGlyphs(font);var lines=wordWrap.lines(text,opt),minWidth=opt.width||0;glyphs.length=0;var maxLineWidth=lines.reduce(function(prev,line){return _Mathmax(prev,line.width,minWidth)},0),x=0,y=0,lineHeight=number(opt.lineHeight,font.common.lineHeight),baseline=font.common.base,descender=lineHeight-baseline,letterSpacing=opt.letterSpacing||0,height=lineHeight*lines.length-descender,align=getAlignType(this._opt.align);y-=height;this._width=maxLineWidth;this._height=height;this._descender=lineHeight-baseline;this._baseline=baseline;this._xHeight=getXHeight(font);this._capHeight=getCapHeight(font);this._lineHeight=lineHeight;this._ascender=lineHeight-descender-this._xHeight;var self=this;lines.forEach(function(line,lineIndex){for(var start=line.start,end=line.end,lineWidth=line.width,lastGlyph,i=start;i<end;i++){var id=text.charCodeAt(i),glyph=self.getGlyph(font,id);if(glyph){if(lastGlyph)x+=getKerning(font,lastGlyph.id,glyph.id);var tx=x;if(align===ALIGN_CENTER)tx+=(maxLineWidth-lineWidth)/2;else if(align===ALIGN_RIGHT)tx+=maxLineWidth-lineWidth;glyphs.push({position:[tx,y],data:glyph,index:i,line:lineIndex});x+=glyph.xadvance+letterSpacing;lastGlyph=glyph}}y+=lineHeight;x=0});this._linesTotal=lines.length};TextLayout.prototype._setupSpaceGlyphs=function(font){this._fallbackSpaceGlyph=null;this._fallbackTabGlyph=null;if(!font.chars||0===font.chars.length)return;var space=getGlyphById(font,SPACE_ID)||getMGlyph(font)||font.chars[0],tabWidth=this._opt.tabSize*space.xadvance;this._fallbackSpaceGlyph=space;this._fallbackTabGlyph=xtend(space,{x:0,y:0,xadvance:tabWidth,id:TAB_ID,xoffset:0,yoffset:0,width:0,height:0})};TextLayout.prototype.getGlyph=function(font,id){var glyph=getGlyphById(font,id);if(glyph)return glyph;else if(id===TAB_ID)return this._fallbackTabGlyph;else if(id===SPACE_ID)return this._fallbackSpaceGlyph;return null};TextLayout.prototype.computeMetrics=function(text,start,end,width){var letterSpacing=this._opt.letterSpacing||0,font=this._opt.font,curPen=0,curWidth=0,count=0,glyph,lastGlyph;if(!font.chars||0===font.chars.length){return{start:start,end:start,width:0}}end=_Mathmin(text.length,end);for(var i=start;i<end;i++){var id=text.charCodeAt(i),glyph=this.getGlyph(font,id);if(glyph){var xoff=glyph.xoffset,kern=lastGlyph?getKerning(font,lastGlyph.id,glyph.id):0;curPen+=kern;var nextPen=curPen+glyph.xadvance+letterSpacing,nextWidth=curPen+glyph.width;if(nextWidth>=width||nextPen>=width)break;curPen=nextPen;curWidth=nextWidth;lastGlyph=glyph}count++}if(lastGlyph)curWidth+=lastGlyph.xoffset;return{start:start,end:start+count,width:curWidth}};["width","height","descender","ascender","xHeight","baseline","capHeight","lineHeight"].forEach(function(name){Object.defineProperty(TextLayout.prototype,name,{get:wrapper(name),configurable:!0})});function wrapper(name){return new Function(["return function "+name+"() {","  return this._"+name,"}"].join("\n"))()}function getGlyphById(font,id){if(!font.chars||0===font.chars.length)return null;var glyphIdx=findChar(font.chars,id);if(0<=glyphIdx)return font.chars[glyphIdx];return null}function getXHeight(font){for(var i=0;i<X_HEIGHTS.length;i++){var id=X_HEIGHTS[i].charCodeAt(0),idx=findChar(font.chars,id);if(0<=idx)return font.chars[idx].height}return 0}function getMGlyph(font){for(var i=0;i<M_WIDTHS.length;i++){var id=M_WIDTHS[i].charCodeAt(0),idx=findChar(font.chars,id);if(0<=idx)return font.chars[idx]}return 0}function getCapHeight(font){for(var i=0;i<CAP_HEIGHTS.length;i++){var id=CAP_HEIGHTS[i].charCodeAt(0),idx=findChar(font.chars,id);if(0<=idx)return font.chars[idx].height}return 0}function getKerning(font,left,right){if(!font.kernings||0===font.kernings.length)return 0;for(var table=font.kernings,i=0,kern;i<table.length;i++){kern=table[i];if(kern.first===left&&kern.second===right)return kern.amount}return 0}function getAlignType(align){if("center"===align)return ALIGN_CENTER;else if("right"===align)return ALIGN_RIGHT;return 0}function findChar(array,value,start){start=start||0;for(var i=start;i<array.length;i++){if(array[i].id===value){return i}}return-1}},{"as-number":3,"word-wrapper":47,xtend:50}],23:[function(_dereq_,module){(function(Buffer){var xhr=_dereq_("xhr"),noop=function(){},parseASCII=_dereq_("parse-bmfont-ascii"),parseXML=_dereq_("parse-bmfont-xml"),readBinary=_dereq_("parse-bmfont-binary"),isBinaryFormat=_dereq_("./lib/is-binary"),xtend=_dereq_("xtend"),xml2=function(){return self.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest}();module.exports=function(opt,cb){cb="function"===typeof cb?cb:noop;if("string"===typeof opt)opt={uri:opt};else if(!opt)opt={};var expectBinary=opt.binary;if(expectBinary)opt=getBinaryOpts(opt);xhr(opt,function(err,res,body){if(err)return cb(err);if(!/^2/.test(res.statusCode))return cb(new Error("http status code: "+res.statusCode));if(!body)return cb(new Error("no body result"));var binary=!1;if(isArrayBuffer(body)){var array=new Uint8Array(body);body=new Buffer(array,"binary")}if(isBinaryFormat(body)){binary=!0;if("string"===typeof body)body=new Buffer(body,"binary")}if(!binary){if(Buffer.isBuffer(body))body=body.toString(opt.encoding);body=body.trim()}var result;try{var type=res.headers["content-type"];if(binary)result=readBinary(body);else if(/json/.test(type)||"{"===body.charAt(0))result=JSON.parse(body);else if(/xml/.test(type)||"<"===body.charAt(0))result=parseXML(body);else result=parseASCII(body)}catch(e){cb(new Error("error parsing font "+e.message));cb=noop}cb(null,result)})};function isArrayBuffer(arr){var str=Object.prototype.toString;return"[object ArrayBuffer]"===str.call(arr)}function getBinaryOpts(opt){if(xml2)return xtend(opt,{responseType:"arraybuffer"});if("undefined"===typeof self.XMLHttpRequest)throw new Error("your browser does not support XHR loading");var req=new self.XMLHttpRequest;req.overrideMimeType("text/plain; charset=x-user-defined");return xtend({xhr:req},opt)}}).call(this,_dereq_("buffer").Buffer)},{"./lib/is-binary":24,buffer:7,"parse-bmfont-ascii":26,"parse-bmfont-binary":27,"parse-bmfont-xml":28,xhr:48,xtend:50}],24:[function(_dereq_,module){(function(Buffer){var equal=_dereq_("buffer-equal"),HEADER=new Buffer([66,77,70,3]);module.exports=function(buf){if("string"===typeof buf)return"BMF"===buf.substring(0,3);return 4<buf.length&&equal(buf.slice(0,4),HEADER)}}).call(this,_dereq_("buffer").Buffer)},{buffer:7,"buffer-equal":6}],25:[function(_dereq_,module){"use strict";var getOwnPropertySymbols=Object.getOwnPropertySymbols,hasOwnProperty=Object.prototype.hasOwnProperty,propIsEnumerable=Object.prototype.propertyIsEnumerable;function toObject(val){if(null===val||val===void 0){throw new TypeError("Object.assign cannot be called with null or undefined")}return Object(val)}module.exports=function(){try{if(!Object.assign){return!1}var test1=new String("abc");test1[5]="de";if("5"===Object.getOwnPropertyNames(test1)[0]){return!1}for(var test2={},i=0;10>i;i++){test2["_"+_StringfromCharCode(i)]=i}var order2=Object.getOwnPropertyNames(test2).map(function(n){return test2[n]});if("0123456789"!==order2.join("")){return!1}var test3={};"abcdefghijklmnopqrst".split("").forEach(function(letter){test3[letter]=letter});if("abcdefghijklmnopqrst"!==Object.keys(Object.assign({},test3)).join("")){return!1}return!0}catch(err){return!1}}()?Object.assign:function(target){for(var from,to=toObject(target),symbols,s=1;s<arguments.length;s++){from=Object(arguments[s]);for(var key in from){if(hasOwnProperty.call(from,key)){to[key]=from[key]}}if(getOwnPropertySymbols){symbols=getOwnPropertySymbols(from);for(var i=0;i<symbols.length;i++){if(propIsEnumerable.call(from,symbols[i])){to[symbols[i]]=from[symbols[i]]}}}}return to}},{}],26:[function(_dereq_,module){module.exports=function(data){if(!data)throw new Error("no data provided");data=data.toString().trim();var output={pages:[],chars:[],kernings:[]},lines=data.split(/\r\n?|\n/g);if(0===lines.length)throw new Error("no data in BMFont file");for(var i=0,lineData;i<lines.length;i++){lineData=splitLine(lines[i],i);if(!lineData)continue;if("page"===lineData.key){if("number"!==typeof lineData.data.id)throw new Error("malformed file at line "+i+" -- needs page id=N");if("string"!==typeof lineData.data.file)throw new Error("malformed file at line "+i+" -- needs page file=\"path\"");output.pages[lineData.data.id]=lineData.data.file}else if("chars"===lineData.key||"kernings"===lineData.key){}else if("char"===lineData.key){output.chars.push(lineData.data)}else if("kerning"===lineData.key){output.kernings.push(lineData.data)}else{output[lineData.key]=lineData.data}}return output};function splitLine(line,idx){line=line.replace(/\t+/g," ").trim();if(!line)return null;var space=line.indexOf(" ");if(-1===space)throw new Error("no named row at line "+idx);var key=line.substring(0,space);line=line.substring(space+1);line=line.replace(/letter=[\'\"]\S+[\'\"]/gi,"");line=line.split("=");line=line.map(function(str){return str.trim().match(/(".*?"|[^"\s]+)+(?=\s*|\s*$)/g)});for(var data=[],i=0,dt;i<line.length;i++){dt=line[i];if(0===i){data.push({key:dt[0],data:""})}else if(i===line.length-1){data[data.length-1].data=parseData(dt[0])}else{data[data.length-1].data=parseData(dt[0]);data.push({key:dt[1],data:""})}}var out={key:key,data:{}};data.forEach(function(v){out.data[v.key]=v.data});return out}function parseData(data){if(!data||0===data.length)return"";if(0===data.indexOf("\"")||0===data.indexOf("'"))return data.substring(1,data.length-1);if(-1!==data.indexOf(","))return parseIntList(data);return parseInt(data,10)}function parseIntList(data){return data.split(",").map(function(val){return parseInt(val,10)})}},{}],27:[function(_dereq_,module){var HEADER=[66,77,70];module.exports=function(buf){if(6>buf.length)throw new Error("invalid buffer length for BMFont");var header=HEADER.every(function(byte,i){return buf.readUInt8(i)===byte});if(!header)throw new Error("BMFont missing BMF byte header");var i=3,vers=buf.readUInt8(i++);if(3<vers)throw new Error("Only supports BMFont Binary v3 (BMFont App v1.10)");for(var target={kernings:[],chars:[]},b=0;5>b;b++){i+=readBlock(target,buf,i)}return target};function readBlock(target,buf,i){if(i>buf.length-1)return 0;var blockID=buf.readUInt8(i++),blockSize=buf.readInt32LE(i);i+=4;switch(blockID){case 1:target.info=readInfo(buf,i);break;case 2:target.common=readCommon(buf,i);break;case 3:target.pages=readPages(buf,i,blockSize);break;case 4:target.chars=readChars(buf,i,blockSize);break;case 5:target.kernings=readKernings(buf,i,blockSize);break;}return 5+blockSize}function readInfo(buf,i){var info={size:buf.readInt16LE(i)},bitField=buf.readUInt8(i+2);info.smooth=1&bitField>>7;info.unicode=1&bitField>>6;info.italic=1&bitField>>5;info.bold=1&bitField>>4;if(1&bitField>>3)info.fixedHeight=1;info.charset=buf.readUInt8(i+3)||"";info.stretchH=buf.readUInt16LE(i+4);info.aa=buf.readUInt8(i+6);info.padding=[buf.readInt8(i+7),buf.readInt8(i+8),buf.readInt8(i+9),buf.readInt8(i+10)];info.spacing=[buf.readInt8(i+11),buf.readInt8(i+12)];info.outline=buf.readUInt8(i+13);info.face=readStringNT(buf,i+14);return info}function readCommon(buf,i){var common={lineHeight:buf.readUInt16LE(i),base:buf.readUInt16LE(i+2),scaleW:buf.readUInt16LE(i+4),scaleH:buf.readUInt16LE(i+6),pages:buf.readUInt16LE(i+8)},bitField=buf.readUInt8(i+10);common.packed=0;common.alphaChnl=buf.readUInt8(i+11);common.redChnl=buf.readUInt8(i+12);common.greenChnl=buf.readUInt8(i+13);common.blueChnl=buf.readUInt8(i+14);return common}function readPages(buf,i,size){for(var pages=[],text=readNameNT(buf,i),len=text.length+1,c=0;c<size/len;c++){pages[c]=buf.slice(i,i+text.length).toString("utf8");i+=len}return pages}function readChars(buf,i,blockSize){for(var chars=[],c=0;c<blockSize/20;c++){var char={},off=20*c;char.id=buf.readUInt32LE(i+0+off);char.x=buf.readUInt16LE(i+4+off);char.y=buf.readUInt16LE(i+6+off);char.width=buf.readUInt16LE(i+8+off);char.height=buf.readUInt16LE(i+10+off);char.xoffset=buf.readInt16LE(i+12+off);char.yoffset=buf.readInt16LE(i+14+off);char.xadvance=buf.readInt16LE(i+16+off);char.page=buf.readUInt8(i+18+off);char.chnl=buf.readUInt8(i+19+off);chars[c]=char}return chars}function readKernings(buf,i,blockSize){for(var kernings=[],c=0;c<blockSize/10;c++){var kern={},off=10*c;kern.first=buf.readUInt32LE(i+0+off);kern.second=buf.readUInt32LE(i+4+off);kern.amount=buf.readInt16LE(i+8+off);kernings[c]=kern}return kernings}function readNameNT(buf,offset){var pos=offset;for(;pos<buf.length;pos++){if(0===buf[pos])break}return buf.slice(offset,pos)}function readStringNT(buf,offset){return readNameNT(buf,offset).toString("utf8")}},{}],28:[function(_dereq_,module){var parseAttributes=_dereq_("./parse-attribs"),parseFromString=_dereq_("xml-parse-from-string"),NAME_MAP={scaleh:"scaleH",scalew:"scaleW",stretchh:"stretchH",lineheight:"lineHeight",alphachnl:"alphaChnl",redchnl:"redChnl",greenchnl:"greenChnl",bluechnl:"blueChnl"};module.exports=function(data){data=data.toString();var xmlRoot=parseFromString(data),output={pages:[],chars:[],kernings:[]};["info","common"].forEach(function(key){var element=xmlRoot.getElementsByTagName(key)[0];if(element)output[key]=parseAttributes(getAttribs(element))});var pageRoot=xmlRoot.getElementsByTagName("pages")[0];if(!pageRoot)throw new Error("malformed file -- no <pages> element");for(var pages=pageRoot.getElementsByTagName("page"),i=0;i<pages.length;i++){var p=pages[i],id=parseInt(p.getAttribute("id"),10),file=p.getAttribute("file");if(isNaN(id))throw new Error("malformed file -- page \"id\" attribute is NaN");if(!file)throw new Error("malformed file -- needs page \"file\" attribute");output.pages[parseInt(id,10)]=file}["chars","kernings"].forEach(function(key){var element=xmlRoot.getElementsByTagName(key)[0];if(!element)return;for(var childTag=key.substring(0,key.length-1),children=element.getElementsByTagName(childTag),i=0,child;i<children.length;i++){child=children[i];output[key].push(parseAttributes(getAttribs(child)))}});return output};function getAttribs(element){var attribs=getAttribList(element);return attribs.reduce(function(dict,attrib){var key=mapName(attrib.nodeName);dict[key]=attrib.nodeValue;return dict},{})}function getAttribList(element){for(var attribs=[],i=0;i<element.attributes.length;i++){attribs.push(element.attributes[i])}return attribs}function mapName(nodeName){return NAME_MAP[nodeName.toLowerCase()]||nodeName}},{"./parse-attribs":29,"xml-parse-from-string":49}],29:[function(_dereq_,module){var GLYPH_DESIGNER_ERROR="chasrset";module.exports=function(obj){if(GLYPH_DESIGNER_ERROR in obj){obj.charset=obj[GLYPH_DESIGNER_ERROR];delete obj[GLYPH_DESIGNER_ERROR]}for(var k in obj){if("face"===k||"charset"===k)continue;else if("padding"===k||"spacing"===k)obj[k]=parseIntList(obj[k]);else obj[k]=parseInt(obj[k],10)}return obj};function parseIntList(data){return data.split(",").map(function(val){return parseInt(val,10)})}},{}],30:[function(_dereq_,module){var trim=_dereq_("trim"),forEach=_dereq_("for-each"),isArray=function(arg){return"[object Array]"===Object.prototype.toString.call(arg)};module.exports=function(headers){if(!headers)return{};var result={};forEach(trim(headers).split("\n"),function(row){var index=row.indexOf(":"),key=trim(row.slice(0,index)).toLowerCase(),value=trim(row.slice(index+1));if("undefined"===typeof result[key]){result[key]=value}else if(isArray(result[key])){result[key].push(value)}else{result[key]=[result[key],value]}});return result}},{"for-each":14,trim:45}],31:[function(_dereq_,module){(function(global){var performance=global.performance||{},present=function(){var names=["now","webkitNow","msNow","mozNow","oNow"];while(names.length){var name=names.shift();if(name in performance){return performance[name].bind(performance)}}var dateNow=Date.now||function(){return new Date().getTime()},navigationStart=(performance.timing||{}).navigationStart||dateNow();return function(){return dateNow()-navigationStart}}();present.performanceNow=performance.now;present.noConflict=function(){performance.now=present.performanceNow};present.conflict=function(){performance.now=present};present.conflict();module.exports=present}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],32:[function(_dereq_,module){var process=module.exports={},cachedSetTimeout,cachedClearTimeout;function defaultSetTimout(){throw new Error("setTimeout has not been defined")}function defaultClearTimeout(){throw new Error("clearTimeout has not been defined")}(function(){try{if("function"===typeof setTimeout){cachedSetTimeout=setTimeout}else{cachedSetTimeout=defaultSetTimout}}catch(e){cachedSetTimeout=defaultSetTimout}try{if("function"===typeof clearTimeout){cachedClearTimeout=clearTimeout}else{cachedClearTimeout=defaultClearTimeout}}catch(e){cachedClearTimeout=defaultClearTimeout}})();function runTimeout(fun){if(cachedSetTimeout===setTimeout){return setTimeout(fun,0)}if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout){cachedSetTimeout=setTimeout;return setTimeout(fun,0)}try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}function runClearTimeout(marker){if(cachedClearTimeout===clearTimeout){return clearTimeout(marker)}if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout){cachedClearTimeout=clearTimeout;return clearTimeout(marker)}try{return cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}var queue=[],draining=!1,currentQueue,queueIndex=-1;function cleanUpNextTick(){if(!draining||!currentQueue){return}draining=!1;if(currentQueue.length){queue=currentQueue.concat(queue)}else{queueIndex=-1}if(queue.length){drainQueue()}}function drainQueue(){if(draining){return}var timeout=runTimeout(cleanUpNextTick);draining=!0;var len=queue.length;while(len){currentQueue=queue;queue=[];while(++queueIndex<len){if(currentQueue){currentQueue[queueIndex].run()}}queueIndex=-1;len=queue.length}currentQueue=null;draining=!1;runClearTimeout(timeout)}process.nextTick=function(fun){var args=Array(arguments.length-1);if(1<arguments.length){for(var i=1;i<arguments.length;i++){args[i-1]=arguments[i]}}queue.push(new Item(fun,args));if(1===queue.length&&!draining){runTimeout(drainQueue)}};function Item(fun,array){this.fun=fun;this.array=array}Item.prototype.run=function(){this.fun.apply(null,this.array)};process.title="browser";process.browser=!0;process.env={};process.argv=[];process.version="";process.versions={};function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.prependListener=noop;process.prependOnceListener=noop;process.listeners=function(){return[]};process.binding=function(){throw new Error("process.binding is not supported")};process.cwd=function(){return"/"};process.chdir=function(){throw new Error("process.chdir is not supported")};process.umask=function(){return 0}},{}],33:[function(_dereq_,module){(function(root){var setTimeoutFunc=setTimeout,asap="function"===typeof setImmediate&&setImmediate||function(fn){setTimeoutFunc(fn,1)};function bind(fn,thisArg){return function(){fn.apply(thisArg,arguments)}}var isArray=Array.isArray||function(value){return"[object Array]"===Object.prototype.toString.call(value)};function Promise(fn){if("object"!==babelHelpers.typeof(this))throw new TypeError("Promises must be constructed via new");if("function"!==typeof fn)throw new TypeError("not a function");this._state=null;this._value=null;this._deferreds=[];doResolve(fn,bind(resolve,this),bind(reject,this))}function handle(deferred){var me=this;if(null===this._state){this._deferreds.push(deferred);return}asap(function(){var cb=me._state?deferred.onFulfilled:deferred.onRejected;if(null===cb){(me._state?deferred.resolve:deferred.reject)(me._value);return}var ret;try{ret=cb(me._value)}catch(e){deferred.reject(e);return}deferred.resolve(ret)})}function resolve(newValue){try{if(newValue===this)throw new TypeError("A promise cannot be resolved with itself.");if(newValue&&("object"===babelHelpers.typeof(newValue)||"function"===typeof newValue)){var then=newValue.then;if("function"===typeof then){doResolve(bind(then,newValue),bind(resolve,this),bind(reject,this));return}}this._state=!0;this._value=newValue;finale.call(this)}catch(e){reject.call(this,e)}}function reject(newValue){this._state=!1;this._value=newValue;finale.call(this)}function finale(){for(var i=0,len=this._deferreds.length;i<len;i++){handle.call(this,this._deferreds[i])}this._deferreds=null}function Handler(onFulfilled,onRejected,resolve,reject){this.onFulfilled="function"===typeof onFulfilled?onFulfilled:null;this.onRejected="function"===typeof onRejected?onRejected:null;this.resolve=resolve;this.reject=reject}function doResolve(fn,onFulfilled,onRejected){var done=!1;try{fn(function(value){if(done)return;done=!0;onFulfilled(value)},function(reason){if(done)return;done=!0;onRejected(reason)})}catch(ex){if(done)return;done=!0;onRejected(ex)}}Promise.prototype["catch"]=function(onRejected){return this.then(null,onRejected)};Promise.prototype.then=function(onFulfilled,onRejected){var me=this;return new Promise(function(resolve,reject){handle.call(me,new Handler(onFulfilled,onRejected,resolve,reject))})};Promise.all=function(){var args=Array.prototype.slice.call(1===arguments.length&&isArray(arguments[0])?arguments[0]:arguments);return new Promise(function(resolve,reject){if(0===args.length)return resolve([]);var remaining=args.length;function res(i,val){try{if(val&&("object"===babelHelpers.typeof(val)||"function"===typeof val)){var then=val.then;if("function"===typeof then){then.call(val,function(val){res(i,val)},reject);return}}args[i]=val;if(0===--remaining){resolve(args)}}catch(ex){reject(ex)}}for(var i=0;i<args.length;i++){res(i,args[i])}})};Promise.resolve=function(value){if(value&&"object"===babelHelpers.typeof(value)&&value.constructor===Promise){return value}return new Promise(function(resolve){resolve(value)})};Promise.reject=function(value){return new Promise(function(resolve,reject){reject(value)})};Promise.race=function(values){return new Promise(function(resolve,reject){for(var i=0,len=values.length;i<len;i++){values[i].then(resolve,reject)}})};Promise._setImmediateFn=function(fn){asap=fn};if("undefined"!==typeof module&&module.exports){module.exports=Promise}else if(!root.Promise){root.Promise=Promise}})(this)},{}],34:[function(_dereq_,module){var dtype=_dereq_("dtype"),anArray=_dereq_("an-array"),isBuffer=_dereq_("is-buffer"),CW=[0,2,3],CCW=[2,1,3];module.exports=function(array,opt){if(!array||!(anArray(array)||isBuffer(array))){opt=array||{};array=null}if("number"===typeof opt)opt={count:opt};else opt=opt||{};for(var type="string"===typeof opt.type?opt.type:"uint16",count="number"===typeof opt.count?opt.count:1,start=opt.start||0,dir=!1!==opt.clockwise?CW:CCW,a=dir[0],b=dir[1],c=dir[2],numIndices=6*count,indices=array||new(dtype(type))(numIndices),i=0,j=0,x;i<numIndices;i+=6,j+=4){x=i+start;indices[x+0]=j+0;indices[x+1]=j+1;indices[x+2]=j+2;indices[x+3]=j+a;indices[x+4]=j+b;indices[x+5]=j+c}return indices}},{"an-array":2,dtype:12,"is-buffer":18}],35:[function(_dereq_,module){function parse(raw,opts){opts=opts||{};var preserveNumbers=opts.preserveNumbers,obj={};getKeyValueChunks(raw).map(function trim(s){return s.trim()}).filter(Boolean).forEach(function(item){var pos=item.indexOf(":"),key=item.substr(0,pos).trim(),val=item.substr(pos+1).trim();if(preserveNumbers&&isNumeric(val)){val=+val}obj[key]=val});return obj}function isNumeric(n){return!isNaN(parseFloat(n))&&isFinite(n)}function getKeyValueChunks(raw){var chunks=[],offset=0,hasUnclosedUrl=/url\([^\)]+$/,chunk="",nextSplit;while(offset<raw.length){nextSplit=raw.indexOf(";",offset);if(-1===nextSplit){nextSplit=raw.length}chunk+=raw.substring(offset,nextSplit);if(hasUnclosedUrl.test(chunk)){chunk+=";";offset=nextSplit+1;continue}chunks.push(chunk);chunk="";offset=nextSplit+1}return chunks}function stringify(obj){return Object.keys(obj).map(function(key){return key+":"+obj[key]}).join(";")}module.exports.parse=parse;module.exports.stringify=stringify;module.exports.normalize=function(str,opts){return stringify(parse(str,opts))}},{}],36:[function(_dereq_,module){var createLayout=_dereq_("layout-bmfont-text"),inherits=_dereq_("inherits"),createIndices=_dereq_("quad-indices"),buffer=_dereq_("three-buffer-vertex-data"),assign=_dereq_("object-assign"),vertices=_dereq_("./lib/vertices"),utils=_dereq_("./lib/utils"),Base=THREE.BufferGeometry;module.exports=function(opt){return new TextGeometry(opt)};function TextGeometry(opt){Base.call(this);if("string"===typeof opt){opt={text:opt}}this._opt=assign({},opt);if(opt)this.update(opt)}inherits(TextGeometry,Base);TextGeometry.prototype.update=function(opt){if("string"===typeof opt){opt={text:opt}}opt=assign({},this._opt,opt);if(!opt.font){throw new TypeError("must specify a { font } in options")}this.layout=createLayout(opt);var flipY=!1!==opt.flipY,font=opt.font,texWidth=font.common.scaleW,texHeight=font.common.scaleH,glyphs=this.layout.glyphs.filter(function(glyph){var bitmap=glyph.data;return 0<bitmap.width*bitmap.height});this.visibleGlyphs=glyphs;var positions=vertices.positions(glyphs),uvs=vertices.uvs(glyphs,texWidth,texHeight,flipY),indices=createIndices({clockwise:!0,type:"uint16",count:glyphs.length});buffer.index(this,indices,1,"uint16");buffer.attr(this,"position",positions,2);buffer.attr(this,"uv",uvs,2);if(!opt.multipage&&"page"in this.attributes){this.removeAttribute("page")}else if(opt.multipage){var pages=vertices.pages(glyphs);buffer.attr(this,"page",pages,1)}};TextGeometry.prototype.computeBoundingSphere=function(){if(null===this.boundingSphere){this.boundingSphere=new THREE.Sphere}var positions=this.attributes.position.array,itemSize=this.attributes.position.itemSize;if(!positions||!itemSize||2>positions.length){this.boundingSphere.radius=0;this.boundingSphere.center.set(0,0,0);return}utils.computeSphere(positions,this.boundingSphere);if(isNaN(this.boundingSphere.radius)){console.error("THREE.BufferGeometry.computeBoundingSphere(): "+"Computed radius is NaN. The "+"\"position\" attribute is likely to have NaN values.")}};TextGeometry.prototype.computeBoundingBox=function(){if(null===this.boundingBox){this.boundingBox=new THREE.Box3}var bbox=this.boundingBox,positions=this.attributes.position.array,itemSize=this.attributes.position.itemSize;if(!positions||!itemSize||2>positions.length){bbox.makeEmpty();return}utils.computeBox(positions,bbox)}},{"./lib/utils":37,"./lib/vertices":38,inherits:17,"layout-bmfont-text":22,"object-assign":25,"quad-indices":34,"three-buffer-vertex-data":39}],37:[function(_dereq_,module){var itemSize=2,box={min:[0,0],max:[0,0]};function bounds(positions){var count=positions.length/itemSize;box.min[0]=positions[0];box.min[1]=positions[1];box.max[0]=positions[0];box.max[1]=positions[1];for(var i=0;i<count;i++){var x=positions[i*itemSize+0],y=positions[i*itemSize+1];box.min[0]=_Mathmin(x,box.min[0]);box.min[1]=_Mathmin(y,box.min[1]);box.max[0]=_Mathmax(x,box.max[0]);box.max[1]=_Mathmax(y,box.max[1])}}module.exports.computeBox=function(positions,output){bounds(positions);output.min.set(box.min[0],box.min[1],0);output.max.set(box.max[0],box.max[1],0)};module.exports.computeSphere=function(positions,output){bounds(positions);var minX=box.min[0],minY=box.min[1],maxX=box.max[0],maxY=box.max[1],width=maxX-minX,height=maxY-minY,length=_Mathsqrt(width*width+height*height);output.center.set(minX+width/2,minY+height/2,0);output.radius=length/2}},{}],38:[function(_dereq_,module){module.exports.pages=function pages(glyphs){var pages=new Float32Array(1*(4*glyphs.length)),i=0;glyphs.forEach(function(glyph){var id=glyph.data.page||0;pages[i++]=id;pages[i++]=id;pages[i++]=id;pages[i++]=id});return pages};module.exports.uvs=function uvs(glyphs,texWidth,texHeight,flipY){var uvs=new Float32Array(2*(4*glyphs.length)),i=0;glyphs.forEach(function(glyph){var bitmap=glyph.data,bw=bitmap.x+bitmap.width,bh=bitmap.y+bitmap.height,u0=bitmap.x/texWidth,v1=bitmap.y/texHeight,u1=bw/texWidth,v0=bh/texHeight;if(flipY){v1=(texHeight-bitmap.y)/texHeight;v0=(texHeight-bh)/texHeight}uvs[i++]=u0;uvs[i++]=v1;uvs[i++]=u0;uvs[i++]=v0;uvs[i++]=u1;uvs[i++]=v0;uvs[i++]=u1;uvs[i++]=v1});return uvs};module.exports.positions=function positions(glyphs){var positions=new Float32Array(2*(4*glyphs.length)),i=0;glyphs.forEach(function(glyph){var bitmap=glyph.data,x=glyph.position[0]+bitmap.xoffset,y=glyph.position[1]+bitmap.yoffset,w=bitmap.width,h=bitmap.height;positions[i++]=x;positions[i++]=y;positions[i++]=x;positions[i++]=y+h;positions[i++]=x+w;positions[i++]=y+h;positions[i++]=x+w;positions[i++]=y});return positions}},{}],39:[function(_dereq_,module){var flatten=_dereq_("flatten-vertex-data"),warned=!1;module.exports.attr=function(geometry,key,data,itemSize,dtype){if("number"!==typeof itemSize)itemSize=3;if("string"!==typeof dtype)dtype="float32";if(Array.isArray(data)&&Array.isArray(data[0])&&data[0].length!==itemSize){throw new Error("Nested vertex array has unexpected size; expected "+itemSize+" but found "+data[0].length)}var attrib=geometry.getAttribute(key),newAttrib=updateAttribute(attrib,data,itemSize,dtype);if(newAttrib){geometry.addAttribute(key,newAttrib)}};module.exports.index=function(geometry,data,itemSize,dtype){if("number"!==typeof itemSize)itemSize=1;if("string"!==typeof dtype)dtype="uint16";var isR69=!geometry.index&&"function"!==typeof geometry.setIndex,attrib=isR69?geometry.getAttribute("index"):geometry.index,newAttrib=updateAttribute(attrib,data,itemSize,dtype);if(newAttrib){if(isR69)geometry.addAttribute("index",newAttrib);else geometry.index=newAttrib}};function updateAttribute(attrib,data,itemSize,dtype){data=data||[];if(!attrib||rebuildAttribute(attrib,data,itemSize)){data=flatten(data,dtype);var needsNewBuffer=attrib&&"function"!==typeof attrib.setArray;if(!attrib||needsNewBuffer){if(needsNewBuffer&&!warned){warned=!0;console.warn(["A WebGL buffer is being updated with a new size or itemSize, ","however this version of ThreeJS only supports fixed-size buffers.","\nThe old buffer may still be kept in memory.\n","To avoid memory leaks, it is recommended that you dispose ","your geometries and create new ones, or update to ThreeJS r82 or newer.\n","See here for discussion:\n","https://github.com/mrdoob/three.js/pull/9631"].join(""))}attrib=new THREE.BufferAttribute(data,itemSize)}attrib.itemSize=itemSize;attrib.needsUpdate=!0;if("function"===typeof attrib.setArray){attrib.setArray(data)}return attrib}else{flatten(data,attrib.array);attrib.needsUpdate=!0;return null}}function rebuildAttribute(attrib,data,itemSize){if(attrib.itemSize!==itemSize)return!0;if(!attrib.array)return!0;var attribLength=attrib.array.length;if(Array.isArray(data)&&Array.isArray(data[0])){return attribLength!==data.length*itemSize}else{return attribLength!==data.length}return!1}},{"flatten-vertex-data":13}],40:[function(_dereq_,module,exports){(function(global,factory){"object"===babelHelpers.typeof(exports)&&"undefined"!==typeof module?factory(exports):"function"===typeof define&&define.amd?define(["exports"],factory):factory(global.THREE={})})(this,function(exports){"use strict";var _Mathatan=Math.atan2,_Mathceil=Math.ceil,_NumberisInteger=Number.isInteger,_NumberEPSILON=Number.EPSILON;if(_NumberEPSILON===void 0){_NumberEPSILON=2.220446049250313e-16}if(_NumberisInteger===void 0){_NumberisInteger=function(value){return"number"===typeof value&&isFinite(value)&&_Mathfloor(value)===value}}if(_Mathsign===void 0){_Mathsign=function(x){return 0>x?-1:0<x?1:+x}}if(!1==="name"in Function.prototype){Object.defineProperty(Function.prototype,"name",{get:function get(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}})}if(Object.assign===void 0){(function(){Object.assign=function(target){if(target===void 0||null===target){throw new TypeError("Cannot convert undefined or null to object")}for(var output=Object(target),index=1,source;index<arguments.length;index++){source=arguments[index];if(source!==void 0&&null!==source){for(var nextKey in source){if(Object.prototype.hasOwnProperty.call(source,nextKey)){output[nextKey]=source[nextKey]}}}}return output}})()}function EventDispatcher(){}Object.assign(EventDispatcher.prototype,{addEventListener:function addEventListener(type,listener){if(this._listeners===void 0)this._listeners={};var listeners=this._listeners;if(listeners[type]===void 0){listeners[type]=[]}if(-1===listeners[type].indexOf(listener)){listeners[type].push(listener)}},hasEventListener:function hasEventListener(type,listener){if(this._listeners===void 0)return!1;var listeners=this._listeners;return listeners[type]!==void 0&&-1!==listeners[type].indexOf(listener)},removeEventListener:function removeEventListener(type,listener){if(this._listeners===void 0)return;var listeners=this._listeners,listenerArray=listeners[type];if(listenerArray!==void 0){var index=listenerArray.indexOf(listener);if(-1!==index){listenerArray.splice(index,1)}}},dispatchEvent:function dispatchEvent(event){if(this._listeners===void 0)return;var listeners=this._listeners,listenerArray=listeners[event.type];if(listenerArray!==void 0){event.target=this;for(var array=listenerArray.slice(0),i=0,l=array.length;i<l;i++){array[i].call(this,event)}}}});var REVISION="90",CullFaceNone=0,CullFaceBack=1,CullFaceFront=2,PCFShadowMap=1,PCFSoftShadowMap=2,FrontSide=0,BackSide=1,DoubleSide=2,FlatShading=1,NoColors=0,FaceColors=1,VertexColors=2,NoBlending=0,NormalBlending=1,AdditiveBlending=2,SubtractiveBlending=3,MultiplyBlending=4,CustomBlending=5,AddEquation=100,SubtractEquation=101,ReverseSubtractEquation=102,MinEquation=103,MaxEquation=104,ZeroFactor=200,OneFactor=201,SrcColorFactor=202,OneMinusSrcColorFactor=203,SrcAlphaFactor=204,OneMinusSrcAlphaFactor=205,DstAlphaFactor=206,OneMinusDstAlphaFactor=207,DstColorFactor=208,OneMinusDstColorFactor=209,SrcAlphaSaturateFactor=210,NeverDepth=0,AlwaysDepth=1,LessDepth=2,LessEqualDepth=3,EqualDepth=4,GreaterEqualDepth=5,GreaterDepth=6,NotEqualDepth=7,MultiplyOperation=0,MixOperation=1,AddOperation=2,NoToneMapping=0,LinearToneMapping=1,ReinhardToneMapping=2,Uncharted2ToneMapping=3,CineonToneMapping=4,UVMapping=300,CubeReflectionMapping=301,CubeRefractionMapping=302,EquirectangularReflectionMapping=303,EquirectangularRefractionMapping=304,SphericalReflectionMapping=305,CubeUVReflectionMapping=306,CubeUVRefractionMapping=307,RepeatWrapping=1e3,ClampToEdgeWrapping=1001,MirroredRepeatWrapping=1002,NearestFilter=1003,NearestMipMapNearestFilter=1004,NearestMipMapLinearFilter=1005,LinearFilter=1006,LinearMipMapNearestFilter=1007,LinearMipMapLinearFilter=1008,UnsignedByteType=1009,ByteType=1010,ShortType=1011,UnsignedShortType=1012,IntType=1013,UnsignedIntType=1014,FloatType=1015,HalfFloatType=1016,UnsignedShort4444Type=1017,UnsignedShort5551Type=1018,UnsignedShort565Type=1019,UnsignedInt248Type=1020,AlphaFormat=1021,RGBFormat=1022,RGBAFormat=1023,LuminanceFormat=1024,LuminanceAlphaFormat=1025,DepthFormat=1026,DepthStencilFormat=1027,RGB_S3TC_DXT1_Format=33776,RGBA_S3TC_DXT1_Format=33777,RGBA_S3TC_DXT3_Format=33778,RGBA_S3TC_DXT5_Format=33779,RGB_PVRTC_4BPPV1_Format=35840,RGB_PVRTC_2BPPV1_Format=35841,RGBA_PVRTC_4BPPV1_Format=35842,RGBA_PVRTC_2BPPV1_Format=35843,RGB_ETC1_Format=36196,RGBA_ASTC_4x4_Format=37808,RGBA_ASTC_5x4_Format=37809,RGBA_ASTC_5x5_Format=37810,RGBA_ASTC_6x5_Format=37811,RGBA_ASTC_6x6_Format=37812,RGBA_ASTC_8x5_Format=37813,RGBA_ASTC_8x6_Format=37814,RGBA_ASTC_8x8_Format=37815,RGBA_ASTC_10x5_Format=37816,RGBA_ASTC_10x6_Format=37817,RGBA_ASTC_10x8_Format=37818,RGBA_ASTC_10x10_Format=37819,RGBA_ASTC_12x10_Format=37820,RGBA_ASTC_12x12_Format=37821,LoopOnce=2200,LoopRepeat=2201,LoopPingPong=2202,InterpolateDiscrete=2300,InterpolateLinear=2301,InterpolateSmooth=2302,ZeroCurvatureEnding=2400,ZeroSlopeEnding=2401,WrapAroundEnding=2402,TrianglesDrawMode=0,TriangleStripDrawMode=1,TriangleFanDrawMode=2,LinearEncoding=3e3,sRGBEncoding=3001,GammaEncoding=3007,RGBEEncoding=3002,RGBM7Encoding=3004,RGBM16Encoding=3005,RGBDEncoding=3006,BasicDepthPacking=3200,RGBADepthPacking=3201,_Math={DEG2RAD:_MathPI/180,RAD2DEG:180/_MathPI,generateUUID:function(){for(var lut=[],i=0;256>i;i++){lut[i]=(16>i?"0":"")+i.toString(16).toUpperCase()}return function(){var d0=0|4294967295*Math.random(),d1=0|4294967295*Math.random(),d2=0|4294967295*Math.random(),d3=0|4294967295*Math.random();return lut[255&d0]+lut[255&d0>>8]+lut[255&d0>>16]+lut[255&d0>>24]+"-"+lut[255&d1]+lut[255&d1>>8]+"-"+lut[64|15&d1>>16]+lut[255&d1>>24]+"-"+lut[128|63&d2]+lut[255&d2>>8]+"-"+lut[255&d2>>16]+lut[255&d2>>24]+lut[255&d3]+lut[255&d3>>8]+lut[255&d3>>16]+lut[255&d3>>24]}}(),clamp:function clamp(value,min,max){return _Mathmax(min,_Mathmin(max,value))},euclideanModulo:function euclideanModulo(n,m){return(n%m+m)%m},mapLinear:function mapLinear(x,a1,a2,b1,b2){return b1+(x-a1)*(b2-b1)/(a2-a1)},lerp:function lerp(x,y,t){return(1-t)*x+t*y},smoothstep:function smoothstep(x,min,max){if(x<=min)return 0;if(x>=max)return 1;x=(x-min)/(max-min);return x*x*(3-2*x)},smootherstep:function smootherstep(x,min,max){if(x<=min)return 0;if(x>=max)return 1;x=(x-min)/(max-min);return x*x*x*(x*(6*x-15)+10)},randInt:function randInt(low,high){return low+_Mathfloor(Math.random()*(high-low+1))},randFloat:function randFloat(low,high){return low+Math.random()*(high-low)},randFloatSpread:function randFloatSpread(range){return range*(.5-Math.random())},degToRad:function degToRad(degrees){return degrees*_Math.DEG2RAD},radToDeg:function radToDeg(radians){return radians*_Math.RAD2DEG},isPowerOfTwo:function isPowerOfTwo(value){return 0===(value&value-1)&&0!==value},ceilPowerOfTwo:function ceilPowerOfTwo(value){return _Mathpow(2,_Mathceil(_Mathlog(value)/_MathLN))},floorPowerOfTwo:function floorPowerOfTwo(value){return _Mathpow(2,_Mathfloor(_Mathlog(value)/_MathLN))}};function Vector2(x,y){this.x=x||0;this.y=y||0}Object.defineProperties(Vector2.prototype,{width:{get:function get(){return this.x},set:function set(value){this.x=value}},height:{get:function get(){return this.y},set:function set(value){this.y=value}}});Object.assign(Vector2.prototype,{isVector2:!0,set:function set(x,y){this.x=x;this.y=y;return this},setScalar:function setScalar(scalar){this.x=scalar;this.y=scalar;return this},setX:function setX(x){this.x=x;return this},setY:function setY(y){this.y=y;return this},setComponent:function setComponent(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;default:throw new Error("index is out of range: "+index);}return this},getComponent:function getComponent(index){switch(index){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+index);}},clone:function clone(){return new this.constructor(this.x,this.y)},copy:function copy(v){this.x=v.x;this.y=v.y;return this},add:function add(v,w){if(w!==void 0){console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;return this},addScalar:function addScalar(s){this.x+=s;this.y+=s;return this},addVectors:function addVectors(a,b){this.x=a.x+b.x;this.y=a.y+b.y;return this},addScaledVector:function addScaledVector(v,s){this.x+=v.x*s;this.y+=v.y*s;return this},sub:function sub(v,w){if(w!==void 0){console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;return this},subScalar:function subScalar(s){this.x-=s;this.y-=s;return this},subVectors:function subVectors(a,b){this.x=a.x-b.x;this.y=a.y-b.y;return this},multiply:function multiply(v){this.x*=v.x;this.y*=v.y;return this},multiplyScalar:function multiplyScalar(scalar){this.x*=scalar;this.y*=scalar;return this},divide:function divide(v){this.x/=v.x;this.y/=v.y;return this},divideScalar:function divideScalar(scalar){return this.multiplyScalar(1/scalar)},applyMatrix3:function applyMatrix3(m){var x=this.x,y=this.y,e=m.elements;this.x=e[0]*x+e[3]*y+e[6];this.y=e[1]*x+e[4]*y+e[7];return this},min:function min(v){this.x=_Mathmin(this.x,v.x);this.y=_Mathmin(this.y,v.y);return this},max:function max(v){this.x=_Mathmax(this.x,v.x);this.y=_Mathmax(this.y,v.y);return this},clamp:function clamp(min,max){this.x=_Mathmax(min.x,_Mathmin(max.x,this.x));this.y=_Mathmax(min.y,_Mathmin(max.y,this.y));return this},clampScalar:function(){var min=new Vector2,max=new Vector2;return function(minVal,maxVal){min.set(minVal,minVal);max.set(maxVal,maxVal);return this.clamp(min,max)}}(),clampLength:function clampLength(min,max){var length=this.length();return this.divideScalar(length||1).multiplyScalar(_Mathmax(min,_Mathmin(max,length)))},floor:function floor(){this.x=_Mathfloor(this.x);this.y=_Mathfloor(this.y);return this},ceil:function ceil(){this.x=_Mathceil(this.x);this.y=_Mathceil(this.y);return this},round:function round(){this.x=_Mathround(this.x);this.y=_Mathround(this.y);return this},roundToZero:function roundToZero(){this.x=0>this.x?_Mathceil(this.x):_Mathfloor(this.x);this.y=0>this.y?_Mathceil(this.y):_Mathfloor(this.y);return this},negate:function negate(){this.x=-this.x;this.y=-this.y;return this},dot:function dot(v){return this.x*v.x+this.y*v.y},lengthSq:function lengthSq(){return this.x*this.x+this.y*this.y},length:function length(){return _Mathsqrt(this.x*this.x+this.y*this.y)},manhattanLength:function manhattanLength(){return _Mathabs(this.x)+_Mathabs(this.y)},normalize:function normalize(){return this.divideScalar(this.length()||1)},angle:function(){var angle=_Mathatan(this.y,this.x);if(0>angle)angle+=2*_MathPI;return angle},distanceTo:function distanceTo(v){return _Mathsqrt(this.distanceToSquared(v))},distanceToSquared:function distanceToSquared(v){var dx=this.x-v.x,dy=this.y-v.y;return dx*dx+dy*dy},manhattanDistanceTo:function manhattanDistanceTo(v){return _Mathabs(this.x-v.x)+_Mathabs(this.y-v.y)},setLength:function setLength(length){return this.normalize().multiplyScalar(length)},lerp:function lerp(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;return this},lerpVectors:function lerpVectors(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)},equals:function(v){return v.x===this.x&&v.y===this.y},fromArray:function fromArray(array,offset){if(offset===void 0)offset=0;this.x=array[offset];this.y=array[offset+1];return this},toArray:function toArray(array,offset){if(array===void 0)array=[];if(offset===void 0)offset=0;array[offset]=this.x;array[offset+1]=this.y;return array},fromBufferAttribute:function fromBufferAttribute(attribute,index,offset){if(offset!==void 0){console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute().")}this.x=attribute.getX(index);this.y=attribute.getY(index);return this},rotateAround:function rotateAround(center,angle){var c=_Mathcos(angle),s=_Mathsin(angle),x=this.x-center.x,y=this.y-center.y;this.x=x*c-y*s+center.x;this.y=x*s+y*c+center.y;return this}});function Matrix4(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];if(0<arguments.length){console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}}Object.assign(Matrix4.prototype,{isMatrix4:!0,set:function set(n11,n12,n13,n14,n21,n22,n23,n24,n31,n32,n33,n34,n41,n42,n43,n44){var te=this.elements;te[0]=n11;te[4]=n12;te[8]=n13;te[12]=n14;te[1]=n21;te[5]=n22;te[9]=n23;te[13]=n24;te[2]=n31;te[6]=n32;te[10]=n33;te[14]=n34;te[3]=n41;te[7]=n42;te[11]=n43;te[15]=n44;return this},identity:function identity(){this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1);return this},clone:function clone(){return new Matrix4().fromArray(this.elements)},copy:function copy(m){var te=this.elements,me=m.elements;te[0]=me[0];te[1]=me[1];te[2]=me[2];te[3]=me[3];te[4]=me[4];te[5]=me[5];te[6]=me[6];te[7]=me[7];te[8]=me[8];te[9]=me[9];te[10]=me[10];te[11]=me[11];te[12]=me[12];te[13]=me[13];te[14]=me[14];te[15]=me[15];return this},copyPosition:function copyPosition(m){var te=this.elements,me=m.elements;te[12]=me[12];te[13]=me[13];te[14]=me[14];return this},extractBasis:function extractBasis(xAxis,yAxis,zAxis){xAxis.setFromMatrixColumn(this,0);yAxis.setFromMatrixColumn(this,1);zAxis.setFromMatrixColumn(this,2);return this},makeBasis:function makeBasis(xAxis,yAxis,zAxis){this.set(xAxis.x,yAxis.x,zAxis.x,0,xAxis.y,yAxis.y,zAxis.y,0,xAxis.z,yAxis.z,zAxis.z,0,0,0,0,1);return this},extractRotation:function(){var v1=new Vector3;return function(m){var te=this.elements,me=m.elements,scaleX=1/v1.setFromMatrixColumn(m,0).length(),scaleY=1/v1.setFromMatrixColumn(m,1).length(),scaleZ=1/v1.setFromMatrixColumn(m,2).length();te[0]=me[0]*scaleX;te[1]=me[1]*scaleX;te[2]=me[2]*scaleX;te[4]=me[4]*scaleY;te[5]=me[5]*scaleY;te[6]=me[6]*scaleY;te[8]=me[8]*scaleZ;te[9]=me[9]*scaleZ;te[10]=me[10]*scaleZ;return this}}(),makeRotationFromEuler:function makeRotationFromEuler(euler){if(!(euler&&euler.isEuler)){console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.")}var te=this.elements,x=euler.x,y=euler.y,z=euler.z,a=_Mathcos(x),b=_Mathsin(x),c=_Mathcos(y),d=_Mathsin(y),e=_Mathcos(z),f=_Mathsin(z);if("XYZ"===euler.order){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=-c*f;te[8]=d;te[1]=af+be*d;te[5]=ae-bf*d;te[9]=-b*c;te[2]=bf-ae*d;te[6]=be+af*d;te[10]=a*c}else if("YXZ"===euler.order){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce+df*b;te[4]=de*b-cf;te[8]=a*d;te[1]=a*f;te[5]=a*e;te[9]=-b;te[2]=cf*b-de;te[6]=df+ce*b;te[10]=a*c}else if("ZXY"===euler.order){var ce=c*e,cf=c*f,de=d*e,df=d*f;te[0]=ce-df*b;te[4]=-a*f;te[8]=de+cf*b;te[1]=cf+de*b;te[5]=a*e;te[9]=df-ce*b;te[2]=-a*d;te[6]=b;te[10]=a*c}else if("ZYX"===euler.order){var ae=a*e,af=a*f,be=b*e,bf=b*f;te[0]=c*e;te[4]=be*d-af;te[8]=ae*d+bf;te[1]=c*f;te[5]=bf*d+ae;te[9]=af*d-be;te[2]=-d;te[6]=b*c;te[10]=a*c}else if("YZX"===euler.order){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=bd-ac*f;te[8]=bc*f+ad;te[1]=f;te[5]=a*e;te[9]=-b*e;te[2]=-d*e;te[6]=ad*f+bc;te[10]=ac-bd*f}else if("XZY"===euler.order){var ac=a*c,ad=a*d,bc=b*c,bd=b*d;te[0]=c*e;te[4]=-f;te[8]=d*e;te[1]=ac*f+bd;te[5]=a*e;te[9]=ad*f-bc;te[2]=bc*f-ad;te[6]=b*e;te[10]=bd*f+ac}te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this},makeRotationFromQuaternion:function makeRotationFromQuaternion(q){var te=this.elements,x=q._x,y=q._y,z=q._z,w=q._w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;te[0]=1-(yy+zz);te[4]=xy-wz;te[8]=xz+wy;te[1]=xy+wz;te[5]=1-(xx+zz);te[9]=yz-wx;te[2]=xz-wy;te[6]=yz+wx;te[10]=1-(xx+yy);te[3]=0;te[7]=0;te[11]=0;te[12]=0;te[13]=0;te[14]=0;te[15]=1;return this},lookAt:function(){var x=new Vector3,y=new Vector3,z=new Vector3;return function(eye,target,up){var te=this.elements;z.subVectors(eye,target);if(0===z.lengthSq()){z.z=1}z.normalize();x.crossVectors(up,z);if(0===x.lengthSq()){if(1===_Mathabs(up.z)){z.x+=1e-4}else{z.z+=1e-4}z.normalize();x.crossVectors(up,z)}x.normalize();y.crossVectors(z,x);te[0]=x.x;te[4]=y.x;te[8]=z.x;te[1]=x.y;te[5]=y.y;te[9]=z.y;te[2]=x.z;te[6]=y.z;te[10]=z.z;return this}}(),multiply:function multiply(m,n){if(n!==void 0){console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead.");return this.multiplyMatrices(m,n)}return this.multiplyMatrices(this,m)},premultiply:function premultiply(m){return this.multiplyMatrices(m,this)},multiplyMatrices:function multiplyMatrices(a,b){var ae=a.elements,be=b.elements,te=this.elements,a11=ae[0],a12=ae[4],a13=ae[8],a14=ae[12],a21=ae[1],a22=ae[5],a23=ae[9],a24=ae[13],a31=ae[2],a32=ae[6],a33=ae[10],a34=ae[14],a41=ae[3],a42=ae[7],a43=ae[11],a44=ae[15],b11=be[0],b12=be[4],b13=be[8],b14=be[12],b21=be[1],b22=be[5],b23=be[9],b24=be[13],b31=be[2],b32=be[6],b33=be[10],b34=be[14],b41=be[3],b42=be[7],b43=be[11],b44=be[15];te[0]=a11*b11+a12*b21+a13*b31+a14*b41;te[4]=a11*b12+a12*b22+a13*b32+a14*b42;te[8]=a11*b13+a12*b23+a13*b33+a14*b43;te[12]=a11*b14+a12*b24+a13*b34+a14*b44;te[1]=a21*b11+a22*b21+a23*b31+a24*b41;te[5]=a21*b12+a22*b22+a23*b32+a24*b42;te[9]=a21*b13+a22*b23+a23*b33+a24*b43;te[13]=a21*b14+a22*b24+a23*b34+a24*b44;te[2]=a31*b11+a32*b21+a33*b31+a34*b41;te[6]=a31*b12+a32*b22+a33*b32+a34*b42;te[10]=a31*b13+a32*b23+a33*b33+a34*b43;te[14]=a31*b14+a32*b24+a33*b34+a34*b44;te[3]=a41*b11+a42*b21+a43*b31+a44*b41;te[7]=a41*b12+a42*b22+a43*b32+a44*b42;te[11]=a41*b13+a42*b23+a43*b33+a44*b43;te[15]=a41*b14+a42*b24+a43*b34+a44*b44;return this},multiplyScalar:function multiplyScalar(s){var te=this.elements;te[0]*=s;te[4]*=s;te[8]*=s;te[12]*=s;te[1]*=s;te[5]*=s;te[9]*=s;te[13]*=s;te[2]*=s;te[6]*=s;te[10]*=s;te[14]*=s;te[3]*=s;te[7]*=s;te[11]*=s;te[15]*=s;return this},applyToBufferAttribute:function(){var v1=new Vector3;return function(attribute){for(var i=0,l=attribute.count;i<l;i++){v1.x=attribute.getX(i);v1.y=attribute.getY(i);v1.z=attribute.getZ(i);v1.applyMatrix4(this);attribute.setXYZ(i,v1.x,v1.y,v1.z)}return attribute}}(),determinant:function determinant(){var te=this.elements,n11=te[0],n12=te[4],n13=te[8],n14=te[12],n21=te[1],n22=te[5],n23=te[9],n24=te[13],n31=te[2],n32=te[6],n33=te[10],n34=te[14],n41=te[3],n42=te[7],n43=te[11],n44=te[15];return n41*(+n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34)+n42*(+n11*n23*n34-n11*n24*n33+n14*n21*n33-n13*n21*n34+n13*n24*n31-n14*n23*n31)+n43*(+n11*n24*n32-n11*n22*n34-n14*n21*n32+n12*n21*n34+n14*n22*n31-n12*n24*n31)+n44*(-n13*n22*n31-n11*n23*n32+n11*n22*n33+n13*n21*n32-n12*n21*n33+n12*n23*n31)},transpose:function transpose(){var te=this.elements,tmp;tmp=te[1];te[1]=te[4];te[4]=tmp;tmp=te[2];te[2]=te[8];te[8]=tmp;tmp=te[6];te[6]=te[9];te[9]=tmp;tmp=te[3];te[3]=te[12];te[12]=tmp;tmp=te[7];te[7]=te[13];te[13]=tmp;tmp=te[11];te[11]=te[14];te[14]=tmp;return this},setPosition:function setPosition(v){var te=this.elements;te[12]=v.x;te[13]=v.y;te[14]=v.z;return this},getInverse:function getInverse(m,throwOnDegenerate){var te=this.elements,me=m.elements,n11=me[0],n21=me[1],n31=me[2],n41=me[3],n12=me[4],n22=me[5],n32=me[6],n42=me[7],n13=me[8],n23=me[9],n33=me[10],n43=me[11],n14=me[12],n24=me[13],n34=me[14],n44=me[15],t11=n23*n34*n42-n24*n33*n42+n24*n32*n43-n22*n34*n43-n23*n32*n44+n22*n33*n44,t12=n14*n33*n42-n13*n34*n42-n14*n32*n43+n12*n34*n43+n13*n32*n44-n12*n33*n44,t13=n13*n24*n42-n14*n23*n42+n14*n22*n43-n12*n24*n43-n13*n22*n44+n12*n23*n44,t14=n14*n23*n32-n13*n24*n32-n14*n22*n33+n12*n24*n33+n13*n22*n34-n12*n23*n34,det=n11*t11+n21*t12+n31*t13+n41*t14;if(0===det){var msg="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(!0===throwOnDegenerate){throw new Error(msg)}else{console.warn(msg)}return this.identity()}var detInv=1/det;te[0]=t11*detInv;te[1]=(n24*n33*n41-n23*n34*n41-n24*n31*n43+n21*n34*n43+n23*n31*n44-n21*n33*n44)*detInv;te[2]=(n22*n34*n41-n24*n32*n41+n24*n31*n42-n21*n34*n42-n22*n31*n44+n21*n32*n44)*detInv;te[3]=(n23*n32*n41-n22*n33*n41-n23*n31*n42+n21*n33*n42+n22*n31*n43-n21*n32*n43)*detInv;te[4]=t12*detInv;te[5]=(n13*n34*n41-n14*n33*n41+n14*n31*n43-n11*n34*n43-n13*n31*n44+n11*n33*n44)*detInv;te[6]=(n14*n32*n41-n12*n34*n41-n14*n31*n42+n11*n34*n42+n12*n31*n44-n11*n32*n44)*detInv;te[7]=(n12*n33*n41-n13*n32*n41+n13*n31*n42-n11*n33*n42-n12*n31*n43+n11*n32*n43)*detInv;te[8]=t13*detInv;te[9]=(n14*n23*n41-n13*n24*n41-n14*n21*n43+n11*n24*n43+n13*n21*n44-n11*n23*n44)*detInv;te[10]=(n12*n24*n41-n14*n22*n41+n14*n21*n42-n11*n24*n42-n12*n21*n44+n11*n22*n44)*detInv;te[11]=(n13*n22*n41-n12*n23*n41-n13*n21*n42+n11*n23*n42+n12*n21*n43-n11*n22*n43)*detInv;te[12]=t14*detInv;te[13]=(n13*n24*n31-n14*n23*n31+n14*n21*n33-n11*n24*n33-n13*n21*n34+n11*n23*n34)*detInv;te[14]=(n14*n22*n31-n12*n24*n31-n14*n21*n32+n11*n24*n32+n12*n21*n34-n11*n22*n34)*detInv;te[15]=(n12*n23*n31-n13*n22*n31+n13*n21*n32-n11*n23*n32-n12*n21*n33+n11*n22*n33)*detInv;return this},scale:function scale(v){var te=this.elements,x=v.x,y=v.y,z=v.z;te[0]*=x;te[4]*=y;te[8]*=z;te[1]*=x;te[5]*=y;te[9]*=z;te[2]*=x;te[6]*=y;te[10]*=z;te[3]*=x;te[7]*=y;te[11]*=z;return this},getMaxScaleOnAxis:function getMaxScaleOnAxis(){var te=this.elements,scaleXSq=te[0]*te[0]+te[1]*te[1]+te[2]*te[2],scaleYSq=te[4]*te[4]+te[5]*te[5]+te[6]*te[6],scaleZSq=te[8]*te[8]+te[9]*te[9]+te[10]*te[10];return _Mathsqrt(_Mathmax(scaleXSq,scaleYSq,scaleZSq))},makeTranslation:function makeTranslation(x,y,z){this.set(1,0,0,x,0,1,0,y,0,0,1,z,0,0,0,1);return this},makeRotationX:function makeRotationX(theta){var c=_Mathcos(theta),s=_Mathsin(theta);this.set(1,0,0,0,0,c,-s,0,0,s,c,0,0,0,0,1);return this},makeRotationY:function makeRotationY(theta){var c=_Mathcos(theta),s=_Mathsin(theta);this.set(c,0,s,0,0,1,0,0,-s,0,c,0,0,0,0,1);return this},makeRotationZ:function makeRotationZ(theta){var c=_Mathcos(theta),s=_Mathsin(theta);this.set(c,-s,0,0,s,c,0,0,0,0,1,0,0,0,0,1);return this},makeRotationAxis:function makeRotationAxis(axis,angle){var c=_Mathcos(angle),s=_Mathsin(angle),t=1-c,x=axis.x,y=axis.y,z=axis.z,tx=t*x,ty=t*y;this.set(tx*x+c,tx*y-s*z,tx*z+s*y,0,tx*y+s*z,ty*y+c,ty*z-s*x,0,tx*z-s*y,ty*z+s*x,t*z*z+c,0,0,0,0,1);return this},makeScale:function makeScale(x,y,z){this.set(x,0,0,0,0,y,0,0,0,0,z,0,0,0,0,1);return this},makeShear:function makeShear(x,y,z){this.set(1,y,z,0,x,1,z,0,x,y,1,0,0,0,0,1);return this},compose:function compose(position,quaternion,scale){this.makeRotationFromQuaternion(quaternion);this.scale(scale);this.setPosition(position);return this},decompose:function(){var vector=new Vector3,matrix=new Matrix4;return function(position,quaternion,scale){var te=this.elements,sx=vector.set(te[0],te[1],te[2]).length(),sy=vector.set(te[4],te[5],te[6]).length(),sz=vector.set(te[8],te[9],te[10]).length(),det=this.determinant();if(0>det)sx=-sx;position.x=te[12];position.y=te[13];position.z=te[14];matrix.copy(this);var invSX=1/sx,invSY=1/sy,invSZ=1/sz;matrix.elements[0]*=invSX;matrix.elements[1]*=invSX;matrix.elements[2]*=invSX;matrix.elements[4]*=invSY;matrix.elements[5]*=invSY;matrix.elements[6]*=invSY;matrix.elements[8]*=invSZ;matrix.elements[9]*=invSZ;matrix.elements[10]*=invSZ;quaternion.setFromRotationMatrix(matrix);scale.x=sx;scale.y=sy;scale.z=sz;return this}}(),makePerspective:function makePerspective(left,right,top,bottom,near,far){if(far===void 0){console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.")}var te=this.elements;te[0]=2*near/(right-left);te[4]=0;te[8]=(right+left)/(right-left);te[12]=0;te[1]=0;te[5]=2*near/(top-bottom);te[9]=(top+bottom)/(top-bottom);te[13]=0;te[2]=0;te[6]=0;te[10]=-(far+near)/(far-near);te[14]=-2*far*near/(far-near);te[3]=0;te[7]=0;te[11]=-1;te[15]=0;return this},makeOrthographic:function makeOrthographic(left,right,top,bottom,near,far){var te=this.elements,w=1/(right-left),h=1/(top-bottom),p=1/(far-near);te[0]=2*w;te[4]=0;te[8]=0;te[12]=-((right+left)*w);te[1]=0;te[5]=2*h;te[9]=0;te[13]=-((top+bottom)*h);te[2]=0;te[6]=0;te[10]=-2*p;te[14]=-((far+near)*p);te[3]=0;te[7]=0;te[11]=0;te[15]=1;return this},equals:function(matrix){for(var te=this.elements,me=matrix.elements,i=0;16>i;i++){if(te[i]!==me[i])return!1}return!0},fromArray:function fromArray(array,offset){if(offset===void 0)offset=0;for(var i=0;16>i;i++){this.elements[i]=array[i+offset]}return this},toArray:function toArray(array,offset){if(array===void 0)array=[];if(offset===void 0)offset=0;var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];array[offset+9]=te[9];array[offset+10]=te[10];array[offset+11]=te[11];array[offset+12]=te[12];array[offset+13]=te[13];array[offset+14]=te[14];array[offset+15]=te[15];return array}});function Quaternion(x,y,z,w){this._x=x||0;this._y=y||0;this._z=z||0;this._w=w!==void 0?w:1}Object.assign(Quaternion,{slerp:function slerp(qa,qb,qm,t){return qm.copy(qa).slerp(qb,t)},slerpFlat:function slerpFlat(dst,dstOffset,src0,srcOffset0,src1,srcOffset1,t){var x0=src0[srcOffset0+0],y0=src0[srcOffset0+1],z0=src0[srcOffset0+2],w0=src0[srcOffset0+3],x1=src1[srcOffset1+0],y1=src1[srcOffset1+1],z1=src1[srcOffset1+2],w1=src1[srcOffset1+3];if(w0!==w1||x0!==x1||y0!==y1||z0!==z1){var s=1-t,cos=x0*x1+y0*y1+z0*z1+w0*w1,dir=0<=cos?1:-1,sqrSin=1-cos*cos;if(sqrSin>_NumberEPSILON){var sin=_Mathsqrt(sqrSin),len=_Mathatan(sin,cos*dir);s=_Mathsin(s*len)/sin;t=_Mathsin(t*len)/sin}var tDir=t*dir;x0=x0*s+x1*tDir;y0=y0*s+y1*tDir;z0=z0*s+z1*tDir;w0=w0*s+w1*tDir;if(s===1-t){var f=1/_Mathsqrt(x0*x0+y0*y0+z0*z0+w0*w0);x0*=f;y0*=f;z0*=f;w0*=f}}dst[dstOffset]=x0;dst[dstOffset+1]=y0;dst[dstOffset+2]=z0;dst[dstOffset+3]=w0}});Object.defineProperties(Quaternion.prototype,{x:{get:function get(){return this._x},set:function set(value){this._x=value;this.onChangeCallback()}},y:{get:function get(){return this._y},set:function set(value){this._y=value;this.onChangeCallback()}},z:{get:function get(){return this._z},set:function set(value){this._z=value;this.onChangeCallback()}},w:{get:function get(){return this._w},set:function set(value){this._w=value;this.onChangeCallback()}}});Object.assign(Quaternion.prototype,{set:function set(x,y,z,w){this._x=x;this._y=y;this._z=z;this._w=w;this.onChangeCallback();return this},clone:function clone(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function copy(quaternion){this._x=quaternion.x;this._y=quaternion.y;this._z=quaternion.z;this._w=quaternion.w;this.onChangeCallback();return this},setFromEuler:function setFromEuler(euler,update){if(!(euler&&euler.isEuler)){throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.")}var x=euler._x,y=euler._y,z=euler._z,order=euler.order,cos=_Mathcos,sin=_Mathsin,c1=cos(x/2),c2=cos(y/2),c3=cos(z/2),s1=sin(x/2),s2=sin(y/2),s3=sin(z/2);if("XYZ"===order){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if("YXZ"===order){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}else if("ZXY"===order){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if("ZYX"===order){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}else if("YZX"===order){this._x=s1*c2*c3+c1*s2*s3;this._y=c1*s2*c3+s1*c2*s3;this._z=c1*c2*s3-s1*s2*c3;this._w=c1*c2*c3-s1*s2*s3}else if("XZY"===order){this._x=s1*c2*c3-c1*s2*s3;this._y=c1*s2*c3-s1*c2*s3;this._z=c1*c2*s3+s1*s2*c3;this._w=c1*c2*c3+s1*s2*s3}if(!1!==update)this.onChangeCallback();return this},setFromAxisAngle:function setFromAxisAngle(axis,angle){var halfAngle=angle/2,s=_Mathsin(halfAngle);this._x=axis.x*s;this._y=axis.y*s;this._z=axis.z*s;this._w=_Mathcos(halfAngle);this.onChangeCallback();return this},setFromRotationMatrix:function setFromRotationMatrix(m){var te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10],trace=m11+m22+m33,s;if(0<trace){s=.5/_Mathsqrt(trace+1);this._w=.25/s;this._x=(m32-m23)*s;this._y=(m13-m31)*s;this._z=(m21-m12)*s}else if(m11>m22&&m11>m33){s=2*_Mathsqrt(1+m11-m22-m33);this._w=(m32-m23)/s;this._x=.25*s;this._y=(m12+m21)/s;this._z=(m13+m31)/s}else if(m22>m33){s=2*_Mathsqrt(1+m22-m11-m33);this._w=(m13-m31)/s;this._x=(m12+m21)/s;this._y=.25*s;this._z=(m23+m32)/s}else{s=2*_Mathsqrt(1+m33-m11-m22);this._w=(m21-m12)/s;this._x=(m13+m31)/s;this._y=(m23+m32)/s;this._z=.25*s}this.onChangeCallback();return this},setFromUnitVectors:function(){var v1=new Vector3,r;return function(vFrom,vTo){if(v1===void 0)v1=new Vector3;r=vFrom.dot(vTo)+1;if(r<1e-6){r=0;if(_Mathabs(vFrom.x)>_Mathabs(vFrom.z)){v1.set(-vFrom.y,vFrom.x,0)}else{v1.set(0,-vFrom.z,vFrom.y)}}else{v1.crossVectors(vFrom,vTo)}this._x=v1.x;this._y=v1.y;this._z=v1.z;this._w=r;return this.normalize()}}(),inverse:function inverse(){return this.conjugate()},conjugate:function conjugate(){this._x*=-1;this._y*=-1;this._z*=-1;this.onChangeCallback();return this},dot:function dot(v){return this._x*v._x+this._y*v._y+this._z*v._z+this._w*v._w},lengthSq:function lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function length(){return _Mathsqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function normalize(){var l=this.length();if(0===l){this._x=0;this._y=0;this._z=0;this._w=1}else{l=1/l;this._x=this._x*l;this._y=this._y*l;this._z=this._z*l;this._w=this._w*l}this.onChangeCallback();return this},multiply:function multiply(q,p){if(p!==void 0){console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead.");return this.multiplyQuaternions(q,p)}return this.multiplyQuaternions(this,q)},premultiply:function premultiply(q){return this.multiplyQuaternions(q,this)},multiplyQuaternions:function multiplyQuaternions(a,b){var qax=a._x,qay=a._y,qaz=a._z,qaw=a._w,qbx=b._x,qby=b._y,qbz=b._z,qbw=b._w;this._x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;this._y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;this._z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;this._w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;this.onChangeCallback();return this},slerp:function slerp(qb,t){if(0===t)return this;if(1===t)return this.copy(qb);var x=this._x,y=this._y,z=this._z,w=this._w,cosHalfTheta=w*qb._w+x*qb._x+y*qb._y+z*qb._z;if(0>cosHalfTheta){this._w=-qb._w;this._x=-qb._x;this._y=-qb._y;this._z=-qb._z;cosHalfTheta=-cosHalfTheta}else{this.copy(qb)}if(1<=cosHalfTheta){this._w=w;this._x=x;this._y=y;this._z=z;return this}var sinHalfTheta=_Mathsqrt(1-cosHalfTheta*cosHalfTheta);if(.001>_Mathabs(sinHalfTheta)){this._w=.5*(w+this._w);this._x=.5*(x+this._x);this._y=.5*(y+this._y);this._z=.5*(z+this._z);return this}var halfTheta=_Mathatan(sinHalfTheta,cosHalfTheta),ratioA=_Mathsin((1-t)*halfTheta)/sinHalfTheta,ratioB=_Mathsin(t*halfTheta)/sinHalfTheta;this._w=w*ratioA+this._w*ratioB;this._x=x*ratioA+this._x*ratioB;this._y=y*ratioA+this._y*ratioB;this._z=z*ratioA+this._z*ratioB;this.onChangeCallback();return this},equals:function(quaternion){return quaternion._x===this._x&&quaternion._y===this._y&&quaternion._z===this._z&&quaternion._w===this._w},fromArray:function fromArray(array,offset){if(offset===void 0)offset=0;this._x=array[offset];this._y=array[offset+1];this._z=array[offset+2];this._w=array[offset+3];this.onChangeCallback();return this},toArray:function toArray(array,offset){if(array===void 0)array=[];if(offset===void 0)offset=0;array[offset]=this._x;array[offset+1]=this._y;array[offset+2]=this._z;array[offset+3]=this._w;return array},onChange:function onChange(callback){this.onChangeCallback=callback;return this},onChangeCallback:function onChangeCallback(){}});function Vector3(x,y,z){this.x=x||0;this.y=y||0;this.z=z||0}Object.assign(Vector3.prototype,{isVector3:!0,set:function set(x,y,z){this.x=x;this.y=y;this.z=z;return this},setScalar:function setScalar(scalar){this.x=scalar;this.y=scalar;this.z=scalar;return this},setX:function setX(x){this.x=x;return this},setY:function setY(y){this.y=y;return this},setZ:function setZ(z){this.z=z;return this},setComponent:function setComponent(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;default:throw new Error("index is out of range: "+index);}return this},getComponent:function getComponent(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+index);}},clone:function clone(){return new this.constructor(this.x,this.y,this.z)},copy:function copy(v){this.x=v.x;this.y=v.y;this.z=v.z;return this},add:function add(v,w){if(w!==void 0){console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;this.z+=v.z;return this},addScalar:function addScalar(s){this.x+=s;this.y+=s;this.z+=s;return this},addVectors:function addVectors(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;return this},addScaledVector:function addScaledVector(v,s){this.x+=v.x*s;this.y+=v.y*s;this.z+=v.z*s;return this},sub:function sub(v,w){if(w!==void 0){console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;this.z-=v.z;return this},subScalar:function subScalar(s){this.x-=s;this.y-=s;this.z-=s;return this},subVectors:function subVectors(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;return this},multiply:function multiply(v,w){if(w!==void 0){console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead.");return this.multiplyVectors(v,w)}this.x*=v.x;this.y*=v.y;this.z*=v.z;return this},multiplyScalar:function multiplyScalar(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;return this},multiplyVectors:function multiplyVectors(a,b){this.x=a.x*b.x;this.y=a.y*b.y;this.z=a.z*b.z;return this},applyEuler:function(){var quaternion=new Quaternion;return function(euler){if(!(euler&&euler.isEuler)){console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order.")}return this.applyQuaternion(quaternion.setFromEuler(euler))}}(),applyAxisAngle:function(){var quaternion=new Quaternion;return function(axis,angle){return this.applyQuaternion(quaternion.setFromAxisAngle(axis,angle))}}(),applyMatrix3:function applyMatrix3(m){var x=this.x,y=this.y,z=this.z,e=m.elements;this.x=e[0]*x+e[3]*y+e[6]*z;this.y=e[1]*x+e[4]*y+e[7]*z;this.z=e[2]*x+e[5]*y+e[8]*z;return this},applyMatrix4:function applyMatrix4(m){var x=this.x,y=this.y,z=this.z,e=m.elements,w=1/(e[3]*x+e[7]*y+e[11]*z+e[15]);this.x=(e[0]*x+e[4]*y+e[8]*z+e[12])*w;this.y=(e[1]*x+e[5]*y+e[9]*z+e[13])*w;this.z=(e[2]*x+e[6]*y+e[10]*z+e[14])*w;return this},applyQuaternion:function applyQuaternion(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this},project:function(){var matrix=new Matrix4;return function(camera){matrix.multiplyMatrices(camera.projectionMatrix,matrix.getInverse(camera.matrixWorld));return this.applyMatrix4(matrix)}}(),unproject:function(){var matrix=new Matrix4;return function(camera){matrix.multiplyMatrices(camera.matrixWorld,matrix.getInverse(camera.projectionMatrix));return this.applyMatrix4(matrix)}}(),transformDirection:function transformDirection(m){var x=this.x,y=this.y,z=this.z,e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z;this.y=e[1]*x+e[5]*y+e[9]*z;this.z=e[2]*x+e[6]*y+e[10]*z;return this.normalize()},divide:function divide(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;return this},divideScalar:function divideScalar(scalar){return this.multiplyScalar(1/scalar)},min:function min(v){this.x=_Mathmin(this.x,v.x);this.y=_Mathmin(this.y,v.y);this.z=_Mathmin(this.z,v.z);return this},max:function max(v){this.x=_Mathmax(this.x,v.x);this.y=_Mathmax(this.y,v.y);this.z=_Mathmax(this.z,v.z);return this},clamp:function clamp(min,max){this.x=_Mathmax(min.x,_Mathmin(max.x,this.x));this.y=_Mathmax(min.y,_Mathmin(max.y,this.y));this.z=_Mathmax(min.z,_Mathmin(max.z,this.z));return this},clampScalar:function(){var min=new Vector3,max=new Vector3;return function(minVal,maxVal){min.set(minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal);return this.clamp(min,max)}}(),clampLength:function clampLength(min,max){var length=this.length();return this.divideScalar(length||1).multiplyScalar(_Mathmax(min,_Mathmin(max,length)))},floor:function floor(){this.x=_Mathfloor(this.x);this.y=_Mathfloor(this.y);this.z=_Mathfloor(this.z);return this},ceil:function ceil(){this.x=_Mathceil(this.x);this.y=_Mathceil(this.y);this.z=_Mathceil(this.z);return this},round:function round(){this.x=_Mathround(this.x);this.y=_Mathround(this.y);this.z=_Mathround(this.z);return this},roundToZero:function roundToZero(){this.x=0>this.x?_Mathceil(this.x):_Mathfloor(this.x);this.y=0>this.y?_Mathceil(this.y):_Mathfloor(this.y);this.z=0>this.z?_Mathceil(this.z):_Mathfloor(this.z);return this},negate:function negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this},dot:function dot(v){return this.x*v.x+this.y*v.y+this.z*v.z},lengthSq:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function length(){return _Mathsqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function manhattanLength(){return _Mathabs(this.x)+_Mathabs(this.y)+_Mathabs(this.z)},normalize:function normalize(){return this.divideScalar(this.length()||1)},setLength:function setLength(length){return this.normalize().multiplyScalar(length)},lerp:function lerp(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;return this},lerpVectors:function lerpVectors(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)},cross:function cross(v,w){if(w!==void 0){console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead.");return this.crossVectors(v,w)}return this.crossVectors(this,v)},crossVectors:function crossVectors(a,b){var ax=a.x,ay=a.y,az=a.z,bx=b.x,by=b.y,bz=b.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this},projectOnVector:function projectOnVector(vector){var scalar=vector.dot(this)/vector.lengthSq();return this.copy(vector).multiplyScalar(scalar)},projectOnPlane:function(){var v1=new Vector3;return function(planeNormal){v1.copy(this).projectOnVector(planeNormal);return this.sub(v1)}}(),reflect:function(){var v1=new Vector3;return function(normal){return this.sub(v1.copy(normal).multiplyScalar(2*this.dot(normal)))}}(),angleTo:function angleTo(v){var theta=this.dot(v)/_Mathsqrt(this.lengthSq()*v.lengthSq());return _Mathacos(_Math.clamp(theta,-1,1))},distanceTo:function distanceTo(v){return _Mathsqrt(this.distanceToSquared(v))},distanceToSquared:function distanceToSquared(v){var dx=this.x-v.x,dy=this.y-v.y,dz=this.z-v.z;return dx*dx+dy*dy+dz*dz},manhattanDistanceTo:function manhattanDistanceTo(v){return _Mathabs(this.x-v.x)+_Mathabs(this.y-v.y)+_Mathabs(this.z-v.z)},setFromSpherical:function setFromSpherical(s){var sinPhiRadius=_Mathsin(s.phi)*s.radius;this.x=sinPhiRadius*_Mathsin(s.theta);this.y=_Mathcos(s.phi)*s.radius;this.z=sinPhiRadius*_Mathcos(s.theta);return this},setFromCylindrical:function setFromCylindrical(c){this.x=c.radius*_Mathsin(c.theta);this.y=c.y;this.z=c.radius*_Mathcos(c.theta);return this},setFromMatrixPosition:function setFromMatrixPosition(m){var e=m.elements;this.x=e[12];this.y=e[13];this.z=e[14];return this},setFromMatrixScale:function setFromMatrixScale(m){var sx=this.setFromMatrixColumn(m,0).length(),sy=this.setFromMatrixColumn(m,1).length(),sz=this.setFromMatrixColumn(m,2).length();this.x=sx;this.y=sy;this.z=sz;return this},setFromMatrixColumn:function setFromMatrixColumn(m,index){return this.fromArray(m.elements,4*index)},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z},fromArray:function fromArray(array,offset){if(offset===void 0)offset=0;this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];return this},toArray:function toArray(array,offset){if(array===void 0)array=[];if(offset===void 0)offset=0;array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;return array},fromBufferAttribute:function fromBufferAttribute(attribute,index,offset){if(offset!==void 0){console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute().")}this.x=attribute.getX(index);this.y=attribute.getY(index);this.z=attribute.getZ(index);return this}});function Matrix3(){this.elements=[1,0,0,0,1,0,0,0,1];if(0<arguments.length){console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}}Object.assign(Matrix3.prototype,{isMatrix3:!0,set:function set(n11,n12,n13,n21,n22,n23,n31,n32,n33){var te=this.elements;te[0]=n11;te[1]=n21;te[2]=n31;te[3]=n12;te[4]=n22;te[5]=n32;te[6]=n13;te[7]=n23;te[8]=n33;return this},identity:function identity(){this.set(1,0,0,0,1,0,0,0,1);return this},clone:function clone(){return new this.constructor().fromArray(this.elements)},copy:function copy(m){var te=this.elements,me=m.elements;te[0]=me[0];te[1]=me[1];te[2]=me[2];te[3]=me[3];te[4]=me[4];te[5]=me[5];te[6]=me[6];te[7]=me[7];te[8]=me[8];return this},setFromMatrix4:function setFromMatrix4(m){var me=m.elements;this.set(me[0],me[4],me[8],me[1],me[5],me[9],me[2],me[6],me[10]);return this},applyToBufferAttribute:function(){var v1=new Vector3;return function(attribute){for(var i=0,l=attribute.count;i<l;i++){v1.x=attribute.getX(i);v1.y=attribute.getY(i);v1.z=attribute.getZ(i);v1.applyMatrix3(this);attribute.setXYZ(i,v1.x,v1.y,v1.z)}return attribute}}(),multiply:function multiply(m){return this.multiplyMatrices(this,m)},premultiply:function premultiply(m){return this.multiplyMatrices(m,this)},multiplyMatrices:function multiplyMatrices(a,b){var ae=a.elements,be=b.elements,te=this.elements,a11=ae[0],a12=ae[3],a13=ae[6],a21=ae[1],a22=ae[4],a23=ae[7],a31=ae[2],a32=ae[5],a33=ae[8],b11=be[0],b12=be[3],b13=be[6],b21=be[1],b22=be[4],b23=be[7],b31=be[2],b32=be[5],b33=be[8];te[0]=a11*b11+a12*b21+a13*b31;te[3]=a11*b12+a12*b22+a13*b32;te[6]=a11*b13+a12*b23+a13*b33;te[1]=a21*b11+a22*b21+a23*b31;te[4]=a21*b12+a22*b22+a23*b32;te[7]=a21*b13+a22*b23+a23*b33;te[2]=a31*b11+a32*b21+a33*b31;te[5]=a31*b12+a32*b22+a33*b32;te[8]=a31*b13+a32*b23+a33*b33;return this},multiplyScalar:function multiplyScalar(s){var te=this.elements;te[0]*=s;te[3]*=s;te[6]*=s;te[1]*=s;te[4]*=s;te[7]*=s;te[2]*=s;te[5]*=s;te[8]*=s;return this},determinant:function determinant(){var te=this.elements,a=te[0],b=te[1],c=te[2],d=te[3],e=te[4],f=te[5],g=te[6],h=te[7],i=te[8];return a*e*i-a*f*h-b*d*i+b*f*g+c*d*h-c*e*g},getInverse:function getInverse(matrix,throwOnDegenerate){if(matrix&&matrix.isMatrix4){console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.")}var me=matrix.elements,te=this.elements,n11=me[0],n21=me[1],n31=me[2],n12=me[3],n22=me[4],n32=me[5],n13=me[6],n23=me[7],n33=me[8],t11=n33*n22-n32*n23,t12=n32*n13-n33*n12,t13=n23*n12-n22*n13,det=n11*t11+n21*t12+n31*t13;if(0===det){var msg="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(!0===throwOnDegenerate){throw new Error(msg)}else{console.warn(msg)}return this.identity()}var detInv=1/det;te[0]=t11*detInv;te[1]=(n31*n23-n33*n21)*detInv;te[2]=(n32*n21-n31*n22)*detInv;te[3]=t12*detInv;te[4]=(n33*n11-n31*n13)*detInv;te[5]=(n31*n12-n32*n11)*detInv;te[6]=t13*detInv;te[7]=(n21*n13-n23*n11)*detInv;te[8]=(n22*n11-n21*n12)*detInv;return this},transpose:function transpose(){var tmp,m=this.elements;tmp=m[1];m[1]=m[3];m[3]=tmp;tmp=m[2];m[2]=m[6];m[6]=tmp;tmp=m[5];m[5]=m[7];m[7]=tmp;return this},getNormalMatrix:function getNormalMatrix(matrix4){return this.setFromMatrix4(matrix4).getInverse(this).transpose()},transposeIntoArray:function transposeIntoArray(r){var m=this.elements;r[0]=m[0];r[1]=m[3];r[2]=m[6];r[3]=m[1];r[4]=m[4];r[5]=m[7];r[6]=m[2];r[7]=m[5];r[8]=m[8];return this},setUvTransform:function setUvTransform(tx,ty,sx,sy,rotation,cx,cy){var c=_Mathcos(rotation),s=_Mathsin(rotation);this.set(sx*c,sx*s,-sx*(c*cx+s*cy)+cx+tx,-sy*s,sy*c,-sy*(-s*cx+c*cy)+cy+ty,0,0,1)},scale:function scale(sx,sy){var te=this.elements;te[0]*=sx;te[3]*=sx;te[6]*=sx;te[1]*=sy;te[4]*=sy;te[7]*=sy;return this},rotate:function rotate(theta){var c=_Mathcos(theta),s=_Mathsin(theta),te=this.elements,a11=te[0],a12=te[3],a13=te[6],a21=te[1],a22=te[4],a23=te[7];te[0]=c*a11+s*a21;te[3]=c*a12+s*a22;te[6]=c*a13+s*a23;te[1]=-s*a11+c*a21;te[4]=-s*a12+c*a22;te[7]=-s*a13+c*a23;return this},translate:function translate(tx,ty){var te=this.elements;te[0]+=tx*te[2];te[3]+=tx*te[5];te[6]+=tx*te[8];te[1]+=ty*te[2];te[4]+=ty*te[5];te[7]+=ty*te[8];return this},equals:function(matrix){for(var te=this.elements,me=matrix.elements,i=0;9>i;i++){if(te[i]!==me[i])return!1}return!0},fromArray:function fromArray(array,offset){if(offset===void 0)offset=0;for(var i=0;9>i;i++){this.elements[i]=array[i+offset]}return this},toArray:function toArray(array,offset){if(array===void 0)array=[];if(offset===void 0)offset=0;var te=this.elements;array[offset]=te[0];array[offset+1]=te[1];array[offset+2]=te[2];array[offset+3]=te[3];array[offset+4]=te[4];array[offset+5]=te[5];array[offset+6]=te[6];array[offset+7]=te[7];array[offset+8]=te[8];return array}});var textureId=0;function Texture(image,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding){Object.defineProperty(this,"id",{value:textureId++});this.uuid=_Math.generateUUID();this.name="";this.image=image!==void 0?image:Texture.DEFAULT_IMAGE;this.mipmaps=[];this.mapping=mapping!==void 0?mapping:Texture.DEFAULT_MAPPING;this.wrapS=wrapS!==void 0?wrapS:ClampToEdgeWrapping;this.wrapT=wrapT!==void 0?wrapT:ClampToEdgeWrapping;this.magFilter=magFilter!==void 0?magFilter:LinearFilter;this.minFilter=minFilter!==void 0?minFilter:LinearMipMapLinearFilter;this.anisotropy=anisotropy!==void 0?anisotropy:1;this.format=format!==void 0?format:RGBAFormat;this.type=type!==void 0?type:UnsignedByteType;this.offset=new Vector2(0,0);this.repeat=new Vector2(1,1);this.center=new Vector2(0,0);this.rotation=0;this.matrixAutoUpdate=!0;this.matrix=new Matrix3;this.generateMipmaps=!0;this.premultiplyAlpha=!1;this.flipY=!0;this.unpackAlignment=4;this.encoding=encoding!==void 0?encoding:LinearEncoding;this.version=0;this.onUpdate=null}Texture.DEFAULT_IMAGE=void 0;Texture.DEFAULT_MAPPING=UVMapping;Texture.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Texture,isTexture:!0,clone:function clone(){return new this.constructor().copy(this)},copy:function copy(source){this.name=source.name;this.image=source.image;this.mipmaps=source.mipmaps.slice(0);this.mapping=source.mapping;this.wrapS=source.wrapS;this.wrapT=source.wrapT;this.magFilter=source.magFilter;this.minFilter=source.minFilter;this.anisotropy=source.anisotropy;this.format=source.format;this.type=source.type;this.offset.copy(source.offset);this.repeat.copy(source.repeat);this.center.copy(source.center);this.rotation=source.rotation;this.matrixAutoUpdate=source.matrixAutoUpdate;this.matrix.copy(source.matrix);this.generateMipmaps=source.generateMipmaps;this.premultiplyAlpha=source.premultiplyAlpha;this.flipY=source.flipY;this.unpackAlignment=source.unpackAlignment;this.encoding=source.encoding;return this},toJSON:function(meta){var isRootObject=meta===void 0||"string"===typeof meta;if(!isRootObject&&meta.textures[this.uuid]!==void 0){return meta.textures[this.uuid]}function getDataURL(image){var canvas;if(babelHelpers.instanceof(image,HTMLCanvasElement)){canvas=image}else{canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");canvas.width=image.width;canvas.height=image.height;var context=canvas.getContext("2d");if(babelHelpers.instanceof(image,ImageData)){context.putImageData(image,0,0)}else{context.drawImage(image,0,0,image.width,image.height)}}if(2048<canvas.width||2048<canvas.height){return canvas.toDataURL("image/jpeg",.6)}else{return canvas.toDataURL("image/png")}}var output={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY};if(this.image!==void 0){var image=this.image;if(image.uuid===void 0){image.uuid=_Math.generateUUID()}if(!isRootObject&&meta.images[image.uuid]===void 0){meta.images[image.uuid]={uuid:image.uuid,url:getDataURL(image)}}output.image=image.uuid}if(!isRootObject){meta.textures[this.uuid]=output}return output},dispose:function dispose(){this.dispatchEvent({type:"dispose"})},transformUv:function transformUv(uv){if(this.mapping!==UVMapping)return;uv.applyMatrix3(this.matrix);if(0>uv.x||1<uv.x){switch(this.wrapS){case RepeatWrapping:uv.x=uv.x-_Mathfloor(uv.x);break;case ClampToEdgeWrapping:uv.x=0>uv.x?0:1;break;case MirroredRepeatWrapping:if(1===_Mathabs(_Mathfloor(uv.x)%2)){uv.x=_Mathceil(uv.x)-uv.x}else{uv.x=uv.x-_Mathfloor(uv.x)}break;}}if(0>uv.y||1<uv.y){switch(this.wrapT){case RepeatWrapping:uv.y=uv.y-_Mathfloor(uv.y);break;case ClampToEdgeWrapping:uv.y=0>uv.y?0:1;break;case MirroredRepeatWrapping:if(1===_Mathabs(_Mathfloor(uv.y)%2)){uv.y=_Mathceil(uv.y)-uv.y}else{uv.y=uv.y-_Mathfloor(uv.y)}break;}}if(this.flipY){uv.y=1-uv.y}}});Object.defineProperty(Texture.prototype,"needsUpdate",{set:function set(value){if(!0===value)this.version++}});function Vector4(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=w!==void 0?w:1}Object.assign(Vector4.prototype,{isVector4:!0,set:function set(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this},setScalar:function setScalar(scalar){this.x=scalar;this.y=scalar;this.z=scalar;this.w=scalar;return this},setX:function setX(x){this.x=x;return this},setY:function setY(y){this.y=y;return this},setZ:function setZ(z){this.z=z;return this},setW:function setW(w){this.w=w;return this},setComponent:function setComponent(index,value){switch(index){case 0:this.x=value;break;case 1:this.y=value;break;case 2:this.z=value;break;case 3:this.w=value;break;default:throw new Error("index is out of range: "+index);}return this},getComponent:function getComponent(index){switch(index){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+index);}},clone:function clone(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function copy(v){this.x=v.x;this.y=v.y;this.z=v.z;this.w=v.w!==void 0?v.w:1;return this},add:function add(v,w){if(w!==void 0){console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead.");return this.addVectors(v,w)}this.x+=v.x;this.y+=v.y;this.z+=v.z;this.w+=v.w;return this},addScalar:function addScalar(s){this.x+=s;this.y+=s;this.z+=s;this.w+=s;return this},addVectors:function addVectors(a,b){this.x=a.x+b.x;this.y=a.y+b.y;this.z=a.z+b.z;this.w=a.w+b.w;return this},addScaledVector:function addScaledVector(v,s){this.x+=v.x*s;this.y+=v.y*s;this.z+=v.z*s;this.w+=v.w*s;return this},sub:function sub(v,w){if(w!==void 0){console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead.");return this.subVectors(v,w)}this.x-=v.x;this.y-=v.y;this.z-=v.z;this.w-=v.w;return this},subScalar:function subScalar(s){this.x-=s;this.y-=s;this.z-=s;this.w-=s;return this},subVectors:function subVectors(a,b){this.x=a.x-b.x;this.y=a.y-b.y;this.z=a.z-b.z;this.w=a.w-b.w;return this},multiplyScalar:function multiplyScalar(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar;this.w*=scalar;return this},applyMatrix4:function applyMatrix4(m){var x=this.x,y=this.y,z=this.z,w=this.w,e=m.elements;this.x=e[0]*x+e[4]*y+e[8]*z+e[12]*w;this.y=e[1]*x+e[5]*y+e[9]*z+e[13]*w;this.z=e[2]*x+e[6]*y+e[10]*z+e[14]*w;this.w=e[3]*x+e[7]*y+e[11]*z+e[15]*w;return this},divideScalar:function divideScalar(scalar){return this.multiplyScalar(1/scalar)},setAxisAngleFromQuaternion:function setAxisAngleFromQuaternion(q){this.w=2*_Mathacos(q.w);var s=_Mathsqrt(1-q.w*q.w);if(1e-4>s){this.x=1;this.y=0;this.z=0}else{this.x=q.x/s;this.y=q.y/s;this.z=q.z/s}return this},setAxisAngleFromRotationMatrix:function setAxisAngleFromRotationMatrix(m){var angle,x,y,z,epsilon=.01,epsilon2=.1,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];if(_Mathabs(m12-m21)<epsilon&&_Mathabs(m13-m31)<epsilon&&_Mathabs(m23-m32)<epsilon){if(_Mathabs(m12+m21)<epsilon2&&_Mathabs(m13+m31)<epsilon2&&_Mathabs(m23+m32)<epsilon2&&_Mathabs(m11+m22+m33-3)<epsilon2){this.set(1,0,0,0);return this}angle=_MathPI;var xx=(m11+1)/2,yy=(m22+1)/2,zz=(m33+1)/2,xy=(m12+m21)/4,xz=(m13+m31)/4,yz=(m23+m32)/4;if(xx>yy&&xx>zz){if(xx<epsilon){x=0;y=.707106781;z=.707106781}else{x=_Mathsqrt(xx);y=xy/x;z=xz/x}}else if(yy>zz){if(yy<epsilon){x=.707106781;y=0;z=.707106781}else{y=_Mathsqrt(yy);x=xy/y;z=yz/y}}else{if(zz<epsilon){x=.707106781;y=.707106781;z=0}else{z=_Mathsqrt(zz);x=xz/z;y=yz/z}}this.set(x,y,z,angle);return this}var s=_Mathsqrt((m32-m23)*(m32-m23)+(m13-m31)*(m13-m31)+(m21-m12)*(m21-m12));if(.001>_Mathabs(s))s=1;this.x=(m32-m23)/s;this.y=(m13-m31)/s;this.z=(m21-m12)/s;this.w=_Mathacos((m11+m22+m33-1)/2);return this},min:function min(v){this.x=_Mathmin(this.x,v.x);this.y=_Mathmin(this.y,v.y);this.z=_Mathmin(this.z,v.z);this.w=_Mathmin(this.w,v.w);return this},max:function max(v){this.x=_Mathmax(this.x,v.x);this.y=_Mathmax(this.y,v.y);this.z=_Mathmax(this.z,v.z);this.w=_Mathmax(this.w,v.w);return this},clamp:function clamp(min,max){this.x=_Mathmax(min.x,_Mathmin(max.x,this.x));this.y=_Mathmax(min.y,_Mathmin(max.y,this.y));this.z=_Mathmax(min.z,_Mathmin(max.z,this.z));this.w=_Mathmax(min.w,_Mathmin(max.w,this.w));return this},clampScalar:function(){var min,max;return function(minVal,maxVal){if(min===void 0){min=new Vector4;max=new Vector4}min.set(minVal,minVal,minVal,minVal);max.set(maxVal,maxVal,maxVal,maxVal);return this.clamp(min,max)}}(),clampLength:function clampLength(min,max){var length=this.length();return this.divideScalar(length||1).multiplyScalar(_Mathmax(min,_Mathmin(max,length)))},floor:function floor(){this.x=_Mathfloor(this.x);this.y=_Mathfloor(this.y);this.z=_Mathfloor(this.z);this.w=_Mathfloor(this.w);return this},ceil:function ceil(){this.x=_Mathceil(this.x);this.y=_Mathceil(this.y);this.z=_Mathceil(this.z);this.w=_Mathceil(this.w);return this},round:function round(){this.x=_Mathround(this.x);this.y=_Mathround(this.y);this.z=_Mathround(this.z);this.w=_Mathround(this.w);return this},roundToZero:function roundToZero(){this.x=0>this.x?_Mathceil(this.x):_Mathfloor(this.x);this.y=0>this.y?_Mathceil(this.y):_Mathfloor(this.y);this.z=0>this.z?_Mathceil(this.z):_Mathfloor(this.z);this.w=0>this.w?_Mathceil(this.w):_Mathfloor(this.w);return this},negate:function negate(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this},dot:function dot(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},lengthSq:function lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function length(){return _Mathsqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function manhattanLength(){return _Mathabs(this.x)+_Mathabs(this.y)+_Mathabs(this.z)+_Mathabs(this.w)},normalize:function normalize(){return this.divideScalar(this.length()||1)},setLength:function setLength(length){return this.normalize().multiplyScalar(length)},lerp:function lerp(v,alpha){this.x+=(v.x-this.x)*alpha;this.y+=(v.y-this.y)*alpha;this.z+=(v.z-this.z)*alpha;this.w+=(v.w-this.w)*alpha;return this},lerpVectors:function lerpVectors(v1,v2,alpha){return this.subVectors(v2,v1).multiplyScalar(alpha).add(v1)},equals:function(v){return v.x===this.x&&v.y===this.y&&v.z===this.z&&v.w===this.w},fromArray:function fromArray(array,offset){if(offset===void 0)offset=0;this.x=array[offset];this.y=array[offset+1];this.z=array[offset+2];this.w=array[offset+3];return this},toArray:function toArray(array,offset){if(array===void 0)array=[];if(offset===void 0)offset=0;array[offset]=this.x;array[offset+1]=this.y;array[offset+2]=this.z;array[offset+3]=this.w;return array},fromBufferAttribute:function fromBufferAttribute(attribute,index,offset){if(offset!==void 0){console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute().")}this.x=attribute.getX(index);this.y=attribute.getY(index);this.z=attribute.getZ(index);this.w=attribute.getW(index);return this}});function WebGLRenderTarget(width,height,options){this.uuid=_Math.generateUUID();this.width=width;this.height=height;this.scissor=new Vector4(0,0,width,height);this.scissorTest=!1;this.viewport=new Vector4(0,0,width,height);options=options||{};if(options.minFilter===void 0)options.minFilter=LinearFilter;this.texture=new Texture(void 0,void 0,options.wrapS,options.wrapT,options.magFilter,options.minFilter,options.format,options.type,options.anisotropy,options.encoding);this.depthBuffer=options.depthBuffer!==void 0?options.depthBuffer:!0;this.stencilBuffer=options.stencilBuffer!==void 0?options.stencilBuffer:!0;this.depthTexture=options.depthTexture!==void 0?options.depthTexture:null}WebGLRenderTarget.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:WebGLRenderTarget,isWebGLRenderTarget:!0,setSize:function setSize(width,height){if(this.width!==width||this.height!==height){this.width=width;this.height=height;this.dispose()}this.viewport.set(0,0,width,height);this.scissor.set(0,0,width,height)},clone:function clone(){return new this.constructor().copy(this)},copy:function copy(source){this.width=source.width;this.height=source.height;this.viewport.copy(source.viewport);this.texture=source.texture.clone();this.depthBuffer=source.depthBuffer;this.stencilBuffer=source.stencilBuffer;this.depthTexture=source.depthTexture;return this},dispose:function dispose(){this.dispatchEvent({type:"dispose"})}});function WebGLRenderTargetCube(width,height,options){WebGLRenderTarget.call(this,width,height,options);this.activeCubeFace=0;this.activeMipMapLevel=0}WebGLRenderTargetCube.prototype=Object.create(WebGLRenderTarget.prototype);WebGLRenderTargetCube.prototype.constructor=WebGLRenderTargetCube;WebGLRenderTargetCube.prototype.isWebGLRenderTargetCube=!0;function DataTexture(data,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,encoding){Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding);this.image={data:data,width:width,height:height};this.magFilter=magFilter!==void 0?magFilter:NearestFilter;this.minFilter=minFilter!==void 0?minFilter:NearestFilter;this.generateMipmaps=!1;this.flipY=!1;this.unpackAlignment=1}DataTexture.prototype=Object.create(Texture.prototype);DataTexture.prototype.constructor=DataTexture;DataTexture.prototype.isDataTexture=!0;function CubeTexture(images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding){images=images!==void 0?images:[];mapping=mapping!==void 0?mapping:CubeReflectionMapping;Texture.call(this,images,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding);this.flipY=!1}CubeTexture.prototype=Object.create(Texture.prototype);CubeTexture.prototype.constructor=CubeTexture;CubeTexture.prototype.isCubeTexture=!0;Object.defineProperty(CubeTexture.prototype,"images",{get:function get(){return this.image},set:function set(value){this.image=value}});var emptyTexture=new Texture,emptyCubeTexture=new CubeTexture;function UniformContainer(){this.seq=[];this.map={}}var arrayCacheF32=[],arrayCacheI32=[],mat4array=new Float32Array(16),mat3array=new Float32Array(9);function flatten(array,nBlocks,blockSize){var firstElem=array[0];if(0>=firstElem||0<firstElem)return array;var n=nBlocks*blockSize,r=arrayCacheF32[n];if(r===void 0){r=new Float32Array(n);arrayCacheF32[n]=r}if(0!==nBlocks){firstElem.toArray(r,0);for(var i=1,offset=0;i!==nBlocks;++i){offset+=blockSize;array[i].toArray(r,offset)}}return r}function allocTexUnits(renderer,n){var r=arrayCacheI32[n];if(r===void 0){r=new Int32Array(n);arrayCacheI32[n]=r}for(var i=0;i!==n;++i){r[i]=renderer.allocTextureUnit()}return r}function setValue1f(gl,v){gl.uniform1f(this.addr,v)}function setValue1i(gl,v){gl.uniform1i(this.addr,v)}function setValue2fv(gl,v){if(v.x===void 0){gl.uniform2fv(this.addr,v)}else{gl.uniform2f(this.addr,v.x,v.y)}}function setValue3fv(gl,v){if(v.x!==void 0){gl.uniform3f(this.addr,v.x,v.y,v.z)}else if(v.r!==void 0){gl.uniform3f(this.addr,v.r,v.g,v.b)}else{gl.uniform3fv(this.addr,v)}}function setValue4fv(gl,v){if(v.x===void 0){gl.uniform4fv(this.addr,v)}else{gl.uniform4f(this.addr,v.x,v.y,v.z,v.w)}}function setValue2fm(gl,v){gl.uniformMatrix2fv(this.addr,!1,v.elements||v)}function setValue3fm(gl,v){if(v.elements===void 0){gl.uniformMatrix3fv(this.addr,!1,v)}else{mat3array.set(v.elements);gl.uniformMatrix3fv(this.addr,!1,mat3array)}}function setValue4fm(gl,v){if(v.elements===void 0){gl.uniformMatrix4fv(this.addr,!1,v)}else{mat4array.set(v.elements);gl.uniformMatrix4fv(this.addr,!1,mat4array)}}function setValueT1(gl,v,renderer){var unit=renderer.allocTextureUnit();gl.uniform1i(this.addr,unit);renderer.setTexture2D(v||emptyTexture,unit)}function setValueT6(gl,v,renderer){var unit=renderer.allocTextureUnit();gl.uniform1i(this.addr,unit);renderer.setTextureCube(v||emptyCubeTexture,unit)}function setValue2iv(gl,v){gl.uniform2iv(this.addr,v)}function setValue3iv(gl,v){gl.uniform3iv(this.addr,v)}function setValue4iv(gl,v){gl.uniform4iv(this.addr,v)}function getSingularSetter(type){switch(type){case 5126:return setValue1f;case 35664:return setValue2fv;case 35665:return setValue3fv;case 35666:return setValue4fv;case 35674:return setValue2fm;case 35675:return setValue3fm;case 35676:return setValue4fm;case 35678:case 36198:return setValueT1;case 35680:return setValueT6;case 5124:case 35670:return setValue1i;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv;}}function setValue1fv(gl,v){gl.uniform1fv(this.addr,v)}function setValue1iv(gl,v){gl.uniform1iv(this.addr,v)}function setValueV2a(gl,v){gl.uniform2fv(this.addr,flatten(v,this.size,2))}function setValueV3a(gl,v){gl.uniform3fv(this.addr,flatten(v,this.size,3))}function setValueV4a(gl,v){gl.uniform4fv(this.addr,flatten(v,this.size,4))}function setValueM2a(gl,v){gl.uniformMatrix2fv(this.addr,!1,flatten(v,this.size,4))}function setValueM3a(gl,v){gl.uniformMatrix3fv(this.addr,!1,flatten(v,this.size,9))}function setValueM4a(gl,v){gl.uniformMatrix4fv(this.addr,!1,flatten(v,this.size,16))}function setValueT1a(gl,v,renderer){var n=v.length,units=allocTexUnits(renderer,n);gl.uniform1iv(this.addr,units);for(var i=0;i!==n;++i){renderer.setTexture2D(v[i]||emptyTexture,units[i])}}function setValueT6a(gl,v,renderer){var n=v.length,units=allocTexUnits(renderer,n);gl.uniform1iv(this.addr,units);for(var i=0;i!==n;++i){renderer.setTextureCube(v[i]||emptyCubeTexture,units[i])}}function getPureArraySetter(type){switch(type){case 5126:return setValue1fv;case 35664:return setValueV2a;case 35665:return setValueV3a;case 35666:return setValueV4a;case 35674:return setValueM2a;case 35675:return setValueM3a;case 35676:return setValueM4a;case 35678:return setValueT1a;case 35680:return setValueT6a;case 5124:case 35670:return setValue1iv;case 35667:case 35671:return setValue2iv;case 35668:case 35672:return setValue3iv;case 35669:case 35673:return setValue4iv;}}function SingleUniform(id,activeInfo,addr){this.id=id;this.addr=addr;this.setValue=getSingularSetter(activeInfo.type)}function PureArrayUniform(id,activeInfo,addr){this.id=id;this.addr=addr;this.size=activeInfo.size;this.setValue=getPureArraySetter(activeInfo.type)}function StructuredUniform(id){this.id=id;UniformContainer.call(this)}StructuredUniform.prototype.setValue=function(gl,value){for(var seq=this.seq,i=0,n=seq.length,u;i!==n;++i){u=seq[i];u.setValue(gl,value[u.id])}};var RePathPart=/([\w\d_]+)(\])?(\[|\.)?/g;function addUniform(container,uniformObject){container.seq.push(uniformObject);container.map[uniformObject.id]=uniformObject}function parseUniform(activeInfo,addr,container){var path=activeInfo.name,pathLength=path.length;RePathPart.lastIndex=0;for(;;){var match=RePathPart.exec(path),matchEnd=RePathPart.lastIndex,id=match[1],idIsIndex="]"===match[2],subscript=match[3];if(idIsIndex)id=0|id;if(subscript===void 0||"["===subscript&&matchEnd+2===pathLength){addUniform(container,subscript===void 0?new SingleUniform(id,activeInfo,addr):new PureArrayUniform(id,activeInfo,addr));break}else{var map=container.map,next=map[id];if(next===void 0){next=new StructuredUniform(id);addUniform(container,next)}container=next}}}function WebGLUniforms(gl,program,renderer){UniformContainer.call(this);this.renderer=renderer;for(var n=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS),i=0;i<n;++i){var info=gl.getActiveUniform(program,i),path=info.name,addr=gl.getUniformLocation(program,path);parseUniform(info,addr,this)}}WebGLUniforms.prototype.setValue=function(gl,name,value){var u=this.map[name];if(u!==void 0)u.setValue(gl,value,this.renderer)};WebGLUniforms.prototype.setOptional=function(gl,object,name){var v=object[name];if(v!==void 0)this.setValue(gl,name,v)};WebGLUniforms.upload=function(gl,seq,values,renderer){for(var i=0,n=seq.length;i!==n;++i){var u=seq[i],v=values[u.id];if(!1!==v.needsUpdate){u.setValue(gl,v.value,renderer)}}};WebGLUniforms.seqWithValue=function(seq,values){for(var r=[],i=0,n=seq.length,u;i!==n;++i){u=seq[i];if(u.id in values)r.push(u)}return r};var ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function Color(r,g,b){if(g===void 0&&b===void 0){return this.set(r)}return this.setRGB(r,g,b)}Object.assign(Color.prototype,{isColor:!0,r:1,g:1,b:1,set:function set(value){if(value&&value.isColor){this.copy(value)}else if("number"===typeof value){this.setHex(value)}else if("string"===typeof value){this.setStyle(value)}return this},setScalar:function setScalar(scalar){this.r=scalar;this.g=scalar;this.b=scalar;return this},setHex:function setHex(hex){hex=_Mathfloor(hex);this.r=(255&hex>>16)/255;this.g=(255&hex>>8)/255;this.b=(255&hex)/255;return this},setRGB:function setRGB(r,g,b){this.r=r;this.g=g;this.b=b;return this},setHSL:function(){function hue2rgb(p,q,t){if(0>t)t+=1;if(1<t)t-=1;if(t<1/6)return p+6*(q-p)*t;if(t<1/2)return q;if(t<2/3)return p+6*(q-p)*(2/3-t);return p}return function(h,s,l){h=_Math.euclideanModulo(h,1);s=_Math.clamp(s,0,1);l=_Math.clamp(l,0,1);if(0===s){this.r=this.g=this.b=l}else{var p=.5>=l?l*(1+s):l+s-l*s,q=2*l-p;this.r=hue2rgb(q,p,h+1/3);this.g=hue2rgb(q,p,h);this.b=hue2rgb(q,p,h-1/3)}return this}}(),setStyle:function setStyle(style){function handleAlpha(string){if(string===void 0)return;if(1>parseFloat(string)){console.warn("THREE.Color: Alpha component of "+style+" will be ignored.")}}var m;if(m=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(style)){var color,name=m[1],components=m[2];switch(name){case"rgb":case"rgba":if(color=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components)){this.r=_Mathmin(255,parseInt(color[1],10))/255;this.g=_Mathmin(255,parseInt(color[2],10))/255;this.b=_Mathmin(255,parseInt(color[3],10))/255;handleAlpha(color[5]);return this}if(color=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components)){this.r=_Mathmin(100,parseInt(color[1],10))/100;this.g=_Mathmin(100,parseInt(color[2],10))/100;this.b=_Mathmin(100,parseInt(color[3],10))/100;handleAlpha(color[5]);return this}break;case"hsl":case"hsla":if(color=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(components)){var h=parseFloat(color[1])/360,s=parseInt(color[2],10)/100,l=parseInt(color[3],10)/100;handleAlpha(color[5]);return this.setHSL(h,s,l)}break;}}else if(m=/^\#([A-Fa-f0-9]+)$/.exec(style)){var hex=m[1],size=hex.length;if(3===size){this.r=parseInt(hex.charAt(0)+hex.charAt(0),16)/255;this.g=parseInt(hex.charAt(1)+hex.charAt(1),16)/255;this.b=parseInt(hex.charAt(2)+hex.charAt(2),16)/255;return this}else if(6===size){this.r=parseInt(hex.charAt(0)+hex.charAt(1),16)/255;this.g=parseInt(hex.charAt(2)+hex.charAt(3),16)/255;this.b=parseInt(hex.charAt(4)+hex.charAt(5),16)/255;return this}}if(style&&0<style.length){var hex=ColorKeywords[style];if(hex!==void 0){this.setHex(hex)}else{console.warn("THREE.Color: Unknown color "+style)}}return this},clone:function clone(){return new this.constructor(this.r,this.g,this.b)},copy:function copy(color){this.r=color.r;this.g=color.g;this.b=color.b;return this},copyGammaToLinear:function copyGammaToLinear(color,gammaFactor){if(gammaFactor===void 0)gammaFactor=2;this.r=_Mathpow(color.r,gammaFactor);this.g=_Mathpow(color.g,gammaFactor);this.b=_Mathpow(color.b,gammaFactor);return this},copyLinearToGamma:function copyLinearToGamma(color,gammaFactor){if(gammaFactor===void 0)gammaFactor=2;var safeInverse=0<gammaFactor?1/gammaFactor:1;this.r=_Mathpow(color.r,safeInverse);this.g=_Mathpow(color.g,safeInverse);this.b=_Mathpow(color.b,safeInverse);return this},convertGammaToLinear:function convertGammaToLinear(){var r=this.r,g=this.g,b=this.b;this.r=r*r;this.g=g*g;this.b=b*b;return this},convertLinearToGamma:function convertLinearToGamma(){this.r=_Mathsqrt(this.r);this.g=_Mathsqrt(this.g);this.b=_Mathsqrt(this.b);return this},getHex:function getHex(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function getHexString(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function getHSL(optionalTarget){var hsl=optionalTarget||{h:0,s:0,l:0},r=this.r,g=this.g,b=this.b,max=_Mathmax(r,g,b),min=_Mathmin(r,g,b),hue,saturation,lightness=(min+max)/2;if(min===max){hue=0;saturation=0}else{var delta=max-min;saturation=.5>=lightness?delta/(max+min):delta/(2-max-min);switch(max){case r:hue=(g-b)/delta+(g<b?6:0);break;case g:hue=(b-r)/delta+2;break;case b:hue=(r-g)/delta+4;break;}hue/=6}hsl.h=hue;hsl.s=saturation;hsl.l=lightness;return hsl},getStyle:function getStyle(){return"rgb("+(0|255*this.r)+","+(0|255*this.g)+","+(0|255*this.b)+")"},offsetHSL:function offsetHSL(h,s,l){var hsl=this.getHSL();hsl.h+=h;hsl.s+=s;hsl.l+=l;this.setHSL(hsl.h,hsl.s,hsl.l);return this},add:function add(color){this.r+=color.r;this.g+=color.g;this.b+=color.b;return this},addColors:function addColors(color1,color2){this.r=color1.r+color2.r;this.g=color1.g+color2.g;this.b=color1.b+color2.b;return this},addScalar:function addScalar(s){this.r+=s;this.g+=s;this.b+=s;return this},sub:function sub(color){this.r=_Mathmax(0,this.r-color.r);this.g=_Mathmax(0,this.g-color.g);this.b=_Mathmax(0,this.b-color.b);return this},multiply:function multiply(color){this.r*=color.r;this.g*=color.g;this.b*=color.b;return this},multiplyScalar:function multiplyScalar(s){this.r*=s;this.g*=s;this.b*=s;return this},lerp:function lerp(color,alpha){this.r+=(color.r-this.r)*alpha;this.g+=(color.g-this.g)*alpha;this.b+=(color.b-this.b)*alpha;return this},equals:function(c){return c.r===this.r&&c.g===this.g&&c.b===this.b},fromArray:function fromArray(array,offset){if(offset===void 0)offset=0;this.r=array[offset];this.g=array[offset+1];this.b=array[offset+2];return this},toArray:function toArray(array,offset){if(array===void 0)array=[];if(offset===void 0)offset=0;array[offset]=this.r;array[offset+1]=this.g;array[offset+2]=this.b;return array},toJSON:function(){return this.getHex()}});var UniformsLib={common:{diffuse:{value:new Color(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Matrix3},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Vector2(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Color(16777215)}},lights:{ambientLightColor:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Color(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},uvTransform:{value:new Matrix3}}},UniformsUtils={merge:function merge(uniforms){for(var merged={},u=0,tmp;u<uniforms.length;u++){tmp=this.clone(uniforms[u]);for(var p in tmp){merged[p]=tmp[p]}}return merged},clone:function clone(uniforms_src){var uniforms_dst={};for(var u in uniforms_src){uniforms_dst[u]={};for(var p in uniforms_src[u]){var parameter_src=uniforms_src[u][p];if(parameter_src&&(parameter_src.isColor||parameter_src.isMatrix3||parameter_src.isMatrix4||parameter_src.isVector2||parameter_src.isVector3||parameter_src.isVector4||parameter_src.isTexture)){uniforms_dst[u][p]=parameter_src.clone()}else if(Array.isArray(parameter_src)){uniforms_dst[u][p]=parameter_src.slice()}else{uniforms_dst[u][p]=parameter_src}}}return uniforms_dst}},ShaderChunk={alphamap_fragment:"#ifdef USE_ALPHAMAP\r\n\r\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\r\n\r\n#endif\r\n",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\r\n\r\n\tuniform sampler2D alphaMap;\r\n\r\n#endif\r\n",alphatest_fragment:"#ifdef ALPHATEST\r\n\r\n\tif ( diffuseColor.a < ALPHATEST ) discard;\r\n\r\n#endif\r\n",aomap_fragment:"#ifdef USE_AOMAP\r\n\r\n\t// reads channel R, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\r\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\r\n\r\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\r\n\r\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL )\r\n\r\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\r\n\r\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );\r\n\r\n\t#endif\r\n\r\n#endif\r\n",aomap_pars_fragment:"#ifdef USE_AOMAP\r\n\r\n\tuniform sampler2D aoMap;\r\n\tuniform float aoMapIntensity;\r\n\r\n#endif",begin_vertex:"\r\nvec3 transformed = vec3( position );\r\n",beginnormal_vertex:"\r\nvec3 objectNormal = vec3( normal );\r\n",bsdfs:"float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\r\n\r\n\tif( decayExponent > 0.0 ) {\r\n\r\n#if defined ( PHYSICALLY_CORRECT_LIGHTS )\r\n\r\n\t\t// based upon Frostbite 3 Moving to Physically-based Rendering\r\n\t\t// page 32, equation 26: E[window1]\r\n\t\t// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\n\t\t// this is intended to be used on spot and point lights who are represented as luminous intensity\r\n\t\t// but who must be converted to luminous irradiance for surface lighting calculation\r\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\r\n\t\tfloat maxDistanceCutoffFactor = pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\r\n\t\treturn distanceFalloff * maxDistanceCutoffFactor;\r\n\r\n#else\r\n\r\n\t\treturn pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );\r\n\r\n#endif\r\n\r\n\t}\r\n\r\n\treturn 1.0;\r\n\r\n}\r\n\r\nvec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {\r\n\r\n\treturn RECIPROCAL_PI * diffuseColor;\r\n\r\n} // validated\r\n\r\nvec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {\r\n\r\n\t// Original approximation by Christophe Schlick '94\r\n\t// float fresnel = pow( 1.0 - dotLH, 5.0 );\r\n\r\n\t// Optimized variant (presented by Epic at SIGGRAPH '13)\r\n\t// https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf\r\n\tfloat fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );\r\n\r\n\treturn ( 1.0 - specularColor ) * fresnel + specularColor;\r\n\r\n} // validated\r\n\r\n// Microfacet Models for Refraction through Rough Surfaces - equation (34)\r\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\r\n// alpha is \"roughness squared\" in Disney\u2019s reparameterization\r\nfloat G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {\r\n\r\n\t// geometry term (normalized) = G(l)\u22C5G(v) / 4(n\u22C5l)(n\u22C5v)\r\n\t// also see #12151\r\n\r\n\tfloat a2 = pow2( alpha );\r\n\r\n\tfloat gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\r\n\tfloat gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\r\n\r\n\treturn 1.0 / ( gl * gv );\r\n\r\n} // validated\r\n\r\n// Moving Frostbite to Physically Based Rendering 3.0 - page 12, listing 2\r\n// https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\nfloat G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\r\n\r\n\tfloat a2 = pow2( alpha );\r\n\r\n\t// dotNL and dotNV are explicitly swapped. This is not a mistake.\r\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\r\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\r\n\r\n\treturn 0.5 / max( gv + gl, EPSILON );\r\n\r\n}\r\n\r\n// Microfacet Models for Refraction through Rough Surfaces - equation (33)\r\n// http://graphicrants.blogspot.com/2013/08/specular-brdf-reference.html\r\n// alpha is \"roughness squared\" in Disney\u2019s reparameterization\r\nfloat D_GGX( const in float alpha, const in float dotNH ) {\r\n\r\n\tfloat a2 = pow2( alpha );\r\n\r\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0; // avoid alpha = 0 with dotNH = 1\r\n\r\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\r\n\r\n}\r\n\r\n// GGX Distribution, Schlick Fresnel, GGX-Smith Visibility\r\nvec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\r\n\r\n\tfloat alpha = pow2( roughness ); // UE4's roughness\r\n\r\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\r\n\r\n\tfloat dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\r\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\r\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\r\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\r\n\r\n\tvec3 F = F_Schlick( specularColor, dotLH );\r\n\r\n\tfloat G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );\r\n\r\n\tfloat D = D_GGX( alpha, dotNH );\r\n\r\n\treturn F * ( G * D );\r\n\r\n} // validated\r\n\r\n// Rect Area Light\r\n\r\n// Real-Time Polygonal-Light Shading with Linearly Transformed Cosines\r\n// by Eric Heitz, Jonathan Dupuy, Stephen Hill and David Neubelt\r\n// code: https://github.com/selfshadow/ltc_code/\r\n\r\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\r\n\r\n\tconst float LUT_SIZE  = 64.0;\r\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\r\n\tconst float LUT_BIAS  = 0.5 / LUT_SIZE;\r\n\r\n\tfloat dotNV = saturate( dot( N, V ) );\r\n\r\n\t// texture parameterized by sqrt( GGX alpha ) and sqrt( 1 - cos( theta ) )\r\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\r\n\r\n\tuv = uv * LUT_SCALE + LUT_BIAS;\r\n\r\n\treturn uv;\r\n\r\n}\r\n\r\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\r\n\r\n\t// Real-Time Area Lighting: a Journey from Research to Production (p.102)\r\n\t// An approximation of the form factor of a horizon-clipped rectangle.\r\n\r\n\tfloat l = length( f );\r\n\r\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\r\n\r\n}\r\n\r\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\r\n\r\n\tfloat x = dot( v1, v2 );\r\n\r\n\tfloat y = abs( x );\r\n\r\n\t// rational polynomial approximation to theta / sin( theta ) / 2PI\r\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\r\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\r\n\tfloat v = a / b;\r\n\r\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\r\n\r\n\treturn cross( v1, v2 ) * theta_sintheta;\r\n\r\n}\r\n\r\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\r\n\r\n\t// bail if point is on back side of plane of light\r\n\t// assumes ccw winding order of light vertices\r\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\r\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\r\n\tvec3 lightNormal = cross( v1, v2 );\r\n\r\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\r\n\r\n\t// construct orthonormal basis around N\r\n\tvec3 T1, T2;\r\n\tT1 = normalize( V - N * dot( V, N ) );\r\n\tT2 = - cross( N, T1 ); // negated from paper; possibly due to a different handedness of world coordinate system\r\n\r\n\t// compute transform\r\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\r\n\r\n\t// transform rect\r\n\tvec3 coords[ 4 ];\r\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\r\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\r\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\r\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\r\n\r\n\t// project rect onto sphere\r\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\r\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\r\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\r\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\r\n\r\n\t// calculate vector form factor\r\n\tvec3 vectorFormFactor = vec3( 0.0 );\r\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\r\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\r\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\r\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\r\n\r\n\t// adjust for horizon clipping\r\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\r\n\r\n\r\n\r\n\treturn vec3( result );\r\n\r\n}\r\n\r\n// End Rect Area Light\r\n\r\n// ref: https://www.unrealengine.com/blog/physically-based-shading-on-mobile - environmentBRDF for GGX on mobile\r\nvec3 BRDF_Specular_GGX_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness ) {\r\n\r\n\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\r\n\r\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\r\n\r\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\r\n\r\n\tvec4 r = roughness * c0 + c1;\r\n\r\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\r\n\r\n\tvec2 AB = vec2( -1.04, 1.04 ) * a004 + r.zw;\r\n\r\n\treturn specularColor * AB.x + AB.y;\r\n\r\n} // validated\r\n\r\n\r\nfloat G_BlinnPhong_Implicit( ) {\r\n\r\n\t// geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)\r\n\treturn 0.25;\r\n\r\n}\r\n\r\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\r\n\r\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\r\n\r\n}\r\n\r\nvec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {\r\n\r\n\tvec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );\r\n\r\n\t//float dotNL = saturate( dot( geometry.normal, incidentLight.direction ) );\r\n\t//float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\r\n\tfloat dotNH = saturate( dot( geometry.normal, halfDir ) );\r\n\tfloat dotLH = saturate( dot( incidentLight.direction, halfDir ) );\r\n\r\n\tvec3 F = F_Schlick( specularColor, dotLH );\r\n\r\n\tfloat G = G_BlinnPhong_Implicit( );\r\n\r\n\tfloat D = D_BlinnPhong( shininess, dotNH );\r\n\r\n\treturn F * ( G * D );\r\n\r\n} // validated\r\n\r\n// source: http://simonstechblog.blogspot.ca/2011/12/microfacet-brdf.html\r\nfloat GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {\r\n\treturn ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );\r\n}\r\n\r\nfloat BlinnExponentToGGXRoughness( const in float blinnExponent ) {\r\n\treturn sqrt( 2.0 / ( blinnExponent + 2.0 ) );\r\n}\r\n",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\r\n\r\n\tuniform sampler2D bumpMap;\r\n\tuniform float bumpScale;\r\n\r\n\t// Derivative maps - bump mapping unparametrized surfaces by Morten Mikkelsen\r\n\t// http://mmikkelsen3d.blogspot.sk/2011/07/derivative-maps.html\r\n\r\n\t// Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)\r\n\r\n\tvec2 dHdxy_fwd() {\r\n\r\n\t\tvec2 dSTdx = dFdx( vUv );\r\n\t\tvec2 dSTdy = dFdy( vUv );\r\n\r\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\r\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\r\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\r\n\r\n\t\treturn vec2( dBx, dBy );\r\n\r\n\t}\r\n\r\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\r\n\r\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\r\n\r\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\r\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\r\n\t\tvec3 vN = surf_norm;\t\t// normalized\r\n\r\n\t\tvec3 R1 = cross( vSigmaY, vN );\r\n\t\tvec3 R2 = cross( vN, vSigmaX );\r\n\r\n\t\tfloat fDet = dot( vSigmaX, R1 );\r\n\r\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\r\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\r\n\r\n\t}\r\n\r\n#endif\r\n",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\r\n\r\n\tvec4 plane;\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\r\n\r\n\t\tplane = clippingPlanes[ i ];\r\n\t\tif ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;\r\n\r\n\t}\r\n\r\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\r\n\r\n\t\tbool clipped = true;\r\n\r\n\t\t#pragma unroll_loop\r\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\r\n\r\n\t\t\tplane = clippingPlanes[ i ];\r\n\t\t\tclipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;\r\n\r\n\t\t}\r\n\r\n\t\tif ( clipped ) discard;\r\n\r\n\t#endif\r\n\r\n#endif\r\n",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\r\n\r\n\t#if ! defined( PHYSICAL ) && ! defined( PHONG )\r\n\t\tvarying vec3 vViewPosition;\r\n\t#endif\r\n\r\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\r\n\r\n#endif\r\n",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\r\n\tvarying vec3 vViewPosition;\r\n#endif\r\n",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0 && ! defined( PHYSICAL ) && ! defined( PHONG )\r\n\tvViewPosition = - mvPosition.xyz;\r\n#endif\r\n\r\n",color_fragment:"#ifdef USE_COLOR\r\n\r\n\tdiffuseColor.rgb *= vColor;\r\n\r\n#endif",color_pars_fragment:"#ifdef USE_COLOR\r\n\r\n\tvarying vec3 vColor;\r\n\r\n#endif\r\n",color_pars_vertex:"#ifdef USE_COLOR\r\n\r\n\tvarying vec3 vColor;\r\n\r\n#endif",color_vertex:"#ifdef USE_COLOR\r\n\r\n\tvColor.xyz = color.xyz;\r\n\r\n#endif",common:"#define PI 3.14159265359\r\n#define PI2 6.28318530718\r\n#define PI_HALF 1.5707963267949\r\n#define RECIPROCAL_PI 0.31830988618\r\n#define RECIPROCAL_PI2 0.15915494\r\n#define LOG2 1.442695\r\n#define EPSILON 1e-6\r\n\r\n#define saturate(a) clamp( a, 0.0, 1.0 )\r\n#define whiteCompliment(a) ( 1.0 - saturate( a ) )\r\n\r\nfloat pow2( const in float x ) { return x*x; }\r\nfloat pow3( const in float x ) { return x*x*x; }\r\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\r\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\r\n// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.\r\n// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/\r\nhighp float rand( const in vec2 uv ) {\r\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\r\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\r\n\treturn fract(sin(sn) * c);\r\n}\r\n\r\nstruct IncidentLight {\r\n\tvec3 color;\r\n\tvec3 direction;\r\n\tbool visible;\r\n};\r\n\r\nstruct ReflectedLight {\r\n\tvec3 directDiffuse;\r\n\tvec3 directSpecular;\r\n\tvec3 indirectDiffuse;\r\n\tvec3 indirectSpecular;\r\n};\r\n\r\nstruct GeometricContext {\r\n\tvec3 position;\r\n\tvec3 normal;\r\n\tvec3 viewDir;\r\n};\r\n\r\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\r\n\r\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\r\n\r\n}\r\n\r\n// http://en.wikibooks.org/wiki/GLSL_Programming/Applying_Matrix_Transformations\r\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\r\n\r\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\r\n\r\n}\r\n\r\nvec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\r\n\r\n\tfloat distance = dot( planeNormal, point - pointOnPlane );\r\n\r\n\treturn - distance * planeNormal + point;\r\n\r\n}\r\n\r\nfloat sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {\r\n\r\n\treturn sign( dot( point - pointOnPlane, planeNormal ) );\r\n\r\n}\r\n\r\nvec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {\r\n\r\n\treturn lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;\r\n\r\n}\r\n\r\nmat3 transposeMat3( const in mat3 m ) {\r\n\r\n\tmat3 tmp;\r\n\r\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\r\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\r\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\r\n\r\n\treturn tmp;\r\n\r\n}\r\n\r\n// https://en.wikipedia.org/wiki/Relative_luminance\r\nfloat linearToRelativeLuminance( const in vec3 color ) {\r\n\r\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\r\n\r\n\treturn dot( weights, color.rgb );\r\n\r\n}\r\n",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\r\n\r\n#define cubeUV_textureSize (1024.0)\r\n\r\nint getFaceFromDirection(vec3 direction) {\r\n\tvec3 absDirection = abs(direction);\r\n\tint face = -1;\r\n\tif( absDirection.x > absDirection.z ) {\r\n\t\tif(absDirection.x > absDirection.y )\r\n\t\t\tface = direction.x > 0.0 ? 0 : 3;\r\n\t\telse\r\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\r\n\t}\r\n\telse {\r\n\t\tif(absDirection.z > absDirection.y )\r\n\t\t\tface = direction.z > 0.0 ? 2 : 5;\r\n\t\telse\r\n\t\t\tface = direction.y > 0.0 ? 1 : 4;\r\n\t}\r\n\treturn face;\r\n}\r\n#define cubeUV_maxLods1  (log2(cubeUV_textureSize*0.25) - 1.0)\r\n#define cubeUV_rangeClamp (exp2((6.0 - 1.0) * 2.0))\r\n\r\nvec2 MipLevelInfo( vec3 vec, float roughnessLevel, float roughness ) {\r\n\tfloat scale = exp2(cubeUV_maxLods1 - roughnessLevel);\r\n\tfloat dxRoughness = dFdx(roughness);\r\n\tfloat dyRoughness = dFdy(roughness);\r\n\tvec3 dx = dFdx( vec * scale * dxRoughness );\r\n\tvec3 dy = dFdy( vec * scale * dyRoughness );\r\n\tfloat d = max( dot( dx, dx ), dot( dy, dy ) );\r\n\t// Clamp the value to the max mip level counts. hard coded to 6 mips\r\n\td = clamp(d, 1.0, cubeUV_rangeClamp);\r\n\tfloat mipLevel = 0.5 * log2(d);\r\n\treturn vec2(floor(mipLevel), fract(mipLevel));\r\n}\r\n\r\n#define cubeUV_maxLods2 (log2(cubeUV_textureSize*0.25) - 2.0)\r\n#define cubeUV_rcpTextureSize (1.0 / cubeUV_textureSize)\r\n\r\nvec2 getCubeUV(vec3 direction, float roughnessLevel, float mipLevel) {\r\n\tmipLevel = roughnessLevel > cubeUV_maxLods2 - 3.0 ? 0.0 : mipLevel;\r\n\tfloat a = 16.0 * cubeUV_rcpTextureSize;\r\n\r\n\tvec2 exp2_packed = exp2( vec2( roughnessLevel, mipLevel ) );\r\n\tvec2 rcp_exp2_packed = vec2( 1.0 ) / exp2_packed;\r\n\t// float powScale = exp2(roughnessLevel + mipLevel);\r\n\tfloat powScale = exp2_packed.x * exp2_packed.y;\r\n\t// float scale =  1.0 / exp2(roughnessLevel + 2.0 + mipLevel);\r\n\tfloat scale = rcp_exp2_packed.x * rcp_exp2_packed.y * 0.25;\r\n\t// float mipOffset = 0.75*(1.0 - 1.0/exp2(mipLevel))/exp2(roughnessLevel);\r\n\tfloat mipOffset = 0.75*(1.0 - rcp_exp2_packed.y) * rcp_exp2_packed.x;\r\n\r\n\tbool bRes = mipLevel == 0.0;\r\n\tscale =  bRes && (scale < a) ? a : scale;\r\n\r\n\tvec3 r;\r\n\tvec2 offset;\r\n\tint face = getFaceFromDirection(direction);\r\n\r\n\tfloat rcpPowScale = 1.0 / powScale;\r\n\r\n\tif( face == 0) {\r\n\t\tr = vec3(direction.x, -direction.z, direction.y);\r\n\t\toffset = vec2(0.0+mipOffset,0.75 * rcpPowScale);\r\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\r\n\t}\r\n\telse if( face == 1) {\r\n\t\tr = vec3(direction.y, direction.x, direction.z);\r\n\t\toffset = vec2(scale+mipOffset, 0.75 * rcpPowScale);\r\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\r\n\t}\r\n\telse if( face == 2) {\r\n\t\tr = vec3(direction.z, direction.x, direction.y);\r\n\t\toffset = vec2(2.0*scale+mipOffset, 0.75 * rcpPowScale);\r\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? a : offset.y;\r\n\t}\r\n\telse if( face == 3) {\r\n\t\tr = vec3(direction.x, direction.z, direction.y);\r\n\t\toffset = vec2(0.0+mipOffset,0.5 * rcpPowScale);\r\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\r\n\t}\r\n\telse if( face == 4) {\r\n\t\tr = vec3(direction.y, direction.x, -direction.z);\r\n\t\toffset = vec2(scale+mipOffset, 0.5 * rcpPowScale);\r\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\r\n\t}\r\n\telse {\r\n\t\tr = vec3(direction.z, -direction.x, direction.y);\r\n\t\toffset = vec2(2.0*scale+mipOffset, 0.5 * rcpPowScale);\r\n\t\toffset.y = bRes && (offset.y < 2.0*a) ? 0.0 : offset.y;\r\n\t}\r\n\tr = normalize(r);\r\n\tfloat texelOffset = 0.5 * cubeUV_rcpTextureSize;\r\n\tvec2 s = ( r.yz / abs( r.x ) + vec2( 1.0 ) ) * 0.5;\r\n\tvec2 base = offset + vec2( texelOffset );\r\n\treturn base + s * ( scale - 2.0 * texelOffset );\r\n}\r\n\r\n#define cubeUV_maxLods3 (log2(cubeUV_textureSize*0.25) - 3.0)\r\n\r\nvec4 textureCubeUV(vec3 reflectedDirection, float roughness ) {\r\n\tfloat roughnessVal = roughness* cubeUV_maxLods3;\r\n\tfloat r1 = floor(roughnessVal);\r\n\tfloat r2 = r1 + 1.0;\r\n\tfloat t = fract(roughnessVal);\r\n\tvec2 mipInfo = MipLevelInfo(reflectedDirection, r1, roughness);\r\n\tfloat s = mipInfo.y;\r\n\tfloat level0 = mipInfo.x;\r\n\tfloat level1 = level0 + 1.0;\r\n\tlevel1 = level1 > 5.0 ? 5.0 : level1;\r\n\r\n\t// round to nearest mipmap if we are not interpolating.\r\n\tlevel0 += min( floor( s + 0.5 ), 5.0 );\r\n\r\n\t// Tri linear interpolation.\r\n\tvec2 uv_10 = getCubeUV(reflectedDirection, r1, level0);\r\n\tvec4 color10 = envMapTexelToLinear(texture2D(envMap, uv_10));\r\n\r\n\tvec2 uv_20 = getCubeUV(reflectedDirection, r2, level0);\r\n\tvec4 color20 = envMapTexelToLinear(texture2D(envMap, uv_20));\r\n\r\n\tvec4 result = mix(color10, color20, t);\r\n\r\n\treturn vec4(result.rgb, 1.0);\r\n}\r\n\r\n#endif\r\n",defaultnormal_vertex:"vec3 transformedNormal = normalMatrix * objectNormal;\r\n\r\n#ifdef FLIP_SIDED\r\n\r\n\ttransformedNormal = - transformedNormal;\r\n\r\n#endif\r\n",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\r\n\r\n\tuniform sampler2D displacementMap;\r\n\tuniform float displacementScale;\r\n\tuniform float displacementBias;\r\n\r\n#endif\r\n",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\r\n\r\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, uv ).x * displacementScale + displacementBias );\r\n\r\n#endif\r\n",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\r\n\r\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\r\n\r\n\temissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;\r\n\r\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\r\n\r\n#endif\r\n",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\r\n\r\n\tuniform sampler2D emissiveMap;\r\n\r\n#endif\r\n",encodings_fragment:"  gl_FragColor = linearToOutputTexel( gl_FragColor );\r\n",encodings_pars_fragment:"// For a discussion of what this is, please read this: http://lousodrome.net/blog/light/2013/05/26/gamma-correct-and-hdr-rendering-in-a-32-bits-buffer/\r\n\r\nvec4 LinearToLinear( in vec4 value ) {\r\n\treturn value;\r\n}\r\n\r\nvec4 GammaToLinear( in vec4 value, in float gammaFactor ) {\r\n\treturn vec4( pow( value.xyz, vec3( gammaFactor ) ), value.w );\r\n}\r\nvec4 LinearToGamma( in vec4 value, in float gammaFactor ) {\r\n\treturn vec4( pow( value.xyz, vec3( 1.0 / gammaFactor ) ), value.w );\r\n}\r\n\r\nvec4 sRGBToLinear( in vec4 value ) {\r\n\treturn vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.w );\r\n}\r\nvec4 LinearTosRGB( in vec4 value ) {\r\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.w );\r\n}\r\n\r\nvec4 RGBEToLinear( in vec4 value ) {\r\n\treturn vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );\r\n}\r\nvec4 LinearToRGBE( in vec4 value ) {\r\n\tfloat maxComponent = max( max( value.r, value.g ), value.b );\r\n\tfloat fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );\r\n\treturn vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );\r\n//  return vec4( value.brg, ( 3.0 + 128.0 ) / 256.0 );\r\n}\r\n\r\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\r\nvec4 RGBMToLinear( in vec4 value, in float maxRange ) {\r\n\treturn vec4( value.xyz * value.w * maxRange, 1.0 );\r\n}\r\nvec4 LinearToRGBM( in vec4 value, in float maxRange ) {\r\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\r\n\tfloat M      = clamp( maxRGB / maxRange, 0.0, 1.0 );\r\n\tM            = ceil( M * 255.0 ) / 255.0;\r\n\treturn vec4( value.rgb / ( M * maxRange ), M );\r\n}\r\n\r\n// reference: http://iwasbeingirony.blogspot.ca/2010/06/difference-between-rgbm-and-rgbd.html\r\nvec4 RGBDToLinear( in vec4 value, in float maxRange ) {\r\n\treturn vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );\r\n}\r\nvec4 LinearToRGBD( in vec4 value, in float maxRange ) {\r\n\tfloat maxRGB = max( value.x, max( value.g, value.b ) );\r\n\tfloat D      = max( maxRange / maxRGB, 1.0 );\r\n\tD            = min( floor( D ) / 255.0, 1.0 );\r\n\treturn vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );\r\n}\r\n\r\n// LogLuv reference: http://graphicrants.blogspot.ca/2009/04/rgbm-color-encoding.html\r\n\r\n// M matrix, for encoding\r\nconst mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );\r\nvec4 LinearToLogLuv( in vec4 value )  {\r\n\tvec3 Xp_Y_XYZp = value.rgb * cLogLuvM;\r\n\tXp_Y_XYZp = max(Xp_Y_XYZp, vec3(1e-6, 1e-6, 1e-6));\r\n\tvec4 vResult;\r\n\tvResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;\r\n\tfloat Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;\r\n\tvResult.w = fract(Le);\r\n\tvResult.z = (Le - (floor(vResult.w*255.0))/255.0)/255.0;\r\n\treturn vResult;\r\n}\r\n\r\n// Inverse M matrix, for decoding\r\nconst mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );\r\nvec4 LogLuvToLinear( in vec4 value ) {\r\n\tfloat Le = value.z * 255.0 + value.w;\r\n\tvec3 Xp_Y_XYZp;\r\n\tXp_Y_XYZp.y = exp2((Le - 127.0) / 2.0);\r\n\tXp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;\r\n\tXp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;\r\n\tvec3 vRGB = Xp_Y_XYZp.rgb * cLogLuvInverseM;\r\n\treturn vec4( max(vRGB, 0.0), 1.0 );\r\n}\r\n",envmap_fragment:"#ifdef USE_ENVMAP\r\n\r\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\r\n\r\n\t\tvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\r\n\r\n\t\t// Transforming Normal Vectors with the Inverse Transformation\r\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\r\n\r\n\t\t#ifdef ENVMAP_MODE_REFLECTION\r\n\r\n\t\t\tvec3 reflectVec = reflect( cameraToVertex, worldNormal );\r\n\r\n\t\t#else\r\n\r\n\t\t\tvec3 reflectVec = refract( cameraToVertex, worldNormal, refractionRatio );\r\n\r\n\t\t#endif\r\n\r\n\t#else\r\n\r\n\t\tvec3 reflectVec = vReflect;\r\n\r\n\t#endif\r\n\r\n\t#ifdef ENVMAP_TYPE_CUBE\r\n\r\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\r\n\r\n\t#elif defined( ENVMAP_TYPE_EQUIREC )\r\n\r\n\t\tvec2 sampleUV;\r\n\r\n\t\treflectVec = normalize( reflectVec );\r\n\r\n\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\r\n\r\n\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\r\n\r\n\t\tvec4 envColor = texture2D( envMap, sampleUV );\r\n\r\n\t#elif defined( ENVMAP_TYPE_SPHERE )\r\n\r\n\t\treflectVec = normalize( reflectVec );\r\n\r\n\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );\r\n\r\n\t\tvec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );\r\n\r\n\t#else\r\n\r\n\t\tvec4 envColor = vec4( 0.0 );\r\n\r\n\t#endif\r\n\r\n\tenvColor = envMapTexelToLinear( envColor );\r\n\r\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\r\n\r\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\r\n\r\n\t#elif defined( ENVMAP_BLENDING_MIX )\r\n\r\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\r\n\r\n\t#elif defined( ENVMAP_BLENDING_ADD )\r\n\r\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\r\n\r\n\t#endif\r\n\r\n#endif\r\n",envmap_pars_fragment:"#if defined( USE_ENVMAP ) || defined( PHYSICAL )\r\n\tuniform float reflectivity;\r\n\tuniform float envMapIntensity;\r\n#endif\r\n\r\n#ifdef USE_ENVMAP\r\n\r\n\t#if ! defined( PHYSICAL ) && ( defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) )\r\n\t\tvarying vec3 vWorldPosition;\r\n\t#endif\r\n\r\n\t#ifdef ENVMAP_TYPE_CUBE\r\n\t\tuniform samplerCube envMap;\r\n\t#else\r\n\t\tuniform sampler2D envMap;\r\n\t#endif\r\n\tuniform float flipEnvMap;\r\n\r\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( PHYSICAL )\r\n\t\tuniform float refractionRatio;\r\n\t#else\r\n\t\tvarying vec3 vReflect;\r\n\t#endif\r\n\r\n#endif\r\n",envmap_pars_vertex:"#ifdef USE_ENVMAP\r\n\r\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\r\n\t\tvarying vec3 vWorldPosition;\r\n\r\n\t#else\r\n\r\n\t\tvarying vec3 vReflect;\r\n\t\tuniform float refractionRatio;\r\n\r\n\t#endif\r\n\r\n#endif\r\n",envmap_vertex:"#ifdef USE_ENVMAP\r\n\r\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\r\n\r\n\t\tvWorldPosition = worldPosition.xyz;\r\n\r\n\t#else\r\n\r\n\t\tvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\r\n\r\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\r\n\r\n\t\t#ifdef ENVMAP_MODE_REFLECTION\r\n\r\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\r\n\r\n\t\t#else\r\n\r\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\r\n\r\n\t\t#endif\r\n\r\n\t#endif\r\n\r\n#endif\r\n",fog_vertex:"\r\n#ifdef USE_FOG\r\nfogDepth = -mvPosition.z;\r\n#endif",fog_pars_vertex:"#ifdef USE_FOG\r\n\r\n  varying float fogDepth;\r\n\r\n#endif\r\n",fog_fragment:"#ifdef USE_FOG\r\n\r\n\t#ifdef FOG_EXP2\r\n\r\n\t\tfloat fogFactor = whiteCompliment( exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 ) );\r\n\r\n\t#else\r\n\r\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, fogDepth );\r\n\r\n\t#endif\r\n\r\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\r\n\r\n#endif\r\n",fog_pars_fragment:"#ifdef USE_FOG\r\n\r\n\tuniform vec3 fogColor;\r\n\tvarying float fogDepth;\r\n\r\n\t#ifdef FOG_EXP2\r\n\r\n\t\tuniform float fogDensity;\r\n\r\n\t#else\r\n\r\n\t\tuniform float fogNear;\r\n\t\tuniform float fogFar;\r\n\r\n\t#endif\r\n\r\n#endif\r\n",gradientmap_pars_fragment:"#ifdef TOON\r\n\r\n\tuniform sampler2D gradientMap;\r\n\r\n\tvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\r\n\r\n\t\t// dotNL will be from -1.0 to 1.0\r\n\t\tfloat dotNL = dot( normal, lightDirection );\r\n\t\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\r\n\r\n\t\t#ifdef USE_GRADIENTMAP\r\n\r\n\t\t\treturn texture2D( gradientMap, coord ).rgb;\r\n\r\n\t\t#else\r\n\r\n\t\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\r\n\r\n\t\t#endif\r\n\r\n\r\n\t}\r\n\r\n#endif\r\n",lightmap_fragment:"#ifdef USE_LIGHTMAP\r\n\r\n\treflectedLight.indirectDiffuse += PI * texture2D( lightMap, vUv2 ).xyz * lightMapIntensity; // factor of PI should not be present; included here to prevent breakage\r\n\r\n#endif\r\n",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\r\n\r\n\tuniform sampler2D lightMap;\r\n\tuniform float lightMapIntensity;\r\n\r\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\r\n\r\nGeometricContext geometry;\r\ngeometry.position = mvPosition.xyz;\r\ngeometry.normal = normalize( transformedNormal );\r\ngeometry.viewDir = normalize( -mvPosition.xyz );\r\n\r\nGeometricContext backGeometry;\r\nbackGeometry.position = geometry.position;\r\nbackGeometry.normal = -geometry.normal;\r\nbackGeometry.viewDir = geometry.viewDir;\r\n\r\nvLightFront = vec3( 0.0 );\r\n\r\n#ifdef DOUBLE_SIDED\r\n\tvLightBack = vec3( 0.0 );\r\n#endif\r\n\r\nIncidentLight directLight;\r\nfloat dotNL;\r\nvec3 directLightColor_Diffuse;\r\n\r\n#if NUM_POINT_LIGHTS > 0\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\r\n\r\n\t\tgetPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );\r\n\r\n\t\tdotNL = dot( geometry.normal, directLight.direction );\r\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\r\n\r\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#ifdef DOUBLE_SIDED\r\n\r\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n#if NUM_SPOT_LIGHTS > 0\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\r\n\r\n\t\tgetSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );\r\n\r\n\t\tdotNL = dot( geometry.normal, directLight.direction );\r\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\r\n\r\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#ifdef DOUBLE_SIDED\r\n\r\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#endif\r\n\t}\r\n\r\n#endif\r\n\r\n\r\n\r\n#if NUM_DIR_LIGHTS > 0\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n\r\n\t\tgetDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );\r\n\r\n\t\tdotNL = dot( geometry.normal, directLight.direction );\r\n\t\tdirectLightColor_Diffuse = PI * directLight.color;\r\n\r\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#ifdef DOUBLE_SIDED\r\n\r\n\t\t\tvLightBack += saturate( -dotNL ) * directLightColor_Diffuse;\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n#if NUM_HEMI_LIGHTS > 0\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\r\n\r\n\t\tvLightFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\r\n\r\n\t\t#ifdef DOUBLE_SIDED\r\n\r\n\t\t\tvLightBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\r\n#endif\r\n",lights_pars:"uniform vec3 ambientLightColor;\r\n\r\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\r\n\r\n\tvec3 irradiance = ambientLightColor;\r\n\r\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\tirradiance *= PI;\r\n\r\n\t#endif\r\n\r\n\treturn irradiance;\r\n\r\n}\r\n\r\n#if NUM_DIR_LIGHTS > 0\r\n\r\n\tstruct DirectionalLight {\r\n\t\tvec3 direction;\r\n\t\tvec3 color;\r\n\r\n\t\tint shadow;\r\n\t\tfloat shadowBias;\r\n\t\tfloat shadowRadius;\r\n\t\tvec2 shadowMapSize;\r\n\t};\r\n\r\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\r\n\r\n\tvoid getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {\r\n\r\n\t\tdirectLight.color = directionalLight.color;\r\n\t\tdirectLight.direction = directionalLight.direction;\r\n\t\tdirectLight.visible = true;\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n\r\n#if NUM_POINT_LIGHTS > 0\r\n\r\n\tstruct PointLight {\r\n\t\tvec3 position;\r\n\t\tvec3 color;\r\n\t\tfloat distance;\r\n\t\tfloat decay;\r\n\r\n\t\tint shadow;\r\n\t\tfloat shadowBias;\r\n\t\tfloat shadowRadius;\r\n\t\tvec2 shadowMapSize;\r\n\t\tfloat shadowCameraNear;\r\n\t\tfloat shadowCameraFar;\r\n\t};\r\n\r\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\r\n\r\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\r\n\tvoid getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {\r\n\r\n\t\tvec3 lVector = pointLight.position - geometry.position;\r\n\t\tdirectLight.direction = normalize( lVector );\r\n\r\n\t\tfloat lightDistance = length( lVector );\r\n\r\n\t\tdirectLight.color = pointLight.color;\r\n\t\tdirectLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );\r\n\t\tdirectLight.visible = ( directLight.color != vec3( 0.0 ) );\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n\r\n#if NUM_SPOT_LIGHTS > 0\r\n\r\n\tstruct SpotLight {\r\n\t\tvec3 position;\r\n\t\tvec3 direction;\r\n\t\tvec3 color;\r\n\t\tfloat distance;\r\n\t\tfloat decay;\r\n\t\tfloat coneCos;\r\n\t\tfloat penumbraCos;\r\n\r\n\t\tint shadow;\r\n\t\tfloat shadowBias;\r\n\t\tfloat shadowRadius;\r\n\t\tvec2 shadowMapSize;\r\n\t};\r\n\r\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\r\n\r\n\t// directLight is an out parameter as having it as a return value caused compiler errors on some devices\r\n\tvoid getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {\r\n\r\n\t\tvec3 lVector = spotLight.position - geometry.position;\r\n\t\tdirectLight.direction = normalize( lVector );\r\n\r\n\t\tfloat lightDistance = length( lVector );\r\n\t\tfloat angleCos = dot( directLight.direction, spotLight.direction );\r\n\r\n\t\tif ( angleCos > spotLight.coneCos ) {\r\n\r\n\t\t\tfloat spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );\r\n\r\n\t\t\tdirectLight.color = spotLight.color;\r\n\t\t\tdirectLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );\r\n\t\t\tdirectLight.visible = true;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tdirectLight.color = vec3( 0.0 );\r\n\t\t\tdirectLight.visible = false;\r\n\r\n\t\t}\r\n\t}\r\n\r\n#endif\r\n\r\n\r\n#if NUM_RECT_AREA_LIGHTS > 0\r\n\r\n\tstruct RectAreaLight {\r\n\t\tvec3 color;\r\n\t\tvec3 position;\r\n\t\tvec3 halfWidth;\r\n\t\tvec3 halfHeight;\r\n\t};\r\n\r\n\t// Pre-computed values of LinearTransformedCosine approximation of BRDF\r\n\t// BRDF approximation Texture is 64x64\r\n\tuniform sampler2D ltc_1; // RGBA Float\r\n\tuniform sampler2D ltc_2; // RGBA Float\r\n\r\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\r\n\r\n#endif\r\n\r\n\r\n#if NUM_HEMI_LIGHTS > 0\r\n\r\n\tstruct HemisphereLight {\r\n\t\tvec3 direction;\r\n\t\tvec3 skyColor;\r\n\t\tvec3 groundColor;\r\n\t};\r\n\r\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\r\n\r\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {\r\n\r\n\t\tfloat dotNL = dot( geometry.normal, hemiLight.direction );\r\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\r\n\r\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\r\n\r\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\t\tirradiance *= PI;\r\n\r\n\t\t#endif\r\n\r\n\t\treturn irradiance;\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n\r\n#if defined( USE_ENVMAP ) && defined( PHYSICAL )\r\n\r\n\tvec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {\r\n\r\n\t\tvec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );\r\n\r\n\t\t#ifdef ENVMAP_TYPE_CUBE\r\n\r\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\r\n\r\n\t\t\t// TODO: replace with properly filtered cubemaps and access the irradiance LOD level, be it the last LOD level\r\n\t\t\t// of a specular cubemap, or just the default level of a specially created irradiance cubemap.\r\n\r\n\t\t\t#ifdef TEXTURE_LOD_EXT\r\n\r\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );\r\n\r\n\t\t\t#else\r\n\r\n\t\t\t\t// force the bias high to get the last LOD level as it is the most blurred.\r\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );\r\n\r\n\t\t\t#endif\r\n\r\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\r\n\r\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\r\n\r\n\t\t\tvec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );\r\n\t\t\tvec4 envMapColor = textureCubeUV( queryVec, 1.0 );\r\n\r\n\t\t#else\r\n\r\n\t\t\tvec4 envMapColor = vec4( 0.0 );\r\n\r\n\t\t#endif\r\n\r\n\t\treturn PI * envMapColor.rgb * envMapIntensity;\r\n\r\n\t}\r\n\r\n\t// taken from here: http://casual-effects.blogspot.ca/2011/08/plausible-environment-lighting-in-two.html\r\n\tfloat getSpecularMIPLevel( const in float blinnShininessExponent, const in int maxMIPLevel ) {\r\n\r\n\t\t//float envMapWidth = pow( 2.0, maxMIPLevelScalar );\r\n\t\t//float desiredMIPLevel = log2( envMapWidth * sqrt( 3.0 ) ) - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\r\n\r\n\t\tfloat maxMIPLevelScalar = float( maxMIPLevel );\r\n\t\tfloat desiredMIPLevel = maxMIPLevelScalar + 0.79248 - 0.5 * log2( pow2( blinnShininessExponent ) + 1.0 );\r\n\r\n\t\t// clamp to allowable LOD ranges.\r\n\t\treturn clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );\r\n\r\n\t}\r\n\r\n\tvec3 getLightProbeIndirectRadiance( const in GeometricContext geometry, const in float blinnShininessExponent, const in int maxMIPLevel ) {\r\n\r\n\t\t#ifdef ENVMAP_MODE_REFLECTION\r\n\r\n\t\t\tvec3 reflectVec = reflect( -geometry.viewDir, geometry.normal );\r\n\r\n\t\t#else\r\n\r\n\t\t\tvec3 reflectVec = refract( -geometry.viewDir, geometry.normal, refractionRatio );\r\n\r\n\t\t#endif\r\n\r\n\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\r\n\r\n\t\tfloat specularMIPLevel = getSpecularMIPLevel( blinnShininessExponent, maxMIPLevel );\r\n\r\n\t\t#ifdef ENVMAP_TYPE_CUBE\r\n\r\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\r\n\r\n\t\t\t#ifdef TEXTURE_LOD_EXT\r\n\r\n\t\t\t\tvec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );\r\n\r\n\t\t\t#else\r\n\r\n\t\t\t\tvec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );\r\n\r\n\t\t\t#endif\r\n\r\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\r\n\r\n\t\t#elif defined( ENVMAP_TYPE_CUBE_UV )\r\n\r\n\t\t\tvec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );\r\n\t\t\tvec4 envMapColor = textureCubeUV(queryReflectVec, BlinnExponentToGGXRoughness(blinnShininessExponent));\r\n\r\n\t\t#elif defined( ENVMAP_TYPE_EQUIREC )\r\n\r\n\t\t\tvec2 sampleUV;\r\n\t\t\tsampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\r\n\t\t\tsampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;\r\n\r\n\t\t\t#ifdef TEXTURE_LOD_EXT\r\n\r\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );\r\n\r\n\t\t\t#else\r\n\r\n\t\t\t\tvec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );\r\n\r\n\t\t\t#endif\r\n\r\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\r\n\r\n\t\t#elif defined( ENVMAP_TYPE_SPHERE )\r\n\r\n\t\t\tvec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );\r\n\r\n\t\t\t#ifdef TEXTURE_LOD_EXT\r\n\r\n\t\t\t\tvec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\r\n\r\n\t\t\t#else\r\n\r\n\t\t\t\tvec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );\r\n\r\n\t\t\t#endif\r\n\r\n\t\t\tenvMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;\r\n\r\n\t\t#endif\r\n\r\n\t\treturn envMapColor.rgb * envMapIntensity;\r\n\r\n\t}\r\n\r\n#endif\r\n",lights_phong_fragment:"BlinnPhongMaterial material;\r\nmaterial.diffuseColor = diffuseColor.rgb;\r\nmaterial.specularColor = specular;\r\nmaterial.specularShininess = shininess;\r\nmaterial.specularStrength = specularStrength;\r\n",lights_phong_pars_fragment:"varying vec3 vViewPosition;\r\n\r\n#ifndef FLAT_SHADED\r\n\r\n\tvarying vec3 vNormal;\r\n\r\n#endif\r\n\r\n\r\nstruct BlinnPhongMaterial {\r\n\r\n\tvec3\tdiffuseColor;\r\n\tvec3\tspecularColor;\r\n\tfloat\tspecularShininess;\r\n\tfloat\tspecularStrength;\r\n\r\n};\r\n\r\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\t#ifdef TOON\r\n\r\n\t\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\r\n\r\n\t#else\r\n\r\n\t\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\r\n\t\tvec3 irradiance = dotNL * directLight.color;\r\n\r\n\t#endif\r\n\r\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\tirradiance *= PI; // punctual light\r\n\r\n\t#endif\r\n\r\n\treflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n\r\n\treflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;\r\n\r\n}\r\n\r\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n\r\n}\r\n\r\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\r\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\r\n\r\n#define Material_LightProbeLOD( material )\t(0)\r\n",lights_physical_fragment:"PhysicalMaterial material;\r\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\r\nmaterial.specularRoughness = clamp( roughnessFactor, 0.04, 1.0 );\r\n#ifdef STANDARD\r\n\tmaterial.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );\r\n#else\r\n\tmaterial.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );\r\n\tmaterial.clearCoat = saturate( clearCoat ); // Burley clearcoat model\r\n\tmaterial.clearCoatRoughness = clamp( clearCoatRoughness, 0.04, 1.0 );\r\n#endif\r\n",lights_physical_pars_fragment:"struct PhysicalMaterial {\r\n\r\n\tvec3\tdiffuseColor;\r\n\tfloat\tspecularRoughness;\r\n\tvec3\tspecularColor;\r\n\r\n\t#ifndef STANDARD\r\n\t\tfloat clearCoat;\r\n\t\tfloat clearCoatRoughness;\r\n\t#endif\r\n\r\n};\r\n\r\n#define MAXIMUM_SPECULAR_COEFFICIENT 0.16\r\n#define DEFAULT_SPECULAR_COEFFICIENT 0.04\r\n\r\n// Clear coat directional hemishperical reflectance (this approximation should be improved)\r\nfloat clearCoatDHRApprox( const in float roughness, const in float dotNL ) {\r\n\r\n\treturn DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );\r\n\r\n}\r\n\r\n#if NUM_RECT_AREA_LIGHTS > 0\r\n\r\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\t\tvec3 normal = geometry.normal;\r\n\t\tvec3 viewDir = geometry.viewDir;\r\n\t\tvec3 position = geometry.position;\r\n\t\tvec3 lightPos = rectAreaLight.position;\r\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\r\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\r\n\t\tvec3 lightColor = rectAreaLight.color;\r\n\t\tfloat roughness = material.specularRoughness;\r\n\r\n\t\tvec3 rectCoords[ 4 ];\r\n\t\trectCoords[ 0 ] = lightPos - halfWidth - halfHeight; // counterclockwise\r\n\t\trectCoords[ 1 ] = lightPos + halfWidth - halfHeight;\r\n\t\trectCoords[ 2 ] = lightPos + halfWidth + halfHeight;\r\n\t\trectCoords[ 3 ] = lightPos - halfWidth + halfHeight;\r\n\r\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\r\n\r\n\t\tvec4 t1 = texture2D( ltc_1, uv );\r\n\t\tvec4 t2 = texture2D( ltc_2, uv );\r\n\r\n\t\tmat3 mInv = mat3(\r\n\t\t\tvec3( t1.x, 0, t1.y ),\r\n\t\t\tvec3(    0, 1,    0 ),\r\n\t\t\tvec3( t1.z, 0, t1.w )\r\n\t\t);\r\n\r\n\t\t// LTC Fresnel Approximation by Stephen Hill\r\n\t\t// http://blog.selfshadow.com/publications/s2016-advances/s2016_ltc_fresnel.pdf\r\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\r\n\r\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\r\n\r\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\r\n\r\n\t}\r\n\r\n#endif\r\n\r\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\r\n\r\n\tvec3 irradiance = dotNL * directLight.color;\r\n\r\n\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\tirradiance *= PI; // punctual light\r\n\r\n\t#endif\r\n\r\n\t#ifndef STANDARD\r\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\r\n\t#else\r\n\t\tfloat clearCoatDHR = 0.0;\r\n\t#endif\r\n\r\n\treflectedLight.directSpecular += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry, material.specularColor, material.specularRoughness );\r\n\r\n\treflectedLight.directDiffuse += ( 1.0 - clearCoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n\r\n\t#ifndef STANDARD\r\n\r\n\t\treflectedLight.directSpecular += irradiance * material.clearCoat * BRDF_Specular_GGX( directLight, geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\r\n\r\n\t#endif\r\n\r\n}\r\n\r\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );\r\n\r\n}\r\n\r\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 clearCoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\r\n\r\n\t#ifndef STANDARD\r\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\r\n\t\tfloat dotNL = dotNV;\r\n\t\tfloat clearCoatDHR = material.clearCoat * clearCoatDHRApprox( material.clearCoatRoughness, dotNL );\r\n\t#else\r\n\t\tfloat clearCoatDHR = 0.0;\r\n\t#endif\r\n\r\n\treflectedLight.indirectSpecular += ( 1.0 - clearCoatDHR ) * radiance * BRDF_Specular_GGX_Environment( geometry, material.specularColor, material.specularRoughness );\r\n\r\n\t#ifndef STANDARD\r\n\r\n\t\treflectedLight.indirectSpecular += clearCoatRadiance * material.clearCoat * BRDF_Specular_GGX_Environment( geometry, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearCoatRoughness );\r\n\r\n\t#endif\r\n\r\n}\r\n\r\n#define RE_Direct\t\t\t\tRE_Direct_Physical\r\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\r\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\r\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\r\n\r\n#define Material_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.specularRoughness )\r\n#define Material_ClearCoat_BlinnShininessExponent( material )   GGXRoughnessToBlinnExponent( material.clearCoatRoughness )\r\n\r\n// ref: https://seblagarde.files.wordpress.com/2015/07/course_notes_moving_frostbite_to_pbr_v32.pdf\r\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\r\n\r\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\r\n\r\n}\r\n",lights_template:"\r\n\r\nGeometricContext geometry;\r\n\r\ngeometry.position = - vViewPosition;\r\ngeometry.normal = normal;\r\ngeometry.viewDir = normalize( vViewPosition );\r\n\r\nIncidentLight directLight;\r\n\r\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\r\n\r\n\tPointLight pointLight;\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\r\n\r\n\t\tpointLight = pointLights[ i ];\r\n\r\n\t\tgetPointDirectLightIrradiance( pointLight, geometry, directLight );\r\n\r\n\t\t#ifdef USE_SHADOWMAP\r\n\t\tdirectLight.color *= all( bvec2( pointLight.shadow, directLight.visible ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\r\n\t\t#endif\r\n\r\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\r\n\r\n\tSpotLight spotLight;\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\r\n\r\n\t\tspotLight = spotLights[ i ];\r\n\r\n\t\tgetSpotDirectLightIrradiance( spotLight, geometry, directLight );\r\n\r\n\t\t#ifdef USE_SHADOWMAP\r\n\t\tdirectLight.color *= all( bvec2( spotLight.shadow, directLight.visible ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\r\n\t\t#endif\r\n\r\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\r\n\r\n\tDirectionalLight directionalLight;\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n\r\n\t\tdirectionalLight = directionalLights[ i ];\r\n\r\n\t\tgetDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );\r\n\r\n\t\t#ifdef USE_SHADOWMAP\r\n\t\tdirectLight.color *= all( bvec2( directionalLight.shadow, directLight.visible ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\r\n\t\t#endif\r\n\r\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\r\n\r\n\tRectAreaLight rectAreaLight;\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\r\n\r\n\t\trectAreaLight = rectAreaLights[ i ];\r\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\r\n\r\n\t}\r\n\r\n#endif\r\n\r\n#if defined( RE_IndirectDiffuse )\r\n\r\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\r\n\r\n\t#ifdef USE_LIGHTMAP\r\n\r\n\t\tvec3 lightMapIrradiance = texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\r\n\r\n\t\t#ifndef PHYSICALLY_CORRECT_LIGHTS\r\n\r\n\t\t\tlightMapIrradiance *= PI; // factor of PI should not be present; included here to prevent breakage\r\n\r\n\t\t#endif\r\n\r\n\t\tirradiance += lightMapIrradiance;\r\n\r\n\t#endif\r\n\r\n\t#if ( NUM_HEMI_LIGHTS > 0 )\r\n\r\n\t\t#pragma unroll_loop\r\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\r\n\r\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );\r\n\r\n\t\t}\r\n\r\n\t#endif\r\n\r\n\t#if defined( USE_ENVMAP ) && defined( PHYSICAL ) && defined( ENVMAP_TYPE_CUBE_UV )\r\n\r\n\t\t// TODO, replace 8 with the real maxMIPLevel\r\n\t\tirradiance += getLightProbeIndirectIrradiance( geometry, 8 );\r\n\r\n\t#endif\r\n\r\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\r\n\r\n#endif\r\n\r\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\r\n\r\n\t// TODO, replace 8 with the real maxMIPLevel\r\n\tvec3 radiance = getLightProbeIndirectRadiance( geometry, Material_BlinnShininessExponent( material ), 8 );\r\n\r\n\t#ifndef STANDARD\r\n\t\tvec3 clearCoatRadiance = getLightProbeIndirectRadiance( geometry, Material_ClearCoat_BlinnShininessExponent( material ), 8 );\r\n\t#else\r\n\t\tvec3 clearCoatRadiance = vec3( 0.0 );\r\n\t#endif\r\n\r\n\tRE_IndirectSpecular( radiance, clearCoatRadiance, geometry, material, reflectedLight );\r\n\r\n#endif\r\n",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\r\n\r\n\tgl_FragDepthEXT = log2( vFragDepth ) * logDepthBufFC * 0.5;\r\n\r\n#endif",logdepthbuf_pars_fragment:"#ifdef USE_LOGDEPTHBUF\r\n\r\n\tuniform float logDepthBufFC;\r\n\r\n\t#ifdef USE_LOGDEPTHBUF_EXT\r\n\r\n\t\tvarying float vFragDepth;\r\n\r\n\t#endif\r\n\r\n#endif\r\n",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\r\n\r\n\t#ifdef USE_LOGDEPTHBUF_EXT\r\n\r\n\t\tvarying float vFragDepth;\r\n\r\n\t#endif\r\n\r\n\tuniform float logDepthBufFC;\r\n\r\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\r\n\r\n\t#ifdef USE_LOGDEPTHBUF_EXT\r\n\r\n\t\tvFragDepth = 1.0 + gl_Position.w;\r\n\r\n\t#else\r\n\r\n\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\r\n\r\n\t\tgl_Position.z *= gl_Position.w;\r\n\r\n\t#endif\r\n\r\n#endif\r\n",map_fragment:"#ifdef USE_MAP\r\n\r\n\tvec4 texelColor = texture2D( map, vUv );\r\n\r\n\ttexelColor = mapTexelToLinear( texelColor );\r\n\tdiffuseColor *= texelColor;\r\n\r\n#endif\r\n",map_pars_fragment:"#ifdef USE_MAP\r\n\r\n\tuniform sampler2D map;\r\n\r\n#endif\r\n",map_particle_fragment:"#ifdef USE_MAP\r\n\r\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\r\n\tvec4 mapTexel = texture2D( map, uv );\r\n\tdiffuseColor *= mapTexelToLinear( mapTexel );\r\n\r\n#endif\r\n",map_particle_pars_fragment:"#ifdef USE_MAP\r\n\r\n\tuniform mat3 uvTransform;\r\n\tuniform sampler2D map;\r\n\r\n#endif\r\n",metalnessmap_fragment:"float metalnessFactor = metalness;\r\n\r\n#ifdef USE_METALNESSMAP\r\n\r\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\r\n\r\n\t// reads channel B, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\r\n\tmetalnessFactor *= texelMetalness.b;\r\n\r\n#endif\r\n",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\r\n\r\n\tuniform sampler2D metalnessMap;\r\n\r\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\r\n\r\n\tobjectNormal += ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\r\n\tobjectNormal += ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\r\n\tobjectNormal += ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\r\n\tobjectNormal += ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\r\n\r\n#endif\r\n",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\r\n\r\n\t#ifndef USE_MORPHNORMALS\r\n\r\n\tuniform float morphTargetInfluences[ 8 ];\r\n\r\n\t#else\r\n\r\n\tuniform float morphTargetInfluences[ 4 ];\r\n\r\n\t#endif\r\n\r\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\r\n\r\n\ttransformed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\r\n\ttransformed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\r\n\ttransformed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\r\n\ttransformed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\r\n\r\n\t#ifndef USE_MORPHNORMALS\r\n\r\n\ttransformed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\r\n\ttransformed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\r\n\ttransformed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\r\n\ttransformed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\r\n\r\n\t#endif\r\n\r\n#endif\r\n",normal_fragment:"#ifdef FLAT_SHADED\r\n\r\n\t// Workaround for Adreno/Nexus5 not able able to do dFdx( vViewPosition ) ...\r\n\r\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\r\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\r\n\tvec3 normal = normalize( cross( fdx, fdy ) );\r\n\r\n#else\r\n\r\n\tvec3 normal = normalize( vNormal );\r\n\r\n\t#ifdef DOUBLE_SIDED\r\n\r\n\t\tnormal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\r\n\r\n\t#endif\r\n\r\n#endif\r\n\r\n#ifdef USE_NORMALMAP\r\n\r\n\tnormal = perturbNormal2Arb( -vViewPosition, normal );\r\n\r\n#elif defined( USE_BUMPMAP )\r\n\r\n\tnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\r\n\r\n#endif\r\n",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\r\n\r\n\tuniform sampler2D normalMap;\r\n\tuniform vec2 normalScale;\r\n\r\n\t// Per-Pixel Tangent Space Normal Mapping\r\n\t// http://hacksoflife.blogspot.ch/2009/11/per-pixel-tangent-space-normal-mapping.html\r\n\r\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\r\n\r\n\t\t// Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988\r\n\r\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\r\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\r\n\t\tvec2 st0 = dFdx( vUv.st );\r\n\t\tvec2 st1 = dFdy( vUv.st );\r\n\r\n\t\tvec3 S = normalize( q0 * st1.t - q1 * st0.t );\r\n\t\tvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\r\n\t\tvec3 N = normalize( surf_norm );\r\n\r\n\t\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\r\n\t\tmapN.xy = normalScale * mapN.xy;\r\n\t\tmat3 tsn = mat3( S, T, N );\r\n\t\treturn normalize( tsn * mapN );\r\n\r\n\t}\r\n\r\n#endif\r\n",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\r\n\treturn normalize( normal ) * 0.5 + 0.5;\r\n}\r\n\r\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\r\n\treturn 2.0 * rgb.xyz - 1.0;\r\n}\r\n\r\nconst float PackUpscale = 256. / 255.; // fraction -> 0..1 (including 1)\r\nconst float UnpackDownscale = 255. / 256.; // 0..1 -> fraction (excluding 1)\r\n\r\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );\r\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\r\n\r\nconst float ShiftRight8 = 1. / 256.;\r\n\r\nvec4 packDepthToRGBA( const in float v ) {\r\n\tvec4 r = vec4( fract( v * PackFactors ), v );\r\n\tr.yzw -= r.xyz * ShiftRight8; // tidy overflow\r\n\treturn r * PackUpscale;\r\n}\r\n\r\nfloat unpackRGBAToDepth( const in vec4 v ) {\r\n\treturn dot( v, UnpackFactors );\r\n}\r\n\r\n// NOTE: viewZ/eyeZ is < 0 when in front of the camera per OpenGL conventions\r\n\r\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\r\n\treturn ( viewZ + near ) / ( near - far );\r\n}\r\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\r\n\treturn linearClipZ * ( near - far ) - near;\r\n}\r\n\r\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\r\n\treturn (( near + viewZ ) * far ) / (( far - near ) * viewZ );\r\n}\r\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\r\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\r\n}\r\n",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\r\n\r\n\t// Get get normal blending with premultipled, use with CustomBlending, OneFactor, OneMinusSrcAlphaFactor, AddEquation.\r\n\tgl_FragColor.rgb *= gl_FragColor.a;\r\n\r\n#endif\r\n",project_vertex:"vec4 mvPosition = modelViewMatrix * vec4( transformed, 1.0 );\r\n\r\ngl_Position = projectionMatrix * mvPosition;\r\n",dithering_fragment:"#if defined( DITHERING )\r\n\r\n  gl_FragColor.rgb = dithering( gl_FragColor.rgb );\r\n\r\n#endif\r\n",dithering_pars_fragment:"#if defined( DITHERING )\r\n\r\n\t// based on https://www.shadertoy.com/view/MslGR8\r\n\tvec3 dithering( vec3 color ) {\r\n\t\t//Calculate grid position\r\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\r\n\r\n\t\t//Shift the individual colors differently, thus making it even harder to see the dithering pattern\r\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\r\n\r\n\t\t//modify shift acording to grid position.\r\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\r\n\r\n\t\t//shift the color by dither_shift\r\n\t\treturn color + dither_shift_RGB;\r\n\t}\r\n\r\n#endif\r\n",roughnessmap_fragment:"float roughnessFactor = roughness;\r\n\r\n#ifdef USE_ROUGHNESSMAP\r\n\r\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\r\n\r\n\t// reads channel G, compatible with a combined OcclusionRoughnessMetallic (RGB) texture\r\n\troughnessFactor *= texelRoughness.g;\r\n\r\n#endif\r\n",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\r\n\r\n\tuniform sampler2D roughnessMap;\r\n\r\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\r\n\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\r\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r\n\r\n\t#endif\r\n\r\n\t#if NUM_SPOT_LIGHTS > 0\r\n\r\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHTS ];\r\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\r\n\r\n\t#endif\r\n\r\n\t#if NUM_POINT_LIGHTS > 0\r\n\r\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHTS ];\r\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\r\n\r\n\t#endif\r\n\r\n\r\n\r\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\r\n\r\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\r\n\r\n\t}\r\n\r\n\tfloat texture2DShadowLerp( sampler2D depths, vec2 size, vec2 uv, float compare ) {\r\n\r\n\t\tconst vec2 offset = vec2( 0.0, 1.0 );\r\n\r\n\t\tvec2 texelSize = vec2( 1.0 ) / size;\r\n\t\tvec2 centroidUV = floor( uv * size + 0.5 ) / size;\r\n\r\n\t\tfloat lb = texture2DCompare( depths, centroidUV + texelSize * offset.xx, compare );\r\n\t\tfloat lt = texture2DCompare( depths, centroidUV + texelSize * offset.xy, compare );\r\n\t\tfloat rb = texture2DCompare( depths, centroidUV + texelSize * offset.yx, compare );\r\n\t\tfloat rt = texture2DCompare( depths, centroidUV + texelSize * offset.yy, compare );\r\n\r\n\t\tvec2 f = fract( uv * size + 0.5 );\r\n\r\n\t\tfloat a = mix( lb, lt, f.y );\r\n\t\tfloat b = mix( rb, rt, f.y );\r\n\t\tfloat c = mix( a, b, f.x );\r\n\r\n\t\treturn c;\r\n\r\n\t}\r\n\r\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\r\n\r\n\t\tfloat shadow = 1.0;\r\n\r\n\t\tshadowCoord.xyz /= shadowCoord.w;\r\n\t\tshadowCoord.z += shadowBias;\r\n\r\n\t\t// if ( something && something ) breaks ATI OpenGL shader compiler\r\n\t\t// if ( all( something, something ) ) using this instead\r\n\r\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\r\n\t\tbool inFrustum = all( inFrustumVec );\r\n\r\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\r\n\r\n\t\tbool frustumTest = all( frustumTestVec );\r\n\r\n\t\tif ( frustumTest ) {\r\n\r\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\r\n\r\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\r\n\r\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\r\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\r\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\r\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\r\n\r\n\t\t\tshadow = (\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\r\n\t\t\t) * ( 1.0 / 9.0 );\r\n\r\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\r\n\r\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\r\n\r\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\r\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\r\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\r\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\r\n\r\n\t\t\tshadow = (\r\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy, shadowCoord.z ) +\r\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\r\n\t\t\t\ttexture2DShadowLerp( shadowMap, shadowMapSize, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\r\n\t\t\t) * ( 1.0 / 9.0 );\r\n\r\n\t\t#else // no percentage-closer filtering:\r\n\r\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\r\n\r\n\t\t#endif\r\n\r\n\t\t}\r\n\r\n\t\treturn shadow;\r\n\r\n\t}\r\n\r\n\t// cubeToUV() maps a 3D direction vector suitable for cube texture mapping to a 2D\r\n\t// vector suitable for 2D texture mapping. This code uses the following layout for the\r\n\t// 2D texture:\r\n\t//\r\n\t// xzXZ\r\n\t//  y Y\r\n\t//\r\n\t// Y - Positive y direction\r\n\t// y - Negative y direction\r\n\t// X - Positive x direction\r\n\t// x - Negative x direction\r\n\t// Z - Positive z direction\r\n\t// z - Negative z direction\r\n\t//\r\n\t// Source and test bed:\r\n\t// https://gist.github.com/tschw/da10c43c467ce8afd0c4\r\n\r\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\r\n\r\n\t\t// Number of texels to avoid at the edge of each square\r\n\r\n\t\tvec3 absV = abs( v );\r\n\r\n\t\t// Intersect unit cube\r\n\r\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\r\n\t\tabsV *= scaleToCube;\r\n\r\n\t\t// Apply scale to avoid seams\r\n\r\n\t\t// two texels less per square (one texel will do for NEAREST)\r\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\r\n\r\n\t\t// Unwrap\r\n\r\n\t\t// space: -1 ... 1 range for each square\r\n\t\t//\r\n\t\t// #X##\t\tdim    := ( 4 , 2 )\r\n\t\t//  # #\t\tcenter := ( 1 , 1 )\r\n\r\n\t\tvec2 planar = v.xy;\r\n\r\n\t\tfloat almostATexel = 1.5 * texelSizeY;\r\n\t\tfloat almostOne = 1.0 - almostATexel;\r\n\r\n\t\tif ( absV.z >= almostOne ) {\r\n\r\n\t\t\tif ( v.z > 0.0 )\r\n\t\t\t\tplanar.x = 4.0 - v.x;\r\n\r\n\t\t} else if ( absV.x >= almostOne ) {\r\n\r\n\t\t\tfloat signX = sign( v.x );\r\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\r\n\r\n\t\t} else if ( absV.y >= almostOne ) {\r\n\r\n\t\t\tfloat signY = sign( v.y );\r\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\r\n\t\t\tplanar.y = v.z * signY - 2.0;\r\n\r\n\t\t}\r\n\r\n\t\t// Transform to UV space\r\n\r\n\t\t// scale := 0.5 / dim\r\n\t\t// translate := ( center + 0.5 ) / dim\r\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\r\n\r\n\t}\r\n\r\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\r\n\r\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\r\n\r\n\t\t// for point lights, the uniform @vShadowCoord is re-purposed to hold\r\n\t\t// the vector from the light to the world-space position of the fragment.\r\n\t\tvec3 lightToPosition = shadowCoord.xyz;\r\n\r\n\t\t// dp = normalized distance from light to fragment position\r\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear ); // need to clamp?\r\n\t\tdp += shadowBias;\r\n\r\n\t\t// bd3D = base direction 3D\r\n\t\tvec3 bd3D = normalize( lightToPosition );\r\n\r\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT )\r\n\r\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\r\n\r\n\t\t\treturn (\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\r\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\r\n\t\t\t) * ( 1.0 / 9.0 );\r\n\r\n\t\t#else // no percentage-closer filtering\r\n\r\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\r\n\r\n\t\t#endif\r\n\r\n\t}\r\n\r\n#endif\r\n",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\r\n\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\r\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHTS ];\r\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHTS ];\r\n\r\n\t#endif\r\n\r\n\t#if NUM_SPOT_LIGHTS > 0\r\n\r\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHTS ];\r\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHTS ];\r\n\r\n\t#endif\r\n\r\n\t#if NUM_POINT_LIGHTS > 0\r\n\r\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHTS ];\r\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHTS ];\r\n\r\n\t#endif\r\n\r\n\r\n\r\n#endif\r\n",shadowmap_vertex:"#ifdef USE_SHADOWMAP\r\n\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n\r\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;\r\n\r\n\t}\r\n\r\n\t#endif\r\n\r\n\t#if NUM_SPOT_LIGHTS > 0\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\r\n\r\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;\r\n\r\n\t}\r\n\r\n\t#endif\r\n\r\n\t#if NUM_POINT_LIGHTS > 0\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\r\n\r\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;\r\n\r\n\t}\r\n\r\n\t#endif\r\n\r\n\r\n\r\n#endif\r\n",shadowmask_pars_fragment:"float getShadowMask() {\r\n\r\n\tfloat shadow = 1.0;\r\n\r\n\t#ifdef USE_SHADOWMAP\r\n\r\n\t#if NUM_DIR_LIGHTS > 0\r\n\r\n\tDirectionalLight directionalLight;\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\r\n\r\n\t\tdirectionalLight = directionalLights[ i ];\r\n\t\tshadow *= bool( directionalLight.shadow ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\r\n\r\n\t}\r\n\r\n\t#endif\r\n\r\n\t#if NUM_SPOT_LIGHTS > 0\r\n\r\n\tSpotLight spotLight;\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\r\n\r\n\t\tspotLight = spotLights[ i ];\r\n\t\tshadow *= bool( spotLight.shadow ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\r\n\r\n\t}\r\n\r\n\t#endif\r\n\r\n\t#if NUM_POINT_LIGHTS > 0\r\n\r\n\tPointLight pointLight;\r\n\r\n\t#pragma unroll_loop\r\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\r\n\r\n\t\tpointLight = pointLights[ i ];\r\n\t\tshadow *= bool( pointLight.shadow ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\r\n\r\n\t}\r\n\r\n\t#endif\r\n\r\n\r\n\r\n\t#endif\r\n\r\n\treturn shadow;\r\n\r\n}\r\n",skinbase_vertex:"#ifdef USE_SKINNING\r\n\r\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\r\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\r\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\r\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\r\n\r\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\r\n\r\n\tuniform mat4 bindMatrix;\r\n\tuniform mat4 bindMatrixInverse;\r\n\r\n\t#ifdef BONE_TEXTURE\r\n\r\n\t\tuniform sampler2D boneTexture;\r\n\t\tuniform int boneTextureSize;\r\n\r\n\t\tmat4 getBoneMatrix( const in float i ) {\r\n\r\n\t\t\tfloat j = i * 4.0;\r\n\t\t\tfloat x = mod( j, float( boneTextureSize ) );\r\n\t\t\tfloat y = floor( j / float( boneTextureSize ) );\r\n\r\n\t\t\tfloat dx = 1.0 / float( boneTextureSize );\r\n\t\t\tfloat dy = 1.0 / float( boneTextureSize );\r\n\r\n\t\t\ty = dy * ( y + 0.5 );\r\n\r\n\t\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\r\n\t\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\r\n\t\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\r\n\t\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\r\n\r\n\t\t\tmat4 bone = mat4( v1, v2, v3, v4 );\r\n\r\n\t\t\treturn bone;\r\n\r\n\t\t}\r\n\r\n\t#else\r\n\r\n\t\tuniform mat4 boneMatrices[ MAX_BONES ];\r\n\r\n\t\tmat4 getBoneMatrix( const in float i ) {\r\n\r\n\t\t\tmat4 bone = boneMatrices[ int(i) ];\r\n\t\t\treturn bone;\r\n\r\n\t\t}\r\n\r\n\t#endif\r\n\r\n#endif\r\n",skinning_vertex:"#ifdef USE_SKINNING\r\n\r\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\r\n\r\n\tvec4 skinned = vec4( 0.0 );\r\n\tskinned += boneMatX * skinVertex * skinWeight.x;\r\n\tskinned += boneMatY * skinVertex * skinWeight.y;\r\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\r\n\tskinned += boneMatW * skinVertex * skinWeight.w;\r\n\r\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\r\n\r\n#endif\r\n",skinnormal_vertex:"#ifdef USE_SKINNING\r\n\r\n\tmat4 skinMatrix = mat4( 0.0 );\r\n\tskinMatrix += skinWeight.x * boneMatX;\r\n\tskinMatrix += skinWeight.y * boneMatY;\r\n\tskinMatrix += skinWeight.z * boneMatZ;\r\n\tskinMatrix += skinWeight.w * boneMatW;\r\n\tskinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;\r\n\r\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\r\n\r\n#endif\r\n",specularmap_fragment:"float specularStrength;\r\n\r\n#ifdef USE_SPECULARMAP\r\n\r\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\r\n\tspecularStrength = texelSpecular.r;\r\n\r\n#else\r\n\r\n\tspecularStrength = 1.0;\r\n\r\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\r\n\r\n\tuniform sampler2D specularMap;\r\n\r\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\r\n\r\n  gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\r\n\r\n#endif\r\n",tonemapping_pars_fragment:"#ifndef saturate\r\n\t#define saturate(a) clamp( a, 0.0, 1.0 )\r\n#endif\r\n\r\nuniform float toneMappingExposure;\r\nuniform float toneMappingWhitePoint;\r\n\r\n// exposure only\r\nvec3 LinearToneMapping( vec3 color ) {\r\n\r\n\treturn toneMappingExposure * color;\r\n\r\n}\r\n\r\n// source: https://www.cs.utah.edu/~reinhard/cdrom/\r\nvec3 ReinhardToneMapping( vec3 color ) {\r\n\r\n\tcolor *= toneMappingExposure;\r\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\r\n\r\n}\r\n\r\n// source: http://filmicgames.com/archives/75\r\n#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )\r\nvec3 Uncharted2ToneMapping( vec3 color ) {\r\n\r\n\t// John Hable's filmic operator from Uncharted 2 video game\r\n\tcolor *= toneMappingExposure;\r\n\treturn saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );\r\n\r\n}\r\n\r\n// source: http://filmicgames.com/archives/75\r\nvec3 OptimizedCineonToneMapping( vec3 color ) {\r\n\r\n\t// optimized filmic operator by Jim Hejl and Richard Burgess-Dawson\r\n\tcolor *= toneMappingExposure;\r\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\r\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\r\n\r\n}\r\n",uv_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\r\n\r\n\tvarying vec2 vUv;\r\n\r\n#endif",uv_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\r\n\r\n\tvarying vec2 vUv;\r\n\tuniform mat3 uvTransform;\r\n\r\n#endif\r\n",uv_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP ) || defined( USE_ALPHAMAP ) || defined( USE_EMISSIVEMAP ) || defined( USE_ROUGHNESSMAP ) || defined( USE_METALNESSMAP )\r\n\r\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\r\n\r\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\r\n\r\n\tvarying vec2 vUv2;\r\n\r\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\r\n\r\n\tattribute vec2 uv2;\r\n\tvarying vec2 vUv2;\r\n\r\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\r\n\r\n\tvUv2 = uv2;\r\n\r\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )\r\n\r\n\tvec4 worldPosition = modelMatrix * vec4( transformed, 1.0 );\r\n\r\n#endif\r\n",cube_frag:"uniform samplerCube tCube;\r\nuniform float tFlip;\r\nuniform float opacity;\r\n\r\nvarying vec3 vWorldPosition;\r\n\r\nvoid main() {\r\n\r\n\tgl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\r\n\tgl_FragColor.a *= opacity;\r\n\r\n}\r\n",cube_vert:"varying vec3 vWorldPosition;\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n\r\n\tvWorldPosition = transformDirection( position, modelMatrix );\r\n\r\n\t#include <begin_vertex>\r\n\t#include <project_vertex>\r\n\r\n\tgl_Position.z = gl_Position.w; // set z to camera.far\r\n\r\n}\r\n",depth_frag:"#if DEPTH_PACKING == 3200\r\n\r\n\tuniform float opacity;\r\n\r\n#endif\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <uv_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( 1.0 );\r\n\r\n\t#if DEPTH_PACKING == 3200\r\n\r\n\t\tdiffuseColor.a = opacity;\r\n\r\n\t#endif\r\n\r\n\t#include <map_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\r\n\t#if DEPTH_PACKING == 3200\r\n\r\n\t\tgl_FragColor = vec4( vec3( gl_FragCoord.z ), opacity );\r\n\r\n\t#elif DEPTH_PACKING == 3201\r\n\r\n\t\tgl_FragColor = packDepthToRGBA( gl_FragCoord.z );\r\n\r\n\t#endif\r\n\r\n}\r\n",depth_vert:"#include <common>\r\n#include <uv_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\r\n\t#include <skinbase_vertex>\r\n\r\n\t#ifdef USE_DISPLACEMENTMAP\r\n\r\n\t\t#include <beginnormal_vertex>\r\n\t\t#include <morphnormal_vertex>\r\n\t\t#include <skinnormal_vertex>\r\n\r\n\t#endif\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n}\r\n",distanceRGBA_frag:"#define DISTANCE\r\n\r\nuniform vec3 referencePosition;\r\nuniform float nearDistance;\r\nuniform float farDistance;\r\nvarying vec3 vWorldPosition;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <uv_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main () {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( 1.0 );\r\n\r\n\t#include <map_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\r\n\tfloat dist = length( vWorldPosition - referencePosition );\r\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\r\n\tdist = saturate( dist ); // clamp to [ 0, 1 ]\r\n\r\n\tgl_FragColor = packDepthToRGBA( dist );\r\n\r\n}\r\n",distanceRGBA_vert:"#define DISTANCE\r\n\r\nvarying vec3 vWorldPosition;\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\r\n\t#include <skinbase_vertex>\r\n\r\n\t#ifdef USE_DISPLACEMENTMAP\r\n\r\n\t\t#include <beginnormal_vertex>\r\n\t\t#include <morphnormal_vertex>\r\n\t\t#include <skinnormal_vertex>\r\n\r\n\t#endif\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\t#include <worldpos_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n\tvWorldPosition = worldPosition.xyz;\r\n\r\n}\r\n",equirect_frag:"uniform sampler2D tEquirect;\r\n\r\nvarying vec3 vWorldPosition;\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n\r\n\tvec3 direction = normalize( vWorldPosition );\r\n\r\n\tvec2 sampleUV;\r\n\r\n\tsampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\r\n\r\n\tsampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;\r\n\r\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\r\n\r\n}\r\n",equirect_vert:"varying vec3 vWorldPosition;\r\n\r\n#include <common>\r\n\r\nvoid main() {\r\n\r\n\tvWorldPosition = transformDirection( position, modelMatrix );\r\n\r\n\t#include <begin_vertex>\r\n\t#include <project_vertex>\r\n\r\n}\r\n",linedashed_frag:"uniform vec3 diffuse;\r\nuniform float opacity;\r\n\r\nuniform float dashSize;\r\nuniform float totalSize;\r\n\r\nvarying float vLineDistance;\r\n\r\n#include <common>\r\n#include <color_pars_fragment>\r\n#include <fog_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\r\n\r\n\t\tdiscard;\r\n\r\n\t}\r\n\r\n\tvec3 outgoingLight = vec3( 0.0 );\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <color_fragment>\r\n\r\n\toutgoingLight = diffuseColor.rgb; // simple shader\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\r\n}\r\n",linedashed_vert:"uniform float scale;\r\nattribute float lineDistance;\r\n\r\nvarying float vLineDistance;\r\n\r\n#include <common>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <color_vertex>\r\n\r\n\tvLineDistance = scale * lineDistance;\r\n\r\n\tvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\r\n\tgl_Position = projectionMatrix * mvPosition;\r\n\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n",meshbasic_frag:"uniform vec3 diffuse;\r\nuniform float opacity;\r\n\r\n#ifndef FLAT_SHADED\r\n\r\n\tvarying vec3 vNormal;\r\n\r\n#endif\r\n\r\n#include <common>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <envmap_pars_fragment>\r\n#include <fog_pars_fragment>\r\n#include <specularmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\t#include <specularmap_fragment>\r\n\r\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r\n\r\n\t// accumulation (baked indirect lighting only)\r\n\t#ifdef USE_LIGHTMAP\r\n\r\n\t\treflectedLight.indirectDiffuse += texture2D( lightMap, vUv2 ).xyz * lightMapIntensity;\r\n\r\n\t#else\r\n\r\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\r\n\r\n\t#endif\r\n\r\n\t// modulation\r\n\t#include <aomap_fragment>\r\n\r\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\r\n\r\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\r\n\r\n\t#include <envmap_fragment>\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\r\n}\r\n",meshbasic_vert:"#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <envmap_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\t#include <uv2_vertex>\r\n\t#include <color_vertex>\r\n\t#include <skinbase_vertex>\r\n\r\n\t#ifdef USE_ENVMAP\r\n\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\r\n\t#endif\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\t#include <envmap_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n",meshlambert_frag:"uniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform float opacity;\r\n\r\nvarying vec3 vLightFront;\r\n\r\n#ifdef DOUBLE_SIDED\r\n\r\n\tvarying vec3 vLightBack;\r\n\r\n#endif\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <envmap_pars_fragment>\r\n#include <bsdfs>\r\n#include <lights_pars>\r\n#include <fog_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n#include <shadowmask_pars_fragment>\r\n#include <specularmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r\n\tvec3 totalEmissiveRadiance = emissive;\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\t#include <specularmap_fragment>\r\n\t#include <emissivemap_fragment>\r\n\r\n\t// accumulation\r\n\treflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );\r\n\r\n\t#include <lightmap_fragment>\r\n\r\n\treflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );\r\n\r\n\t#ifdef DOUBLE_SIDED\r\n\r\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\r\n\r\n\t#else\r\n\r\n\t\treflectedLight.directDiffuse = vLightFront;\r\n\r\n\t#endif\r\n\r\n\treflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();\r\n\r\n\t// modulation\r\n\t#include <aomap_fragment>\r\n\r\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\r\n\r\n\t#include <envmap_fragment>\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n",meshlambert_vert:"#define LAMBERT\r\n\r\nvarying vec3 vLightFront;\r\n\r\n#ifdef DOUBLE_SIDED\r\n\r\n\tvarying vec3 vLightBack;\r\n\r\n#endif\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <envmap_pars_vertex>\r\n#include <bsdfs>\r\n#include <lights_pars>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\t#include <uv2_vertex>\r\n\t#include <color_vertex>\r\n\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <envmap_vertex>\r\n\t#include <lights_lambert_vertex>\r\n\t#include <shadowmap_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n",meshphong_frag:"#define PHONG\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <envmap_pars_fragment>\r\n#include <gradientmap_pars_fragment>\r\n#include <fog_pars_fragment>\r\n#include <bsdfs>\r\n#include <lights_pars>\r\n#include <lights_phong_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <specularmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r\n\tvec3 totalEmissiveRadiance = emissive;\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\t#include <specularmap_fragment>\r\n\t#include <normal_fragment>\r\n\t#include <emissivemap_fragment>\r\n\r\n\t// accumulation\r\n\t#include <lights_phong_fragment>\r\n\t#include <lights_template>\r\n\r\n\t// modulation\r\n\t#include <aomap_fragment>\r\n\r\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\r\n\r\n\t#include <envmap_fragment>\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n",meshphong_vert:"#define PHONG\r\n\r\nvarying vec3 vViewPosition;\r\n\r\n#ifndef FLAT_SHADED\r\n\r\n\tvarying vec3 vNormal;\r\n\r\n#endif\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <envmap_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\t#include <uv2_vertex>\r\n\t#include <color_vertex>\r\n\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\r\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\r\n\r\n\tvNormal = normalize( transformedNormal );\r\n\r\n#endif\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n\tvViewPosition = - mvPosition.xyz;\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <envmap_vertex>\r\n\t#include <shadowmap_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n",meshphysical_frag:"#define PHYSICAL\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform float roughness;\r\nuniform float metalness;\r\nuniform float opacity;\r\n\r\n#ifndef STANDARD\r\n\tuniform float clearCoat;\r\n\tuniform float clearCoatRoughness;\r\n#endif\r\n\r\nvarying vec3 vViewPosition;\r\n\r\n#ifndef FLAT_SHADED\r\n\r\n\tvarying vec3 vNormal;\r\n\r\n#endif\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <envmap_pars_fragment>\r\n#include <fog_pars_fragment>\r\n#include <bsdfs>\r\n#include <cube_uv_reflection_fragment>\r\n#include <lights_pars>\r\n#include <lights_physical_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <roughnessmap_pars_fragment>\r\n#include <metalnessmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\r\n\tvec3 totalEmissiveRadiance = emissive;\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphamap_fragment>\r\n\t#include <alphatest_fragment>\r\n\t#include <roughnessmap_fragment>\r\n\t#include <metalnessmap_fragment>\r\n\t#include <normal_fragment>\r\n\t#include <emissivemap_fragment>\r\n\r\n\t// accumulation\r\n\t#include <lights_physical_fragment>\r\n\t#include <lights_template>\r\n\r\n\t// modulation\r\n\t#include <aomap_fragment>\r\n\r\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <dithering_fragment>\r\n\r\n}\r\n",meshphysical_vert:"#define PHYSICAL\r\n\r\nvarying vec3 vViewPosition;\r\n\r\n#ifndef FLAT_SHADED\r\n\r\n\tvarying vec3 vNormal;\r\n\r\n#endif\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\t#include <uv2_vertex>\r\n\t#include <color_vertex>\r\n\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\r\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\r\n\r\n\tvNormal = normalize( transformedNormal );\r\n\r\n#endif\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\r\n\tvViewPosition = - mvPosition.xyz;\r\n\r\n\t#include <worldpos_vertex>\r\n\t#include <shadowmap_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n",normal_frag:"#define NORMAL\r\n\r\nuniform float opacity;\r\n\r\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\n\r\n\tvarying vec3 vViewPosition;\r\n\r\n#endif\r\n\r\n#ifndef FLAT_SHADED\r\n\r\n\tvarying vec3 vNormal;\r\n\r\n#endif\r\n\r\n#include <packing>\r\n#include <uv_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <normal_fragment>\r\n\r\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\r\n\r\n}\r\n",normal_vert:"#define NORMAL\r\n\r\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\n\r\n\tvarying vec3 vViewPosition;\r\n\r\n#endif\r\n\r\n#ifndef FLAT_SHADED\r\n\r\n\tvarying vec3 vNormal;\r\n\r\n#endif\r\n\r\n#include <uv_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <uv_vertex>\r\n\r\n\t#include <beginnormal_vertex>\r\n\t#include <morphnormal_vertex>\r\n\t#include <skinbase_vertex>\r\n\t#include <skinnormal_vertex>\r\n\t#include <defaultnormal_vertex>\r\n\r\n#ifndef FLAT_SHADED // Normal computed with derivatives when FLAT_SHADED\r\n\r\n\tvNormal = normalize( transformedNormal );\r\n\r\n#endif\r\n\r\n\t#include <begin_vertex>\r\n\t#include <morphtarget_vertex>\r\n\t#include <skinning_vertex>\r\n\t#include <displacementmap_vertex>\r\n\t#include <project_vertex>\r\n\t#include <logdepthbuf_vertex>\r\n\r\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\r\n\r\n\tvViewPosition = - mvPosition.xyz;\r\n\r\n#endif\r\n\r\n}\r\n",points_frag:"uniform vec3 diffuse;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <color_pars_fragment>\r\n#include <map_particle_pars_fragment>\r\n#include <fog_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\t#include <clipping_planes_fragment>\r\n\r\n\tvec3 outgoingLight = vec3( 0.0 );\r\n\tvec4 diffuseColor = vec4( diffuse, opacity );\r\n\r\n\t#include <logdepthbuf_fragment>\r\n\t#include <map_particle_fragment>\r\n\t#include <color_fragment>\r\n\t#include <alphatest_fragment>\r\n\r\n\toutgoingLight = diffuseColor.rgb;\r\n\r\n\tgl_FragColor = vec4( outgoingLight, diffuseColor.a );\r\n\r\n\t#include <premultiplied_alpha_fragment>\r\n\t#include <tonemapping_fragment>\r\n\t#include <encodings_fragment>\r\n\t#include <fog_fragment>\r\n\r\n}\r\n",points_vert:"uniform float size;\r\nuniform float scale;\r\n\r\n#include <common>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <color_vertex>\r\n\t#include <begin_vertex>\r\n\t#include <project_vertex>\r\n\r\n\t#ifdef USE_SIZEATTENUATION\r\n\t\tgl_PointSize = size * ( scale / - mvPosition.z );\r\n\t#else\r\n\t\tgl_PointSize = size;\r\n\t#endif\r\n\r\n\t#include <logdepthbuf_vertex>\r\n\t#include <clipping_planes_vertex>\r\n\t#include <worldpos_vertex>\r\n\t#include <shadowmap_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n",shadow_frag:"uniform vec3 color;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <fog_pars_fragment>\r\n#include <bsdfs>\r\n#include <lights_pars>\r\n#include <shadowmap_pars_fragment>\r\n#include <shadowmask_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\r\n\r\n\t#include <fog_fragment>\r\n\r\n}\r\n",shadow_vert:"#include <fog_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n\r\nvoid main() {\r\n\r\n\t#include <begin_vertex>\r\n\t#include <project_vertex>\r\n\t#include <worldpos_vertex>\r\n\t#include <shadowmap_vertex>\r\n\t#include <fog_vertex>\r\n\r\n}\r\n"},ShaderLib={basic:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.fog]),vertexShader:ShaderChunk.meshbasic_vert,fragmentShader:ShaderChunk.meshbasic_frag},lambert:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)}}]),vertexShader:ShaderChunk.meshlambert_vert,fragmentShader:ShaderChunk.meshlambert_frag},phong:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.specularmap,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.gradientmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},specular:{value:new Color(1118481)},shininess:{value:30}}]),vertexShader:ShaderChunk.meshphong_vert,fragmentShader:ShaderChunk.meshphong_frag},standard:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.envmap,UniformsLib.aomap,UniformsLib.lightmap,UniformsLib.emissivemap,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,UniformsLib.roughnessmap,UniformsLib.metalnessmap,UniformsLib.fog,UniformsLib.lights,{emissive:{value:new Color(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag},points:{uniforms:UniformsUtils.merge([UniformsLib.points,UniformsLib.fog]),vertexShader:ShaderChunk.points_vert,fragmentShader:ShaderChunk.points_frag},dashed:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:ShaderChunk.linedashed_vert,fragmentShader:ShaderChunk.linedashed_frag},depth:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.displacementmap]),vertexShader:ShaderChunk.depth_vert,fragmentShader:ShaderChunk.depth_frag},normal:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.bumpmap,UniformsLib.normalmap,UniformsLib.displacementmap,{opacity:{value:1}}]),vertexShader:ShaderChunk.normal_vert,fragmentShader:ShaderChunk.normal_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:ShaderChunk.cube_vert,fragmentShader:ShaderChunk.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:ShaderChunk.equirect_vert,fragmentShader:ShaderChunk.equirect_frag},distanceRGBA:{uniforms:UniformsUtils.merge([UniformsLib.common,UniformsLib.displacementmap,{referencePosition:{value:new Vector3},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:ShaderChunk.distanceRGBA_vert,fragmentShader:ShaderChunk.distanceRGBA_frag},shadow:{uniforms:UniformsUtils.merge([UniformsLib.lights,UniformsLib.fog,{color:{value:new Color(0)},opacity:{value:1}}]),vertexShader:ShaderChunk.shadow_vert,fragmentShader:ShaderChunk.shadow_frag}};ShaderLib.physical={uniforms:UniformsUtils.merge([ShaderLib.standard.uniforms,{clearCoat:{value:0},clearCoatRoughness:{value:0}}]),vertexShader:ShaderChunk.meshphysical_vert,fragmentShader:ShaderChunk.meshphysical_frag};function CanvasTexture(canvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Texture.call(this,canvas,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.needsUpdate=!0}CanvasTexture.prototype=Object.create(Texture.prototype);CanvasTexture.prototype.constructor=CanvasTexture;function WebGLSpriteRenderer(renderer,gl,state,textures,capabilities){var vertexBuffer,elementBuffer,program,attributes,uniforms,texture,spritePosition=new Vector3,spriteRotation=new Quaternion,spriteScale=new Vector3;function init(){var vertices=new Float32Array([-.5,-.5,0,0,.5,-.5,1,0,.5,.5,1,1,-.5,.5,0,1]),faces=new Uint16Array([0,1,2,0,2,3]);vertexBuffer=gl.createBuffer();elementBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,faces,gl.STATIC_DRAW);program=createProgram();attributes={position:gl.getAttribLocation(program,"position"),uv:gl.getAttribLocation(program,"uv")};uniforms={uvOffset:gl.getUniformLocation(program,"uvOffset"),uvScale:gl.getUniformLocation(program,"uvScale"),rotation:gl.getUniformLocation(program,"rotation"),center:gl.getUniformLocation(program,"center"),scale:gl.getUniformLocation(program,"scale"),color:gl.getUniformLocation(program,"color"),map:gl.getUniformLocation(program,"map"),opacity:gl.getUniformLocation(program,"opacity"),modelViewMatrix:gl.getUniformLocation(program,"modelViewMatrix"),projectionMatrix:gl.getUniformLocation(program,"projectionMatrix"),fogType:gl.getUniformLocation(program,"fogType"),fogDensity:gl.getUniformLocation(program,"fogDensity"),fogNear:gl.getUniformLocation(program,"fogNear"),fogFar:gl.getUniformLocation(program,"fogFar"),fogColor:gl.getUniformLocation(program,"fogColor"),fogDepth:gl.getUniformLocation(program,"fogDepth"),alphaTest:gl.getUniformLocation(program,"alphaTest")};var canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");canvas.width=8;canvas.height=8;var context=canvas.getContext("2d");context.fillStyle="white";context.fillRect(0,0,8,8);texture=new CanvasTexture(canvas)}this.render=function(sprites,scene,camera){if(0===sprites.length)return;if(program===void 0){init()}state.useProgram(program);state.initAttributes();state.enableAttribute(attributes.position);state.enableAttribute(attributes.uv);state.disableUnusedAttributes();state.disable(gl.CULL_FACE);state.enable(gl.BLEND);gl.bindBuffer(gl.ARRAY_BUFFER,vertexBuffer);gl.vertexAttribPointer(attributes.position,2,gl.FLOAT,!1,8*2,0);gl.vertexAttribPointer(attributes.uv,2,gl.FLOAT,!1,8*2,8);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,elementBuffer);gl.uniformMatrix4fv(uniforms.projectionMatrix,!1,camera.projectionMatrix.elements);state.activeTexture(gl.TEXTURE0);gl.uniform1i(uniforms.map,0);var oldFogType=0,sceneFogType=0,fog=scene.fog;if(fog){gl.uniform3f(uniforms.fogColor,fog.color.r,fog.color.g,fog.color.b);if(fog.isFog){gl.uniform1f(uniforms.fogNear,fog.near);gl.uniform1f(uniforms.fogFar,fog.far);gl.uniform1i(uniforms.fogType,1);oldFogType=1;sceneFogType=1}else if(fog.isFogExp2){gl.uniform1f(uniforms.fogDensity,fog.density);gl.uniform1i(uniforms.fogType,2);oldFogType=2;sceneFogType=2}}else{gl.uniform1i(uniforms.fogType,0);oldFogType=0;sceneFogType=0}for(var i=0,l=sprites.length,sprite;i<l;i++){sprite=sprites[i];sprite.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,sprite.matrixWorld);sprite.z=-sprite.modelViewMatrix.elements[14]}sprites.sort(painterSortStable);for(var scale=[],center=[],i=0,l=sprites.length;i<l;i++){var sprite=sprites[i],material=sprite.material;if(!1===material.visible)continue;sprite.onBeforeRender(renderer,scene,camera,void 0,material,void 0);gl.uniform1f(uniforms.alphaTest,material.alphaTest);gl.uniformMatrix4fv(uniforms.modelViewMatrix,!1,sprite.modelViewMatrix.elements);sprite.matrixWorld.decompose(spritePosition,spriteRotation,spriteScale);scale[0]=spriteScale.x;scale[1]=spriteScale.y;center[0]=sprite.center.x-.5;center[1]=sprite.center.y-.5;var fogType=0;if(scene.fog&&material.fog){fogType=sceneFogType}if(oldFogType!==fogType){gl.uniform1i(uniforms.fogType,fogType);oldFogType=fogType}if(null!==material.map){gl.uniform2f(uniforms.uvOffset,material.map.offset.x,material.map.offset.y);gl.uniform2f(uniforms.uvScale,material.map.repeat.x,material.map.repeat.y)}else{gl.uniform2f(uniforms.uvOffset,0,0);gl.uniform2f(uniforms.uvScale,1,1)}gl.uniform1f(uniforms.opacity,material.opacity);gl.uniform3f(uniforms.color,material.color.r,material.color.g,material.color.b);gl.uniform1f(uniforms.rotation,material.rotation);gl.uniform2fv(uniforms.center,center);gl.uniform2fv(uniforms.scale,scale);state.setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst,material.blendEquationAlpha,material.blendSrcAlpha,material.blendDstAlpha,material.premultipliedAlpha);state.buffers.depth.setTest(material.depthTest);state.buffers.depth.setMask(material.depthWrite);state.buffers.color.setMask(material.colorWrite);textures.setTexture2D(material.map||texture,0);gl.drawElements(gl.TRIANGLES,6,gl.UNSIGNED_SHORT,0);sprite.onAfterRender(renderer,scene,camera,void 0,material,void 0)}state.enable(gl.CULL_FACE);state.reset()};function createProgram(){var program=gl.createProgram(),vertexShader=gl.createShader(gl.VERTEX_SHADER),fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(vertexShader,["precision "+capabilities.precision+" float;","#define SHADER_NAME "+"SpriteMaterial","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform float rotation;","uniform vec2 center;","uniform vec2 scale;","uniform vec2 uvOffset;","uniform vec2 uvScale;","attribute vec2 position;","attribute vec2 uv;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvUV = uvOffset + uv * uvScale;","\tvec2 alignedPosition = ( position - center ) * scale;","\tvec2 rotatedPosition;","\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;","\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;","\tvec4 mvPosition;","\tmvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );","\tmvPosition.xy += rotatedPosition;","\tgl_Position = projectionMatrix * mvPosition;","\tfogDepth = - mvPosition.z;","}"].join("\n"));gl.shaderSource(fragmentShader,["precision "+capabilities.precision+" float;","#define SHADER_NAME "+"SpriteMaterial","uniform vec3 color;","uniform sampler2D map;","uniform float opacity;","uniform int fogType;","uniform vec3 fogColor;","uniform float fogDensity;","uniform float fogNear;","uniform float fogFar;","uniform float alphaTest;","varying vec2 vUV;","varying float fogDepth;","void main() {","\tvec4 texture = texture2D( map, vUV );","\tgl_FragColor = vec4( color * texture.xyz, texture.a * opacity );","\tif ( gl_FragColor.a < alphaTest ) discard;","\tif ( fogType > 0 ) {","\t\tfloat fogFactor = 0.0;","\t\tif ( fogType == 1 ) {","\t\t\tfogFactor = smoothstep( fogNear, fogFar, fogDepth );","\t\t} else {","\t\t\tconst float LOG2 = 1.442695;","\t\t\tfogFactor = exp2( - fogDensity * fogDensity * fogDepth * fogDepth * LOG2 );","\t\t\tfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );","\t\t}","\t\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );","\t}","}"].join("\n"));gl.compileShader(vertexShader);gl.compileShader(fragmentShader);gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);gl.linkProgram(program);return program}function painterSortStable(a,b){if(a.renderOrder!==b.renderOrder){return a.renderOrder-b.renderOrder}else if(a.z!==b.z){return b.z-a.z}else{return b.id-a.id}}}var materialId=0;function Material(){Object.defineProperty(this,"id",{value:materialId++});this.uuid=_Math.generateUUID();this.name="";this.type="Material";this.fog=!0;this.lights=!0;this.blending=NormalBlending;this.side=FrontSide;this.flatShading=!1;this.vertexColors=NoColors;this.opacity=1;this.transparent=!1;this.blendSrc=SrcAlphaFactor;this.blendDst=OneMinusSrcAlphaFactor;this.blendEquation=AddEquation;this.blendSrcAlpha=null;this.blendDstAlpha=null;this.blendEquationAlpha=null;this.depthFunc=LessEqualDepth;this.depthTest=!0;this.depthWrite=!0;this.clippingPlanes=null;this.clipIntersection=!1;this.clipShadows=!1;this.shadowSide=null;this.colorWrite=!0;this.precision=null;this.polygonOffset=!1;this.polygonOffsetFactor=0;this.polygonOffsetUnits=0;this.dithering=!1;this.alphaTest=0;this.premultipliedAlpha=!1;this.overdraw=0;this.visible=!0;this.userData={};this.needsUpdate=!0}Material.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Material,isMaterial:!0,onBeforeCompile:function onBeforeCompile(){},setValues:function setValues(values){if(values===void 0)return;for(var key in values){var newValue=values[key];if(newValue===void 0){console.warn("THREE.Material: '"+key+"' parameter is undefined.");continue}if("shading"===key){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=newValue===FlatShading?!0:!1;continue}var currentValue=this[key];if(currentValue===void 0){console.warn("THREE."+this.type+": '"+key+"' is not a property of this material.");continue}if(currentValue&&currentValue.isColor){currentValue.set(newValue)}else if(currentValue&&currentValue.isVector3&&newValue&&newValue.isVector3){currentValue.copy(newValue)}else if("overdraw"===key){this[key]=+newValue}else{this[key]=newValue}}},toJSON:function(meta){var isRoot=meta===void 0||"string"===typeof meta;if(isRoot){meta={textures:{},images:{}}}var data={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"},uuid:this.uuid,type:this.type};if(""!==this.name)data.name=this.name;if(this.color&&this.color.isColor)data.color=this.color.getHex();if(this.roughness!==void 0)data.roughness=this.roughness;if(this.metalness!==void 0)data.metalness=this.metalness;if(this.emissive&&this.emissive.isColor)data.emissive=this.emissive.getHex();if(1!==this.emissiveIntensity)data.emissiveIntensity=this.emissiveIntensity;if(this.specular&&this.specular.isColor)data.specular=this.specular.getHex();if(this.shininess!==void 0)data.shininess=this.shininess;if(this.clearCoat!==void 0)data.clearCoat=this.clearCoat;if(this.clearCoatRoughness!==void 0)data.clearCoatRoughness=this.clearCoatRoughness;if(this.map&&this.map.isTexture)data.map=this.map.toJSON(meta).uuid;if(this.alphaMap&&this.alphaMap.isTexture)data.alphaMap=this.alphaMap.toJSON(meta).uuid;if(this.lightMap&&this.lightMap.isTexture)data.lightMap=this.lightMap.toJSON(meta).uuid;if(this.bumpMap&&this.bumpMap.isTexture){data.bumpMap=this.bumpMap.toJSON(meta).uuid;data.bumpScale=this.bumpScale}if(this.normalMap&&this.normalMap.isTexture){data.normalMap=this.normalMap.toJSON(meta).uuid;data.normalScale=this.normalScale.toArray()}if(this.displacementMap&&this.displacementMap.isTexture){data.displacementMap=this.displacementMap.toJSON(meta).uuid;data.displacementScale=this.displacementScale;data.displacementBias=this.displacementBias}if(this.roughnessMap&&this.roughnessMap.isTexture)data.roughnessMap=this.roughnessMap.toJSON(meta).uuid;if(this.metalnessMap&&this.metalnessMap.isTexture)data.metalnessMap=this.metalnessMap.toJSON(meta).uuid;if(this.emissiveMap&&this.emissiveMap.isTexture)data.emissiveMap=this.emissiveMap.toJSON(meta).uuid;if(this.specularMap&&this.specularMap.isTexture)data.specularMap=this.specularMap.toJSON(meta).uuid;if(this.envMap&&this.envMap.isTexture){data.envMap=this.envMap.toJSON(meta).uuid;data.reflectivity=this.reflectivity}if(this.gradientMap&&this.gradientMap.isTexture){data.gradientMap=this.gradientMap.toJSON(meta).uuid}if(this.size!==void 0)data.size=this.size;if(this.sizeAttenuation!==void 0)data.sizeAttenuation=this.sizeAttenuation;if(this.blending!==NormalBlending)data.blending=this.blending;if(!0===this.flatShading)data.flatShading=this.flatShading;if(this.side!==FrontSide)data.side=this.side;if(this.vertexColors!==NoColors)data.vertexColors=this.vertexColors;if(1>this.opacity)data.opacity=this.opacity;if(!0===this.transparent)data.transparent=this.transparent;data.depthFunc=this.depthFunc;data.depthTest=this.depthTest;data.depthWrite=this.depthWrite;if(0!==this.rotation)data.rotation=this.rotation;if(1!==this.linewidth)data.linewidth=this.linewidth;if(this.dashSize!==void 0)data.dashSize=this.dashSize;if(this.gapSize!==void 0)data.gapSize=this.gapSize;if(this.scale!==void 0)data.scale=this.scale;if(!0===this.dithering)data.dithering=!0;if(0<this.alphaTest)data.alphaTest=this.alphaTest;if(!0===this.premultipliedAlpha)data.premultipliedAlpha=this.premultipliedAlpha;if(!0===this.wireframe)data.wireframe=this.wireframe;if(1<this.wireframeLinewidth)data.wireframeLinewidth=this.wireframeLinewidth;if("round"!==this.wireframeLinecap)data.wireframeLinecap=this.wireframeLinecap;if("round"!==this.wireframeLinejoin)data.wireframeLinejoin=this.wireframeLinejoin;if(!0===this.morphTargets)data.morphTargets=!0;if(!0===this.skinning)data.skinning=!0;if(!1===this.visible)data.visible=!1;if("{}"!==JSON.stringify(this.userData))data.userData=this.userData;function extractFromCache(cache){var values=[];for(var key in cache){var data=cache[key];delete data.metadata;values.push(data)}return values}if(isRoot){var textures=extractFromCache(meta.textures),images=extractFromCache(meta.images);if(0<textures.length)data.textures=textures;if(0<images.length)data.images=images}return data},clone:function clone(){return new this.constructor().copy(this)},copy:function copy(source){this.name=source.name;this.fog=source.fog;this.lights=source.lights;this.blending=source.blending;this.side=source.side;this.flatShading=source.flatShading;this.vertexColors=source.vertexColors;this.opacity=source.opacity;this.transparent=source.transparent;this.blendSrc=source.blendSrc;this.blendDst=source.blendDst;this.blendEquation=source.blendEquation;this.blendSrcAlpha=source.blendSrcAlpha;this.blendDstAlpha=source.blendDstAlpha;this.blendEquationAlpha=source.blendEquationAlpha;this.depthFunc=source.depthFunc;this.depthTest=source.depthTest;this.depthWrite=source.depthWrite;this.colorWrite=source.colorWrite;this.precision=source.precision;this.polygonOffset=source.polygonOffset;this.polygonOffsetFactor=source.polygonOffsetFactor;this.polygonOffsetUnits=source.polygonOffsetUnits;this.dithering=source.dithering;this.alphaTest=source.alphaTest;this.premultipliedAlpha=source.premultipliedAlpha;this.overdraw=source.overdraw;this.visible=source.visible;this.userData=JSON.parse(JSON.stringify(source.userData));this.clipShadows=source.clipShadows;this.clipIntersection=source.clipIntersection;var srcPlanes=source.clippingPlanes,dstPlanes=null;if(null!==srcPlanes){var n=srcPlanes.length;dstPlanes=Array(n);for(var i=0;i!==n;++i){dstPlanes[i]=srcPlanes[i].clone()}}this.clippingPlanes=dstPlanes;this.shadowSide=source.shadowSide;return this},dispose:function dispose(){this.dispatchEvent({type:"dispose"})}});function MeshDepthMaterial(parameters){Material.call(this);this.type="MeshDepthMaterial";this.depthPacking=BasicDepthPacking;this.skinning=!1;this.morphTargets=!1;this.map=null;this.alphaMap=null;this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.fog=!1;this.lights=!1;this.setValues(parameters)}MeshDepthMaterial.prototype=Object.create(Material.prototype);MeshDepthMaterial.prototype.constructor=MeshDepthMaterial;MeshDepthMaterial.prototype.isMeshDepthMaterial=!0;MeshDepthMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.depthPacking=source.depthPacking;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.map=source.map;this.alphaMap=source.alphaMap;this.displacementMap=source.displacementMap;this.displacementScale=source.displacementScale;this.displacementBias=source.displacementBias;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;return this};function MeshDistanceMaterial(parameters){Material.call(this);this.type="MeshDistanceMaterial";this.referencePosition=new Vector3;this.nearDistance=1;this.farDistance=1e3;this.skinning=!1;this.morphTargets=!1;this.map=null;this.alphaMap=null;this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.fog=!1;this.lights=!1;this.setValues(parameters)}MeshDistanceMaterial.prototype=Object.create(Material.prototype);MeshDistanceMaterial.prototype.constructor=MeshDistanceMaterial;MeshDistanceMaterial.prototype.isMeshDistanceMaterial=!0;MeshDistanceMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.referencePosition.copy(source.referencePosition);this.nearDistance=source.nearDistance;this.farDistance=source.farDistance;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.map=source.map;this.alphaMap=source.alphaMap;this.displacementMap=source.displacementMap;this.displacementScale=source.displacementScale;this.displacementBias=source.displacementBias;return this};function Box3(min,max){this.min=min!==void 0?min:new Vector3(+Infinity,+Infinity,+Infinity);this.max=max!==void 0?max:new Vector3(-Infinity,-Infinity,-Infinity)}Object.assign(Box3.prototype,{isBox3:!0,set:function set(min,max){this.min.copy(min);this.max.copy(max);return this},setFromArray:function setFromArray(array){for(var minX=+Infinity,minY=+Infinity,minZ=+Infinity,maxX=-Infinity,maxY=-Infinity,maxZ=-Infinity,i=0,l=array.length;i<l;i+=3){var x=array[i],y=array[i+1],z=array[i+2];if(x<minX)minX=x;if(y<minY)minY=y;if(z<minZ)minZ=z;if(x>maxX)maxX=x;if(y>maxY)maxY=y;if(z>maxZ)maxZ=z}this.min.set(minX,minY,minZ);this.max.set(maxX,maxY,maxZ);return this},setFromBufferAttribute:function setFromBufferAttribute(attribute){for(var minX=+Infinity,minY=+Infinity,minZ=+Infinity,maxX=-Infinity,maxY=-Infinity,maxZ=-Infinity,i=0,l=attribute.count;i<l;i++){var x=attribute.getX(i),y=attribute.getY(i),z=attribute.getZ(i);if(x<minX)minX=x;if(y<minY)minY=y;if(z<minZ)minZ=z;if(x>maxX)maxX=x;if(y>maxY)maxY=y;if(z>maxZ)maxZ=z}this.min.set(minX,minY,minZ);this.max.set(maxX,maxY,maxZ);return this},setFromPoints:function setFromPoints(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this.expandByPoint(points[i])}return this},setFromCenterAndSize:function(){var v1=new Vector3;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this}}(),setFromObject:function setFromObject(object){this.makeEmpty();return this.expandByObject(object)},clone:function clone(){return new this.constructor().copy(this)},copy:function copy(box){this.min.copy(box.min);this.max.copy(box.max);return this},makeEmpty:function makeEmpty(){this.min.x=this.min.y=this.min.z=+Infinity;this.max.x=this.max.y=this.max.z=-Infinity;return this},isEmpty:function isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function getCenter(optionalTarget){var result=optionalTarget||new Vector3;return this.isEmpty()?result.set(0,0,0):result.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function getSize(optionalTarget){var result=optionalTarget||new Vector3;return this.isEmpty()?result.set(0,0,0):result.subVectors(this.max,this.min)},expandByPoint:function expandByPoint(point){this.min.min(point);this.max.max(point);return this},expandByVector:function expandByVector(vector){this.min.sub(vector);this.max.add(vector);return this},expandByScalar:function expandByScalar(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this},expandByObject:function(){var scope,i,l,v1=new Vector3;function traverse(node){var geometry=node.geometry;if(geometry!==void 0){if(geometry.isGeometry){var vertices=geometry.vertices;for(i=0,l=vertices.length;i<l;i++){v1.copy(vertices[i]);v1.applyMatrix4(node.matrixWorld);scope.expandByPoint(v1)}}else if(geometry.isBufferGeometry){var attribute=geometry.attributes.position;if(attribute!==void 0){for(i=0,l=attribute.count;i<l;i++){v1.fromBufferAttribute(attribute,i).applyMatrix4(node.matrixWorld);scope.expandByPoint(v1)}}}}}return function(object){scope=this;object.updateMatrixWorld(!0);object.traverse(traverse);return this}}(),containsPoint:function containsPoint(point){return point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y||point.z<this.min.z||point.z>this.max.z?!1:!0},containsBox:function containsBox(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y&&this.min.z<=box.min.z&&box.max.z<=this.max.z},getParameter:function getParameter(point,optionalTarget){var result=optionalTarget||new Vector3;return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y),(point.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function intersectsBox(box){return box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y||box.max.z<this.min.z||box.min.z>this.max.z?!1:!0},intersectsSphere:function(){var closestPoint=new Vector3;return function(sphere){this.clampPoint(sphere.center,closestPoint);return closestPoint.distanceToSquared(sphere.center)<=sphere.radius*sphere.radius}}(),intersectsPlane:function intersectsPlane(plane){var min,max;if(0<plane.normal.x){min=plane.normal.x*this.min.x;max=plane.normal.x*this.max.x}else{min=plane.normal.x*this.max.x;max=plane.normal.x*this.min.x}if(0<plane.normal.y){min+=plane.normal.y*this.min.y;max+=plane.normal.y*this.max.y}else{min+=plane.normal.y*this.max.y;max+=plane.normal.y*this.min.y}if(0<plane.normal.z){min+=plane.normal.z*this.min.z;max+=plane.normal.z*this.max.z}else{min+=plane.normal.z*this.max.z;max+=plane.normal.z*this.min.z}return min<=plane.constant&&max>=plane.constant},intersectsTriangle:function(){var v0=new Vector3,v1=new Vector3,v2=new Vector3,f0=new Vector3,f1=new Vector3,f2=new Vector3,testAxis=new Vector3,center=new Vector3,extents=new Vector3,triangleNormal=new Vector3;function satForAxes(axes){var i,j;for(i=0,j=axes.length-3;i<=j;i+=3){testAxis.fromArray(axes,i);var r=extents.x*_Mathabs(testAxis.x)+extents.y*_Mathabs(testAxis.y)+extents.z*_Mathabs(testAxis.z),p0=v0.dot(testAxis),p1=v1.dot(testAxis),p2=v2.dot(testAxis);if(_Mathmax(-_Mathmax(p0,p1,p2),_Mathmin(p0,p1,p2))>r){return!1}}return!0}return function(triangle){if(this.isEmpty()){return!1}this.getCenter(center);extents.subVectors(this.max,center);v0.subVectors(triangle.a,center);v1.subVectors(triangle.b,center);v2.subVectors(triangle.c,center);f0.subVectors(v1,v0);f1.subVectors(v2,v1);f2.subVectors(v0,v2);var axes=[0,-f0.z,f0.y,0,-f1.z,f1.y,0,-f2.z,f2.y,f0.z,0,-f0.x,f1.z,0,-f1.x,f2.z,0,-f2.x,-f0.y,f0.x,0,-f1.y,f1.x,0,-f2.y,f2.x,0];if(!satForAxes(axes)){return!1}axes=[1,0,0,0,1,0,0,0,1];if(!satForAxes(axes)){return!1}triangleNormal.crossVectors(f0,f1);axes=[triangleNormal.x,triangleNormal.y,triangleNormal.z];return satForAxes(axes)}}(),clampPoint:function clampPoint(point,optionalTarget){var result=optionalTarget||new Vector3;return result.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new Vector3;return function(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length()}}(),getBoundingSphere:function(){var v1=new Vector3;return function(optionalTarget){var result=optionalTarget||new Sphere;this.getCenter(result.center);result.radius=.5*this.getSize(v1).length();return result}}(),intersect:function intersect(box){this.min.max(box.min);this.max.min(box.max);if(this.isEmpty())this.makeEmpty();return this},union:function union(box){this.min.min(box.min);this.max.max(box.max);return this},applyMatrix4:function(){var points=[new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3,new Vector3];return function(matrix){if(this.isEmpty())return this;points[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(matrix);points[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(matrix);points[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(matrix);points[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(matrix);points[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(matrix);points[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(matrix);points[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(matrix);points[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(matrix);this.setFromPoints(points);return this}}(),translate:function translate(offset){this.min.add(offset);this.max.add(offset);return this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)}});function Sphere(center,radius){this.center=center!==void 0?center:new Vector3;this.radius=radius!==void 0?radius:0}Object.assign(Sphere.prototype,{set:function set(center,radius){this.center.copy(center);this.radius=radius;return this},setFromPoints:function(){var box=new Box3;return function(points,optionalCenter){var center=this.center;if(optionalCenter!==void 0){center.copy(optionalCenter)}else{box.setFromPoints(points).getCenter(center)}for(var maxRadiusSq=0,i=0,il=points.length;i<il;i++){maxRadiusSq=_Mathmax(maxRadiusSq,center.distanceToSquared(points[i]))}this.radius=_Mathsqrt(maxRadiusSq);return this}}(),clone:function clone(){return new this.constructor().copy(this)},copy:function copy(sphere){this.center.copy(sphere.center);this.radius=sphere.radius;return this},empty:function empty(){return 0>=this.radius},containsPoint:function containsPoint(point){return point.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function distanceToPoint(point){return point.distanceTo(this.center)-this.radius},intersectsSphere:function intersectsSphere(sphere){var radiusSum=this.radius+sphere.radius;return sphere.center.distanceToSquared(this.center)<=radiusSum*radiusSum},intersectsBox:function intersectsBox(box){return box.intersectsSphere(this)},intersectsPlane:function intersectsPlane(plane){return _Mathabs(plane.distanceToPoint(this.center))<=this.radius},clampPoint:function clampPoint(point,optionalTarget){var deltaLengthSq=this.center.distanceToSquared(point),result=optionalTarget||new Vector3;result.copy(point);if(deltaLengthSq>this.radius*this.radius){result.sub(this.center).normalize();result.multiplyScalar(this.radius).add(this.center)}return result},getBoundingBox:function getBoundingBox(optionalTarget){var box=optionalTarget||new Box3;box.set(this.center,this.center);box.expandByScalar(this.radius);return box},applyMatrix4:function applyMatrix4(matrix){this.center.applyMatrix4(matrix);this.radius=this.radius*matrix.getMaxScaleOnAxis();return this},translate:function translate(offset){this.center.add(offset);return this},equals:function(sphere){return sphere.center.equals(this.center)&&sphere.radius===this.radius}});function Plane(normal,constant){this.normal=normal!==void 0?normal:new Vector3(1,0,0);this.constant=constant!==void 0?constant:0}Object.assign(Plane.prototype,{set:function set(normal,constant){this.normal.copy(normal);this.constant=constant;return this},setComponents:function setComponents(x,y,z,w){this.normal.set(x,y,z);this.constant=w;return this},setFromNormalAndCoplanarPoint:function setFromNormalAndCoplanarPoint(normal,point){this.normal.copy(normal);this.constant=-point.dot(this.normal);return this},setFromCoplanarPoints:function(){var v1=new Vector3,v2=new Vector3;return function(a,b,c){var normal=v1.subVectors(c,b).cross(v2.subVectors(a,b)).normalize();this.setFromNormalAndCoplanarPoint(normal,a);return this}}(),clone:function clone(){return new this.constructor().copy(this)},copy:function copy(plane){this.normal.copy(plane.normal);this.constant=plane.constant;return this},normalize:function normalize(){var inverseNormalLength=1/this.normal.length();this.normal.multiplyScalar(inverseNormalLength);this.constant*=inverseNormalLength;return this},negate:function negate(){this.constant*=-1;this.normal.negate();return this},distanceToPoint:function distanceToPoint(point){return this.normal.dot(point)+this.constant},distanceToSphere:function distanceToSphere(sphere){return this.distanceToPoint(sphere.center)-sphere.radius},projectPoint:function projectPoint(point,optionalTarget){var result=optionalTarget||new Vector3;return result.copy(this.normal).multiplyScalar(-this.distanceToPoint(point)).add(point)},intersectLine:function(){var v1=new Vector3;return function(line,optionalTarget){var result=optionalTarget||new Vector3,direction=line.delta(v1),denominator=this.normal.dot(direction);if(0===denominator){if(0===this.distanceToPoint(line.start)){return result.copy(line.start)}return}var t=-(line.start.dot(this.normal)+this.constant)/denominator;if(0>t||1<t){return}return result.copy(direction).multiplyScalar(t).add(line.start)}}(),intersectsLine:function intersectsLine(line){var startSign=this.distanceToPoint(line.start),endSign=this.distanceToPoint(line.end);return 0>startSign&&0<endSign||0>endSign&&0<startSign},intersectsBox:function intersectsBox(box){return box.intersectsPlane(this)},intersectsSphere:function intersectsSphere(sphere){return sphere.intersectsPlane(this)},coplanarPoint:function coplanarPoint(optionalTarget){var result=optionalTarget||new Vector3;return result.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var v1=new Vector3,m1=new Matrix3;return function(matrix,optionalNormalMatrix){var normalMatrix=optionalNormalMatrix||m1.getNormalMatrix(matrix),referencePoint=this.coplanarPoint(v1).applyMatrix4(matrix),normal=this.normal.applyMatrix3(normalMatrix).normalize();this.constant=-referencePoint.dot(normal);return this}}(),translate:function translate(offset){this.constant-=offset.dot(this.normal);return this},equals:function(plane){return plane.normal.equals(this.normal)&&plane.constant===this.constant}});function Frustum(p0,p1,p2,p3,p4,p5){this.planes=[p0!==void 0?p0:new Plane,p1!==void 0?p1:new Plane,p2!==void 0?p2:new Plane,p3!==void 0?p3:new Plane,p4!==void 0?p4:new Plane,p5!==void 0?p5:new Plane]}Object.assign(Frustum.prototype,{set:function set(p0,p1,p2,p3,p4,p5){var planes=this.planes;planes[0].copy(p0);planes[1].copy(p1);planes[2].copy(p2);planes[3].copy(p3);planes[4].copy(p4);planes[5].copy(p5);return this},clone:function clone(){return new this.constructor().copy(this)},copy:function copy(frustum){for(var planes=this.planes,i=0;6>i;i++){planes[i].copy(frustum.planes[i])}return this},setFromMatrix:function setFromMatrix(m){var planes=this.planes,me=m.elements,me0=me[0],me1=me[1],me2=me[2],me3=me[3],me4=me[4],me5=me[5],me6=me[6],me7=me[7],me8=me[8],me9=me[9],me10=me[10],me11=me[11],me12=me[12],me13=me[13],me14=me[14],me15=me[15];planes[0].setComponents(me3-me0,me7-me4,me11-me8,me15-me12).normalize();planes[1].setComponents(me3+me0,me7+me4,me11+me8,me15+me12).normalize();planes[2].setComponents(me3+me1,me7+me5,me11+me9,me15+me13).normalize();planes[3].setComponents(me3-me1,me7-me5,me11-me9,me15-me13).normalize();planes[4].setComponents(me3-me2,me7-me6,me11-me10,me15-me14).normalize();planes[5].setComponents(me3+me2,me7+me6,me11+me10,me15+me14).normalize();return this},intersectsObject:function(){var sphere=new Sphere;return function(object){var geometry=object.geometry;if(null===geometry.boundingSphere)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere).applyMatrix4(object.matrixWorld);return this.intersectsSphere(sphere)}}(),intersectsSprite:function(){var sphere=new Sphere;return function(sprite){sphere.center.set(0,0,0);sphere.radius=.7071067811865476;sphere.applyMatrix4(sprite.matrixWorld);return this.intersectsSphere(sphere)}}(),intersectsSphere:function intersectsSphere(sphere){for(var planes=this.planes,center=sphere.center,negRadius=-sphere.radius,i=0,distance;6>i;i++){distance=planes[i].distanceToPoint(center);if(distance<negRadius){return!1}}return!0},intersectsBox:function(){var p1=new Vector3,p2=new Vector3;return function(box){for(var planes=this.planes,i=0,plane;6>i;i++){plane=planes[i];p1.x=0<plane.normal.x?box.min.x:box.max.x;p2.x=0<plane.normal.x?box.max.x:box.min.x;p1.y=0<plane.normal.y?box.min.y:box.max.y;p2.y=0<plane.normal.y?box.max.y:box.min.y;p1.z=0<plane.normal.z?box.min.z:box.max.z;p2.z=0<plane.normal.z?box.max.z:box.min.z;var d1=plane.distanceToPoint(p1),d2=plane.distanceToPoint(p2);if(0>d1&&0>d2){return!1}}return!0}}(),containsPoint:function containsPoint(point){for(var planes=this.planes,i=0;6>i;i++){if(0>planes[i].distanceToPoint(point)){return!1}}return!0}});function WebGLShadowMap(_renderer,_objects,maxTextureSize){for(var _frustum=new Frustum,_projScreenMatrix=new Matrix4,_shadowMapSize=new Vector2,_maxShadowMapSize=new Vector2(maxTextureSize,maxTextureSize),_lookTarget=new Vector3,_lightPositionWorld=new Vector3,_MorphingFlag=1,_SkinningFlag=2,_NumberOfMaterialVariants=(_MorphingFlag|_SkinningFlag)+1,_depthMaterials=Array(_NumberOfMaterialVariants),_distanceMaterials=Array(_NumberOfMaterialVariants),_materialCache={},shadowSide={0:BackSide,1:FrontSide,2:DoubleSide},cubeDirections=[new Vector3(1,0,0),new Vector3(-1,0,0),new Vector3(0,0,1),new Vector3(0,0,-1),new Vector3(0,1,0),new Vector3(0,-1,0)],cubeUps=[new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,1,0),new Vector3(0,0,1),new Vector3(0,0,-1)],cube2DViewPorts=[new Vector4,new Vector4,new Vector4,new Vector4,new Vector4,new Vector4],i=0;i!==_NumberOfMaterialVariants;++i){var useMorphing=0!==(i&_MorphingFlag),useSkinning=0!==(i&_SkinningFlag),depthMaterial=new MeshDepthMaterial({depthPacking:RGBADepthPacking,morphTargets:useMorphing,skinning:useSkinning});_depthMaterials[i]=depthMaterial;var distanceMaterial=new MeshDistanceMaterial({morphTargets:useMorphing,skinning:useSkinning});_distanceMaterials[i]=distanceMaterial}var scope=this;this.enabled=!1;this.autoUpdate=!0;this.needsUpdate=!1;this.type=PCFShadowMap;this.render=function(lights,scene,camera){if(!1===scope.enabled)return;if(!1===scope.autoUpdate&&!1===scope.needsUpdate)return;if(0===lights.length)return;var _gl=_renderer.context,_state=_renderer.state;_state.disable(_gl.BLEND);_state.buffers.color.setClear(1,1,1,1);_state.buffers.depth.setTest(!0);_state.setScissorTest(!1);for(var faceCount,i=0,il=lights.length;i<il;i++){var light=lights[i],shadow=light.shadow,isPointLight=light&&light.isPointLight;if(shadow===void 0){console.warn("THREE.WebGLShadowMap:",light,"has no shadow.");continue}var shadowCamera=shadow.camera;_shadowMapSize.copy(shadow.mapSize);_shadowMapSize.min(_maxShadowMapSize);if(isPointLight){var vpWidth=_shadowMapSize.x,vpHeight=_shadowMapSize.y;cube2DViewPorts[0].set(2*vpWidth,vpHeight,vpWidth,vpHeight);cube2DViewPorts[1].set(0,vpHeight,vpWidth,vpHeight);cube2DViewPorts[2].set(3*vpWidth,vpHeight,vpWidth,vpHeight);cube2DViewPorts[3].set(vpWidth,vpHeight,vpWidth,vpHeight);cube2DViewPorts[4].set(3*vpWidth,0,vpWidth,vpHeight);cube2DViewPorts[5].set(vpWidth,0,vpWidth,vpHeight);_shadowMapSize.x*=4;_shadowMapSize.y*=2}if(null===shadow.map){shadow.map=new WebGLRenderTarget(_shadowMapSize.x,_shadowMapSize.y,{minFilter:NearestFilter,magFilter:NearestFilter,format:RGBAFormat});shadow.map.texture.name=light.name+".shadowMap";shadowCamera.updateProjectionMatrix()}if(shadow.isSpotLightShadow){shadow.update(light)}var shadowMap=shadow.map,shadowMatrix=shadow.matrix;_lightPositionWorld.setFromMatrixPosition(light.matrixWorld);shadowCamera.position.copy(_lightPositionWorld);if(isPointLight){faceCount=6;shadowMatrix.makeTranslation(-_lightPositionWorld.x,-_lightPositionWorld.y,-_lightPositionWorld.z)}else{faceCount=1;_lookTarget.setFromMatrixPosition(light.target.matrixWorld);shadowCamera.lookAt(_lookTarget);shadowCamera.updateMatrixWorld();shadowMatrix.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1);shadowMatrix.multiply(shadowCamera.projectionMatrix);shadowMatrix.multiply(shadowCamera.matrixWorldInverse)}_renderer.setRenderTarget(shadowMap);_renderer.clear();for(var face=0;face<faceCount;face++){if(isPointLight){_lookTarget.copy(shadowCamera.position);_lookTarget.add(cubeDirections[face]);shadowCamera.up.copy(cubeUps[face]);shadowCamera.lookAt(_lookTarget);shadowCamera.updateMatrixWorld();var vpDimensions=cube2DViewPorts[face];_state.viewport(vpDimensions)}_projScreenMatrix.multiplyMatrices(shadowCamera.projectionMatrix,shadowCamera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);renderObject(scene,camera,shadowCamera,isPointLight)}}scope.needsUpdate=!1};function getDepthMaterial(object,material,isPointLight,lightPositionWorld,shadowCameraNear,shadowCameraFar){var geometry=object.geometry,result=null,materialVariants=_depthMaterials,customMaterial=object.customDepthMaterial;if(isPointLight){materialVariants=_distanceMaterials;customMaterial=object.customDistanceMaterial}if(!customMaterial){var useMorphing=!1;if(material.morphTargets){if(geometry&&geometry.isBufferGeometry){useMorphing=geometry.morphAttributes&&geometry.morphAttributes.position&&0<geometry.morphAttributes.position.length}else if(geometry&&geometry.isGeometry){useMorphing=geometry.morphTargets&&0<geometry.morphTargets.length}}if(object.isSkinnedMesh&&!1===material.skinning){console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",object)}var useSkinning=object.isSkinnedMesh&&material.skinning,variantIndex=0;if(useMorphing)variantIndex|=_MorphingFlag;if(useSkinning)variantIndex|=_SkinningFlag;result=materialVariants[variantIndex]}else{result=customMaterial}if(_renderer.localClippingEnabled&&!0===material.clipShadows&&0!==material.clippingPlanes.length){var keyA=result.uuid,keyB=material.uuid,materialsForVariant=_materialCache[keyA];if(materialsForVariant===void 0){materialsForVariant={};_materialCache[keyA]=materialsForVariant}var cachedMaterial=materialsForVariant[keyB];if(cachedMaterial===void 0){cachedMaterial=result.clone();materialsForVariant[keyB]=cachedMaterial}result=cachedMaterial}result.visible=material.visible;result.wireframe=material.wireframe;result.side=null!=material.shadowSide?material.shadowSide:shadowSide[material.side];result.clipShadows=material.clipShadows;result.clippingPlanes=material.clippingPlanes;result.clipIntersection=material.clipIntersection;result.wireframeLinewidth=material.wireframeLinewidth;result.linewidth=material.linewidth;if(isPointLight&&result.isMeshDistanceMaterial){result.referencePosition.copy(lightPositionWorld);result.nearDistance=shadowCameraNear;result.farDistance=shadowCameraFar}return result}function renderObject(object,camera,shadowCamera,isPointLight){if(!1===object.visible)return;var visible=object.layers.test(camera.layers);if(visible&&(object.isMesh||object.isLine||object.isPoints)){if(object.castShadow&&(!object.frustumCulled||_frustum.intersectsObject(object))){object.modelViewMatrix.multiplyMatrices(shadowCamera.matrixWorldInverse,object.matrixWorld);var geometry=_objects.update(object),material=object.material;if(Array.isArray(material)){for(var groups=geometry.groups,k=0,kl=groups.length;k<kl;k++){var group=groups[k],groupMaterial=material[group.materialIndex];if(groupMaterial&&groupMaterial.visible){var depthMaterial=getDepthMaterial(object,groupMaterial,isPointLight,_lightPositionWorld,shadowCamera.near,shadowCamera.far);_renderer.renderBufferDirect(shadowCamera,null,geometry,depthMaterial,object,group)}}}else if(material.visible){var depthMaterial=getDepthMaterial(object,material,isPointLight,_lightPositionWorld,shadowCamera.near,shadowCamera.far);_renderer.renderBufferDirect(shadowCamera,null,geometry,depthMaterial,object,null)}}}for(var children=object.children,i=0,l=children.length;i<l;i++){renderObject(children[i],camera,shadowCamera,isPointLight)}}}function WebGLAttributes(gl){var buffers={};function createBuffer(attribute,bufferType){var array=attribute.array,usage=attribute.dynamic?gl.DYNAMIC_DRAW:gl.STATIC_DRAW,buffer=gl.createBuffer();gl.bindBuffer(bufferType,buffer);gl.bufferData(bufferType,array,usage);attribute.onUploadCallback();var type=gl.FLOAT;if(babelHelpers.instanceof(array,Float32Array)){type=gl.FLOAT}else if(babelHelpers.instanceof(array,Float64Array)){console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array.")}else if(babelHelpers.instanceof(array,Uint16Array)){type=gl.UNSIGNED_SHORT}else if(babelHelpers.instanceof(array,Int16Array)){type=gl.SHORT}else if(babelHelpers.instanceof(array,Uint32Array)){type=gl.UNSIGNED_INT}else if(babelHelpers.instanceof(array,Int32Array)){type=gl.INT}else if(babelHelpers.instanceof(array,Int8Array)){type=gl.BYTE}else if(babelHelpers.instanceof(array,Uint8Array)){type=gl.UNSIGNED_BYTE}return{buffer:buffer,type:type,bytesPerElement:array.BYTES_PER_ELEMENT,version:attribute.version}}function updateBuffer(buffer,attribute,bufferType){var array=attribute.array,updateRange=attribute.updateRange;gl.bindBuffer(bufferType,buffer);if(!1===attribute.dynamic){gl.bufferData(bufferType,array,gl.STATIC_DRAW)}else if(-1===updateRange.count){gl.bufferSubData(bufferType,0,array)}else if(0===updateRange.count){console.error("THREE.WebGLObjects.updateBuffer: dynamic THREE.BufferAttribute marked as needsUpdate but updateRange.count is 0, ensure you are using set methods or updating manually.")}else{gl.bufferSubData(bufferType,updateRange.offset*array.BYTES_PER_ELEMENT,array.subarray(updateRange.offset,updateRange.offset+updateRange.count));updateRange.count=-1}}return{get:function(attribute){if(attribute.isInterleavedBufferAttribute)attribute=attribute.data;return buffers[attribute.uuid]},remove:function(attribute){if(attribute.isInterleavedBufferAttribute)attribute=attribute.data;var data=buffers[attribute.uuid];if(data){gl.deleteBuffer(data.buffer);delete buffers[attribute.uuid]}},update:function(attribute,bufferType){if(attribute.isInterleavedBufferAttribute)attribute=attribute.data;var data=buffers[attribute.uuid];if(data===void 0){buffers[attribute.uuid]=createBuffer(attribute,bufferType)}else if(data.version<attribute.version){updateBuffer(data.buffer,attribute,bufferType);data.version=attribute.version}}}}function Euler(x,y,z,order){this._x=x||0;this._y=y||0;this._z=z||0;this._order=order||Euler.DefaultOrder}Euler.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];Euler.DefaultOrder="XYZ";Object.defineProperties(Euler.prototype,{x:{get:function get(){return this._x},set:function set(value){this._x=value;this.onChangeCallback()}},y:{get:function get(){return this._y},set:function set(value){this._y=value;this.onChangeCallback()}},z:{get:function get(){return this._z},set:function set(value){this._z=value;this.onChangeCallback()}},order:{get:function get(){return this._order},set:function set(value){this._order=value;this.onChangeCallback()}}});Object.assign(Euler.prototype,{isEuler:!0,set:function set(x,y,z,order){this._x=x;this._y=y;this._z=z;this._order=order||this._order;this.onChangeCallback();return this},clone:function clone(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function copy(euler){this._x=euler._x;this._y=euler._y;this._z=euler._z;this._order=euler._order;this.onChangeCallback();return this},setFromRotationMatrix:function setFromRotationMatrix(m,order,update){var _Mathasin=Math.asin,clamp=_Math.clamp,te=m.elements,m11=te[0],m12=te[4],m13=te[8],m21=te[1],m22=te[5],m23=te[9],m31=te[2],m32=te[6],m33=te[10];order=order||this._order;if("XYZ"===order){this._y=_Mathasin(clamp(m13,-1,1));if(.99999>_Mathabs(m13)){this._x=_Mathatan(-m23,m33);this._z=_Mathatan(-m12,m11)}else{this._x=_Mathatan(m32,m22);this._z=0}}else if("YXZ"===order){this._x=_Mathasin(-clamp(m23,-1,1));if(.99999>_Mathabs(m23)){this._y=_Mathatan(m13,m33);this._z=_Mathatan(m21,m22)}else{this._y=_Mathatan(-m31,m11);this._z=0}}else if("ZXY"===order){this._x=_Mathasin(clamp(m32,-1,1));if(.99999>_Mathabs(m32)){this._y=_Mathatan(-m31,m33);this._z=_Mathatan(-m12,m22)}else{this._y=0;this._z=_Mathatan(m21,m11)}}else if("ZYX"===order){this._y=_Mathasin(-clamp(m31,-1,1));if(.99999>_Mathabs(m31)){this._x=_Mathatan(m32,m33);this._z=_Mathatan(m21,m11)}else{this._x=0;this._z=_Mathatan(-m12,m22)}}else if("YZX"===order){this._z=_Mathasin(clamp(m21,-1,1));if(.99999>_Mathabs(m21)){this._x=_Mathatan(-m23,m22);this._y=_Mathatan(-m31,m11)}else{this._x=0;this._y=_Mathatan(m13,m33)}}else if("XZY"===order){this._z=_Mathasin(-clamp(m12,-1,1));if(.99999>_Mathabs(m12)){this._x=_Mathatan(m32,m22);this._y=_Mathatan(m13,m11)}else{this._x=_Mathatan(-m23,m33);this._y=0}}else{console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+order)}this._order=order;if(!1!==update)this.onChangeCallback();return this},setFromQuaternion:function(){var matrix=new Matrix4;return function(q,order,update){matrix.makeRotationFromQuaternion(q);return this.setFromRotationMatrix(matrix,order,update)}}(),setFromVector3:function setFromVector3(v,order){return this.set(v.x,v.y,v.z,order||this._order)},reorder:function(){var q=new Quaternion;return function(newOrder){q.setFromEuler(this);return this.setFromQuaternion(q,newOrder)}}(),equals:function(euler){return euler._x===this._x&&euler._y===this._y&&euler._z===this._z&&euler._order===this._order},fromArray:function fromArray(array){this._x=array[0];this._y=array[1];this._z=array[2];if(array[3]!==void 0)this._order=array[3];this.onChangeCallback();return this},toArray:function toArray(array,offset){if(array===void 0)array=[];if(offset===void 0)offset=0;array[offset]=this._x;array[offset+1]=this._y;array[offset+2]=this._z;array[offset+3]=this._order;return array},toVector3:function toVector3(optionalResult){if(optionalResult){return optionalResult.set(this._x,this._y,this._z)}else{return new Vector3(this._x,this._y,this._z)}},onChange:function onChange(callback){this.onChangeCallback=callback;return this},onChangeCallback:function onChangeCallback(){}});function Layers(){this.mask=0|1}Object.assign(Layers.prototype,{set:function set(channel){this.mask=0|1<<channel},enable:function enable(channel){this.mask|=0|1<<channel},toggle:function toggle(channel){this.mask^=0|1<<channel},disable:function disable(channel){this.mask&=~(0|1<<channel)},test:function test(layers){return 0!==(this.mask&layers.mask)}});var object3DId=0;function Object3D(){Object.defineProperty(this,"id",{value:object3DId++});this.uuid=_Math.generateUUID();this.name="";this.type="Object3D";this.parent=null;this.children=[];this.up=Object3D.DefaultUp.clone();var position=new Vector3,rotation=new Euler,quaternion=new Quaternion,scale=new Vector3(1,1,1);rotation.onChange(function(){quaternion.setFromEuler(rotation,!1)});quaternion.onChange(function(){rotation.setFromQuaternion(quaternion,void 0,!1)});Object.defineProperties(this,{position:{enumerable:!0,value:position},rotation:{enumerable:!0,value:rotation},quaternion:{enumerable:!0,value:quaternion},scale:{enumerable:!0,value:scale},modelViewMatrix:{value:new Matrix4},normalMatrix:{value:new Matrix3}});this.matrix=new Matrix4;this.matrixWorld=new Matrix4;this.matrixAutoUpdate=Object3D.DefaultMatrixAutoUpdate;this.matrixWorldNeedsUpdate=!1;this.layers=new Layers;this.visible=!0;this.castShadow=!1;this.receiveShadow=!1;this.frustumCulled=!0;this.renderOrder=0;this.userData={}}Object3D.DefaultUp=new Vector3(0,1,0);Object3D.DefaultMatrixAutoUpdate=!0;Object3D.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Object3D,isObject3D:!0,onBeforeRender:function onBeforeRender(){},onAfterRender:function onAfterRender(){},applyMatrix:function applyMatrix(matrix){this.matrix.multiplyMatrices(matrix,this.matrix);this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function applyQuaternion(q){this.quaternion.premultiply(q);return this},setRotationFromAxisAngle:function setRotationFromAxisAngle(axis,angle){this.quaternion.setFromAxisAngle(axis,angle)},setRotationFromEuler:function setRotationFromEuler(euler){this.quaternion.setFromEuler(euler,!0)},setRotationFromMatrix:function setRotationFromMatrix(m){this.quaternion.setFromRotationMatrix(m)},setRotationFromQuaternion:function setRotationFromQuaternion(q){this.quaternion.copy(q)},rotateOnAxis:function(){var q1=new Quaternion;return function(axis,angle){q1.setFromAxisAngle(axis,angle);this.quaternion.multiply(q1);return this}}(),rotateOnWorldAxis:function(){var q1=new Quaternion;return function(axis,angle){q1.setFromAxisAngle(axis,angle);this.quaternion.premultiply(q1);return this}}(),rotateX:function(){var v1=new Vector3(1,0,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateY:function(){var v1=new Vector3(0,1,0);return function(angle){return this.rotateOnAxis(v1,angle)}}(),rotateZ:function(){var v1=new Vector3(0,0,1);return function(angle){return this.rotateOnAxis(v1,angle)}}(),translateOnAxis:function(){var v1=new Vector3;return function(axis,distance){v1.copy(axis).applyQuaternion(this.quaternion);this.position.add(v1.multiplyScalar(distance));return this}}(),translateX:function(){var v1=new Vector3(1,0,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateY:function(){var v1=new Vector3(0,1,0);return function(distance){return this.translateOnAxis(v1,distance)}}(),translateZ:function(){var v1=new Vector3(0,0,1);return function(distance){return this.translateOnAxis(v1,distance)}}(),localToWorld:function localToWorld(vector){return vector.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var m1=new Matrix4;return function(vector){return vector.applyMatrix4(m1.getInverse(this.matrixWorld))}}(),lookAt:function(){var m1=new Matrix4,vector=new Vector3;return function(x,y,z){if(x.isVector3){vector.copy(x)}else{vector.set(x,y,z)}if(this.isCamera){m1.lookAt(this.position,vector,this.up)}else{m1.lookAt(vector,this.position,this.up)}this.quaternion.setFromRotationMatrix(m1)}}(),add:function add(object){if(1<arguments.length){for(var i=0;i<arguments.length;i++){this.add(arguments[i])}return this}if(object===this){console.error("THREE.Object3D.add: object can't be added as a child of itself.",object);return this}if(object&&object.isObject3D){if(null!==object.parent){object.parent.remove(object)}object.parent=this;object.dispatchEvent({type:"added"});this.children.push(object)}else{console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",object)}return this},remove:function remove(object){if(1<arguments.length){for(var i=0;i<arguments.length;i++){this.remove(arguments[i])}return this}var index=this.children.indexOf(object);if(-1!==index){object.parent=null;object.dispatchEvent({type:"removed"});this.children.splice(index,1)}return this},getObjectById:function getObjectById(id){return this.getObjectByProperty("id",id)},getObjectByName:function getObjectByName(name){return this.getObjectByProperty("name",name)},getObjectByProperty:function getObjectByProperty(name,value){if(this[name]===value)return this;for(var i=0,l=this.children.length;i<l;i++){var child=this.children[i],object=child.getObjectByProperty(name,value);if(object!==void 0){return object}}},getWorldPosition:function getWorldPosition(optionalTarget){var result=optionalTarget||new Vector3;this.updateMatrixWorld(!0);return result.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(){var position=new Vector3,scale=new Vector3;return function(optionalTarget){var result=optionalTarget||new Quaternion;this.updateMatrixWorld(!0);this.matrixWorld.decompose(position,result,scale);return result}}(),getWorldRotation:function(){var quaternion=new Quaternion;return function(optionalTarget){var result=optionalTarget||new Euler;this.getWorldQuaternion(quaternion);return result.setFromQuaternion(quaternion,this.rotation.order,!1)}}(),getWorldScale:function(){var position=new Vector3,quaternion=new Quaternion;return function(optionalTarget){var result=optionalTarget||new Vector3;this.updateMatrixWorld(!0);this.matrixWorld.decompose(position,quaternion,result);return result}}(),getWorldDirection:function(){var quaternion=new Quaternion;return function(optionalTarget){var result=optionalTarget||new Vector3;this.getWorldQuaternion(quaternion);return result.set(0,0,1).applyQuaternion(quaternion)}}(),raycast:function raycast(){},traverse:function traverse(callback){callback(this);for(var children=this.children,i=0,l=children.length;i<l;i++){children[i].traverse(callback)}},traverseVisible:function traverseVisible(callback){if(!1===this.visible)return;callback(this);for(var children=this.children,i=0,l=children.length;i<l;i++){children[i].traverseVisible(callback)}},traverseAncestors:function traverseAncestors(callback){var parent=this.parent;if(null!==parent){callback(parent);parent.traverseAncestors(callback)}},updateMatrix:function updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale);this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function updateMatrixWorld(force){if(this.matrixAutoUpdate)this.updateMatrix();if(this.matrixWorldNeedsUpdate||force){if(null===this.parent){this.matrixWorld.copy(this.matrix)}else{this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)}this.matrixWorldNeedsUpdate=!1;force=!0}for(var children=this.children,i=0,l=children.length;i<l;i++){children[i].updateMatrixWorld(force)}},toJSON:function(meta){var isRootObject=meta===void 0||"string"===typeof meta,output={};if(isRootObject){meta={geometries:{},materials:{},textures:{},images:{},shapes:{}};output.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"}}var object={uuid:this.uuid,type:this.type};if(""!==this.name)object.name=this.name;if(!0===this.castShadow)object.castShadow=!0;if(!0===this.receiveShadow)object.receiveShadow=!0;if(!1===this.visible)object.visible=!1;if("{}"!==JSON.stringify(this.userData))object.userData=this.userData;object.matrix=this.matrix.toArray();function serialize(library,element){if(library[element.uuid]===void 0){library[element.uuid]=element.toJSON(meta)}return element.uuid}if(this.geometry!==void 0){object.geometry=serialize(meta.geometries,this.geometry);var parameters=this.geometry.parameters;if(parameters!==void 0&&parameters.shapes!==void 0){var shapes=parameters.shapes;if(Array.isArray(shapes)){for(var i=0,l=shapes.length,shape;i<l;i++){shape=shapes[i];serialize(meta.shapes,shape)}}else{serialize(meta.shapes,shapes)}}}if(this.material!==void 0){if(Array.isArray(this.material)){for(var uuids=[],i=0,l=this.material.length;i<l;i++){uuids.push(serialize(meta.materials,this.material[i]))}object.material=uuids}else{object.material=serialize(meta.materials,this.material)}}if(0<this.children.length){object.children=[];for(var i=0;i<this.children.length;i++){object.children.push(this.children[i].toJSON(meta).object)}}if(isRootObject){var geometries=extractFromCache(meta.geometries),materials=extractFromCache(meta.materials),textures=extractFromCache(meta.textures),images=extractFromCache(meta.images),shapes=extractFromCache(meta.shapes);if(0<geometries.length)output.geometries=geometries;if(0<materials.length)output.materials=materials;if(0<textures.length)output.textures=textures;if(0<images.length)output.images=images;if(0<shapes.length)output.shapes=shapes}output.object=object;return output;function extractFromCache(cache){var values=[];for(var key in cache){var data=cache[key];delete data.metadata;values.push(data)}return values}},clone:function clone(recursive){return new this.constructor().copy(this,recursive)},copy:function copy(source,recursive){if(recursive===void 0)recursive=!0;this.name=source.name;this.up.copy(source.up);this.position.copy(source.position);this.quaternion.copy(source.quaternion);this.scale.copy(source.scale);this.matrix.copy(source.matrix);this.matrixWorld.copy(source.matrixWorld);this.matrixAutoUpdate=source.matrixAutoUpdate;this.matrixWorldNeedsUpdate=source.matrixWorldNeedsUpdate;this.layers.mask=source.layers.mask;this.visible=source.visible;this.castShadow=source.castShadow;this.receiveShadow=source.receiveShadow;this.frustumCulled=source.frustumCulled;this.renderOrder=source.renderOrder;this.userData=JSON.parse(JSON.stringify(source.userData));if(!0===recursive){for(var i=0,child;i<source.children.length;i++){child=source.children[i];this.add(child.clone())}}return this}});function Camera(){Object3D.call(this);this.type="Camera";this.matrixWorldInverse=new Matrix4;this.projectionMatrix=new Matrix4}Camera.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Camera,isCamera:!0,copy:function copy(source,recursive){Object3D.prototype.copy.call(this,source,recursive);this.matrixWorldInverse.copy(source.matrixWorldInverse);this.projectionMatrix.copy(source.projectionMatrix);return this},getWorldDirection:function(){var quaternion=new Quaternion;return function(optionalTarget){var result=optionalTarget||new Vector3;this.getWorldQuaternion(quaternion);return result.set(0,0,-1).applyQuaternion(quaternion)}}(),updateMatrixWorld:function updateMatrixWorld(force){Object3D.prototype.updateMatrixWorld.call(this,force);this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function clone(){return new this.constructor().copy(this)}});function OrthographicCamera(left,right,top,bottom,near,far){Camera.call(this);this.type="OrthographicCamera";this.zoom=1;this.view=null;this.left=left;this.right=right;this.top=top;this.bottom=bottom;this.near=near!==void 0?near:.1;this.far=far!==void 0?far:2e3;this.updateProjectionMatrix()}OrthographicCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:OrthographicCamera,isOrthographicCamera:!0,copy:function copy(source,recursive){Camera.prototype.copy.call(this,source,recursive);this.left=source.left;this.right=source.right;this.top=source.top;this.bottom=source.bottom;this.near=source.near;this.far=source.far;this.zoom=source.zoom;this.view=null===source.view?null:Object.assign({},source.view);return this},setViewOffset:function setViewOffset(fullWidth,fullHeight,x,y,width,height){if(null===this.view){this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=!0;this.view.fullWidth=fullWidth;this.view.fullHeight=fullHeight;this.view.offsetX=x;this.view.offsetY=y;this.view.width=width;this.view.height=height;this.updateProjectionMatrix()},clearViewOffset:function clearViewOffset(){if(null!==this.view){this.view.enabled=!1}this.updateProjectionMatrix()},updateProjectionMatrix:function updateProjectionMatrix(){var dx=(this.right-this.left)/(2*this.zoom),dy=(this.top-this.bottom)/(2*this.zoom),cx=(this.right+this.left)/2,cy=(this.top+this.bottom)/2,left=cx-dx,right=cx+dx,top=cy+dy,bottom=cy-dy;if(null!==this.view&&this.view.enabled){var zoomW=this.zoom/(this.view.width/this.view.fullWidth),zoomH=this.zoom/(this.view.height/this.view.fullHeight),scaleW=(this.right-this.left)/this.view.width,scaleH=(this.top-this.bottom)/this.view.height;left+=scaleW*(this.view.offsetX/zoomW);right=left+scaleW*(this.view.width/zoomW);top-=scaleH*(this.view.offsetY/zoomH);bottom=top-scaleH*(this.view.height/zoomH)}this.projectionMatrix.makeOrthographic(left,right,top,bottom,this.near,this.far)},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);data.object.zoom=this.zoom;data.object.left=this.left;data.object.right=this.right;data.object.top=this.top;data.object.bottom=this.bottom;data.object.near=this.near;data.object.far=this.far;if(null!==this.view)data.object.view=Object.assign({},this.view);return data}});function Face3(a,b,c,normal,color,materialIndex){this.a=a;this.b=b;this.c=c;this.normal=normal&&normal.isVector3?normal:new Vector3;this.vertexNormals=Array.isArray(normal)?normal:[];this.color=color&&color.isColor?color:new Color;this.vertexColors=Array.isArray(color)?color:[];this.materialIndex=materialIndex!==void 0?materialIndex:0}Object.assign(Face3.prototype,{clone:function clone(){return new this.constructor().copy(this)},copy:function copy(source){this.a=source.a;this.b=source.b;this.c=source.c;this.normal.copy(source.normal);this.color.copy(source.color);this.materialIndex=source.materialIndex;for(var i=0,il=source.vertexNormals.length;i<il;i++){this.vertexNormals[i]=source.vertexNormals[i].clone()}for(var i=0,il=source.vertexColors.length;i<il;i++){this.vertexColors[i]=source.vertexColors[i].clone()}return this}});var geometryId=0;function Geometry(){Object.defineProperty(this,"id",{value:geometryId+=2});this.uuid=_Math.generateUUID();this.name="";this.type="Geometry";this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.elementsNeedUpdate=!1;this.verticesNeedUpdate=!1;this.uvsNeedUpdate=!1;this.normalsNeedUpdate=!1;this.colorsNeedUpdate=!1;this.lineDistancesNeedUpdate=!1;this.groupsNeedUpdate=!1}Geometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:Geometry,isGeometry:!0,applyMatrix:function applyMatrix(matrix){for(var normalMatrix=new Matrix3().getNormalMatrix(matrix),i=0,il=this.vertices.length,vertex;i<il;i++){vertex=this.vertices[i];vertex.applyMatrix4(matrix)}for(var i=0,il=this.faces.length,face;i<il;i++){face=this.faces[i];face.normal.applyMatrix3(normalMatrix).normalize();for(var j=0,jl=face.vertexNormals.length;j<jl;j++){face.vertexNormals[j].applyMatrix3(normalMatrix).normalize()}}if(null!==this.boundingBox){this.computeBoundingBox()}if(null!==this.boundingSphere){this.computeBoundingSphere()}this.verticesNeedUpdate=!0;this.normalsNeedUpdate=!0;return this},rotateX:function(){var m1=new Matrix4;return function(angle){m1.makeRotationX(angle);this.applyMatrix(m1);return this}}(),rotateY:function(){var m1=new Matrix4;return function(angle){m1.makeRotationY(angle);this.applyMatrix(m1);return this}}(),rotateZ:function(){var m1=new Matrix4;return function(angle){m1.makeRotationZ(angle);this.applyMatrix(m1);return this}}(),translate:function(){var m1=new Matrix4;return function(x,y,z){m1.makeTranslation(x,y,z);this.applyMatrix(m1);return this}}(),scale:function(){var m1=new Matrix4;return function(x,y,z){m1.makeScale(x,y,z);this.applyMatrix(m1);return this}}(),lookAt:function(){var obj=new Object3D;return function(vector){obj.lookAt(vector);obj.updateMatrix();this.applyMatrix(obj.matrix)}}(),fromBufferGeometry:function fromBufferGeometry(geometry){var scope=this,indices=null!==geometry.index?geometry.index.array:void 0,attributes=geometry.attributes,positions=attributes.position.array,normals=attributes.normal!==void 0?attributes.normal.array:void 0,colors=attributes.color!==void 0?attributes.color.array:void 0,uvs=attributes.uv!==void 0?attributes.uv.array:void 0,uvs2=attributes.uv2!==void 0?attributes.uv2.array:void 0;if(uvs2!==void 0)this.faceVertexUvs[1]=[];for(var tempNormals=[],tempUVs=[],tempUVs2=[],i=0,j=0;i<positions.length;i+=3,j+=2){scope.vertices.push(new Vector3(positions[i],positions[i+1],positions[i+2]));if(normals!==void 0){tempNormals.push(new Vector3(normals[i],normals[i+1],normals[i+2]))}if(colors!==void 0){scope.colors.push(new Color(colors[i],colors[i+1],colors[i+2]))}if(uvs!==void 0){tempUVs.push(new Vector2(uvs[j],uvs[j+1]))}if(uvs2!==void 0){tempUVs2.push(new Vector2(uvs2[j],uvs2[j+1]))}}function addFace(a,b,c,materialIndex){var vertexNormals=normals!==void 0?[tempNormals[a].clone(),tempNormals[b].clone(),tempNormals[c].clone()]:[],vertexColors=colors!==void 0?[scope.colors[a].clone(),scope.colors[b].clone(),scope.colors[c].clone()]:[],face=new Face3(a,b,c,vertexNormals,vertexColors,materialIndex);scope.faces.push(face);if(uvs!==void 0){scope.faceVertexUvs[0].push([tempUVs[a].clone(),tempUVs[b].clone(),tempUVs[c].clone()])}if(uvs2!==void 0){scope.faceVertexUvs[1].push([tempUVs2[a].clone(),tempUVs2[b].clone(),tempUVs2[c].clone()])}}var groups=geometry.groups;if(0<groups.length){for(var i=0;i<groups.length;i++){for(var group=groups[i],start=group.start,count=group.count,j=start;j<start+count;j+=3){if(indices!==void 0){addFace(indices[j],indices[j+1],indices[j+2],group.materialIndex)}else{addFace(j,j+1,j+2,group.materialIndex)}}}}else{if(indices!==void 0){for(var i=0;i<indices.length;i+=3){addFace(indices[i],indices[i+1],indices[i+2])}}else{for(var i=0;i<positions.length/3;i+=3){addFace(i,i+1,i+2)}}}this.computeFaceNormals();if(null!==geometry.boundingBox){this.boundingBox=geometry.boundingBox.clone()}if(null!==geometry.boundingSphere){this.boundingSphere=geometry.boundingSphere.clone()}return this},center:function center(){this.computeBoundingBox();var offset=this.boundingBox.getCenter().negate();this.translate(offset.x,offset.y,offset.z);return offset},normalize:function normalize(){this.computeBoundingSphere();var center=this.boundingSphere.center,radius=this.boundingSphere.radius,s=0===radius?1:1/radius,matrix=new Matrix4;matrix.set(s,0,0,-s*center.x,0,s,0,-s*center.y,0,0,s,-s*center.z,0,0,0,1);this.applyMatrix(matrix);return this},computeFaceNormals:function computeFaceNormals(){for(var cb=new Vector3,ab=new Vector3,f=0,fl=this.faces.length;f<fl;f++){var face=this.faces[f],vA=this.vertices[face.a],vB=this.vertices[face.b],vC=this.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);cb.normalize();face.normal.copy(cb)}},computeVertexNormals:function computeVertexNormals(areaWeighted){if(areaWeighted===void 0)areaWeighted=!0;var v,vl,f,fl,face,vertices;vertices=Array(this.vertices.length);for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v]=new Vector3}if(areaWeighted){var vA,vB,vC,cb=new Vector3,ab=new Vector3;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];vA=this.vertices[face.a];vB=this.vertices[face.b];vC=this.vertices[face.c];cb.subVectors(vC,vB);ab.subVectors(vA,vB);cb.cross(ab);vertices[face.a].add(cb);vertices[face.b].add(cb);vertices[face.c].add(cb)}}else{this.computeFaceNormals();for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];vertices[face.a].add(face.normal);vertices[face.b].add(face.normal);vertices[face.c].add(face.normal)}}for(v=0,vl=this.vertices.length;v<vl;v++){vertices[v].normalize()}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];var vertexNormals=face.vertexNormals;if(3===vertexNormals.length){vertexNormals[0].copy(vertices[face.a]);vertexNormals[1].copy(vertices[face.b]);vertexNormals[2].copy(vertices[face.c])}else{vertexNormals[0]=vertices[face.a].clone();vertexNormals[1]=vertices[face.b].clone();vertexNormals[2]=vertices[face.c].clone()}}if(0<this.faces.length){this.normalsNeedUpdate=!0}},computeFlatVertexNormals:function computeFlatVertexNormals(){var f,fl,face;this.computeFaceNormals();for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];var vertexNormals=face.vertexNormals;if(3===vertexNormals.length){vertexNormals[0].copy(face.normal);vertexNormals[1].copy(face.normal);vertexNormals[2].copy(face.normal)}else{vertexNormals[0]=face.normal.clone();vertexNormals[1]=face.normal.clone();vertexNormals[2]=face.normal.clone()}}if(0<this.faces.length){this.normalsNeedUpdate=!0}},computeMorphNormals:function computeMorphNormals(){var i,il,f,fl,face;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];if(!face.__originalFaceNormal){face.__originalFaceNormal=face.normal.clone()}else{face.__originalFaceNormal.copy(face.normal)}if(!face.__originalVertexNormals)face.__originalVertexNormals=[];for(i=0,il=face.vertexNormals.length;i<il;i++){if(!face.__originalVertexNormals[i]){face.__originalVertexNormals[i]=face.vertexNormals[i].clone()}else{face.__originalVertexNormals[i].copy(face.vertexNormals[i])}}}var tmpGeo=new Geometry;tmpGeo.faces=this.faces;for(i=0,il=this.morphTargets.length;i<il;i++){if(!this.morphNormals[i]){this.morphNormals[i]={};this.morphNormals[i].faceNormals=[];this.morphNormals[i].vertexNormals=[];var dstNormalsFace=this.morphNormals[i].faceNormals,dstNormalsVertex=this.morphNormals[i].vertexNormals,faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){faceNormal=new Vector3;vertexNormals={a:new Vector3,b:new Vector3,c:new Vector3};dstNormalsFace.push(faceNormal);dstNormalsVertex.push(vertexNormals)}}var morphNormals=this.morphNormals[i];tmpGeo.vertices=this.morphTargets[i].vertices;tmpGeo.computeFaceNormals();tmpGeo.computeVertexNormals();var faceNormal,vertexNormals;for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];faceNormal=morphNormals.faceNormals[f];vertexNormals=morphNormals.vertexNormals[f];faceNormal.copy(face.normal);vertexNormals.a.copy(face.vertexNormals[0]);vertexNormals.b.copy(face.vertexNormals[1]);vertexNormals.c.copy(face.vertexNormals[2])}}for(f=0,fl=this.faces.length;f<fl;f++){face=this.faces[f];face.normal=face.__originalFaceNormal;face.vertexNormals=face.__originalVertexNormals}},computeBoundingBox:function computeBoundingBox(){if(null===this.boundingBox){this.boundingBox=new Box3}this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function computeBoundingSphere(){if(null===this.boundingSphere){this.boundingSphere=new Sphere}this.boundingSphere.setFromPoints(this.vertices)},merge:function merge(geometry,matrix,materialIndexOffset){if(!(geometry&&geometry.isGeometry)){console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",geometry);return}var normalMatrix,vertexOffset=this.vertices.length,vertices1=this.vertices,vertices2=geometry.vertices,faces1=this.faces,faces2=geometry.faces,uvs1=this.faceVertexUvs[0],uvs2=geometry.faceVertexUvs[0],colors1=this.colors,colors2=geometry.colors;if(materialIndexOffset===void 0)materialIndexOffset=0;if(matrix!==void 0){normalMatrix=new Matrix3().getNormalMatrix(matrix)}for(var i=0,il=vertices2.length;i<il;i++){var vertex=vertices2[i],vertexCopy=vertex.clone();if(matrix!==void 0)vertexCopy.applyMatrix4(matrix);vertices1.push(vertexCopy)}for(var i=0,il=colors2.length;i<il;i++){colors1.push(colors2[i].clone())}for(i=0,il=faces2.length;i<il;i++){var face=faces2[i],faceCopy,normal,color,faceVertexNormals=face.vertexNormals,faceVertexColors=face.vertexColors;faceCopy=new Face3(face.a+vertexOffset,face.b+vertexOffset,face.c+vertexOffset);faceCopy.normal.copy(face.normal);if(normalMatrix!==void 0){faceCopy.normal.applyMatrix3(normalMatrix).normalize()}for(var j=0,jl=faceVertexNormals.length;j<jl;j++){normal=faceVertexNormals[j].clone();if(normalMatrix!==void 0){normal.applyMatrix3(normalMatrix).normalize()}faceCopy.vertexNormals.push(normal)}faceCopy.color.copy(face.color);for(var j=0,jl=faceVertexColors.length;j<jl;j++){color=faceVertexColors[j];faceCopy.vertexColors.push(color.clone())}faceCopy.materialIndex=face.materialIndex+materialIndexOffset;faces1.push(faceCopy)}for(i=0,il=uvs2.length;i<il;i++){var uv=uvs2[i],uvCopy=[];if(uv===void 0){continue}for(var j=0,jl=uv.length;j<jl;j++){uvCopy.push(uv[j].clone())}uvs1.push(uvCopy)}},mergeMesh:function mergeMesh(mesh){if(!(mesh&&mesh.isMesh)){console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",mesh);return}mesh.matrixAutoUpdate&&mesh.updateMatrix();this.merge(mesh.geometry,mesh.matrix)},mergeVertices:function mergeVertices(){var verticesMap={},unique=[],changes=[],v,key,precision=10000,i,il,face,indices,j,jl;for(i=0,il=this.vertices.length;i<il;i++){v=this.vertices[i];key=_Mathround(v.x*precision)+"_"+_Mathround(v.y*precision)+"_"+_Mathround(v.z*precision);if(verticesMap[key]===void 0){verticesMap[key]=i;unique.push(this.vertices[i]);changes[i]=unique.length-1}else{changes[i]=changes[verticesMap[key]]}}var faceIndicesToRemove=[];for(i=0,il=this.faces.length;i<il;i++){face=this.faces[i];face.a=changes[face.a];face.b=changes[face.b];face.c=changes[face.c];indices=[face.a,face.b,face.c];for(var n=0;3>n;n++){if(indices[n]===indices[(n+1)%3]){faceIndicesToRemove.push(i);break}}}for(i=faceIndicesToRemove.length-1;0<=i;i--){var idx=faceIndicesToRemove[i];this.faces.splice(idx,1);for(j=0,jl=this.faceVertexUvs.length;j<jl;j++){this.faceVertexUvs[j].splice(idx,1)}}var diff=this.vertices.length-unique.length;this.vertices=unique;return diff},setFromPoints:function setFromPoints(points){this.vertices=[];for(var i=0,l=points.length,point;i<l;i++){point=points[i];this.vertices.push(new Vector3(point.x,point.y,point.z||0))}return this},sortFacesByMaterialIndex:function sortFacesByMaterialIndex(){for(var faces=this.faces,length=faces.length,i=0;i<length;i++){faces[i]._id=i}faces.sort(function(a,b){return a.materialIndex-b.materialIndex});var uvs1=this.faceVertexUvs[0],uvs2=this.faceVertexUvs[1],newUvs1,newUvs2;if(uvs1&&uvs1.length===length)newUvs1=[];if(uvs2&&uvs2.length===length)newUvs2=[];for(var i=0,id;i<length;i++){id=faces[i]._id;if(newUvs1)newUvs1.push(uvs1[id]);if(newUvs2)newUvs2.push(uvs2[id])}if(newUvs1)this.faceVertexUvs[0]=newUvs1;if(newUvs2)this.faceVertexUvs[1]=newUvs2},toJSON:function(){var data={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"},uuid:this.uuid,type:this.type};if(""!==this.name)data.name=this.name;if(this.parameters!==void 0){var parameters=this.parameters;for(var key in parameters){if(parameters[key]!==void 0)data[key]=parameters[key]}return data}for(var vertices=[],i=0,vertex;i<this.vertices.length;i++){vertex=this.vertices[i];vertices.push(vertex.x,vertex.y,vertex.z)}for(var faces=[],normals=[],normalsHash={},colors=[],colorsHash={},uvs=[],uvsHash={},i=0;i<this.faces.length;i++){var face=this.faces[i],hasFaceVertexUv=this.faceVertexUvs[0][i]!==void 0,hasFaceNormal=0<face.normal.length(),hasFaceVertexNormal=0<face.vertexNormals.length,hasFaceColor=1!==face.color.r||1!==face.color.g||1!==face.color.b,hasFaceVertexColor=0<face.vertexColors.length,faceType=0;faceType=setBit(faceType,0,0);faceType=setBit(faceType,1,!0);faceType=setBit(faceType,2,!1);faceType=setBit(faceType,3,hasFaceVertexUv);faceType=setBit(faceType,4,hasFaceNormal);faceType=setBit(faceType,5,hasFaceVertexNormal);faceType=setBit(faceType,6,hasFaceColor);faceType=setBit(faceType,7,hasFaceVertexColor);faces.push(faceType);faces.push(face.a,face.b,face.c);faces.push(face.materialIndex);if(hasFaceVertexUv){var faceVertexUvs=this.faceVertexUvs[0][i];faces.push(getUvIndex(faceVertexUvs[0]),getUvIndex(faceVertexUvs[1]),getUvIndex(faceVertexUvs[2]))}if(hasFaceNormal){faces.push(getNormalIndex(face.normal))}if(hasFaceVertexNormal){var vertexNormals=face.vertexNormals;faces.push(getNormalIndex(vertexNormals[0]),getNormalIndex(vertexNormals[1]),getNormalIndex(vertexNormals[2]))}if(hasFaceColor){faces.push(getColorIndex(face.color))}if(hasFaceVertexColor){var vertexColors=face.vertexColors;faces.push(getColorIndex(vertexColors[0]),getColorIndex(vertexColors[1]),getColorIndex(vertexColors[2]))}}function setBit(value,position,enabled){return enabled?value|1<<position:value&~(1<<position)}function getNormalIndex(normal){var hash=normal.x.toString()+normal.y.toString()+normal.z.toString();if(normalsHash[hash]!==void 0){return normalsHash[hash]}normalsHash[hash]=normals.length/3;normals.push(normal.x,normal.y,normal.z);return normalsHash[hash]}function getColorIndex(color){var hash=color.r.toString()+color.g.toString()+color.b.toString();if(colorsHash[hash]!==void 0){return colorsHash[hash]}colorsHash[hash]=colors.length;colors.push(color.getHex());return colorsHash[hash]}function getUvIndex(uv){var hash=uv.x.toString()+uv.y.toString();if(uvsHash[hash]!==void 0){return uvsHash[hash]}uvsHash[hash]=uvs.length/2;uvs.push(uv.x,uv.y);return uvsHash[hash]}data.data={};data.data.vertices=vertices;data.data.normals=normals;if(0<colors.length)data.data.colors=colors;if(0<uvs.length)data.data.uvs=[uvs];data.data.faces=faces;return data},clone:function clone(){return new Geometry().copy(this)},copy:function copy(source){var i,il,j,jl,k,kl;this.vertices=[];this.colors=[];this.faces=[];this.faceVertexUvs=[[]];this.morphTargets=[];this.morphNormals=[];this.skinWeights=[];this.skinIndices=[];this.lineDistances=[];this.boundingBox=null;this.boundingSphere=null;this.name=source.name;var vertices=source.vertices;for(i=0,il=vertices.length;i<il;i++){this.vertices.push(vertices[i].clone())}var colors=source.colors;for(i=0,il=colors.length;i<il;i++){this.colors.push(colors[i].clone())}var faces=source.faces;for(i=0,il=faces.length;i<il;i++){this.faces.push(faces[i].clone())}for(i=0,il=source.faceVertexUvs.length;i<il;i++){var faceVertexUvs=source.faceVertexUvs[i];if(this.faceVertexUvs[i]===void 0){this.faceVertexUvs[i]=[]}for(j=0,jl=faceVertexUvs.length;j<jl;j++){var uvs=faceVertexUvs[j],uvsCopy=[];for(k=0,kl=uvs.length;k<kl;k++){var uv=uvs[k];uvsCopy.push(uv.clone())}this.faceVertexUvs[i].push(uvsCopy)}}var morphTargets=source.morphTargets;for(i=0,il=morphTargets.length;i<il;i++){var morphTarget={name:morphTargets[i].name};if(morphTargets[i].vertices!==void 0){morphTarget.vertices=[];for(j=0,jl=morphTargets[i].vertices.length;j<jl;j++){morphTarget.vertices.push(morphTargets[i].vertices[j].clone())}}if(morphTargets[i].normals!==void 0){morphTarget.normals=[];for(j=0,jl=morphTargets[i].normals.length;j<jl;j++){morphTarget.normals.push(morphTargets[i].normals[j].clone())}}this.morphTargets.push(morphTarget)}var morphNormals=source.morphNormals;for(i=0,il=morphNormals.length;i<il;i++){var morphNormal={};if(morphNormals[i].vertexNormals!==void 0){morphNormal.vertexNormals=[];for(j=0,jl=morphNormals[i].vertexNormals.length;j<jl;j++){var srcVertexNormal=morphNormals[i].vertexNormals[j],destVertexNormal={};destVertexNormal.a=srcVertexNormal.a.clone();destVertexNormal.b=srcVertexNormal.b.clone();destVertexNormal.c=srcVertexNormal.c.clone();morphNormal.vertexNormals.push(destVertexNormal)}}if(morphNormals[i].faceNormals!==void 0){morphNormal.faceNormals=[];for(j=0,jl=morphNormals[i].faceNormals.length;j<jl;j++){morphNormal.faceNormals.push(morphNormals[i].faceNormals[j].clone())}}this.morphNormals.push(morphNormal)}var skinWeights=source.skinWeights;for(i=0,il=skinWeights.length;i<il;i++){this.skinWeights.push(skinWeights[i].clone())}var skinIndices=source.skinIndices;for(i=0,il=skinIndices.length;i<il;i++){this.skinIndices.push(skinIndices[i].clone())}var lineDistances=source.lineDistances;for(i=0,il=lineDistances.length;i<il;i++){this.lineDistances.push(lineDistances[i])}var boundingBox=source.boundingBox;if(null!==boundingBox){this.boundingBox=boundingBox.clone()}var boundingSphere=source.boundingSphere;if(null!==boundingSphere){this.boundingSphere=boundingSphere.clone()}this.elementsNeedUpdate=source.elementsNeedUpdate;this.verticesNeedUpdate=source.verticesNeedUpdate;this.uvsNeedUpdate=source.uvsNeedUpdate;this.normalsNeedUpdate=source.normalsNeedUpdate;this.colorsNeedUpdate=source.colorsNeedUpdate;this.lineDistancesNeedUpdate=source.lineDistancesNeedUpdate;this.groupsNeedUpdate=source.groupsNeedUpdate;return this},dispose:function dispose(){this.dispatchEvent({type:"dispose"})}});function BufferAttribute(array,itemSize,normalized){if(Array.isArray(array)){throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.")}this.uuid=_Math.generateUUID();this.name="";this.array=array;this.itemSize=itemSize;this.count=array!==void 0?array.length/itemSize:0;this.normalized=!0===normalized;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}Object.defineProperty(BufferAttribute.prototype,"needsUpdate",{set:function set(value){if(!0===value)this.version++}});Object.assign(BufferAttribute.prototype,{isBufferAttribute:!0,setArray:function setArray(array){if(Array.isArray(array)){throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.")}this.count=array!==void 0?array.length/this.itemSize:0;this.array=array},setDynamic:function setDynamic(value){this.dynamic=value;return this},copy:function copy(source){this.array=new source.array.constructor(source.array);this.itemSize=source.itemSize;this.count=source.count;this.normalized=source.normalized;this.dynamic=source.dynamic;return this},copyAt:function copyAt(index1,attribute,index2){index1*=this.itemSize;index2*=attribute.itemSize;for(var i=0,l=this.itemSize;i<l;i++){this.array[index1+i]=attribute.array[index2+i]}return this},copyArray:function copyArray(array){this.array.set(array);return this},copyColorsArray:function copyColorsArray(colors){for(var array=this.array,offset=0,i=0,l=colors.length,color;i<l;i++){color=colors[i];if(color===void 0){console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i);color=new Color}array[offset++]=color.r;array[offset++]=color.g;array[offset++]=color.b}return this},copyIndicesArray:function copyIndicesArray(indices){for(var array=this.array,offset=0,i=0,l=indices.length,index;i<l;i++){index=indices[i];array[offset++]=index.a;array[offset++]=index.b;array[offset++]=index.c}return this},copyVector2sArray:function copyVector2sArray(vectors){for(var array=this.array,offset=0,i=0,l=vectors.length,vector;i<l;i++){vector=vectors[i];if(vector===void 0){console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i);vector=new Vector2}array[offset++]=vector.x;array[offset++]=vector.y}return this},copyVector3sArray:function copyVector3sArray(vectors){for(var array=this.array,offset=0,i=0,l=vectors.length,vector;i<l;i++){vector=vectors[i];if(vector===void 0){console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i);vector=new Vector3}array[offset++]=vector.x;array[offset++]=vector.y;array[offset++]=vector.z}return this},copyVector4sArray:function copyVector4sArray(vectors){for(var array=this.array,offset=0,i=0,l=vectors.length,vector;i<l;i++){vector=vectors[i];if(vector===void 0){console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i);vector=new Vector4}array[offset++]=vector.x;array[offset++]=vector.y;array[offset++]=vector.z;array[offset++]=vector.w}return this},set:function set(value,offset){if(offset===void 0)offset=0;this.array.set(value,offset);return this},getX:function getX(index){return this.array[index*this.itemSize]},setX:function setX(index,x){this.array[index*this.itemSize]=x;return this},getY:function getY(index){return this.array[index*this.itemSize+1]},setY:function setY(index,y){this.array[index*this.itemSize+1]=y;return this},getZ:function getZ(index){return this.array[index*this.itemSize+2]},setZ:function setZ(index,z){this.array[index*this.itemSize+2]=z;return this},getW:function getW(index){return this.array[index*this.itemSize+3]},setW:function setW(index,w){this.array[index*this.itemSize+3]=w;return this},setXY:function setXY(index,x,y){index*=this.itemSize;this.array[index+0]=x;this.array[index+1]=y;return this},setXYZ:function setXYZ(index,x,y,z){index*=this.itemSize;this.array[index+0]=x;this.array[index+1]=y;this.array[index+2]=z;return this},setXYZW:function setXYZW(index,x,y,z,w){index*=this.itemSize;this.array[index+0]=x;this.array[index+1]=y;this.array[index+2]=z;this.array[index+3]=w;return this},onUpload:function onUpload(callback){this.onUploadCallback=callback;return this},clone:function clone(){return new this.constructor(this.array,this.itemSize).copy(this)}});function Int8BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Int8Array(array),itemSize,normalized)}Int8BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int8BufferAttribute.prototype.constructor=Int8BufferAttribute;function Uint8BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint8Array(array),itemSize,normalized)}Uint8BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint8BufferAttribute.prototype.constructor=Uint8BufferAttribute;function Uint8ClampedBufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint8ClampedArray(array),itemSize,normalized)}Uint8ClampedBufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint8ClampedBufferAttribute.prototype.constructor=Uint8ClampedBufferAttribute;function Int16BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Int16Array(array),itemSize,normalized)}Int16BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int16BufferAttribute.prototype.constructor=Int16BufferAttribute;function Uint16BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint16Array(array),itemSize,normalized)}Uint16BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint16BufferAttribute.prototype.constructor=Uint16BufferAttribute;function Int32BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Int32Array(array),itemSize,normalized)}Int32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Int32BufferAttribute.prototype.constructor=Int32BufferAttribute;function Uint32BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Uint32Array(array),itemSize,normalized)}Uint32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Uint32BufferAttribute.prototype.constructor=Uint32BufferAttribute;function Float32BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Float32Array(array),itemSize,normalized)}Float32BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Float32BufferAttribute.prototype.constructor=Float32BufferAttribute;function Float64BufferAttribute(array,itemSize,normalized){BufferAttribute.call(this,new Float64Array(array),itemSize,normalized)}Float64BufferAttribute.prototype=Object.create(BufferAttribute.prototype);Float64BufferAttribute.prototype.constructor=Float64BufferAttribute;function DirectGeometry(){this.indices=[];this.vertices=[];this.normals=[];this.colors=[];this.uvs=[];this.uvs2=[];this.groups=[];this.morphTargets={};this.skinWeights=[];this.skinIndices=[];this.boundingBox=null;this.boundingSphere=null;this.verticesNeedUpdate=!1;this.normalsNeedUpdate=!1;this.colorsNeedUpdate=!1;this.uvsNeedUpdate=!1;this.groupsNeedUpdate=!1}Object.assign(DirectGeometry.prototype,{computeGroups:function computeGroups(geometry){for(var group,groups=[],materialIndex=void 0,faces=geometry.faces,i=0,face;i<faces.length;i++){face=faces[i];if(face.materialIndex!==materialIndex){materialIndex=face.materialIndex;if(group!==void 0){group.count=3*i-group.start;groups.push(group)}group={start:3*i,materialIndex:materialIndex}}}if(group!==void 0){group.count=3*i-group.start;groups.push(group)}this.groups=groups},fromGeometry:function fromGeometry(geometry){var faces=geometry.faces,vertices=geometry.vertices,faceVertexUvs=geometry.faceVertexUvs,hasFaceVertexUv=faceVertexUvs[0]&&0<faceVertexUvs[0].length,hasFaceVertexUv2=faceVertexUvs[1]&&0<faceVertexUvs[1].length,morphTargets=geometry.morphTargets,morphTargetsLength=morphTargets.length,morphTargetsPosition;if(0<morphTargetsLength){morphTargetsPosition=[];for(var i=0;i<morphTargetsLength;i++){morphTargetsPosition[i]=[]}this.morphTargets.position=morphTargetsPosition}var morphNormals=geometry.morphNormals,morphNormalsLength=morphNormals.length,morphTargetsNormal;if(0<morphNormalsLength){morphTargetsNormal=[];for(var i=0;i<morphNormalsLength;i++){morphTargetsNormal[i]=[]}this.morphTargets.normal=morphTargetsNormal}for(var skinIndices=geometry.skinIndices,skinWeights=geometry.skinWeights,hasSkinIndices=skinIndices.length===vertices.length,hasSkinWeights=skinWeights.length===vertices.length,i=0,face;i<faces.length;i++){face=faces[i];this.vertices.push(vertices[face.a],vertices[face.b],vertices[face.c]);var vertexNormals=face.vertexNormals;if(3===vertexNormals.length){this.normals.push(vertexNormals[0],vertexNormals[1],vertexNormals[2])}else{var normal=face.normal;this.normals.push(normal,normal,normal)}var vertexColors=face.vertexColors;if(3===vertexColors.length){this.colors.push(vertexColors[0],vertexColors[1],vertexColors[2])}else{var color=face.color;this.colors.push(color,color,color)}if(!0===hasFaceVertexUv){var vertexUvs=faceVertexUvs[0][i];if(vertexUvs!==void 0){this.uvs.push(vertexUvs[0],vertexUvs[1],vertexUvs[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",i);this.uvs.push(new Vector2,new Vector2,new Vector2)}}if(!0===hasFaceVertexUv2){var vertexUvs=faceVertexUvs[1][i];if(vertexUvs!==void 0){this.uvs2.push(vertexUvs[0],vertexUvs[1],vertexUvs[2])}else{console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",i);this.uvs2.push(new Vector2,new Vector2,new Vector2)}}for(var j=0,morphTarget;j<morphTargetsLength;j++){morphTarget=morphTargets[j].vertices;morphTargetsPosition[j].push(morphTarget[face.a],morphTarget[face.b],morphTarget[face.c])}for(var j=0,morphNormal;j<morphNormalsLength;j++){morphNormal=morphNormals[j].vertexNormals[i];morphTargetsNormal[j].push(morphNormal.a,morphNormal.b,morphNormal.c)}if(hasSkinIndices){this.skinIndices.push(skinIndices[face.a],skinIndices[face.b],skinIndices[face.c])}if(hasSkinWeights){this.skinWeights.push(skinWeights[face.a],skinWeights[face.b],skinWeights[face.c])}}this.computeGroups(geometry);this.verticesNeedUpdate=geometry.verticesNeedUpdate;this.normalsNeedUpdate=geometry.normalsNeedUpdate;this.colorsNeedUpdate=geometry.colorsNeedUpdate;this.uvsNeedUpdate=geometry.uvsNeedUpdate;this.groupsNeedUpdate=geometry.groupsNeedUpdate;return this}});function arrayMax(array){if(0===array.length)return-Infinity;for(var max=array[0],i=1,l=array.length;i<l;++i){if(array[i]>max)max=array[i]}return max}var bufferGeometryId=1;function BufferGeometry(){Object.defineProperty(this,"id",{value:bufferGeometryId+=2});this.uuid=_Math.generateUUID();this.name="";this.type="BufferGeometry";this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;this.drawRange={start:0,count:1/0}}BufferGeometry.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:BufferGeometry,isBufferGeometry:!0,getIndex:function getIndex(){return this.index},setIndex:function setIndex(index){if(Array.isArray(index)){this.index=new(65535<arrayMax(index)?Uint32BufferAttribute:Uint16BufferAttribute)(index,1)}else{this.index=index}},addAttribute:function addAttribute(name,attribute){if(!(attribute&&attribute.isBufferAttribute)&&!(attribute&&attribute.isInterleavedBufferAttribute)){console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute ).");this.addAttribute(name,new BufferAttribute(arguments[1],arguments[2]));return}if("index"===name){console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute.");this.setIndex(attribute);return}this.attributes[name]=attribute;return this},getAttribute:function getAttribute(name){return this.attributes[name]},removeAttribute:function removeAttribute(name){delete this.attributes[name];return this},addGroup:function addGroup(start,count,materialIndex){this.groups.push({start:start,count:count,materialIndex:materialIndex!==void 0?materialIndex:0})},clearGroups:function clearGroups(){this.groups=[]},setDrawRange:function setDrawRange(start,count){this.drawRange.start=start;this.drawRange.count=count},applyMatrix:function applyMatrix(matrix){var position=this.attributes.position;if(position!==void 0){matrix.applyToBufferAttribute(position);position.needsUpdate=!0}var normal=this.attributes.normal;if(normal!==void 0){var normalMatrix=new Matrix3().getNormalMatrix(matrix);normalMatrix.applyToBufferAttribute(normal);normal.needsUpdate=!0}if(null!==this.boundingBox){this.computeBoundingBox()}if(null!==this.boundingSphere){this.computeBoundingSphere()}return this},rotateX:function(){var m1=new Matrix4;return function(angle){m1.makeRotationX(angle);this.applyMatrix(m1);return this}}(),rotateY:function(){var m1=new Matrix4;return function(angle){m1.makeRotationY(angle);this.applyMatrix(m1);return this}}(),rotateZ:function(){var m1=new Matrix4;return function(angle){m1.makeRotationZ(angle);this.applyMatrix(m1);return this}}(),translate:function(){var m1=new Matrix4;return function(x,y,z){m1.makeTranslation(x,y,z);this.applyMatrix(m1);return this}}(),scale:function(){var m1=new Matrix4;return function(x,y,z){m1.makeScale(x,y,z);this.applyMatrix(m1);return this}}(),lookAt:function(){var obj=new Object3D;return function(vector){obj.lookAt(vector);obj.updateMatrix();this.applyMatrix(obj.matrix)}}(),center:function center(){this.computeBoundingBox();var offset=this.boundingBox.getCenter().negate();this.translate(offset.x,offset.y,offset.z);return offset},setFromObject:function setFromObject(object){var geometry=object.geometry;if(object.isPoints||object.isLine){var positions=new Float32BufferAttribute(3*geometry.vertices.length,3),colors=new Float32BufferAttribute(3*geometry.colors.length,3);this.addAttribute("position",positions.copyVector3sArray(geometry.vertices));this.addAttribute("color",colors.copyColorsArray(geometry.colors));if(geometry.lineDistances&&geometry.lineDistances.length===geometry.vertices.length){var lineDistances=new Float32BufferAttribute(geometry.lineDistances.length,1);this.addAttribute("lineDistance",lineDistances.copyArray(geometry.lineDistances))}if(null!==geometry.boundingSphere){this.boundingSphere=geometry.boundingSphere.clone()}if(null!==geometry.boundingBox){this.boundingBox=geometry.boundingBox.clone()}}else if(object.isMesh){if(geometry&&geometry.isGeometry){this.fromGeometry(geometry)}}return this},setFromPoints:function setFromPoints(points){for(var position=[],i=0,l=points.length,point;i<l;i++){point=points[i];position.push(point.x,point.y,point.z||0)}this.addAttribute("position",new Float32BufferAttribute(position,3));return this},updateFromObject:function updateFromObject(object){var geometry=object.geometry;if(object.isMesh){var direct=geometry.__directGeometry;if(!0===geometry.elementsNeedUpdate){direct=void 0;geometry.elementsNeedUpdate=!1}if(direct===void 0){return this.fromGeometry(geometry)}direct.verticesNeedUpdate=geometry.verticesNeedUpdate;direct.normalsNeedUpdate=geometry.normalsNeedUpdate;direct.colorsNeedUpdate=geometry.colorsNeedUpdate;direct.uvsNeedUpdate=geometry.uvsNeedUpdate;direct.groupsNeedUpdate=geometry.groupsNeedUpdate;geometry.verticesNeedUpdate=!1;geometry.normalsNeedUpdate=!1;geometry.colorsNeedUpdate=!1;geometry.uvsNeedUpdate=!1;geometry.groupsNeedUpdate=!1;geometry=direct}var attribute;if(!0===geometry.verticesNeedUpdate){attribute=this.attributes.position;if(attribute!==void 0){attribute.copyVector3sArray(geometry.vertices);attribute.needsUpdate=!0}geometry.verticesNeedUpdate=!1}if(!0===geometry.normalsNeedUpdate){attribute=this.attributes.normal;if(attribute!==void 0){attribute.copyVector3sArray(geometry.normals);attribute.needsUpdate=!0}geometry.normalsNeedUpdate=!1}if(!0===geometry.colorsNeedUpdate){attribute=this.attributes.color;if(attribute!==void 0){attribute.copyColorsArray(geometry.colors);attribute.needsUpdate=!0}geometry.colorsNeedUpdate=!1}if(geometry.uvsNeedUpdate){attribute=this.attributes.uv;if(attribute!==void 0){attribute.copyVector2sArray(geometry.uvs);attribute.needsUpdate=!0}geometry.uvsNeedUpdate=!1}if(geometry.lineDistancesNeedUpdate){attribute=this.attributes.lineDistance;if(attribute!==void 0){attribute.copyArray(geometry.lineDistances);attribute.needsUpdate=!0}geometry.lineDistancesNeedUpdate=!1}if(geometry.groupsNeedUpdate){geometry.computeGroups(object.geometry);this.groups=geometry.groups;geometry.groupsNeedUpdate=!1}return this},fromGeometry:function fromGeometry(geometry){geometry.__directGeometry=new DirectGeometry().fromGeometry(geometry);return this.fromDirectGeometry(geometry.__directGeometry)},fromDirectGeometry:function fromDirectGeometry(geometry){var positions=new Float32Array(3*geometry.vertices.length);this.addAttribute("position",new BufferAttribute(positions,3).copyVector3sArray(geometry.vertices));if(0<geometry.normals.length){var normals=new Float32Array(3*geometry.normals.length);this.addAttribute("normal",new BufferAttribute(normals,3).copyVector3sArray(geometry.normals))}if(0<geometry.colors.length){var colors=new Float32Array(3*geometry.colors.length);this.addAttribute("color",new BufferAttribute(colors,3).copyColorsArray(geometry.colors))}if(0<geometry.uvs.length){var uvs=new Float32Array(2*geometry.uvs.length);this.addAttribute("uv",new BufferAttribute(uvs,2).copyVector2sArray(geometry.uvs))}if(0<geometry.uvs2.length){var uvs2=new Float32Array(2*geometry.uvs2.length);this.addAttribute("uv2",new BufferAttribute(uvs2,2).copyVector2sArray(geometry.uvs2))}if(0<geometry.indices.length){var TypeArray=65535<arrayMax(geometry.indices)?Uint32Array:Uint16Array,indices=new TypeArray(3*geometry.indices.length);this.setIndex(new BufferAttribute(indices,1).copyIndicesArray(geometry.indices))}this.groups=geometry.groups;for(var name in geometry.morphTargets){for(var array=[],morphTargets=geometry.morphTargets[name],i=0,l=morphTargets.length;i<l;i++){var morphTarget=morphTargets[i],attribute=new Float32BufferAttribute(3*morphTarget.length,3);array.push(attribute.copyVector3sArray(morphTarget))}this.morphAttributes[name]=array}if(0<geometry.skinIndices.length){var skinIndices=new Float32BufferAttribute(4*geometry.skinIndices.length,4);this.addAttribute("skinIndex",skinIndices.copyVector4sArray(geometry.skinIndices))}if(0<geometry.skinWeights.length){var skinWeights=new Float32BufferAttribute(4*geometry.skinWeights.length,4);this.addAttribute("skinWeight",skinWeights.copyVector4sArray(geometry.skinWeights))}if(null!==geometry.boundingSphere){this.boundingSphere=geometry.boundingSphere.clone()}if(null!==geometry.boundingBox){this.boundingBox=geometry.boundingBox.clone()}return this},computeBoundingBox:function computeBoundingBox(){if(null===this.boundingBox){this.boundingBox=new Box3}var position=this.attributes.position;if(position!==void 0){this.boundingBox.setFromBufferAttribute(position)}else{this.boundingBox.makeEmpty()}if(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z)){console.error("THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The \"position\" attribute is likely to have NaN values.",this)}},computeBoundingSphere:function(){var box=new Box3,vector=new Vector3;return function(){if(null===this.boundingSphere){this.boundingSphere=new Sphere}var position=this.attributes.position;if(position){var center=this.boundingSphere.center;box.setFromBufferAttribute(position);box.getCenter(center);for(var maxRadiusSq=0,i=0,il=position.count;i<il;i++){vector.x=position.getX(i);vector.y=position.getY(i);vector.z=position.getZ(i);maxRadiusSq=_Mathmax(maxRadiusSq,center.distanceToSquared(vector))}this.boundingSphere.radius=_Mathsqrt(maxRadiusSq);if(isNaN(this.boundingSphere.radius)){console.error("THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The \"position\" attribute is likely to have NaN values.",this)}}}}(),computeFaceNormals:function computeFaceNormals(){},computeVertexNormals:function computeVertexNormals(){var index=this.index,attributes=this.attributes,groups=this.groups;if(attributes.position){var positions=attributes.position.array;if(attributes.normal===void 0){this.addAttribute("normal",new BufferAttribute(new Float32Array(positions.length),3))}else{for(var array=attributes.normal.array,i=0,il=array.length;i<il;i++){array[i]=0}}var normals=attributes.normal.array,vA,vB,vC,pA=new Vector3,pB=new Vector3,pC=new Vector3,cb=new Vector3,ab=new Vector3;if(index){var indices=index.array;if(0===groups.length){this.addGroup(0,indices.length)}for(var j=0,jl=groups.length;j<jl;++j){for(var group=groups[j],start=group.start,count=group.count,i=start,il=start+count;i<il;i+=3){vA=3*indices[i+0];vB=3*indices[i+1];vC=3*indices[i+2];pA.fromArray(positions,vA);pB.fromArray(positions,vB);pC.fromArray(positions,vC);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[vA]+=cb.x;normals[vA+1]+=cb.y;normals[vA+2]+=cb.z;normals[vB]+=cb.x;normals[vB+1]+=cb.y;normals[vB+2]+=cb.z;normals[vC]+=cb.x;normals[vC+1]+=cb.y;normals[vC+2]+=cb.z}}}else{for(var i=0,il=positions.length;i<il;i+=9){pA.fromArray(positions,i);pB.fromArray(positions,i+3);pC.fromArray(positions,i+6);cb.subVectors(pC,pB);ab.subVectors(pA,pB);cb.cross(ab);normals[i]=cb.x;normals[i+1]=cb.y;normals[i+2]=cb.z;normals[i+3]=cb.x;normals[i+4]=cb.y;normals[i+5]=cb.z;normals[i+6]=cb.x;normals[i+7]=cb.y;normals[i+8]=cb.z}}this.normalizeNormals();attributes.normal.needsUpdate=!0}},merge:function merge(geometry,offset){if(!(geometry&&geometry.isBufferGeometry)){console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",geometry);return}if(offset===void 0)offset=0;var attributes=this.attributes;for(var key in attributes){if(geometry.attributes[key]===void 0)continue;for(var attribute1=attributes[key],attributeArray1=attribute1.array,attribute2=geometry.attributes[key],attributeArray2=attribute2.array,attributeSize=attribute2.itemSize,i=0,j=attributeSize*offset;i<attributeArray2.length;i++,j++){attributeArray1[j]=attributeArray2[i]}}return this},normalizeNormals:function(){var vector=new Vector3;return function(){for(var normals=this.attributes.normal,i=0,il=normals.count;i<il;i++){vector.x=normals.getX(i);vector.y=normals.getY(i);vector.z=normals.getZ(i);vector.normalize();normals.setXYZ(i,vector.x,vector.y,vector.z)}}}(),toNonIndexed:function toNonIndexed(){if(null===this.index){console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed.");return this}var geometry2=new BufferGeometry,indices=this.index.array,attributes=this.attributes;for(var name in attributes){for(var attribute=attributes[name],array=attribute.array,itemSize=attribute.itemSize,array2=new array.constructor(indices.length*itemSize),index=0,index2=0,i=0,l=indices.length;i<l;i++){index=indices[i]*itemSize;for(var j=0;j<itemSize;j++){array2[index2++]=array[index++]}}geometry2.addAttribute(name,new BufferAttribute(array2,itemSize))}return geometry2},toJSON:function(){var data={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"},uuid:this.uuid,type:this.type};if(""!==this.name)data.name=this.name;if(this.parameters!==void 0){var parameters=this.parameters;for(var key in parameters){if(parameters[key]!==void 0)data[key]=parameters[key]}return data}data.data={attributes:{}};var index=this.index;if(null!==index){var array=Array.prototype.slice.call(index.array);data.data.index={type:index.array.constructor.name,array:array}}var attributes=this.attributes;for(var key in attributes){var attribute=attributes[key],array=Array.prototype.slice.call(attribute.array);data.data.attributes[key]={itemSize:attribute.itemSize,type:attribute.array.constructor.name,array:array,normalized:attribute.normalized}}var groups=this.groups;if(0<groups.length){data.data.groups=JSON.parse(JSON.stringify(groups))}var boundingSphere=this.boundingSphere;if(null!==boundingSphere){data.data.boundingSphere={center:boundingSphere.center.toArray(),radius:boundingSphere.radius}}return data},clone:function clone(){return new BufferGeometry().copy(this)},copy:function copy(source){var name,i,l;this.index=null;this.attributes={};this.morphAttributes={};this.groups=[];this.boundingBox=null;this.boundingSphere=null;this.name=source.name;var index=source.index;if(null!==index){this.setIndex(index.clone())}var attributes=source.attributes;for(name in attributes){var attribute=attributes[name];this.addAttribute(name,attribute.clone())}var morphAttributes=source.morphAttributes;for(name in morphAttributes){var array=[],morphAttribute=morphAttributes[name];for(i=0,l=morphAttribute.length;i<l;i++){array.push(morphAttribute[i].clone())}this.morphAttributes[name]=array}var groups=source.groups;for(i=0,l=groups.length;i<l;i++){var group=groups[i];this.addGroup(group.start,group.count,group.materialIndex)}var boundingBox=source.boundingBox;if(null!==boundingBox){this.boundingBox=boundingBox.clone()}var boundingSphere=source.boundingSphere;if(null!==boundingSphere){this.boundingSphere=boundingSphere.clone()}this.drawRange.start=source.drawRange.start;this.drawRange.count=source.drawRange.count;return this},dispose:function dispose(){this.dispatchEvent({type:"dispose"})}});function BoxGeometry(width,height,depth,widthSegments,heightSegments,depthSegments){Geometry.call(this);this.type="BoxGeometry";this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments};this.fromBufferGeometry(new BoxBufferGeometry(width,height,depth,widthSegments,heightSegments,depthSegments));this.mergeVertices()}BoxGeometry.prototype=Object.create(Geometry.prototype);BoxGeometry.prototype.constructor=BoxGeometry;function BoxBufferGeometry(width,height,depth,widthSegments,heightSegments,depthSegments){BufferGeometry.call(this);this.type="BoxBufferGeometry";this.parameters={width:width,height:height,depth:depth,widthSegments:widthSegments,heightSegments:heightSegments,depthSegments:depthSegments};var scope=this;width=width||1;height=height||1;depth=depth||1;widthSegments=_Mathfloor(widthSegments)||1;heightSegments=_Mathfloor(heightSegments)||1;depthSegments=_Mathfloor(depthSegments)||1;var indices=[],vertices=[],normals=[],uvs=[],numberOfVertices=0,groupStart=0;buildPlane("z","y","x",-1,-1,depth,height,width,depthSegments,heightSegments,0);buildPlane("z","y","x",1,-1,depth,height,-width,depthSegments,heightSegments,1);buildPlane("x","z","y",1,1,width,depth,height,widthSegments,depthSegments,2);buildPlane("x","z","y",1,-1,width,depth,-height,widthSegments,depthSegments,3);buildPlane("x","y","z",1,-1,width,height,depth,widthSegments,heightSegments,4);buildPlane("x","y","z",-1,-1,width,height,-depth,widthSegments,heightSegments,5);this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("normal",new Float32BufferAttribute(normals,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2));function buildPlane(u,v,w,udir,vdir,width,height,depth,gridX,gridY,materialIndex){var gridX1=gridX+1,vertexCounter=0,groupCount=0,ix,iy,vector=new Vector3;for(iy=0;iy<gridY+1;iy++){var y=iy*(height/gridY)-height/2;for(ix=0;ix<gridX1;ix++){var x=ix*(width/gridX)-width/2;vector[u]=x*udir;vector[v]=y*vdir;vector[w]=depth/2;vertices.push(vector.x,vector.y,vector.z);vector[u]=0;vector[v]=0;vector[w]=0<depth?1:-1;normals.push(vector.x,vector.y,vector.z);uvs.push(ix/gridX);uvs.push(1-iy/gridY);vertexCounter+=1}}for(iy=0;iy<gridY;iy++){for(ix=0;ix<gridX;ix++){var a=numberOfVertices+ix+gridX1*iy,b=numberOfVertices+ix+gridX1*(iy+1),c=numberOfVertices+(ix+1)+gridX1*(iy+1),d=numberOfVertices+(ix+1)+gridX1*iy;indices.push(a,b,d);indices.push(b,c,d);groupCount+=6}}scope.addGroup(groupStart,groupCount,materialIndex);groupStart+=groupCount;numberOfVertices+=vertexCounter}}BoxBufferGeometry.prototype=Object.create(BufferGeometry.prototype);BoxBufferGeometry.prototype.constructor=BoxBufferGeometry;function PlaneGeometry(width,height,widthSegments,heightSegments){Geometry.call(this);this.type="PlaneGeometry";this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};this.fromBufferGeometry(new PlaneBufferGeometry(width,height,widthSegments,heightSegments));this.mergeVertices()}PlaneGeometry.prototype=Object.create(Geometry.prototype);PlaneGeometry.prototype.constructor=PlaneGeometry;function PlaneBufferGeometry(width,height,widthSegments,heightSegments){BufferGeometry.call(this);this.type="PlaneBufferGeometry";this.parameters={width:width,height:height,widthSegments:widthSegments,heightSegments:heightSegments};width=width||1;height=height||1;var width_half=width/2,height_half=height/2,gridX=_Mathfloor(widthSegments)||1,gridY=_Mathfloor(heightSegments)||1,gridX1=gridX+1,segment_width=width/gridX,segment_height=height/gridY,ix,iy,indices=[],vertices=[],normals=[],uvs=[];for(iy=0;iy<gridY+1;iy++){var y=iy*segment_height-height_half;for(ix=0;ix<gridX1;ix++){var x=ix*segment_width-width_half;vertices.push(x,-y,0);normals.push(0,0,1);uvs.push(ix/gridX);uvs.push(1-iy/gridY)}}for(iy=0;iy<gridY;iy++){for(ix=0;ix<gridX;ix++){var a=ix+gridX1*iy,b=ix+gridX1*(iy+1),c=ix+1+gridX1*(iy+1),d=ix+1+gridX1*iy;indices.push(a,b,d);indices.push(b,c,d)}}this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("normal",new Float32BufferAttribute(normals,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}PlaneBufferGeometry.prototype=Object.create(BufferGeometry.prototype);PlaneBufferGeometry.prototype.constructor=PlaneBufferGeometry;function MeshBasicMaterial(parameters){Material.call(this);this.type="MeshBasicMaterial";this.color=new Color(16777215);this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=!1;this.morphTargets=!1;this.lights=!1;this.setValues(parameters)}MeshBasicMaterial.prototype=Object.create(Material.prototype);MeshBasicMaterial.prototype.constructor=MeshBasicMaterial;MeshBasicMaterial.prototype.isMeshBasicMaterial=!0;MeshBasicMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.map=source.map;this.lightMap=source.lightMap;this.lightMapIntensity=source.lightMapIntensity;this.aoMap=source.aoMap;this.aoMapIntensity=source.aoMapIntensity;this.specularMap=source.specularMap;this.alphaMap=source.alphaMap;this.envMap=source.envMap;this.combine=source.combine;this.reflectivity=source.reflectivity;this.refractionRatio=source.refractionRatio;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.wireframeLinecap=source.wireframeLinecap;this.wireframeLinejoin=source.wireframeLinejoin;this.skinning=source.skinning;this.morphTargets=source.morphTargets;return this};function ShaderMaterial(parameters){Material.call(this);this.type="ShaderMaterial";this.defines={};this.uniforms={};this.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}";this.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}";this.linewidth=1;this.wireframe=!1;this.wireframeLinewidth=1;this.fog=!1;this.lights=!1;this.clipping=!1;this.skinning=!1;this.morphTargets=!1;this.morphNormals=!1;this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1};this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]};this.index0AttributeName=void 0;this.uniformsNeedUpdate=!1;if(parameters!==void 0){if(parameters.attributes!==void 0){console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead.")}this.setValues(parameters)}}ShaderMaterial.prototype=Object.create(Material.prototype);ShaderMaterial.prototype.constructor=ShaderMaterial;ShaderMaterial.prototype.isShaderMaterial=!0;ShaderMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.fragmentShader=source.fragmentShader;this.vertexShader=source.vertexShader;this.uniforms=UniformsUtils.clone(source.uniforms);this.defines=source.defines;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.lights=source.lights;this.clipping=source.clipping;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;this.extensions=source.extensions;return this};ShaderMaterial.prototype.toJSON=function(meta){var data=Material.prototype.toJSON.call(this,meta);data.uniforms=this.uniforms;data.vertexShader=this.vertexShader;data.fragmentShader=this.fragmentShader;return data};function Ray(origin,direction){this.origin=origin!==void 0?origin:new Vector3;this.direction=direction!==void 0?direction:new Vector3}Object.assign(Ray.prototype,{set:function set(origin,direction){this.origin.copy(origin);this.direction.copy(direction);return this},clone:function clone(){return new this.constructor().copy(this)},copy:function copy(ray){this.origin.copy(ray.origin);this.direction.copy(ray.direction);return this},at:function at(t,optionalTarget){var result=optionalTarget||new Vector3;return result.copy(this.direction).multiplyScalar(t).add(this.origin)},lookAt:function lookAt(v){this.direction.copy(v).sub(this.origin).normalize();return this},recast:function(){var v1=new Vector3;return function(t){this.origin.copy(this.at(t,v1));return this}}(),closestPointToPoint:function closestPointToPoint(point,optionalTarget){var result=optionalTarget||new Vector3;result.subVectors(point,this.origin);var directionDistance=result.dot(this.direction);if(0>directionDistance){return result.copy(this.origin)}return result.copy(this.direction).multiplyScalar(directionDistance).add(this.origin)},distanceToPoint:function distanceToPoint(point){return _Mathsqrt(this.distanceSqToPoint(point))},distanceSqToPoint:function(){var v1=new Vector3;return function(point){var directionDistance=v1.subVectors(point,this.origin).dot(this.direction);if(0>directionDistance){return this.origin.distanceToSquared(point)}v1.copy(this.direction).multiplyScalar(directionDistance).add(this.origin);return v1.distanceToSquared(point)}}(),distanceSqToSegment:function(){var segCenter=new Vector3,segDir=new Vector3,diff=new Vector3;return function(v0,v1,optionalPointOnRay,optionalPointOnSegment){segCenter.copy(v0).add(v1).multiplyScalar(.5);segDir.copy(v1).sub(v0).normalize();diff.copy(this.origin).sub(segCenter);var segExtent=.5*v0.distanceTo(v1),a01=-this.direction.dot(segDir),b0=diff.dot(this.direction),b1=-diff.dot(segDir),c=diff.lengthSq(),det=_Mathabs(1-a01*a01),s0,s1,sqrDist,extDet;if(0<det){s0=a01*b1-b0;s1=a01*b0-b1;extDet=segExtent*det;if(0<=s0){if(s1>=-extDet){if(s1<=extDet){var invDet=1/det;s0*=invDet;s1*=invDet;sqrDist=s0*(s0+a01*s1+2*b0)+s1*(a01*s0+s1+2*b1)+c}else{s1=segExtent;s0=_Mathmax(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}}else{s1=-segExtent;s0=_Mathmax(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}}else{if(s1<=-extDet){s0=_Mathmax(0,-(-a01*segExtent+b0));s1=0<s0?-segExtent:_Mathmin(_Mathmax(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c}else if(s1<=extDet){s0=0;s1=_Mathmin(_Mathmax(-segExtent,-b1),segExtent);sqrDist=s1*(s1+2*b1)+c}else{s0=_Mathmax(0,-(a01*segExtent+b0));s1=0<s0?segExtent:_Mathmin(_Mathmax(-segExtent,-b1),segExtent);sqrDist=-s0*s0+s1*(s1+2*b1)+c}}}else{s1=0<a01?-segExtent:segExtent;s0=_Mathmax(0,-(a01*s1+b0));sqrDist=-s0*s0+s1*(s1+2*b1)+c}if(optionalPointOnRay){optionalPointOnRay.copy(this.direction).multiplyScalar(s0).add(this.origin)}if(optionalPointOnSegment){optionalPointOnSegment.copy(segDir).multiplyScalar(s1).add(segCenter)}return sqrDist}}(),intersectSphere:function(){var v1=new Vector3;return function(sphere,optionalTarget){v1.subVectors(sphere.center,this.origin);var tca=v1.dot(this.direction),d2=v1.dot(v1)-tca*tca,radius2=sphere.radius*sphere.radius;if(d2>radius2)return null;var thc=_Mathsqrt(radius2-d2),t0=tca-thc,t1=tca+thc;if(0>t0&&0>t1)return null;if(0>t0)return this.at(t1,optionalTarget);return this.at(t0,optionalTarget)}}(),intersectsSphere:function intersectsSphere(sphere){return this.distanceToPoint(sphere.center)<=sphere.radius},distanceToPlane:function distanceToPlane(plane){var denominator=plane.normal.dot(this.direction);if(0===denominator){if(0===plane.distanceToPoint(this.origin)){return 0}return null}var t=-(this.origin.dot(plane.normal)+plane.constant)/denominator;return 0<=t?t:null},intersectPlane:function intersectPlane(plane,optionalTarget){var t=this.distanceToPlane(plane);if(null===t){return null}return this.at(t,optionalTarget)},intersectsPlane:function intersectsPlane(plane){var distToPoint=plane.distanceToPoint(this.origin);if(0===distToPoint){return!0}var denominator=plane.normal.dot(this.direction);if(0>denominator*distToPoint){return!0}return!1},intersectBox:function intersectBox(box,optionalTarget){var tmin,tmax,tymin,tymax,tzmin,tzmax,invdirx=1/this.direction.x,invdiry=1/this.direction.y,invdirz=1/this.direction.z,origin=this.origin;if(0<=invdirx){tmin=(box.min.x-origin.x)*invdirx;tmax=(box.max.x-origin.x)*invdirx}else{tmin=(box.max.x-origin.x)*invdirx;tmax=(box.min.x-origin.x)*invdirx}if(0<=invdiry){tymin=(box.min.y-origin.y)*invdiry;tymax=(box.max.y-origin.y)*invdiry}else{tymin=(box.max.y-origin.y)*invdiry;tymax=(box.min.y-origin.y)*invdiry}if(tmin>tymax||tymin>tmax)return null;if(tymin>tmin||tmin!==tmin)tmin=tymin;if(tymax<tmax||tmax!==tmax)tmax=tymax;if(0<=invdirz){tzmin=(box.min.z-origin.z)*invdirz;tzmax=(box.max.z-origin.z)*invdirz}else{tzmin=(box.max.z-origin.z)*invdirz;tzmax=(box.min.z-origin.z)*invdirz}if(tmin>tzmax||tzmin>tmax)return null;if(tzmin>tmin||tmin!==tmin)tmin=tzmin;if(tzmax<tmax||tmax!==tmax)tmax=tzmax;if(0>tmax)return null;return this.at(0<=tmin?tmin:tmax,optionalTarget)},intersectsBox:function(){var v=new Vector3;return function(box){return null!==this.intersectBox(box,v)}}(),intersectTriangle:function(){var diff=new Vector3,edge1=new Vector3,edge2=new Vector3,normal=new Vector3;return function(a,b,c,backfaceCulling,optionalTarget){edge1.subVectors(b,a);edge2.subVectors(c,a);normal.crossVectors(edge1,edge2);var DdN=this.direction.dot(normal),sign;if(0<DdN){if(backfaceCulling)return null;sign=1}else if(0>DdN){sign=-1;DdN=-DdN}else{return null}diff.subVectors(this.origin,a);var DdQxE2=sign*this.direction.dot(edge2.crossVectors(diff,edge2));if(0>DdQxE2){return null}var DdE1xQ=sign*this.direction.dot(edge1.cross(diff));if(0>DdE1xQ){return null}if(DdQxE2+DdE1xQ>DdN){return null}var QdN=-sign*diff.dot(normal);if(0>QdN){return null}return this.at(QdN/DdN,optionalTarget)}}(),applyMatrix4:function applyMatrix4(matrix4){this.origin.applyMatrix4(matrix4);this.direction.transformDirection(matrix4);return this},equals:function(ray){return ray.origin.equals(this.origin)&&ray.direction.equals(this.direction)}});function Line3(start,end){this.start=start!==void 0?start:new Vector3;this.end=end!==void 0?end:new Vector3}Object.assign(Line3.prototype,{set:function set(start,end){this.start.copy(start);this.end.copy(end);return this},clone:function clone(){return new this.constructor().copy(this)},copy:function copy(line){this.start.copy(line.start);this.end.copy(line.end);return this},getCenter:function getCenter(optionalTarget){var result=optionalTarget||new Vector3;return result.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function delta(optionalTarget){var result=optionalTarget||new Vector3;return result.subVectors(this.end,this.start)},distanceSq:function distanceSq(){return this.start.distanceToSquared(this.end)},distance:function distance(){return this.start.distanceTo(this.end)},at:function at(t,optionalTarget){var result=optionalTarget||new Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},closestPointToPointParameter:function(){var startP=new Vector3,startEnd=new Vector3;return function(point,clampToLine){startP.subVectors(point,this.start);startEnd.subVectors(this.end,this.start);var startEnd2=startEnd.dot(startEnd),startEnd_startP=startEnd.dot(startP),t=startEnd_startP/startEnd2;if(clampToLine){t=_Math.clamp(t,0,1)}return t}}(),closestPointToPoint:function closestPointToPoint(point,clampToLine,optionalTarget){var t=this.closestPointToPointParameter(point,clampToLine),result=optionalTarget||new Vector3;return this.delta(result).multiplyScalar(t).add(this.start)},applyMatrix4:function applyMatrix4(matrix){this.start.applyMatrix4(matrix);this.end.applyMatrix4(matrix);return this},equals:function(line){return line.start.equals(this.start)&&line.end.equals(this.end)}});function Triangle(a,b,c){this.a=a!==void 0?a:new Vector3;this.b=b!==void 0?b:new Vector3;this.c=c!==void 0?c:new Vector3}Object.assign(Triangle,{normal:function(){var v0=new Vector3;return function(a,b,c,optionalTarget){var result=optionalTarget||new Vector3;result.subVectors(c,b);v0.subVectors(a,b);result.cross(v0);var resultLengthSq=result.lengthSq();if(0<resultLengthSq){return result.multiplyScalar(1/_Mathsqrt(resultLengthSq))}return result.set(0,0,0)}}(),barycoordFromPoint:function(){var v0=new Vector3,v1=new Vector3,v2=new Vector3;return function(point,a,b,c,optionalTarget){v0.subVectors(c,a);v1.subVectors(b,a);v2.subVectors(point,a);var dot00=v0.dot(v0),dot01=v0.dot(v1),dot02=v0.dot(v2),dot11=v1.dot(v1),dot12=v1.dot(v2),denom=dot00*dot11-dot01*dot01,result=optionalTarget||new Vector3;if(0===denom){return result.set(-2,-1,-1)}var invDenom=1/denom,u=(dot11*dot02-dot01*dot12)*invDenom,v=(dot00*dot12-dot01*dot02)*invDenom;return result.set(1-u-v,v,u)}}(),containsPoint:function(){var v1=new Vector3;return function(point,a,b,c){var result=Triangle.barycoordFromPoint(point,a,b,c,v1);return 0<=result.x&&0<=result.y&&1>=result.x+result.y}}()});Object.assign(Triangle.prototype,{set:function set(a,b,c){this.a.copy(a);this.b.copy(b);this.c.copy(c);return this},setFromPointsAndIndices:function setFromPointsAndIndices(points,i0,i1,i2){this.a.copy(points[i0]);this.b.copy(points[i1]);this.c.copy(points[i2]);return this},clone:function clone(){return new this.constructor().copy(this)},copy:function copy(triangle){this.a.copy(triangle.a);this.b.copy(triangle.b);this.c.copy(triangle.c);return this},area:function(){var v0=new Vector3,v1=new Vector3;return function(){v0.subVectors(this.c,this.b);v1.subVectors(this.a,this.b);return .5*v0.cross(v1).length()}}(),midpoint:function midpoint(optionalTarget){var result=optionalTarget||new Vector3;return result.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function normal(optionalTarget){return Triangle.normal(this.a,this.b,this.c,optionalTarget)},plane:function plane(optionalTarget){var result=optionalTarget||new Plane;return result.setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function barycoordFromPoint(point,optionalTarget){return Triangle.barycoordFromPoint(point,this.a,this.b,this.c,optionalTarget)},containsPoint:function containsPoint(point){return Triangle.containsPoint(point,this.a,this.b,this.c)},intersectsBox:function intersectsBox(box){return box.intersectsTriangle(this)},closestPointToPoint:function(){var plane=new Plane,edgeList=[new Line3,new Line3,new Line3],projectedPoint=new Vector3,closestPoint=new Vector3;return function(point,optionalTarget){var result=optionalTarget||new Vector3,minDistance=1/0;plane.setFromCoplanarPoints(this.a,this.b,this.c);plane.projectPoint(point,projectedPoint);if(!0===this.containsPoint(projectedPoint)){result.copy(projectedPoint)}else{edgeList[0].set(this.a,this.b);edgeList[1].set(this.b,this.c);edgeList[2].set(this.c,this.a);for(var i=0;i<edgeList.length;i++){edgeList[i].closestPointToPoint(projectedPoint,!0,closestPoint);var distance=projectedPoint.distanceToSquared(closestPoint);if(distance<minDistance){minDistance=distance;result.copy(closestPoint)}}}return result}}(),equals:function(triangle){return triangle.a.equals(this.a)&&triangle.b.equals(this.b)&&triangle.c.equals(this.c)}});function Mesh(geometry,material){Object3D.call(this);this.type="Mesh";this.geometry=geometry!==void 0?geometry:new BufferGeometry;this.material=material!==void 0?material:new MeshBasicMaterial({color:16777215*Math.random()});this.drawMode=TrianglesDrawMode;this.updateMorphTargets()}Mesh.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Mesh,isMesh:!0,setDrawMode:function setDrawMode(value){this.drawMode=value},copy:function copy(source){Object3D.prototype.copy.call(this,source);this.drawMode=source.drawMode;if(source.morphTargetInfluences!==void 0){this.morphTargetInfluences=source.morphTargetInfluences.slice()}if(source.morphTargetDictionary!==void 0){this.morphTargetDictionary=Object.assign({},source.morphTargetDictionary)}return this},updateMorphTargets:function updateMorphTargets(){var geometry=this.geometry,m,ml,name;if(geometry.isBufferGeometry){var morphAttributes=geometry.morphAttributes,keys=Object.keys(morphAttributes);if(0<keys.length){var morphAttribute=morphAttributes[keys[0]];if(morphAttribute!==void 0){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(m=0,ml=morphAttribute.length;m<ml;m++){name=morphAttribute[m].name||m+"";this.morphTargetInfluences.push(0);this.morphTargetDictionary[name]=m}}}}else{var morphTargets=geometry.morphTargets;if(morphTargets!==void 0&&0<morphTargets.length){this.morphTargetInfluences=[];this.morphTargetDictionary={};for(m=0,ml=morphTargets.length;m<ml;m++){name=morphTargets[m].name||m+"";this.morphTargetInfluences.push(0);this.morphTargetDictionary[name]=m}}}},raycast:function(){var inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere,vA=new Vector3,vB=new Vector3,vC=new Vector3,tempA=new Vector3,tempB=new Vector3,tempC=new Vector3,uvA=new Vector2,uvB=new Vector2,uvC=new Vector2,barycoord=new Vector3,intersectionPoint=new Vector3,intersectionPointWorld=new Vector3;function uvIntersection(point,p1,p2,p3,uv1,uv2,uv3){Triangle.barycoordFromPoint(point,p1,p2,p3,barycoord);uv1.multiplyScalar(barycoord.x);uv2.multiplyScalar(barycoord.y);uv3.multiplyScalar(barycoord.z);uv1.add(uv2).add(uv3);return uv1.clone()}function checkIntersection(object,material,raycaster,ray,pA,pB,pC,point){var intersect;if(material.side===BackSide){intersect=ray.intersectTriangle(pC,pB,pA,!0,point)}else{intersect=ray.intersectTriangle(pA,pB,pC,material.side!==DoubleSide,point)}if(null===intersect)return null;intersectionPointWorld.copy(point);intersectionPointWorld.applyMatrix4(object.matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectionPointWorld);if(distance<raycaster.near||distance>raycaster.far)return null;return{distance:distance,point:intersectionPointWorld.clone(),object:object}}function checkBufferGeometryIntersection(object,raycaster,ray,position,uv,a,b,c){vA.fromBufferAttribute(position,a);vB.fromBufferAttribute(position,b);vC.fromBufferAttribute(position,c);var intersection=checkIntersection(object,object.material,raycaster,ray,vA,vB,vC,intersectionPoint);if(intersection){if(uv){uvA.fromBufferAttribute(uv,a);uvB.fromBufferAttribute(uv,b);uvC.fromBufferAttribute(uv,c);intersection.uv=uvIntersection(intersectionPoint,vA,vB,vC,uvA,uvB,uvC)}intersection.face=new Face3(a,b,c,Triangle.normal(vA,vB,vC));intersection.faceIndex=a}return intersection}return function(raycaster,intersects){var geometry=this.geometry,material=this.material,matrixWorld=this.matrixWorld;if(material===void 0)return;if(null===geometry.boundingSphere)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(matrixWorld);if(!1===raycaster.ray.intersectsSphere(sphere))return;inverseMatrix.getInverse(matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);if(null!==geometry.boundingBox){if(!1===ray.intersectsBox(geometry.boundingBox))return}var intersection;if(geometry.isBufferGeometry){var a,b,c,index=geometry.index,position=geometry.attributes.position,uv=geometry.attributes.uv,i,l;if(null!==index){for(i=0,l=index.count;i<l;i+=3){a=index.getX(i);b=index.getX(i+1);c=index.getX(i+2);intersection=checkBufferGeometryIntersection(this,raycaster,ray,position,uv,a,b,c);if(intersection){intersection.faceIndex=_Mathfloor(i/3);intersects.push(intersection)}}}else if(position!==void 0){for(i=0,l=position.count;i<l;i+=3){a=i;b=i+1;c=i+2;intersection=checkBufferGeometryIntersection(this,raycaster,ray,position,uv,a,b,c);if(intersection){intersection.index=a;intersects.push(intersection)}}}}else if(geometry.isGeometry){var fvA,fvB,fvC,isMultiMaterial=Array.isArray(material),vertices=geometry.vertices,faces=geometry.faces,uvs,faceVertexUvs=geometry.faceVertexUvs[0];if(0<faceVertexUvs.length)uvs=faceVertexUvs;for(var f=0,fl=faces.length;f<fl;f++){var face=faces[f],faceMaterial=isMultiMaterial?material[face.materialIndex]:material;if(faceMaterial===void 0)continue;fvA=vertices[face.a];fvB=vertices[face.b];fvC=vertices[face.c];if(!0===faceMaterial.morphTargets){var morphTargets=geometry.morphTargets,morphInfluences=this.morphTargetInfluences;vA.set(0,0,0);vB.set(0,0,0);vC.set(0,0,0);for(var t=0,tl=morphTargets.length,influence;t<tl;t++){influence=morphInfluences[t];if(0===influence)continue;var targets=morphTargets[t].vertices;vA.addScaledVector(tempA.subVectors(targets[face.a],fvA),influence);vB.addScaledVector(tempB.subVectors(targets[face.b],fvB),influence);vC.addScaledVector(tempC.subVectors(targets[face.c],fvC),influence)}vA.add(fvA);vB.add(fvB);vC.add(fvC);fvA=vA;fvB=vB;fvC=vC}intersection=checkIntersection(this,faceMaterial,raycaster,ray,fvA,fvB,fvC,intersectionPoint);if(intersection){if(uvs&&uvs[f]){var uvs_f=uvs[f];uvA.copy(uvs_f[0]);uvB.copy(uvs_f[1]);uvC.copy(uvs_f[2]);intersection.uv=uvIntersection(intersectionPoint,fvA,fvB,fvC,uvA,uvB,uvC)}intersection.face=face;intersection.faceIndex=f;intersects.push(intersection)}}}}}(),clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this)}});function WebGLBackground(renderer,state,geometries,premultipliedAlpha){var clearColor=new Color(0),clearAlpha=0,planeCamera,planeMesh,boxMesh;function render(renderList,scene,camera,forceClear){var background=scene.background;if(null===background){setClear(clearColor,clearAlpha)}else if(background&&background.isColor){setClear(background,1);forceClear=!0}if(renderer.autoClear||forceClear){renderer.clear(renderer.autoClearColor,renderer.autoClearDepth,renderer.autoClearStencil)}if(background&&background.isCubeTexture){if(boxMesh===void 0){boxMesh=new Mesh(new BoxBufferGeometry(1,1,1),new ShaderMaterial({uniforms:ShaderLib.cube.uniforms,vertexShader:ShaderLib.cube.vertexShader,fragmentShader:ShaderLib.cube.fragmentShader,side:BackSide,depthTest:!0,depthWrite:!1,fog:!1}));boxMesh.geometry.removeAttribute("normal");boxMesh.geometry.removeAttribute("uv");boxMesh.onBeforeRender=function(renderer,scene,camera){this.matrixWorld.copyPosition(camera.matrixWorld)};geometries.update(boxMesh.geometry)}boxMesh.material.uniforms.tCube.value=background;renderList.push(boxMesh,boxMesh.geometry,boxMesh.material,0,null)}else if(background&&background.isTexture){if(planeCamera===void 0){planeCamera=new OrthographicCamera(-1,1,1,-1,0,1);planeMesh=new Mesh(new PlaneBufferGeometry(2,2),new MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1}));geometries.update(planeMesh.geometry)}planeMesh.material.map=background;renderer.renderBufferDirect(planeCamera,null,planeMesh.geometry,planeMesh.material,planeMesh,null)}}function setClear(color,alpha){state.buffers.color.setClear(color.r,color.g,color.b,alpha,premultipliedAlpha)}return{getClearColor:function getClearColor(){return clearColor},setClearColor:function setClearColor(color,alpha){clearColor.set(color);clearAlpha=alpha!==void 0?alpha:1;setClear(clearColor,clearAlpha)},getClearAlpha:function getClearAlpha(){return clearAlpha},setClearAlpha:function setClearAlpha(alpha){clearAlpha=alpha;setClear(clearColor,clearAlpha)},render:render}}function painterSortStable(a,b){if(a.renderOrder!==b.renderOrder){return a.renderOrder-b.renderOrder}else if(a.program&&b.program&&a.program!==b.program){return a.program.id-b.program.id}else if(a.material.id!==b.material.id){return a.material.id-b.material.id}else if(a.z!==b.z){return a.z-b.z}else{return a.id-b.id}}function reversePainterSortStable(a,b){if(a.renderOrder!==b.renderOrder){return a.renderOrder-b.renderOrder}if(a.z!==b.z){return b.z-a.z}else{return a.id-b.id}}function WebGLRenderList(){var renderItems=[],renderItemsIndex=0,opaque=[],transparent=[];function push(object,geometry,material,z,group){var renderItem=renderItems[renderItemsIndex];if(renderItem===void 0){renderItem={id:object.id,object:object,geometry:geometry,material:material,program:material.program,renderOrder:object.renderOrder,z:z,group:group};renderItems[renderItemsIndex]=renderItem}else{renderItem.id=object.id;renderItem.object=object;renderItem.geometry=geometry;renderItem.material=material;renderItem.program=material.program;renderItem.renderOrder=object.renderOrder;renderItem.z=z;renderItem.group=group}(!0===material.transparent?transparent:opaque).push(renderItem);renderItemsIndex++}return{opaque:opaque,transparent:transparent,init:function(){renderItemsIndex=0;opaque.length=0;transparent.length=0},push:push,sort:function(){if(1<opaque.length)opaque.sort(painterSortStable);if(1<transparent.length)transparent.sort(reversePainterSortStable)}}}function WebGLRenderLists(){var lists={};function get(scene,camera){var hash=scene.id+","+camera.id,list=lists[hash];if(list===void 0){list=new WebGLRenderList;lists[hash]=list}return list}return{get:get,dispose:function(){lists={}}}}function absNumericalSort(a,b){return _Mathabs(b[1])-_Mathabs(a[1])}function WebGLMorphtargets(gl){var influencesList={},morphInfluences=new Float32Array(8);return{update:function(object,geometry,material,program){var objectInfluences=object.morphTargetInfluences,length=objectInfluences.length,influences=influencesList[geometry.id];if(influences===void 0){influences=[];for(var i=0;i<length;i++){influences[i]=[i,0]}influencesList[geometry.id]=influences}for(var morphTargets=material.morphTargets&&geometry.morphAttributes.position,morphNormals=material.morphNormals&&geometry.morphAttributes.normal,i=0,influence;i<length;i++){influence=influences[i];if(0!==influence[1]){if(morphTargets)geometry.removeAttribute("morphTarget"+i);if(morphNormals)geometry.removeAttribute("morphNormal"+i)}}for(var i=0,influence;i<length;i++){influence=influences[i];influence[0]=i;influence[1]=objectInfluences[i]}influences.sort(absNumericalSort);for(var i=0,influence;8>i;i++){influence=influences[i];if(influence){var index=influence[0],value=influence[1];if(value){if(morphTargets)geometry.addAttribute("morphTarget"+i,morphTargets[index]);if(morphNormals)geometry.addAttribute("morphNormal"+i,morphNormals[index]);morphInfluences[i]=value;continue}}morphInfluences[i]=0}program.getUniforms().setValue(gl,"morphTargetInfluences",morphInfluences)}}}function WebGLIndexedBufferRenderer(gl,extensions,infoRender){var mode;var type,bytesPerElement;function render(start,count){gl.drawElements(mode,count,type,start*bytesPerElement);infoRender.calls++;infoRender.vertices+=count;if(mode===gl.TRIANGLES)infoRender.faces+=count/3;else if(mode===gl.POINTS)infoRender.points+=count}function renderInstances(geometry,start,count){var extension=extensions.get("ANGLE_instanced_arrays");if(null===extension){console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}extension.drawElementsInstancedANGLE(mode,count,type,start*bytesPerElement,geometry.maxInstancedCount);infoRender.calls++;infoRender.vertices+=count*geometry.maxInstancedCount;if(mode===gl.TRIANGLES)infoRender.faces+=geometry.maxInstancedCount*count/3;else if(mode===gl.POINTS)infoRender.points+=geometry.maxInstancedCount*count}this.setMode=function(value){mode=value};this.setIndex=function(value){type=value.type;bytesPerElement=value.bytesPerElement};this.render=render;this.renderInstances=renderInstances}function WebGLBufferRenderer(gl,extensions,infoRender){var mode;function render(start,count){gl.drawArrays(mode,start,count);infoRender.calls++;infoRender.vertices+=count;if(mode===gl.TRIANGLES)infoRender.faces+=count/3;else if(mode===gl.POINTS)infoRender.points+=count}function renderInstances(geometry,start,count){var extension=extensions.get("ANGLE_instanced_arrays");if(null===extension){console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}var position=geometry.attributes.position;if(position.isInterleavedBufferAttribute){count=position.data.count;extension.drawArraysInstancedANGLE(mode,0,count,geometry.maxInstancedCount)}else{extension.drawArraysInstancedANGLE(mode,start,count,geometry.maxInstancedCount)}infoRender.calls++;infoRender.vertices+=count*geometry.maxInstancedCount;if(mode===gl.TRIANGLES)infoRender.faces+=geometry.maxInstancedCount*count/3;else if(mode===gl.POINTS)infoRender.points+=geometry.maxInstancedCount*count}this.setMode=function(value){mode=value};this.render=render;this.renderInstances=renderInstances}function WebGLGeometries(gl,attributes,infoMemory){var geometries={},wireframeAttributes={};function onGeometryDispose(event){var geometry=event.target,buffergeometry=geometries[geometry.id];if(null!==buffergeometry.index){attributes.remove(buffergeometry.index)}for(var name in buffergeometry.attributes){attributes.remove(buffergeometry.attributes[name])}geometry.removeEventListener("dispose",onGeometryDispose);delete geometries[geometry.id];var attribute=wireframeAttributes[geometry.id];if(attribute){attributes.remove(attribute);delete wireframeAttributes[geometry.id]}attribute=wireframeAttributes[buffergeometry.id];if(attribute){attributes.remove(attribute);delete wireframeAttributes[buffergeometry.id]}infoMemory.geometries--}return{get:function(object,geometry){var buffergeometry=geometries[geometry.id];if(buffergeometry)return buffergeometry;geometry.addEventListener("dispose",onGeometryDispose);if(geometry.isBufferGeometry){buffergeometry=geometry}else if(geometry.isGeometry){if(geometry._bufferGeometry===void 0){geometry._bufferGeometry=new BufferGeometry().setFromObject(object)}buffergeometry=geometry._bufferGeometry}geometries[geometry.id]=buffergeometry;infoMemory.geometries++;return buffergeometry},update:function(geometry){var index=geometry.index,geometryAttributes=geometry.attributes;if(null!==index){attributes.update(index,gl.ELEMENT_ARRAY_BUFFER)}for(var name in geometryAttributes){attributes.update(geometryAttributes[name],gl.ARRAY_BUFFER)}var morphAttributes=geometry.morphAttributes;for(var name in morphAttributes){for(var array=morphAttributes[name],i=0,l=array.length;i<l;i++){attributes.update(array[i],gl.ARRAY_BUFFER)}}},getWireframeAttribute:function(geometry){var attribute=wireframeAttributes[geometry.id];if(attribute)return attribute;var indices=[],geometryIndex=geometry.index,geometryAttributes=geometry.attributes;if(null!==geometryIndex){for(var array=geometryIndex.array,i=0,l=array.length;i<l;i+=3){var a=array[i+0],b=array[i+1],c=array[i+2];indices.push(a,b,b,c,c,a)}}else{for(var array=geometryAttributes.position.array,i=0,l=array.length/3-1;i<l;i+=3){var a=i+0,b=i+1,c=i+2;indices.push(a,b,b,c,c,a)}}attribute=new(65535<arrayMax(indices)?Uint32BufferAttribute:Uint16BufferAttribute)(indices,1);attributes.update(attribute,gl.ELEMENT_ARRAY_BUFFER);wireframeAttributes[geometry.id]=attribute;return attribute}}}function WebGLObjects(geometries,infoRender){var updateList={};function update(object){var frame=infoRender.frame,geometry=object.geometry,buffergeometry=geometries.get(object,geometry);if(updateList[buffergeometry.id]!==frame){if(geometry.isGeometry){buffergeometry.updateFromObject(object)}geometries.update(buffergeometry);updateList[buffergeometry.id]=frame}return buffergeometry}return{update:update,dispose:function(){updateList={}}}}function addLineNumbers(string){for(var lines=string.split("\n"),i=0;i<lines.length;i++){lines[i]=i+1+": "+lines[i]}return lines.join("\n")}function WebGLShader(gl,type,string){var shader=gl.createShader(type);gl.shaderSource(shader,string);gl.compileShader(shader);if(!1===gl.getShaderParameter(shader,gl.COMPILE_STATUS)){console.error("THREE.WebGLShader: Shader couldn't compile.")}if(""!==gl.getShaderInfoLog(shader)){console.warn("THREE.WebGLShader: gl.getShaderInfoLog()",type===gl.VERTEX_SHADER?"vertex":"fragment",gl.getShaderInfoLog(shader),addLineNumbers(string))}return shader}var programIdCount=0;function getEncodingComponents(encoding){switch(encoding){case LinearEncoding:return["Linear","( value )"];case sRGBEncoding:return["sRGB","( value )"];case RGBEEncoding:return["RGBE","( value )"];case RGBM7Encoding:return["RGBM","( value, 7.0 )"];case RGBM16Encoding:return["RGBM","( value, 16.0 )"];case RGBDEncoding:return["RGBD","( value, 256.0 )"];case GammaEncoding:return["Gamma","( value, float( GAMMA_FACTOR ) )"];default:throw new Error("unsupported encoding: "+encoding);}}function getTexelDecodingFunction(functionName,encoding){var components=getEncodingComponents(encoding);return"vec4 "+functionName+"( vec4 value ) { return "+components[0]+"ToLinear"+components[1]+"; }"}function getTexelEncodingFunction(functionName,encoding){var components=getEncodingComponents(encoding);return"vec4 "+functionName+"( vec4 value ) { return LinearTo"+components[0]+components[1]+"; }"}function getToneMappingFunction(functionName,toneMapping){var toneMappingName;switch(toneMapping){case LinearToneMapping:toneMappingName="Linear";break;case ReinhardToneMapping:toneMappingName="Reinhard";break;case Uncharted2ToneMapping:toneMappingName="Uncharted2";break;case CineonToneMapping:toneMappingName="OptimizedCineon";break;default:throw new Error("unsupported toneMapping: "+toneMapping);}return"vec3 "+functionName+"( vec3 color ) { return "+toneMappingName+"ToneMapping( color ); }"}function generateExtensions(extensions,parameters,rendererExtensions){extensions=extensions||{};var chunks=[extensions.derivatives||parameters.envMapCubeUV||parameters.bumpMap||parameters.normalMap||parameters.flatShading?"#extension GL_OES_standard_derivatives : enable":"",(extensions.fragDepth||parameters.logarithmicDepthBuffer)&&rendererExtensions.get("EXT_frag_depth")?"#extension GL_EXT_frag_depth : enable":"",extensions.drawBuffers&&rendererExtensions.get("WEBGL_draw_buffers")?"#extension GL_EXT_draw_buffers : require":"",(extensions.shaderTextureLOD||parameters.envMap)&&rendererExtensions.get("EXT_shader_texture_lod")?"#extension GL_EXT_shader_texture_lod : enable":""];return chunks.filter(filterEmptyLine).join("\n")}function generateDefines(defines){var chunks=[];for(var name in defines){var value=defines[name];if(!1===value)continue;chunks.push("#define "+name+" "+value)}return chunks.join("\n")}function fetchAttributeLocations(gl,program){for(var attributes={},n=gl.getProgramParameter(program,gl.ACTIVE_ATTRIBUTES),i=0;i<n;i++){var info=gl.getActiveAttrib(program,i),name=info.name;attributes[name]=gl.getAttribLocation(program,name)}return attributes}function filterEmptyLine(string){return""!==string}function replaceLightNums(string,parameters){return string.replace(/NUM_DIR_LIGHTS/g,parameters.numDirLights).replace(/NUM_SPOT_LIGHTS/g,parameters.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,parameters.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,parameters.numPointLights).replace(/NUM_HEMI_LIGHTS/g,parameters.numHemiLights)}function replaceClippingPlaneNums(string,parameters){return string.replace(/NUM_CLIPPING_PLANES/g,parameters.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,parameters.numClippingPlanes-parameters.numClipIntersection)}function parseIncludes(string){var pattern=/^[ \t]*#include +<([\w\d.]+)>/gm;function replace(match,include){var replace=ShaderChunk[include];if(replace===void 0){throw new Error("Can not resolve #include <"+include+">")}return parseIncludes(replace)}return string.replace(pattern,replace)}function unrollLoops(string){var pattern=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;return string.replace(pattern,function(match,start,end,snippet){for(var unroll="",i=parseInt(start);i<parseInt(end);i++){unroll+=snippet.replace(/\[ i \]/g,"[ "+i+" ]")}return unroll})}function WebGLProgram(renderer,extensions,code,material,shader,parameters){var gl=renderer.context,defines=material.defines,vertexShader=shader.vertexShader,fragmentShader=shader.fragmentShader,shadowMapTypeDefine="SHADOWMAP_TYPE_BASIC";if(parameters.shadowMapType===PCFShadowMap){shadowMapTypeDefine="SHADOWMAP_TYPE_PCF"}else if(parameters.shadowMapType===PCFSoftShadowMap){shadowMapTypeDefine="SHADOWMAP_TYPE_PCF_SOFT"}var envMapTypeDefine="ENVMAP_TYPE_CUBE",envMapModeDefine="ENVMAP_MODE_REFLECTION",envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";if(parameters.envMap){switch(material.envMap.mapping){case CubeReflectionMapping:case CubeRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_CUBE";break;case CubeUVReflectionMapping:case CubeUVRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_CUBE_UV";break;case EquirectangularReflectionMapping:case EquirectangularRefractionMapping:envMapTypeDefine="ENVMAP_TYPE_EQUIREC";break;case SphericalReflectionMapping:envMapTypeDefine="ENVMAP_TYPE_SPHERE";break;}switch(material.envMap.mapping){case CubeRefractionMapping:case EquirectangularRefractionMapping:envMapModeDefine="ENVMAP_MODE_REFRACTION";break;}switch(material.combine){case MultiplyOperation:envMapBlendingDefine="ENVMAP_BLENDING_MULTIPLY";break;case MixOperation:envMapBlendingDefine="ENVMAP_BLENDING_MIX";break;case AddOperation:envMapBlendingDefine="ENVMAP_BLENDING_ADD";break;}}var gammaFactorDefine=0<renderer.gammaFactor?renderer.gammaFactor:1,customExtensions=generateExtensions(material.extensions,parameters,extensions),customDefines=generateDefines(defines),program=gl.createProgram(),prefixVertex,prefixFragment;if(material.isRawShaderMaterial){prefixVertex=[customDefines].filter(filterEmptyLine).join("\n");if(0<prefixVertex.length){prefixVertex+="\n"}prefixFragment=[customExtensions,customDefines].filter(filterEmptyLine).join("\n");if(0<prefixFragment.length){prefixFragment+="\n"}}else{prefixVertex=["precision "+parameters.precision+" float;","precision "+parameters.precision+" int;","#define SHADER_NAME "+shader.name,customDefines,parameters.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+gammaFactorDefine,"#define MAX_BONES "+parameters.maxBones,parameters.useFog&&parameters.fog?"#define USE_FOG":"",parameters.useFog&&parameters.fogExp?"#define FOG_EXP2":"",parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.aoMap?"#define USE_AOMAP":"",parameters.emissiveMap?"#define USE_EMISSIVEMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.displacementMap&&parameters.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.roughnessMap?"#define USE_ROUGHNESSMAP":"",parameters.metalnessMap?"#define USE_METALNESSMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.skinning?"#define USE_SKINNING":"",parameters.useVertexTexture?"#define BONE_TEXTURE":"",parameters.morphTargets?"#define USE_MORPHTARGETS":"",parameters.morphNormals&&!1===parameters.flatShading?"#define USE_MORPHNORMALS":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.sizeAttenuation?"#define USE_SIZEATTENUATION":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",parameters.logarithmicDepthBuffer&&extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_COLOR","\tattribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(filterEmptyLine).join("\n");prefixFragment=[customExtensions,"precision "+parameters.precision+" float;","precision "+parameters.precision+" int;","#define SHADER_NAME "+shader.name,customDefines,parameters.alphaTest?"#define ALPHATEST "+parameters.alphaTest:"","#define GAMMA_FACTOR "+gammaFactorDefine,parameters.useFog&&parameters.fog?"#define USE_FOG":"",parameters.useFog&&parameters.fogExp?"#define FOG_EXP2":"",parameters.map?"#define USE_MAP":"",parameters.envMap?"#define USE_ENVMAP":"",parameters.envMap?"#define "+envMapTypeDefine:"",parameters.envMap?"#define "+envMapModeDefine:"",parameters.envMap?"#define "+envMapBlendingDefine:"",parameters.lightMap?"#define USE_LIGHTMAP":"",parameters.aoMap?"#define USE_AOMAP":"",parameters.emissiveMap?"#define USE_EMISSIVEMAP":"",parameters.bumpMap?"#define USE_BUMPMAP":"",parameters.normalMap?"#define USE_NORMALMAP":"",parameters.specularMap?"#define USE_SPECULARMAP":"",parameters.roughnessMap?"#define USE_ROUGHNESSMAP":"",parameters.metalnessMap?"#define USE_METALNESSMAP":"",parameters.alphaMap?"#define USE_ALPHAMAP":"",parameters.vertexColors?"#define USE_COLOR":"",parameters.gradientMap?"#define USE_GRADIENTMAP":"",parameters.flatShading?"#define FLAT_SHADED":"",parameters.doubleSided?"#define DOUBLE_SIDED":"",parameters.flipSided?"#define FLIP_SIDED":"",parameters.shadowMapEnabled?"#define USE_SHADOWMAP":"",parameters.shadowMapEnabled?"#define "+shadowMapTypeDefine:"",parameters.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",parameters.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",parameters.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",parameters.logarithmicDepthBuffer&&extensions.get("EXT_frag_depth")?"#define USE_LOGDEPTHBUF_EXT":"",parameters.envMap&&extensions.get("EXT_shader_texture_lod")?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;",parameters.toneMapping!==NoToneMapping?"#define TONE_MAPPING":"",parameters.toneMapping!==NoToneMapping?ShaderChunk.tonemapping_pars_fragment:"",parameters.toneMapping!==NoToneMapping?getToneMappingFunction("toneMapping",parameters.toneMapping):"",parameters.dithering?"#define DITHERING":"",parameters.outputEncoding||parameters.mapEncoding||parameters.envMapEncoding||parameters.emissiveMapEncoding?ShaderChunk.encodings_pars_fragment:"",parameters.mapEncoding?getTexelDecodingFunction("mapTexelToLinear",parameters.mapEncoding):"",parameters.envMapEncoding?getTexelDecodingFunction("envMapTexelToLinear",parameters.envMapEncoding):"",parameters.emissiveMapEncoding?getTexelDecodingFunction("emissiveMapTexelToLinear",parameters.emissiveMapEncoding):"",parameters.outputEncoding?getTexelEncodingFunction("linearToOutputTexel",parameters.outputEncoding):"",parameters.depthPacking?"#define DEPTH_PACKING "+material.depthPacking:"","\n"].filter(filterEmptyLine).join("\n")}vertexShader=parseIncludes(vertexShader);vertexShader=replaceLightNums(vertexShader,parameters);vertexShader=replaceClippingPlaneNums(vertexShader,parameters);fragmentShader=parseIncludes(fragmentShader);fragmentShader=replaceLightNums(fragmentShader,parameters);fragmentShader=replaceClippingPlaneNums(fragmentShader,parameters);vertexShader=unrollLoops(vertexShader);fragmentShader=unrollLoops(fragmentShader);var vertexGlsl=prefixVertex+vertexShader,fragmentGlsl=prefixFragment+fragmentShader,glVertexShader=WebGLShader(gl,gl.VERTEX_SHADER,vertexGlsl),glFragmentShader=WebGLShader(gl,gl.FRAGMENT_SHADER,fragmentGlsl);gl.attachShader(program,glVertexShader);gl.attachShader(program,glFragmentShader);if(material.index0AttributeName!==void 0){gl.bindAttribLocation(program,0,material.index0AttributeName)}else if(!0===parameters.morphTargets){gl.bindAttribLocation(program,0,"position")}gl.linkProgram(program);var programLog=gl.getProgramInfoLog(program).trim(),vertexLog=gl.getShaderInfoLog(glVertexShader).trim(),fragmentLog=gl.getShaderInfoLog(glFragmentShader).trim(),runnable=!0,haveDiagnostics=!0;if(!1===gl.getProgramParameter(program,gl.LINK_STATUS)){runnable=!1;console.error("THREE.WebGLProgram: shader error: ",gl.getError(),"gl.VALIDATE_STATUS",gl.getProgramParameter(program,gl.VALIDATE_STATUS),"gl.getProgramInfoLog",programLog,vertexLog,fragmentLog)}else if(""!==programLog){console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",programLog)}else if(""===vertexLog||""===fragmentLog){haveDiagnostics=!1}if(haveDiagnostics){this.diagnostics={runnable:runnable,material:material,programLog:programLog,vertexShader:{log:vertexLog,prefix:prefixVertex},fragmentShader:{log:fragmentLog,prefix:prefixFragment}}}gl.deleteShader(glVertexShader);gl.deleteShader(glFragmentShader);var cachedUniforms;this.getUniforms=function(){if(cachedUniforms===void 0){cachedUniforms=new WebGLUniforms(gl,program,renderer)}return cachedUniforms};var cachedAttributes;this.getAttributes=function(){if(cachedAttributes===void 0){cachedAttributes=fetchAttributeLocations(gl,program)}return cachedAttributes};this.destroy=function(){gl.deleteProgram(program);this.program=void 0};Object.defineProperties(this,{uniforms:{get:function get(){console.warn("THREE.WebGLProgram: .uniforms is now .getUniforms().");return this.getUniforms()}},attributes:{get:function get(){console.warn("THREE.WebGLProgram: .attributes is now .getAttributes().");return this.getAttributes()}}});this.id=programIdCount++;this.code=code;this.usedTimes=1;this.program=program;this.vertexShader=glVertexShader;this.fragmentShader=glFragmentShader;return this}function WebGLPrograms(renderer,extensions,capabilities){var programs=[],shaderIDs={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"phong",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow"},parameterNames=["precision","supportsVertexTextures","map","mapEncoding","envMap","envMapMode","envMapEncoding","lightMap","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","fog","useFog","fogExp","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering"];function allocateBones(object){var skeleton=object.skeleton,bones=skeleton.bones;if(capabilities.floatVertexTextures){return 1024}else{var nVertexUniforms=capabilities.maxVertexUniforms,nVertexMatrices=_Mathfloor((nVertexUniforms-20)/4),maxBones=_Mathmin(nVertexMatrices,bones.length);if(maxBones<bones.length){console.warn("THREE.WebGLRenderer: Skeleton has "+bones.length+" bones. This GPU supports "+maxBones+".");return 0}return maxBones}}function getTextureEncodingFromMap(map,gammaOverrideLinear){var encoding;if(!map){encoding=LinearEncoding}else if(map.isTexture){encoding=map.encoding}else if(map.isWebGLRenderTarget){console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead.");encoding=map.texture.encoding}if(encoding===LinearEncoding&&gammaOverrideLinear){encoding=GammaEncoding}return encoding}this.getParameters=function(material,lights,shadows,fog,nClipPlanes,nClipIntersection,object){var shaderID=shaderIDs[material.type],maxBones=object.isSkinnedMesh?allocateBones(object):0,precision=capabilities.precision;if(null!==material.precision){precision=capabilities.getMaxPrecision(material.precision);if(precision!==material.precision){console.warn("THREE.WebGLProgram.getParameters:",material.precision,"not supported, using",precision,"instead.")}}var currentRenderTarget=renderer.getRenderTarget(),parameters={shaderID:shaderID,precision:precision,supportsVertexTextures:capabilities.vertexTextures,outputEncoding:getTextureEncodingFromMap(!currentRenderTarget?null:currentRenderTarget.texture,renderer.gammaOutput),map:!!material.map,mapEncoding:getTextureEncodingFromMap(material.map,renderer.gammaInput),envMap:!!material.envMap,envMapMode:material.envMap&&material.envMap.mapping,envMapEncoding:getTextureEncodingFromMap(material.envMap,renderer.gammaInput),envMapCubeUV:!!material.envMap&&(material.envMap.mapping===CubeUVReflectionMapping||material.envMap.mapping===CubeUVRefractionMapping),lightMap:!!material.lightMap,aoMap:!!material.aoMap,emissiveMap:!!material.emissiveMap,emissiveMapEncoding:getTextureEncodingFromMap(material.emissiveMap,renderer.gammaInput),bumpMap:!!material.bumpMap,normalMap:!!material.normalMap,displacementMap:!!material.displacementMap,roughnessMap:!!material.roughnessMap,metalnessMap:!!material.metalnessMap,specularMap:!!material.specularMap,alphaMap:!!material.alphaMap,gradientMap:!!material.gradientMap,combine:material.combine,vertexColors:material.vertexColors,fog:!!fog,useFog:material.fog,fogExp:fog&&fog.isFogExp2,flatShading:material.flatShading,sizeAttenuation:material.sizeAttenuation,logarithmicDepthBuffer:capabilities.logarithmicDepthBuffer,skinning:material.skinning&&0<maxBones,maxBones:maxBones,useVertexTexture:capabilities.floatVertexTextures,morphTargets:material.morphTargets,morphNormals:material.morphNormals,maxMorphTargets:renderer.maxMorphTargets,maxMorphNormals:renderer.maxMorphNormals,numDirLights:lights.directional.length,numPointLights:lights.point.length,numSpotLights:lights.spot.length,numRectAreaLights:lights.rectArea.length,numHemiLights:lights.hemi.length,numClippingPlanes:nClipPlanes,numClipIntersection:nClipIntersection,dithering:material.dithering,shadowMapEnabled:renderer.shadowMap.enabled&&object.receiveShadow&&0<shadows.length,shadowMapType:renderer.shadowMap.type,toneMapping:renderer.toneMapping,physicallyCorrectLights:renderer.physicallyCorrectLights,premultipliedAlpha:material.premultipliedAlpha,alphaTest:material.alphaTest,doubleSided:material.side===DoubleSide,flipSided:material.side===BackSide,depthPacking:material.depthPacking!==void 0?material.depthPacking:!1};return parameters};this.getProgramCode=function(material,parameters){var array=[];if(parameters.shaderID){array.push(parameters.shaderID)}else{array.push(material.fragmentShader);array.push(material.vertexShader)}if(material.defines!==void 0){for(var name in material.defines){array.push(name);array.push(material.defines[name])}}for(var i=0;i<parameterNames.length;i++){array.push(parameters[parameterNames[i]])}array.push(material.onBeforeCompile.toString());array.push(renderer.gammaOutput);return array.join()};this.acquireProgram=function(material,shader,parameters,code){for(var program,p=0,pl=programs.length,programInfo;p<pl;p++){programInfo=programs[p];if(programInfo.code===code){program=programInfo;++program.usedTimes;break}}if(program===void 0){program=new WebGLProgram(renderer,extensions,code,material,shader,parameters);programs.push(program)}return program};this.releaseProgram=function(program){if(0===--program.usedTimes){var i=programs.indexOf(program);programs[i]=programs[programs.length-1];programs.pop();program.destroy()}};this.programs=programs}function WebGLTextures(_gl,extensions,state,properties,capabilities,utils,infoMemory,infoRender){var _isWebGL2="undefined"!==typeof WebGL2RenderingContext&&babelHelpers.instanceof(_gl,WebGL2RenderingContext),_videoTextures={},_canvas;function clampToMaxSize(image,maxSize){if(image.width>maxSize||image.height>maxSize){var scale=maxSize/_Mathmax(image.width,image.height),canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");canvas.width=_Mathfloor(image.width*scale);canvas.height=_Mathfloor(image.height*scale);var context=canvas.getContext("2d");context.drawImage(image,0,0,image.width,image.height,0,0,canvas.width,canvas.height);console.warn("THREE.WebGLRenderer: image is too big ("+image.width+"x"+image.height+"). Resized to "+canvas.width+"x"+canvas.height,image);return canvas}return image}function isPowerOfTwo(image){return _Math.isPowerOfTwo(image.width)&&_Math.isPowerOfTwo(image.height)}function makePowerOfTwo(image){if(babelHelpers.instanceof(image,HTMLImageElement)||babelHelpers.instanceof(image,HTMLCanvasElement)||babelHelpers.instanceof(image,ImageBitmap)){if(_canvas===void 0)_canvas=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");_canvas.width=_Math.floorPowerOfTwo(image.width);_canvas.height=_Math.floorPowerOfTwo(image.height);var context=_canvas.getContext("2d");context.drawImage(image,0,0,_canvas.width,_canvas.height);console.warn("THREE.WebGLRenderer: image is not power of two ("+image.width+"x"+image.height+"). Resized to "+_canvas.width+"x"+_canvas.height,image);return _canvas}return image}function textureNeedsPowerOfTwo(texture){return texture.wrapS!==ClampToEdgeWrapping||texture.wrapT!==ClampToEdgeWrapping||texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter}function textureNeedsGenerateMipmaps(texture,isPowerOfTwo){return texture.generateMipmaps&&isPowerOfTwo&&texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter}function filterFallback(f){if(f===NearestFilter||f===NearestMipMapNearestFilter||f===NearestMipMapLinearFilter){return _gl.NEAREST}return _gl.LINEAR}function onTextureDispose(event){var texture=event.target;texture.removeEventListener("dispose",onTextureDispose);deallocateTexture(texture);if(texture.isVideoTexture){delete _videoTextures[texture.id]}infoMemory.textures--}function onRenderTargetDispose(event){var renderTarget=event.target;renderTarget.removeEventListener("dispose",onRenderTargetDispose);deallocateRenderTarget(renderTarget);infoMemory.textures--}function deallocateTexture(texture){var textureProperties=properties.get(texture);if(texture.image&&textureProperties.__image__webglTextureCube){_gl.deleteTexture(textureProperties.__image__webglTextureCube)}else{if(textureProperties.__webglInit===void 0)return;_gl.deleteTexture(textureProperties.__webglTexture)}properties.remove(texture)}function deallocateRenderTarget(renderTarget){var renderTargetProperties=properties.get(renderTarget),textureProperties=properties.get(renderTarget.texture);if(!renderTarget)return;if(textureProperties.__webglTexture!==void 0){_gl.deleteTexture(textureProperties.__webglTexture)}if(renderTarget.depthTexture){renderTarget.depthTexture.dispose()}if(renderTarget.isWebGLRenderTargetCube){for(var i=0;6>i;i++){_gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer[i]);if(renderTargetProperties.__webglDepthbuffer)_gl.deleteRenderbuffer(renderTargetProperties.__webglDepthbuffer[i])}}else{_gl.deleteFramebuffer(renderTargetProperties.__webglFramebuffer);if(renderTargetProperties.__webglDepthbuffer)_gl.deleteRenderbuffer(renderTargetProperties.__webglDepthbuffer)}properties.remove(renderTarget.texture);properties.remove(renderTarget)}function setTexture2D(texture,slot){var textureProperties=properties.get(texture);if(texture.isVideoTexture)updateVideoTexture(texture);if(0<texture.version&&textureProperties.__version!==texture.version){var image=texture.image;if(image===void 0){console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined",texture)}else if(!1===image.complete){console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete",texture)}else{uploadTexture(textureProperties,texture,slot);return}}state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_2D,textureProperties.__webglTexture)}function setTextureParameters(textureType,texture,isPowerOfTwoImage){var extension;if(isPowerOfTwoImage){_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,utils.convert(texture.wrapS));_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,utils.convert(texture.wrapT));_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,utils.convert(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,utils.convert(texture.minFilter))}else{_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_S,_gl.CLAMP_TO_EDGE);_gl.texParameteri(textureType,_gl.TEXTURE_WRAP_T,_gl.CLAMP_TO_EDGE);if(texture.wrapS!==ClampToEdgeWrapping||texture.wrapT!==ClampToEdgeWrapping){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping.",texture)}_gl.texParameteri(textureType,_gl.TEXTURE_MAG_FILTER,filterFallback(texture.magFilter));_gl.texParameteri(textureType,_gl.TEXTURE_MIN_FILTER,filterFallback(texture.minFilter));if(texture.minFilter!==NearestFilter&&texture.minFilter!==LinearFilter){console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.",texture)}}extension=extensions.get("EXT_texture_filter_anisotropic");if(extension){if(texture.type===FloatType&&null===extensions.get("OES_texture_float_linear"))return;if(texture.type===HalfFloatType&&null===extensions.get("OES_texture_half_float_linear"))return;if(1<texture.anisotropy||properties.get(texture).__currentAnisotropy){_gl.texParameterf(textureType,extension.TEXTURE_MAX_ANISOTROPY_EXT,_Mathmin(texture.anisotropy,capabilities.getMaxAnisotropy()));properties.get(texture).__currentAnisotropy=texture.anisotropy}}}function uploadTexture(textureProperties,texture,slot){if(textureProperties.__webglInit===void 0){textureProperties.__webglInit=!0;texture.addEventListener("dispose",onTextureDispose);textureProperties.__webglTexture=_gl.createTexture();infoMemory.textures++}state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_2D,textureProperties.__webglTexture);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);_gl.pixelStorei(_gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,texture.premultiplyAlpha);_gl.pixelStorei(_gl.UNPACK_ALIGNMENT,texture.unpackAlignment);var image=clampToMaxSize(texture.image,capabilities.maxTextureSize);if(textureNeedsPowerOfTwo(texture)&&!1===isPowerOfTwo(image)){image=makePowerOfTwo(image)}var isPowerOfTwoImage=isPowerOfTwo(image),glFormat=utils.convert(texture.format),glType=utils.convert(texture.type);setTextureParameters(_gl.TEXTURE_2D,texture,isPowerOfTwoImage);var mipmap,mipmaps=texture.mipmaps;if(texture.isDepthTexture){var internalFormat=_gl.DEPTH_COMPONENT;if(texture.type===FloatType){if(!_isWebGL2)throw new Error("Float Depth Texture only supported in WebGL2.0");internalFormat=_gl.DEPTH_COMPONENT32F}else if(_isWebGL2){internalFormat=_gl.DEPTH_COMPONENT16}if(texture.format===DepthFormat&&internalFormat===_gl.DEPTH_COMPONENT){if(texture.type!==UnsignedShortType&&texture.type!==UnsignedIntType){console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture.");texture.type=UnsignedShortType;glType=utils.convert(texture.type)}}if(texture.format===DepthStencilFormat){internalFormat=_gl.DEPTH_STENCIL;if(texture.type!==UnsignedInt248Type){console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture.");texture.type=UnsignedInt248Type;glType=utils.convert(texture.type)}}state.texImage2D(_gl.TEXTURE_2D,0,internalFormat,image.width,image.height,0,glFormat,glType,null)}else if(texture.isDataTexture){if(0<mipmaps.length&&isPowerOfTwoImage){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];state.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}texture.generateMipmaps=!1}else{state.texImage2D(_gl.TEXTURE_2D,0,glFormat,image.width,image.height,0,glFormat,glType,image.data)}}else if(texture.isCompressedTexture){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];if(texture.format!==RGBAFormat&&texture.format!==RGBFormat){if(-1<state.getCompressedTextureFormats().indexOf(glFormat)){state.compressedTexImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,mipmap.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()")}}else{state.texImage2D(_gl.TEXTURE_2D,i,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}}}else{if(0<mipmaps.length&&isPowerOfTwoImage){for(var i=0,il=mipmaps.length;i<il;i++){mipmap=mipmaps[i];state.texImage2D(_gl.TEXTURE_2D,i,glFormat,glFormat,glType,mipmap)}texture.generateMipmaps=!1}else{state.texImage2D(_gl.TEXTURE_2D,0,glFormat,glFormat,glType,image)}}if(textureNeedsGenerateMipmaps(texture,isPowerOfTwoImage))_gl.generateMipmap(_gl.TEXTURE_2D);textureProperties.__version=texture.version;if(texture.onUpdate)texture.onUpdate(texture)}function setupFrameBufferTexture(framebuffer,renderTarget,attachment,textureTarget){var glFormat=utils.convert(renderTarget.texture.format),glType=utils.convert(renderTarget.texture.type);state.texImage2D(textureTarget,0,glFormat,renderTarget.width,renderTarget.height,0,glFormat,glType,null);_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,attachment,textureTarget,properties.get(renderTarget.texture).__webglTexture,0);_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)}function setupRenderBufferStorage(renderbuffer,renderTarget){_gl.bindRenderbuffer(_gl.RENDERBUFFER,renderbuffer);if(renderTarget.depthBuffer&&!renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_COMPONENT16,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)}else if(renderTarget.depthBuffer&&renderTarget.stencilBuffer){_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.DEPTH_STENCIL,renderTarget.width,renderTarget.height);_gl.framebufferRenderbuffer(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.RENDERBUFFER,renderbuffer)}else{_gl.renderbufferStorage(_gl.RENDERBUFFER,_gl.RGBA4,renderTarget.width,renderTarget.height)}_gl.bindRenderbuffer(_gl.RENDERBUFFER,null)}function setupDepthTexture(framebuffer,renderTarget){var isCube=renderTarget&&renderTarget.isWebGLRenderTargetCube;if(isCube)throw new Error("Depth Texture with cube render targets is not supported");_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);if(!(renderTarget.depthTexture&&renderTarget.depthTexture.isDepthTexture)){throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture")}if(!properties.get(renderTarget.depthTexture).__webglTexture||renderTarget.depthTexture.image.width!==renderTarget.width||renderTarget.depthTexture.image.height!==renderTarget.height){renderTarget.depthTexture.image.width=renderTarget.width;renderTarget.depthTexture.image.height=renderTarget.height;renderTarget.depthTexture.needsUpdate=!0}setTexture2D(renderTarget.depthTexture,0);var webglDepthTexture=properties.get(renderTarget.depthTexture).__webglTexture;if(renderTarget.depthTexture.format===DepthFormat){_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.DEPTH_ATTACHMENT,_gl.TEXTURE_2D,webglDepthTexture,0)}else if(renderTarget.depthTexture.format===DepthStencilFormat){_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.DEPTH_STENCIL_ATTACHMENT,_gl.TEXTURE_2D,webglDepthTexture,0)}else{throw new Error("Unknown depthTexture format")}}function setupDepthRenderbuffer(renderTarget){var renderTargetProperties=properties.get(renderTarget),isCube=!0===renderTarget.isWebGLRenderTargetCube;if(renderTarget.depthTexture){if(isCube)throw new Error("target.depthTexture not supported in Cube render targets");setupDepthTexture(renderTargetProperties.__webglFramebuffer,renderTarget)}else{if(isCube){renderTargetProperties.__webglDepthbuffer=[];for(var i=0;6>i;i++){_gl.bindFramebuffer(_gl.FRAMEBUFFER,renderTargetProperties.__webglFramebuffer[i]);renderTargetProperties.__webglDepthbuffer[i]=_gl.createRenderbuffer();setupRenderBufferStorage(renderTargetProperties.__webglDepthbuffer[i],renderTarget)}}else{_gl.bindFramebuffer(_gl.FRAMEBUFFER,renderTargetProperties.__webglFramebuffer);renderTargetProperties.__webglDepthbuffer=_gl.createRenderbuffer();setupRenderBufferStorage(renderTargetProperties.__webglDepthbuffer,renderTarget)}}_gl.bindFramebuffer(_gl.FRAMEBUFFER,null)}function updateVideoTexture(texture){var id=texture.id,frame=infoRender.frame;if(_videoTextures[id]!==frame){_videoTextures[id]=frame;texture.update()}}this.setTexture2D=setTexture2D;this.setTextureCube=function(texture,slot){var textureProperties=properties.get(texture);if(6===texture.image.length){if(0<texture.version&&textureProperties.__version!==texture.version){if(!textureProperties.__image__webglTextureCube){texture.addEventListener("dispose",onTextureDispose);textureProperties.__image__webglTextureCube=_gl.createTexture();infoMemory.textures++}state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_CUBE_MAP,textureProperties.__image__webglTextureCube);_gl.pixelStorei(_gl.UNPACK_FLIP_Y_WEBGL,texture.flipY);for(var isCompressed=texture&&texture.isCompressedTexture,isDataTexture=texture.image[0]&&texture.image[0].isDataTexture,cubeImage=[],i=0;6>i;i++){if(!isCompressed&&!isDataTexture){cubeImage[i]=clampToMaxSize(texture.image[i],capabilities.maxCubemapSize)}else{cubeImage[i]=isDataTexture?texture.image[i].image:texture.image[i]}}var image=cubeImage[0],isPowerOfTwoImage=isPowerOfTwo(image),glFormat=utils.convert(texture.format),glType=utils.convert(texture.type);setTextureParameters(_gl.TEXTURE_CUBE_MAP,texture,isPowerOfTwoImage);for(var i=0;6>i;i++){if(!isCompressed){if(isDataTexture){state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,cubeImage[i].width,cubeImage[i].height,0,glFormat,glType,cubeImage[i].data)}else{state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,0,glFormat,glFormat,glType,cubeImage[i])}}else{for(var mipmap,mipmaps=cubeImage[i].mipmaps,j=0,jl=mipmaps.length;j<jl;j++){mipmap=mipmaps[j];if(texture.format!==RGBAFormat&&texture.format!==RGBFormat){if(-1<state.getCompressedTextureFormats().indexOf(glFormat)){state.compressedTexImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,mipmap.data)}else{console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()")}}else{state.texImage2D(_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i,j,glFormat,mipmap.width,mipmap.height,0,glFormat,glType,mipmap.data)}}}}if(textureNeedsGenerateMipmaps(texture,isPowerOfTwoImage)){_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP)}textureProperties.__version=texture.version;if(texture.onUpdate)texture.onUpdate(texture)}else{state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_CUBE_MAP,textureProperties.__image__webglTextureCube)}}};this.setTextureCubeDynamic=function(texture,slot){state.activeTexture(_gl.TEXTURE0+slot);state.bindTexture(_gl.TEXTURE_CUBE_MAP,properties.get(texture).__webglTexture)};this.setupRenderTarget=function(renderTarget){var renderTargetProperties=properties.get(renderTarget),textureProperties=properties.get(renderTarget.texture);renderTarget.addEventListener("dispose",onRenderTargetDispose);textureProperties.__webglTexture=_gl.createTexture();infoMemory.textures++;var isCube=!0===renderTarget.isWebGLRenderTargetCube,isTargetPowerOfTwo=isPowerOfTwo(renderTarget);if(isCube){renderTargetProperties.__webglFramebuffer=[];for(var i=0;6>i;i++){renderTargetProperties.__webglFramebuffer[i]=_gl.createFramebuffer()}}else{renderTargetProperties.__webglFramebuffer=_gl.createFramebuffer()}if(isCube){state.bindTexture(_gl.TEXTURE_CUBE_MAP,textureProperties.__webglTexture);setTextureParameters(_gl.TEXTURE_CUBE_MAP,renderTarget.texture,isTargetPowerOfTwo);for(var i=0;6>i;i++){setupFrameBufferTexture(renderTargetProperties.__webglFramebuffer[i],renderTarget,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+i)}if(textureNeedsGenerateMipmaps(renderTarget.texture,isTargetPowerOfTwo))_gl.generateMipmap(_gl.TEXTURE_CUBE_MAP);state.bindTexture(_gl.TEXTURE_CUBE_MAP,null)}else{state.bindTexture(_gl.TEXTURE_2D,textureProperties.__webglTexture);setTextureParameters(_gl.TEXTURE_2D,renderTarget.texture,isTargetPowerOfTwo);setupFrameBufferTexture(renderTargetProperties.__webglFramebuffer,renderTarget,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_2D);if(textureNeedsGenerateMipmaps(renderTarget.texture,isTargetPowerOfTwo))_gl.generateMipmap(_gl.TEXTURE_2D);state.bindTexture(_gl.TEXTURE_2D,null)}if(renderTarget.depthBuffer){setupDepthRenderbuffer(renderTarget)}};this.updateRenderTargetMipmap=function(renderTarget){var texture=renderTarget.texture,isTargetPowerOfTwo=isPowerOfTwo(renderTarget);if(textureNeedsGenerateMipmaps(texture,isTargetPowerOfTwo)){var target=renderTarget.isWebGLRenderTargetCube?_gl.TEXTURE_CUBE_MAP:_gl.TEXTURE_2D,webglTexture=properties.get(texture).__webglTexture;state.bindTexture(target,webglTexture);_gl.generateMipmap(target);state.bindTexture(target,null)}}}function WebGLProperties(){var properties={};function get(object){var uuid=object.uuid,map=properties[uuid];if(map===void 0){map={};properties[uuid]=map}return map}function remove(object){delete properties[object.uuid]}function update(object,key,value){var uuid=object.uuid,map=properties[uuid];map[key]=value}return{get:get,remove:remove,update:update,dispose:function(){properties={}}}}function WebGLState(gl,extensions,utils){var colorBuffer=new function(){var locked=!1,color=new Vector4,currentColorMask=null,currentColorClear=new Vector4(0,0,0,0);return{setMask:function setMask(colorMask){if(currentColorMask!==colorMask&&!locked){gl.colorMask(colorMask,colorMask,colorMask,colorMask);currentColorMask=colorMask}},setLocked:function setLocked(lock){locked=lock},setClear:function setClear(r,g,b,a,premultipliedAlpha){if(!0===premultipliedAlpha){r*=a;g*=a;b*=a}color.set(r,g,b,a);if(!1===currentColorClear.equals(color)){gl.clearColor(r,g,b,a);currentColorClear.copy(color)}},reset:function reset(){locked=!1;currentColorMask=null;currentColorClear.set(-1,0,0,0)}}},depthBuffer=new function(){var locked=!1,currentDepthMask=null,currentDepthFunc=null,currentDepthClear=null;return{setTest:function setTest(depthTest){if(depthTest){enable(gl.DEPTH_TEST)}else{disable(gl.DEPTH_TEST)}},setMask:function setMask(depthMask){if(currentDepthMask!==depthMask&&!locked){gl.depthMask(depthMask);currentDepthMask=depthMask}},setFunc:function setFunc(depthFunc){if(currentDepthFunc!==depthFunc){if(depthFunc){switch(depthFunc){case NeverDepth:gl.depthFunc(gl.NEVER);break;case AlwaysDepth:gl.depthFunc(gl.ALWAYS);break;case LessDepth:gl.depthFunc(gl.LESS);break;case LessEqualDepth:gl.depthFunc(gl.LEQUAL);break;case EqualDepth:gl.depthFunc(gl.EQUAL);break;case GreaterEqualDepth:gl.depthFunc(gl.GEQUAL);break;case GreaterDepth:gl.depthFunc(gl.GREATER);break;case NotEqualDepth:gl.depthFunc(gl.NOTEQUAL);break;default:gl.depthFunc(gl.LEQUAL);}}else{gl.depthFunc(gl.LEQUAL)}currentDepthFunc=depthFunc}},setLocked:function setLocked(lock){locked=lock},setClear:function setClear(depth){if(currentDepthClear!==depth){gl.clearDepth(depth);currentDepthClear=depth}},reset:function reset(){locked=!1;currentDepthMask=null;currentDepthFunc=null;currentDepthClear=null}}},stencilBuffer=new function(){var locked=!1,currentStencilMask=null,currentStencilFunc=null,currentStencilRef=null,currentStencilFuncMask=null,currentStencilFail=null,currentStencilZFail=null,currentStencilZPass=null,currentStencilClear=null;return{setTest:function setTest(stencilTest){if(stencilTest){enable(gl.STENCIL_TEST)}else{disable(gl.STENCIL_TEST)}},setMask:function setMask(stencilMask){if(currentStencilMask!==stencilMask&&!locked){gl.stencilMask(stencilMask);currentStencilMask=stencilMask}},setFunc:function setFunc(stencilFunc,stencilRef,stencilMask){if(currentStencilFunc!==stencilFunc||currentStencilRef!==stencilRef||currentStencilFuncMask!==stencilMask){gl.stencilFunc(stencilFunc,stencilRef,stencilMask);currentStencilFunc=stencilFunc;currentStencilRef=stencilRef;currentStencilFuncMask=stencilMask}},setOp:function setOp(stencilFail,stencilZFail,stencilZPass){if(currentStencilFail!==stencilFail||currentStencilZFail!==stencilZFail||currentStencilZPass!==stencilZPass){gl.stencilOp(stencilFail,stencilZFail,stencilZPass);currentStencilFail=stencilFail;currentStencilZFail=stencilZFail;currentStencilZPass=stencilZPass}},setLocked:function setLocked(lock){locked=lock},setClear:function setClear(stencil){if(currentStencilClear!==stencil){gl.clearStencil(stencil);currentStencilClear=stencil}},reset:function reset(){locked=!1;currentStencilMask=null;currentStencilFunc=null;currentStencilRef=null;currentStencilFuncMask=null;currentStencilFail=null;currentStencilZFail=null;currentStencilZPass=null;currentStencilClear=null}}},maxVertexAttributes=gl.getParameter(gl.MAX_VERTEX_ATTRIBS),newAttributes=new Uint8Array(maxVertexAttributes),enabledAttributes=new Uint8Array(maxVertexAttributes),attributeDivisors=new Uint8Array(maxVertexAttributes),capabilities={},compressedTextureFormats=null,currentProgram=null,currentBlending=null,currentBlendEquation=null,currentBlendSrc=null,currentBlendDst=null,currentBlendEquationAlpha=null,currentBlendSrcAlpha=null,currentBlendDstAlpha=null,currentPremultipledAlpha=!1,currentFlipSided=null,currentCullFace=null,currentLineWidth=null,currentPolygonOffsetFactor=null,currentPolygonOffsetUnits=null,maxTextures=gl.getParameter(gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS),lineWidthAvailable=!1,version=0,glVersion=gl.getParameter(gl.VERSION);if(-1!==glVersion.indexOf("WebGL")){version=parseFloat(/^WebGL\ ([0-9])/.exec(glVersion)[1]);lineWidthAvailable=1<=version}else if(-1!==glVersion.indexOf("OpenGL ES")){version=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(glVersion)[1]);lineWidthAvailable=2<=version}var currentTextureSlot=null,currentBoundTextures={},currentScissor=new Vector4,currentViewport=new Vector4;function createTexture(type,target,count){var data=new Uint8Array(4),texture=gl.createTexture();gl.bindTexture(type,texture);gl.texParameteri(type,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(type,gl.TEXTURE_MAG_FILTER,gl.NEAREST);for(var i=0;i<count;i++){gl.texImage2D(target+i,0,gl.RGBA,1,1,0,gl.RGBA,gl.UNSIGNED_BYTE,data)}return texture}var emptyTextures={};emptyTextures[gl.TEXTURE_2D]=createTexture(gl.TEXTURE_2D,gl.TEXTURE_2D,1);emptyTextures[gl.TEXTURE_CUBE_MAP]=createTexture(gl.TEXTURE_CUBE_MAP,gl.TEXTURE_CUBE_MAP_POSITIVE_X,6);colorBuffer.setClear(0,0,0,1);depthBuffer.setClear(1);stencilBuffer.setClear(0);enable(gl.DEPTH_TEST);depthBuffer.setFunc(LessEqualDepth);setFlipSided(!1);setCullFace(CullFaceBack);enable(gl.CULL_FACE);enable(gl.BLEND);setBlending(NormalBlending);function enable(id){if(!0!==capabilities[id]){gl.enable(id);capabilities[id]=!0}}function disable(id){if(!1!==capabilities[id]){gl.disable(id);capabilities[id]=!1}}function getCompressedTextureFormats(){if(null===compressedTextureFormats){compressedTextureFormats=[];if(extensions.get("WEBGL_compressed_texture_pvrtc")||extensions.get("WEBGL_compressed_texture_s3tc")||extensions.get("WEBGL_compressed_texture_etc1")||extensions.get("WEBGL_compressed_texture_astc")){for(var formats=gl.getParameter(gl.COMPRESSED_TEXTURE_FORMATS),i=0;i<formats.length;i++){compressedTextureFormats.push(formats[i])}}}return compressedTextureFormats}function useProgram(program){if(currentProgram!==program){gl.useProgram(program);currentProgram=program;return!0}return!1}function setBlending(blending,blendEquation,blendSrc,blendDst,blendEquationAlpha,blendSrcAlpha,blendDstAlpha,premultipliedAlpha){if(blending!==NoBlending){enable(gl.BLEND)}else{disable(gl.BLEND)}if(blending!==CustomBlending){if(blending!==currentBlending||premultipliedAlpha!==currentPremultipledAlpha){switch(blending){case AdditiveBlending:if(premultipliedAlpha){gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.ONE,gl.ONE,gl.ONE,gl.ONE)}else{gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.SRC_ALPHA,gl.ONE)}break;case SubtractiveBlending:if(premultipliedAlpha){gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.ZERO,gl.ZERO,gl.ONE_MINUS_SRC_COLOR,gl.ONE_MINUS_SRC_ALPHA)}else{gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ZERO,gl.ONE_MINUS_SRC_COLOR)}break;case MultiplyBlending:if(premultipliedAlpha){gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.ZERO,gl.SRC_COLOR,gl.ZERO,gl.SRC_ALPHA)}else{gl.blendEquation(gl.FUNC_ADD);gl.blendFunc(gl.ZERO,gl.SRC_COLOR)}break;default:if(premultipliedAlpha){gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.ONE,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA)}else{gl.blendEquationSeparate(gl.FUNC_ADD,gl.FUNC_ADD);gl.blendFuncSeparate(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA,gl.ONE,gl.ONE_MINUS_SRC_ALPHA)}}}currentBlendEquation=null;currentBlendSrc=null;currentBlendDst=null;currentBlendEquationAlpha=null;currentBlendSrcAlpha=null;currentBlendDstAlpha=null}else{blendEquationAlpha=blendEquationAlpha||blendEquation;blendSrcAlpha=blendSrcAlpha||blendSrc;blendDstAlpha=blendDstAlpha||blendDst;if(blendEquation!==currentBlendEquation||blendEquationAlpha!==currentBlendEquationAlpha){gl.blendEquationSeparate(utils.convert(blendEquation),utils.convert(blendEquationAlpha));currentBlendEquation=blendEquation;currentBlendEquationAlpha=blendEquationAlpha}if(blendSrc!==currentBlendSrc||blendDst!==currentBlendDst||blendSrcAlpha!==currentBlendSrcAlpha||blendDstAlpha!==currentBlendDstAlpha){gl.blendFuncSeparate(utils.convert(blendSrc),utils.convert(blendDst),utils.convert(blendSrcAlpha),utils.convert(blendDstAlpha));currentBlendSrc=blendSrc;currentBlendDst=blendDst;currentBlendSrcAlpha=blendSrcAlpha;currentBlendDstAlpha=blendDstAlpha}}currentBlending=blending;currentPremultipledAlpha=premultipliedAlpha}function setFlipSided(flipSided){if(currentFlipSided!==flipSided){if(flipSided){gl.frontFace(gl.CW)}else{gl.frontFace(gl.CCW)}currentFlipSided=flipSided}}function setCullFace(cullFace){if(cullFace!==CullFaceNone){enable(gl.CULL_FACE);if(cullFace!==currentCullFace){if(cullFace===CullFaceBack){gl.cullFace(gl.BACK)}else if(cullFace===CullFaceFront){gl.cullFace(gl.FRONT)}else{gl.cullFace(gl.FRONT_AND_BACK)}}}else{disable(gl.CULL_FACE)}currentCullFace=cullFace}function setLineWidth(width){if(width!==currentLineWidth){if(lineWidthAvailable)gl.lineWidth(width);currentLineWidth=width}}function setPolygonOffset(polygonOffset,factor,units){if(polygonOffset){enable(gl.POLYGON_OFFSET_FILL);if(currentPolygonOffsetFactor!==factor||currentPolygonOffsetUnits!==units){gl.polygonOffset(factor,units);currentPolygonOffsetFactor=factor;currentPolygonOffsetUnits=units}}else{disable(gl.POLYGON_OFFSET_FILL)}}function activeTexture(webglSlot){if(webglSlot===void 0)webglSlot=gl.TEXTURE0+maxTextures-1;if(currentTextureSlot!==webglSlot){gl.activeTexture(webglSlot);currentTextureSlot=webglSlot}}function bindTexture(webglType,webglTexture){if(null===currentTextureSlot){activeTexture()}var boundTexture=currentBoundTextures[currentTextureSlot];if(boundTexture===void 0){boundTexture={type:void 0,texture:void 0};currentBoundTextures[currentTextureSlot]=boundTexture}if(boundTexture.type!==webglType||boundTexture.texture!==webglTexture){gl.bindTexture(webglType,webglTexture||emptyTextures[webglType]);boundTexture.type=webglType;boundTexture.texture=webglTexture}}function scissor(scissor){if(!1===currentScissor.equals(scissor)){gl.scissor(scissor.x,scissor.y,scissor.z,scissor.w);currentScissor.copy(scissor)}}function viewport(viewport){if(!1===currentViewport.equals(viewport)){gl.viewport(viewport.x,viewport.y,viewport.z,viewport.w);currentViewport.copy(viewport)}}return{buffers:{color:colorBuffer,depth:depthBuffer,stencil:stencilBuffer},initAttributes:function(){for(var i=0,l=newAttributes.length;i<l;i++){newAttributes[i]=0}},enableAttribute:function(attribute){newAttributes[attribute]=1;if(0===enabledAttributes[attribute]){gl.enableVertexAttribArray(attribute);enabledAttributes[attribute]=1}if(0!==attributeDivisors[attribute]){var extension=extensions.get("ANGLE_instanced_arrays");extension.vertexAttribDivisorANGLE(attribute,0);attributeDivisors[attribute]=0}},enableAttributeAndDivisor:function(attribute,meshPerAttribute){newAttributes[attribute]=1;if(0===enabledAttributes[attribute]){gl.enableVertexAttribArray(attribute);enabledAttributes[attribute]=1}if(attributeDivisors[attribute]!==meshPerAttribute){var extension=extensions.get("ANGLE_instanced_arrays");extension.vertexAttribDivisorANGLE(attribute,meshPerAttribute);attributeDivisors[attribute]=meshPerAttribute}},disableUnusedAttributes:function(){for(var i=0,l=enabledAttributes.length;i!==l;++i){if(enabledAttributes[i]!==newAttributes[i]){gl.disableVertexAttribArray(i);enabledAttributes[i]=0}}},enable:enable,disable:disable,getCompressedTextureFormats:getCompressedTextureFormats,useProgram:useProgram,setBlending:setBlending,setMaterial:function(material,frontFaceCW){material.side===DoubleSide?disable(gl.CULL_FACE):enable(gl.CULL_FACE);var flipSided=material.side===BackSide;if(frontFaceCW)flipSided=!flipSided;setFlipSided(flipSided);!0===material.transparent?setBlending(material.blending,material.blendEquation,material.blendSrc,material.blendDst,material.blendEquationAlpha,material.blendSrcAlpha,material.blendDstAlpha,material.premultipliedAlpha):setBlending(NoBlending);depthBuffer.setFunc(material.depthFunc);depthBuffer.setTest(material.depthTest);depthBuffer.setMask(material.depthWrite);colorBuffer.setMask(material.colorWrite);setPolygonOffset(material.polygonOffset,material.polygonOffsetFactor,material.polygonOffsetUnits)},setFlipSided:setFlipSided,setCullFace:setCullFace,setLineWidth:setLineWidth,setPolygonOffset:setPolygonOffset,setScissorTest:function(scissorTest){if(scissorTest){enable(gl.SCISSOR_TEST)}else{disable(gl.SCISSOR_TEST)}},activeTexture:activeTexture,bindTexture:bindTexture,compressedTexImage2D:function(){try{gl.compressedTexImage2D.apply(gl,arguments)}catch(error){console.error("THREE.WebGLState:",error)}},texImage2D:function(){try{gl.texImage2D.apply(gl,arguments)}catch(error){console.error("THREE.WebGLState:",error)}},scissor:scissor,viewport:viewport,reset:function(){for(var i=0;i<enabledAttributes.length;i++){if(1===enabledAttributes[i]){gl.disableVertexAttribArray(i);enabledAttributes[i]=0}}capabilities={};compressedTextureFormats=null;currentTextureSlot=null;currentBoundTextures={};currentProgram=null;currentBlending=null;currentFlipSided=null;currentCullFace=null;colorBuffer.reset();depthBuffer.reset();stencilBuffer.reset()}}}function WebGLCapabilities(gl,extensions,parameters){var maxAnisotropy;function getMaxAnisotropy(){if(maxAnisotropy!==void 0)return maxAnisotropy;var extension=extensions.get("EXT_texture_filter_anisotropic");if(null!==extension){maxAnisotropy=gl.getParameter(extension.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else{maxAnisotropy=0}return maxAnisotropy}function getMaxPrecision(precision){if("highp"===precision){if(0<gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.HIGH_FLOAT).precision&&0<gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT).precision){return"highp"}precision="mediump"}if("mediump"===precision){if(0<gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.MEDIUM_FLOAT).precision&&0<gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.MEDIUM_FLOAT).precision){return"mediump"}}return"lowp"}var precision=parameters.precision!==void 0?parameters.precision:"highp",maxPrecision=getMaxPrecision(precision);if(maxPrecision!==precision){console.warn("THREE.WebGLRenderer:",precision,"not supported, using",maxPrecision,"instead.");precision=maxPrecision}var logarithmicDepthBuffer=!0===parameters.logarithmicDepthBuffer,maxTextures=gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS),maxVertexTextures=gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS),maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE),maxCubemapSize=gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE),maxAttributes=gl.getParameter(gl.MAX_VERTEX_ATTRIBS),maxVertexUniforms=gl.getParameter(gl.MAX_VERTEX_UNIFORM_VECTORS),maxVaryings=gl.getParameter(gl.MAX_VARYING_VECTORS),maxFragmentUniforms=gl.getParameter(gl.MAX_FRAGMENT_UNIFORM_VECTORS),vertexTextures=0<maxVertexTextures,floatFragmentTextures=!!extensions.get("OES_texture_float");return{getMaxAnisotropy:getMaxAnisotropy,getMaxPrecision:getMaxPrecision,precision:precision,logarithmicDepthBuffer:logarithmicDepthBuffer,maxTextures:maxTextures,maxVertexTextures:maxVertexTextures,maxTextureSize:maxTextureSize,maxCubemapSize:maxCubemapSize,maxAttributes:maxAttributes,maxVertexUniforms:maxVertexUniforms,maxVaryings:maxVaryings,maxFragmentUniforms:maxFragmentUniforms,vertexTextures:vertexTextures,floatFragmentTextures:floatFragmentTextures,floatVertexTextures:vertexTextures&&floatFragmentTextures}}function PerspectiveCamera(fov,aspect,near,far){Camera.call(this);this.type="PerspectiveCamera";this.fov=fov!==void 0?fov:50;this.zoom=1;this.near=near!==void 0?near:.1;this.far=far!==void 0?far:2e3;this.focus=10;this.aspect=aspect!==void 0?aspect:1;this.view=null;this.filmGauge=35;this.filmOffset=0;this.updateProjectionMatrix()}PerspectiveCamera.prototype=Object.assign(Object.create(Camera.prototype),{constructor:PerspectiveCamera,isPerspectiveCamera:!0,copy:function copy(source,recursive){Camera.prototype.copy.call(this,source,recursive);this.fov=source.fov;this.zoom=source.zoom;this.near=source.near;this.far=source.far;this.focus=source.focus;this.aspect=source.aspect;this.view=null===source.view?null:Object.assign({},source.view);this.filmGauge=source.filmGauge;this.filmOffset=source.filmOffset;return this},setFocalLength:function setFocalLength(focalLength){var vExtentSlope=.5*this.getFilmHeight()/focalLength;this.fov=2*_Math.RAD2DEG*_Mathatan2(vExtentSlope);this.updateProjectionMatrix()},getFocalLength:function getFocalLength(){var vExtentSlope=_Mathtan(.5*_Math.DEG2RAD*this.fov);return .5*this.getFilmHeight()/vExtentSlope},getEffectiveFOV:function getEffectiveFOV(){return 2*_Math.RAD2DEG*_Mathatan2(_Mathtan(.5*_Math.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function getFilmWidth(){return this.filmGauge*_Mathmin(this.aspect,1)},getFilmHeight:function getFilmHeight(){return this.filmGauge/_Mathmax(this.aspect,1)},setViewOffset:function setViewOffset(fullWidth,fullHeight,x,y,width,height){this.aspect=fullWidth/fullHeight;if(null===this.view){this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}}this.view.enabled=!0;this.view.fullWidth=fullWidth;this.view.fullHeight=fullHeight;this.view.offsetX=x;this.view.offsetY=y;this.view.width=width;this.view.height=height;this.updateProjectionMatrix()},clearViewOffset:function clearViewOffset(){if(null!==this.view){this.view.enabled=!1}this.updateProjectionMatrix()},updateProjectionMatrix:function updateProjectionMatrix(){var near=this.near,top=near*_Mathtan(.5*_Math.DEG2RAD*this.fov)/this.zoom,height=2*top,width=this.aspect*height,left=-.5*width,view=this.view;if(null!==this.view&&this.view.enabled){var fullWidth=view.fullWidth,fullHeight=view.fullHeight;left+=view.offsetX*width/fullWidth;top-=view.offsetY*height/fullHeight;width*=view.width/fullWidth;height*=view.height/fullHeight}var skew=this.filmOffset;if(0!==skew)left+=near*skew/this.getFilmWidth();this.projectionMatrix.makePerspective(left,left+width,top,top-height,near,this.far)},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);data.object.fov=this.fov;data.object.zoom=this.zoom;data.object.near=this.near;data.object.far=this.far;data.object.focus=this.focus;data.object.aspect=this.aspect;if(null!==this.view)data.object.view=Object.assign({},this.view);data.object.filmGauge=this.filmGauge;data.object.filmOffset=this.filmOffset;return data}});function ArrayCamera(array){PerspectiveCamera.call(this);this.cameras=array||[]}ArrayCamera.prototype=Object.assign(Object.create(PerspectiveCamera.prototype),{constructor:ArrayCamera,isArrayCamera:!0});function WebVRManager(renderer){var scope=this,device=null,frameData=null,poseTarget=null,standingMatrix=new Matrix4,standingMatrixInverse=new Matrix4;if("undefined"!==typeof window&&"VRFrameData"in window){frameData=new window.VRFrameData}var matrixWorldInverse=new Matrix4,tempQuaternion=new Quaternion,tempPosition=new Vector3,cameraL=new PerspectiveCamera;cameraL.bounds=new Vector4(0,0,.5,1);cameraL.layers.enable(1);var cameraR=new PerspectiveCamera;cameraR.bounds=new Vector4(.5,0,.5,1);cameraR.layers.enable(2);var cameraVR=new ArrayCamera([cameraL,cameraR]);cameraVR.layers.enable(1);cameraVR.layers.enable(2);var currentSize,currentPixelRatio;function onVRDisplayPresentChange(){if(null!==device&&device.isPresenting){var eyeParameters=device.getEyeParameters("left"),renderWidth=eyeParameters.renderWidth,renderHeight=eyeParameters.renderHeight;currentPixelRatio=renderer.getPixelRatio();currentSize=renderer.getSize();renderer.setDrawingBufferSize(2*renderWidth,renderHeight,1)}else if(scope.enabled){renderer.setDrawingBufferSize(currentSize.width,currentSize.height,currentPixelRatio)}}if("undefined"!==typeof window){window.addEventListener("vrdisplaypresentchange",onVRDisplayPresentChange,!1)}this.enabled=!1;this.userHeight=1.6;this.getDevice=function(){return device};this.setDevice=function(value){if(value!==void 0)device=value};this.setPoseTarget=function(object){if(object!==void 0)poseTarget=object};this.getCamera=function(camera){if(null===device)return camera;device.depthNear=camera.near;device.depthFar=camera.far;device.getFrameData(frameData);var stageParameters=device.stageParameters;if(stageParameters){standingMatrix.fromArray(stageParameters.sittingToStandingTransform)}else{standingMatrix.makeTranslation(0,scope.userHeight,0)}var pose=frameData.pose,poseObject=null!==poseTarget?poseTarget:camera;poseObject.matrix.copy(standingMatrix);poseObject.matrix.decompose(poseObject.position,poseObject.quaternion,poseObject.scale);if(null!==pose.orientation){tempQuaternion.fromArray(pose.orientation);poseObject.quaternion.multiply(tempQuaternion)}if(null!==pose.position){tempQuaternion.setFromRotationMatrix(standingMatrix);tempPosition.fromArray(pose.position);tempPosition.applyQuaternion(tempQuaternion);poseObject.position.add(tempPosition)}poseObject.updateMatrixWorld();if(!1===device.isPresenting)return camera;cameraL.near=camera.near;cameraR.near=camera.near;cameraL.far=camera.far;cameraR.far=camera.far;cameraVR.matrixWorld.copy(camera.matrixWorld);cameraVR.matrixWorldInverse.copy(camera.matrixWorldInverse);cameraL.matrixWorldInverse.fromArray(frameData.leftViewMatrix);cameraR.matrixWorldInverse.fromArray(frameData.rightViewMatrix);standingMatrixInverse.getInverse(standingMatrix);cameraL.matrixWorldInverse.multiply(standingMatrixInverse);cameraR.matrixWorldInverse.multiply(standingMatrixInverse);var parent=poseObject.parent;if(null!==parent){matrixWorldInverse.getInverse(parent.matrixWorld);cameraL.matrixWorldInverse.multiply(matrixWorldInverse);cameraR.matrixWorldInverse.multiply(matrixWorldInverse)}cameraL.matrixWorld.getInverse(cameraL.matrixWorldInverse);cameraR.matrixWorld.getInverse(cameraR.matrixWorldInverse);cameraL.projectionMatrix.fromArray(frameData.leftProjectionMatrix);cameraR.projectionMatrix.fromArray(frameData.rightProjectionMatrix);cameraVR.projectionMatrix.copy(cameraL.projectionMatrix);var layers=device.getLayers();if(layers.length){var layer=layers[0];if(null!==layer.leftBounds&&4===layer.leftBounds.length){cameraL.bounds.fromArray(layer.leftBounds)}if(null!==layer.rightBounds&&4===layer.rightBounds.length){cameraR.bounds.fromArray(layer.rightBounds)}}return cameraVR};this.getStandingMatrix=function(){return standingMatrix};this.submitFrame=function(){if(device&&device.isPresenting)device.submitFrame()};this.dispose=function(){if("undefined"!==typeof window){window.removeEventListener("vrdisplaypresentchange",onVRDisplayPresentChange)}}}function WebGLExtensions(gl){var extensions={};return{get:function get(name){if(extensions[name]!==void 0){return extensions[name]}var extension;switch(name){case"WEBGL_depth_texture":extension=gl.getExtension("WEBGL_depth_texture")||gl.getExtension("MOZ_WEBGL_depth_texture")||gl.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":extension=gl.getExtension("EXT_texture_filter_anisotropic")||gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":extension=gl.getExtension("WEBGL_compressed_texture_s3tc")||gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":extension=gl.getExtension("WEBGL_compressed_texture_pvrtc")||gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;case"WEBGL_compressed_texture_etc1":extension=gl.getExtension("WEBGL_compressed_texture_etc1");break;default:extension=gl.getExtension(name);}if(null===extension){console.warn("THREE.WebGLRenderer: "+name+" extension not supported.")}extensions[name]=extension;return extension}}}function WebGLClipping(){var scope=this,globalState=null,numGlobalPlanes=0,localClippingEnabled=!1,renderingShadows=!1,plane=new Plane,viewNormalMatrix=new Matrix3,uniform={value:null,needsUpdate:!1};this.uniform=uniform;this.numPlanes=0;this.numIntersection=0;this.init=function(planes,enableLocalClipping,camera){var enabled=0!==planes.length||enableLocalClipping||0!==numGlobalPlanes||localClippingEnabled;localClippingEnabled=enableLocalClipping;globalState=projectPlanes(planes,camera,0);numGlobalPlanes=planes.length;return enabled};this.beginShadows=function(){renderingShadows=!0;projectPlanes(null)};this.endShadows=function(){renderingShadows=!1;resetGlobalState()};this.setState=function(planes,clipIntersection,clipShadows,camera,cache,fromCache){if(!localClippingEnabled||null===planes||0===planes.length||renderingShadows&&!clipShadows){if(renderingShadows){projectPlanes(null)}else{resetGlobalState()}}else{var nGlobal=renderingShadows?0:numGlobalPlanes,lGlobal=4*nGlobal,dstArray=cache.clippingState||null;uniform.value=dstArray;dstArray=projectPlanes(planes,camera,lGlobal,fromCache);for(var i=0;i!==lGlobal;++i){dstArray[i]=globalState[i]}cache.clippingState=dstArray;this.numIntersection=clipIntersection?this.numPlanes:0;this.numPlanes+=nGlobal}};function resetGlobalState(){if(uniform.value!==globalState){uniform.value=globalState;uniform.needsUpdate=0<numGlobalPlanes}scope.numPlanes=numGlobalPlanes;scope.numIntersection=0}function projectPlanes(planes,camera,dstOffset,skipTransform){var nPlanes=null!==planes?planes.length:0,dstArray=null;if(0!==nPlanes){dstArray=uniform.value;if(!0!==skipTransform||null===dstArray){var flatSize=dstOffset+4*nPlanes,viewMatrix=camera.matrixWorldInverse;viewNormalMatrix.getNormalMatrix(viewMatrix);if(null===dstArray||dstArray.length<flatSize){dstArray=new Float32Array(flatSize)}for(var i=0,i4=dstOffset;i!==nPlanes;++i,i4+=4){plane.copy(planes[i]).applyMatrix4(viewMatrix,viewNormalMatrix);plane.normal.toArray(dstArray,i4);dstArray[i4+3]=plane.constant}}uniform.value=dstArray;uniform.needsUpdate=!0}scope.numPlanes=nPlanes;return dstArray}}function WebGLUtils(gl,extensions){return{convert:function(p){var extension;if(p===RepeatWrapping)return gl.REPEAT;if(p===ClampToEdgeWrapping)return gl.CLAMP_TO_EDGE;if(p===MirroredRepeatWrapping)return gl.MIRRORED_REPEAT;if(p===NearestFilter)return gl.NEAREST;if(p===NearestMipMapNearestFilter)return gl.NEAREST_MIPMAP_NEAREST;if(p===NearestMipMapLinearFilter)return gl.NEAREST_MIPMAP_LINEAR;if(p===LinearFilter)return gl.LINEAR;if(p===LinearMipMapNearestFilter)return gl.LINEAR_MIPMAP_NEAREST;if(p===LinearMipMapLinearFilter)return gl.LINEAR_MIPMAP_LINEAR;if(p===UnsignedByteType)return gl.UNSIGNED_BYTE;if(p===UnsignedShort4444Type)return gl.UNSIGNED_SHORT_4_4_4_4;if(p===UnsignedShort5551Type)return gl.UNSIGNED_SHORT_5_5_5_1;if(p===UnsignedShort565Type)return gl.UNSIGNED_SHORT_5_6_5;if(p===ByteType)return gl.BYTE;if(p===ShortType)return gl.SHORT;if(p===UnsignedShortType)return gl.UNSIGNED_SHORT;if(p===IntType)return gl.INT;if(p===UnsignedIntType)return gl.UNSIGNED_INT;if(p===FloatType)return gl.FLOAT;if(p===HalfFloatType){extension=extensions.get("OES_texture_half_float");if(null!==extension)return extension.HALF_FLOAT_OES}if(p===AlphaFormat)return gl.ALPHA;if(p===RGBFormat)return gl.RGB;if(p===RGBAFormat)return gl.RGBA;if(p===LuminanceFormat)return gl.LUMINANCE;if(p===LuminanceAlphaFormat)return gl.LUMINANCE_ALPHA;if(p===DepthFormat)return gl.DEPTH_COMPONENT;if(p===DepthStencilFormat)return gl.DEPTH_STENCIL;if(p===AddEquation)return gl.FUNC_ADD;if(p===SubtractEquation)return gl.FUNC_SUBTRACT;if(p===ReverseSubtractEquation)return gl.FUNC_REVERSE_SUBTRACT;if(p===ZeroFactor)return gl.ZERO;if(p===OneFactor)return gl.ONE;if(p===SrcColorFactor)return gl.SRC_COLOR;if(p===OneMinusSrcColorFactor)return gl.ONE_MINUS_SRC_COLOR;if(p===SrcAlphaFactor)return gl.SRC_ALPHA;if(p===OneMinusSrcAlphaFactor)return gl.ONE_MINUS_SRC_ALPHA;if(p===DstAlphaFactor)return gl.DST_ALPHA;if(p===OneMinusDstAlphaFactor)return gl.ONE_MINUS_DST_ALPHA;if(p===DstColorFactor)return gl.DST_COLOR;if(p===OneMinusDstColorFactor)return gl.ONE_MINUS_DST_COLOR;if(p===SrcAlphaSaturateFactor)return gl.SRC_ALPHA_SATURATE;if(p===RGB_S3TC_DXT1_Format||p===RGBA_S3TC_DXT1_Format||p===RGBA_S3TC_DXT3_Format||p===RGBA_S3TC_DXT5_Format){extension=extensions.get("WEBGL_compressed_texture_s3tc");if(null!==extension){if(p===RGB_S3TC_DXT1_Format)return extension.COMPRESSED_RGB_S3TC_DXT1_EXT;if(p===RGBA_S3TC_DXT1_Format)return extension.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(p===RGBA_S3TC_DXT3_Format)return extension.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(p===RGBA_S3TC_DXT5_Format)return extension.COMPRESSED_RGBA_S3TC_DXT5_EXT}}if(p===RGB_PVRTC_4BPPV1_Format||p===RGB_PVRTC_2BPPV1_Format||p===RGBA_PVRTC_4BPPV1_Format||p===RGBA_PVRTC_2BPPV1_Format){extension=extensions.get("WEBGL_compressed_texture_pvrtc");if(null!==extension){if(p===RGB_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(p===RGB_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(p===RGBA_PVRTC_4BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(p===RGBA_PVRTC_2BPPV1_Format)return extension.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}}if(p===RGB_ETC1_Format){extension=extensions.get("WEBGL_compressed_texture_etc1");if(null!==extension)return extension.COMPRESSED_RGB_ETC1_WEBGL}if(p===RGBA_ASTC_4x4_Format||p===RGBA_ASTC_5x4_Format||p===RGBA_ASTC_5x5_Format||p===RGBA_ASTC_6x5_Format||p===RGBA_ASTC_6x6_Format||p===RGBA_ASTC_8x5_Format||p===RGBA_ASTC_8x6_Format||p===RGBA_ASTC_8x8_Format||p===RGBA_ASTC_10x5_Format||p===RGBA_ASTC_10x6_Format||p===RGBA_ASTC_10x8_Format||p===RGBA_ASTC_10x10_Format||p===RGBA_ASTC_12x10_Format||p===RGBA_ASTC_12x12_Format){extension=extensions.get("WEBGL_compressed_texture_astc");if(null!==extension){return p}}if(p===MinEquation||p===MaxEquation){extension=extensions.get("EXT_blend_minmax");if(null!==extension){if(p===MinEquation)return extension.MIN_EXT;if(p===MaxEquation)return extension.MAX_EXT}}if(p===UnsignedInt248Type){extension=extensions.get("WEBGL_depth_texture");if(null!==extension)return extension.UNSIGNED_INT_24_8_WEBGL}return 0}}}function UniformsCache(){var lights={};return{get:function get(light){if(lights[light.id]!==void 0){return lights[light.id]}var uniforms;switch(light.type){case"DirectionalLight":uniforms={direction:new Vector3,color:new Color,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"SpotLight":uniforms={position:new Vector3,direction:new Vector3,color:new Color,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2};break;case"PointLight":uniforms={position:new Vector3,color:new Color,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Vector2,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":uniforms={direction:new Vector3,skyColor:new Color,groundColor:new Color};break;case"RectAreaLight":uniforms={color:new Color,position:new Vector3,halfWidth:new Vector3,halfHeight:new Vector3};break;}lights[light.id]=uniforms;return uniforms}}}var count=0;function WebGLLights(){var cache=new UniformsCache,state={id:count++,hash:"",ambient:[0,0,0],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},vector3=new Vector3,matrix4=new Matrix4,matrix42=new Matrix4;return{setup:function(lights,shadows,camera){for(var r=0,g=0,b=0,directionalLength=0,pointLength=0,spotLength=0,rectAreaLength=0,hemiLength=0,viewMatrix=camera.matrixWorldInverse,i=0,l=lights.length;i<l;i++){var light=lights[i],color=light.color,intensity=light.intensity,distance=light.distance,shadowMap=light.shadow&&light.shadow.map?light.shadow.map.texture:null;if(light.isAmbientLight){r+=color.r*intensity;g+=color.g*intensity;b+=color.b*intensity}else if(light.isDirectionalLight){var uniforms=cache.get(light);uniforms.color.copy(light.color).multiplyScalar(light.intensity);uniforms.direction.setFromMatrixPosition(light.matrixWorld);vector3.setFromMatrixPosition(light.target.matrixWorld);uniforms.direction.sub(vector3);uniforms.direction.transformDirection(viewMatrix);uniforms.shadow=light.castShadow;if(light.castShadow){var shadow=light.shadow;uniforms.shadowBias=shadow.bias;uniforms.shadowRadius=shadow.radius;uniforms.shadowMapSize=shadow.mapSize}state.directionalShadowMap[directionalLength]=shadowMap;state.directionalShadowMatrix[directionalLength]=light.shadow.matrix;state.directional[directionalLength]=uniforms;directionalLength++}else if(light.isSpotLight){var uniforms=cache.get(light);uniforms.position.setFromMatrixPosition(light.matrixWorld);uniforms.position.applyMatrix4(viewMatrix);uniforms.color.copy(color).multiplyScalar(intensity);uniforms.distance=distance;uniforms.direction.setFromMatrixPosition(light.matrixWorld);vector3.setFromMatrixPosition(light.target.matrixWorld);uniforms.direction.sub(vector3);uniforms.direction.transformDirection(viewMatrix);uniforms.coneCos=_Mathcos(light.angle);uniforms.penumbraCos=_Mathcos(light.angle*(1-light.penumbra));uniforms.decay=0===light.distance?0:light.decay;uniforms.shadow=light.castShadow;if(light.castShadow){var shadow=light.shadow;uniforms.shadowBias=shadow.bias;uniforms.shadowRadius=shadow.radius;uniforms.shadowMapSize=shadow.mapSize}state.spotShadowMap[spotLength]=shadowMap;state.spotShadowMatrix[spotLength]=light.shadow.matrix;state.spot[spotLength]=uniforms;spotLength++}else if(light.isRectAreaLight){var uniforms=cache.get(light);uniforms.color.copy(color).multiplyScalar(intensity);uniforms.position.setFromMatrixPosition(light.matrixWorld);uniforms.position.applyMatrix4(viewMatrix);matrix42.identity();matrix4.copy(light.matrixWorld);matrix4.premultiply(viewMatrix);matrix42.extractRotation(matrix4);uniforms.halfWidth.set(.5*light.width,0,0);uniforms.halfHeight.set(0,.5*light.height,0);uniforms.halfWidth.applyMatrix4(matrix42);uniforms.halfHeight.applyMatrix4(matrix42);state.rectArea[rectAreaLength]=uniforms;rectAreaLength++}else if(light.isPointLight){var uniforms=cache.get(light);uniforms.position.setFromMatrixPosition(light.matrixWorld);uniforms.position.applyMatrix4(viewMatrix);uniforms.color.copy(light.color).multiplyScalar(light.intensity);uniforms.distance=light.distance;uniforms.decay=0===light.distance?0:light.decay;uniforms.shadow=light.castShadow;if(light.castShadow){var shadow=light.shadow;uniforms.shadowBias=shadow.bias;uniforms.shadowRadius=shadow.radius;uniforms.shadowMapSize=shadow.mapSize;uniforms.shadowCameraNear=shadow.camera.near;uniforms.shadowCameraFar=shadow.camera.far}state.pointShadowMap[pointLength]=shadowMap;state.pointShadowMatrix[pointLength]=light.shadow.matrix;state.point[pointLength]=uniforms;pointLength++}else if(light.isHemisphereLight){var uniforms=cache.get(light);uniforms.direction.setFromMatrixPosition(light.matrixWorld);uniforms.direction.transformDirection(viewMatrix);uniforms.direction.normalize();uniforms.skyColor.copy(light.color).multiplyScalar(intensity);uniforms.groundColor.copy(light.groundColor).multiplyScalar(intensity);state.hemi[hemiLength]=uniforms;hemiLength++}}state.ambient[0]=r;state.ambient[1]=g;state.ambient[2]=b;state.directional.length=directionalLength;state.spot.length=spotLength;state.rectArea.length=rectAreaLength;state.point.length=pointLength;state.hemi.length=hemiLength;state.hash=state.id+","+directionalLength+","+pointLength+","+spotLength+","+rectAreaLength+","+hemiLength+","+shadows.length},state:state}}function WebGLRenderState(){var lights=new WebGLLights,lightsArray=[],shadowsArray=[],spritesArray=[];return{init:function(){lightsArray.length=0;shadowsArray.length=0;spritesArray.length=0},state:{lightsArray:lightsArray,shadowsArray:shadowsArray,spritesArray:spritesArray,lights:lights},setupLights:function(camera){lights.setup(lightsArray,shadowsArray,camera)},pushLight:function(light){lightsArray.push(light)},pushShadow:function(shadowLight){shadowsArray.push(shadowLight)},pushSprite:function(shadowLight){spritesArray.push(shadowLight)}}}function WebGLRenderStates(){var renderStates={};function get(scene,camera){var hash=scene.id+","+camera.id,renderState=renderStates[hash];if(renderState===void 0){renderState=new WebGLRenderState;renderStates[hash]=renderState}return renderState}return{get:get,dispose:function(){renderStates={}}}}function WebGLRenderer(parameters){console.log("THREE.WebGLRenderer",REVISION);parameters=parameters||{};var _canvas=parameters.canvas!==void 0?parameters.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),_context=parameters.context!==void 0?parameters.context:null,_alpha=parameters.alpha!==void 0?parameters.alpha:!1,_depth=parameters.depth!==void 0?parameters.depth:!0,_stencil=parameters.stencil!==void 0?parameters.stencil:!0,_antialias=parameters.antialias!==void 0?parameters.antialias:!1,_premultipliedAlpha=parameters.premultipliedAlpha!==void 0?parameters.premultipliedAlpha:!0,_preserveDrawingBuffer=parameters.preserveDrawingBuffer!==void 0?parameters.preserveDrawingBuffer:!1,_powerPreference=parameters.powerPreference!==void 0?parameters.powerPreference:"default",currentRenderList=null,currentRenderState=null;this.domElement=_canvas;this.context=null;this.autoClear=!0;this.autoClearColor=!0;this.autoClearDepth=!0;this.autoClearStencil=!0;this.sortObjects=!0;this.clippingPlanes=[];this.localClippingEnabled=!1;this.gammaFactor=2;this.gammaInput=!1;this.gammaOutput=!1;this.physicallyCorrectLights=!1;this.toneMapping=LinearToneMapping;this.toneMappingExposure=1;this.toneMappingWhitePoint=1;this.maxMorphTargets=8;this.maxMorphNormals=4;var _this=this,_isContextLost=!1,_currentRenderTarget=null,_currentFramebuffer=null,_currentMaterialId=-1,_currentGeometryProgram="",_currentCamera=null,_currentArrayCamera=null,_currentViewport=new Vector4,_currentScissor=new Vector4,_currentScissorTest=null,_usedTextureUnits=0,_width=_canvas.width,_height=_canvas.height,_pixelRatio=1,_viewport=new Vector4(0,0,_width,_height),_scissor=new Vector4(0,0,_width,_height),_scissorTest=!1,_frustum=new Frustum,_clipping=new WebGLClipping,_clippingEnabled=!1,_localClippingEnabled=!1,_projScreenMatrix=new Matrix4,_vector3=new Vector3,_infoMemory={geometries:0,textures:0},_infoRender={frame:0,calls:0,vertices:0,faces:0,points:0};this.info={render:_infoRender,memory:_infoMemory,programs:null,autoReset:!0,reset:function(){_infoRender.frame++;_infoRender.calls=0;_infoRender.vertices=0;_infoRender.faces=0;_infoRender.points=0}};function getTargetPixelRatio(){return null===_currentRenderTarget?_pixelRatio:1}var _gl;try{var contextAttributes={alpha:_alpha,depth:_depth,stencil:_stencil,antialias:_antialias,premultipliedAlpha:_premultipliedAlpha,preserveDrawingBuffer:_preserveDrawingBuffer,powerPreference:_powerPreference};_canvas.addEventListener("webglcontextlost",onContextLost,!1);_canvas.addEventListener("webglcontextrestored",onContextRestore,!1);_gl=_context||_canvas.getContext("webgl",contextAttributes)||_canvas.getContext("experimental-webgl",contextAttributes);if(null===_gl){if(null!==_canvas.getContext("webgl")){throw new Error("Error creating WebGL context with your selected attributes.")}else{throw new Error("Error creating WebGL context.")}}if(_gl.getShaderPrecisionFormat===void 0){_gl.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}}}}catch(error){console.error("THREE.WebGLRenderer: "+error.message)}var extensions,capabilities,state,properties,textures,attributes,geometries,objects,programCache,renderLists,renderStates,background,morphtargets,bufferRenderer,indexedBufferRenderer,spriteRenderer,utils;function initGLContext(){extensions=new WebGLExtensions(_gl);extensions.get("WEBGL_depth_texture");extensions.get("OES_texture_float");extensions.get("OES_texture_float_linear");extensions.get("OES_texture_half_float");extensions.get("OES_texture_half_float_linear");extensions.get("OES_standard_derivatives");extensions.get("OES_element_index_uint");extensions.get("ANGLE_instanced_arrays");utils=new WebGLUtils(_gl,extensions);capabilities=new WebGLCapabilities(_gl,extensions,parameters);state=new WebGLState(_gl,extensions,utils);state.scissor(_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio));state.viewport(_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio));properties=new WebGLProperties;textures=new WebGLTextures(_gl,extensions,state,properties,capabilities,utils,_infoMemory,_infoRender);attributes=new WebGLAttributes(_gl);geometries=new WebGLGeometries(_gl,attributes,_infoMemory);objects=new WebGLObjects(geometries,_infoRender);morphtargets=new WebGLMorphtargets(_gl);programCache=new WebGLPrograms(_this,extensions,capabilities);renderLists=new WebGLRenderLists;renderStates=new WebGLRenderStates;background=new WebGLBackground(_this,state,geometries,_premultipliedAlpha);bufferRenderer=new WebGLBufferRenderer(_gl,extensions,_infoRender);indexedBufferRenderer=new WebGLIndexedBufferRenderer(_gl,extensions,_infoRender);spriteRenderer=new WebGLSpriteRenderer(_this,_gl,state,textures,capabilities);_this.info.programs=programCache.programs;_this.context=_gl;_this.capabilities=capabilities;_this.extensions=extensions;_this.properties=properties;_this.renderLists=renderLists;_this.state=state}initGLContext();var vr=new WebVRManager(_this);this.vr=vr;var shadowMap=new WebGLShadowMap(_this,objects,capabilities.maxTextureSize);this.shadowMap=shadowMap;this.getContext=function(){return _gl};this.getContextAttributes=function(){return _gl.getContextAttributes()};this.forceContextLoss=function(){var extension=extensions.get("WEBGL_lose_context");if(extension)extension.loseContext()};this.forceContextRestore=function(){var extension=extensions.get("WEBGL_lose_context");if(extension)extension.restoreContext()};this.getPixelRatio=function(){return _pixelRatio};this.setPixelRatio=function(value){if(value===void 0)return;_pixelRatio=value;this.setSize(_width,_height,!1)};this.getSize=function(){return{width:_width,height:_height}};this.setSize=function(width,height,updateStyle){var device=vr.getDevice();if(device&&device.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}_width=width;_height=height;_canvas.width=width*_pixelRatio;_canvas.height=height*_pixelRatio;if(!1!==updateStyle){_canvas.style.width=width+"px";_canvas.style.height=height+"px"}this.setViewport(0,0,width,height)};this.getDrawingBufferSize=function(){return{width:_width*_pixelRatio,height:_height*_pixelRatio}};this.setDrawingBufferSize=function(width,height,pixelRatio){_width=width;_height=height;_pixelRatio=pixelRatio;_canvas.width=width*pixelRatio;_canvas.height=height*pixelRatio;this.setViewport(0,0,width,height)};this.getCurrentViewport=function(){return _currentViewport};this.setViewport=function(x,y,width,height){_viewport.set(x,_height-y-height,width,height);state.viewport(_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio))};this.setScissor=function(x,y,width,height){_scissor.set(x,_height-y-height,width,height);state.scissor(_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio))};this.setScissorTest=function(boolean){state.setScissorTest(_scissorTest=boolean)};this.getClearColor=function(){return background.getClearColor()};this.setClearColor=function(){background.setClearColor.apply(background,arguments)};this.getClearAlpha=function(){return background.getClearAlpha()};this.setClearAlpha=function(){background.setClearAlpha.apply(background,arguments)};this.clear=function(color,depth,stencil){var bits=0;if(color===void 0||color)bits|=_gl.COLOR_BUFFER_BIT;if(depth===void 0||depth)bits|=_gl.DEPTH_BUFFER_BIT;if(stencil===void 0||stencil)bits|=_gl.STENCIL_BUFFER_BIT;_gl.clear(bits)};this.clearColor=function(){this.clear(!0,!1,!1)};this.clearDepth=function(){this.clear(!1,!0,!1)};this.clearStencil=function(){this.clear(!1,!1,!0)};this.clearTarget=function(renderTarget,color,depth,stencil){this.setRenderTarget(renderTarget);this.clear(color,depth,stencil)};this.dispose=function(){_canvas.removeEventListener("webglcontextlost",onContextLost,!1);_canvas.removeEventListener("webglcontextrestored",onContextRestore,!1);renderLists.dispose();renderStates.dispose();properties.dispose();objects.dispose();vr.dispose();stopAnimation()};function onContextLost(event){event.preventDefault();console.log("THREE.WebGLRenderer: Context Lost.");_isContextLost=!0}function onContextRestore(){console.log("THREE.WebGLRenderer: Context Restored.");_isContextLost=!1;initGLContext()}function onMaterialDispose(event){var material=event.target;material.removeEventListener("dispose",onMaterialDispose);deallocateMaterial(material)}function deallocateMaterial(material){releaseMaterialProgramReference(material);properties.remove(material)}function releaseMaterialProgramReference(material){var programInfo=properties.get(material).program;material.program=void 0;if(programInfo!==void 0){programCache.releaseProgram(programInfo)}}function renderObjectImmediate(object,program,material){object.render(function(object){_this.renderBufferImmediate(object,program,material)})}this.renderBufferImmediate=function(object,program,material){state.initAttributes();var buffers=properties.get(object);if(object.hasPositions&&!buffers.position)buffers.position=_gl.createBuffer();if(object.hasNormals&&!buffers.normal)buffers.normal=_gl.createBuffer();if(object.hasUvs&&!buffers.uv)buffers.uv=_gl.createBuffer();if(object.hasColors&&!buffers.color)buffers.color=_gl.createBuffer();var programAttributes=program.getAttributes();if(object.hasPositions){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.position);_gl.bufferData(_gl.ARRAY_BUFFER,object.positionArray,_gl.DYNAMIC_DRAW);state.enableAttribute(programAttributes.position);_gl.vertexAttribPointer(programAttributes.position,3,_gl.FLOAT,!1,0,0)}if(object.hasNormals){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.normal);if(!material.isMeshPhongMaterial&&!material.isMeshStandardMaterial&&!material.isMeshNormalMaterial&&!0===material.flatShading){for(var i=0,l=3*object.count;i<l;i+=9){var array=object.normalArray,nx=(array[i+0]+array[i+3]+array[i+6])/3,ny=(array[i+1]+array[i+4]+array[i+7])/3,nz=(array[i+2]+array[i+5]+array[i+8])/3;array[i+0]=nx;array[i+1]=ny;array[i+2]=nz;array[i+3]=nx;array[i+4]=ny;array[i+5]=nz;array[i+6]=nx;array[i+7]=ny;array[i+8]=nz}}_gl.bufferData(_gl.ARRAY_BUFFER,object.normalArray,_gl.DYNAMIC_DRAW);state.enableAttribute(programAttributes.normal);_gl.vertexAttribPointer(programAttributes.normal,3,_gl.FLOAT,!1,0,0)}if(object.hasUvs&&material.map){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.uv);_gl.bufferData(_gl.ARRAY_BUFFER,object.uvArray,_gl.DYNAMIC_DRAW);state.enableAttribute(programAttributes.uv);_gl.vertexAttribPointer(programAttributes.uv,2,_gl.FLOAT,!1,0,0)}if(object.hasColors&&material.vertexColors!==NoColors){_gl.bindBuffer(_gl.ARRAY_BUFFER,buffers.color);_gl.bufferData(_gl.ARRAY_BUFFER,object.colorArray,_gl.DYNAMIC_DRAW);state.enableAttribute(programAttributes.color);_gl.vertexAttribPointer(programAttributes.color,3,_gl.FLOAT,!1,0,0)}state.disableUnusedAttributes();_gl.drawArrays(_gl.TRIANGLES,0,object.count);object.count=0};this.renderBufferDirect=function(camera,fog,geometry,material,object,group){var frontFaceCW=object.isMesh&&0>object.matrixWorld.determinant();state.setMaterial(material,frontFaceCW);var program=setProgram(camera,fog,material,object),geometryProgram=geometry.id+"_"+program.id+"_"+(!0===material.wireframe),updateBuffers=!1;if(geometryProgram!==_currentGeometryProgram){_currentGeometryProgram=geometryProgram;updateBuffers=!0}if(object.morphTargetInfluences){morphtargets.update(object,geometry,material,program);updateBuffers=!0}var index=geometry.index,position=geometry.attributes.position,rangeFactor=1;if(!0===material.wireframe){index=geometries.getWireframeAttribute(geometry);rangeFactor=2}var attribute,renderer=bufferRenderer;if(null!==index){attribute=attributes.get(index);renderer=indexedBufferRenderer;renderer.setIndex(attribute)}if(updateBuffers){setupVertexAttributes(material,program,geometry);if(null!==index){_gl.bindBuffer(_gl.ELEMENT_ARRAY_BUFFER,attribute.buffer)}}var dataCount=1/0;if(null!==index){dataCount=index.count}else if(position!==void 0){dataCount=position.count}var rangeStart=geometry.drawRange.start*rangeFactor,rangeCount=geometry.drawRange.count*rangeFactor,groupStart=null!==group?group.start*rangeFactor:0,groupCount=null!==group?group.count*rangeFactor:1/0,drawStart=_Mathmax(rangeStart,groupStart),drawEnd=_Mathmin(dataCount,rangeStart+rangeCount,groupStart+groupCount)-1,drawCount=_Mathmax(0,drawEnd-drawStart+1);if(0===drawCount)return;if(object.isMesh){if(!0===material.wireframe){state.setLineWidth(material.wireframeLinewidth*getTargetPixelRatio());renderer.setMode(_gl.LINES)}else{switch(object.drawMode){case TrianglesDrawMode:renderer.setMode(_gl.TRIANGLES);break;case TriangleStripDrawMode:renderer.setMode(_gl.TRIANGLE_STRIP);break;case TriangleFanDrawMode:renderer.setMode(_gl.TRIANGLE_FAN);break;}}}else if(object.isLine){var lineWidth=material.linewidth;if(lineWidth===void 0)lineWidth=1;state.setLineWidth(lineWidth*getTargetPixelRatio());if(object.isLineSegments){renderer.setMode(_gl.LINES)}else if(object.isLineLoop){renderer.setMode(_gl.LINE_LOOP)}else{renderer.setMode(_gl.LINE_STRIP)}}else if(object.isPoints){renderer.setMode(_gl.POINTS)}if(geometry&&geometry.isInstancedBufferGeometry){if(0<geometry.maxInstancedCount){renderer.renderInstances(geometry,drawStart,drawCount)}}else{renderer.render(drawStart,drawCount)}};function setupVertexAttributes(material,program,geometry,startIndex){if(geometry&&geometry.isInstancedBufferGeometry){if(null===extensions.get("ANGLE_instanced_arrays")){console.error("THREE.WebGLRenderer.setupVertexAttributes: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");return}}if(startIndex===void 0)startIndex=0;state.initAttributes();var geometryAttributes=geometry.attributes,programAttributes=program.getAttributes(),materialDefaultAttributeValues=material.defaultAttributeValues;for(var name in programAttributes){var programAttribute=programAttributes[name];if(0<=programAttribute){var geometryAttribute=geometryAttributes[name];if(geometryAttribute!==void 0){var normalized=geometryAttribute.normalized,size=geometryAttribute.itemSize,attribute=attributes.get(geometryAttribute);if(attribute===void 0)continue;var buffer=attribute.buffer,type=attribute.type,bytesPerElement=attribute.bytesPerElement;if(geometryAttribute.isInterleavedBufferAttribute){var data=geometryAttribute.data,stride=data.stride,offset=geometryAttribute.offset;if(data&&data.isInstancedInterleavedBuffer){state.enableAttributeAndDivisor(programAttribute,data.meshPerAttribute);if(geometry.maxInstancedCount===void 0){geometry.maxInstancedCount=data.meshPerAttribute*data.count}}else{state.enableAttribute(programAttribute)}_gl.bindBuffer(_gl.ARRAY_BUFFER,buffer);_gl.vertexAttribPointer(programAttribute,size,type,normalized,stride*bytesPerElement,(startIndex*stride+offset)*bytesPerElement)}else{if(geometryAttribute.isInstancedBufferAttribute){state.enableAttributeAndDivisor(programAttribute,geometryAttribute.meshPerAttribute);if(geometry.maxInstancedCount===void 0){geometry.maxInstancedCount=geometryAttribute.meshPerAttribute*geometryAttribute.count}}else{state.enableAttribute(programAttribute)}_gl.bindBuffer(_gl.ARRAY_BUFFER,buffer);_gl.vertexAttribPointer(programAttribute,size,type,normalized,0,startIndex*size*bytesPerElement)}}else if(materialDefaultAttributeValues!==void 0){var value=materialDefaultAttributeValues[name];if(value!==void 0){switch(value.length){case 2:_gl.vertexAttrib2fv(programAttribute,value);break;case 3:_gl.vertexAttrib3fv(programAttribute,value);break;case 4:_gl.vertexAttrib4fv(programAttribute,value);break;default:_gl.vertexAttrib1fv(programAttribute,value);}}}}}state.disableUnusedAttributes()}this.compile=function(scene,camera){currentRenderState=renderStates.get(scene,camera);currentRenderState.init();scene.traverse(function(object){if(object.isLight){currentRenderState.pushLight(object);if(object.castShadow){currentRenderState.pushShadow(object)}}});currentRenderState.setupLights(camera);scene.traverse(function(object){if(object.material){if(Array.isArray(object.material)){for(var i=0;i<object.material.length;i++){initMaterial(object.material[i],scene.fog,object)}}else{initMaterial(object.material,scene.fog,object)}}})};var isAnimating=!1,onAnimationFrame=null;function startAnimation(){if(isAnimating)return;requestAnimationLoopFrame();isAnimating=!0}function stopAnimation(){isAnimating=!1}function requestAnimationLoopFrame(){var device=vr.getDevice();if(device&&device.isPresenting){device.requestAnimationFrame(animationLoop)}else{window.requestAnimationFrame(animationLoop)}}function animationLoop(time){if(!1===isAnimating)return;onAnimationFrame(time);requestAnimationLoopFrame()}this.animate=function(callback){onAnimationFrame=callback;null!==onAnimationFrame?startAnimation():stopAnimation()};this.render=function(scene,camera,renderTarget,forceClear){if(!(camera&&camera.isCamera)){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(_isContextLost)return;_currentGeometryProgram="";_currentMaterialId=-1;_currentCamera=null;if(!0===scene.autoUpdate)scene.updateMatrixWorld();if(null===camera.parent)camera.updateMatrixWorld();if(vr.enabled){camera=vr.getCamera(camera)}currentRenderState=renderStates.get(scene,camera);currentRenderState.init();scene.onBeforeRender(_this,scene,camera,renderTarget);_projScreenMatrix.multiplyMatrices(camera.projectionMatrix,camera.matrixWorldInverse);_frustum.setFromMatrix(_projScreenMatrix);_localClippingEnabled=this.localClippingEnabled;_clippingEnabled=_clipping.init(this.clippingPlanes,_localClippingEnabled,camera);currentRenderList=renderLists.get(scene,camera);currentRenderList.init();projectObject(scene,camera,_this.sortObjects);if(!0===_this.sortObjects){currentRenderList.sort()}if(_clippingEnabled)_clipping.beginShadows();var shadowsArray=currentRenderState.state.shadowsArray;shadowMap.render(shadowsArray,scene,camera);currentRenderState.setupLights(camera);if(_clippingEnabled)_clipping.endShadows();if(this.info.autoReset)this.info.reset();if(renderTarget===void 0){renderTarget=null}this.setRenderTarget(renderTarget);background.render(currentRenderList,scene,camera,forceClear);var opaqueObjects=currentRenderList.opaque,transparentObjects=currentRenderList.transparent;if(scene.overrideMaterial){var overrideMaterial=scene.overrideMaterial;if(opaqueObjects.length)renderObjects(opaqueObjects,scene,camera,overrideMaterial);if(transparentObjects.length)renderObjects(transparentObjects,scene,camera,overrideMaterial)}else{if(opaqueObjects.length)renderObjects(opaqueObjects,scene,camera);if(transparentObjects.length)renderObjects(transparentObjects,scene,camera)}var spritesArray=currentRenderState.state.spritesArray;spriteRenderer.render(spritesArray,scene,camera);if(renderTarget){textures.updateRenderTargetMipmap(renderTarget)}state.buffers.depth.setTest(!0);state.buffers.depth.setMask(!0);state.buffers.color.setMask(!0);state.setPolygonOffset(!1);scene.onAfterRender(_this,scene,camera);if(vr.enabled){vr.submitFrame()}currentRenderList=null;currentRenderState=null};function projectObject(object,camera,sortObjects){if(!1===object.visible)return;var visible=object.layers.test(camera.layers);if(visible){if(object.isLight){currentRenderState.pushLight(object);if(object.castShadow){currentRenderState.pushShadow(object)}}else if(object.isSprite){if(!object.frustumCulled||_frustum.intersectsSprite(object)){currentRenderState.pushSprite(object)}}else if(object.isImmediateRenderObject){if(sortObjects){_vector3.setFromMatrixPosition(object.matrixWorld).applyMatrix4(_projScreenMatrix)}currentRenderList.push(object,null,object.material,_vector3.z,null)}else if(object.isMesh||object.isLine||object.isPoints){if(object.isSkinnedMesh){object.skeleton.update()}if(!object.frustumCulled||_frustum.intersectsObject(object)){if(sortObjects){_vector3.setFromMatrixPosition(object.matrixWorld).applyMatrix4(_projScreenMatrix)}var geometry=objects.update(object),material=object.material;if(Array.isArray(material)){for(var groups=geometry.groups,i=0,l=groups.length;i<l;i++){var group=groups[i],groupMaterial=material[group.materialIndex];if(groupMaterial&&groupMaterial.visible){currentRenderList.push(object,geometry,groupMaterial,_vector3.z,group)}}}else if(material.visible){currentRenderList.push(object,geometry,material,_vector3.z,null)}}}}for(var children=object.children,i=0,l=children.length;i<l;i++){projectObject(children[i],camera,sortObjects)}}function renderObjects(renderList,scene,camera,overrideMaterial){for(var i=0,l=renderList.length;i<l;i++){var renderItem=renderList[i],object=renderItem.object,geometry=renderItem.geometry,material=overrideMaterial===void 0?renderItem.material:overrideMaterial,group=renderItem.group;if(camera.isArrayCamera){_currentArrayCamera=camera;for(var cameras=camera.cameras,j=0,jl=cameras.length,camera2;j<jl;j++){camera2=cameras[j];if(object.layers.test(camera2.layers)){var bounds=camera2.bounds,x=bounds.x*_width,y=bounds.y*_height,width=bounds.z*_width,height=bounds.w*_height;state.viewport(_currentViewport.set(x,y,width,height).multiplyScalar(_pixelRatio));renderObject(object,scene,camera2,geometry,material,group)}}}else{_currentArrayCamera=null;renderObject(object,scene,camera,geometry,material,group)}}}function renderObject(object,scene,camera,geometry,material,group){object.onBeforeRender(_this,scene,camera,geometry,material,group);currentRenderState=renderStates.get(scene,_currentArrayCamera||camera);object.modelViewMatrix.multiplyMatrices(camera.matrixWorldInverse,object.matrixWorld);object.normalMatrix.getNormalMatrix(object.modelViewMatrix);if(object.isImmediateRenderObject){var frontFaceCW=object.isMesh&&0>object.matrixWorld.determinant();state.setMaterial(material,frontFaceCW);var program=setProgram(camera,scene.fog,material,object);_currentGeometryProgram="";renderObjectImmediate(object,program,material)}else{_this.renderBufferDirect(camera,scene.fog,geometry,material,object,group)}object.onAfterRender(_this,scene,camera,geometry,material,group);currentRenderState=renderStates.get(scene,_currentArrayCamera||camera)}function initMaterial(material,fog,object){var materialProperties=properties.get(material),lights=currentRenderState.state.lights,shadowsArray=currentRenderState.state.shadowsArray,parameters=programCache.getParameters(material,lights.state,shadowsArray,fog,_clipping.numPlanes,_clipping.numIntersection,object),code=programCache.getProgramCode(material,parameters),program=materialProperties.program,programChange=!0;if(program===void 0){material.addEventListener("dispose",onMaterialDispose)}else if(program.code!==code){releaseMaterialProgramReference(material)}else if(materialProperties.lightsHash!==lights.state.hash){properties.update(material,"lightsHash",lights.state.hash);programChange=!1}else if(parameters.shaderID!==void 0){return}else{programChange=!1}if(programChange){if(parameters.shaderID){var shader=ShaderLib[parameters.shaderID];materialProperties.shader={name:material.type,uniforms:UniformsUtils.clone(shader.uniforms),vertexShader:shader.vertexShader,fragmentShader:shader.fragmentShader}}else{materialProperties.shader={name:material.type,uniforms:material.uniforms,vertexShader:material.vertexShader,fragmentShader:material.fragmentShader}}material.onBeforeCompile(materialProperties.shader);program=programCache.acquireProgram(material,materialProperties.shader,parameters,code);materialProperties.program=program;material.program=program}var programAttributes=program.getAttributes();if(material.morphTargets){material.numSupportedMorphTargets=0;for(var i=0;i<_this.maxMorphTargets;i++){if(0<=programAttributes["morphTarget"+i]){material.numSupportedMorphTargets++}}}if(material.morphNormals){material.numSupportedMorphNormals=0;for(var i=0;i<_this.maxMorphNormals;i++){if(0<=programAttributes["morphNormal"+i]){material.numSupportedMorphNormals++}}}var uniforms=materialProperties.shader.uniforms;if(!material.isShaderMaterial&&!material.isRawShaderMaterial||!0===material.clipping){materialProperties.numClippingPlanes=_clipping.numPlanes;materialProperties.numIntersection=_clipping.numIntersection;uniforms.clippingPlanes=_clipping.uniform}materialProperties.fog=fog;materialProperties.lightsHash=lights.state.hash;if(material.lights){uniforms.ambientLightColor.value=lights.state.ambient;uniforms.directionalLights.value=lights.state.directional;uniforms.spotLights.value=lights.state.spot;uniforms.rectAreaLights.value=lights.state.rectArea;uniforms.pointLights.value=lights.state.point;uniforms.hemisphereLights.value=lights.state.hemi;uniforms.directionalShadowMap.value=lights.state.directionalShadowMap;uniforms.directionalShadowMatrix.value=lights.state.directionalShadowMatrix;uniforms.spotShadowMap.value=lights.state.spotShadowMap;uniforms.spotShadowMatrix.value=lights.state.spotShadowMatrix;uniforms.pointShadowMap.value=lights.state.pointShadowMap;uniforms.pointShadowMatrix.value=lights.state.pointShadowMatrix}var progUniforms=materialProperties.program.getUniforms(),uniformsList=WebGLUniforms.seqWithValue(progUniforms.seq,uniforms);materialProperties.uniformsList=uniformsList}function setProgram(camera,fog,material,object){_usedTextureUnits=0;var materialProperties=properties.get(material),lights=currentRenderState.state.lights;if(_clippingEnabled){if(_localClippingEnabled||camera!==_currentCamera){var useCache=camera===_currentCamera&&material.id===_currentMaterialId;_clipping.setState(material.clippingPlanes,material.clipIntersection,material.clipShadows,camera,materialProperties,useCache)}}if(!1===material.needsUpdate){if(materialProperties.program===void 0){material.needsUpdate=!0}else if(material.fog&&materialProperties.fog!==fog){material.needsUpdate=!0}else if(material.lights&&materialProperties.lightsHash!==lights.state.hash){material.needsUpdate=!0}else if(materialProperties.numClippingPlanes!==void 0&&(materialProperties.numClippingPlanes!==_clipping.numPlanes||materialProperties.numIntersection!==_clipping.numIntersection)){material.needsUpdate=!0}}if(material.needsUpdate){initMaterial(material,fog,object);material.needsUpdate=!1}var refreshProgram=!1,refreshMaterial=!1,refreshLights=!1,program=materialProperties.program,p_uniforms=program.getUniforms(),m_uniforms=materialProperties.shader.uniforms;if(state.useProgram(program.program)){refreshProgram=!0;refreshMaterial=!0;refreshLights=!0}if(material.id!==_currentMaterialId){_currentMaterialId=material.id;refreshMaterial=!0}if(refreshProgram||camera!==_currentCamera){p_uniforms.setValue(_gl,"projectionMatrix",camera.projectionMatrix);if(capabilities.logarithmicDepthBuffer){p_uniforms.setValue(_gl,"logDepthBufFC",2/(_Mathlog(camera.far+1)/_MathLN))}if(_currentCamera!==(_currentArrayCamera||camera)){_currentCamera=_currentArrayCamera||camera;refreshMaterial=!0;refreshLights=!0}if(material.isShaderMaterial||material.isMeshPhongMaterial||material.isMeshStandardMaterial||material.envMap){var uCamPos=p_uniforms.map.cameraPosition;if(uCamPos!==void 0){uCamPos.setValue(_gl,_vector3.setFromMatrixPosition(camera.matrixWorld))}}if(material.isMeshPhongMaterial||material.isMeshLambertMaterial||material.isMeshBasicMaterial||material.isMeshStandardMaterial||material.isShaderMaterial||material.skinning){p_uniforms.setValue(_gl,"viewMatrix",camera.matrixWorldInverse)}}if(material.skinning){p_uniforms.setOptional(_gl,object,"bindMatrix");p_uniforms.setOptional(_gl,object,"bindMatrixInverse");var skeleton=object.skeleton;if(skeleton){var bones=skeleton.bones;if(capabilities.floatVertexTextures){if(skeleton.boneTexture===void 0){var size=_Mathsqrt(4*bones.length);size=_Math.ceilPowerOfTwo(size);size=_Mathmax(size,4);var boneMatrices=new Float32Array(4*(size*size));boneMatrices.set(skeleton.boneMatrices);var boneTexture=new DataTexture(boneMatrices,size,size,RGBAFormat,FloatType);boneTexture.needsUpdate=!0;skeleton.boneMatrices=boneMatrices;skeleton.boneTexture=boneTexture;skeleton.boneTextureSize=size}p_uniforms.setValue(_gl,"boneTexture",skeleton.boneTexture);p_uniforms.setValue(_gl,"boneTextureSize",skeleton.boneTextureSize)}else{p_uniforms.setOptional(_gl,skeleton,"boneMatrices")}}}if(refreshMaterial){p_uniforms.setValue(_gl,"toneMappingExposure",_this.toneMappingExposure);p_uniforms.setValue(_gl,"toneMappingWhitePoint",_this.toneMappingWhitePoint);if(material.lights){markUniformsLightsNeedsUpdate(m_uniforms,refreshLights)}if(fog&&material.fog){refreshUniformsFog(m_uniforms,fog)}if(material.isMeshBasicMaterial){refreshUniformsCommon(m_uniforms,material)}else if(material.isMeshLambertMaterial){refreshUniformsCommon(m_uniforms,material);refreshUniformsLambert(m_uniforms,material)}else if(material.isMeshPhongMaterial){refreshUniformsCommon(m_uniforms,material);if(material.isMeshToonMaterial){refreshUniformsToon(m_uniforms,material)}else{refreshUniformsPhong(m_uniforms,material)}}else if(material.isMeshStandardMaterial){refreshUniformsCommon(m_uniforms,material);if(material.isMeshPhysicalMaterial){refreshUniformsPhysical(m_uniforms,material)}else{refreshUniformsStandard(m_uniforms,material)}}else if(material.isMeshDepthMaterial){refreshUniformsCommon(m_uniforms,material);refreshUniformsDepth(m_uniforms,material)}else if(material.isMeshDistanceMaterial){refreshUniformsCommon(m_uniforms,material);refreshUniformsDistance(m_uniforms,material)}else if(material.isMeshNormalMaterial){refreshUniformsCommon(m_uniforms,material);refreshUniformsNormal(m_uniforms,material)}else if(material.isLineBasicMaterial){refreshUniformsLine(m_uniforms,material);if(material.isLineDashedMaterial){refreshUniformsDash(m_uniforms,material)}}else if(material.isPointsMaterial){refreshUniformsPoints(m_uniforms,material)}else if(material.isShadowMaterial){m_uniforms.color.value=material.color;m_uniforms.opacity.value=material.opacity}if(m_uniforms.ltc_1!==void 0)m_uniforms.ltc_1.value=UniformsLib.LTC_1;if(m_uniforms.ltc_2!==void 0)m_uniforms.ltc_2.value=UniformsLib.LTC_2;WebGLUniforms.upload(_gl,materialProperties.uniformsList,m_uniforms,_this)}if(material.isShaderMaterial&&!0===material.uniformsNeedUpdate){WebGLUniforms.upload(_gl,materialProperties.uniformsList,m_uniforms,_this);material.uniformsNeedUpdate=!1}p_uniforms.setValue(_gl,"modelViewMatrix",object.modelViewMatrix);p_uniforms.setValue(_gl,"normalMatrix",object.normalMatrix);p_uniforms.setValue(_gl,"modelMatrix",object.matrixWorld);return program}function refreshUniformsCommon(uniforms,material){uniforms.opacity.value=material.opacity;if(material.color){uniforms.diffuse.value=material.color}if(material.emissive){uniforms.emissive.value.copy(material.emissive).multiplyScalar(material.emissiveIntensity)}if(material.map){uniforms.map.value=material.map}if(material.alphaMap){uniforms.alphaMap.value=material.alphaMap}if(material.specularMap){uniforms.specularMap.value=material.specularMap}if(material.envMap){uniforms.envMap.value=material.envMap;uniforms.flipEnvMap.value=!(material.envMap&&material.envMap.isCubeTexture)?1:-1;uniforms.reflectivity.value=material.reflectivity;uniforms.refractionRatio.value=material.refractionRatio}if(material.lightMap){uniforms.lightMap.value=material.lightMap;uniforms.lightMapIntensity.value=material.lightMapIntensity}if(material.aoMap){uniforms.aoMap.value=material.aoMap;uniforms.aoMapIntensity.value=material.aoMapIntensity}var uvScaleMap;if(material.map){uvScaleMap=material.map}else if(material.specularMap){uvScaleMap=material.specularMap}else if(material.displacementMap){uvScaleMap=material.displacementMap}else if(material.normalMap){uvScaleMap=material.normalMap}else if(material.bumpMap){uvScaleMap=material.bumpMap}else if(material.roughnessMap){uvScaleMap=material.roughnessMap}else if(material.metalnessMap){uvScaleMap=material.metalnessMap}else if(material.alphaMap){uvScaleMap=material.alphaMap}else if(material.emissiveMap){uvScaleMap=material.emissiveMap}if(uvScaleMap!==void 0){if(uvScaleMap.isWebGLRenderTarget){uvScaleMap=uvScaleMap.texture}if(!0===uvScaleMap.matrixAutoUpdate){var offset=uvScaleMap.offset,repeat=uvScaleMap.repeat,rotation=uvScaleMap.rotation,center=uvScaleMap.center;uvScaleMap.matrix.setUvTransform(offset.x,offset.y,repeat.x,repeat.y,rotation,center.x,center.y)}uniforms.uvTransform.value.copy(uvScaleMap.matrix)}}function refreshUniformsLine(uniforms,material){uniforms.diffuse.value=material.color;uniforms.opacity.value=material.opacity}function refreshUniformsDash(uniforms,material){uniforms.dashSize.value=material.dashSize;uniforms.totalSize.value=material.dashSize+material.gapSize;uniforms.scale.value=material.scale}function refreshUniformsPoints(uniforms,material){uniforms.diffuse.value=material.color;uniforms.opacity.value=material.opacity;uniforms.size.value=material.size*_pixelRatio;uniforms.scale.value=.5*_height;uniforms.map.value=material.map;if(null!==material.map){if(!0===material.map.matrixAutoUpdate){var offset=material.map.offset,repeat=material.map.repeat,rotation=material.map.rotation,center=material.map.center;material.map.matrix.setUvTransform(offset.x,offset.y,repeat.x,repeat.y,rotation,center.x,center.y)}uniforms.uvTransform.value.copy(material.map.matrix)}}function refreshUniformsFog(uniforms,fog){uniforms.fogColor.value=fog.color;if(fog.isFog){uniforms.fogNear.value=fog.near;uniforms.fogFar.value=fog.far}else if(fog.isFogExp2){uniforms.fogDensity.value=fog.density}}function refreshUniformsLambert(uniforms,material){if(material.emissiveMap){uniforms.emissiveMap.value=material.emissiveMap}}function refreshUniformsPhong(uniforms,material){uniforms.specular.value=material.specular;uniforms.shininess.value=_Mathmax(material.shininess,1e-4);if(material.emissiveMap){uniforms.emissiveMap.value=material.emissiveMap}if(material.bumpMap){uniforms.bumpMap.value=material.bumpMap;uniforms.bumpScale.value=material.bumpScale}if(material.normalMap){uniforms.normalMap.value=material.normalMap;uniforms.normalScale.value.copy(material.normalScale)}if(material.displacementMap){uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias}}function refreshUniformsToon(uniforms,material){refreshUniformsPhong(uniforms,material);if(material.gradientMap){uniforms.gradientMap.value=material.gradientMap}}function refreshUniformsStandard(uniforms,material){uniforms.roughness.value=material.roughness;uniforms.metalness.value=material.metalness;if(material.roughnessMap){uniforms.roughnessMap.value=material.roughnessMap}if(material.metalnessMap){uniforms.metalnessMap.value=material.metalnessMap}if(material.emissiveMap){uniforms.emissiveMap.value=material.emissiveMap}if(material.bumpMap){uniforms.bumpMap.value=material.bumpMap;uniforms.bumpScale.value=material.bumpScale}if(material.normalMap){uniforms.normalMap.value=material.normalMap;uniforms.normalScale.value.copy(material.normalScale)}if(material.displacementMap){uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias}if(material.envMap){uniforms.envMapIntensity.value=material.envMapIntensity}}function refreshUniformsPhysical(uniforms,material){uniforms.clearCoat.value=material.clearCoat;uniforms.clearCoatRoughness.value=material.clearCoatRoughness;refreshUniformsStandard(uniforms,material)}function refreshUniformsDepth(uniforms,material){if(material.displacementMap){uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias}}function refreshUniformsDistance(uniforms,material){if(material.displacementMap){uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias}uniforms.referencePosition.value.copy(material.referencePosition);uniforms.nearDistance.value=material.nearDistance;uniforms.farDistance.value=material.farDistance}function refreshUniformsNormal(uniforms,material){if(material.bumpMap){uniforms.bumpMap.value=material.bumpMap;uniforms.bumpScale.value=material.bumpScale}if(material.normalMap){uniforms.normalMap.value=material.normalMap;uniforms.normalScale.value.copy(material.normalScale)}if(material.displacementMap){uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias}}function markUniformsLightsNeedsUpdate(uniforms,value){uniforms.ambientLightColor.needsUpdate=value;uniforms.directionalLights.needsUpdate=value;uniforms.pointLights.needsUpdate=value;uniforms.spotLights.needsUpdate=value;uniforms.rectAreaLights.needsUpdate=value;uniforms.hemisphereLights.needsUpdate=value}function allocTextureUnit(){var textureUnit=_usedTextureUnits;if(textureUnit>=capabilities.maxTextures){console.warn("THREE.WebGLRenderer: Trying to use "+textureUnit+" texture units while this GPU supports only "+capabilities.maxTextures)}_usedTextureUnits+=1;return textureUnit}this.allocTextureUnit=allocTextureUnit;this.setTexture2D=function(){var warned=!1;return function(texture,slot){if(texture&&texture.isWebGLRenderTarget){if(!warned){console.warn("THREE.WebGLRenderer.setTexture2D: don't use render targets as textures. Use their .texture property instead.");warned=!0}texture=texture.texture}textures.setTexture2D(texture,slot)}}();this.setTexture=function(){var warned=!1;return function(texture,slot){if(!warned){console.warn("THREE.WebGLRenderer: .setTexture is deprecated, use setTexture2D instead.");warned=!0}textures.setTexture2D(texture,slot)}}();this.setTextureCube=function(){var warned=!1;return function(texture,slot){if(texture&&texture.isWebGLRenderTargetCube){if(!warned){console.warn("THREE.WebGLRenderer.setTextureCube: don't use cube render targets as textures. Use their .texture property instead.");warned=!0}texture=texture.texture}if(texture&&texture.isCubeTexture||Array.isArray(texture.image)&&6===texture.image.length){textures.setTextureCube(texture,slot)}else{textures.setTextureCubeDynamic(texture,slot)}}}();this.getRenderTarget=function(){return _currentRenderTarget};this.setRenderTarget=function(renderTarget){_currentRenderTarget=renderTarget;if(renderTarget&&properties.get(renderTarget).__webglFramebuffer===void 0){textures.setupRenderTarget(renderTarget)}var framebuffer=null,isCube=!1;if(renderTarget){var __webglFramebuffer=properties.get(renderTarget).__webglFramebuffer;if(renderTarget.isWebGLRenderTargetCube){framebuffer=__webglFramebuffer[renderTarget.activeCubeFace];isCube=!0}else{framebuffer=__webglFramebuffer}_currentViewport.copy(renderTarget.viewport);_currentScissor.copy(renderTarget.scissor);_currentScissorTest=renderTarget.scissorTest}else{_currentViewport.copy(_viewport).multiplyScalar(_pixelRatio);_currentScissor.copy(_scissor).multiplyScalar(_pixelRatio);_currentScissorTest=_scissorTest}if(_currentFramebuffer!==framebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);_currentFramebuffer=framebuffer}state.viewport(_currentViewport);state.scissor(_currentScissor);state.setScissorTest(_currentScissorTest);if(isCube){var textureProperties=properties.get(renderTarget.texture);_gl.framebufferTexture2D(_gl.FRAMEBUFFER,_gl.COLOR_ATTACHMENT0,_gl.TEXTURE_CUBE_MAP_POSITIVE_X+renderTarget.activeCubeFace,textureProperties.__webglTexture,renderTarget.activeMipMapLevel)}};this.readRenderTargetPixels=function(renderTarget,x,y,width,height,buffer){if(!(renderTarget&&renderTarget.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}var framebuffer=properties.get(renderTarget).__webglFramebuffer;if(framebuffer){var restore=!1;if(framebuffer!==_currentFramebuffer){_gl.bindFramebuffer(_gl.FRAMEBUFFER,framebuffer);restore=!0}try{var texture=renderTarget.texture,textureFormat=texture.format,textureType=texture.type;if(textureFormat!==RGBAFormat&&utils.convert(textureFormat)!==_gl.getParameter(_gl.IMPLEMENTATION_COLOR_READ_FORMAT)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(textureType!==UnsignedByteType&&utils.convert(textureType)!==_gl.getParameter(_gl.IMPLEMENTATION_COLOR_READ_TYPE)&&!(textureType===FloatType&&(extensions.get("OES_texture_float")||extensions.get("WEBGL_color_buffer_float")))&&!(textureType===HalfFloatType&&extensions.get("EXT_color_buffer_half_float"))){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}if(_gl.checkFramebufferStatus(_gl.FRAMEBUFFER)===_gl.FRAMEBUFFER_COMPLETE){if(0<=x&&x<=renderTarget.width-width&&0<=y&&y<=renderTarget.height-height){_gl.readPixels(x,y,width,height,utils.convert(textureFormat),utils.convert(textureType),buffer)}}else{console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}}finally{if(restore){_gl.bindFramebuffer(_gl.FRAMEBUFFER,_currentFramebuffer)}}}};this.copyFramebufferToTexture=function(position,texture,level){var width=texture.image.width,height=texture.image.height,internalFormat=utils.convert(texture.format);this.setTexture2D(texture,0);_gl.copyTexImage2D(_gl.TEXTURE_2D,level||0,internalFormat,position.x,position.y,width,height,0)}}function FogExp2(color,density){this.name="";this.color=new Color(color);this.density=density!==void 0?density:25e-5}FogExp2.prototype.isFogExp2=!0;FogExp2.prototype.clone=function(){return new FogExp2(this.color.getHex(),this.density)};FogExp2.prototype.toJSON=function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}};function Fog(color,near,far){this.name="";this.color=new Color(color);this.near=near!==void 0?near:1;this.far=far!==void 0?far:1e3}Fog.prototype.isFog=!0;Fog.prototype.clone=function(){return new Fog(this.color.getHex(),this.near,this.far)};Fog.prototype.toJSON=function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}};function Scene(){Object3D.call(this);this.type="Scene";this.background=null;this.fog=null;this.overrideMaterial=null;this.autoUpdate=!0}Scene.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Scene,copy:function copy(source,recursive){Object3D.prototype.copy.call(this,source,recursive);if(null!==source.background)this.background=source.background.clone();if(null!==source.fog)this.fog=source.fog.clone();if(null!==source.overrideMaterial)this.overrideMaterial=source.overrideMaterial.clone();this.autoUpdate=source.autoUpdate;this.matrixAutoUpdate=source.matrixAutoUpdate;return this},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);if(null!==this.background)data.object.background=this.background.toJSON(meta);if(null!==this.fog)data.object.fog=this.fog.toJSON();return data}});function SpriteMaterial(parameters){Material.call(this);this.type="SpriteMaterial";this.color=new Color(16777215);this.map=null;this.rotation=0;this.fog=!1;this.lights=!1;this.setValues(parameters)}SpriteMaterial.prototype=Object.create(Material.prototype);SpriteMaterial.prototype.constructor=SpriteMaterial;SpriteMaterial.prototype.isSpriteMaterial=!0;SpriteMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.map=source.map;this.rotation=source.rotation;return this};function Sprite(material){Object3D.call(this);this.type="Sprite";this.material=material!==void 0?material:new SpriteMaterial;this.center=new Vector2(.5,.5)}Sprite.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Sprite,isSprite:!0,raycast:function(){var intersectPoint=new Vector3,worldPosition=new Vector3,worldScale=new Vector3;return function(raycaster,intersects){worldPosition.setFromMatrixPosition(this.matrixWorld);raycaster.ray.closestPointToPoint(worldPosition,intersectPoint);worldScale.setFromMatrixScale(this.matrixWorld);var guessSizeSq=worldScale.x*worldScale.y/4;if(worldPosition.distanceToSquared(intersectPoint)>guessSizeSq)return;var distance=raycaster.ray.origin.distanceTo(intersectPoint);if(distance<raycaster.near||distance>raycaster.far)return;intersects.push({distance:distance,point:intersectPoint.clone(),face:null,object:this})}}(),clone:function clone(){return new this.constructor(this.material).copy(this)},copy:function copy(source){Object3D.prototype.copy.call(this,source);if(source.center!==void 0)this.center.copy(source.center);return this}});function LOD(){Object3D.call(this);this.type="LOD";Object.defineProperties(this,{levels:{enumerable:!0,value:[]}})}LOD.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:LOD,copy:function copy(source){Object3D.prototype.copy.call(this,source,!1);for(var levels=source.levels,i=0,l=levels.length,level;i<l;i++){level=levels[i];this.addLevel(level.object.clone(),level.distance)}return this},addLevel:function addLevel(object,distance){if(distance===void 0)distance=0;distance=_Mathabs(distance);for(var levels=this.levels,l=0;l<levels.length;l++){if(distance<levels[l].distance){break}}levels.splice(l,0,{distance:distance,object:object});this.add(object)},getObjectForDistance:function getObjectForDistance(distance){for(var levels=this.levels,i=1,l=levels.length;i<l;i++){if(distance<levels[i].distance){break}}return levels[i-1].object},raycast:function(){var matrixPosition=new Vector3;return function(raycaster,intersects){matrixPosition.setFromMatrixPosition(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(matrixPosition);this.getObjectForDistance(distance).raycast(raycaster,intersects)}}(),update:function(){var v1=new Vector3,v2=new Vector3;return function(camera){var levels=this.levels;if(1<levels.length){v1.setFromMatrixPosition(camera.matrixWorld);v2.setFromMatrixPosition(this.matrixWorld);var distance=v1.distanceTo(v2);levels[0].object.visible=!0;for(var i=1,l=levels.length;i<l;i++){if(distance>=levels[i].distance){levels[i-1].object.visible=!1;levels[i].object.visible=!0}else{break}}for(;i<l;i++){levels[i].object.visible=!1}}}}(),toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);data.object.levels=[];for(var levels=this.levels,i=0,l=levels.length,level;i<l;i++){level=levels[i];data.object.levels.push({object:level.object.uuid,distance:level.distance})}return data}});function Skeleton(bones,boneInverses){bones=bones||[];this.bones=bones.slice(0);this.boneMatrices=new Float32Array(16*this.bones.length);if(boneInverses===void 0){this.calculateInverses()}else{if(this.bones.length===boneInverses.length){this.boneInverses=boneInverses.slice(0)}else{console.warn("THREE.Skeleton boneInverses is the wrong length.");this.boneInverses=[];for(var i=0,il=this.bones.length;i<il;i++){this.boneInverses.push(new Matrix4)}}}}Object.assign(Skeleton.prototype,{calculateInverses:function calculateInverses(){this.boneInverses=[];for(var i=0,il=this.bones.length,inverse;i<il;i++){inverse=new Matrix4;if(this.bones[i]){inverse.getInverse(this.bones[i].matrixWorld)}this.boneInverses.push(inverse)}},pose:function pose(){var bone,i,il;for(i=0,il=this.bones.length;i<il;i++){bone=this.bones[i];if(bone){bone.matrixWorld.getInverse(this.boneInverses[i])}}for(i=0,il=this.bones.length;i<il;i++){bone=this.bones[i];if(bone){if(bone.parent&&bone.parent.isBone){bone.matrix.getInverse(bone.parent.matrixWorld);bone.matrix.multiply(bone.matrixWorld)}else{bone.matrix.copy(bone.matrixWorld)}bone.matrix.decompose(bone.position,bone.quaternion,bone.scale)}}},update:function(){var offsetMatrix=new Matrix4,identityMatrix=new Matrix4;return function(){for(var bones=this.bones,boneInverses=this.boneInverses,boneMatrices=this.boneMatrices,boneTexture=this.boneTexture,i=0,il=bones.length,matrix;i<il;i++){matrix=bones[i]?bones[i].matrixWorld:identityMatrix;offsetMatrix.multiplyMatrices(matrix,boneInverses[i]);offsetMatrix.toArray(boneMatrices,16*i)}if(boneTexture!==void 0){boneTexture.needsUpdate=!0}}}(),clone:function clone(){return new Skeleton(this.bones,this.boneInverses)},getBoneByName:function getBoneByName(name){for(var i=0,il=this.bones.length,bone;i<il;i++){bone=this.bones[i];if(bone.name===name){return bone}}}});function Bone(){Object3D.call(this);this.type="Bone"}Bone.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Bone,isBone:!0});function SkinnedMesh(geometry,material){Mesh.call(this,geometry,material);this.type="SkinnedMesh";this.bindMode="attached";this.bindMatrix=new Matrix4;this.bindMatrixInverse=new Matrix4;var bones=this.initBones(),skeleton=new Skeleton(bones);this.bind(skeleton,this.matrixWorld);this.normalizeSkinWeights()}SkinnedMesh.prototype=Object.assign(Object.create(Mesh.prototype),{constructor:SkinnedMesh,isSkinnedMesh:!0,initBones:function initBones(){var bones=[],bone,gbone,i,il;if(this.geometry&&this.geometry.bones!==void 0){for(i=0,il=this.geometry.bones.length;i<il;i++){gbone=this.geometry.bones[i];bone=new Bone;bones.push(bone);bone.name=gbone.name;bone.position.fromArray(gbone.pos);bone.quaternion.fromArray(gbone.rotq);if(gbone.scl!==void 0)bone.scale.fromArray(gbone.scl)}for(i=0,il=this.geometry.bones.length;i<il;i++){gbone=this.geometry.bones[i];if(-1!==gbone.parent&&null!==gbone.parent&&bones[gbone.parent]!==void 0){bones[gbone.parent].add(bones[i])}else{this.add(bones[i])}}}this.updateMatrixWorld(!0);return bones},bind:function bind(skeleton,bindMatrix){this.skeleton=skeleton;if(bindMatrix===void 0){this.updateMatrixWorld(!0);this.skeleton.calculateInverses();bindMatrix=this.matrixWorld}this.bindMatrix.copy(bindMatrix);this.bindMatrixInverse.getInverse(bindMatrix)},pose:function pose(){this.skeleton.pose()},normalizeSkinWeights:function normalizeSkinWeights(){var scale,i;if(this.geometry&&this.geometry.isGeometry){for(i=0;i<this.geometry.skinWeights.length;i++){var sw=this.geometry.skinWeights[i];scale=1/sw.manhattanLength();if(scale!==1/0){sw.multiplyScalar(scale)}else{sw.set(1,0,0,0)}}}else if(this.geometry&&this.geometry.isBufferGeometry){var vec=new Vector4,skinWeight=this.geometry.attributes.skinWeight;for(i=0;i<skinWeight.count;i++){vec.x=skinWeight.getX(i);vec.y=skinWeight.getY(i);vec.z=skinWeight.getZ(i);vec.w=skinWeight.getW(i);scale=1/vec.manhattanLength();if(scale!==1/0){vec.multiplyScalar(scale)}else{vec.set(1,0,0,0)}skinWeight.setXYZW(i,vec.x,vec.y,vec.z,vec.w)}}},updateMatrixWorld:function updateMatrixWorld(force){Mesh.prototype.updateMatrixWorld.call(this,force);if("attached"===this.bindMode){this.bindMatrixInverse.getInverse(this.matrixWorld)}else if("detached"===this.bindMode){this.bindMatrixInverse.getInverse(this.bindMatrix)}else{console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this)}});function LineBasicMaterial(parameters){Material.call(this);this.type="LineBasicMaterial";this.color=new Color(16777215);this.linewidth=1;this.linecap="round";this.linejoin="round";this.lights=!1;this.setValues(parameters)}LineBasicMaterial.prototype=Object.create(Material.prototype);LineBasicMaterial.prototype.constructor=LineBasicMaterial;LineBasicMaterial.prototype.isLineBasicMaterial=!0;LineBasicMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.linewidth=source.linewidth;this.linecap=source.linecap;this.linejoin=source.linejoin;return this};function Line(geometry,material,mode){if(1===mode){console.warn("THREE.Line: parameter THREE.LinePieces no longer supported. Created THREE.LineSegments instead.");return new LineSegments(geometry,material)}Object3D.call(this);this.type="Line";this.geometry=geometry!==void 0?geometry:new BufferGeometry;this.material=material!==void 0?material:new LineBasicMaterial({color:16777215*Math.random()})}Line.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Line,isLine:!0,computeLineDistances:function(){var start=new Vector3,end=new Vector3;return function(){var geometry=this.geometry;if(geometry.isBufferGeometry){if(null===geometry.index){for(var positionAttribute=geometry.attributes.position,lineDistances=[0],i=1,l=positionAttribute.count;i<l;i++){start.fromBufferAttribute(positionAttribute,i-1);end.fromBufferAttribute(positionAttribute,i);lineDistances[i]=lineDistances[i-1];lineDistances[i]+=start.distanceTo(end)}geometry.addAttribute("lineDistance",new THREE.Float32BufferAttribute(lineDistances,1))}else{console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}}else if(geometry.isGeometry){var vertices=geometry.vertices,lineDistances=geometry.lineDistances;lineDistances[0]=0;for(var i=1,l=vertices.length;i<l;i++){lineDistances[i]=lineDistances[i-1];lineDistances[i]+=vertices[i-1].distanceTo(vertices[i])}}return this}}(),raycast:function(){var inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere;return function(raycaster,intersects){var precision=raycaster.linePrecision,precisionSq=precision*precision,geometry=this.geometry,matrixWorld=this.matrixWorld;if(null===geometry.boundingSphere)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(matrixWorld);if(!1===raycaster.ray.intersectsSphere(sphere))return;inverseMatrix.getInverse(matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);var vStart=new Vector3,vEnd=new Vector3,interSegment=new Vector3,interRay=new Vector3,step=this&&this.isLineSegments?2:1;if(geometry.isBufferGeometry){var index=geometry.index,attributes=geometry.attributes,positions=attributes.position.array;if(null!==index){for(var indices=index.array,i=0,l=indices.length-1;i<l;i+=step){var a=indices[i],b=indices[i+1];vStart.fromArray(positions,3*a);vEnd.fromArray(positions,3*b);var distSq=ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment);if(distSq>precisionSq)continue;interRay.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}else{for(var i=0,l=positions.length/3-1;i<l;i+=step){vStart.fromArray(positions,3*i);vEnd.fromArray(positions,3*i+3);var distSq=ray.distanceSqToSegment(vStart,vEnd,interRay,interSegment);if(distSq>precisionSq)continue;interRay.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}else if(geometry.isGeometry){for(var vertices=geometry.vertices,nbVertices=vertices.length,i=0,distSq;i<nbVertices-1;i+=step){distSq=ray.distanceSqToSegment(vertices[i],vertices[i+1],interRay,interSegment);if(distSq>precisionSq)continue;interRay.applyMatrix4(this.matrixWorld);var distance=raycaster.ray.origin.distanceTo(interRay);if(distance<raycaster.near||distance>raycaster.far)continue;intersects.push({distance:distance,point:interSegment.clone().applyMatrix4(this.matrixWorld),index:i,face:null,faceIndex:null,object:this})}}}}(),clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this)}});function LineSegments(geometry,material){Line.call(this,geometry,material);this.type="LineSegments"}LineSegments.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineSegments,isLineSegments:!0,computeLineDistances:function(){var start=new Vector3,end=new Vector3;return function(){var geometry=this.geometry;if(geometry.isBufferGeometry){if(null===geometry.index){for(var positionAttribute=geometry.attributes.position,lineDistances=[],i=0,l=positionAttribute.count;i<l;i+=2){start.fromBufferAttribute(positionAttribute,i);end.fromBufferAttribute(positionAttribute,i+1);lineDistances[i]=0===i?0:lineDistances[i-1];lineDistances[i+1]=lineDistances[i]+start.distanceTo(end)}geometry.addAttribute("lineDistance",new THREE.Float32BufferAttribute(lineDistances,1))}else{console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.")}}else if(geometry.isGeometry){for(var vertices=geometry.vertices,lineDistances=geometry.lineDistances,i=0,l=vertices.length;i<l;i+=2){start.copy(vertices[i]);end.copy(vertices[i+1]);lineDistances[i]=0===i?0:lineDistances[i-1];lineDistances[i+1]=lineDistances[i]+start.distanceTo(end)}}return this}}()});function LineLoop(geometry,material){Line.call(this,geometry,material);this.type="LineLoop"}LineLoop.prototype=Object.assign(Object.create(Line.prototype),{constructor:LineLoop,isLineLoop:!0});function PointsMaterial(parameters){Material.call(this);this.type="PointsMaterial";this.color=new Color(16777215);this.map=null;this.size=1;this.sizeAttenuation=!0;this.lights=!1;this.setValues(parameters)}PointsMaterial.prototype=Object.create(Material.prototype);PointsMaterial.prototype.constructor=PointsMaterial;PointsMaterial.prototype.isPointsMaterial=!0;PointsMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.map=source.map;this.size=source.size;this.sizeAttenuation=source.sizeAttenuation;return this};function Points(geometry,material){Object3D.call(this);this.type="Points";this.geometry=geometry!==void 0?geometry:new BufferGeometry;this.material=material!==void 0?material:new PointsMaterial({color:16777215*Math.random()})}Points.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Points,isPoints:!0,raycast:function(){var inverseMatrix=new Matrix4,ray=new Ray,sphere=new Sphere;return function(raycaster,intersects){var object=this,geometry=this.geometry,matrixWorld=this.matrixWorld,threshold=raycaster.params.Points.threshold;if(null===geometry.boundingSphere)geometry.computeBoundingSphere();sphere.copy(geometry.boundingSphere);sphere.applyMatrix4(matrixWorld);sphere.radius+=threshold;if(!1===raycaster.ray.intersectsSphere(sphere))return;inverseMatrix.getInverse(matrixWorld);ray.copy(raycaster.ray).applyMatrix4(inverseMatrix);var localThreshold=threshold/((this.scale.x+this.scale.y+this.scale.z)/3),position=new Vector3;function testPoint(point,index){var rayPointDistanceSq=ray.distanceSqToPoint(point);if(rayPointDistanceSq<localThreshold*localThreshold){var intersectPoint=ray.closestPointToPoint(point);intersectPoint.applyMatrix4(matrixWorld);var distance=raycaster.ray.origin.distanceTo(intersectPoint);if(distance<raycaster.near||distance>raycaster.far)return;intersects.push({distance:distance,distanceToRay:_Mathsqrt(rayPointDistanceSq),point:intersectPoint.clone(),index:index,face:null,object:object})}}if(geometry.isBufferGeometry){var index=geometry.index,attributes=geometry.attributes,positions=attributes.position.array;if(null!==index){for(var indices=index.array,i=0,il=indices.length,a;i<il;i++){a=indices[i];position.fromArray(positions,3*a);testPoint(position,a)}}else{for(var i=0,l=positions.length/3;i<l;i++){position.fromArray(positions,3*i);testPoint(position,i)}}}else{for(var vertices=geometry.vertices,i=0,l=vertices.length;i<l;i++){testPoint(vertices[i],i)}}}}(),clone:function clone(){return new this.constructor(this.geometry,this.material).copy(this)}});function Group(){Object3D.call(this);this.type="Group"}Group.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Group,isGroup:!0});function VideoTexture(video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy){Texture.call(this,video,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.generateMipmaps=!1}VideoTexture.prototype=Object.assign(Object.create(Texture.prototype),{constructor:VideoTexture,isVideoTexture:!0,update:function update(){var video=this.image;if(video.readyState>=video.HAVE_CURRENT_DATA){this.needsUpdate=!0}}});function CompressedTexture(mipmaps,width,height,format,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,encoding){Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy,encoding);this.image={width:width,height:height};this.mipmaps=mipmaps;this.flipY=!1;this.generateMipmaps=!1}CompressedTexture.prototype=Object.create(Texture.prototype);CompressedTexture.prototype.constructor=CompressedTexture;CompressedTexture.prototype.isCompressedTexture=!0;function DepthTexture(width,height,type,mapping,wrapS,wrapT,magFilter,minFilter,anisotropy,format){format=format!==void 0?format:DepthFormat;if(format!==DepthFormat&&format!==DepthStencilFormat){throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat")}if(type===void 0&&format===DepthFormat)type=UnsignedShortType;if(type===void 0&&format===DepthStencilFormat)type=UnsignedInt248Type;Texture.call(this,null,mapping,wrapS,wrapT,magFilter,minFilter,format,type,anisotropy);this.image={width:width,height:height};this.magFilter=magFilter!==void 0?magFilter:NearestFilter;this.minFilter=minFilter!==void 0?minFilter:NearestFilter;this.flipY=!1;this.generateMipmaps=!1}DepthTexture.prototype=Object.create(Texture.prototype);DepthTexture.prototype.constructor=DepthTexture;DepthTexture.prototype.isDepthTexture=!0;function WireframeGeometry(geometry){BufferGeometry.call(this);this.type="WireframeGeometry";var vertices=[],i,j,l,o,ol,edge=[0,0],edges={},e,edge1,edge2,key,keys=["a","b","c"],vertex;if(geometry&&geometry.isGeometry){var faces=geometry.faces;for(i=0,l=faces.length;i<l;i++){var face=faces[i];for(j=0;3>j;j++){edge1=face[keys[j]];edge2=face[keys[(j+1)%3]];edge[0]=_Mathmin(edge1,edge2);edge[1]=_Mathmax(edge1,edge2);key=edge[0]+","+edge[1];if(edges[key]===void 0){edges[key]={index1:edge[0],index2:edge[1]}}}}for(key in edges){e=edges[key];vertex=geometry.vertices[e.index1];vertices.push(vertex.x,vertex.y,vertex.z);vertex=geometry.vertices[e.index2];vertices.push(vertex.x,vertex.y,vertex.z)}}else if(geometry&&geometry.isBufferGeometry){var position,indices,groups,group,start,count,index1,index2;vertex=new Vector3;if(null!==geometry.index){position=geometry.attributes.position;indices=geometry.index;groups=geometry.groups;if(0===groups.length){groups=[{start:0,count:indices.count,materialIndex:0}]}for(o=0,ol=groups.length;o<ol;++o){group=groups[o];start=group.start;count=group.count;for(i=start,l=start+count;i<l;i+=3){for(j=0;3>j;j++){edge1=indices.getX(i+j);edge2=indices.getX(i+(j+1)%3);edge[0]=_Mathmin(edge1,edge2);edge[1]=_Mathmax(edge1,edge2);key=edge[0]+","+edge[1];if(edges[key]===void 0){edges[key]={index1:edge[0],index2:edge[1]}}}}}for(key in edges){e=edges[key];vertex.fromBufferAttribute(position,e.index1);vertices.push(vertex.x,vertex.y,vertex.z);vertex.fromBufferAttribute(position,e.index2);vertices.push(vertex.x,vertex.y,vertex.z)}}else{position=geometry.attributes.position;for(i=0,l=position.count/3;i<l;i++){for(j=0;3>j;j++){index1=3*i+j;vertex.fromBufferAttribute(position,index1);vertices.push(vertex.x,vertex.y,vertex.z);index2=3*i+(j+1)%3;vertex.fromBufferAttribute(position,index2);vertices.push(vertex.x,vertex.y,vertex.z)}}}}this.addAttribute("position",new Float32BufferAttribute(vertices,3))}WireframeGeometry.prototype=Object.create(BufferGeometry.prototype);WireframeGeometry.prototype.constructor=WireframeGeometry;function ParametricGeometry(func,slices,stacks){Geometry.call(this);this.type="ParametricGeometry";this.parameters={func:func,slices:slices,stacks:stacks};this.fromBufferGeometry(new ParametricBufferGeometry(func,slices,stacks));this.mergeVertices()}ParametricGeometry.prototype=Object.create(Geometry.prototype);ParametricGeometry.prototype.constructor=ParametricGeometry;function ParametricBufferGeometry(func,slices,stacks){BufferGeometry.call(this);this.type="ParametricBufferGeometry";this.parameters={func:func,slices:slices,stacks:stacks};var indices=[],vertices=[],normals=[],uvs=[],EPS=1e-5,normal=new Vector3,p0=new Vector3,p1=new Vector3,pu=new Vector3,pv=new Vector3,i,j,sliceCount=slices+1;for(i=0;i<=stacks;i++){var v=i/stacks;for(j=0;j<=slices;j++){var u=j/slices;p0=func(u,v,p0);vertices.push(p0.x,p0.y,p0.z);if(0<=u-EPS){p1=func(u-EPS,v,p1);pu.subVectors(p0,p1)}else{p1=func(u+EPS,v,p1);pu.subVectors(p1,p0)}if(0<=v-EPS){p1=func(u,v-EPS,p1);pv.subVectors(p0,p1)}else{p1=func(u,v+EPS,p1);pv.subVectors(p1,p0)}normal.crossVectors(pu,pv).normalize();normals.push(normal.x,normal.y,normal.z);uvs.push(u,v)}}for(i=0;i<stacks;i++){for(j=0;j<slices;j++){var a=i*sliceCount+j,b=i*sliceCount+j+1,c=(i+1)*sliceCount+j+1,d=(i+1)*sliceCount+j;indices.push(a,b,d);indices.push(b,c,d)}}this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("normal",new Float32BufferAttribute(normals,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}ParametricBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ParametricBufferGeometry.prototype.constructor=ParametricBufferGeometry;function PolyhedronGeometry(vertices,indices,radius,detail){Geometry.call(this);this.type="PolyhedronGeometry";this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail};this.fromBufferGeometry(new PolyhedronBufferGeometry(vertices,indices,radius,detail));this.mergeVertices()}PolyhedronGeometry.prototype=Object.create(Geometry.prototype);PolyhedronGeometry.prototype.constructor=PolyhedronGeometry;function PolyhedronBufferGeometry(vertices,indices,radius,detail){BufferGeometry.call(this);this.type="PolyhedronBufferGeometry";this.parameters={vertices:vertices,indices:indices,radius:radius,detail:detail};radius=radius||1;detail=detail||0;var vertexBuffer=[],uvBuffer=[];subdivide(detail);appplyRadius(radius);(function(){for(var vertex=new Vector3,i=0;i<vertexBuffer.length;i+=3){vertex.x=vertexBuffer[i+0];vertex.y=vertexBuffer[i+1];vertex.z=vertexBuffer[i+2];var u=azimuth(vertex)/2/_MathPI+.5,v=inclination(vertex)/_MathPI+.5;uvBuffer.push(u,1-v)}correctUVs();correctSeam()})();this.addAttribute("position",new Float32BufferAttribute(vertexBuffer,3));this.addAttribute("normal",new Float32BufferAttribute(vertexBuffer.slice(),3));this.addAttribute("uv",new Float32BufferAttribute(uvBuffer,2));if(0===detail){this.computeVertexNormals()}else{this.normalizeNormals()}function subdivide(detail){for(var a=new Vector3,b=new Vector3,c=new Vector3,i=0;i<indices.length;i+=3){getVertexByIndex(indices[i+0],a);getVertexByIndex(indices[i+1],b);getVertexByIndex(indices[i+2],c);subdivideFace(a,b,c,detail)}}function subdivideFace(a,b,c,detail){var cols=_Mathpow(2,detail),v=[],i,j;for(i=0;i<=cols;i++){v[i]=[];var aj=a.clone().lerp(c,i/cols),bj=b.clone().lerp(c,i/cols),rows=cols-i;for(j=0;j<=rows;j++){if(0===j&&i===cols){v[i][j]=aj}else{v[i][j]=aj.clone().lerp(bj,j/rows)}}}for(i=0;i<cols;i++){for(j=0;j<2*(cols-i)-1;j++){var k=_Mathfloor(j/2);if(0===j%2){pushVertex(v[i][k+1]);pushVertex(v[i+1][k]);pushVertex(v[i][k])}else{pushVertex(v[i][k+1]);pushVertex(v[i+1][k+1]);pushVertex(v[i+1][k])}}}}function appplyRadius(radius){for(var vertex=new Vector3,i=0;i<vertexBuffer.length;i+=3){vertex.x=vertexBuffer[i+0];vertex.y=vertexBuffer[i+1];vertex.z=vertexBuffer[i+2];vertex.normalize().multiplyScalar(radius);vertexBuffer[i+0]=vertex.x;vertexBuffer[i+1]=vertex.y;vertexBuffer[i+2]=vertex.z}}function correctSeam(){for(var i=0;i<uvBuffer.length;i+=6){var x0=uvBuffer[i+0],x1=uvBuffer[i+2],x2=uvBuffer[i+4],max=_Mathmax(x0,x1,x2),min=_Mathmin(x0,x1,x2);if(.9<max&&.1>min){if(.2>x0)uvBuffer[i+0]+=1;if(.2>x1)uvBuffer[i+2]+=1;if(.2>x2)uvBuffer[i+4]+=1}}}function pushVertex(vertex){vertexBuffer.push(vertex.x,vertex.y,vertex.z)}function getVertexByIndex(index,vertex){var stride=3*index;vertex.x=vertices[stride+0];vertex.y=vertices[stride+1];vertex.z=vertices[stride+2]}function correctUVs(){for(var a=new Vector3,b=new Vector3,c=new Vector3,centroid=new Vector3,uvA=new Vector2,uvB=new Vector2,uvC=new Vector2,i=0,j=0;i<vertexBuffer.length;i+=9,j+=6){a.set(vertexBuffer[i+0],vertexBuffer[i+1],vertexBuffer[i+2]);b.set(vertexBuffer[i+3],vertexBuffer[i+4],vertexBuffer[i+5]);c.set(vertexBuffer[i+6],vertexBuffer[i+7],vertexBuffer[i+8]);uvA.set(uvBuffer[j+0],uvBuffer[j+1]);uvB.set(uvBuffer[j+2],uvBuffer[j+3]);uvC.set(uvBuffer[j+4],uvBuffer[j+5]);centroid.copy(a).add(b).add(c).divideScalar(3);var azi=azimuth(centroid);correctUV(uvA,j+0,a,azi);correctUV(uvB,j+2,b,azi);correctUV(uvC,j+4,c,azi)}}function correctUV(uv,stride,vector,azimuth){if(0>azimuth&&1===uv.x){uvBuffer[stride]=uv.x-1}if(0===vector.x&&0===vector.z){uvBuffer[stride]=azimuth/2/_MathPI+.5}}function azimuth(vector){return _Mathatan(vector.z,-vector.x)}function inclination(vector){return _Mathatan(-vector.y,_Mathsqrt(vector.x*vector.x+vector.z*vector.z))}}PolyhedronBufferGeometry.prototype=Object.create(BufferGeometry.prototype);PolyhedronBufferGeometry.prototype.constructor=PolyhedronBufferGeometry;function TetrahedronGeometry(radius,detail){Geometry.call(this);this.type="TetrahedronGeometry";this.parameters={radius:radius,detail:detail};this.fromBufferGeometry(new TetrahedronBufferGeometry(radius,detail));this.mergeVertices()}TetrahedronGeometry.prototype=Object.create(Geometry.prototype);TetrahedronGeometry.prototype.constructor=TetrahedronGeometry;function TetrahedronBufferGeometry(radius,detail){PolyhedronBufferGeometry.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],radius,detail);this.type="TetrahedronBufferGeometry";this.parameters={radius:radius,detail:detail}}TetrahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);TetrahedronBufferGeometry.prototype.constructor=TetrahedronBufferGeometry;function OctahedronGeometry(radius,detail){Geometry.call(this);this.type="OctahedronGeometry";this.parameters={radius:radius,detail:detail};this.fromBufferGeometry(new OctahedronBufferGeometry(radius,detail));this.mergeVertices()}OctahedronGeometry.prototype=Object.create(Geometry.prototype);OctahedronGeometry.prototype.constructor=OctahedronGeometry;function OctahedronBufferGeometry(radius,detail){PolyhedronBufferGeometry.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],radius,detail);this.type="OctahedronBufferGeometry";this.parameters={radius:radius,detail:detail}}OctahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);OctahedronBufferGeometry.prototype.constructor=OctahedronBufferGeometry;function IcosahedronGeometry(radius,detail){Geometry.call(this);this.type="IcosahedronGeometry";this.parameters={radius:radius,detail:detail};this.fromBufferGeometry(new IcosahedronBufferGeometry(radius,detail));this.mergeVertices()}IcosahedronGeometry.prototype=Object.create(Geometry.prototype);IcosahedronGeometry.prototype.constructor=IcosahedronGeometry;function IcosahedronBufferGeometry(radius,detail){var t=(1+2.23606797749979)/2;PolyhedronBufferGeometry.call(this,[-1,t,0,1,t,0,-1,-t,0,1,-t,0,0,-1,t,0,1,t,0,-1,-t,0,1,-t,t,0,-1,t,0,1,-t,0,-1,-t,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],radius,detail);this.type="IcosahedronBufferGeometry";this.parameters={radius:radius,detail:detail}}IcosahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);IcosahedronBufferGeometry.prototype.constructor=IcosahedronBufferGeometry;function DodecahedronGeometry(radius,detail){Geometry.call(this);this.type="DodecahedronGeometry";this.parameters={radius:radius,detail:detail};this.fromBufferGeometry(new DodecahedronBufferGeometry(radius,detail));this.mergeVertices()}DodecahedronGeometry.prototype=Object.create(Geometry.prototype);DodecahedronGeometry.prototype.constructor=DodecahedronGeometry;function DodecahedronBufferGeometry(radius,detail){var t=(1+2.23606797749979)/2,r=1/t;PolyhedronBufferGeometry.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-r,-t,0,-r,t,0,r,-t,0,r,t,-r,-t,0,-r,t,0,r,-t,0,r,t,0,-t,0,-r,t,0,-r,-t,0,r,t,0,r],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],radius,detail);this.type="DodecahedronBufferGeometry";this.parameters={radius:radius,detail:detail}}DodecahedronBufferGeometry.prototype=Object.create(PolyhedronBufferGeometry.prototype);DodecahedronBufferGeometry.prototype.constructor=DodecahedronBufferGeometry;function TubeGeometry(path,tubularSegments,radius,radialSegments,closed,taper){Geometry.call(this);this.type="TubeGeometry";this.parameters={path:path,tubularSegments:tubularSegments,radius:radius,radialSegments:radialSegments,closed:closed};if(taper!==void 0)console.warn("THREE.TubeGeometry: taper has been removed.");var bufferGeometry=new TubeBufferGeometry(path,tubularSegments,radius,radialSegments,closed);this.tangents=bufferGeometry.tangents;this.normals=bufferGeometry.normals;this.binormals=bufferGeometry.binormals;this.fromBufferGeometry(bufferGeometry);this.mergeVertices()}TubeGeometry.prototype=Object.create(Geometry.prototype);TubeGeometry.prototype.constructor=TubeGeometry;function TubeBufferGeometry(path,tubularSegments,radius,radialSegments,closed){BufferGeometry.call(this);this.type="TubeBufferGeometry";this.parameters={path:path,tubularSegments:tubularSegments,radius:radius,radialSegments:radialSegments,closed:closed};tubularSegments=tubularSegments||64;radius=radius||1;radialSegments=radialSegments||8;closed=closed||!1;var frames=path.computeFrenetFrames(tubularSegments,closed);this.tangents=frames.tangents;this.normals=frames.normals;this.binormals=frames.binormals;var vertex=new Vector3,normal=new Vector3,uv=new Vector2,P=new Vector3,i,j,vertices=[],normals=[],uvs=[],indices=[];generateBufferData();this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("normal",new Float32BufferAttribute(normals,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2));function generateBufferData(){for(i=0;i<tubularSegments;i++){generateSegment(i)}generateSegment(!1===closed?tubularSegments:0);generateUVs();generateIndices()}function generateSegment(i){P=path.getPointAt(i/tubularSegments,P);var N=frames.normals[i],B=frames.binormals[i];for(j=0;j<=radialSegments;j++){var v=2*(j/radialSegments*_MathPI),sin=_Mathsin(v),cos=-_Mathcos(v);normal.x=cos*N.x+sin*B.x;normal.y=cos*N.y+sin*B.y;normal.z=cos*N.z+sin*B.z;normal.normalize();normals.push(normal.x,normal.y,normal.z);vertex.x=P.x+radius*normal.x;vertex.y=P.y+radius*normal.y;vertex.z=P.z+radius*normal.z;vertices.push(vertex.x,vertex.y,vertex.z)}}function generateIndices(){for(j=1;j<=tubularSegments;j++){for(i=1;i<=radialSegments;i++){var a=(radialSegments+1)*(j-1)+(i-1),b=(radialSegments+1)*j+(i-1),c=(radialSegments+1)*j+i,d=(radialSegments+1)*(j-1)+i;indices.push(a,b,d);indices.push(b,c,d)}}}function generateUVs(){for(i=0;i<=tubularSegments;i++){for(j=0;j<=radialSegments;j++){uv.x=i/tubularSegments;uv.y=j/radialSegments;uvs.push(uv.x,uv.y)}}}}TubeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TubeBufferGeometry.prototype.constructor=TubeBufferGeometry;function TorusKnotGeometry(radius,tube,tubularSegments,radialSegments,p,q,heightScale){Geometry.call(this);this.type="TorusKnotGeometry";this.parameters={radius:radius,tube:tube,tubularSegments:tubularSegments,radialSegments:radialSegments,p:p,q:q};if(heightScale!==void 0)console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead.");this.fromBufferGeometry(new TorusKnotBufferGeometry(radius,tube,tubularSegments,radialSegments,p,q));this.mergeVertices()}TorusKnotGeometry.prototype=Object.create(Geometry.prototype);TorusKnotGeometry.prototype.constructor=TorusKnotGeometry;function TorusKnotBufferGeometry(radius,tube,tubularSegments,radialSegments,p,q){BufferGeometry.call(this);this.type="TorusKnotBufferGeometry";this.parameters={radius:radius,tube:tube,tubularSegments:tubularSegments,radialSegments:radialSegments,p:p,q:q};radius=radius||1;tube=tube||.4;tubularSegments=_Mathfloor(tubularSegments)||64;radialSegments=_Mathfloor(radialSegments)||8;p=p||2;q=q||3;var indices=[],vertices=[],normals=[],uvs=[],i,j,vertex=new Vector3,normal=new Vector3,P1=new Vector3,P2=new Vector3,B=new Vector3,T=new Vector3,N=new Vector3;for(i=0;i<=tubularSegments;++i){var u=2*(i/tubularSegments*p*_MathPI);calculatePositionOnCurve(u,p,q,radius,P1);calculatePositionOnCurve(u+.01,p,q,radius,P2);T.subVectors(P2,P1);N.addVectors(P2,P1);B.crossVectors(T,N);N.crossVectors(B,T);B.normalize();N.normalize();for(j=0;j<=radialSegments;++j){var v=2*(j/radialSegments*_MathPI),cx=-tube*_Mathcos(v),cy=tube*_Mathsin(v);vertex.x=P1.x+(cx*N.x+cy*B.x);vertex.y=P1.y+(cx*N.y+cy*B.y);vertex.z=P1.z+(cx*N.z+cy*B.z);vertices.push(vertex.x,vertex.y,vertex.z);normal.subVectors(vertex,P1).normalize();normals.push(normal.x,normal.y,normal.z);uvs.push(i/tubularSegments);uvs.push(j/radialSegments)}}for(j=1;j<=tubularSegments;j++){for(i=1;i<=radialSegments;i++){var a=(radialSegments+1)*(j-1)+(i-1),b=(radialSegments+1)*j+(i-1),c=(radialSegments+1)*j+i,d=(radialSegments+1)*(j-1)+i;indices.push(a,b,d);indices.push(b,c,d)}}this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("normal",new Float32BufferAttribute(normals,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2));function calculatePositionOnCurve(u,p,q,radius,position){var cu=_Mathcos(u),su=_Mathsin(u),quOverP=q/p*u,cs=_Mathcos(quOverP);position.x=.5*(radius*(2+cs))*cu;position.y=.5*(radius*(2+cs)*su);position.z=.5*(radius*_Mathsin(quOverP))}}TorusKnotBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TorusKnotBufferGeometry.prototype.constructor=TorusKnotBufferGeometry;function TorusGeometry(radius,tube,radialSegments,tubularSegments,arc){Geometry.call(this);this.type="TorusGeometry";this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc};this.fromBufferGeometry(new TorusBufferGeometry(radius,tube,radialSegments,tubularSegments,arc));this.mergeVertices()}TorusGeometry.prototype=Object.create(Geometry.prototype);TorusGeometry.prototype.constructor=TorusGeometry;function TorusBufferGeometry(radius,tube,radialSegments,tubularSegments,arc){BufferGeometry.call(this);this.type="TorusBufferGeometry";this.parameters={radius:radius,tube:tube,radialSegments:radialSegments,tubularSegments:tubularSegments,arc:arc};radius=radius||1;tube=tube||.4;radialSegments=_Mathfloor(radialSegments)||8;tubularSegments=_Mathfloor(tubularSegments)||6;arc=arc||2*_MathPI;var indices=[],vertices=[],normals=[],uvs=[],center=new Vector3,vertex=new Vector3,normal=new Vector3,j,i;for(j=0;j<=radialSegments;j++){for(i=0;i<=tubularSegments;i++){var u=i/tubularSegments*arc,v=2*(j/radialSegments*_MathPI);vertex.x=(radius+tube*_Mathcos(v))*_Mathcos(u);vertex.y=(radius+tube*_Mathcos(v))*_Mathsin(u);vertex.z=tube*_Mathsin(v);vertices.push(vertex.x,vertex.y,vertex.z);center.x=radius*_Mathcos(u);center.y=radius*_Mathsin(u);normal.subVectors(vertex,center).normalize();normals.push(normal.x,normal.y,normal.z);uvs.push(i/tubularSegments);uvs.push(j/radialSegments)}}for(j=1;j<=radialSegments;j++){for(i=1;i<=tubularSegments;i++){var a=(tubularSegments+1)*j+i-1,b=(tubularSegments+1)*(j-1)+i-1,c=(tubularSegments+1)*(j-1)+i,d=(tubularSegments+1)*j+i;indices.push(a,b,d);indices.push(b,c,d)}}this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("normal",new Float32BufferAttribute(normals,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}TorusBufferGeometry.prototype=Object.create(BufferGeometry.prototype);TorusBufferGeometry.prototype.constructor=TorusBufferGeometry;var Earcut={triangulate:function triangulate(data,holeIndices,dim){dim=dim||2;var hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode)return triangles;var minX,minY,maxX,maxY,x,y,invSize;if(hasHoles)outerNode=eliminateHoles(data,holeIndices,outerNode,dim);if(data.length>80*dim){minX=maxX=data[0];minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim){x=data[i];y=data[i+1];if(x<minX)minX=x;if(y<minY)minY=y;if(x>maxX)maxX=x;if(y>maxY)maxY=y}invSize=_Mathmax(maxX-minX,maxY-minY);invSize=0!==invSize?1/invSize:0}earcutLinked(outerNode,triangles,dim,minX,minY,invSize);return triangles}};function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===0<signedArea(data,start,end,dim)){for(i=start;i<end;i+=dim){last=insertNode(i,data[i],data[i+1],last)}}else{for(i=end-dim;i>=start;i-=dim){last=insertNode(i,data[i],data[i+1],last)}}if(last&&equals(last,last.next)){removeNode(last);last=last.next}return last}function filterPoints(start,end){if(!start)return start;if(!end)end=start;var p=start,again;do{again=!1;if(!p.steiner&&(equals(p,p.next)||0===area(p.prev,p,p.next))){removeNode(p);p=end=p.prev;if(p===p.next)break;again=!0}else{p=p.next}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(!ear)return;if(!pass&&invSize)indexCurve(ear,minX,minY,invSize);var stop=ear,prev,next;while(ear.prev!==ear.next){prev=ear.prev;next=ear.next;if(invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear)){triangles.push(prev.i/dim);triangles.push(ear.i/dim);triangles.push(next.i/dim);removeNode(ear);ear=next.next;stop=next.next;continue}ear=next;if(ear===stop){if(!pass){earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1)}else if(1===pass){ear=cureLocalIntersections(ear,triangles,dim);earcutLinked(ear,triangles,dim,minX,minY,invSize,2)}else if(2===pass){splitEarcut(ear,triangles,dim,minX,minY,invSize)}break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(0<=area(a,b,c))return!1;var p=ear.next.next;while(p!==ear.prev){if(pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&0<=area(p.prev,p,p.next)){return!1}p=p.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(0<=area(a,b,c))return!1;var minTX=a.x<b.x?a.x<c.x?a.x:c.x:b.x<c.x?b.x:c.x,minTY=a.y<b.y?a.y<c.y?a.y:c.y:b.y<c.y?b.y:c.y,maxTX=a.x>b.x?a.x>c.x?a.x:c.x:b.x>c.x?b.x:c.x,maxTY=a.y>b.y?a.y>c.y?a.y:c.y:b.y>c.y?b.y:c.y,minZ=zOrder(minTX,minTY,minX,minY,invSize),maxZ=zOrder(maxTX,maxTY,minX,minY,invSize),p=ear.nextZ;while(p&&p.z<=maxZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.nextZ}p=ear.prevZ;while(p&&p.z>=minZ){if(p!==ear.prev&&p!==ear.next&&pointInTriangle(a.x,a.y,b.x,b.y,c.x,c.y,p.x,p.y)&&0<=area(p.prev,p,p.next))return!1;p=p.prevZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;if(!equals(a,b)&&intersects(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)){triangles.push(a.i/dim);triangles.push(p.i/dim);triangles.push(b.i/dim);removeNode(p);removeNode(p.next);p=start=b}p=p.next}while(p!==start);return p}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{var b=a.next.next;while(b!==a.prev){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);a=filterPoints(a,a.next);c=filterPoints(c,c.next);earcutLinked(a,triangles,dim,minX,minY,invSize);earcutLinked(c,triangles,dim,minX,minY,invSize);return}b=b.next}a=a.next}while(a!==start)}function eliminateHoles(data,holeIndices,outerNode,dim){var queue=[],i,len,start,end,list;for(i=0,len=holeIndices.length;i<len;i++){start=holeIndices[i]*dim;end=i<len-1?holeIndices[i+1]*dim:data.length;list=linkedList(data,start,end,dim,!1);if(list===list.next)list.steiner=!0;queue.push(getLeftmost(list))}queue.sort(compareX);for(i=0;i<queue.length;i++){eliminateHole(queue[i],outerNode);outerNode=filterPoints(outerNode,outerNode.next)}return outerNode}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){outerNode=findHoleBridge(hole,outerNode);if(outerNode){var b=splitPolygon(outerNode,hole);filterPoints(b,b.next)}}function findHoleBridge(hole,outerNode){var p=outerNode,hx=hole.x,hy=hole.y,qx=-Infinity,m;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx){qx=x;if(x===hx){if(hy===p.y)return p;if(hy===p.next.y)return p.next}m=p.x<p.next.x?p:p.next}}p=p.next}while(p!==outerNode);if(!m)return null;if(hx===qx)return m.prev;var stop=m,mx=m.x,my=m.y,tanMin=1/0,tan;p=m.next;while(p!==stop){if(hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)){tan=_Mathabs(hy-p.y)/(hx-p.x);if((tan<tanMin||tan===tanMin&&p.x>m.x)&&locallyInside(p,hole)){m=p;tanMin=tan}}p=p.next}return m}function indexCurve(start,minX,minY,invSize){var p=start;do{if(null===p.z)p.z=zOrder(p.x,p.y,minX,minY,invSize);p.prevZ=p.prev;p.nextZ=p.next;p=p.next}while(p!==start);p.prevZ.nextZ=null;p.prevZ=null;sortLinked(p)}function sortLinked(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{p=list;list=null;tail=null;numMerges=0;while(p){numMerges++;q=p;pSize=0;for(i=0;i<inSize;i++){pSize++;q=q.nextZ;if(!q)break}qSize=inSize;while(0<pSize||0<qSize&&q){if(0!==pSize&&(0===qSize||!q||p.z<=q.z)){e=p;p=p.nextZ;pSize--}else{e=q;q=q.nextZ;qSize--}if(tail)tail.nextZ=e;else list=e;e.prevZ=tail;tail=e}p=q}tail.nextZ=null;inSize*=2}while(1<numMerges);return list}function zOrder(x,y,minX,minY,invSize){x=32767*(x-minX)*invSize;y=32767*(y-minY)*invSize;x=16711935&(x|x<<8);x=252645135&(x|x<<4);x=858993459&(x|x<<2);x=1431655765&(x|x<<1);y=16711935&(y|y<<8);y=252645135&(y|y<<4);y=858993459&(y|y<<2);y=1431655765&(y|y<<1);return x|y<<1}function getLeftmost(start){var p=start,leftmost=start;do{if(p.x<leftmost.x)leftmost=p;p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return 0<=(cx-px)*(ay-py)-(ax-px)*(cy-py)&&0<=(ax-px)*(by-py)-(bx-px)*(ay-py)&&0<=(bx-px)*(cy-py)-(cx-px)*(by-py)}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!intersectsPolygon(a,b)&&locallyInside(a,b)&&locallyInside(b,a)&&middleInside(a,b)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects(p1,q1,p2,q2){if(equals(p1,q1)&&equals(p2,q2)||equals(p1,q2)&&equals(p2,q1))return!0;return 0<area(p1,q1,p2)!==0<area(p1,q1,q2)&&0<area(p2,q2,p1)!==0<area(p2,q2,q1)}function intersectsPolygon(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects(p,p.next,a,b)){return!0}p=p.next}while(p!==a);return!1}function locallyInside(a,b){return 0>area(a.prev,a,a.next)?0<=area(a,b,a.next)&&0<=area(a,a.prev,b):0>area(a,b,a.prev)||0>area(a,a.next,b)}function middleInside(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{if(p.y>py!==p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x){inside=!inside}p=p.next}while(p!==a);return inside}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;a.next=b;b.prev=a;a2.next=an;an.prev=a2;b2.next=a2;a2.prev=b2;bp.next=b2;b2.prev=bp;return b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);if(!last){p.prev=p;p.next=p}else{p.next=last.next;p.prev=last;last.next.prev=p;last.next=p}return p}function removeNode(p){p.next.prev=p.prev;p.prev.next=p.next;if(p.prevZ)p.prevZ.nextZ=p.nextZ;if(p.nextZ)p.nextZ.prevZ=p.prevZ}function Node(i,x,y){this.i=i;this.x=x;this.y=y;this.prev=null;this.next=null;this.z=null;this.prevZ=null;this.nextZ=null;this.steiner=!1}function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim){sum+=(data[j]-data[i])*(data[i+1]+data[j+1]);j=i}return sum}var ShapeUtils={area:function(contour){for(var n=contour.length,a=0,p=n-1,q=0;q<n;p=q++){a+=contour[p].x*contour[q].y-contour[q].x*contour[p].y}return .5*a},isClockWise:function isClockWise(pts){return 0>ShapeUtils.area(pts)},triangulateShape:function triangulateShape(contour,holes){var vertices=[],holeIndices=[],faces=[];removeDupEndPts(contour);addContour(vertices,contour);var holeIndex=contour.length;holes.forEach(removeDupEndPts);for(var i=0;i<holes.length;i++){holeIndices.push(holeIndex);holeIndex+=holes[i].length;addContour(vertices,holes[i])}for(var triangles=Earcut.triangulate(vertices,holeIndices),i=0;i<triangles.length;i+=3){faces.push(triangles.slice(i,i+3))}return faces}};function removeDupEndPts(points){var l=points.length;if(2<l&&points[l-1].equals(points[0])){points.pop()}}function addContour(vertices,contour){for(var i=0;i<contour.length;i++){vertices.push(contour[i].x);vertices.push(contour[i].y)}}function ExtrudeGeometry(shapes,options){Geometry.call(this);this.type="ExtrudeGeometry";this.parameters={shapes:shapes,options:options};this.fromBufferGeometry(new ExtrudeBufferGeometry(shapes,options));this.mergeVertices()}ExtrudeGeometry.prototype=Object.create(Geometry.prototype);ExtrudeGeometry.prototype.constructor=ExtrudeGeometry;function ExtrudeBufferGeometry(shapes,options){if("undefined"===typeof shapes){return}BufferGeometry.call(this);this.type="ExtrudeBufferGeometry";shapes=Array.isArray(shapes)?shapes:[shapes];this.addShapeList(shapes,options);this.computeVertexNormals()}ExtrudeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ExtrudeBufferGeometry.prototype.constructor=ExtrudeBufferGeometry;ExtrudeBufferGeometry.prototype.getArrays=function(){var positionAttribute=this.getAttribute("position"),verticesArray=positionAttribute?Array.prototype.slice.call(positionAttribute.array):[],uvAttribute=this.getAttribute("uv"),uvArray=uvAttribute?Array.prototype.slice.call(uvAttribute.array):[],IndexAttribute=this.index,indicesArray=IndexAttribute?Array.prototype.slice.call(IndexAttribute.array):[];return{position:verticesArray,uv:uvArray,index:indicesArray}};ExtrudeBufferGeometry.prototype.addShapeList=function(shapes,options){var sl=shapes.length;options.arrays=this.getArrays();for(var s=0,shape;s<sl;s++){shape=shapes[s];this.addShape(shape,options)}this.setIndex(options.arrays.index);this.addAttribute("position",new Float32BufferAttribute(options.arrays.position,3));this.addAttribute("uv",new Float32BufferAttribute(options.arrays.uv,2))};ExtrudeBufferGeometry.prototype.addShape=function(shape,options){var arrays=options.arrays?options.arrays:this.getArrays(),verticesArray=arrays.position,indicesArray=arrays.index,uvArray=arrays.uv,placeholder=[],amount=options.amount!==void 0?options.amount:100,bevelThickness=options.bevelThickness!==void 0?options.bevelThickness:6,bevelSize=options.bevelSize!==void 0?options.bevelSize:bevelThickness-2,bevelSegments=options.bevelSegments!==void 0?options.bevelSegments:3,bevelEnabled=options.bevelEnabled!==void 0?options.bevelEnabled:!0,curveSegments=options.curveSegments!==void 0?options.curveSegments:12,steps=options.steps!==void 0?options.steps:1,extrudePath=options.extrudePath,extrudePts,extrudeByPath=!1,uvgen=options.UVGenerator!==void 0?options.UVGenerator:ExtrudeGeometry.WorldUVGenerator,splineTube,binormal,normal,position2;if(extrudePath){extrudePts=extrudePath.getSpacedPoints(steps);extrudeByPath=!0;bevelEnabled=!1;splineTube=options.frames!==void 0?options.frames:extrudePath.computeFrenetFrames(steps,!1);binormal=new Vector3;normal=new Vector3;position2=new Vector3}if(!bevelEnabled){bevelSegments=0;bevelThickness=0;bevelSize=0}var ahole,h,hl,scope=this,shapePoints=shape.extractPoints(curveSegments),vertices=shapePoints.shape,holes=shapePoints.holes,reverse=!ShapeUtils.isClockWise(vertices);if(reverse){vertices=vertices.reverse();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];if(ShapeUtils.isClockWise(ahole)){holes[h]=ahole.reverse()}}}var faces=ShapeUtils.triangulateShape(vertices,holes),contour=vertices;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];vertices=vertices.concat(ahole)}function scalePt2(pt,vec,size){if(!vec)console.error("THREE.ExtrudeGeometry: vec does not exist");return vec.clone().multiplyScalar(size).add(pt)}var b,bs,t,z,vert,vlen=vertices.length,face,flen=faces.length;function getBevelVec(inPt,inPrev,inNext){var v_trans_x,v_trans_y,shrink_by,v_prev_x=inPt.x-inPrev.x,v_prev_y=inPt.y-inPrev.y,v_next_x=inNext.x-inPt.x,v_next_y=inNext.y-inPt.y,v_prev_lensq=v_prev_x*v_prev_x+v_prev_y*v_prev_y;if(_Mathabs(v_prev_x*v_next_y-v_prev_y*v_next_x)>_NumberEPSILON){var v_prev_len=_Mathsqrt(v_prev_lensq),v_next_len=_Mathsqrt(v_next_x*v_next_x+v_next_y*v_next_y),ptPrevShift_x=inPrev.x-v_prev_y/v_prev_len,ptPrevShift_y=inPrev.y+v_prev_x/v_prev_len,ptNextShift_x=inNext.x-v_next_y/v_next_len,ptNextShift_y=inNext.y+v_next_x/v_next_len,sf=((ptNextShift_x-ptPrevShift_x)*v_next_y-(ptNextShift_y-ptPrevShift_y)*v_next_x)/(v_prev_x*v_next_y-v_prev_y*v_next_x);v_trans_x=ptPrevShift_x+v_prev_x*sf-inPt.x;v_trans_y=ptPrevShift_y+v_prev_y*sf-inPt.y;var v_trans_lensq=v_trans_x*v_trans_x+v_trans_y*v_trans_y;if(2>=v_trans_lensq){return new Vector2(v_trans_x,v_trans_y)}else{shrink_by=_Mathsqrt(v_trans_lensq/2)}}else{var direction_eq=!1;if(v_prev_x>_NumberEPSILON){if(v_next_x>_NumberEPSILON){direction_eq=!0}}else{if(v_prev_x<-_NumberEPSILON){if(v_next_x<-_NumberEPSILON){direction_eq=!0}}else{if(_Mathsign(v_prev_y)===_Mathsign(v_next_y)){direction_eq=!0}}}if(direction_eq){v_trans_x=-v_prev_y;v_trans_y=v_prev_x;shrink_by=_Mathsqrt(v_prev_lensq)}else{v_trans_x=v_prev_x;v_trans_y=v_prev_y;shrink_by=_Mathsqrt(v_prev_lensq/2)}}return new Vector2(v_trans_x/shrink_by,v_trans_y/shrink_by)}for(var contourMovements=[],i=0,il=contour.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;contourMovements[i]=getBevelVec(contour[i],contour[j],contour[k])}var holesMovements=[],oneHoleMovements,verticesMovements=contourMovements.concat();for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=[];for(i=0,il=ahole.length,j=il-1,k=i+1;i<il;i++,j++,k++){if(j===il)j=0;if(k===il)k=0;oneHoleMovements[i]=getBevelVec(ahole[i],ahole[j],ahole[k])}holesMovements.push(oneHoleMovements);verticesMovements=verticesMovements.concat(oneHoleMovements)}for(b=0;b<bevelSegments;b++){t=b/bevelSegments;z=bevelThickness*_Mathcos(t*_MathPI/2);bs=bevelSize*_Mathsin(t*_MathPI/2);for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,-z)}for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);v(vert.x,vert.y,-z)}}}bs=bevelSize;for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,0)}else{normal.copy(splineTube.normals[0]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[0]).multiplyScalar(vert.y);position2.copy(extrudePts[0]).add(normal).add(binormal);v(position2.x,position2.y,position2.z)}}var s;for(s=1;s<=steps;s++){for(i=0;i<vlen;i++){vert=bevelEnabled?scalePt2(vertices[i],verticesMovements[i],bs):vertices[i];if(!extrudeByPath){v(vert.x,vert.y,amount/steps*s)}else{normal.copy(splineTube.normals[s]).multiplyScalar(vert.x);binormal.copy(splineTube.binormals[s]).multiplyScalar(vert.y);position2.copy(extrudePts[s]).add(normal).add(binormal);v(position2.x,position2.y,position2.z)}}}for(b=bevelSegments-1;0<=b;b--){t=b/bevelSegments;z=bevelThickness*_Mathcos(t*_MathPI/2);bs=bevelSize*_Mathsin(t*_MathPI/2);for(i=0,il=contour.length;i<il;i++){vert=scalePt2(contour[i],contourMovements[i],bs);v(vert.x,vert.y,amount+z)}for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];oneHoleMovements=holesMovements[h];for(i=0,il=ahole.length;i<il;i++){vert=scalePt2(ahole[i],oneHoleMovements[i],bs);if(!extrudeByPath){v(vert.x,vert.y,amount+z)}else{v(vert.x,vert.y+extrudePts[steps-1].y,extrudePts[steps-1].x+z)}}}}buildLidFaces();buildSideFaces();function buildLidFaces(){var start=verticesArray.length/3;if(bevelEnabled){var layer=0,offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[2]+offset,face[1]+offset,face[0]+offset)}layer=steps+2*bevelSegments;offset=vlen*layer;for(i=0;i<flen;i++){face=faces[i];f3(face[0]+offset,face[1]+offset,face[2]+offset)}}else{for(i=0;i<flen;i++){face=faces[i];f3(face[2],face[1],face[0])}for(i=0;i<flen;i++){face=faces[i];f3(face[0]+vlen*steps,face[1]+vlen*steps,face[2]+vlen*steps)}}scope.addGroup(start,verticesArray.length/3-start,options.material!==void 0?options.material:0)}function buildSideFaces(){var start=verticesArray.length/3,layeroffset=0;sidewalls(contour,layeroffset);layeroffset+=contour.length;for(h=0,hl=holes.length;h<hl;h++){ahole=holes[h];sidewalls(ahole,layeroffset);layeroffset+=ahole.length}scope.addGroup(start,verticesArray.length/3-start,options.extrudeMaterial!==void 0?options.extrudeMaterial:1)}function sidewalls(contour,layeroffset){var j,k;i=contour.length;while(0<=--i){j=i;k=i-1;if(0>k)k=contour.length-1;var s=0,sl=steps+2*bevelSegments;for(s=0;s<sl;s++){var slen1=vlen*s,slen2=vlen*(s+1),a=layeroffset+j+slen1,b=layeroffset+k+slen1,c=layeroffset+k+slen2,d=layeroffset+j+slen2;f4(a,b,c,d)}}}function v(x,y,z){placeholder.push(x);placeholder.push(y);placeholder.push(z)}function f3(a,b,c){addVertex(a);addVertex(b);addVertex(c);var nextIndex=verticesArray.length/3,uvs=uvgen.generateTopUV(scope,verticesArray,nextIndex-3,nextIndex-2,nextIndex-1);addUV(uvs[0]);addUV(uvs[1]);addUV(uvs[2])}function f4(a,b,c,d){addVertex(a);addVertex(b);addVertex(d);addVertex(b);addVertex(c);addVertex(d);var nextIndex=verticesArray.length/3,uvs=uvgen.generateSideWallUV(scope,verticesArray,nextIndex-6,nextIndex-3,nextIndex-2,nextIndex-1);addUV(uvs[0]);addUV(uvs[1]);addUV(uvs[3]);addUV(uvs[1]);addUV(uvs[2]);addUV(uvs[3])}function addVertex(index){indicesArray.push(verticesArray.length/3);verticesArray.push(placeholder[3*index+0]);verticesArray.push(placeholder[3*index+1]);verticesArray.push(placeholder[3*index+2])}function addUV(vector2){uvArray.push(vector2.x);uvArray.push(vector2.y)}if(!options.arrays){this.setIndex(indicesArray);this.addAttribute("position",new Float32BufferAttribute(verticesArray,3));this.addAttribute("uv",new Float32BufferAttribute(uvArray,2))}};ExtrudeGeometry.WorldUVGenerator={generateTopUV:function generateTopUV(geometry,vertices,indexA,indexB,indexC){var a_x=vertices[3*indexA],a_y=vertices[3*indexA+1],b_x=vertices[3*indexB],b_y=vertices[3*indexB+1],c_x=vertices[3*indexC],c_y=vertices[3*indexC+1];return[new Vector2(a_x,a_y),new Vector2(b_x,b_y),new Vector2(c_x,c_y)]},generateSideWallUV:function generateSideWallUV(geometry,vertices,indexA,indexB,indexC,indexD){var a_x=vertices[3*indexA],a_y=vertices[3*indexA+1],a_z=vertices[3*indexA+2],b_x=vertices[3*indexB],b_y=vertices[3*indexB+1],b_z=vertices[3*indexB+2],c_x=vertices[3*indexC],c_y=vertices[3*indexC+1],c_z=vertices[3*indexC+2],d_x=vertices[3*indexD],d_y=vertices[3*indexD+1],d_z=vertices[3*indexD+2];if(.01>_Mathabs(a_y-b_y)){return[new Vector2(a_x,1-a_z),new Vector2(b_x,1-b_z),new Vector2(c_x,1-c_z),new Vector2(d_x,1-d_z)]}else{return[new Vector2(a_y,1-a_z),new Vector2(b_y,1-b_z),new Vector2(c_y,1-c_z),new Vector2(d_y,1-d_z)]}}};function TextGeometry(text,parameters){Geometry.call(this);this.type="TextGeometry";this.parameters={text:text,parameters:parameters};this.fromBufferGeometry(new TextBufferGeometry(text,parameters));this.mergeVertices()}TextGeometry.prototype=Object.create(Geometry.prototype);TextGeometry.prototype.constructor=TextGeometry;function TextBufferGeometry(text,parameters){parameters=parameters||{};var font=parameters.font;if(!(font&&font.isFont)){console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font.");return new Geometry}var shapes=font.generateShapes(text,parameters.size,parameters.curveSegments);parameters.amount=parameters.height!==void 0?parameters.height:50;if(parameters.bevelThickness===void 0)parameters.bevelThickness=10;if(parameters.bevelSize===void 0)parameters.bevelSize=8;if(parameters.bevelEnabled===void 0)parameters.bevelEnabled=!1;ExtrudeBufferGeometry.call(this,shapes,parameters);this.type="TextBufferGeometry"}TextBufferGeometry.prototype=Object.create(ExtrudeBufferGeometry.prototype);TextBufferGeometry.prototype.constructor=TextBufferGeometry;function SphereGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){Geometry.call(this);this.type="SphereGeometry";this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength};this.fromBufferGeometry(new SphereBufferGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength));this.mergeVertices()}SphereGeometry.prototype=Object.create(Geometry.prototype);SphereGeometry.prototype.constructor=SphereGeometry;function SphereBufferGeometry(radius,widthSegments,heightSegments,phiStart,phiLength,thetaStart,thetaLength){BufferGeometry.call(this);this.type="SphereBufferGeometry";this.parameters={radius:radius,widthSegments:widthSegments,heightSegments:heightSegments,phiStart:phiStart,phiLength:phiLength,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||1;widthSegments=_Mathmax(3,_Mathfloor(widthSegments)||8);heightSegments=_Mathmax(2,_Mathfloor(heightSegments)||6);phiStart=phiStart!==void 0?phiStart:0;phiLength=phiLength!==void 0?phiLength:2*_MathPI;thetaStart=thetaStart!==void 0?thetaStart:0;thetaLength=thetaLength!==void 0?thetaLength:_MathPI;var thetaEnd=thetaStart+thetaLength,ix,iy,index=0,grid=[],vertex=new Vector3,normal=new Vector3,indices=[],vertices=[],normals=[],uvs=[];for(iy=0;iy<=heightSegments;iy++){var verticesRow=[],v=iy/heightSegments;for(ix=0;ix<=widthSegments;ix++){var u=ix/widthSegments;vertex.x=-radius*_Mathcos(phiStart+u*phiLength)*_Mathsin(thetaStart+v*thetaLength);vertex.y=radius*_Mathcos(thetaStart+v*thetaLength);vertex.z=radius*_Mathsin(phiStart+u*phiLength)*_Mathsin(thetaStart+v*thetaLength);vertices.push(vertex.x,vertex.y,vertex.z);normal.set(vertex.x,vertex.y,vertex.z).normalize();normals.push(normal.x,normal.y,normal.z);uvs.push(u,1-v);verticesRow.push(index++)}grid.push(verticesRow)}for(iy=0;iy<heightSegments;iy++){for(ix=0;ix<widthSegments;ix++){var a=grid[iy][ix+1],b=grid[iy][ix],c=grid[iy+1][ix],d=grid[iy+1][ix+1];if(0!==iy||0<thetaStart)indices.push(a,b,d);if(iy!==heightSegments-1||thetaEnd<_MathPI)indices.push(b,c,d)}}this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("normal",new Float32BufferAttribute(normals,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}SphereBufferGeometry.prototype=Object.create(BufferGeometry.prototype);SphereBufferGeometry.prototype.constructor=SphereBufferGeometry;function RingGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){Geometry.call(this);this.type="RingGeometry";this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength};this.fromBufferGeometry(new RingBufferGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength));this.mergeVertices()}RingGeometry.prototype=Object.create(Geometry.prototype);RingGeometry.prototype.constructor=RingGeometry;function RingBufferGeometry(innerRadius,outerRadius,thetaSegments,phiSegments,thetaStart,thetaLength){BufferGeometry.call(this);this.type="RingBufferGeometry";this.parameters={innerRadius:innerRadius,outerRadius:outerRadius,thetaSegments:thetaSegments,phiSegments:phiSegments,thetaStart:thetaStart,thetaLength:thetaLength};innerRadius=innerRadius||.5;outerRadius=outerRadius||1;thetaStart=thetaStart!==void 0?thetaStart:0;thetaLength=thetaLength!==void 0?thetaLength:2*_MathPI;thetaSegments=thetaSegments!==void 0?_Mathmax(3,thetaSegments):8;phiSegments=phiSegments!==void 0?_Mathmax(1,phiSegments):1;var indices=[],vertices=[],normals=[],uvs=[],segment,radius=innerRadius,radiusStep=(outerRadius-innerRadius)/phiSegments,vertex=new Vector3,uv=new Vector2,j,i;for(j=0;j<=phiSegments;j++){for(i=0;i<=thetaSegments;i++){segment=thetaStart+i/thetaSegments*thetaLength;vertex.x=radius*_Mathcos(segment);vertex.y=radius*_Mathsin(segment);vertices.push(vertex.x,vertex.y,vertex.z);normals.push(0,0,1);uv.x=(vertex.x/outerRadius+1)/2;uv.y=(vertex.y/outerRadius+1)/2;uvs.push(uv.x,uv.y)}radius+=radiusStep}for(j=0;j<phiSegments;j++){var thetaSegmentLevel=j*(thetaSegments+1);for(i=0;i<thetaSegments;i++){segment=i+thetaSegmentLevel;var a=segment,b=segment+thetaSegments+1,c=segment+thetaSegments+2,d=segment+1;indices.push(a,b,d);indices.push(b,c,d)}}this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("normal",new Float32BufferAttribute(normals,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}RingBufferGeometry.prototype=Object.create(BufferGeometry.prototype);RingBufferGeometry.prototype.constructor=RingBufferGeometry;function LatheGeometry(points,segments,phiStart,phiLength){Geometry.call(this);this.type="LatheGeometry";this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength};this.fromBufferGeometry(new LatheBufferGeometry(points,segments,phiStart,phiLength));this.mergeVertices()}LatheGeometry.prototype=Object.create(Geometry.prototype);LatheGeometry.prototype.constructor=LatheGeometry;function LatheBufferGeometry(points,segments,phiStart,phiLength){BufferGeometry.call(this);this.type="LatheBufferGeometry";this.parameters={points:points,segments:segments,phiStart:phiStart,phiLength:phiLength};segments=_Mathfloor(segments)||12;phiStart=phiStart||0;phiLength=phiLength||2*_MathPI;phiLength=_Math.clamp(phiLength,0,2*_MathPI);var indices=[],vertices=[],uvs=[],base,inverseSegments=1/segments,vertex=new Vector3,uv=new Vector2,i,j;for(i=0;i<=segments;i++){var phi=phiStart+i*inverseSegments*phiLength,sin=_Mathsin(phi),cos=_Mathcos(phi);for(j=0;j<=points.length-1;j++){vertex.x=points[j].x*sin;vertex.y=points[j].y;vertex.z=points[j].x*cos;vertices.push(vertex.x,vertex.y,vertex.z);uv.x=i/segments;uv.y=j/(points.length-1);uvs.push(uv.x,uv.y)}}for(i=0;i<segments;i++){for(j=0;j<points.length-1;j++){base=j+i*points.length;var a=base,b=base+points.length,c=base+points.length+1,d=base+1;indices.push(a,b,d);indices.push(b,c,d)}}this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2));this.computeVertexNormals();if(phiLength===2*_MathPI){var normals=this.attributes.normal.array,n1=new Vector3,n2=new Vector3,n=new Vector3;base=3*(segments*points.length);for(i=0,j=0;i<points.length;i++,j+=3){n1.x=normals[j+0];n1.y=normals[j+1];n1.z=normals[j+2];n2.x=normals[base+j+0];n2.y=normals[base+j+1];n2.z=normals[base+j+2];n.addVectors(n1,n2).normalize();normals[j+0]=normals[base+j+0]=n.x;normals[j+1]=normals[base+j+1]=n.y;normals[j+2]=normals[base+j+2]=n.z}}}LatheBufferGeometry.prototype=Object.create(BufferGeometry.prototype);LatheBufferGeometry.prototype.constructor=LatheBufferGeometry;function ShapeGeometry(shapes,curveSegments){Geometry.call(this);this.type="ShapeGeometry";if("object"===babelHelpers.typeof(curveSegments)){console.warn("THREE.ShapeGeometry: Options parameter has been removed.");curveSegments=curveSegments.curveSegments}this.parameters={shapes:shapes,curveSegments:curveSegments};this.fromBufferGeometry(new ShapeBufferGeometry(shapes,curveSegments));this.mergeVertices()}ShapeGeometry.prototype=Object.create(Geometry.prototype);ShapeGeometry.prototype.constructor=ShapeGeometry;ShapeGeometry.prototype.toJSON=function(){var data=Geometry.prototype.toJSON.call(this),shapes=this.parameters.shapes;return toJSON(shapes,data)};function ShapeBufferGeometry(shapes,curveSegments){BufferGeometry.call(this);this.type="ShapeBufferGeometry";this.parameters={shapes:shapes,curveSegments:curveSegments};curveSegments=curveSegments||12;var indices=[],vertices=[],normals=[],uvs=[],groupStart=0,groupCount=0;if(!1===Array.isArray(shapes)){addShape(shapes)}else{for(var i=0;i<shapes.length;i++){addShape(shapes[i]);this.addGroup(groupStart,groupCount,i);groupStart+=groupCount;groupCount=0}}this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("normal",new Float32BufferAttribute(normals,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2));function addShape(shape){var i,l,shapeHole,indexOffset=vertices.length/3,points=shape.extractPoints(curveSegments),shapeVertices=points.shape,shapeHoles=points.holes;if(!1===ShapeUtils.isClockWise(shapeVertices)){shapeVertices=shapeVertices.reverse();for(i=0,l=shapeHoles.length;i<l;i++){shapeHole=shapeHoles[i];if(!0===ShapeUtils.isClockWise(shapeHole)){shapeHoles[i]=shapeHole.reverse()}}}var faces=ShapeUtils.triangulateShape(shapeVertices,shapeHoles);for(i=0,l=shapeHoles.length;i<l;i++){shapeHole=shapeHoles[i];shapeVertices=shapeVertices.concat(shapeHole)}for(i=0,l=shapeVertices.length;i<l;i++){var vertex=shapeVertices[i];vertices.push(vertex.x,vertex.y,0);normals.push(0,0,1);uvs.push(vertex.x,vertex.y)}for(i=0,l=faces.length;i<l;i++){var face=faces[i],a=face[0]+indexOffset,b=face[1]+indexOffset,c=face[2]+indexOffset;indices.push(a,b,c);groupCount+=3}}}ShapeBufferGeometry.prototype=Object.create(BufferGeometry.prototype);ShapeBufferGeometry.prototype.constructor=ShapeBufferGeometry;ShapeBufferGeometry.prototype.toJSON=function(){var data=BufferGeometry.prototype.toJSON.call(this),shapes=this.parameters.shapes;return toJSON(shapes,data)};function toJSON(shapes,data){data.shapes=[];if(Array.isArray(shapes)){for(var i=0,l=shapes.length,shape;i<l;i++){shape=shapes[i];data.shapes.push(shape.uuid)}}else{data.shapes.push(shapes.uuid)}return data}function EdgesGeometry(geometry,thresholdAngle){BufferGeometry.call(this);this.type="EdgesGeometry";this.parameters={thresholdAngle:thresholdAngle};thresholdAngle=thresholdAngle!==void 0?thresholdAngle:1;var vertices=[],thresholdDot=_Mathcos(_Math.DEG2RAD*thresholdAngle),edge=[0,0],edges={},edge1,edge2,key,keys=["a","b","c"],geometry2;if(geometry.isBufferGeometry){geometry2=new Geometry;geometry2.fromBufferGeometry(geometry)}else{geometry2=geometry.clone()}geometry2.mergeVertices();geometry2.computeFaceNormals();for(var sourceVertices=geometry2.vertices,faces=geometry2.faces,i=0,l=faces.length,face;i<l;i++){face=faces[i];for(var j=0;3>j;j++){edge1=face[keys[j]];edge2=face[keys[(j+1)%3]];edge[0]=_Mathmin(edge1,edge2);edge[1]=_Mathmax(edge1,edge2);key=edge[0]+","+edge[1];if(edges[key]===void 0){edges[key]={index1:edge[0],index2:edge[1],face1:i,face2:void 0}}else{edges[key].face2=i}}}for(key in edges){var e=edges[key];if(e.face2===void 0||faces[e.face1].normal.dot(faces[e.face2].normal)<=thresholdDot){var vertex=sourceVertices[e.index1];vertices.push(vertex.x,vertex.y,vertex.z);vertex=sourceVertices[e.index2];vertices.push(vertex.x,vertex.y,vertex.z)}}this.addAttribute("position",new Float32BufferAttribute(vertices,3))}EdgesGeometry.prototype=Object.create(BufferGeometry.prototype);EdgesGeometry.prototype.constructor=EdgesGeometry;function CylinderGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){Geometry.call(this);this.type="CylinderGeometry";this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength};this.fromBufferGeometry(new CylinderBufferGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength));this.mergeVertices()}CylinderGeometry.prototype=Object.create(Geometry.prototype);CylinderGeometry.prototype.constructor=CylinderGeometry;function CylinderBufferGeometry(radiusTop,radiusBottom,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){BufferGeometry.call(this);this.type="CylinderBufferGeometry";this.parameters={radiusTop:radiusTop,radiusBottom:radiusBottom,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength};var scope=this;radiusTop=radiusTop!==void 0?radiusTop:1;radiusBottom=radiusBottom!==void 0?radiusBottom:1;height=height||1;radialSegments=_Mathfloor(radialSegments)||8;heightSegments=_Mathfloor(heightSegments)||1;openEnded=openEnded!==void 0?openEnded:!1;thetaStart=thetaStart!==void 0?thetaStart:0;thetaLength=thetaLength!==void 0?thetaLength:2*_MathPI;var indices=[],vertices=[],normals=[],uvs=[],index=0,indexArray=[],halfHeight=height/2,groupStart=0;generateTorso();if(!1===openEnded){if(0<radiusTop)generateCap(!0);if(0<radiusBottom)generateCap(!1)}this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("normal",new Float32BufferAttribute(normals,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2));function generateTorso(){var x,y,normal=new Vector3,vertex=new Vector3,groupCount=0,slope=(radiusBottom-radiusTop)/height;for(y=0;y<=heightSegments;y++){var indexRow=[],v=y/heightSegments,radius=v*(radiusBottom-radiusTop)+radiusTop;for(x=0;x<=radialSegments;x++){var u=x/radialSegments,theta=u*thetaLength+thetaStart,sinTheta=_Mathsin(theta),cosTheta=_Mathcos(theta);vertex.x=radius*sinTheta;vertex.y=-v*height+halfHeight;vertex.z=radius*cosTheta;vertices.push(vertex.x,vertex.y,vertex.z);normal.set(sinTheta,slope,cosTheta).normalize();normals.push(normal.x,normal.y,normal.z);uvs.push(u,1-v);indexRow.push(index++)}indexArray.push(indexRow)}for(x=0;x<radialSegments;x++){for(y=0;y<heightSegments;y++){var a=indexArray[y][x],b=indexArray[y+1][x],c=indexArray[y+1][x+1],d=indexArray[y][x+1];indices.push(a,b,d);indices.push(b,c,d);groupCount+=6}}scope.addGroup(groupStart,groupCount,0);groupStart+=groupCount}function generateCap(top){var x,centerIndexStart,centerIndexEnd,uv=new Vector2,vertex=new Vector3,groupCount=0,radius=!0===top?radiusTop:radiusBottom,sign=!0===top?1:-1;centerIndexStart=index;for(x=1;x<=radialSegments;x++){vertices.push(0,halfHeight*sign,0);normals.push(0,sign,0);uvs.push(.5,.5);index++}centerIndexEnd=index;for(x=0;x<=radialSegments;x++){var u=x/radialSegments,theta=u*thetaLength+thetaStart,cosTheta=_Mathcos(theta),sinTheta=_Mathsin(theta);vertex.x=radius*sinTheta;vertex.y=halfHeight*sign;vertex.z=radius*cosTheta;vertices.push(vertex.x,vertex.y,vertex.z);normals.push(0,sign,0);uv.x=.5*cosTheta+.5;uv.y=.5*sinTheta*sign+.5;uvs.push(uv.x,uv.y);index++}for(x=0;x<radialSegments;x++){var c=centerIndexStart+x,i=centerIndexEnd+x;if(!0===top){indices.push(i,i+1,c)}else{indices.push(i+1,i,c)}groupCount+=3}scope.addGroup(groupStart,groupCount,!0===top?1:2);groupStart+=groupCount}}CylinderBufferGeometry.prototype=Object.create(BufferGeometry.prototype);CylinderBufferGeometry.prototype.constructor=CylinderBufferGeometry;function ConeGeometry(radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){CylinderGeometry.call(this,0,radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength);this.type="ConeGeometry";this.parameters={radius:radius,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength}}ConeGeometry.prototype=Object.create(CylinderGeometry.prototype);ConeGeometry.prototype.constructor=ConeGeometry;function ConeBufferGeometry(radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength){CylinderBufferGeometry.call(this,0,radius,height,radialSegments,heightSegments,openEnded,thetaStart,thetaLength);this.type="ConeBufferGeometry";this.parameters={radius:radius,height:height,radialSegments:radialSegments,heightSegments:heightSegments,openEnded:openEnded,thetaStart:thetaStart,thetaLength:thetaLength}}ConeBufferGeometry.prototype=Object.create(CylinderBufferGeometry.prototype);ConeBufferGeometry.prototype.constructor=ConeBufferGeometry;function CircleGeometry(radius,segments,thetaStart,thetaLength){Geometry.call(this);this.type="CircleGeometry";this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength};this.fromBufferGeometry(new CircleBufferGeometry(radius,segments,thetaStart,thetaLength));this.mergeVertices()}CircleGeometry.prototype=Object.create(Geometry.prototype);CircleGeometry.prototype.constructor=CircleGeometry;function CircleBufferGeometry(radius,segments,thetaStart,thetaLength){BufferGeometry.call(this);this.type="CircleBufferGeometry";this.parameters={radius:radius,segments:segments,thetaStart:thetaStart,thetaLength:thetaLength};radius=radius||1;segments=segments!==void 0?_Mathmax(3,segments):8;thetaStart=thetaStart!==void 0?thetaStart:0;thetaLength=thetaLength!==void 0?thetaLength:2*_MathPI;var indices=[],vertices=[],normals=[],uvs=[],i,s,vertex=new Vector3,uv=new Vector2;vertices.push(0,0,0);normals.push(0,0,1);uvs.push(.5,.5);for(s=0,i=3;s<=segments;s++,i+=3){var segment=thetaStart+s/segments*thetaLength;vertex.x=radius*_Mathcos(segment);vertex.y=radius*_Mathsin(segment);vertices.push(vertex.x,vertex.y,vertex.z);normals.push(0,0,1);uv.x=(vertices[i]/radius+1)/2;uv.y=(vertices[i+1]/radius+1)/2;uvs.push(uv.x,uv.y)}for(i=1;i<=segments;i++){indices.push(i,i+1,0)}this.setIndex(indices);this.addAttribute("position",new Float32BufferAttribute(vertices,3));this.addAttribute("normal",new Float32BufferAttribute(normals,3));this.addAttribute("uv",new Float32BufferAttribute(uvs,2))}CircleBufferGeometry.prototype=Object.create(BufferGeometry.prototype);CircleBufferGeometry.prototype.constructor=CircleBufferGeometry;var Geometries=Object.freeze({WireframeGeometry:WireframeGeometry,ParametricGeometry:ParametricGeometry,ParametricBufferGeometry:ParametricBufferGeometry,TetrahedronGeometry:TetrahedronGeometry,TetrahedronBufferGeometry:TetrahedronBufferGeometry,OctahedronGeometry:OctahedronGeometry,OctahedronBufferGeometry:OctahedronBufferGeometry,IcosahedronGeometry:IcosahedronGeometry,IcosahedronBufferGeometry:IcosahedronBufferGeometry,DodecahedronGeometry:DodecahedronGeometry,DodecahedronBufferGeometry:DodecahedronBufferGeometry,PolyhedronGeometry:PolyhedronGeometry,PolyhedronBufferGeometry:PolyhedronBufferGeometry,TubeGeometry:TubeGeometry,TubeBufferGeometry:TubeBufferGeometry,TorusKnotGeometry:TorusKnotGeometry,TorusKnotBufferGeometry:TorusKnotBufferGeometry,TorusGeometry:TorusGeometry,TorusBufferGeometry:TorusBufferGeometry,TextGeometry:TextGeometry,TextBufferGeometry:TextBufferGeometry,SphereGeometry:SphereGeometry,SphereBufferGeometry:SphereBufferGeometry,RingGeometry:RingGeometry,RingBufferGeometry:RingBufferGeometry,PlaneGeometry:PlaneGeometry,PlaneBufferGeometry:PlaneBufferGeometry,LatheGeometry:LatheGeometry,LatheBufferGeometry:LatheBufferGeometry,ShapeGeometry:ShapeGeometry,ShapeBufferGeometry:ShapeBufferGeometry,ExtrudeGeometry:ExtrudeGeometry,ExtrudeBufferGeometry:ExtrudeBufferGeometry,EdgesGeometry:EdgesGeometry,ConeGeometry:ConeGeometry,ConeBufferGeometry:ConeBufferGeometry,CylinderGeometry:CylinderGeometry,CylinderBufferGeometry:CylinderBufferGeometry,CircleGeometry:CircleGeometry,CircleBufferGeometry:CircleBufferGeometry,BoxGeometry:BoxGeometry,BoxBufferGeometry:BoxBufferGeometry});function ShadowMaterial(parameters){Material.call(this);this.type="ShadowMaterial";this.color=new Color(0);this.opacity=1;this.lights=!0;this.transparent=!0;this.setValues(parameters)}ShadowMaterial.prototype=Object.create(Material.prototype);ShadowMaterial.prototype.constructor=ShadowMaterial;ShadowMaterial.prototype.isShadowMaterial=!0;function RawShaderMaterial(parameters){ShaderMaterial.call(this,parameters);this.type="RawShaderMaterial"}RawShaderMaterial.prototype=Object.create(ShaderMaterial.prototype);RawShaderMaterial.prototype.constructor=RawShaderMaterial;RawShaderMaterial.prototype.isRawShaderMaterial=!0;function MeshStandardMaterial(parameters){Material.call(this);this.defines={STANDARD:""};this.type="MeshStandardMaterial";this.color=new Color(16777215);this.roughness=.5;this.metalness=.5;this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Color(0);this.emissiveIntensity=1;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.roughnessMap=null;this.metalnessMap=null;this.alphaMap=null;this.envMap=null;this.envMapIntensity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=!1;this.morphTargets=!1;this.morphNormals=!1;this.setValues(parameters)}MeshStandardMaterial.prototype=Object.create(Material.prototype);MeshStandardMaterial.prototype.constructor=MeshStandardMaterial;MeshStandardMaterial.prototype.isMeshStandardMaterial=!0;MeshStandardMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.defines={STANDARD:""};this.color.copy(source.color);this.roughness=source.roughness;this.metalness=source.metalness;this.map=source.map;this.lightMap=source.lightMap;this.lightMapIntensity=source.lightMapIntensity;this.aoMap=source.aoMap;this.aoMapIntensity=source.aoMapIntensity;this.emissive.copy(source.emissive);this.emissiveMap=source.emissiveMap;this.emissiveIntensity=source.emissiveIntensity;this.bumpMap=source.bumpMap;this.bumpScale=source.bumpScale;this.normalMap=source.normalMap;this.normalScale.copy(source.normalScale);this.displacementMap=source.displacementMap;this.displacementScale=source.displacementScale;this.displacementBias=source.displacementBias;this.roughnessMap=source.roughnessMap;this.metalnessMap=source.metalnessMap;this.alphaMap=source.alphaMap;this.envMap=source.envMap;this.envMapIntensity=source.envMapIntensity;this.refractionRatio=source.refractionRatio;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.wireframeLinecap=source.wireframeLinecap;this.wireframeLinejoin=source.wireframeLinejoin;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;return this};function MeshPhysicalMaterial(parameters){MeshStandardMaterial.call(this);this.defines={PHYSICAL:""};this.type="MeshPhysicalMaterial";this.reflectivity=.5;this.clearCoat=0;this.clearCoatRoughness=0;this.setValues(parameters)}MeshPhysicalMaterial.prototype=Object.create(MeshStandardMaterial.prototype);MeshPhysicalMaterial.prototype.constructor=MeshPhysicalMaterial;MeshPhysicalMaterial.prototype.isMeshPhysicalMaterial=!0;MeshPhysicalMaterial.prototype.copy=function(source){MeshStandardMaterial.prototype.copy.call(this,source);this.defines={PHYSICAL:""};this.reflectivity=source.reflectivity;this.clearCoat=source.clearCoat;this.clearCoatRoughness=source.clearCoatRoughness;return this};function MeshPhongMaterial(parameters){Material.call(this);this.type="MeshPhongMaterial";this.color=new Color(16777215);this.specular=new Color(1118481);this.shininess=30;this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Color(0);this.emissiveIntensity=1;this.emissiveMap=null;this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=!1;this.morphTargets=!1;this.morphNormals=!1;this.setValues(parameters)}MeshPhongMaterial.prototype=Object.create(Material.prototype);MeshPhongMaterial.prototype.constructor=MeshPhongMaterial;MeshPhongMaterial.prototype.isMeshPhongMaterial=!0;MeshPhongMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.specular.copy(source.specular);this.shininess=source.shininess;this.map=source.map;this.lightMap=source.lightMap;this.lightMapIntensity=source.lightMapIntensity;this.aoMap=source.aoMap;this.aoMapIntensity=source.aoMapIntensity;this.emissive.copy(source.emissive);this.emissiveMap=source.emissiveMap;this.emissiveIntensity=source.emissiveIntensity;this.bumpMap=source.bumpMap;this.bumpScale=source.bumpScale;this.normalMap=source.normalMap;this.normalScale.copy(source.normalScale);this.displacementMap=source.displacementMap;this.displacementScale=source.displacementScale;this.displacementBias=source.displacementBias;this.specularMap=source.specularMap;this.alphaMap=source.alphaMap;this.envMap=source.envMap;this.combine=source.combine;this.reflectivity=source.reflectivity;this.refractionRatio=source.refractionRatio;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.wireframeLinecap=source.wireframeLinecap;this.wireframeLinejoin=source.wireframeLinejoin;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;return this};function MeshToonMaterial(parameters){MeshPhongMaterial.call(this);this.defines={TOON:""};this.type="MeshToonMaterial";this.gradientMap=null;this.setValues(parameters)}MeshToonMaterial.prototype=Object.create(MeshPhongMaterial.prototype);MeshToonMaterial.prototype.constructor=MeshToonMaterial;MeshToonMaterial.prototype.isMeshToonMaterial=!0;MeshToonMaterial.prototype.copy=function(source){MeshPhongMaterial.prototype.copy.call(this,source);this.gradientMap=source.gradientMap;return this};function MeshNormalMaterial(parameters){Material.call(this);this.type="MeshNormalMaterial";this.bumpMap=null;this.bumpScale=1;this.normalMap=null;this.normalScale=new Vector2(1,1);this.displacementMap=null;this.displacementScale=1;this.displacementBias=0;this.wireframe=!1;this.wireframeLinewidth=1;this.fog=!1;this.lights=!1;this.skinning=!1;this.morphTargets=!1;this.morphNormals=!1;this.setValues(parameters)}MeshNormalMaterial.prototype=Object.create(Material.prototype);MeshNormalMaterial.prototype.constructor=MeshNormalMaterial;MeshNormalMaterial.prototype.isMeshNormalMaterial=!0;MeshNormalMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.bumpMap=source.bumpMap;this.bumpScale=source.bumpScale;this.normalMap=source.normalMap;this.normalScale.copy(source.normalScale);this.displacementMap=source.displacementMap;this.displacementScale=source.displacementScale;this.displacementBias=source.displacementBias;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;return this};function MeshLambertMaterial(parameters){Material.call(this);this.type="MeshLambertMaterial";this.color=new Color(16777215);this.map=null;this.lightMap=null;this.lightMapIntensity=1;this.aoMap=null;this.aoMapIntensity=1;this.emissive=new Color(0);this.emissiveIntensity=1;this.emissiveMap=null;this.specularMap=null;this.alphaMap=null;this.envMap=null;this.combine=MultiplyOperation;this.reflectivity=1;this.refractionRatio=.98;this.wireframe=!1;this.wireframeLinewidth=1;this.wireframeLinecap="round";this.wireframeLinejoin="round";this.skinning=!1;this.morphTargets=!1;this.morphNormals=!1;this.setValues(parameters)}MeshLambertMaterial.prototype=Object.create(Material.prototype);MeshLambertMaterial.prototype.constructor=MeshLambertMaterial;MeshLambertMaterial.prototype.isMeshLambertMaterial=!0;MeshLambertMaterial.prototype.copy=function(source){Material.prototype.copy.call(this,source);this.color.copy(source.color);this.map=source.map;this.lightMap=source.lightMap;this.lightMapIntensity=source.lightMapIntensity;this.aoMap=source.aoMap;this.aoMapIntensity=source.aoMapIntensity;this.emissive.copy(source.emissive);this.emissiveMap=source.emissiveMap;this.emissiveIntensity=source.emissiveIntensity;this.specularMap=source.specularMap;this.alphaMap=source.alphaMap;this.envMap=source.envMap;this.combine=source.combine;this.reflectivity=source.reflectivity;this.refractionRatio=source.refractionRatio;this.wireframe=source.wireframe;this.wireframeLinewidth=source.wireframeLinewidth;this.wireframeLinecap=source.wireframeLinecap;this.wireframeLinejoin=source.wireframeLinejoin;this.skinning=source.skinning;this.morphTargets=source.morphTargets;this.morphNormals=source.morphNormals;return this};function LineDashedMaterial(parameters){LineBasicMaterial.call(this);this.type="LineDashedMaterial";this.scale=1;this.dashSize=3;this.gapSize=1;this.setValues(parameters)}LineDashedMaterial.prototype=Object.create(LineBasicMaterial.prototype);LineDashedMaterial.prototype.constructor=LineDashedMaterial;LineDashedMaterial.prototype.isLineDashedMaterial=!0;LineDashedMaterial.prototype.copy=function(source){LineBasicMaterial.prototype.copy.call(this,source);this.scale=source.scale;this.dashSize=source.dashSize;this.gapSize=source.gapSize;return this};var Materials=Object.freeze({ShadowMaterial:ShadowMaterial,SpriteMaterial:SpriteMaterial,RawShaderMaterial:RawShaderMaterial,ShaderMaterial:ShaderMaterial,PointsMaterial:PointsMaterial,MeshPhysicalMaterial:MeshPhysicalMaterial,MeshStandardMaterial:MeshStandardMaterial,MeshPhongMaterial:MeshPhongMaterial,MeshToonMaterial:MeshToonMaterial,MeshNormalMaterial:MeshNormalMaterial,MeshLambertMaterial:MeshLambertMaterial,MeshDepthMaterial:MeshDepthMaterial,MeshDistanceMaterial:MeshDistanceMaterial,MeshBasicMaterial:MeshBasicMaterial,LineDashedMaterial:LineDashedMaterial,LineBasicMaterial:LineBasicMaterial,Material:Material}),Cache={enabled:!1,files:{},add:function add(key,file){if(!1===this.enabled)return;this.files[key]=file},get:function get(key){if(!1===this.enabled)return;return this.files[key]},remove:function remove(key){delete this.files[key]},clear:function clear(){this.files={}}};function LoadingManager(onLoad,onProgress,onError){var scope=this,isLoading=!1,itemsLoaded=0,itemsTotal=0,urlModifier=void 0;this.onStart=void 0;this.onLoad=onLoad;this.onProgress=onProgress;this.onError=onError;this.itemStart=function(url){itemsTotal++;if(!1===isLoading){if(scope.onStart!==void 0){scope.onStart(url,itemsLoaded,itemsTotal)}}isLoading=!0};this.itemEnd=function(url){itemsLoaded++;if(scope.onProgress!==void 0){scope.onProgress(url,itemsLoaded,itemsTotal)}if(itemsLoaded===itemsTotal){isLoading=!1;if(scope.onLoad!==void 0){scope.onLoad()}}};this.itemError=function(url){if(scope.onError!==void 0){scope.onError(url)}};this.resolveURL=function(url){if(urlModifier){return urlModifier(url)}return url};this.setURLModifier=function(transform){urlModifier=transform;return this}}var DefaultLoadingManager=new LoadingManager,loading={};function FileLoader(manager){this.manager=manager!==void 0?manager:DefaultLoadingManager}Object.assign(FileLoader.prototype,{load:function load(url,onLoad,onProgress,onError){if(url===void 0)url="";if(this.path!==void 0)url=this.path+url;url=this.manager.resolveURL(url);var scope=this,cached=Cache.get(url);if(cached!==void 0){scope.manager.itemStart(url);setTimeout(function(){if(onLoad)onLoad(cached);scope.manager.itemEnd(url)},0);return cached}if(loading[url]!==void 0){loading[url].push({onLoad:onLoad,onProgress:onProgress,onError:onError});return}var dataUriRegex=/^data:(.*?)(;base64)?,(.*)$/,dataUriRegexResult=url.match(dataUriRegex);if(dataUriRegexResult){var mimeType=dataUriRegexResult[1],isBase64=!!dataUriRegexResult[2],data=dataUriRegexResult[3];data=window.decodeURIComponent(data);if(isBase64)data=window.atob(data);try{var response,responseType=(this.responseType||"").toLowerCase();switch(responseType){case"arraybuffer":case"blob":for(var view=new Uint8Array(data.length),i=0;i<data.length;i++){view[i]=data.charCodeAt(i)}if("blob"===responseType){response=new Blob([view.buffer],{type:mimeType})}else{response=view.buffer}break;case"document":var parser=new DOMParser;response=parser.parseFromString(data,mimeType);break;case"json":response=JSON.parse(data);break;default:response=data;break;}window.setTimeout(function(){if(onLoad)onLoad(response);scope.manager.itemEnd(url)},0)}catch(error){window.setTimeout(function(){if(onError)onError(error);scope.manager.itemEnd(url);scope.manager.itemError(url)},0)}}else{loading[url]=[];loading[url].push({onLoad:onLoad,onProgress:onProgress,onError:onError});var request=new XMLHttpRequest;request.open("GET",url,!0);request.addEventListener("load",function(event){var response=this.response;Cache.add(url,response);var callbacks=loading[url];delete loading[url];if(200===this.status){for(var i=0,il=callbacks.length,callback;i<il;i++){callback=callbacks[i];if(callback.onLoad)callback.onLoad(response)}scope.manager.itemEnd(url)}else if(0===this.status){console.warn("THREE.FileLoader: HTTP Status 0 received.");for(var i=0,il=callbacks.length,callback;i<il;i++){callback=callbacks[i];if(callback.onLoad)callback.onLoad(response)}scope.manager.itemEnd(url)}else{for(var i=0,il=callbacks.length,callback;i<il;i++){callback=callbacks[i];if(callback.onError)callback.onError(event)}scope.manager.itemEnd(url);scope.manager.itemError(url)}},!1);request.addEventListener("progress",function(event){for(var callbacks=loading[url],i=0,il=callbacks.length,callback;i<il;i++){callback=callbacks[i];if(callback.onProgress)callback.onProgress(event)}},!1);request.addEventListener("error",function(event){var callbacks=loading[url];delete loading[url];for(var i=0,il=callbacks.length,callback;i<il;i++){callback=callbacks[i];if(callback.onError)callback.onError(event)}scope.manager.itemEnd(url);scope.manager.itemError(url)},!1);if(this.responseType!==void 0)request.responseType=this.responseType;if(this.withCredentials!==void 0)request.withCredentials=this.withCredentials;if(request.overrideMimeType)request.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain");for(var header in this.requestHeader){request.setRequestHeader(header,this.requestHeader[header])}request.send(null)}scope.manager.itemStart(url);return request},setPath:function setPath(value){this.path=value;return this},setResponseType:function setResponseType(value){this.responseType=value;return this},setWithCredentials:function setWithCredentials(value){this.withCredentials=value;return this},setMimeType:function setMimeType(value){this.mimeType=value;return this},setRequestHeader:function setRequestHeader(value){this.requestHeader=value;return this}});function CompressedTextureLoader(manager){this.manager=manager!==void 0?manager:DefaultLoadingManager;this._parser=null}Object.assign(CompressedTextureLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this,images=[],texture=new CompressedTexture;texture.image=images;var loader=new FileLoader(this.manager);loader.setPath(this.path);loader.setResponseType("arraybuffer");function loadTexture(i){loader.load(url[i],function(buffer){var texDatas=scope._parser(buffer,!0);images[i]={width:texDatas.width,height:texDatas.height,format:texDatas.format,mipmaps:texDatas.mipmaps};loaded+=1;if(6===loaded){if(1===texDatas.mipmapCount)texture.minFilter=LinearFilter;texture.format=texDatas.format;texture.needsUpdate=!0;if(onLoad)onLoad(texture)}},onProgress,onError)}if(Array.isArray(url)){for(var loaded=0,i=0,il=url.length;i<il;++i){loadTexture(i)}}else{loader.load(url,function(buffer){var texDatas=scope._parser(buffer,!0);if(texDatas.isCubemap){for(var faces=texDatas.mipmaps.length/texDatas.mipmapCount,f=0;f<faces;f++){images[f]={mipmaps:[]};for(var i=0;i<texDatas.mipmapCount;i++){images[f].mipmaps.push(texDatas.mipmaps[f*texDatas.mipmapCount+i]);images[f].format=texDatas.format;images[f].width=texDatas.width;images[f].height=texDatas.height}}}else{texture.image.width=texDatas.width;texture.image.height=texDatas.height;texture.mipmaps=texDatas.mipmaps}if(1===texDatas.mipmapCount){texture.minFilter=LinearFilter}texture.format=texDatas.format;texture.needsUpdate=!0;if(onLoad)onLoad(texture)},onProgress,onError)}return texture},setPath:function setPath(value){this.path=value;return this}});function DataTextureLoader(manager){this.manager=manager!==void 0?manager:DefaultLoadingManager;this._parser=null}Object.assign(DataTextureLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this,texture=new DataTexture,loader=new FileLoader(this.manager);loader.setResponseType("arraybuffer");loader.load(url,function(buffer){var texData=scope._parser(buffer);if(!texData)return;if(void 0!==texData.image){texture.image=texData.image}else if(void 0!==texData.data){texture.image.width=texData.width;texture.image.height=texData.height;texture.image.data=texData.data}texture.wrapS=void 0!==texData.wrapS?texData.wrapS:ClampToEdgeWrapping;texture.wrapT=void 0!==texData.wrapT?texData.wrapT:ClampToEdgeWrapping;texture.magFilter=void 0!==texData.magFilter?texData.magFilter:LinearFilter;texture.minFilter=void 0!==texData.minFilter?texData.minFilter:LinearMipMapLinearFilter;texture.anisotropy=void 0!==texData.anisotropy?texData.anisotropy:1;if(void 0!==texData.format){texture.format=texData.format}if(void 0!==texData.type){texture.type=texData.type}if(void 0!==texData.mipmaps){texture.mipmaps=texData.mipmaps}if(1===texData.mipmapCount){texture.minFilter=LinearFilter}texture.needsUpdate=!0;if(onLoad)onLoad(texture,texData)},onProgress,onError);return texture}});function ImageLoader(manager){this.manager=manager!==void 0?manager:DefaultLoadingManager}Object.assign(ImageLoader.prototype,{crossOrigin:"Anonymous",load:function load(url,onLoad,onProgress,onError){if(url===void 0)url="";if(this.path!==void 0)url=this.path+url;url=this.manager.resolveURL(url);var scope=this,cached=Cache.get(url);if(cached!==void 0){scope.manager.itemStart(url);setTimeout(function(){if(onLoad)onLoad(cached);scope.manager.itemEnd(url)},0);return cached}var image=document.createElementNS("http://www.w3.org/1999/xhtml","img");image.addEventListener("load",function(){Cache.add(url,this);if(onLoad)onLoad(this);scope.manager.itemEnd(url)},!1);image.addEventListener("error",function(event){if(onError)onError(event);scope.manager.itemEnd(url);scope.manager.itemError(url)},!1);if("data:"!==url.substr(0,5)){if(this.crossOrigin!==void 0)image.crossOrigin=this.crossOrigin}scope.manager.itemStart(url);image.src=url;return image},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value;return this},setPath:function setPath(value){this.path=value;return this}});function CubeTextureLoader(manager){this.manager=manager!==void 0?manager:DefaultLoadingManager}Object.assign(CubeTextureLoader.prototype,{crossOrigin:"Anonymous",load:function load(urls,onLoad,onProgress,onError){var texture=new CubeTexture,loader=new ImageLoader(this.manager);loader.setCrossOrigin(this.crossOrigin);loader.setPath(this.path);var loaded=0;function loadTexture(i){loader.load(urls[i],function(image){texture.images[i]=image;loaded++;if(6===loaded){texture.needsUpdate=!0;if(onLoad)onLoad(texture)}},void 0,onError)}for(var i=0;i<urls.length;++i){loadTexture(i)}return texture},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value;return this},setPath:function setPath(value){this.path=value;return this}});function TextureLoader(manager){this.manager=manager!==void 0?manager:DefaultLoadingManager}Object.assign(TextureLoader.prototype,{crossOrigin:"Anonymous",load:function load(url,onLoad,onProgress,onError){var texture=new Texture,loader=new ImageLoader(this.manager);loader.setCrossOrigin(this.crossOrigin);loader.setPath(this.path);loader.load(url,function(image){texture.image=image;var isJPEG=0<url.search(/\.(jpg|jpeg)$/)||0===url.search(/^data\:image\/jpeg/);texture.format=isJPEG?RGBFormat:RGBAFormat;texture.needsUpdate=!0;if(onLoad!==void 0){onLoad(texture)}},onProgress,onError);return texture},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value;return this},setPath:function setPath(value){this.path=value;return this}});function Curve(){this.type="Curve";this.arcLengthDivisions=200}Object.assign(Curve.prototype,{getPoint:function getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.");return null},getPointAt:function getPointAt(u,optionalTarget){var t=this.getUtoTmapping(u);return this.getPoint(t,optionalTarget)},getPoints:function getPoints(divisions){if(divisions===void 0)divisions=5;for(var points=[],d=0;d<=divisions;d++){points.push(this.getPoint(d/divisions))}return points},getSpacedPoints:function getSpacedPoints(divisions){if(divisions===void 0)divisions=5;for(var points=[],d=0;d<=divisions;d++){points.push(this.getPointAt(d/divisions))}return points},getLength:function getLength(){var lengths=this.getLengths();return lengths[lengths.length-1]},getLengths:function getLengths(divisions){if(divisions===void 0)divisions=this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===divisions+1&&!this.needsUpdate){return this.cacheArcLengths}this.needsUpdate=!1;var cache=[],current,last=this.getPoint(0),p,sum=0;cache.push(0);for(p=1;p<=divisions;p++){current=this.getPoint(p/divisions);sum+=current.distanceTo(last);cache.push(sum);last=current}this.cacheArcLengths=cache;return cache},updateArcLengths:function updateArcLengths(){this.needsUpdate=!0;this.getLengths()},getUtoTmapping:function getUtoTmapping(u,distance){var arcLengths=this.getLengths(),i=0,il=arcLengths.length,targetArcLength;if(distance){targetArcLength=distance}else{targetArcLength=u*arcLengths[il-1]}var low=0,high=il-1,comparison;while(low<=high){i=_Mathfloor(low+(high-low)/2);comparison=arcLengths[i]-targetArcLength;if(0>comparison){low=i+1}else if(0<comparison){high=i-1}else{high=i;break}}i=high;if(arcLengths[i]===targetArcLength){return i/(il-1)}var lengthBefore=arcLengths[i],lengthAfter=arcLengths[i+1],segmentFraction=(targetArcLength-lengthBefore)/(lengthAfter-lengthBefore),t=(i+segmentFraction)/(il-1);return t},getTangent:function getTangent(t){var delta=1e-4,t1=t-delta,t2=t+delta;if(0>t1)t1=0;if(1<t2)t2=1;var pt1=this.getPoint(t1),pt2=this.getPoint(t2),vec=pt2.clone().sub(pt1);return vec.normalize()},getTangentAt:function getTangentAt(u){var t=this.getUtoTmapping(u);return this.getTangent(t)},computeFrenetFrames:function computeFrenetFrames(segments,closed){var normal=new Vector3,tangents=[],normals=[],binormals=[],vec=new Vector3,mat=new Matrix4,i,u,theta;for(i=0;i<=segments;i++){u=i/segments;tangents[i]=this.getTangentAt(u);tangents[i].normalize()}normals[0]=new Vector3;binormals[0]=new Vector3;var min=_NumberMAX_VALUE,tx=_Mathabs(tangents[0].x),ty=_Mathabs(tangents[0].y),tz=_Mathabs(tangents[0].z);if(tx<=min){min=tx;normal.set(1,0,0)}if(ty<=min){min=ty;normal.set(0,1,0)}if(tz<=min){normal.set(0,0,1)}vec.crossVectors(tangents[0],normal).normalize();normals[0].crossVectors(tangents[0],vec);binormals[0].crossVectors(tangents[0],normals[0]);for(i=1;i<=segments;i++){normals[i]=normals[i-1].clone();binormals[i]=binormals[i-1].clone();vec.crossVectors(tangents[i-1],tangents[i]);if(vec.length()>_NumberEPSILON){vec.normalize();theta=_Mathacos(_Math.clamp(tangents[i-1].dot(tangents[i]),-1,1));normals[i].applyMatrix4(mat.makeRotationAxis(vec,theta))}binormals[i].crossVectors(tangents[i],normals[i])}if(!0===closed){theta=_Mathacos(_Math.clamp(normals[0].dot(normals[segments]),-1,1));theta/=segments;if(0<tangents[0].dot(vec.crossVectors(normals[0],normals[segments]))){theta=-theta}for(i=1;i<=segments;i++){normals[i].applyMatrix4(mat.makeRotationAxis(tangents[i],theta*i));binormals[i].crossVectors(tangents[i],normals[i])}}return{tangents:tangents,normals:normals,binormals:binormals}},clone:function clone(){return new this.constructor().copy(this)},copy:function copy(source){this.arcLengthDivisions=source.arcLengthDivisions;return this},toJSON:function(){var data={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"},arcLengthDivisions:this.arcLengthDivisions,type:this.type};return data},fromJSON:function fromJSON(json){this.arcLengthDivisions=json.arcLengthDivisions;return this}});function EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){Curve.call(this);this.type="EllipseCurve";this.aX=aX||0;this.aY=aY||0;this.xRadius=xRadius||1;this.yRadius=yRadius||1;this.aStartAngle=aStartAngle||0;this.aEndAngle=aEndAngle||2*_MathPI;this.aClockwise=aClockwise||!1;this.aRotation=aRotation||0}EllipseCurve.prototype=Object.create(Curve.prototype);EllipseCurve.prototype.constructor=EllipseCurve;EllipseCurve.prototype.isEllipseCurve=!0;EllipseCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2,twoPi=2*_MathPI,deltaAngle=this.aEndAngle-this.aStartAngle,samePoints=_Mathabs(deltaAngle)<_NumberEPSILON;while(0>deltaAngle){deltaAngle+=twoPi}while(deltaAngle>twoPi){deltaAngle-=twoPi}if(deltaAngle<_NumberEPSILON){if(samePoints){deltaAngle=0}else{deltaAngle=twoPi}}if(!0===this.aClockwise&&!samePoints){if(deltaAngle===twoPi){deltaAngle=-twoPi}else{deltaAngle=deltaAngle-twoPi}}var angle=this.aStartAngle+t*deltaAngle,x=this.aX+this.xRadius*_Mathcos(angle),y=this.aY+this.yRadius*_Mathsin(angle);if(0!==this.aRotation){var cos=_Mathcos(this.aRotation),sin=_Mathsin(this.aRotation),tx=x-this.aX,ty=y-this.aY;x=tx*cos-ty*sin+this.aX;y=tx*sin+ty*cos+this.aY}return point.set(x,y)};EllipseCurve.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.aX=source.aX;this.aY=source.aY;this.xRadius=source.xRadius;this.yRadius=source.yRadius;this.aStartAngle=source.aStartAngle;this.aEndAngle=source.aEndAngle;this.aClockwise=source.aClockwise;this.aRotation=source.aRotation;return this};EllipseCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.aX=this.aX;data.aY=this.aY;data.xRadius=this.xRadius;data.yRadius=this.yRadius;data.aStartAngle=this.aStartAngle;data.aEndAngle=this.aEndAngle;data.aClockwise=this.aClockwise;data.aRotation=this.aRotation;return data};EllipseCurve.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.aX=json.aX;this.aY=json.aY;this.xRadius=json.xRadius;this.yRadius=json.yRadius;this.aStartAngle=json.aStartAngle;this.aEndAngle=json.aEndAngle;this.aClockwise=json.aClockwise;this.aRotation=json.aRotation;return this};function ArcCurve(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){EllipseCurve.call(this,aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise);this.type="ArcCurve"}ArcCurve.prototype=Object.create(EllipseCurve.prototype);ArcCurve.prototype.constructor=ArcCurve;ArcCurve.prototype.isArcCurve=!0;function CubicPoly(){var c0=0,c1=0,c2=0,c3=0;function init(x0,x1,t0,t1){c0=x0;c1=t0;c2=-3*x0+3*x1-2*t0-t1;c3=2*x0-2*x1+t0+t1}return{initCatmullRom:function initCatmullRom(x0,x1,x2,x3,tension){init(x1,x2,tension*(x2-x0),tension*(x3-x1))},initNonuniformCatmullRom:function initNonuniformCatmullRom(x0,x1,x2,x3,dt0,dt1,dt2){var t1=(x1-x0)/dt0-(x2-x0)/(dt0+dt1)+(x2-x1)/dt1,t2=(x2-x1)/dt1-(x3-x1)/(dt1+dt2)+(x3-x2)/dt2;t1*=dt1;t2*=dt1;init(x1,x2,t1,t2)},calc:function calc(t){var t2=t*t;return c0+c1*t+c2*t2+c3*(t2*t)}}}var tmp=new Vector3,px=new CubicPoly,py=new CubicPoly,pz=new CubicPoly;function CatmullRomCurve3(points,closed,curveType,tension){Curve.call(this);this.type="CatmullRomCurve3";this.points=points||[];this.closed=closed||!1;this.curveType=curveType||"centripetal";this.tension=tension||.5}CatmullRomCurve3.prototype=Object.create(Curve.prototype);CatmullRomCurve3.prototype.constructor=CatmullRomCurve3;CatmullRomCurve3.prototype.isCatmullRomCurve3=!0;CatmullRomCurve3.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3,points=this.points,l=points.length,p=(l-(this.closed?0:1))*t,intPoint=_Mathfloor(p),weight=p-intPoint;if(this.closed){intPoint+=0<intPoint?0:(_Mathfloor(_Mathabs(intPoint)/points.length)+1)*points.length}else if(0===weight&&intPoint===l-1){intPoint=l-2;weight=1}var p0,p1,p2,p3;if(this.closed||0<intPoint){p0=points[(intPoint-1)%l]}else{tmp.subVectors(points[0],points[1]).add(points[0]);p0=tmp}p1=points[intPoint%l];p2=points[(intPoint+1)%l];if(this.closed||intPoint+2<l){p3=points[(intPoint+2)%l]}else{tmp.subVectors(points[l-1],points[l-2]).add(points[l-1]);p3=tmp}if("centripetal"===this.curveType||"chordal"===this.curveType){var pow="chordal"===this.curveType?.5:.25,dt0=_Mathpow(p0.distanceToSquared(p1),pow),dt1=_Mathpow(p1.distanceToSquared(p2),pow),dt2=_Mathpow(p2.distanceToSquared(p3),pow);if(1e-4>dt1)dt1=1;if(1e-4>dt0)dt0=dt1;if(1e-4>dt2)dt2=dt1;px.initNonuniformCatmullRom(p0.x,p1.x,p2.x,p3.x,dt0,dt1,dt2);py.initNonuniformCatmullRom(p0.y,p1.y,p2.y,p3.y,dt0,dt1,dt2);pz.initNonuniformCatmullRom(p0.z,p1.z,p2.z,p3.z,dt0,dt1,dt2)}else if("catmullrom"===this.curveType){px.initCatmullRom(p0.x,p1.x,p2.x,p3.x,this.tension);py.initCatmullRom(p0.y,p1.y,p2.y,p3.y,this.tension);pz.initCatmullRom(p0.z,p1.z,p2.z,p3.z,this.tension)}point.set(px.calc(weight),py.calc(weight),pz.calc(weight));return point};CatmullRomCurve3.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.points=[];for(var i=0,l=source.points.length,point;i<l;i++){point=source.points[i];this.points.push(point.clone())}this.closed=source.closed;this.curveType=source.curveType;this.tension=source.tension;return this};CatmullRomCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.points=[];for(var i=0,l=this.points.length,point;i<l;i++){point=this.points[i];data.points.push(point.toArray())}data.closed=this.closed;data.curveType=this.curveType;data.tension=this.tension;return data};CatmullRomCurve3.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.points=[];for(var i=0,l=json.points.length,point;i<l;i++){point=json.points[i];this.points.push(new Vector3().fromArray(point))}this.closed=json.closed;this.curveType=json.curveType;this.tension=json.tension;return this};function CatmullRom(t,p0,p1,p2,p3){var v0=.5*(p2-p0),v1=.5*(p3-p1),t2=t*t;return(2*p1-2*p2+v0+v1)*(t*t2)+(-3*p1+3*p2-2*v0-v1)*t2+v0*t+p1}function QuadraticBezierP0(t,p){var k=1-t;return k*k*p}function QuadraticBezierP1(t,p){return 2*(1-t)*t*p}function QuadraticBezierP2(t,p){return t*t*p}function QuadraticBezier(t,p0,p1,p2){return QuadraticBezierP0(t,p0)+QuadraticBezierP1(t,p1)+QuadraticBezierP2(t,p2)}function CubicBezierP0(t,p){var k=1-t;return k*k*k*p}function CubicBezierP1(t,p){var k=1-t;return 3*k*k*t*p}function CubicBezierP2(t,p){return 3*(1-t)*t*t*p}function CubicBezierP3(t,p){return t*t*t*p}function CubicBezier(t,p0,p1,p2,p3){return CubicBezierP0(t,p0)+CubicBezierP1(t,p1)+CubicBezierP2(t,p2)+CubicBezierP3(t,p3)}function CubicBezierCurve(v0,v1,v2,v3){Curve.call(this);this.type="CubicBezierCurve";this.v0=v0||new Vector2;this.v1=v1||new Vector2;this.v2=v2||new Vector2;this.v3=v3||new Vector2}CubicBezierCurve.prototype=Object.create(Curve.prototype);CubicBezierCurve.prototype.constructor=CubicBezierCurve;CubicBezierCurve.prototype.isCubicBezierCurve=!0;CubicBezierCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2,v0=this.v0,v1=this.v1,v2=this.v2,v3=this.v3;point.set(CubicBezier(t,v0.x,v1.x,v2.x,v3.x),CubicBezier(t,v0.y,v1.y,v2.y,v3.y));return point};CubicBezierCurve.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v0.copy(source.v0);this.v1.copy(source.v1);this.v2.copy(source.v2);this.v3.copy(source.v3);return this};CubicBezierCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v0=this.v0.toArray();data.v1=this.v1.toArray();data.v2=this.v2.toArray();data.v3=this.v3.toArray();return data};CubicBezierCurve.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v0.fromArray(json.v0);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);this.v3.fromArray(json.v3);return this};function CubicBezierCurve3(v0,v1,v2,v3){Curve.call(this);this.type="CubicBezierCurve3";this.v0=v0||new Vector3;this.v1=v1||new Vector3;this.v2=v2||new Vector3;this.v3=v3||new Vector3}CubicBezierCurve3.prototype=Object.create(Curve.prototype);CubicBezierCurve3.prototype.constructor=CubicBezierCurve3;CubicBezierCurve3.prototype.isCubicBezierCurve3=!0;CubicBezierCurve3.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3,v0=this.v0,v1=this.v1,v2=this.v2,v3=this.v3;point.set(CubicBezier(t,v0.x,v1.x,v2.x,v3.x),CubicBezier(t,v0.y,v1.y,v2.y,v3.y),CubicBezier(t,v0.z,v1.z,v2.z,v3.z));return point};CubicBezierCurve3.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v0.copy(source.v0);this.v1.copy(source.v1);this.v2.copy(source.v2);this.v3.copy(source.v3);return this};CubicBezierCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v0=this.v0.toArray();data.v1=this.v1.toArray();data.v2=this.v2.toArray();data.v3=this.v3.toArray();return data};CubicBezierCurve3.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v0.fromArray(json.v0);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);this.v3.fromArray(json.v3);return this};function LineCurve(v1,v2){Curve.call(this);this.type="LineCurve";this.v1=v1||new Vector2;this.v2=v2||new Vector2}LineCurve.prototype=Object.create(Curve.prototype);LineCurve.prototype.constructor=LineCurve;LineCurve.prototype.isLineCurve=!0;LineCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2;if(1===t){point.copy(this.v2)}else{point.copy(this.v2).sub(this.v1);point.multiplyScalar(t).add(this.v1)}return point};LineCurve.prototype.getPointAt=function(u,optionalTarget){return this.getPoint(u,optionalTarget)};LineCurve.prototype.getTangent=function(){var tangent=this.v2.clone().sub(this.v1);return tangent.normalize()};LineCurve.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v1.copy(source.v1);this.v2.copy(source.v2);return this};LineCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v1=this.v1.toArray();data.v2=this.v2.toArray();return data};LineCurve.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);return this};function LineCurve3(v1,v2){Curve.call(this);this.type="LineCurve3";this.v1=v1||new Vector3;this.v2=v2||new Vector3}LineCurve3.prototype=Object.create(Curve.prototype);LineCurve3.prototype.constructor=LineCurve3;LineCurve3.prototype.isLineCurve3=!0;LineCurve3.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3;if(1===t){point.copy(this.v2)}else{point.copy(this.v2).sub(this.v1);point.multiplyScalar(t).add(this.v1)}return point};LineCurve3.prototype.getPointAt=function(u,optionalTarget){return this.getPoint(u,optionalTarget)};LineCurve3.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v1.copy(source.v1);this.v2.copy(source.v2);return this};LineCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v1=this.v1.toArray();data.v2=this.v2.toArray();return data};LineCurve3.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);return this};function QuadraticBezierCurve(v0,v1,v2){Curve.call(this);this.type="QuadraticBezierCurve";this.v0=v0||new Vector2;this.v1=v1||new Vector2;this.v2=v2||new Vector2}QuadraticBezierCurve.prototype=Object.create(Curve.prototype);QuadraticBezierCurve.prototype.constructor=QuadraticBezierCurve;QuadraticBezierCurve.prototype.isQuadraticBezierCurve=!0;QuadraticBezierCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2,v0=this.v0,v1=this.v1,v2=this.v2;point.set(QuadraticBezier(t,v0.x,v1.x,v2.x),QuadraticBezier(t,v0.y,v1.y,v2.y));return point};QuadraticBezierCurve.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v0.copy(source.v0);this.v1.copy(source.v1);this.v2.copy(source.v2);return this};QuadraticBezierCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v0=this.v0.toArray();data.v1=this.v1.toArray();data.v2=this.v2.toArray();return data};QuadraticBezierCurve.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v0.fromArray(json.v0);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);return this};function QuadraticBezierCurve3(v0,v1,v2){Curve.call(this);this.type="QuadraticBezierCurve3";this.v0=v0||new Vector3;this.v1=v1||new Vector3;this.v2=v2||new Vector3}QuadraticBezierCurve3.prototype=Object.create(Curve.prototype);QuadraticBezierCurve3.prototype.constructor=QuadraticBezierCurve3;QuadraticBezierCurve3.prototype.isQuadraticBezierCurve3=!0;QuadraticBezierCurve3.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector3,v0=this.v0,v1=this.v1,v2=this.v2;point.set(QuadraticBezier(t,v0.x,v1.x,v2.x),QuadraticBezier(t,v0.y,v1.y,v2.y),QuadraticBezier(t,v0.z,v1.z,v2.z));return point};QuadraticBezierCurve3.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.v0.copy(source.v0);this.v1.copy(source.v1);this.v2.copy(source.v2);return this};QuadraticBezierCurve3.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.v0=this.v0.toArray();data.v1=this.v1.toArray();data.v2=this.v2.toArray();return data};QuadraticBezierCurve3.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.v0.fromArray(json.v0);this.v1.fromArray(json.v1);this.v2.fromArray(json.v2);return this};function SplineCurve(points){Curve.call(this);this.type="SplineCurve";this.points=points||[]}SplineCurve.prototype=Object.create(Curve.prototype);SplineCurve.prototype.constructor=SplineCurve;SplineCurve.prototype.isSplineCurve=!0;SplineCurve.prototype.getPoint=function(t,optionalTarget){var point=optionalTarget||new Vector2,points=this.points,p=(points.length-1)*t,intPoint=_Mathfloor(p),weight=p-intPoint,p0=points[0===intPoint?intPoint:intPoint-1],p1=points[intPoint],p2=points[intPoint>points.length-2?points.length-1:intPoint+1],p3=points[intPoint>points.length-3?points.length-1:intPoint+2];point.set(CatmullRom(weight,p0.x,p1.x,p2.x,p3.x),CatmullRom(weight,p0.y,p1.y,p2.y,p3.y));return point};SplineCurve.prototype.copy=function(source){Curve.prototype.copy.call(this,source);this.points=[];for(var i=0,l=source.points.length,point;i<l;i++){point=source.points[i];this.points.push(point.clone())}return this};SplineCurve.prototype.toJSON=function(){var data=Curve.prototype.toJSON.call(this);data.points=[];for(var i=0,l=this.points.length,point;i<l;i++){point=this.points[i];data.points.push(point.toArray())}return data};SplineCurve.prototype.fromJSON=function(json){Curve.prototype.fromJSON.call(this,json);this.points=[];for(var i=0,l=json.points.length,point;i<l;i++){point=json.points[i];this.points.push(new Vector2().fromArray(point))}return this};var Curves=Object.freeze({ArcCurve:ArcCurve,CatmullRomCurve3:CatmullRomCurve3,CubicBezierCurve:CubicBezierCurve,CubicBezierCurve3:CubicBezierCurve3,EllipseCurve:EllipseCurve,LineCurve:LineCurve,LineCurve3:LineCurve3,QuadraticBezierCurve:QuadraticBezierCurve,QuadraticBezierCurve3:QuadraticBezierCurve3,SplineCurve:SplineCurve});function CurvePath(){Curve.call(this);this.type="CurvePath";this.curves=[];this.autoClose=!1}CurvePath.prototype=Object.assign(Object.create(Curve.prototype),{constructor:CurvePath,add:function add(curve){this.curves.push(curve)},closePath:function closePath(){var startPoint=this.curves[0].getPoint(0),endPoint=this.curves[this.curves.length-1].getPoint(1);if(!startPoint.equals(endPoint)){this.curves.push(new LineCurve(endPoint,startPoint))}},getPoint:function getPoint(t){var d=t*this.getLength(),curveLengths=this.getCurveLengths(),i=0;while(i<curveLengths.length){if(curveLengths[i]>=d){var diff=curveLengths[i]-d,curve=this.curves[i],segmentLength=curve.getLength(),u=0===segmentLength?0:1-diff/segmentLength;return curve.getPointAt(u)}i++}return null},getLength:function getLength(){var lens=this.getCurveLengths();return lens[lens.length-1]},updateArcLengths:function updateArcLengths(){this.needsUpdate=!0;this.cacheLengths=null;this.getCurveLengths()},getCurveLengths:function getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length){return this.cacheLengths}for(var lengths=[],sums=0,i=0,l=this.curves.length;i<l;i++){sums+=this.curves[i].getLength();lengths.push(sums)}this.cacheLengths=lengths;return lengths},getSpacedPoints:function getSpacedPoints(divisions){if(divisions===void 0)divisions=40;for(var points=[],i=0;i<=divisions;i++){points.push(this.getPoint(i/divisions))}if(this.autoClose){points.push(points[0])}return points},getPoints:function getPoints(divisions){divisions=divisions||12;for(var points=[],last,i=0,curves=this.curves;i<curves.length;i++){for(var curve=curves[i],resolution=curve&&curve.isEllipseCurve?2*divisions:curve&&curve.isLineCurve?1:curve&&curve.isSplineCurve?divisions*curve.points.length:divisions,pts=curve.getPoints(resolution),j=0,point;j<pts.length;j++){point=pts[j];if(last&&last.equals(point))continue;points.push(point);last=point}}if(this.autoClose&&1<points.length&&!points[points.length-1].equals(points[0])){points.push(points[0])}return points},copy:function copy(source){Curve.prototype.copy.call(this,source);this.curves=[];for(var i=0,l=source.curves.length,curve;i<l;i++){curve=source.curves[i];this.curves.push(curve.clone())}this.autoClose=source.autoClose;return this},toJSON:function(){var data=Curve.prototype.toJSON.call(this);data.autoClose=this.autoClose;data.curves=[];for(var i=0,l=this.curves.length,curve;i<l;i++){curve=this.curves[i];data.curves.push(curve.toJSON())}return data},fromJSON:function fromJSON(json){Curve.prototype.fromJSON.call(this,json);this.autoClose=json.autoClose;this.curves=[];for(var i=0,l=json.curves.length,curve;i<l;i++){curve=json.curves[i];this.curves.push(new Curves[curve.type]().fromJSON(curve))}return this}});function Path(points){CurvePath.call(this);this.type="Path";this.currentPoint=new Vector2;if(points){this.setFromPoints(points)}}Path.prototype=Object.assign(Object.create(CurvePath.prototype),{constructor:Path,setFromPoints:function setFromPoints(points){this.moveTo(points[0].x,points[0].y);for(var i=1,l=points.length;i<l;i++){this.lineTo(points[i].x,points[i].y)}},moveTo:function moveTo(x,y){this.currentPoint.set(x,y)},lineTo:function lineTo(x,y){var curve=new LineCurve(this.currentPoint.clone(),new Vector2(x,y));this.curves.push(curve);this.currentPoint.set(x,y)},quadraticCurveTo:function quadraticCurveTo(aCPx,aCPy,aX,aY){var curve=new QuadraticBezierCurve(this.currentPoint.clone(),new Vector2(aCPx,aCPy),new Vector2(aX,aY));this.curves.push(curve);this.currentPoint.set(aX,aY)},bezierCurveTo:function bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){var curve=new CubicBezierCurve(this.currentPoint.clone(),new Vector2(aCP1x,aCP1y),new Vector2(aCP2x,aCP2y),new Vector2(aX,aY));this.curves.push(curve);this.currentPoint.set(aX,aY)},splineThru:function splineThru(pts){var npts=[this.currentPoint.clone()].concat(pts),curve=new SplineCurve(npts);this.curves.push(curve);this.currentPoint.copy(pts[pts.length-1])},arc:function arc(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){var x0=this.currentPoint.x,y0=this.currentPoint.y;this.absarc(aX+x0,aY+y0,aRadius,aStartAngle,aEndAngle,aClockwise)},absarc:function absarc(aX,aY,aRadius,aStartAngle,aEndAngle,aClockwise){this.absellipse(aX,aY,aRadius,aRadius,aStartAngle,aEndAngle,aClockwise)},ellipse:function ellipse(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){var x0=this.currentPoint.x,y0=this.currentPoint.y;this.absellipse(aX+x0,aY+y0,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation)},absellipse:function absellipse(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation){var curve=new EllipseCurve(aX,aY,xRadius,yRadius,aStartAngle,aEndAngle,aClockwise,aRotation);if(0<this.curves.length){var firstPoint=curve.getPoint(0);if(!firstPoint.equals(this.currentPoint)){this.lineTo(firstPoint.x,firstPoint.y)}}this.curves.push(curve);var lastPoint=curve.getPoint(1);this.currentPoint.copy(lastPoint)},copy:function copy(source){CurvePath.prototype.copy.call(this,source);this.currentPoint.copy(source.currentPoint);return this},toJSON:function(){var data=CurvePath.prototype.toJSON.call(this);data.currentPoint=this.currentPoint.toArray();return data},fromJSON:function fromJSON(json){CurvePath.prototype.fromJSON.call(this,json);this.currentPoint.fromArray(json.currentPoint);return this}});function Shape(points){Path.call(this,points);this.uuid=_Math.generateUUID();this.type="Shape";this.holes=[]}Shape.prototype=Object.assign(Object.create(Path.prototype),{constructor:Shape,getPointsHoles:function getPointsHoles(divisions){for(var holesPts=[],i=0,l=this.holes.length;i<l;i++){holesPts[i]=this.holes[i].getPoints(divisions)}return holesPts},extractPoints:function extractPoints(divisions){return{shape:this.getPoints(divisions),holes:this.getPointsHoles(divisions)}},copy:function copy(source){Path.prototype.copy.call(this,source);this.holes=[];for(var i=0,l=source.holes.length,hole;i<l;i++){hole=source.holes[i];this.holes.push(hole.clone())}return this},toJSON:function(){var data=Path.prototype.toJSON.call(this);data.uuid=this.uuid;data.holes=[];for(var i=0,l=this.holes.length,hole;i<l;i++){hole=this.holes[i];data.holes.push(hole.toJSON())}return data},fromJSON:function fromJSON(json){Path.prototype.fromJSON.call(this,json);this.uuid=json.uuid;this.holes=[];for(var i=0,l=json.holes.length,hole;i<l;i++){hole=json.holes[i];this.holes.push(new Path().fromJSON(hole))}return this}});function Light(color,intensity){Object3D.call(this);this.type="Light";this.color=new Color(color);this.intensity=intensity!==void 0?intensity:1;this.receiveShadow=void 0}Light.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Light,isLight:!0,copy:function copy(source){Object3D.prototype.copy.call(this,source);this.color.copy(source.color);this.intensity=source.intensity;return this},toJSON:function(meta){var data=Object3D.prototype.toJSON.call(this,meta);data.object.color=this.color.getHex();data.object.intensity=this.intensity;if(this.groundColor!==void 0)data.object.groundColor=this.groundColor.getHex();if(this.distance!==void 0)data.object.distance=this.distance;if(this.angle!==void 0)data.object.angle=this.angle;if(this.decay!==void 0)data.object.decay=this.decay;if(this.penumbra!==void 0)data.object.penumbra=this.penumbra;if(this.shadow!==void 0)data.object.shadow=this.shadow.toJSON();return data}});function HemisphereLight(skyColor,groundColor,intensity){Light.call(this,skyColor,intensity);this.type="HemisphereLight";this.castShadow=void 0;this.position.copy(Object3D.DefaultUp);this.updateMatrix();this.groundColor=new Color(groundColor)}HemisphereLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:HemisphereLight,isHemisphereLight:!0,copy:function copy(source){Light.prototype.copy.call(this,source);this.groundColor.copy(source.groundColor);return this}});function LightShadow(camera){this.camera=camera;this.bias=0;this.radius=1;this.mapSize=new Vector2(512,512);this.map=null;this.matrix=new Matrix4}Object.assign(LightShadow.prototype,{copy:function copy(source){this.camera=source.camera.clone();this.bias=source.bias;this.radius=source.radius;this.mapSize.copy(source.mapSize);return this},clone:function clone(){return new this.constructor().copy(this)},toJSON:function(){var object={};if(0!==this.bias)object.bias=this.bias;if(1!==this.radius)object.radius=this.radius;if(512!==this.mapSize.x||512!==this.mapSize.y)object.mapSize=this.mapSize.toArray();object.camera=this.camera.toJSON(!1).object;delete object.camera.matrix;return object}});function SpotLightShadow(){LightShadow.call(this,new PerspectiveCamera(50,1,.5,500))}SpotLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:SpotLightShadow,isSpotLightShadow:!0,update:function update(light){var camera=this.camera,fov=2*_Math.RAD2DEG*light.angle,aspect=this.mapSize.width/this.mapSize.height,far=light.distance||camera.far;if(fov!==camera.fov||aspect!==camera.aspect||far!==camera.far){camera.fov=fov;camera.aspect=aspect;camera.far=far;camera.updateProjectionMatrix()}}});function SpotLight(color,intensity,distance,angle,penumbra,decay){Light.call(this,color,intensity);this.type="SpotLight";this.position.copy(Object3D.DefaultUp);this.updateMatrix();this.target=new Object3D;Object.defineProperty(this,"power",{get:function get(){return this.intensity*_MathPI},set:function set(power){this.intensity=power/_MathPI}});this.distance=distance!==void 0?distance:0;this.angle=angle!==void 0?angle:_MathPI/3;this.penumbra=penumbra!==void 0?penumbra:0;this.decay=decay!==void 0?decay:1;this.shadow=new SpotLightShadow}SpotLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:SpotLight,isSpotLight:!0,copy:function copy(source){Light.prototype.copy.call(this,source);this.distance=source.distance;this.angle=source.angle;this.penumbra=source.penumbra;this.decay=source.decay;this.target=source.target.clone();this.shadow=source.shadow.clone();return this}});function PointLight(color,intensity,distance,decay){Light.call(this,color,intensity);this.type="PointLight";Object.defineProperty(this,"power",{get:function get(){return 4*this.intensity*_MathPI},set:function set(power){this.intensity=power/(4*_MathPI)}});this.distance=distance!==void 0?distance:0;this.decay=decay!==void 0?decay:1;this.shadow=new LightShadow(new PerspectiveCamera(90,1,.5,500))}PointLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:PointLight,isPointLight:!0,copy:function copy(source){Light.prototype.copy.call(this,source);this.distance=source.distance;this.decay=source.decay;this.shadow=source.shadow.clone();return this}});function DirectionalLightShadow(){LightShadow.call(this,new OrthographicCamera(-5,5,5,-5,.5,500))}DirectionalLightShadow.prototype=Object.assign(Object.create(LightShadow.prototype),{constructor:DirectionalLightShadow});function DirectionalLight(color,intensity){Light.call(this,color,intensity);this.type="DirectionalLight";this.position.copy(Object3D.DefaultUp);this.updateMatrix();this.target=new Object3D;this.shadow=new DirectionalLightShadow}DirectionalLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:DirectionalLight,isDirectionalLight:!0,copy:function copy(source){Light.prototype.copy.call(this,source);this.target=source.target.clone();this.shadow=source.shadow.clone();return this}});function AmbientLight(color,intensity){Light.call(this,color,intensity);this.type="AmbientLight";this.castShadow=void 0}AmbientLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:AmbientLight,isAmbientLight:!0});function RectAreaLight(color,intensity,width,height){Light.call(this,color,intensity);this.type="RectAreaLight";this.width=width!==void 0?width:10;this.height=height!==void 0?height:10}RectAreaLight.prototype=Object.assign(Object.create(Light.prototype),{constructor:RectAreaLight,isRectAreaLight:!0,copy:function copy(source){Light.prototype.copy.call(this,source);this.width=source.width;this.height=source.height;return this},toJSON:function(meta){var data=Light.prototype.toJSON.call(this,meta);data.object.width=this.width;data.object.height=this.height;return data}});function StringKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation)}StringKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:StringKeyframeTrack,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function BooleanKeyframeTrack(name,times,values){KeyframeTrack.call(this,name,times,values)}BooleanKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:BooleanKeyframeTrack,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:InterpolateDiscrete,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0});function Interpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){this.parameterPositions=parameterPositions;this._cachedIndex=0;this.resultBuffer=resultBuffer!==void 0?resultBuffer:new sampleValues.constructor(sampleSize);this.sampleValues=sampleValues;this.valueSize=sampleSize}Object.assign(Interpolant.prototype,{evaluate:function evaluate(t){var pp=this.parameterPositions,i1=this._cachedIndex,t1=pp[i1],t0=pp[i1-1];validate_interval:{seek:{var right;linear_scan:{forward_scan:if(!(t<t1)){for(var giveUpAt=i1+2;;){if(t1===void 0){if(t<t0)break forward_scan;i1=pp.length;this._cachedIndex=i1;return this.afterEnd_(i1-1,t,t0)}if(i1===giveUpAt)break;t0=t1;t1=pp[++i1];if(t<t1){break seek}}right=pp.length;break linear_scan}if(!(t>=t0)){var t1global=pp[1];if(t<t1global){i1=2;t0=t1global}for(var giveUpAt=i1-2;;){if(t0===void 0){this._cachedIndex=0;return this.beforeStart_(0,t,t1)}if(i1===giveUpAt)break;t1=t0;t0=pp[--i1-1];if(t>=t0){break seek}}right=i1;i1=0;break linear_scan}break validate_interval}while(i1<right){var mid=i1+right>>>1;if(t<pp[mid]){right=mid}else{i1=mid+1}}t1=pp[i1];t0=pp[i1-1];if(t0===void 0){this._cachedIndex=0;return this.beforeStart_(0,t,t1)}if(t1===void 0){i1=pp.length;this._cachedIndex=i1;return this.afterEnd_(i1-1,t0,t)}}this._cachedIndex=i1;this.intervalChanged_(i1,t0,t1)}return this.interpolate_(i1,t0,t,t1)},settings:null,DefaultSettings_:{},getSettings_:function getSettings_(){return this.settings||this.DefaultSettings_},copySampleValue_:function copySampleValue_(index){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,i=0;i!==stride;++i){result[i]=values[index*stride+i]}return result},interpolate_:function interpolate_(){throw new Error("call to abstract method")},intervalChanged_:function intervalChanged_(){}});Object.assign(Interpolant.prototype,{beforeStart_:Interpolant.prototype.copySampleValue_,afterEnd_:Interpolant.prototype.copySampleValue_});function QuaternionLinearInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer)}QuaternionLinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:QuaternionLinearInterpolant,interpolate_:function interpolate_(i1,t0,t,t1){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,offset=i1*stride,end=offset+stride;offset!==end;offset+=4){Quaternion.slerpFlat(result,0,values,offset-stride,values,offset,(t-t0)/(t1-t0))}return result}});function QuaternionKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation)}QuaternionKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:QuaternionKeyframeTrack,ValueTypeName:"quaternion",DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodLinear:function InterpolantFactoryMethodLinear(result){return new QuaternionLinearInterpolant(this.times,this.values,this.getValueSize(),result)},InterpolantFactoryMethodSmooth:void 0});function ColorKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation)}ColorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:ColorKeyframeTrack,ValueTypeName:"color"});function NumberKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation)}NumberKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:NumberKeyframeTrack,ValueTypeName:"number"});function CubicInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer);this._weightPrev=-0;this._offsetPrev=-0;this._weightNext=-0;this._offsetNext=-0}CubicInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:CubicInterpolant,DefaultSettings_:{endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},intervalChanged_:function intervalChanged_(i1,t0,t1){var pp=this.parameterPositions,iPrev=i1-2,iNext=i1+1,tPrev=pp[iPrev],tNext=pp[iNext];if(tPrev===void 0){switch(this.getSettings_().endingStart){case ZeroSlopeEnding:iPrev=i1;tPrev=2*t0-t1;break;case WrapAroundEnding:iPrev=pp.length-2;tPrev=t0+pp[iPrev]-pp[iPrev+1];break;default:iPrev=i1;tPrev=t1;}}if(tNext===void 0){switch(this.getSettings_().endingEnd){case ZeroSlopeEnding:iNext=i1;tNext=2*t1-t0;break;case WrapAroundEnding:iNext=1;tNext=t1+pp[1]-pp[0];break;default:iNext=i1-1;tNext=t0;}}var halfDt=.5*(t1-t0),stride=this.valueSize;this._weightPrev=halfDt/(t0-tPrev);this._weightNext=halfDt/(tNext-t1);this._offsetPrev=iPrev*stride;this._offsetNext=iNext*stride},interpolate_:function interpolate_(i1,t0,t,t1){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,o1=i1*stride,oP=this._offsetPrev,oN=this._offsetNext,wP=this._weightPrev,wN=this._weightNext,p=(t-t0)/(t1-t0),pp=p*p,ppp=pp*p,i=0;i!==stride;++i){result[i]=(-wP*ppp+2*wP*pp-wP*p)*values[oP+i]+((1+wP)*ppp+(-1.5-2*wP)*pp+(-.5+wP)*p+1)*values[o1-stride+i]+((-1-wN)*ppp+(1.5+wN)*pp+.5*p)*values[o1+i]+(wN*ppp-wN*pp)*values[oN+i]}return result}});function LinearInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer)}LinearInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:LinearInterpolant,interpolate_:function interpolate_(i1,t0,t,t1){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,offset1=i1*stride,weight1=(t-t0)/(t1-t0),i=0;i!==stride;++i){result[i]=values[offset1-stride+i]*(1-weight1)+values[offset1+i]*weight1}return result}});function DiscreteInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer)}DiscreteInterpolant.prototype=Object.assign(Object.create(Interpolant.prototype),{constructor:DiscreteInterpolant,interpolate_:function interpolate_(i1){return this.copySampleValue_(i1-1)}});var AnimationUtils={arraySlice:function arraySlice(array,from,to){if(AnimationUtils.isTypedArray(array)){return new array.constructor(array.subarray(from,to!==void 0?to:array.length))}return array.slice(from,to)},convertArray:function convertArray(array,type,forceClone){if(!array||!forceClone&&array.constructor===type)return array;if("number"===typeof type.BYTES_PER_ELEMENT){return new type(array)}return Array.prototype.slice.call(array)},isTypedArray:function isTypedArray(object){return ArrayBuffer.isView(object)&&!babelHelpers.instanceof(object,DataView)},getKeyframeOrder:function getKeyframeOrder(times){function compareTime(i,j){return times[i]-times[j]}for(var n=times.length,result=Array(n),i=0;i!==n;++i){result[i]=i}result.sort(compareTime);return result},sortedArray:function sortedArray(values,stride,order){for(var nValues=values.length,result=new values.constructor(nValues),i=0,dstOffset=0,srcOffset;dstOffset!==nValues;++i){srcOffset=order[i]*stride;for(var j=0;j!==stride;++j){result[dstOffset++]=values[srcOffset+j]}}return result},flattenJSON:function flattenJSON(jsonKeys,times,values,valuePropertyName){var i=1,key=jsonKeys[0];while(key!==void 0&&key[valuePropertyName]===void 0){key=jsonKeys[i++]}if(key===void 0)return;var value=key[valuePropertyName];if(value===void 0)return;if(Array.isArray(value)){do{value=key[valuePropertyName];if(value!==void 0){times.push(key.time);values.push.apply(values,value)}key=jsonKeys[i++]}while(key!==void 0)}else if(value.toArray!==void 0){do{value=key[valuePropertyName];if(value!==void 0){times.push(key.time);value.toArray(values,values.length)}key=jsonKeys[i++]}while(key!==void 0)}else{do{value=key[valuePropertyName];if(value!==void 0){times.push(key.time);values.push(value)}key=jsonKeys[i++]}while(key!==void 0)}}};function KeyframeTrack(name,times,values,interpolation){if(name===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(times===void 0||0===times.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+name);this.name=name;this.times=AnimationUtils.convertArray(times,this.TimeBufferType);this.values=AnimationUtils.convertArray(values,this.ValueBufferType);this.setInterpolation(interpolation||this.DefaultInterpolation);this.validate();this.optimize()}Object.assign(KeyframeTrack,{parse:function parse(json){if(json.type===void 0){throw new Error("THREE.KeyframeTrack: track type undefined, can not parse")}var trackType=KeyframeTrack._getTrackTypeForValueTypeName(json.type);if(json.times===void 0){var times=[],values=[];AnimationUtils.flattenJSON(json.keys,times,values,"value");json.times=times;json.values=values}if(trackType.parse!==void 0){return trackType.parse(json)}else{return new trackType(json.name,json.times,json.values,json.interpolation)}},toJSON:function(track){var trackType=track.constructor,json;if(trackType.toJSON!==void 0){json=trackType.toJSON(track)}else{json={name:track.name,times:AnimationUtils.convertArray(track.times,Array),values:AnimationUtils.convertArray(track.values,Array)};var interpolation=track.getInterpolation();if(interpolation!==track.DefaultInterpolation){json.interpolation=interpolation}}json.type=track.ValueTypeName;return json},_getTrackTypeForValueTypeName:function _getTrackTypeForValueTypeName(typeName){switch(typeName.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return NumberKeyframeTrack;case"vector":case"vector2":case"vector3":case"vector4":return VectorKeyframeTrack;case"color":return ColorKeyframeTrack;case"quaternion":return QuaternionKeyframeTrack;case"bool":case"boolean":return BooleanKeyframeTrack;case"string":return StringKeyframeTrack;}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+typeName)}});Object.assign(KeyframeTrack.prototype,{constructor:KeyframeTrack,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:InterpolateLinear,InterpolantFactoryMethodDiscrete:function InterpolantFactoryMethodDiscrete(result){return new DiscreteInterpolant(this.times,this.values,this.getValueSize(),result)},InterpolantFactoryMethodLinear:function InterpolantFactoryMethodLinear(result){return new LinearInterpolant(this.times,this.values,this.getValueSize(),result)},InterpolantFactoryMethodSmooth:function InterpolantFactoryMethodSmooth(result){return new CubicInterpolant(this.times,this.values,this.getValueSize(),result)},setInterpolation:function setInterpolation(interpolation){var factoryMethod;switch(interpolation){case InterpolateDiscrete:factoryMethod=this.InterpolantFactoryMethodDiscrete;break;case InterpolateLinear:factoryMethod=this.InterpolantFactoryMethodLinear;break;case InterpolateSmooth:factoryMethod=this.InterpolantFactoryMethodSmooth;break;}if(factoryMethod===void 0){var message="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(interpolation!==this.DefaultInterpolation){this.setInterpolation(this.DefaultInterpolation)}else{throw new Error(message)}}console.warn("THREE.KeyframeTrack:",message);return}this.createInterpolant=factoryMethod},getInterpolation:function getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return InterpolateDiscrete;case this.InterpolantFactoryMethodLinear:return InterpolateLinear;case this.InterpolantFactoryMethodSmooth:return InterpolateSmooth;}},getValueSize:function getValueSize(){return this.values.length/this.times.length},shift:function shift(timeOffset){if(0!==timeOffset){for(var times=this.times,i=0,n=times.length;i!==n;++i){times[i]+=timeOffset}}return this},scale:function scale(timeScale){if(1!==timeScale){for(var times=this.times,i=0,n=times.length;i!==n;++i){times[i]*=timeScale}}return this},trim:function trim(startTime,endTime){var times=this.times,nKeys=times.length,from=0,to=nKeys-1;while(from!==nKeys&&times[from]<startTime){++from}while(-1!==to&&times[to]>endTime){--to}++to;if(0!==from||to!==nKeys){if(from>=to)to=_Mathmax(to,1),from=to-1;var stride=this.getValueSize();this.times=AnimationUtils.arraySlice(times,from,to);this.values=AnimationUtils.arraySlice(this.values,from*stride,to*stride)}return this},validate:function validate(){var valid=!0,valueSize=this.getValueSize();if(0!==valueSize-_Mathfloor(valueSize)){console.error("THREE.KeyframeTrack: Invalid value size in track.",this);valid=!1}var times=this.times,values=this.values,nKeys=times.length;if(0===nKeys){console.error("THREE.KeyframeTrack: Track is empty.",this);valid=!1}for(var prevTime=null,i=0,currTime;i!==nKeys;i++){currTime=times[i];if("number"===typeof currTime&&isNaN(currTime)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,i,currTime);valid=!1;break}if(null!==prevTime&&prevTime>currTime){console.error("THREE.KeyframeTrack: Out of order keys.",this,i,currTime,prevTime);valid=!1;break}prevTime=currTime}if(values!==void 0){if(AnimationUtils.isTypedArray(values)){for(var i=0,n=values.length,value;i!==n;++i){value=values[i];if(isNaN(value)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,i,value);valid=!1;break}}}}return valid},optimize:function optimize(){for(var times=this.times,values=this.values,stride=this.getValueSize(),smoothInterpolation=this.getInterpolation()===InterpolateSmooth,writeIndex=1,lastIndex=times.length-1,i=1;i<lastIndex;++i){var keep=!1,time=times[i],timeNext=times[i+1];if(time!==timeNext&&(1!==i||time!==time[0])){if(!smoothInterpolation){for(var offset=i*stride,j=0,value;j!==stride;++j){value=values[offset+j];if(value!==values[offset-stride+j]||value!==values[offset+stride+j]){keep=!0;break}}}else{keep=!0}}if(keep){if(i!==writeIndex){times[writeIndex]=times[i];for(var readOffset=i*stride,writeOffset=writeIndex*stride,j=0;j!==stride;++j){values[writeOffset+j]=values[readOffset+j]}}++writeIndex}}if(0<lastIndex){times[writeIndex]=times[lastIndex];for(var readOffset=lastIndex*stride,writeOffset=writeIndex*stride,j=0;j!==stride;++j){values[writeOffset+j]=values[readOffset+j]}++writeIndex}if(writeIndex!==times.length){this.times=AnimationUtils.arraySlice(times,0,writeIndex);this.values=AnimationUtils.arraySlice(values,0,writeIndex*stride)}return this}});function VectorKeyframeTrack(name,times,values,interpolation){KeyframeTrack.call(this,name,times,values,interpolation)}VectorKeyframeTrack.prototype=Object.assign(Object.create(KeyframeTrack.prototype),{constructor:VectorKeyframeTrack,ValueTypeName:"vector"});function AnimationClip(name,duration,tracks){this.name=name;this.tracks=tracks;this.duration=duration!==void 0?duration:-1;this.uuid=_Math.generateUUID();if(0>this.duration){this.resetDuration()}this.optimize()}Object.assign(AnimationClip,{parse:function parse(json){for(var tracks=[],jsonTracks=json.tracks,frameTime=1/(json.fps||1),i=0,n=jsonTracks.length;i!==n;++i){tracks.push(KeyframeTrack.parse(jsonTracks[i]).scale(frameTime))}return new AnimationClip(json.name,json.duration,tracks)},toJSON:function(clip){for(var tracks=[],clipTracks=clip.tracks,json={name:clip.name,duration:clip.duration,tracks:tracks},i=0,n=clipTracks.length;i!==n;++i){tracks.push(KeyframeTrack.toJSON(clipTracks[i]))}return json},CreateFromMorphTargetSequence:function CreateFromMorphTargetSequence(name,morphTargetSequence,fps,noLoop){for(var numMorphTargets=morphTargetSequence.length,tracks=[],i=0;i<numMorphTargets;i++){var times=[],values=[];times.push((i+numMorphTargets-1)%numMorphTargets,i,(i+1)%numMorphTargets);values.push(0,1,0);var order=AnimationUtils.getKeyframeOrder(times);times=AnimationUtils.sortedArray(times,1,order);values=AnimationUtils.sortedArray(values,1,order);if(!noLoop&&0===times[0]){times.push(numMorphTargets);values.push(values[0])}tracks.push(new NumberKeyframeTrack(".morphTargetInfluences["+morphTargetSequence[i].name+"]",times,values).scale(1/fps))}return new AnimationClip(name,-1,tracks)},findByName:function findByName(objectOrClipArray,name){var clipArray=objectOrClipArray;if(!Array.isArray(objectOrClipArray)){var o=objectOrClipArray;clipArray=o.geometry&&o.geometry.animations||o.animations}for(var i=0;i<clipArray.length;i++){if(clipArray[i].name===name){return clipArray[i]}}return null},CreateClipsFromMorphTargetSequences:function CreateClipsFromMorphTargetSequences(morphTargets,fps,noLoop){for(var animationToMorphTargets={},pattern=/^([\w-]*?)([\d]+)$/,i=0,il=morphTargets.length;i<il;i++){var morphTarget=morphTargets[i],parts=morphTarget.name.match(pattern);if(parts&&1<parts.length){var name=parts[1],animationMorphTargets=animationToMorphTargets[name];if(!animationMorphTargets){animationToMorphTargets[name]=animationMorphTargets=[]}animationMorphTargets.push(morphTarget)}}var clips=[];for(var name in animationToMorphTargets){clips.push(AnimationClip.CreateFromMorphTargetSequence(name,animationToMorphTargets[name],fps,noLoop))}return clips},parseAnimation:function parseAnimation(animation,bones){if(!animation){console.error("THREE.AnimationClip: No animation in JSONLoader data.");return null}for(var addNonemptyTrack=function(trackType,trackName,animationKeys,propertyName,destTracks){if(0!==animationKeys.length){var times=[],values=[];AnimationUtils.flattenJSON(animationKeys,times,values,propertyName);if(0!==times.length){destTracks.push(new trackType(trackName,times,values))}}},tracks=[],clipName=animation.name||"default",duration=animation.length||-1,fps=animation.fps||30,hierarchyTracks=animation.hierarchy||[],h=0,animationKeys;h<hierarchyTracks.length;h++){animationKeys=hierarchyTracks[h].keys;if(!animationKeys||0===animationKeys.length)continue;if(animationKeys[0].morphTargets){for(var morphTargetNames={},k=0;k<animationKeys.length;k++){if(animationKeys[k].morphTargets){for(var m=0;m<animationKeys[k].morphTargets.length;m++){morphTargetNames[animationKeys[k].morphTargets[m]]=-1}}}for(var morphTargetName in morphTargetNames){for(var times=[],values=[],m=0,animationKey;m!==animationKeys[k].morphTargets.length;++m){animationKey=animationKeys[k];times.push(animationKey.time);values.push(animationKey.morphTarget===morphTargetName?1:0)}tracks.push(new NumberKeyframeTrack(".morphTargetInfluence["+morphTargetName+"]",times,values))}duration=morphTargetNames.length*(fps||1)}else{var boneName=".bones["+bones[h].name+"]";addNonemptyTrack(VectorKeyframeTrack,boneName+".position",animationKeys,"pos",tracks);addNonemptyTrack(QuaternionKeyframeTrack,boneName+".quaternion",animationKeys,"rot",tracks);addNonemptyTrack(VectorKeyframeTrack,boneName+".scale",animationKeys,"scl",tracks)}}if(0===tracks.length){return null}var clip=new AnimationClip(clipName,duration,tracks);return clip}});Object.assign(AnimationClip.prototype,{resetDuration:function resetDuration(){for(var tracks=this.tracks,duration=0,i=0,n=tracks.length,track;i!==n;++i){track=this.tracks[i];duration=_Mathmax(duration,track.times[track.times.length-1])}this.duration=duration},trim:function trim(){for(var i=0;i<this.tracks.length;i++){this.tracks[i].trim(0,this.duration)}return this},optimize:function optimize(){for(var i=0;i<this.tracks.length;i++){this.tracks[i].optimize()}return this}});function MaterialLoader(manager){this.manager=manager!==void 0?manager:DefaultLoadingManager;this.textures={}}Object.assign(MaterialLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this,loader=new FileLoader(scope.manager);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},setTextures:function setTextures(value){this.textures=value},parse:function parse(json){var textures=this.textures;function getTexture(name){if(textures[name]===void 0){console.warn("THREE.MaterialLoader: Undefined texture",name)}return textures[name]}var material=new Materials[json.type];if(json.uuid!==void 0)material.uuid=json.uuid;if(json.name!==void 0)material.name=json.name;if(json.color!==void 0)material.color.setHex(json.color);if(json.roughness!==void 0)material.roughness=json.roughness;if(json.metalness!==void 0)material.metalness=json.metalness;if(json.emissive!==void 0)material.emissive.setHex(json.emissive);if(json.specular!==void 0)material.specular.setHex(json.specular);if(json.shininess!==void 0)material.shininess=json.shininess;if(json.clearCoat!==void 0)material.clearCoat=json.clearCoat;if(json.clearCoatRoughness!==void 0)material.clearCoatRoughness=json.clearCoatRoughness;if(json.uniforms!==void 0)material.uniforms=json.uniforms;if(json.vertexShader!==void 0)material.vertexShader=json.vertexShader;if(json.fragmentShader!==void 0)material.fragmentShader=json.fragmentShader;if(json.vertexColors!==void 0)material.vertexColors=json.vertexColors;if(json.fog!==void 0)material.fog=json.fog;if(json.flatShading!==void 0)material.flatShading=json.flatShading;if(json.blending!==void 0)material.blending=json.blending;if(json.side!==void 0)material.side=json.side;if(json.opacity!==void 0)material.opacity=json.opacity;if(json.transparent!==void 0)material.transparent=json.transparent;if(json.alphaTest!==void 0)material.alphaTest=json.alphaTest;if(json.depthTest!==void 0)material.depthTest=json.depthTest;if(json.depthWrite!==void 0)material.depthWrite=json.depthWrite;if(json.colorWrite!==void 0)material.colorWrite=json.colorWrite;if(json.wireframe!==void 0)material.wireframe=json.wireframe;if(json.wireframeLinewidth!==void 0)material.wireframeLinewidth=json.wireframeLinewidth;if(json.wireframeLinecap!==void 0)material.wireframeLinecap=json.wireframeLinecap;if(json.wireframeLinejoin!==void 0)material.wireframeLinejoin=json.wireframeLinejoin;if(json.rotation!==void 0)material.rotation=json.rotation;if(1!==json.linewidth)material.linewidth=json.linewidth;if(json.dashSize!==void 0)material.dashSize=json.dashSize;if(json.gapSize!==void 0)material.gapSize=json.gapSize;if(json.scale!==void 0)material.scale=json.scale;if(json.skinning!==void 0)material.skinning=json.skinning;if(json.morphTargets!==void 0)material.morphTargets=json.morphTargets;if(json.dithering!==void 0)material.dithering=json.dithering;if(json.visible!==void 0)material.visible=json.visible;if(json.userData!==void 0)material.userData=json.userData;if(json.shading!==void 0)material.flatShading=1===json.shading;if(json.size!==void 0)material.size=json.size;if(json.sizeAttenuation!==void 0)material.sizeAttenuation=json.sizeAttenuation;if(json.map!==void 0)material.map=getTexture(json.map);if(json.alphaMap!==void 0){material.alphaMap=getTexture(json.alphaMap);material.transparent=!0}if(json.bumpMap!==void 0)material.bumpMap=getTexture(json.bumpMap);if(json.bumpScale!==void 0)material.bumpScale=json.bumpScale;if(json.normalMap!==void 0)material.normalMap=getTexture(json.normalMap);if(json.normalScale!==void 0){var normalScale=json.normalScale;if(!1===Array.isArray(normalScale)){normalScale=[normalScale,normalScale]}material.normalScale=new Vector2().fromArray(normalScale)}if(json.displacementMap!==void 0)material.displacementMap=getTexture(json.displacementMap);if(json.displacementScale!==void 0)material.displacementScale=json.displacementScale;if(json.displacementBias!==void 0)material.displacementBias=json.displacementBias;if(json.roughnessMap!==void 0)material.roughnessMap=getTexture(json.roughnessMap);if(json.metalnessMap!==void 0)material.metalnessMap=getTexture(json.metalnessMap);if(json.emissiveMap!==void 0)material.emissiveMap=getTexture(json.emissiveMap);if(json.emissiveIntensity!==void 0)material.emissiveIntensity=json.emissiveIntensity;if(json.specularMap!==void 0)material.specularMap=getTexture(json.specularMap);if(json.envMap!==void 0)material.envMap=getTexture(json.envMap);if(json.reflectivity!==void 0)material.reflectivity=json.reflectivity;if(json.lightMap!==void 0)material.lightMap=getTexture(json.lightMap);if(json.lightMapIntensity!==void 0)material.lightMapIntensity=json.lightMapIntensity;if(json.aoMap!==void 0)material.aoMap=getTexture(json.aoMap);if(json.aoMapIntensity!==void 0)material.aoMapIntensity=json.aoMapIntensity;if(json.gradientMap!==void 0)material.gradientMap=getTexture(json.gradientMap);return material}});function BufferGeometryLoader(manager){this.manager=manager!==void 0?manager:DefaultLoadingManager}Object.assign(BufferGeometryLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this,loader=new FileLoader(scope.manager);loader.load(url,function(text){onLoad(scope.parse(JSON.parse(text)))},onProgress,onError)},parse:function parse(json){var geometry=new BufferGeometry,index=json.data.index;if(index!==void 0){var typedArray=new TYPED_ARRAYS[index.type](index.array);geometry.setIndex(new BufferAttribute(typedArray,1))}var attributes=json.data.attributes;for(var key in attributes){var attribute=attributes[key],typedArray=new TYPED_ARRAYS[attribute.type](attribute.array);geometry.addAttribute(key,new BufferAttribute(typedArray,attribute.itemSize,attribute.normalized))}var groups=json.data.groups||json.data.drawcalls||json.data.offsets;if(groups!==void 0){for(var i=0,n=groups.length,group;i!==n;++i){group=groups[i];geometry.addGroup(group.start,group.count,group.materialIndex)}}var boundingSphere=json.data.boundingSphere;if(boundingSphere!==void 0){var center=new Vector3;if(boundingSphere.center!==void 0){center.fromArray(boundingSphere.center)}geometry.boundingSphere=new Sphere(center,boundingSphere.radius)}return geometry}});var TYPED_ARRAYS={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:"undefined"!==typeof Uint8ClampedArray?Uint8ClampedArray:Uint8Array,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function Loader(){this.onLoadStart=function(){};this.onLoadProgress=function(){};this.onLoadComplete=function(){}}Loader.Handlers={handlers:[],add:function add(regex,loader){this.handlers.push(regex,loader)},get:function get(file){for(var handlers=this.handlers,i=0,l=handlers.length;i<l;i+=2){var regex=handlers[i],loader=handlers[i+1];if(regex.test(file)){return loader}}return null}};Object.assign(Loader.prototype,{crossOrigin:void 0,initMaterials:function initMaterials(materials,texturePath,crossOrigin){for(var array=[],i=0;i<materials.length;++i){array[i]=this.createMaterial(materials[i],texturePath,crossOrigin)}return array},createMaterial:function(){var BlendingMode={NoBlending:NoBlending,NormalBlending:NormalBlending,AdditiveBlending:AdditiveBlending,SubtractiveBlending:SubtractiveBlending,MultiplyBlending:MultiplyBlending,CustomBlending:CustomBlending},color=new Color,textureLoader=new TextureLoader,materialLoader=new MaterialLoader;return function(m,texturePath,crossOrigin){var textures={};function loadTexture(path,repeat,offset,wrap,anisotropy){var fullPath=texturePath+path,loader=Loader.Handlers.get(fullPath),texture;if(null!==loader){texture=loader.load(fullPath)}else{textureLoader.setCrossOrigin(crossOrigin);texture=textureLoader.load(fullPath)}if(repeat!==void 0){texture.repeat.fromArray(repeat);if(1!==repeat[0])texture.wrapS=RepeatWrapping;if(1!==repeat[1])texture.wrapT=RepeatWrapping}if(offset!==void 0){texture.offset.fromArray(offset)}if(wrap!==void 0){if("repeat"===wrap[0])texture.wrapS=RepeatWrapping;if("mirror"===wrap[0])texture.wrapS=MirroredRepeatWrapping;if("repeat"===wrap[1])texture.wrapT=RepeatWrapping;if("mirror"===wrap[1])texture.wrapT=MirroredRepeatWrapping}if(anisotropy!==void 0){texture.anisotropy=anisotropy}var uuid=_Math.generateUUID();textures[uuid]=texture;return uuid}var json={uuid:_Math.generateUUID(),type:"MeshLambertMaterial"};for(var name in m){var value=m[name];switch(name){case"DbgColor":case"DbgIndex":case"opticalDensity":case"illumination":break;case"DbgName":json.name=value;break;case"blending":json.blending=BlendingMode[value];break;case"colorAmbient":case"mapAmbient":console.warn("THREE.Loader.createMaterial:",name,"is no longer supported.");break;case"colorDiffuse":json.color=color.fromArray(value).getHex();break;case"colorSpecular":json.specular=color.fromArray(value).getHex();break;case"colorEmissive":json.emissive=color.fromArray(value).getHex();break;case"specularCoef":json.shininess=value;break;case"shading":if("basic"===value.toLowerCase())json.type="MeshBasicMaterial";if("phong"===value.toLowerCase())json.type="MeshPhongMaterial";if("standard"===value.toLowerCase())json.type="MeshStandardMaterial";break;case"mapDiffuse":json.map=loadTexture(value,m.mapDiffuseRepeat,m.mapDiffuseOffset,m.mapDiffuseWrap,m.mapDiffuseAnisotropy);break;case"mapDiffuseRepeat":case"mapDiffuseOffset":case"mapDiffuseWrap":case"mapDiffuseAnisotropy":break;case"mapEmissive":json.emissiveMap=loadTexture(value,m.mapEmissiveRepeat,m.mapEmissiveOffset,m.mapEmissiveWrap,m.mapEmissiveAnisotropy);break;case"mapEmissiveRepeat":case"mapEmissiveOffset":case"mapEmissiveWrap":case"mapEmissiveAnisotropy":break;case"mapLight":json.lightMap=loadTexture(value,m.mapLightRepeat,m.mapLightOffset,m.mapLightWrap,m.mapLightAnisotropy);break;case"mapLightRepeat":case"mapLightOffset":case"mapLightWrap":case"mapLightAnisotropy":break;case"mapAO":json.aoMap=loadTexture(value,m.mapAORepeat,m.mapAOOffset,m.mapAOWrap,m.mapAOAnisotropy);break;case"mapAORepeat":case"mapAOOffset":case"mapAOWrap":case"mapAOAnisotropy":break;case"mapBump":json.bumpMap=loadTexture(value,m.mapBumpRepeat,m.mapBumpOffset,m.mapBumpWrap,m.mapBumpAnisotropy);break;case"mapBumpScale":json.bumpScale=value;break;case"mapBumpRepeat":case"mapBumpOffset":case"mapBumpWrap":case"mapBumpAnisotropy":break;case"mapNormal":json.normalMap=loadTexture(value,m.mapNormalRepeat,m.mapNormalOffset,m.mapNormalWrap,m.mapNormalAnisotropy);break;case"mapNormalFactor":json.normalScale=[value,value];break;case"mapNormalRepeat":case"mapNormalOffset":case"mapNormalWrap":case"mapNormalAnisotropy":break;case"mapSpecular":json.specularMap=loadTexture(value,m.mapSpecularRepeat,m.mapSpecularOffset,m.mapSpecularWrap,m.mapSpecularAnisotropy);break;case"mapSpecularRepeat":case"mapSpecularOffset":case"mapSpecularWrap":case"mapSpecularAnisotropy":break;case"mapMetalness":json.metalnessMap=loadTexture(value,m.mapMetalnessRepeat,m.mapMetalnessOffset,m.mapMetalnessWrap,m.mapMetalnessAnisotropy);break;case"mapMetalnessRepeat":case"mapMetalnessOffset":case"mapMetalnessWrap":case"mapMetalnessAnisotropy":break;case"mapRoughness":json.roughnessMap=loadTexture(value,m.mapRoughnessRepeat,m.mapRoughnessOffset,m.mapRoughnessWrap,m.mapRoughnessAnisotropy);break;case"mapRoughnessRepeat":case"mapRoughnessOffset":case"mapRoughnessWrap":case"mapRoughnessAnisotropy":break;case"mapAlpha":json.alphaMap=loadTexture(value,m.mapAlphaRepeat,m.mapAlphaOffset,m.mapAlphaWrap,m.mapAlphaAnisotropy);break;case"mapAlphaRepeat":case"mapAlphaOffset":case"mapAlphaWrap":case"mapAlphaAnisotropy":break;case"flipSided":json.side=BackSide;break;case"doubleSided":json.side=DoubleSide;break;case"transparency":console.warn("THREE.Loader.createMaterial: transparency has been renamed to opacity");json.opacity=value;break;case"depthTest":case"depthWrite":case"colorWrite":case"opacity":case"reflectivity":case"transparent":case"visible":case"wireframe":json[name]=value;break;case"vertexColors":if(!0===value)json.vertexColors=VertexColors;if("face"===value)json.vertexColors=FaceColors;break;default:console.error("THREE.Loader.createMaterial: Unsupported",name,value);break;}}if("MeshBasicMaterial"===json.type)delete json.emissive;if("MeshPhongMaterial"!==json.type)delete json.specular;if(1>json.opacity)json.transparent=!0;materialLoader.setTextures(textures);return materialLoader.parse(json)}}()});var LoaderUtils={decodeText:function decodeText(array){if("undefined"!==typeof TextDecoder){return new TextDecoder().decode(array)}for(var s="",i=0,il=array.length;i<il;i++){s+=_StringfromCharCode(array[i])}return decodeURIComponent(escape(s))},extractUrlBase:function extractUrlBase(url){var parts=url.split("/");if(1===parts.length)return"./";parts.pop();return parts.join("/")+"/"}};function JSONLoader(manager){if("boolean"===typeof manager){console.warn("THREE.JSONLoader: showStatus parameter has been removed from constructor.");manager=void 0}this.manager=manager!==void 0?manager:DefaultLoadingManager;this.withCredentials=!1}Object.assign(JSONLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this,texturePath=this.texturePath&&"string"===typeof this.texturePath?this.texturePath:LoaderUtils.extractUrlBase(url),loader=new FileLoader(this.manager);loader.setWithCredentials(this.withCredentials);loader.load(url,function(text){var json=JSON.parse(text),metadata=json.metadata;if(metadata!==void 0){var type=metadata.type;if(type!==void 0){if("object"===type.toLowerCase()){console.error("THREE.JSONLoader: "+url+" should be loaded with THREE.ObjectLoader instead.");return}if("scene"===type.toLowerCase()){console.error("THREE.JSONLoader: "+url+" should be loaded with THREE.SceneLoader instead.");return}}}var object=scope.parse(json,texturePath);onLoad(object.geometry,object.materials)},onProgress,onError)},setTexturePath:function setTexturePath(value){this.texturePath=value},parse:function(){function parseModel(json,geometry){function isBitSet(value,position){return value&1<<position}var i,j,fi,offset,zLength,colorIndex,normalIndex,uvIndex,materialIndex,type,isQuad,hasMaterial,hasFaceVertexUv,hasFaceNormal,hasFaceVertexNormal,hasFaceColor,hasFaceVertexColor,vertex,face,faceA,faceB,hex,normal,uvLayer,uv,u,v,faces=json.faces,vertices=json.vertices,normals=json.normals,colors=json.colors,scale=json.scale,nUvLayers=0;if(json.uvs!==void 0){for(i=0;i<json.uvs.length;i++){if(json.uvs[i].length)nUvLayers++}for(i=0;i<nUvLayers;i++){geometry.faceVertexUvs[i]=[]}}offset=0;zLength=vertices.length;while(offset<zLength){vertex=new Vector3;vertex.x=vertices[offset++]*scale;vertex.y=vertices[offset++]*scale;vertex.z=vertices[offset++]*scale;geometry.vertices.push(vertex)}offset=0;zLength=faces.length;while(offset<zLength){type=faces[offset++];isQuad=isBitSet(type,0);hasMaterial=isBitSet(type,1);hasFaceVertexUv=isBitSet(type,3);hasFaceNormal=isBitSet(type,4);hasFaceVertexNormal=isBitSet(type,5);hasFaceColor=isBitSet(type,6);hasFaceVertexColor=isBitSet(type,7);if(isQuad){faceA=new Face3;faceA.a=faces[offset];faceA.b=faces[offset+1];faceA.c=faces[offset+3];faceB=new Face3;faceB.a=faces[offset+1];faceB.b=faces[offset+2];faceB.c=faces[offset+3];offset+=4;if(hasMaterial){materialIndex=faces[offset++];faceA.materialIndex=materialIndex;faceB.materialIndex=materialIndex}fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];geometry.faceVertexUvs[i][fi+1]=[];for(j=0;4>j;j++){uvIndex=faces[offset++];u=uvLayer[2*uvIndex];v=uvLayer[2*uvIndex+1];uv=new Vector2(u,v);if(2!==j)geometry.faceVertexUvs[i][fi].push(uv);if(0!==j)geometry.faceVertexUvs[i][fi+1].push(uv)}}}if(hasFaceNormal){normalIndex=3*faces[offset++];faceA.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);faceB.normal.copy(faceA.normal)}if(hasFaceVertexNormal){for(i=0;4>i;i++){normalIndex=3*faces[offset++];normal=new Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);if(2!==i)faceA.vertexNormals.push(normal);if(0!==i)faceB.vertexNormals.push(normal)}}if(hasFaceColor){colorIndex=faces[offset++];hex=colors[colorIndex];faceA.color.setHex(hex);faceB.color.setHex(hex)}if(hasFaceVertexColor){for(i=0;4>i;i++){colorIndex=faces[offset++];hex=colors[colorIndex];if(2!==i)faceA.vertexColors.push(new Color(hex));if(0!==i)faceB.vertexColors.push(new Color(hex))}}geometry.faces.push(faceA);geometry.faces.push(faceB)}else{face=new Face3;face.a=faces[offset++];face.b=faces[offset++];face.c=faces[offset++];if(hasMaterial){materialIndex=faces[offset++];face.materialIndex=materialIndex}fi=geometry.faces.length;if(hasFaceVertexUv){for(i=0;i<nUvLayers;i++){uvLayer=json.uvs[i];geometry.faceVertexUvs[i][fi]=[];for(j=0;3>j;j++){uvIndex=faces[offset++];u=uvLayer[2*uvIndex];v=uvLayer[2*uvIndex+1];uv=new Vector2(u,v);geometry.faceVertexUvs[i][fi].push(uv)}}}if(hasFaceNormal){normalIndex=3*faces[offset++];face.normal.set(normals[normalIndex++],normals[normalIndex++],normals[normalIndex])}if(hasFaceVertexNormal){for(i=0;3>i;i++){normalIndex=3*faces[offset++];normal=new Vector3(normals[normalIndex++],normals[normalIndex++],normals[normalIndex]);face.vertexNormals.push(normal)}}if(hasFaceColor){colorIndex=faces[offset++];face.color.setHex(colors[colorIndex])}if(hasFaceVertexColor){for(i=0;3>i;i++){colorIndex=faces[offset++];face.vertexColors.push(new Color(colors[colorIndex]))}}geometry.faces.push(face)}}}function parseSkin(json,geometry){var influencesPerVertex=json.influencesPerVertex!==void 0?json.influencesPerVertex:2;if(json.skinWeights){for(var i=0,l=json.skinWeights.length;i<l;i+=influencesPerVertex){var x=json.skinWeights[i],y=1<influencesPerVertex?json.skinWeights[i+1]:0,z=2<influencesPerVertex?json.skinWeights[i+2]:0,w=3<influencesPerVertex?json.skinWeights[i+3]:0;geometry.skinWeights.push(new Vector4(x,y,z,w))}}if(json.skinIndices){for(var i=0,l=json.skinIndices.length;i<l;i+=influencesPerVertex){var a=json.skinIndices[i],b=1<influencesPerVertex?json.skinIndices[i+1]:0,c=2<influencesPerVertex?json.skinIndices[i+2]:0,d=3<influencesPerVertex?json.skinIndices[i+3]:0;geometry.skinIndices.push(new Vector4(a,b,c,d))}}geometry.bones=json.bones;if(geometry.bones&&0<geometry.bones.length&&(geometry.skinWeights.length!==geometry.skinIndices.length||geometry.skinIndices.length!==geometry.vertices.length)){console.warn("When skinning, number of vertices ("+geometry.vertices.length+"), skinIndices ("+geometry.skinIndices.length+"), and skinWeights ("+geometry.skinWeights.length+") should match.")}}function parseMorphing(json,geometry){var scale=json.scale;if(json.morphTargets!==void 0){for(var i=0,l=json.morphTargets.length;i<l;i++){geometry.morphTargets[i]={};geometry.morphTargets[i].name=json.morphTargets[i].name;geometry.morphTargets[i].vertices=[];for(var dstVertices=geometry.morphTargets[i].vertices,srcVertices=json.morphTargets[i].vertices,v=0,vl=srcVertices.length,vertex;v<vl;v+=3){vertex=new Vector3;vertex.x=srcVertices[v]*scale;vertex.y=srcVertices[v+1]*scale;vertex.z=srcVertices[v+2]*scale;dstVertices.push(vertex)}}}if(json.morphColors!==void 0&&0<json.morphColors.length){console.warn("THREE.JSONLoader: \"morphColors\" no longer supported. Using them as face colors.");for(var faces=geometry.faces,morphColors=json.morphColors[0].colors,i=0,l=faces.length;i<l;i++){faces[i].color.fromArray(morphColors,3*i)}}}function parseAnimations(json,geometry){var outputAnimations=[],animations=[];if(json.animation!==void 0){animations.push(json.animation)}if(json.animations!==void 0){if(json.animations.length){animations=animations.concat(json.animations)}else{animations.push(json.animations)}}for(var i=0,clip;i<animations.length;i++){clip=AnimationClip.parseAnimation(animations[i],geometry.bones);if(clip)outputAnimations.push(clip)}if(geometry.morphTargets){var morphAnimationClips=AnimationClip.CreateClipsFromMorphTargetSequences(geometry.morphTargets,10);outputAnimations=outputAnimations.concat(morphAnimationClips)}if(0<outputAnimations.length)geometry.animations=outputAnimations}return function(json,texturePath){if(json.data!==void 0){json=json.data}if(json.scale!==void 0){json.scale=1/json.scale}else{json.scale=1}var geometry=new Geometry;parseModel(json,geometry);parseSkin(json,geometry);parseMorphing(json,geometry);parseAnimations(json,geometry);geometry.computeFaceNormals();geometry.computeBoundingSphere();if(json.materials===void 0||0===json.materials.length){return{geometry:geometry}}else{var materials=Loader.prototype.initMaterials(json.materials,texturePath,this.crossOrigin);return{geometry:geometry,materials:materials}}}}()});function ObjectLoader(manager){this.manager=manager!==void 0?manager:DefaultLoadingManager;this.texturePath=""}Object.assign(ObjectLoader.prototype,{load:function load(url,onLoad,onProgress,onError){if(""===this.texturePath){this.texturePath=url.substring(0,url.lastIndexOf("/")+1)}var scope=this,loader=new FileLoader(scope.manager);loader.load(url,function(text){var json=null;try{json=JSON.parse(text)}catch(error){if(onError!==void 0)onError(error);console.error("THREE:ObjectLoader: Can't parse "+url+".",error.message);return}var metadata=json.metadata;if(metadata===void 0||metadata.type===void 0||"geometry"===metadata.type.toLowerCase()){console.error("THREE.ObjectLoader: Can't load "+url+". Use THREE.JSONLoader instead.");return}scope.parse(json,onLoad)},onProgress,onError)},setTexturePath:function setTexturePath(value){this.texturePath=value},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value},parse:function parse(json,onLoad){var shapes=this.parseShape(json.shapes),geometries=this.parseGeometries(json.geometries,shapes),images=this.parseImages(json.images,function(){if(onLoad!==void 0)onLoad(object)}),textures=this.parseTextures(json.textures,images),materials=this.parseMaterials(json.materials,textures),object=this.parseObject(json.object,geometries,materials);if(json.animations){object.animations=this.parseAnimations(json.animations)}if(json.images===void 0||0===json.images.length){if(onLoad!==void 0)onLoad(object)}return object},parseShape:function parseShape(json){var shapes={};if(json!==void 0){for(var i=0,l=json.length,shape;i<l;i++){shape=new Shape().fromJSON(json[i]);shapes[shape.uuid]=shape}}return shapes},parseGeometries:function parseGeometries(json,shapes){var geometries={};if(json!==void 0){for(var geometryLoader=new JSONLoader,bufferGeometryLoader=new BufferGeometryLoader,i=0,l=json.length;i<l;i++){var geometry,data=json[i];switch(data.type){case"PlaneGeometry":case"PlaneBufferGeometry":geometry=new Geometries[data.type](data.width,data.height,data.widthSegments,data.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":geometry=new Geometries[data.type](data.width,data.height,data.depth,data.widthSegments,data.heightSegments,data.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":geometry=new Geometries[data.type](data.radius,data.segments,data.thetaStart,data.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":geometry=new Geometries[data.type](data.radiusTop,data.radiusBottom,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":geometry=new Geometries[data.type](data.radius,data.height,data.radialSegments,data.heightSegments,data.openEnded,data.thetaStart,data.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":geometry=new Geometries[data.type](data.radius,data.widthSegments,data.heightSegments,data.phiStart,data.phiLength,data.thetaStart,data.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":geometry=new Geometries[data.type](data.radius,data.detail);break;case"RingGeometry":case"RingBufferGeometry":geometry=new Geometries[data.type](data.innerRadius,data.outerRadius,data.thetaSegments,data.phiSegments,data.thetaStart,data.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":geometry=new Geometries[data.type](data.radius,data.tube,data.radialSegments,data.tubularSegments,data.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":geometry=new Geometries[data.type](data.radius,data.tube,data.tubularSegments,data.radialSegments,data.p,data.q);break;case"LatheGeometry":case"LatheBufferGeometry":geometry=new Geometries[data.type](data.points,data.segments,data.phiStart,data.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":geometry=new Geometries[data.type](data.vertices,data.indices,data.radius,data.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var geometryShapes=[],i=0,l=data.shapes.length,shape;i<l;i++){shape=shapes[data.shapes[i]];geometryShapes.push(shape)}geometry=new Geometries[data.type](geometryShapes,data.curveSegments);break;case"BufferGeometry":geometry=bufferGeometryLoader.parse(data);break;case"Geometry":geometry=geometryLoader.parse(data,this.texturePath).geometry;break;default:console.warn("THREE.ObjectLoader: Unsupported geometry type \""+data.type+"\"");continue;}geometry.uuid=data.uuid;if(data.name!==void 0)geometry.name=data.name;geometries[data.uuid]=geometry}}return geometries},parseMaterials:function parseMaterials(json,textures){var materials={};if(json!==void 0){var loader=new MaterialLoader;loader.setTextures(textures);for(var i=0,l=json.length,data;i<l;i++){data=json[i];if("MultiMaterial"===data.type){for(var array=[],j=0;j<data.materials.length;j++){array.push(loader.parse(data.materials[j]))}materials[data.uuid]=array}else{materials[data.uuid]=loader.parse(data)}}}return materials},parseAnimations:function parseAnimations(json){for(var animations=[],i=0,clip;i<json.length;i++){clip=AnimationClip.parse(json[i]);animations.push(clip)}return animations},parseImages:function parseImages(json,onLoad){var scope=this,images={};function loadImage(url){scope.manager.itemStart(url);return loader.load(url,function(){scope.manager.itemEnd(url)},void 0,function(){scope.manager.itemEnd(url);scope.manager.itemError(url)})}if(json!==void 0&&0<json.length){var manager=new LoadingManager(onLoad),loader=new ImageLoader(manager);loader.setCrossOrigin(this.crossOrigin);for(var i=0,l=json.length;i<l;i++){var image=json[i],path=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(image.url)?image.url:scope.texturePath+image.url;images[image.uuid]=loadImage(path)}}return images},parseTextures:function parseTextures(json,images){function parseConstant(value,type){if("number"===typeof value)return value;console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",value);return type[value]}var textures={};if(json!==void 0){for(var i=0,l=json.length,data;i<l;i++){data=json[i];if(data.image===void 0){console.warn("THREE.ObjectLoader: No \"image\" specified for",data.uuid)}if(images[data.image]===void 0){console.warn("THREE.ObjectLoader: Undefined image",data.image)}var texture=new Texture(images[data.image]);texture.needsUpdate=!0;texture.uuid=data.uuid;if(data.name!==void 0)texture.name=data.name;if(data.mapping!==void 0)texture.mapping=parseConstant(data.mapping,TEXTURE_MAPPING);if(data.offset!==void 0)texture.offset.fromArray(data.offset);if(data.repeat!==void 0)texture.repeat.fromArray(data.repeat);if(data.center!==void 0)texture.center.fromArray(data.center);if(data.rotation!==void 0)texture.rotation=data.rotation;if(data.wrap!==void 0){texture.wrapS=parseConstant(data.wrap[0],TEXTURE_WRAPPING);texture.wrapT=parseConstant(data.wrap[1],TEXTURE_WRAPPING)}if(data.minFilter!==void 0)texture.minFilter=parseConstant(data.minFilter,TEXTURE_FILTER);if(data.magFilter!==void 0)texture.magFilter=parseConstant(data.magFilter,TEXTURE_FILTER);if(data.anisotropy!==void 0)texture.anisotropy=data.anisotropy;if(data.flipY!==void 0)texture.flipY=data.flipY;textures[data.uuid]=texture}}return textures},parseObject:function parseObject(data,geometries,materials){var object;function getGeometry(name){if(geometries[name]===void 0){console.warn("THREE.ObjectLoader: Undefined geometry",name)}return geometries[name]}function getMaterial(name){if(name===void 0)return;if(Array.isArray(name)){for(var array=[],i=0,l=name.length,uuid;i<l;i++){uuid=name[i];if(materials[uuid]===void 0){console.warn("THREE.ObjectLoader: Undefined material",uuid)}array.push(materials[uuid])}return array}if(materials[name]===void 0){console.warn("THREE.ObjectLoader: Undefined material",name)}return materials[name]}switch(data.type){case"Scene":object=new Scene;if(data.background!==void 0){if(_NumberisInteger(data.background)){object.background=new Color(data.background)}}if(data.fog!==void 0){if("Fog"===data.fog.type){object.fog=new Fog(data.fog.color,data.fog.near,data.fog.far)}else if("FogExp2"===data.fog.type){object.fog=new FogExp2(data.fog.color,data.fog.density)}}break;case"PerspectiveCamera":object=new PerspectiveCamera(data.fov,data.aspect,data.near,data.far);if(data.focus!==void 0)object.focus=data.focus;if(data.zoom!==void 0)object.zoom=data.zoom;if(data.filmGauge!==void 0)object.filmGauge=data.filmGauge;if(data.filmOffset!==void 0)object.filmOffset=data.filmOffset;if(data.view!==void 0)object.view=Object.assign({},data.view);break;case"OrthographicCamera":object=new OrthographicCamera(data.left,data.right,data.top,data.bottom,data.near,data.far);break;case"AmbientLight":object=new AmbientLight(data.color,data.intensity);break;case"DirectionalLight":object=new DirectionalLight(data.color,data.intensity);break;case"PointLight":object=new PointLight(data.color,data.intensity,data.distance,data.decay);break;case"RectAreaLight":object=new RectAreaLight(data.color,data.intensity,data.width,data.height);break;case"SpotLight":object=new SpotLight(data.color,data.intensity,data.distance,data.angle,data.penumbra,data.decay);break;case"HemisphereLight":object=new HemisphereLight(data.color,data.groundColor,data.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var geometry=getGeometry(data.geometry),material=getMaterial(data.material);if(geometry.bones&&0<geometry.bones.length){object=new SkinnedMesh(geometry,material)}else{object=new Mesh(geometry,material)}break;case"LOD":object=new LOD;break;case"Line":object=new Line(getGeometry(data.geometry),getMaterial(data.material),data.mode);break;case"LineLoop":object=new LineLoop(getGeometry(data.geometry),getMaterial(data.material));break;case"LineSegments":object=new LineSegments(getGeometry(data.geometry),getMaterial(data.material));break;case"PointCloud":case"Points":object=new Points(getGeometry(data.geometry),getMaterial(data.material));break;case"Sprite":object=new Sprite(getMaterial(data.material));break;case"Group":object=new Group;break;default:object=new Object3D;}object.uuid=data.uuid;if(data.name!==void 0)object.name=data.name;if(data.matrix!==void 0){object.matrix.fromArray(data.matrix);object.matrix.decompose(object.position,object.quaternion,object.scale)}else{if(data.position!==void 0)object.position.fromArray(data.position);if(data.rotation!==void 0)object.rotation.fromArray(data.rotation);if(data.quaternion!==void 0)object.quaternion.fromArray(data.quaternion);if(data.scale!==void 0)object.scale.fromArray(data.scale)}if(data.castShadow!==void 0)object.castShadow=data.castShadow;if(data.receiveShadow!==void 0)object.receiveShadow=data.receiveShadow;if(data.shadow){if(data.shadow.bias!==void 0)object.shadow.bias=data.shadow.bias;if(data.shadow.radius!==void 0)object.shadow.radius=data.shadow.radius;if(data.shadow.mapSize!==void 0)object.shadow.mapSize.fromArray(data.shadow.mapSize);if(data.shadow.camera!==void 0)object.shadow.camera=this.parseObject(data.shadow.camera)}if(data.visible!==void 0)object.visible=data.visible;if(data.userData!==void 0)object.userData=data.userData;if(data.children!==void 0){for(var children=data.children,i=0;i<children.length;i++){object.add(this.parseObject(children[i],geometries,materials))}}if("LOD"===data.type){for(var levels=data.levels,l=0;l<levels.length;l++){var level=levels[l],child=object.getObjectByProperty("uuid",level.object);if(child!==void 0){object.addLevel(child,level.distance)}}}return object}});var TEXTURE_MAPPING={UVMapping:UVMapping,CubeReflectionMapping:CubeReflectionMapping,CubeRefractionMapping:CubeRefractionMapping,EquirectangularReflectionMapping:EquirectangularReflectionMapping,EquirectangularRefractionMapping:EquirectangularRefractionMapping,SphericalReflectionMapping:SphericalReflectionMapping,CubeUVReflectionMapping:CubeUVReflectionMapping,CubeUVRefractionMapping:CubeUVRefractionMapping},TEXTURE_WRAPPING={RepeatWrapping:RepeatWrapping,ClampToEdgeWrapping:ClampToEdgeWrapping,MirroredRepeatWrapping:MirroredRepeatWrapping},TEXTURE_FILTER={NearestFilter:NearestFilter,NearestMipMapNearestFilter:NearestMipMapNearestFilter,NearestMipMapLinearFilter:NearestMipMapLinearFilter,LinearFilter:LinearFilter,LinearMipMapNearestFilter:LinearMipMapNearestFilter,LinearMipMapLinearFilter:LinearMipMapLinearFilter};function ImageBitmapLoader(manager){if("undefined"===typeof createImageBitmap){console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported.")}if("undefined"===typeof fetch){console.warn("THREE.ImageBitmapLoader: fetch() not supported.")}this.manager=manager!==void 0?manager:DefaultLoadingManager;this.options=void 0}ImageBitmapLoader.prototype={constructor:ImageBitmapLoader,setOptions:function(options){this.options=options;return this},load:function(url,onLoad,onProgress,onError){if(url===void 0)url="";if(this.path!==void 0)url=this.path+url;var scope=this,cached=Cache.get(url);if(cached!==void 0){scope.manager.itemStart(url);setTimeout(function(){if(onLoad)onLoad(cached);scope.manager.itemEnd(url)},0);return cached}fetch(url).then(function(res){return res.blob()}).then(function(blob){return createImageBitmap(blob,scope.options)}).then(function(imageBitmap){Cache.add(url,imageBitmap);if(onLoad)onLoad(imageBitmap);scope.manager.itemEnd(url)}).catch(function(e){if(onError)onError(e);scope.manager.itemEnd(url);scope.manager.itemError(url)})},setCrossOrigin:function setCrossOrigin(){return this},setPath:function setPath(value){this.path=value;return this}};function ShapePath(){this.type="ShapePath";this.subPaths=[];this.currentPath=null}Object.assign(ShapePath.prototype,{moveTo:function moveTo(x,y){this.currentPath=new Path;this.subPaths.push(this.currentPath);this.currentPath.moveTo(x,y)},lineTo:function lineTo(x,y){this.currentPath.lineTo(x,y)},quadraticCurveTo:function quadraticCurveTo(aCPx,aCPy,aX,aY){this.currentPath.quadraticCurveTo(aCPx,aCPy,aX,aY)},bezierCurveTo:function bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY){this.currentPath.bezierCurveTo(aCP1x,aCP1y,aCP2x,aCP2y,aX,aY)},splineThru:function splineThru(pts){this.currentPath.splineThru(pts)},toShapes:function toShapes(isCCW,noHoles){function toShapesNoHoles(inSubpaths){for(var shapes=[],i=0,l=inSubpaths.length;i<l;i++){var tmpPath=inSubpaths[i],tmpShape=new Shape;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape)}return shapes}function isPointInsidePolygon(inPt,inPolygon){for(var polyLen=inPolygon.length,inside=!1,p=polyLen-1,q=0;q<polyLen;p=q++){var edgeLowPt=inPolygon[p],edgeHighPt=inPolygon[q],edgeDx=edgeHighPt.x-edgeLowPt.x,edgeDy=edgeHighPt.y-edgeLowPt.y;if(_Mathabs(edgeDy)>_NumberEPSILON){if(0>edgeDy){edgeLowPt=inPolygon[q];edgeDx=-edgeDx;edgeHighPt=inPolygon[p];edgeDy=-edgeDy}if(inPt.y<edgeLowPt.y||inPt.y>edgeHighPt.y)continue;if(inPt.y===edgeLowPt.y){if(inPt.x===edgeLowPt.x)return!0}else{var perpEdge=edgeDy*(inPt.x-edgeLowPt.x)-edgeDx*(inPt.y-edgeLowPt.y);if(0===perpEdge)return!0;if(0>perpEdge)continue;inside=!inside}}else{if(inPt.y!==edgeLowPt.y)continue;if(edgeHighPt.x<=inPt.x&&inPt.x<=edgeLowPt.x||edgeLowPt.x<=inPt.x&&inPt.x<=edgeHighPt.x)return!0}}return inside}var isClockWise=ShapeUtils.isClockWise,subPaths=this.subPaths;if(0===subPaths.length)return[];if(!0===noHoles)return toShapesNoHoles(subPaths);var solid,tmpPath,tmpShape,shapes=[];if(1===subPaths.length){tmpPath=subPaths[0];tmpShape=new Shape;tmpShape.curves=tmpPath.curves;shapes.push(tmpShape);return shapes}var holesFirst=!isClockWise(subPaths[0].getPoints());holesFirst=isCCW?!holesFirst:holesFirst;var betterShapeHoles=[],newShapes=[],newShapeHoles=[],mainIdx=0,tmpPoints;newShapes[mainIdx]=void 0;newShapeHoles[mainIdx]=[];for(var i=0,l=subPaths.length;i<l;i++){tmpPath=subPaths[i];tmpPoints=tmpPath.getPoints();solid=isClockWise(tmpPoints);solid=isCCW?!solid:solid;if(solid){if(!holesFirst&&newShapes[mainIdx])mainIdx++;newShapes[mainIdx]={s:new Shape,p:tmpPoints};newShapes[mainIdx].s.curves=tmpPath.curves;if(holesFirst)mainIdx++;newShapeHoles[mainIdx]=[]}else{newShapeHoles[mainIdx].push({h:tmpPath,p:tmpPoints[0]})}}if(!newShapes[0])return toShapesNoHoles(subPaths);if(1<newShapes.length){for(var ambiguous=!1,toChange=[],sIdx=0,sLen=newShapes.length;sIdx<sLen;sIdx++){betterShapeHoles[sIdx]=[]}for(var sIdx=0,sLen=newShapes.length,sho;sIdx<sLen;sIdx++){sho=newShapeHoles[sIdx];for(var hIdx=0;hIdx<sho.length;hIdx++){for(var ho=sho[hIdx],hole_unassigned=!0,s2Idx=0;s2Idx<newShapes.length;s2Idx++){if(isPointInsidePolygon(ho.p,newShapes[s2Idx].p)){if(sIdx!==s2Idx)toChange.push({froms:sIdx,tos:s2Idx,hole:hIdx});if(hole_unassigned){hole_unassigned=!1;betterShapeHoles[s2Idx].push(ho)}else{ambiguous=!0}}}if(hole_unassigned){betterShapeHoles[sIdx].push(ho)}}}if(0<toChange.length){if(!ambiguous)newShapeHoles=betterShapeHoles}}for(var tmpHoles,i=0,il=newShapes.length;i<il;i++){tmpShape=newShapes[i].s;shapes.push(tmpShape);tmpHoles=newShapeHoles[i];for(var j=0,jl=tmpHoles.length;j<jl;j++){tmpShape.holes.push(tmpHoles[j].h)}}return shapes}});function Font(data){this.type="Font";this.data=data}Object.assign(Font.prototype,{isFont:!0,generateShapes:function generateShapes(text,size,divisions){if(size===void 0)size=100;if(divisions===void 0)divisions=4;for(var shapes=[],paths=createPaths(text,size,divisions,this.data),p=0,pl=paths.length;p<pl;p++){Array.prototype.push.apply(shapes,paths[p].toShapes())}return shapes}});function createPaths(text,size,divisions,data){for(var chars=(text+"").split(""),scale=size/data.resolution,line_height=(data.boundingBox.yMax-data.boundingBox.yMin+data.underlineThickness)*scale,paths=[],offsetX=0,offsetY=0,i=0,char;i<chars.length;i++){char=chars[i];if("\n"===char){offsetX=0;offsetY-=line_height}else{var ret=createPath(char,divisions,scale,offsetX,offsetY,data);offsetX+=ret.offsetX;paths.push(ret.path)}}return paths}function createPath(char,divisions,scale,offsetX,offsetY,data){var glyph=data.glyphs[char]||data.glyphs["?"];if(!glyph)return;var path=new ShapePath,x,y,cpx,cpy,cpx1,cpy1,cpx2,cpy2;if(glyph.o){for(var outline=glyph._cachedOutline||(glyph._cachedOutline=glyph.o.split(" ")),i=0,l=outline.length,action;i<l;){action=outline[i++];switch(action){case"m":x=outline[i++]*scale+offsetX;y=outline[i++]*scale+offsetY;path.moveTo(x,y);break;case"l":x=outline[i++]*scale+offsetX;y=outline[i++]*scale+offsetY;path.lineTo(x,y);break;case"q":cpx=outline[i++]*scale+offsetX;cpy=outline[i++]*scale+offsetY;cpx1=outline[i++]*scale+offsetX;cpy1=outline[i++]*scale+offsetY;path.quadraticCurveTo(cpx1,cpy1,cpx,cpy);break;case"b":cpx=outline[i++]*scale+offsetX;cpy=outline[i++]*scale+offsetY;cpx1=outline[i++]*scale+offsetX;cpy1=outline[i++]*scale+offsetY;cpx2=outline[i++]*scale+offsetX;cpy2=outline[i++]*scale+offsetY;path.bezierCurveTo(cpx1,cpy1,cpx2,cpy2,cpx,cpy);break;}}}return{offsetX:glyph.ha*scale,path:path}}function FontLoader(manager){this.manager=manager!==void 0?manager:DefaultLoadingManager}Object.assign(FontLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var scope=this,loader=new FileLoader(this.manager);loader.setPath(this.path);loader.load(url,function(text){var json;try{json=JSON.parse(text)}catch(e){console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead.");json=JSON.parse(text.substring(65,text.length-2))}var font=scope.parse(json);if(onLoad)onLoad(font)},onProgress,onError)},parse:function parse(json){return new Font(json)},setPath:function setPath(value){this.path=value;return this}});var context,AudioContext={getContext:function getContext(){if(context===void 0){context=new(window.AudioContext||window.webkitAudioContext)}return context},setContext:function setContext(value){context=value}};function AudioLoader(manager){this.manager=manager!==void 0?manager:DefaultLoadingManager}Object.assign(AudioLoader.prototype,{load:function load(url,onLoad,onProgress,onError){var loader=new FileLoader(this.manager);loader.setResponseType("arraybuffer");loader.load(url,function(buffer){var context=AudioContext.getContext();context.decodeAudioData(buffer,function(audioBuffer){onLoad(audioBuffer)})},onProgress,onError)}});function StereoCamera(){this.type="StereoCamera";this.aspect=1;this.eyeSep=.064;this.cameraL=new PerspectiveCamera;this.cameraL.layers.enable(1);this.cameraL.matrixAutoUpdate=!1;this.cameraR=new PerspectiveCamera;this.cameraR.layers.enable(2);this.cameraR.matrixAutoUpdate=!1}Object.assign(StereoCamera.prototype,{update:function(){var instance,focus,fov,aspect,near,far,zoom,eyeSep,eyeRight=new Matrix4,eyeLeft=new Matrix4;return function(camera){var needsUpdate=instance!==this||focus!==camera.focus||fov!==camera.fov||aspect!==camera.aspect*this.aspect||near!==camera.near||far!==camera.far||zoom!==camera.zoom||eyeSep!==this.eyeSep;if(needsUpdate){instance=this;focus=camera.focus;fov=camera.fov;aspect=camera.aspect*this.aspect;near=camera.near;far=camera.far;zoom=camera.zoom;var projectionMatrix=camera.projectionMatrix.clone();eyeSep=this.eyeSep/2;var eyeSepOnProjection=eyeSep*near/focus,ymax=near*_Mathtan(.5*(_Math.DEG2RAD*fov))/zoom,xmin,xmax;eyeLeft.elements[12]=-eyeSep;eyeRight.elements[12]=eyeSep;xmin=-ymax*aspect+eyeSepOnProjection;xmax=ymax*aspect+eyeSepOnProjection;projectionMatrix.elements[0]=2*near/(xmax-xmin);projectionMatrix.elements[8]=(xmax+xmin)/(xmax-xmin);this.cameraL.projectionMatrix.copy(projectionMatrix);xmin=-ymax*aspect-eyeSepOnProjection;xmax=ymax*aspect-eyeSepOnProjection;projectionMatrix.elements[0]=2*near/(xmax-xmin);projectionMatrix.elements[8]=(xmax+xmin)/(xmax-xmin);this.cameraR.projectionMatrix.copy(projectionMatrix)}this.cameraL.matrixWorld.copy(camera.matrixWorld).multiply(eyeLeft);this.cameraR.matrixWorld.copy(camera.matrixWorld).multiply(eyeRight)}}()});function CubeCamera(near,far,cubeResolution){Object3D.call(this);this.type="CubeCamera";var fov=90,aspect=1,cameraPX=new PerspectiveCamera(fov,aspect,near,far);cameraPX.up.set(0,-1,0);cameraPX.lookAt(new Vector3(1,0,0));this.add(cameraPX);var cameraNX=new PerspectiveCamera(fov,aspect,near,far);cameraNX.up.set(0,-1,0);cameraNX.lookAt(new Vector3(-1,0,0));this.add(cameraNX);var cameraPY=new PerspectiveCamera(fov,aspect,near,far);cameraPY.up.set(0,0,1);cameraPY.lookAt(new Vector3(0,1,0));this.add(cameraPY);var cameraNY=new PerspectiveCamera(fov,aspect,near,far);cameraNY.up.set(0,0,-1);cameraNY.lookAt(new Vector3(0,-1,0));this.add(cameraNY);var cameraPZ=new PerspectiveCamera(fov,aspect,near,far);cameraPZ.up.set(0,-1,0);cameraPZ.lookAt(new Vector3(0,0,1));this.add(cameraPZ);var cameraNZ=new PerspectiveCamera(fov,aspect,near,far);cameraNZ.up.set(0,-1,0);cameraNZ.lookAt(new Vector3(0,0,-1));this.add(cameraNZ);this.renderTarget=new WebGLRenderTargetCube(cubeResolution,cubeResolution,{format:RGBFormat,magFilter:LinearFilter,minFilter:LinearFilter});this.renderTarget.texture.name="CubeCamera";this.update=function(renderer,scene){if(null===this.parent)this.updateMatrixWorld();var renderTarget=this.renderTarget,generateMipmaps=renderTarget.texture.generateMipmaps;renderTarget.texture.generateMipmaps=!1;renderTarget.activeCubeFace=0;renderer.render(scene,cameraPX,renderTarget);renderTarget.activeCubeFace=1;renderer.render(scene,cameraNX,renderTarget);renderTarget.activeCubeFace=2;renderer.render(scene,cameraPY,renderTarget);renderTarget.activeCubeFace=3;renderer.render(scene,cameraNY,renderTarget);renderTarget.activeCubeFace=4;renderer.render(scene,cameraPZ,renderTarget);renderTarget.texture.generateMipmaps=generateMipmaps;renderTarget.activeCubeFace=5;renderer.render(scene,cameraNZ,renderTarget);renderer.setRenderTarget(null)};this.clear=function(renderer,color,depth,stencil){for(var renderTarget=this.renderTarget,i=0;6>i;i++){renderTarget.activeCubeFace=i;renderer.setRenderTarget(renderTarget);renderer.clear(color,depth,stencil)}renderer.setRenderTarget(null)}}CubeCamera.prototype=Object.create(Object3D.prototype);CubeCamera.prototype.constructor=CubeCamera;function AudioListener(){Object3D.call(this);this.type="AudioListener";this.context=AudioContext.getContext();this.gain=this.context.createGain();this.gain.connect(this.context.destination);this.filter=null}AudioListener.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:AudioListener,getInput:function getInput(){return this.gain},removeFilter:function removeFilter(){if(null!==this.filter){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination);this.gain.connect(this.context.destination);this.filter=null}},getFilter:function getFilter(){return this.filter},setFilter:function setFilter(value){if(null!==this.filter){this.gain.disconnect(this.filter);this.filter.disconnect(this.context.destination)}else{this.gain.disconnect(this.context.destination)}this.filter=value;this.gain.connect(this.filter);this.filter.connect(this.context.destination)},getMasterVolume:function getMasterVolume(){return this.gain.gain.value},setMasterVolume:function setMasterVolume(value){this.gain.gain.value=value},updateMatrixWorld:function(){var position=new Vector3,quaternion=new Quaternion,scale=new Vector3,orientation=new Vector3;return function(force){Object3D.prototype.updateMatrixWorld.call(this,force);var listener=this.context.listener,up=this.up;this.matrixWorld.decompose(position,quaternion,scale);orientation.set(0,0,-1).applyQuaternion(quaternion);if(listener.positionX){listener.positionX.setValueAtTime(position.x,this.context.currentTime);listener.positionY.setValueAtTime(position.y,this.context.currentTime);listener.positionZ.setValueAtTime(position.z,this.context.currentTime);listener.forwardX.setValueAtTime(orientation.x,this.context.currentTime);listener.forwardY.setValueAtTime(orientation.y,this.context.currentTime);listener.forwardZ.setValueAtTime(orientation.z,this.context.currentTime);listener.upX.setValueAtTime(up.x,this.context.currentTime);listener.upY.setValueAtTime(up.y,this.context.currentTime);listener.upZ.setValueAtTime(up.z,this.context.currentTime)}else{listener.setPosition(position.x,position.y,position.z);listener.setOrientation(orientation.x,orientation.y,orientation.z,up.x,up.y,up.z)}}}()});function Audio(listener){Object3D.call(this);this.type="Audio";this.context=listener.context;this.gain=this.context.createGain();this.gain.connect(listener.getInput());this.autoplay=!1;this.buffer=null;this.loop=!1;this.startTime=0;this.offset=0;this.playbackRate=1;this.isPlaying=!1;this.hasPlaybackControl=!0;this.sourceType="empty";this.filters=[]}Audio.prototype=Object.assign(Object.create(Object3D.prototype),{constructor:Audio,getOutput:function getOutput(){return this.gain},setNodeSource:function setNodeSource(audioNode){this.hasPlaybackControl=!1;this.sourceType="audioNode";this.source=audioNode;this.connect();return this},setBuffer:function setBuffer(audioBuffer){this.buffer=audioBuffer;this.sourceType="buffer";if(this.autoplay)this.play();return this},play:function play(){if(!0===this.isPlaying){console.warn("THREE.Audio: Audio is already playing.");return}if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}var source=this.context.createBufferSource();source.buffer=this.buffer;source.loop=this.loop;source.onended=this.onEnded.bind(this);source.playbackRate.setValueAtTime(this.playbackRate,this.startTime);this.startTime=this.context.currentTime;source.start(this.startTime,this.offset);this.isPlaying=!0;this.source=source;return this.connect()},pause:function pause(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}if(!0===this.isPlaying){this.source.stop();this.offset+=(this.context.currentTime-this.startTime)*this.playbackRate;this.isPlaying=!1}return this},stop:function stop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this.source.stop();this.offset=0;this.isPlaying=!1;return this},connect:function connect(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var i=1,l=this.filters.length;i<l;i++){this.filters[i-1].connect(this.filters[i])}this.filters[this.filters.length-1].connect(this.getOutput())}else{this.source.connect(this.getOutput())}return this},disconnect:function disconnect(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var i=1,l=this.filters.length;i<l;i++){this.filters[i-1].disconnect(this.filters[i])}this.filters[this.filters.length-1].disconnect(this.getOutput())}else{this.source.disconnect(this.getOutput())}return this},getFilters:function getFilters(){return this.filters},setFilters:function setFilters(value){if(!value)value=[];if(!0===this.isPlaying){this.disconnect();this.filters=value;this.connect()}else{this.filters=value}return this},getFilter:function getFilter(){return this.getFilters()[0]},setFilter:function setFilter(filter){return this.setFilters(filter?[filter]:[])},setPlaybackRate:function setPlaybackRate(value){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this.playbackRate=value;if(!0===this.isPlaying){this.source.playbackRate.setValueAtTime(this.playbackRate,this.context.currentTime)}return this},getPlaybackRate:function getPlaybackRate(){return this.playbackRate},onEnded:function onEnded(){this.isPlaying=!1},getLoop:function getLoop(){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return!1}return this.loop},setLoop:function setLoop(value){if(!1===this.hasPlaybackControl){console.warn("THREE.Audio: this Audio has no playback control.");return}this.loop=value;if(!0===this.isPlaying){this.source.loop=this.loop}return this},getVolume:function getVolume(){return this.gain.gain.value},setVolume:function setVolume(value){this.gain.gain.value=value;return this}});function PositionalAudio(listener){Audio.call(this,listener);this.panner=this.context.createPanner();this.panner.connect(this.gain)}PositionalAudio.prototype=Object.assign(Object.create(Audio.prototype),{constructor:PositionalAudio,getOutput:function getOutput(){return this.panner},getRefDistance:function getRefDistance(){return this.panner.refDistance},setRefDistance:function setRefDistance(value){this.panner.refDistance=value},getRolloffFactor:function getRolloffFactor(){return this.panner.rolloffFactor},setRolloffFactor:function setRolloffFactor(value){this.panner.rolloffFactor=value},getDistanceModel:function getDistanceModel(){return this.panner.distanceModel},setDistanceModel:function setDistanceModel(value){this.panner.distanceModel=value},getMaxDistance:function getMaxDistance(){return this.panner.maxDistance},setMaxDistance:function setMaxDistance(value){this.panner.maxDistance=value},updateMatrixWorld:function(){var position=new Vector3;return function(force){Object3D.prototype.updateMatrixWorld.call(this,force);position.setFromMatrixPosition(this.matrixWorld);this.panner.setPosition(position.x,position.y,position.z)}}()});function AudioAnalyser(audio,fftSize){this.analyser=audio.context.createAnalyser();this.analyser.fftSize=fftSize!==void 0?fftSize:2048;this.data=new Uint8Array(this.analyser.frequencyBinCount);audio.getOutput().connect(this.analyser)}Object.assign(AudioAnalyser.prototype,{getFrequencyData:function getFrequencyData(){this.analyser.getByteFrequencyData(this.data);return this.data},getAverageFrequency:function getAverageFrequency(){for(var value=0,data=this.getFrequencyData(),i=0;i<data.length;i++){value+=data[i]}return value/data.length}});function PropertyMixer(binding,typeName,valueSize){this.binding=binding;this.valueSize=valueSize;var bufferType=Float64Array,mixFunction;switch(typeName){case"quaternion":mixFunction=this._slerp;break;case"string":case"bool":bufferType=Array;mixFunction=this._select;break;default:mixFunction=this._lerp;}this.buffer=new bufferType(4*valueSize);this._mixBufferRegion=mixFunction;this.cumulativeWeight=0;this.useCount=0;this.referenceCount=0}Object.assign(PropertyMixer.prototype,{accumulate:function accumulate(accuIndex,weight){var buffer=this.buffer,stride=this.valueSize,offset=accuIndex*stride+stride,currentWeight=this.cumulativeWeight;if(0===currentWeight){for(var i=0;i!==stride;++i){buffer[offset+i]=buffer[i]}currentWeight=weight}else{currentWeight+=weight;var mix=weight/currentWeight;this._mixBufferRegion(buffer,offset,0,mix,stride)}this.cumulativeWeight=currentWeight},apply:function apply(accuIndex){var stride=this.valueSize,buffer=this.buffer,offset=accuIndex*stride+stride,weight=this.cumulativeWeight,binding=this.binding;this.cumulativeWeight=0;if(1>weight){this._mixBufferRegion(buffer,offset,3*stride,1-weight,stride)}for(var i=stride;i!==stride+stride;++i){if(buffer[i]!==buffer[i+stride]){binding.setValue(buffer,offset);break}}},saveOriginalState:function saveOriginalState(){var binding=this.binding,buffer=this.buffer,stride=this.valueSize,originalValueOffset=3*stride;binding.getValue(buffer,originalValueOffset);for(var i=stride;i!==originalValueOffset;++i){buffer[i]=buffer[originalValueOffset+i%stride]}this.cumulativeWeight=0},restoreOriginalState:function restoreOriginalState(){var originalValueOffset=3*this.valueSize;this.binding.setValue(this.buffer,originalValueOffset)},_select:function _select(buffer,dstOffset,srcOffset,t,stride){if(.5<=t){for(var i=0;i!==stride;++i){buffer[dstOffset+i]=buffer[srcOffset+i]}}},_slerp:function _slerp(buffer,dstOffset,srcOffset,t){Quaternion.slerpFlat(buffer,dstOffset,buffer,dstOffset,buffer,srcOffset,t)},_lerp:function _lerp(buffer,dstOffset,srcOffset,t,stride){for(var i=0,j;i!==stride;++i){j=dstOffset+i;buffer[j]=buffer[j]*(1-t)+buffer[srcOffset+i]*t}}});var RESERVED_CHARS_RE="\\[\\]\\.:\\/";function Composite(targetGroup,path,optionalParsedPath){var parsedPath=optionalParsedPath||PropertyBinding.parseTrackName(path);this._targetGroup=targetGroup;this._bindings=targetGroup.subscribe_(path,parsedPath)}Object.assign(Composite.prototype,{getValue:function getValue(array,offset){this.bind();var firstValidIndex=this._targetGroup.nCachedObjects_,binding=this._bindings[firstValidIndex];if(binding!==void 0)binding.getValue(array,offset)},setValue:function setValue(array,offset){for(var bindings=this._bindings,i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i){bindings[i].setValue(array,offset)}},bind:function bind(){for(var bindings=this._bindings,i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i){bindings[i].bind()}},unbind:function unbind(){for(var bindings=this._bindings,i=this._targetGroup.nCachedObjects_,n=bindings.length;i!==n;++i){bindings[i].unbind()}}});function PropertyBinding(rootNode,path,parsedPath){this.path=path;this.parsedPath=parsedPath||PropertyBinding.parseTrackName(path);this.node=PropertyBinding.findNode(rootNode,this.parsedPath.nodeName)||rootNode;this.rootNode=rootNode}Object.assign(PropertyBinding,{Composite:Composite,create:function create(root,path,parsedPath){if(!(root&&root.isAnimationObjectGroup)){return new PropertyBinding(root,path,parsedPath)}else{return new PropertyBinding.Composite(root,path,parsedPath)}},sanitizeNodeName:function(){var reservedRe=/[\[\]\.:\/]/g;return function(name){return name.replace(/\s/g,"_").replace(reservedRe,"")}}(),parseTrackName:function(){var wordChar="[^"+RESERVED_CHARS_RE+"]",wordCharOrDot="[^"+RESERVED_CHARS_RE.replace("\\.","")+"]",directoryRe=/((?:WC+[\/:])*)/.source.replace("WC",wordChar),nodeRe=/(WCOD+)?/.source.replace("WCOD",wordCharOrDot),objectRe=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",wordChar),propertyRe=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",wordChar),trackRe=new RegExp(""+"^"+directoryRe+nodeRe+objectRe+propertyRe+"$"),supportedObjectNames=["material","materials","bones"];return function(trackName){var matches=trackRe.exec(trackName);if(!matches){throw new Error("PropertyBinding: Cannot parse trackName: "+trackName)}var results={nodeName:matches[2],objectName:matches[3],objectIndex:matches[4],propertyName:matches[5],propertyIndex:matches[6]},lastDot=results.nodeName&&results.nodeName.lastIndexOf(".");if(lastDot!==void 0&&-1!==lastDot){var objectName=results.nodeName.substring(lastDot+1);if(-1!==supportedObjectNames.indexOf(objectName)){results.nodeName=results.nodeName.substring(0,lastDot);results.objectName=objectName}}if(null===results.propertyName||0===results.propertyName.length){throw new Error("PropertyBinding: can not parse propertyName from trackName: "+trackName)}return results}}(),findNode:function findNode(root,nodeName){if(!nodeName||""===nodeName||"root"===nodeName||"."===nodeName||-1===nodeName||nodeName===root.name||nodeName===root.uuid){return root}if(root.skeleton){var bone=root.skeleton.getBoneByName(nodeName);if(bone!==void 0){return bone}}if(root.children){var searchNodeSubtree=function(children){for(var i=0,childNode;i<children.length;i++){childNode=children[i];if(childNode.name===nodeName||childNode.uuid===nodeName){return childNode}var result=searchNodeSubtree(childNode.children);if(result)return result}return null},subTreeNode=searchNodeSubtree(root.children);if(subTreeNode){return subTreeNode}}return null}});Object.assign(PropertyBinding.prototype,{_getValue_unavailable:function _getValue_unavailable(){},_setValue_unavailable:function _setValue_unavailable(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(buffer,offset){buffer[offset]=this.node[this.propertyName]},function(buffer,offset){for(var source=this.resolvedProperty,i=0,n=source.length;i!==n;++i){buffer[offset++]=source[i]}},function(buffer,offset){buffer[offset]=this.resolvedProperty[this.propertyIndex]},function(buffer,offset){this.resolvedProperty.toArray(buffer,offset)}],SetterByBindingTypeAndVersioning:[[function(buffer,offset){this.targetObject[this.propertyName]=buffer[offset]},function(buffer,offset){this.targetObject[this.propertyName]=buffer[offset];this.targetObject.needsUpdate=!0},function(buffer,offset){this.targetObject[this.propertyName]=buffer[offset];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(buffer,offset){for(var dest=this.resolvedProperty,i=0,n=dest.length;i!==n;++i){dest[i]=buffer[offset++]}},function(buffer,offset){for(var dest=this.resolvedProperty,i=0,n=dest.length;i!==n;++i){dest[i]=buffer[offset++]}this.targetObject.needsUpdate=!0},function(buffer,offset){for(var dest=this.resolvedProperty,i=0,n=dest.length;i!==n;++i){dest[i]=buffer[offset++]}this.targetObject.matrixWorldNeedsUpdate=!0}],[function(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset]},function(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset];this.targetObject.needsUpdate=!0},function(buffer,offset){this.resolvedProperty[this.propertyIndex]=buffer[offset];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(buffer,offset){this.resolvedProperty.fromArray(buffer,offset)},function(buffer,offset){this.resolvedProperty.fromArray(buffer,offset);this.targetObject.needsUpdate=!0},function(buffer,offset){this.resolvedProperty.fromArray(buffer,offset);this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(targetArray,offset){this.bind();this.getValue(targetArray,offset)},setValue:function(sourceArray,offset){this.bind();this.setValue(sourceArray,offset)},bind:function bind(){var targetObject=this.node,parsedPath=this.parsedPath,objectName=parsedPath.objectName,propertyName=parsedPath.propertyName,propertyIndex=parsedPath.propertyIndex;if(!targetObject){targetObject=PropertyBinding.findNode(this.rootNode,parsedPath.nodeName)||this.rootNode;this.node=targetObject}this.getValue=this._getValue_unavailable;this.setValue=this._setValue_unavailable;if(!targetObject){console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.");return}if(objectName){var objectIndex=parsedPath.objectIndex;switch(objectName){case"materials":if(!targetObject.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!targetObject.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}targetObject=targetObject.material.materials;break;case"bones":if(!targetObject.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}targetObject=targetObject.skeleton.bones;for(var i=0;i<targetObject.length;i++){if(targetObject[i].name===objectIndex){objectIndex=i;break}}break;default:if(targetObject[objectName]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}targetObject=targetObject[objectName];}if(objectIndex!==void 0){if(targetObject[objectIndex]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,targetObject);return}targetObject=targetObject[objectIndex]}}var nodeProperty=targetObject[propertyName];if(nodeProperty===void 0){var nodeName=parsedPath.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+nodeName+"."+propertyName+" but it wasn't found.",targetObject);return}var versioning=this.Versioning.None;if(targetObject.needsUpdate!==void 0){versioning=this.Versioning.NeedsUpdate;this.targetObject=targetObject}else if(targetObject.matrixWorldNeedsUpdate!==void 0){versioning=this.Versioning.MatrixWorldNeedsUpdate;this.targetObject=targetObject}var bindingType=this.BindingType.Direct;if(propertyIndex!==void 0){if("morphTargetInfluences"===propertyName){if(!targetObject.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(targetObject.geometry.isBufferGeometry){if(!targetObject.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}for(var i=0;i<this.node.geometry.morphAttributes.position.length;i++){if(targetObject.geometry.morphAttributes.position[i].name===propertyIndex){propertyIndex=i;break}}}else{if(!targetObject.geometry.morphTargets){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);return}for(var i=0;i<this.node.geometry.morphTargets.length;i++){if(targetObject.geometry.morphTargets[i].name===propertyIndex){propertyIndex=i;break}}}}bindingType=this.BindingType.ArrayElement;this.resolvedProperty=nodeProperty;this.propertyIndex=propertyIndex}else if(nodeProperty.fromArray!==void 0&&nodeProperty.toArray!==void 0){bindingType=this.BindingType.HasFromToArray;this.resolvedProperty=nodeProperty}else if(Array.isArray(nodeProperty)){bindingType=this.BindingType.EntireArray;this.resolvedProperty=nodeProperty}else{this.propertyName=propertyName}this.getValue=this.GetterByBindingType[bindingType];this.setValue=this.SetterByBindingTypeAndVersioning[bindingType][versioning]},unbind:function unbind(){this.node=null;this.getValue=this._getValue_unbound;this.setValue=this._setValue_unbound}});Object.assign(PropertyBinding.prototype,{_getValue_unbound:PropertyBinding.prototype.getValue,_setValue_unbound:PropertyBinding.prototype.setValue});function AnimationObjectGroup(){this.uuid=_Math.generateUUID();this._objects=Array.prototype.slice.call(arguments);this.nCachedObjects_=0;var indices={};this._indicesByUUID=indices;for(var i=0,n=arguments.length;i!==n;++i){indices[arguments[i].uuid]=i}this._paths=[];this._parsedPaths=[];this._bindings=[];this._bindingsIndicesByPath={};var scope=this;this.stats={objects:{get total(){return scope._objects.length},get inUse(){return this.total-scope.nCachedObjects_}},get bindingsPerObject(){return scope._bindings.length}}}Object.assign(AnimationObjectGroup.prototype,{isAnimationObjectGroup:!0,add:function add(){for(var objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,paths=this._paths,parsedPaths=this._parsedPaths,bindings=this._bindings,nBindings=bindings.length,knownObject=void 0,i=0,n=arguments.length;i!==n;++i){var object=arguments[i],uuid=object.uuid,index=indicesByUUID[uuid];if(index===void 0){index=nObjects++;indicesByUUID[uuid]=index;objects.push(object);for(var j=0,m=nBindings;j!==m;++j){bindings[j].push(new PropertyBinding(object,paths[j],parsedPaths[j]))}}else if(index<nCachedObjects){knownObject=objects[index];var firstActiveIndex=--nCachedObjects,lastCachedObject=objects[firstActiveIndex];indicesByUUID[lastCachedObject.uuid]=index;objects[index]=lastCachedObject;indicesByUUID[uuid]=firstActiveIndex;objects[firstActiveIndex]=object;for(var j=0,m=nBindings;j!==m;++j){var bindingsForPath=bindings[j],lastCached=bindingsForPath[firstActiveIndex],binding=bindingsForPath[index];bindingsForPath[index]=lastCached;if(binding===void 0){binding=new PropertyBinding(object,paths[j],parsedPaths[j])}bindingsForPath[firstActiveIndex]=binding}}else if(objects[index]!==knownObject){console.error("THREE.AnimationObjectGroup: Different objects with the same UUID "+"detected. Clean the caches or recreate your infrastructure when reloading scenes.")}}this.nCachedObjects_=nCachedObjects},remove:function remove(){for(var objects=this._objects,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,bindings=this._bindings,nBindings=bindings.length,i=0,n=arguments.length;i!==n;++i){var object=arguments[i],uuid=object.uuid,index=indicesByUUID[uuid];if(index!==void 0&&index>=nCachedObjects){var lastCachedIndex=nCachedObjects++,firstActiveObject=objects[lastCachedIndex];indicesByUUID[firstActiveObject.uuid]=index;objects[index]=firstActiveObject;indicesByUUID[uuid]=lastCachedIndex;objects[lastCachedIndex]=object;for(var j=0;j!==nBindings;++j){var bindingsForPath=bindings[j],firstActive=bindingsForPath[lastCachedIndex],binding=bindingsForPath[index];bindingsForPath[index]=firstActive;bindingsForPath[lastCachedIndex]=binding}}}this.nCachedObjects_=nCachedObjects},uncache:function uncache(){for(var objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,indicesByUUID=this._indicesByUUID,bindings=this._bindings,nBindings=bindings.length,i=0,n=arguments.length;i!==n;++i){var object=arguments[i],uuid=object.uuid,index=indicesByUUID[uuid];if(index!==void 0){delete indicesByUUID[uuid];if(index<nCachedObjects){var firstActiveIndex=--nCachedObjects,lastCachedObject=objects[firstActiveIndex],lastIndex=--nObjects,lastObject=objects[lastIndex];indicesByUUID[lastCachedObject.uuid]=index;objects[index]=lastCachedObject;indicesByUUID[lastObject.uuid]=firstActiveIndex;objects[firstActiveIndex]=lastObject;objects.pop();for(var j=0,m=nBindings;j!==m;++j){var bindingsForPath=bindings[j],lastCached=bindingsForPath[firstActiveIndex],last=bindingsForPath[lastIndex];bindingsForPath[index]=lastCached;bindingsForPath[firstActiveIndex]=last;bindingsForPath.pop()}}else{var lastIndex=--nObjects,lastObject=objects[lastIndex];indicesByUUID[lastObject.uuid]=index;objects[index]=lastObject;objects.pop();for(var j=0,m=nBindings,bindingsForPath;j!==m;++j){bindingsForPath=bindings[j];bindingsForPath[index]=bindingsForPath[lastIndex];bindingsForPath.pop()}}}}this.nCachedObjects_=nCachedObjects},subscribe_:function subscribe_(path,parsedPath){var indicesByPath=this._bindingsIndicesByPath,index=indicesByPath[path],bindings=this._bindings;if(index!==void 0)return bindings[index];var paths=this._paths,parsedPaths=this._parsedPaths,objects=this._objects,nObjects=objects.length,nCachedObjects=this.nCachedObjects_,bindingsForPath=Array(nObjects);index=bindings.length;indicesByPath[path]=index;paths.push(path);parsedPaths.push(parsedPath);bindings.push(bindingsForPath);for(var i=nCachedObjects,n=objects.length,object;i!==n;++i){object=objects[i];bindingsForPath[i]=new PropertyBinding(object,path,parsedPath)}return bindingsForPath},unsubscribe_:function unsubscribe_(path){var indicesByPath=this._bindingsIndicesByPath,index=indicesByPath[path];if(index!==void 0){var paths=this._paths,parsedPaths=this._parsedPaths,bindings=this._bindings,lastBindingsIndex=bindings.length-1,lastBindings=bindings[lastBindingsIndex],lastBindingsPath=path[lastBindingsIndex];indicesByPath[lastBindingsPath]=index;bindings[index]=lastBindings;bindings.pop();parsedPaths[index]=parsedPaths[lastBindingsIndex];parsedPaths.pop();paths[index]=paths[lastBindingsIndex];paths.pop()}}});function AnimationAction(mixer,clip,localRoot){this._mixer=mixer;this._clip=clip;this._localRoot=localRoot||null;for(var tracks=clip.tracks,nTracks=tracks.length,interpolants=Array(nTracks),interpolantSettings={endingStart:ZeroCurvatureEnding,endingEnd:ZeroCurvatureEnding},i=0,interpolant;i!==nTracks;++i){interpolant=tracks[i].createInterpolant(null);interpolants[i]=interpolant;interpolant.settings=interpolantSettings}this._interpolantSettings=interpolantSettings;this._interpolants=interpolants;this._propertyBindings=Array(nTracks);this._cacheIndex=null;this._byClipCacheIndex=null;this._timeScaleInterpolant=null;this._weightInterpolant=null;this.loop=LoopRepeat;this._loopCount=-1;this._startTime=null;this.time=0;this.timeScale=1;this._effectiveTimeScale=1;this.weight=1;this._effectiveWeight=1;this.repetitions=1/0;this.paused=!1;this.enabled=!0;this.clampWhenFinished=!1;this.zeroSlopeAtStart=!0;this.zeroSlopeAtEnd=!0}Object.assign(AnimationAction.prototype,{play:function play(){this._mixer._activateAction(this);return this},stop:function stop(){this._mixer._deactivateAction(this);return this.reset()},reset:function reset(){this.paused=!1;this.enabled=!0;this.time=0;this._loopCount=-1;this._startTime=null;return this.stopFading().stopWarping()},isRunning:function isRunning(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)},isScheduled:function isScheduled(){return this._mixer._isActiveAction(this)},startAt:function startAt(time){this._startTime=time;return this},setLoop:function setLoop(mode,repetitions){this.loop=mode;this.repetitions=repetitions;return this},setEffectiveWeight:function setEffectiveWeight(weight){this.weight=weight;this._effectiveWeight=this.enabled?weight:0;return this.stopFading()},getEffectiveWeight:function getEffectiveWeight(){return this._effectiveWeight},fadeIn:function fadeIn(duration){return this._scheduleFading(duration,0,1)},fadeOut:function fadeOut(duration){return this._scheduleFading(duration,1,0)},crossFadeFrom:function crossFadeFrom(fadeOutAction,duration,warp){fadeOutAction.fadeOut(duration);this.fadeIn(duration);if(warp){var fadeInDuration=this._clip.duration,fadeOutDuration=fadeOutAction._clip.duration;fadeOutAction.warp(1,fadeOutDuration/fadeInDuration,duration);this.warp(fadeInDuration/fadeOutDuration,1,duration)}return this},crossFadeTo:function crossFadeTo(fadeInAction,duration,warp){return fadeInAction.crossFadeFrom(this,duration,warp)},stopFading:function stopFading(){var weightInterpolant=this._weightInterpolant;if(null!==weightInterpolant){this._weightInterpolant=null;this._mixer._takeBackControlInterpolant(weightInterpolant)}return this},setEffectiveTimeScale:function setEffectiveTimeScale(timeScale){this.timeScale=timeScale;this._effectiveTimeScale=this.paused?0:timeScale;return this.stopWarping()},getEffectiveTimeScale:function getEffectiveTimeScale(){return this._effectiveTimeScale},setDuration:function setDuration(duration){this.timeScale=this._clip.duration/duration;return this.stopWarping()},syncWith:function syncWith(action){this.time=action.time;this.timeScale=action.timeScale;return this.stopWarping()},halt:function halt(duration){return this.warp(this._effectiveTimeScale,0,duration)},warp:function warp(startTimeScale,endTimeScale,duration){var mixer=this._mixer,now=mixer.time,interpolant=this._timeScaleInterpolant,timeScale=this.timeScale;if(null===interpolant){interpolant=mixer._lendControlInterpolant();this._timeScaleInterpolant=interpolant}var times=interpolant.parameterPositions,values=interpolant.sampleValues;times[0]=now;times[1]=now+duration;values[0]=startTimeScale/timeScale;values[1]=endTimeScale/timeScale;return this},stopWarping:function stopWarping(){var timeScaleInterpolant=this._timeScaleInterpolant;if(null!==timeScaleInterpolant){this._timeScaleInterpolant=null;this._mixer._takeBackControlInterpolant(timeScaleInterpolant)}return this},getMixer:function getMixer(){return this._mixer},getClip:function getClip(){return this._clip},getRoot:function getRoot(){return this._localRoot||this._mixer._root},_update:function _update(time,deltaTime,timeDirection,accuIndex){if(!this.enabled){this._updateWeight(time);return}var startTime=this._startTime;if(null!==startTime){var timeRunning=(time-startTime)*timeDirection;if(0>timeRunning||0===timeDirection){return}this._startTime=null;deltaTime=timeDirection*timeRunning}deltaTime*=this._updateTimeScale(time);var clipTime=this._updateTime(deltaTime),weight=this._updateWeight(time);if(0<weight){for(var interpolants=this._interpolants,propertyMixers=this._propertyBindings,j=0,m=interpolants.length;j!==m;++j){interpolants[j].evaluate(clipTime);propertyMixers[j].accumulate(accuIndex,weight)}}},_updateWeight:function _updateWeight(time){var weight=0;if(this.enabled){weight=this.weight;var interpolant=this._weightInterpolant;if(null!==interpolant){var interpolantValue=interpolant.evaluate(time)[0];weight*=interpolantValue;if(time>interpolant.parameterPositions[1]){this.stopFading();if(0===interpolantValue){this.enabled=!1}}}}this._effectiveWeight=weight;return weight},_updateTimeScale:function _updateTimeScale(time){var timeScale=0;if(!this.paused){timeScale=this.timeScale;var interpolant=this._timeScaleInterpolant;if(null!==interpolant){var interpolantValue=interpolant.evaluate(time)[0];timeScale*=interpolantValue;if(time>interpolant.parameterPositions[1]){this.stopWarping();if(0===timeScale){this.paused=!0}else{this.timeScale=timeScale}}}}this._effectiveTimeScale=timeScale;return timeScale},_updateTime:function _updateTime(deltaTime){var time=this.time+deltaTime;if(0===deltaTime)return time;var duration=this._clip.duration,loop=this.loop,loopCount=this._loopCount;if(loop===LoopOnce){if(-1===loopCount){this._loopCount=0;this._setEndings(!0,!0,!1)}handle_stop:{if(time>=duration){time=duration}else if(0>time){time=0}else break handle_stop;if(this.clampWhenFinished)this.paused=!0;else this.enabled=!1;this._mixer.dispatchEvent({type:"finished",action:this,direction:0>deltaTime?-1:1})}}else{var pingPong=loop===LoopPingPong;if(-1===loopCount){if(0<=deltaTime){loopCount=0;this._setEndings(!0,0===this.repetitions,pingPong)}else{this._setEndings(0===this.repetitions,!0,pingPong)}}if(time>=duration||0>time){var loopDelta=_Mathfloor(time/duration);time-=duration*loopDelta;loopCount+=_Mathabs(loopDelta);var pending=this.repetitions-loopCount;if(0>pending){if(this.clampWhenFinished)this.paused=!0;else this.enabled=!1;time=0<deltaTime?duration:0;this._mixer.dispatchEvent({type:"finished",action:this,direction:0<deltaTime?1:-1})}else{if(0===pending){var atStart=0>deltaTime;this._setEndings(atStart,!atStart,pingPong)}else{this._setEndings(!1,!1,pingPong)}this._loopCount=loopCount;this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:loopDelta})}}if(pingPong&&1===(1&loopCount)){this.time=time;return duration-time}}this.time=time;return time},_setEndings:function _setEndings(atStart,atEnd,pingPong){var settings=this._interpolantSettings;if(pingPong){settings.endingStart=ZeroSlopeEnding;settings.endingEnd=ZeroSlopeEnding}else{if(atStart){settings.endingStart=this.zeroSlopeAtStart?ZeroSlopeEnding:ZeroCurvatureEnding}else{settings.endingStart=WrapAroundEnding}if(atEnd){settings.endingEnd=this.zeroSlopeAtEnd?ZeroSlopeEnding:ZeroCurvatureEnding}else{settings.endingEnd=WrapAroundEnding}}},_scheduleFading:function _scheduleFading(duration,weightNow,weightThen){var mixer=this._mixer,now=mixer.time,interpolant=this._weightInterpolant;if(null===interpolant){interpolant=mixer._lendControlInterpolant();this._weightInterpolant=interpolant}var times=interpolant.parameterPositions,values=interpolant.sampleValues;times[0]=now;values[0]=weightNow;times[1]=now+duration;values[1]=weightThen;return this}});function AnimationMixer(root){this._root=root;this._initMemoryManager();this._accuIndex=0;this.time=0;this.timeScale=1}AnimationMixer.prototype=Object.assign(Object.create(EventDispatcher.prototype),{constructor:AnimationMixer,_bindAction:function _bindAction(action,prototypeAction){var root=action._localRoot||this._root,tracks=action._clip.tracks,nTracks=tracks.length,bindings=action._propertyBindings,interpolants=action._interpolants,rootUuid=root.uuid,bindingsByRoot=this._bindingsByRootAndName,bindingsByName=bindingsByRoot[rootUuid];if(bindingsByName===void 0){bindingsByName={};bindingsByRoot[rootUuid]=bindingsByName}for(var i=0;i!==nTracks;++i){var track=tracks[i],trackName=track.name,binding=bindingsByName[trackName];if(binding!==void 0){bindings[i]=binding}else{binding=bindings[i];if(binding!==void 0){if(null===binding._cacheIndex){++binding.referenceCount;this._addInactiveBinding(binding,rootUuid,trackName)}continue}var path=prototypeAction&&prototypeAction._propertyBindings[i].binding.parsedPath;binding=new PropertyMixer(PropertyBinding.create(root,trackName,path),track.ValueTypeName,track.getValueSize());++binding.referenceCount;this._addInactiveBinding(binding,rootUuid,trackName);bindings[i]=binding}interpolants[i].resultBuffer=binding.buffer}},_activateAction:function _activateAction(action){if(!this._isActiveAction(action)){if(null===action._cacheIndex){var rootUuid=(action._localRoot||this._root).uuid,clipUuid=action._clip.uuid,actionsForClip=this._actionsByClip[clipUuid];this._bindAction(action,actionsForClip&&actionsForClip.knownActions[0]);this._addInactiveAction(action,clipUuid,rootUuid)}for(var bindings=action._propertyBindings,i=0,n=bindings.length,binding;i!==n;++i){binding=bindings[i];if(0===binding.useCount++){this._lendBinding(binding);binding.saveOriginalState()}}this._lendAction(action)}},_deactivateAction:function _deactivateAction(action){if(this._isActiveAction(action)){for(var bindings=action._propertyBindings,i=0,n=bindings.length,binding;i!==n;++i){binding=bindings[i];if(0===--binding.useCount){binding.restoreOriginalState();this._takeBackBinding(binding)}}this._takeBackAction(action)}},_initMemoryManager:function _initMemoryManager(){this._actions=[];this._nActiveActions=0;this._actionsByClip={};this._bindings=[];this._nActiveBindings=0;this._bindingsByRootAndName={};this._controlInterpolants=[];this._nActiveControlInterpolants=0;var scope=this;this.stats={actions:{get total(){return scope._actions.length},get inUse(){return scope._nActiveActions}},bindings:{get total(){return scope._bindings.length},get inUse(){return scope._nActiveBindings}},controlInterpolants:{get total(){return scope._controlInterpolants.length},get inUse(){return scope._nActiveControlInterpolants}}}},_isActiveAction:function _isActiveAction(action){var index=action._cacheIndex;return null!==index&&index<this._nActiveActions},_addInactiveAction:function _addInactiveAction(action,clipUuid,rootUuid){var actions=this._actions,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid];if(actionsForClip===void 0){actionsForClip={knownActions:[action],actionByRoot:{}};action._byClipCacheIndex=0;actionsByClip[clipUuid]=actionsForClip}else{var knownActions=actionsForClip.knownActions;action._byClipCacheIndex=knownActions.length;knownActions.push(action)}action._cacheIndex=actions.length;actions.push(action);actionsForClip.actionByRoot[rootUuid]=action},_removeInactiveAction:function _removeInactiveAction(action){var actions=this._actions,lastInactiveAction=actions[actions.length-1],cacheIndex=action._cacheIndex;lastInactiveAction._cacheIndex=cacheIndex;actions[cacheIndex]=lastInactiveAction;actions.pop();action._cacheIndex=null;var clipUuid=action._clip.uuid,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid],knownActionsForClip=actionsForClip.knownActions,lastKnownAction=knownActionsForClip[knownActionsForClip.length-1],byClipCacheIndex=action._byClipCacheIndex;lastKnownAction._byClipCacheIndex=byClipCacheIndex;knownActionsForClip[byClipCacheIndex]=lastKnownAction;knownActionsForClip.pop();action._byClipCacheIndex=null;var actionByRoot=actionsForClip.actionByRoot,rootUuid=(action._localRoot||this._root).uuid;delete actionByRoot[rootUuid];if(0===knownActionsForClip.length){delete actionsByClip[clipUuid]}this._removeInactiveBindingsForAction(action)},_removeInactiveBindingsForAction:function _removeInactiveBindingsForAction(action){for(var bindings=action._propertyBindings,i=0,n=bindings.length,binding;i!==n;++i){binding=bindings[i];if(0===--binding.referenceCount){this._removeInactiveBinding(binding)}}},_lendAction:function _lendAction(action){var actions=this._actions,prevIndex=action._cacheIndex,lastActiveIndex=this._nActiveActions++,firstInactiveAction=actions[lastActiveIndex];action._cacheIndex=lastActiveIndex;actions[lastActiveIndex]=action;firstInactiveAction._cacheIndex=prevIndex;actions[prevIndex]=firstInactiveAction},_takeBackAction:function _takeBackAction(action){var actions=this._actions,prevIndex=action._cacheIndex,firstInactiveIndex=--this._nActiveActions,lastActiveAction=actions[firstInactiveIndex];action._cacheIndex=firstInactiveIndex;actions[firstInactiveIndex]=action;lastActiveAction._cacheIndex=prevIndex;actions[prevIndex]=lastActiveAction},_addInactiveBinding:function _addInactiveBinding(binding,rootUuid,trackName){var bindingsByRoot=this._bindingsByRootAndName,bindingByName=bindingsByRoot[rootUuid],bindings=this._bindings;if(bindingByName===void 0){bindingByName={};bindingsByRoot[rootUuid]=bindingByName}bindingByName[trackName]=binding;binding._cacheIndex=bindings.length;bindings.push(binding)},_removeInactiveBinding:function _removeInactiveBinding(binding){var bindings=this._bindings,propBinding=binding.binding,rootUuid=propBinding.rootNode.uuid,trackName=propBinding.path,bindingsByRoot=this._bindingsByRootAndName,bindingByName=bindingsByRoot[rootUuid],lastInactiveBinding=bindings[bindings.length-1],cacheIndex=binding._cacheIndex;lastInactiveBinding._cacheIndex=cacheIndex;bindings[cacheIndex]=lastInactiveBinding;bindings.pop();delete bindingByName[trackName];remove_empty_map:{for(var _ in bindingByName){break remove_empty_map}delete bindingsByRoot[rootUuid]}},_lendBinding:function _lendBinding(binding){var bindings=this._bindings,prevIndex=binding._cacheIndex,lastActiveIndex=this._nActiveBindings++,firstInactiveBinding=bindings[lastActiveIndex];binding._cacheIndex=lastActiveIndex;bindings[lastActiveIndex]=binding;firstInactiveBinding._cacheIndex=prevIndex;bindings[prevIndex]=firstInactiveBinding},_takeBackBinding:function _takeBackBinding(binding){var bindings=this._bindings,prevIndex=binding._cacheIndex,firstInactiveIndex=--this._nActiveBindings,lastActiveBinding=bindings[firstInactiveIndex];binding._cacheIndex=firstInactiveIndex;bindings[firstInactiveIndex]=binding;lastActiveBinding._cacheIndex=prevIndex;bindings[prevIndex]=lastActiveBinding},_lendControlInterpolant:function _lendControlInterpolant(){var interpolants=this._controlInterpolants,lastActiveIndex=this._nActiveControlInterpolants++,interpolant=interpolants[lastActiveIndex];if(interpolant===void 0){interpolant=new LinearInterpolant(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer);interpolant.__cacheIndex=lastActiveIndex;interpolants[lastActiveIndex]=interpolant}return interpolant},_takeBackControlInterpolant:function _takeBackControlInterpolant(interpolant){var interpolants=this._controlInterpolants,prevIndex=interpolant.__cacheIndex,firstInactiveIndex=--this._nActiveControlInterpolants,lastActiveInterpolant=interpolants[firstInactiveIndex];interpolant.__cacheIndex=firstInactiveIndex;interpolants[firstInactiveIndex]=interpolant;lastActiveInterpolant.__cacheIndex=prevIndex;interpolants[prevIndex]=lastActiveInterpolant},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function clipAction(clip,optionalRoot){var root=optionalRoot||this._root,rootUuid=root.uuid,clipObject="string"===typeof clip?AnimationClip.findByName(root,clip):clip,clipUuid=null!==clipObject?clipObject.uuid:clip,actionsForClip=this._actionsByClip[clipUuid],prototypeAction=null;if(actionsForClip!==void 0){var existingAction=actionsForClip.actionByRoot[rootUuid];if(existingAction!==void 0){return existingAction}prototypeAction=actionsForClip.knownActions[0];if(null===clipObject)clipObject=prototypeAction._clip}if(null===clipObject)return null;var newAction=new AnimationAction(this,clipObject,optionalRoot);this._bindAction(newAction,prototypeAction);this._addInactiveAction(newAction,clipUuid,rootUuid);return newAction},existingAction:function existingAction(clip,optionalRoot){var root=optionalRoot||this._root,rootUuid=root.uuid,clipObject="string"===typeof clip?AnimationClip.findByName(root,clip):clip,clipUuid=clipObject?clipObject.uuid:clip,actionsForClip=this._actionsByClip[clipUuid];if(actionsForClip!==void 0){return actionsForClip.actionByRoot[rootUuid]||null}return null},stopAllAction:function stopAllAction(){var actions=this._actions,nActions=this._nActiveActions,bindings=this._bindings,nBindings=this._nActiveBindings;this._nActiveActions=0;this._nActiveBindings=0;for(var i=0;i!==nActions;++i){actions[i].reset()}for(var i=0;i!==nBindings;++i){bindings[i].useCount=0}return this},update:function update(deltaTime){deltaTime*=this.timeScale;for(var actions=this._actions,nActions=this._nActiveActions,time=this.time+=deltaTime,timeDirection=_Mathsign(deltaTime),accuIndex=this._accuIndex^=1,i=0,action;i!==nActions;++i){action=actions[i];action._update(time,deltaTime,timeDirection,accuIndex)}for(var bindings=this._bindings,nBindings=this._nActiveBindings,i=0;i!==nBindings;++i){bindings[i].apply(accuIndex)}return this},getRoot:function getRoot(){return this._root},uncacheClip:function uncacheClip(clip){var actions=this._actions,clipUuid=clip.uuid,actionsByClip=this._actionsByClip,actionsForClip=actionsByClip[clipUuid];if(actionsForClip!==void 0){for(var actionsToRemove=actionsForClip.knownActions,i=0,n=actionsToRemove.length,action;i!==n;++i){action=actionsToRemove[i];this._deactivateAction(action);var cacheIndex=action._cacheIndex,lastInactiveAction=actions[actions.length-1];action._cacheIndex=null;action._byClipCacheIndex=null;lastInactiveAction._cacheIndex=cacheIndex;actions[cacheIndex]=lastInactiveAction;actions.pop();this._removeInactiveBindingsForAction(action)}delete actionsByClip[clipUuid]}},uncacheRoot:function uncacheRoot(root){var rootUuid=root.uuid,actionsByClip=this._actionsByClip;for(var clipUuid in actionsByClip){var actionByRoot=actionsByClip[clipUuid].actionByRoot,action=actionByRoot[rootUuid];if(action!==void 0){this._deactivateAction(action);this._removeInactiveAction(action)}}var bindingsByRoot=this._bindingsByRootAndName,bindingByName=bindingsByRoot[rootUuid];if(bindingByName!==void 0){for(var trackName in bindingByName){var binding=bindingByName[trackName];binding.restoreOriginalState();this._removeInactiveBinding(binding)}}},uncacheAction:function uncacheAction(clip,optionalRoot){var action=this.existingAction(clip,optionalRoot);if(null!==action){this._deactivateAction(action);this._removeInactiveAction(action)}}});function Uniform(value){if("string"===typeof value){console.warn("THREE.Uniform: Type parameter is no longer needed.");value=arguments[1]}this.value=value}Uniform.prototype.clone=function(){return new Uniform(this.value.clone===void 0?this.value:this.value.clone())};function InstancedBufferGeometry(){BufferGeometry.call(this);this.type="InstancedBufferGeometry";this.maxInstancedCount=void 0}InstancedBufferGeometry.prototype=Object.assign(Object.create(BufferGeometry.prototype),{constructor:InstancedBufferGeometry,isInstancedBufferGeometry:!0,copy:function copy(source){BufferGeometry.prototype.copy.call(this,source);this.maxInstancedCount=source.maxInstancedCount;return this},clone:function clone(){return new this.constructor().copy(this)}});function InterleavedBufferAttribute(interleavedBuffer,itemSize,offset,normalized){this.uuid=_Math.generateUUID();this.data=interleavedBuffer;this.itemSize=itemSize;this.offset=offset;this.normalized=!0===normalized}Object.defineProperties(InterleavedBufferAttribute.prototype,{count:{get:function get(){return this.data.count}},array:{get:function get(){return this.data.array}}});Object.assign(InterleavedBufferAttribute.prototype,{isInterleavedBufferAttribute:!0,setX:function setX(index,x){this.data.array[index*this.data.stride+this.offset]=x;return this},setY:function setY(index,y){this.data.array[index*this.data.stride+this.offset+1]=y;return this},setZ:function setZ(index,z){this.data.array[index*this.data.stride+this.offset+2]=z;return this},setW:function setW(index,w){this.data.array[index*this.data.stride+this.offset+3]=w;return this},getX:function getX(index){return this.data.array[index*this.data.stride+this.offset]},getY:function getY(index){return this.data.array[index*this.data.stride+this.offset+1]},getZ:function getZ(index){return this.data.array[index*this.data.stride+this.offset+2]},getW:function getW(index){return this.data.array[index*this.data.stride+this.offset+3]},setXY:function setXY(index,x,y){index=index*this.data.stride+this.offset;this.data.array[index+0]=x;this.data.array[index+1]=y;return this},setXYZ:function setXYZ(index,x,y,z){index=index*this.data.stride+this.offset;this.data.array[index+0]=x;this.data.array[index+1]=y;this.data.array[index+2]=z;return this},setXYZW:function setXYZW(index,x,y,z,w){index=index*this.data.stride+this.offset;this.data.array[index+0]=x;this.data.array[index+1]=y;this.data.array[index+2]=z;this.data.array[index+3]=w;return this}});function InterleavedBuffer(array,stride){this.uuid=_Math.generateUUID();this.array=array;this.stride=stride;this.count=array!==void 0?array.length/stride:0;this.dynamic=!1;this.updateRange={offset:0,count:-1};this.onUploadCallback=function(){};this.version=0}Object.defineProperty(InterleavedBuffer.prototype,"needsUpdate",{set:function set(value){if(!0===value)this.version++}});Object.assign(InterleavedBuffer.prototype,{isInterleavedBuffer:!0,setArray:function setArray(array){if(Array.isArray(array)){throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.")}this.count=array!==void 0?array.length/this.stride:0;this.array=array},setDynamic:function setDynamic(value){this.dynamic=value;return this},copy:function copy(source){this.array=new source.array.constructor(source.array);this.count=source.count;this.stride=source.stride;this.dynamic=source.dynamic;return this},copyAt:function copyAt(index1,attribute,index2){index1*=this.stride;index2*=attribute.stride;for(var i=0,l=this.stride;i<l;i++){this.array[index1+i]=attribute.array[index2+i]}return this},set:function set(value,offset){if(offset===void 0)offset=0;this.array.set(value,offset);return this},clone:function clone(){return new this.constructor().copy(this)},onUpload:function onUpload(callback){this.onUploadCallback=callback;return this}});function InstancedInterleavedBuffer(array,stride,meshPerAttribute){InterleavedBuffer.call(this,array,stride);this.meshPerAttribute=meshPerAttribute||1}InstancedInterleavedBuffer.prototype=Object.assign(Object.create(InterleavedBuffer.prototype),{constructor:InstancedInterleavedBuffer,isInstancedInterleavedBuffer:!0,copy:function copy(source){InterleavedBuffer.prototype.copy.call(this,source);this.meshPerAttribute=source.meshPerAttribute;return this}});function InstancedBufferAttribute(array,itemSize,meshPerAttribute){BufferAttribute.call(this,array,itemSize);this.meshPerAttribute=meshPerAttribute||1}InstancedBufferAttribute.prototype=Object.assign(Object.create(BufferAttribute.prototype),{constructor:InstancedBufferAttribute,isInstancedBufferAttribute:!0,copy:function copy(source){BufferAttribute.prototype.copy.call(this,source);this.meshPerAttribute=source.meshPerAttribute;return this}});function Raycaster(origin,direction,near,far){this.ray=new Ray(origin,direction);this.near=near||0;this.far=far||1/0;this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}};Object.defineProperties(this.params,{PointCloud:{get:function get(){console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points.");return this.Points}}})}function ascSort(a,b){return a.distance-b.distance}function _intersectObject(object,raycaster,intersects,recursive){if(!1===object.visible)return;object.raycast(raycaster,intersects);if(!0===recursive){for(var children=object.children,i=0,l=children.length;i<l;i++){_intersectObject(children[i],raycaster,intersects,!0)}}}Object.assign(Raycaster.prototype,{linePrecision:1,set:function set(origin,direction){this.ray.set(origin,direction)},setFromCamera:function setFromCamera(coords,camera){if(camera&&camera.isPerspectiveCamera){this.ray.origin.setFromMatrixPosition(camera.matrixWorld);this.ray.direction.set(coords.x,coords.y,.5).unproject(camera).sub(this.ray.origin).normalize()}else if(camera&&camera.isOrthographicCamera){this.ray.origin.set(coords.x,coords.y,(camera.near+camera.far)/(camera.near-camera.far)).unproject(camera);this.ray.direction.set(0,0,-1).transformDirection(camera.matrixWorld)}else{console.error("THREE.Raycaster: Unsupported camera type.")}},intersectObject:function intersectObject(object,recursive,optionalTarget){var intersects=optionalTarget||[];_intersectObject(object,this,intersects,recursive);intersects.sort(ascSort);return intersects},intersectObjects:function intersectObjects(objects,recursive,optionalTarget){var intersects=optionalTarget||[];if(!1===Array.isArray(objects)){console.warn("THREE.Raycaster.intersectObjects: objects is not an Array.");return intersects}for(var i=0,l=objects.length;i<l;i++){_intersectObject(objects[i],this,intersects,recursive)}intersects.sort(ascSort);return intersects}});function Clock(autoStart){this.autoStart=autoStart!==void 0?autoStart:!0;this.startTime=0;this.oldTime=0;this.elapsedTime=0;this.running=!1}Object.assign(Clock.prototype,{start:function start(){this.startTime=("undefined"===typeof performance?Date:performance).now();this.oldTime=this.startTime;this.elapsedTime=0;this.running=!0},stop:function stop(){this.getElapsedTime();this.running=!1;this.autoStart=!1},getElapsedTime:function getElapsedTime(){this.getDelta();return this.elapsedTime},getDelta:function getDelta(){var diff=0;if(this.autoStart&&!this.running){this.start();return 0}if(this.running){var newTime=("undefined"===typeof performance?Date:performance).now();diff=(newTime-this.oldTime)/1e3;this.oldTime=newTime;this.elapsedTime+=diff}return diff}});function Spherical(radius,phi,theta){this.radius=radius!==void 0?radius:1;this.phi=phi!==void 0?phi:0;this.theta=theta!==void 0?theta:0;return this}Object.assign(Spherical.prototype,{set:function set(radius,phi,theta){this.radius=radius;this.phi=phi;this.theta=theta;return this},clone:function clone(){return new this.constructor().copy(this)},copy:function copy(other){this.radius=other.radius;this.phi=other.phi;this.theta=other.theta;return this},makeSafe:function makeSafe(){var EPS=1e-6;this.phi=_Mathmax(EPS,_Mathmin(_MathPI-EPS,this.phi));return this},setFromVector3:function setFromVector3(vec3){this.radius=vec3.length();if(0===this.radius){this.theta=0;this.phi=0}else{this.theta=_Mathatan(vec3.x,vec3.z);this.phi=_Mathacos(_Math.clamp(vec3.y/this.radius,-1,1))}return this}});function Cylindrical(radius,theta,y){this.radius=radius!==void 0?radius:1;this.theta=theta!==void 0?theta:0;this.y=y!==void 0?y:0;return this}Object.assign(Cylindrical.prototype,{set:function set(radius,theta,y){this.radius=radius;this.theta=theta;this.y=y;return this},clone:function clone(){return new this.constructor().copy(this)},copy:function copy(other){this.radius=other.radius;this.theta=other.theta;this.y=other.y;return this},setFromVector3:function setFromVector3(vec3){this.radius=_Mathsqrt(vec3.x*vec3.x+vec3.z*vec3.z);this.theta=_Mathatan(vec3.x,vec3.z);this.y=vec3.y;return this}});function Box2(min,max){this.min=min!==void 0?min:new Vector2(+Infinity,+Infinity);this.max=max!==void 0?max:new Vector2(-Infinity,-Infinity)}Object.assign(Box2.prototype,{set:function set(min,max){this.min.copy(min);this.max.copy(max);return this},setFromPoints:function setFromPoints(points){this.makeEmpty();for(var i=0,il=points.length;i<il;i++){this.expandByPoint(points[i])}return this},setFromCenterAndSize:function(){var v1=new Vector2;return function(center,size){var halfSize=v1.copy(size).multiplyScalar(.5);this.min.copy(center).sub(halfSize);this.max.copy(center).add(halfSize);return this}}(),clone:function clone(){return new this.constructor().copy(this)},copy:function copy(box){this.min.copy(box.min);this.max.copy(box.max);return this},makeEmpty:function makeEmpty(){this.min.x=this.min.y=+Infinity;this.max.x=this.max.y=-Infinity;return this},isEmpty:function isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function getCenter(optionalTarget){var result=optionalTarget||new Vector2;return this.isEmpty()?result.set(0,0):result.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function getSize(optionalTarget){var result=optionalTarget||new Vector2;return this.isEmpty()?result.set(0,0):result.subVectors(this.max,this.min)},expandByPoint:function expandByPoint(point){this.min.min(point);this.max.max(point);return this},expandByVector:function expandByVector(vector){this.min.sub(vector);this.max.add(vector);return this},expandByScalar:function expandByScalar(scalar){this.min.addScalar(-scalar);this.max.addScalar(scalar);return this},containsPoint:function containsPoint(point){return point.x<this.min.x||point.x>this.max.x||point.y<this.min.y||point.y>this.max.y?!1:!0},containsBox:function containsBox(box){return this.min.x<=box.min.x&&box.max.x<=this.max.x&&this.min.y<=box.min.y&&box.max.y<=this.max.y},getParameter:function getParameter(point,optionalTarget){var result=optionalTarget||new Vector2;return result.set((point.x-this.min.x)/(this.max.x-this.min.x),(point.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function intersectsBox(box){return box.max.x<this.min.x||box.min.x>this.max.x||box.max.y<this.min.y||box.min.y>this.max.y?!1:!0},clampPoint:function clampPoint(point,optionalTarget){var result=optionalTarget||new Vector2;return result.copy(point).clamp(this.min,this.max)},distanceToPoint:function(){var v1=new Vector2;return function(point){var clampedPoint=v1.copy(point).clamp(this.min,this.max);return clampedPoint.sub(point).length()}}(),intersect:function intersect(box){this.min.max(box.min);this.max.min(box.max);return this},union:function union(box){this.min.min(box.min);this.max.max(box.max);return this},translate:function translate(offset){this.min.add(offset);this.max.add(offset);return this},equals:function(box){return box.min.equals(this.min)&&box.max.equals(this.max)}});function ImmediateRenderObject(material){Object3D.call(this);this.material=material;this.render=function(){}}ImmediateRenderObject.prototype=Object.create(Object3D.prototype);ImmediateRenderObject.prototype.constructor=ImmediateRenderObject;ImmediateRenderObject.prototype.isImmediateRenderObject=!0;function VertexNormalsHelper(object,size,hex,linewidth){this.object=object;this.size=size!==void 0?size:1;var color=hex!==void 0?hex:16711680,width=linewidth!==void 0?linewidth:1,nNormals=0,objGeometry=this.object.geometry;if(objGeometry&&objGeometry.isGeometry){nNormals=3*objGeometry.faces.length}else if(objGeometry&&objGeometry.isBufferGeometry){nNormals=objGeometry.attributes.normal.count}var geometry=new BufferGeometry,positions=new Float32BufferAttribute(3*(2*nNormals),3);geometry.addAttribute("position",positions);LineSegments.call(this,geometry,new LineBasicMaterial({color:color,linewidth:width}));this.matrixAutoUpdate=!1;this.update()}VertexNormalsHelper.prototype=Object.create(LineSegments.prototype);VertexNormalsHelper.prototype.constructor=VertexNormalsHelper;VertexNormalsHelper.prototype.update=function(){var v1=new Vector3,v2=new Vector3,normalMatrix=new Matrix3;return function(){var keys=["a","b","c"];this.object.updateMatrixWorld(!0);normalMatrix.getNormalMatrix(this.object.matrixWorld);var matrixWorld=this.object.matrixWorld,position=this.geometry.attributes.position,objGeometry=this.object.geometry;if(objGeometry&&objGeometry.isGeometry){for(var vertices=objGeometry.vertices,faces=objGeometry.faces,idx=0,i=0,l=faces.length,face;i<l;i++){face=faces[i];for(var j=0,jl=face.vertexNormals.length;j<jl;j++){var vertex=vertices[face[keys[j]]],normal=face.vertexNormals[j];v1.copy(vertex).applyMatrix4(matrixWorld);v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1);position.setXYZ(idx,v1.x,v1.y,v1.z);idx=idx+1;position.setXYZ(idx,v2.x,v2.y,v2.z);idx=idx+1}}}else if(objGeometry&&objGeometry.isBufferGeometry){for(var objPos=objGeometry.attributes.position,objNorm=objGeometry.attributes.normal,idx=0,j=0,jl=objPos.count;j<jl;j++){v1.set(objPos.getX(j),objPos.getY(j),objPos.getZ(j)).applyMatrix4(matrixWorld);v2.set(objNorm.getX(j),objNorm.getY(j),objNorm.getZ(j));v2.applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1);position.setXYZ(idx,v1.x,v1.y,v1.z);idx=idx+1;position.setXYZ(idx,v2.x,v2.y,v2.z);idx=idx+1}}position.needsUpdate=!0}}();function SpotLightHelper(light,color){Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=!1;this.color=color;for(var geometry=new BufferGeometry,positions=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],i=0,j=1,l=32;i<l;i++,j++){var p1=2*(i/l*_MathPI),p2=2*(j/l*_MathPI);positions.push(_Mathcos(p1),_Mathsin(p1),1,_Mathcos(p2),_Mathsin(p2),1)}geometry.addAttribute("position",new Float32BufferAttribute(positions,3));var material=new LineBasicMaterial({fog:!1});this.cone=new LineSegments(geometry,material);this.add(this.cone);this.update()}SpotLightHelper.prototype=Object.create(Object3D.prototype);SpotLightHelper.prototype.constructor=SpotLightHelper;SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose();this.cone.material.dispose()};SpotLightHelper.prototype.update=function(){var vector=new Vector3,vector2=new Vector3;return function(){this.light.updateMatrixWorld();var coneLength=this.light.distance?this.light.distance:1e3,coneWidth=coneLength*_Mathtan(this.light.angle);this.cone.scale.set(coneWidth,coneWidth,coneLength);vector.setFromMatrixPosition(this.light.matrixWorld);vector2.setFromMatrixPosition(this.light.target.matrixWorld);this.cone.lookAt(vector2.sub(vector));if(this.color!==void 0){this.cone.material.color.set(this.color)}else{this.cone.material.color.copy(this.light.color)}}}();function getBoneList(object){var boneList=[];if(object&&object.isBone){boneList.push(object)}for(var i=0;i<object.children.length;i++){boneList.push.apply(boneList,getBoneList(object.children[i]))}return boneList}function SkeletonHelper(object){for(var bones=getBoneList(object),geometry=new BufferGeometry,vertices=[],colors=[],color1=new Color(0,0,1),color2=new Color(0,1,0),i=0,bone;i<bones.length;i++){bone=bones[i];if(bone.parent&&bone.parent.isBone){vertices.push(0,0,0);vertices.push(0,0,0);colors.push(color1.r,color1.g,color1.b);colors.push(color2.r,color2.g,color2.b)}}geometry.addAttribute("position",new Float32BufferAttribute(vertices,3));geometry.addAttribute("color",new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial({vertexColors:VertexColors,depthTest:!1,depthWrite:!1,transparent:!0});LineSegments.call(this,geometry,material);this.root=object;this.bones=bones;this.matrix=object.matrixWorld;this.matrixAutoUpdate=!1}SkeletonHelper.prototype=Object.create(LineSegments.prototype);SkeletonHelper.prototype.constructor=SkeletonHelper;SkeletonHelper.prototype.updateMatrixWorld=function(){var vector=new Vector3,boneMatrix=new Matrix4,matrixWorldInv=new Matrix4;return function(force){var bones=this.bones,geometry=this.geometry,position=geometry.getAttribute("position");matrixWorldInv.getInverse(this.root.matrixWorld);for(var i=0,j=0,bone;i<bones.length;i++){bone=bones[i];if(bone.parent&&bone.parent.isBone){boneMatrix.multiplyMatrices(matrixWorldInv,bone.matrixWorld);vector.setFromMatrixPosition(boneMatrix);position.setXYZ(j,vector.x,vector.y,vector.z);boneMatrix.multiplyMatrices(matrixWorldInv,bone.parent.matrixWorld);vector.setFromMatrixPosition(boneMatrix);position.setXYZ(j+1,vector.x,vector.y,vector.z);j+=2}}geometry.getAttribute("position").needsUpdate=!0;Object3D.prototype.updateMatrixWorld.call(this,force)}}();function PointLightHelper(light,sphereSize,color){this.light=light;this.light.updateMatrixWorld();this.color=color;var geometry=new SphereBufferGeometry(sphereSize,4,2),material=new MeshBasicMaterial({wireframe:!0,fog:!1});Mesh.call(this,geometry,material);this.matrix=this.light.matrixWorld;this.matrixAutoUpdate=!1;this.update()}PointLightHelper.prototype=Object.create(Mesh.prototype);PointLightHelper.prototype.constructor=PointLightHelper;PointLightHelper.prototype.dispose=function(){this.geometry.dispose();this.material.dispose()};PointLightHelper.prototype.update=function(){if(this.color!==void 0){this.material.color.set(this.color)}else{this.material.color.copy(this.light.color)}};function RectAreaLightHelper(light,color){Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=!1;this.color=color;var material=new LineBasicMaterial({fog:!1}),geometry=new BufferGeometry;geometry.addAttribute("position",new BufferAttribute(new Float32Array(3*5),3));this.line=new Line(geometry,material);this.add(this.line);this.update()}RectAreaLightHelper.prototype=Object.create(Object3D.prototype);RectAreaLightHelper.prototype.constructor=RectAreaLightHelper;RectAreaLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};RectAreaLightHelper.prototype.update=function(){var hx=.5*this.light.width,hy=.5*this.light.height,position=this.line.geometry.attributes.position,array=position.array;array[0]=hx;array[1]=-hy;array[2]=0;array[3]=hx;array[4]=hy;array[5]=0;array[6]=-hx;array[7]=hy;array[8]=0;array[9]=-hx;array[10]=-hy;array[11]=0;array[12]=hx;array[13]=-hy;array[14]=0;position.needsUpdate=!0;if(this.color!==void 0){this.line.material.color.set(this.color)}else{this.line.material.color.copy(this.light.color)}};function HemisphereLightHelper(light,size,color){Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=!1;this.color=color;var geometry=new OctahedronBufferGeometry(size);geometry.rotateY(.5*_MathPI);this.material=new MeshBasicMaterial({wireframe:!0,fog:!1});if(this.color===void 0)this.material.vertexColors=VertexColors;var position=geometry.getAttribute("position"),colors=new Float32Array(3*position.count);geometry.addAttribute("color",new BufferAttribute(colors,3));this.add(new Mesh(geometry,this.material));this.update()}HemisphereLightHelper.prototype=Object.create(Object3D.prototype);HemisphereLightHelper.prototype.constructor=HemisphereLightHelper;HemisphereLightHelper.prototype.dispose=function(){this.children[0].geometry.dispose();this.children[0].material.dispose()};HemisphereLightHelper.prototype.update=function(){var vector=new Vector3,color1=new Color,color2=new Color;return function(){var mesh=this.children[0];if(this.color!==void 0){this.material.color.set(this.color)}else{var colors=mesh.geometry.getAttribute("color");color1.copy(this.light.color);color2.copy(this.light.groundColor);for(var i=0,l=colors.count,color;i<l;i++){color=i<l/2?color1:color2;colors.setXYZ(i,color.r,color.g,color.b)}colors.needsUpdate=!0}mesh.lookAt(vector.setFromMatrixPosition(this.light.matrixWorld).negate())}}();function GridHelper(size,divisions,color1,color2){size=size||10;divisions=divisions||10;color1=new Color(color1!==void 0?color1:4473924);color2=new Color(color2!==void 0?color2:8947848);for(var center=divisions/2,step=size/divisions,halfSize=size/2,vertices=[],colors=[],i=0,j=0,k=-halfSize;i<=divisions;i++,k+=step){vertices.push(-halfSize,0,k,halfSize,0,k);vertices.push(k,0,-halfSize,k,0,halfSize);var color=i===center?color1:color2;color.toArray(colors,j);j+=3;color.toArray(colors,j);j+=3;color.toArray(colors,j);j+=3;color.toArray(colors,j);j+=3}var geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute(vertices,3));geometry.addAttribute("color",new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,geometry,material)}GridHelper.prototype=Object.create(LineSegments.prototype);GridHelper.prototype.constructor=GridHelper;function PolarGridHelper(radius,radials,circles,divisions,color1,color2){radius=radius||10;radials=radials||16;circles=circles||8;divisions=divisions||64;color1=new Color(color1!==void 0?color1:4473924);color2=new Color(color2!==void 0?color2:8947848);var vertices=[],colors=[],x,z,v,i,j,r,color;for(i=0;i<=radials;i++){v=i/radials*(2*_MathPI);x=_Mathsin(v)*radius;z=_Mathcos(v)*radius;vertices.push(0,0,0);vertices.push(x,0,z);color=1&i?color1:color2;colors.push(color.r,color.g,color.b);colors.push(color.r,color.g,color.b)}for(i=0;i<=circles;i++){color=1&i?color1:color2;r=radius-radius/circles*i;for(j=0;j<divisions;j++){v=j/divisions*(2*_MathPI);x=_Mathsin(v)*r;z=_Mathcos(v)*r;vertices.push(x,0,z);colors.push(color.r,color.g,color.b);v=(j+1)/divisions*(2*_MathPI);x=_Mathsin(v)*r;z=_Mathcos(v)*r;vertices.push(x,0,z);colors.push(color.r,color.g,color.b)}}var geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute(vertices,3));geometry.addAttribute("color",new Float32BufferAttribute(colors,3));var material=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,geometry,material)}PolarGridHelper.prototype=Object.create(LineSegments.prototype);PolarGridHelper.prototype.constructor=PolarGridHelper;function FaceNormalsHelper(object,size,hex,linewidth){this.object=object;this.size=size!==void 0?size:1;var color=hex!==void 0?hex:16776960,width=linewidth!==void 0?linewidth:1,nNormals=0,objGeometry=this.object.geometry;if(objGeometry&&objGeometry.isGeometry){nNormals=objGeometry.faces.length}else{console.warn("THREE.FaceNormalsHelper: only THREE.Geometry is supported. Use THREE.VertexNormalsHelper, instead.")}var geometry=new BufferGeometry,positions=new Float32BufferAttribute(3*(2*nNormals),3);geometry.addAttribute("position",positions);LineSegments.call(this,geometry,new LineBasicMaterial({color:color,linewidth:width}));this.matrixAutoUpdate=!1;this.update()}FaceNormalsHelper.prototype=Object.create(LineSegments.prototype);FaceNormalsHelper.prototype.constructor=FaceNormalsHelper;FaceNormalsHelper.prototype.update=function(){var v1=new Vector3,v2=new Vector3,normalMatrix=new Matrix3;return function(){this.object.updateMatrixWorld(!0);normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var matrixWorld=this.object.matrixWorld,position=this.geometry.attributes.position,objGeometry=this.object.geometry,vertices=objGeometry.vertices,faces=objGeometry.faces,idx=0,i=0,l=faces.length;i<l;i++){var face=faces[i],normal=face.normal;v1.copy(vertices[face.a]).add(vertices[face.b]).add(vertices[face.c]).divideScalar(3).applyMatrix4(matrixWorld);v2.copy(normal).applyMatrix3(normalMatrix).normalize().multiplyScalar(this.size).add(v1);position.setXYZ(idx,v1.x,v1.y,v1.z);idx=idx+1;position.setXYZ(idx,v2.x,v2.y,v2.z);idx=idx+1}position.needsUpdate=!0}}();function DirectionalLightHelper(light,size,color){Object3D.call(this);this.light=light;this.light.updateMatrixWorld();this.matrix=light.matrixWorld;this.matrixAutoUpdate=!1;this.color=color;if(size===void 0)size=1;var geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute([-size,size,0,size,size,0,size,-size,0,-size,-size,0,-size,size,0],3));var material=new LineBasicMaterial({fog:!1});this.lightPlane=new Line(geometry,material);this.add(this.lightPlane);geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute([0,0,0,0,0,1],3));this.targetLine=new Line(geometry,material);this.add(this.targetLine);this.update()}DirectionalLightHelper.prototype=Object.create(Object3D.prototype);DirectionalLightHelper.prototype.constructor=DirectionalLightHelper;DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose();this.lightPlane.material.dispose();this.targetLine.geometry.dispose();this.targetLine.material.dispose()};DirectionalLightHelper.prototype.update=function(){var v1=new Vector3,v2=new Vector3,v3=new Vector3;return function(){v1.setFromMatrixPosition(this.light.matrixWorld);v2.setFromMatrixPosition(this.light.target.matrixWorld);v3.subVectors(v2,v1);this.lightPlane.lookAt(v3);if(this.color!==void 0){this.lightPlane.material.color.set(this.color);this.targetLine.material.color.set(this.color)}else{this.lightPlane.material.color.copy(this.light.color);this.targetLine.material.color.copy(this.light.color)}this.targetLine.lookAt(v3);this.targetLine.scale.z=v3.length()}}();function CameraHelper(camera){var geometry=new BufferGeometry,material=new LineBasicMaterial({color:16777215,vertexColors:FaceColors}),vertices=[],colors=[],pointMap={},colorFrustum=new Color(16755200),colorCone=new Color(16711680),colorUp=new Color(43775),colorTarget=new Color(16777215),colorCross=new Color(3355443);addLine("n1","n2",colorFrustum);addLine("n2","n4",colorFrustum);addLine("n4","n3",colorFrustum);addLine("n3","n1",colorFrustum);addLine("f1","f2",colorFrustum);addLine("f2","f4",colorFrustum);addLine("f4","f3",colorFrustum);addLine("f3","f1",colorFrustum);addLine("n1","f1",colorFrustum);addLine("n2","f2",colorFrustum);addLine("n3","f3",colorFrustum);addLine("n4","f4",colorFrustum);addLine("p","n1",colorCone);addLine("p","n2",colorCone);addLine("p","n3",colorCone);addLine("p","n4",colorCone);addLine("u1","u2",colorUp);addLine("u2","u3",colorUp);addLine("u3","u1",colorUp);addLine("c","t",colorTarget);addLine("p","c",colorCross);addLine("cn1","cn2",colorCross);addLine("cn3","cn4",colorCross);addLine("cf1","cf2",colorCross);addLine("cf3","cf4",colorCross);function addLine(a,b,color){addPoint(a,color);addPoint(b,color)}function addPoint(id,color){vertices.push(0,0,0);colors.push(color.r,color.g,color.b);if(pointMap[id]===void 0){pointMap[id]=[]}pointMap[id].push(vertices.length/3-1)}geometry.addAttribute("position",new Float32BufferAttribute(vertices,3));geometry.addAttribute("color",new Float32BufferAttribute(colors,3));LineSegments.call(this,geometry,material);this.camera=camera;if(this.camera.updateProjectionMatrix)this.camera.updateProjectionMatrix();this.matrix=camera.matrixWorld;this.matrixAutoUpdate=!1;this.pointMap=pointMap;this.update()}CameraHelper.prototype=Object.create(LineSegments.prototype);CameraHelper.prototype.constructor=CameraHelper;CameraHelper.prototype.update=function(){var geometry,pointMap,vector=new Vector3,camera=new Camera;function setPoint(point,x,y,z){vector.set(x,y,z).unproject(camera);var points=pointMap[point];if(points!==void 0){for(var position=geometry.getAttribute("position"),i=0,l=points.length;i<l;i++){position.setXYZ(points[i],vector.x,vector.y,vector.z)}}}return function(){geometry=this.geometry;pointMap=this.pointMap;var w=1,h=1;camera.projectionMatrix.copy(this.camera.projectionMatrix);setPoint("c",0,0,-1);setPoint("t",0,0,1);setPoint("n1",-w,-h,-1);setPoint("n2",w,-h,-1);setPoint("n3",-w,h,-1);setPoint("n4",w,h,-1);setPoint("f1",-w,-h,1);setPoint("f2",w,-h,1);setPoint("f3",-w,h,1);setPoint("f4",w,h,1);setPoint("u1",.7*w,1.1*h,-1);setPoint("u2",.7*-w,1.1*h,-1);setPoint("u3",0,2*h,-1);setPoint("cf1",-w,0,1);setPoint("cf2",w,0,1);setPoint("cf3",0,-h,1);setPoint("cf4",0,h,1);setPoint("cn1",-w,0,-1);setPoint("cn2",w,0,-1);setPoint("cn3",0,-h,-1);setPoint("cn4",0,h,-1);geometry.getAttribute("position").needsUpdate=!0}}();function BoxHelper(object,color){this.object=object;if(color===void 0)color=16776960;var indices=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),positions=new Float32Array(3*8),geometry=new BufferGeometry;geometry.setIndex(new BufferAttribute(indices,1));geometry.addAttribute("position",new BufferAttribute(positions,3));LineSegments.call(this,geometry,new LineBasicMaterial({color:color}));this.matrixAutoUpdate=!1;this.update()}BoxHelper.prototype=Object.create(LineSegments.prototype);BoxHelper.prototype.constructor=BoxHelper;BoxHelper.prototype.update=function(){var box=new Box3;return function(object){if(object!==void 0){console.warn("THREE.BoxHelper: .update() has no longer arguments.")}if(this.object!==void 0){box.setFromObject(this.object)}if(box.isEmpty())return;var min=box.min,max=box.max,position=this.geometry.attributes.position,array=position.array;array[0]=max.x;array[1]=max.y;array[2]=max.z;array[3]=min.x;array[4]=max.y;array[5]=max.z;array[6]=min.x;array[7]=min.y;array[8]=max.z;array[9]=max.x;array[10]=min.y;array[11]=max.z;array[12]=max.x;array[13]=max.y;array[14]=min.z;array[15]=min.x;array[16]=max.y;array[17]=min.z;array[18]=min.x;array[19]=min.y;array[20]=min.z;array[21]=max.x;array[22]=min.y;array[23]=min.z;position.needsUpdate=!0;this.geometry.computeBoundingSphere()}}();BoxHelper.prototype.setFromObject=function(object){this.object=object;this.update();return this};function Box3Helper(box,hex){this.type="Box3Helper";this.box=box;var color=hex!==void 0?hex:16776960,indices=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),geometry=new BufferGeometry;geometry.setIndex(new BufferAttribute(indices,1));geometry.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3));LineSegments.call(this,geometry,new LineBasicMaterial({color:color}));this.geometry.computeBoundingSphere()}Box3Helper.prototype=Object.create(LineSegments.prototype);Box3Helper.prototype.constructor=Box3Helper;Box3Helper.prototype.updateMatrixWorld=function(force){var box=this.box;if(box.isEmpty())return;box.getCenter(this.position);box.getSize(this.scale);this.scale.multiplyScalar(.5);Object3D.prototype.updateMatrixWorld.call(this,force)};function PlaneHelper(plane,size,hex){this.type="PlaneHelper";this.plane=plane;this.size=size===void 0?1:size;var color=hex!==void 0?hex:16776960,geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3));geometry.computeBoundingSphere();Line.call(this,geometry,new LineBasicMaterial({color:color}));var geometry2=new BufferGeometry;geometry2.addAttribute("position",new Float32BufferAttribute([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3));geometry2.computeBoundingSphere();this.add(new Mesh(geometry2,new MeshBasicMaterial({color:color,opacity:.2,transparent:!0,depthWrite:!1})))}PlaneHelper.prototype=Object.create(Line.prototype);PlaneHelper.prototype.constructor=PlaneHelper;PlaneHelper.prototype.updateMatrixWorld=function(force){var scale=-this.plane.constant;if(1e-8>_Mathabs(scale))scale=1e-8;this.scale.set(.5*this.size,.5*this.size,scale);this.lookAt(this.plane.normal);Object3D.prototype.updateMatrixWorld.call(this,force)};var lineGeometry,coneGeometry;function ArrowHelper(dir,origin,length,color,headLength,headWidth){Object3D.call(this);if(color===void 0)color=16776960;if(length===void 0)length=1;if(headLength===void 0)headLength=.2*length;if(headWidth===void 0)headWidth=.2*headLength;if(lineGeometry===void 0){lineGeometry=new BufferGeometry;lineGeometry.addAttribute("position",new Float32BufferAttribute([0,0,0,0,1,0],3));coneGeometry=new CylinderBufferGeometry(0,.5,1,5,1);coneGeometry.translate(0,-.5,0)}this.position.copy(origin);this.line=new Line(lineGeometry,new LineBasicMaterial({color:color}));this.line.matrixAutoUpdate=!1;this.add(this.line);this.cone=new Mesh(coneGeometry,new MeshBasicMaterial({color:color}));this.cone.matrixAutoUpdate=!1;this.add(this.cone);this.setDirection(dir);this.setLength(length,headLength,headWidth)}ArrowHelper.prototype=Object.create(Object3D.prototype);ArrowHelper.prototype.constructor=ArrowHelper;ArrowHelper.prototype.setDirection=function(){var axis=new Vector3,radians;return function(dir){if(.99999<dir.y){this.quaternion.set(0,0,0,1)}else if(-.99999>dir.y){this.quaternion.set(1,0,0,0)}else{axis.set(dir.z,0,-dir.x).normalize();radians=_Mathacos(dir.y);this.quaternion.setFromAxisAngle(axis,radians)}}}();ArrowHelper.prototype.setLength=function(length,headLength,headWidth){if(headLength===void 0)headLength=.2*length;if(headWidth===void 0)headWidth=.2*headLength;this.line.scale.set(1,_Mathmax(0,length-headLength),1);this.line.updateMatrix();this.cone.scale.set(headWidth,headLength,headWidth);this.cone.position.y=length;this.cone.updateMatrix()};ArrowHelper.prototype.setColor=function(color){this.line.material.color.copy(color);this.cone.material.color.copy(color)};function AxesHelper(size){size=size||1;var vertices=[0,0,0,size,0,0,0,0,0,0,size,0,0,0,0,0,0,size],geometry=new BufferGeometry;geometry.addAttribute("position",new Float32BufferAttribute(vertices,3));geometry.addAttribute("color",new Float32BufferAttribute([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var material=new LineBasicMaterial({vertexColors:VertexColors});LineSegments.call(this,geometry,material)}AxesHelper.prototype=Object.create(LineSegments.prototype);AxesHelper.prototype.constructor=AxesHelper;Curve.create=function(construct,getPoint){console.log("THREE.Curve.create() has been deprecated");construct.prototype=Object.create(Curve.prototype);construct.prototype.constructor=construct;construct.prototype.getPoint=getPoint;return construct};Object.assign(CurvePath.prototype,{createPointsGeometry:function createPointsGeometry(divisions){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var pts=this.getPoints(divisions);return this.createGeometry(pts)},createSpacedPointsGeometry:function createSpacedPointsGeometry(divisions){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var pts=this.getSpacedPoints(divisions);return this.createGeometry(pts)},createGeometry:function createGeometry(points){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var geometry=new Geometry,i=0,l=points.length,point;i<l;i++){point=points[i];geometry.vertices.push(new Vector3(point.x,point.y,point.z||0))}return geometry}});Object.assign(Path.prototype,{fromPoints:function fromPoints(points){console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints().");this.setFromPoints(points)}});function ClosedSplineCurve3(points){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");CatmullRomCurve3.call(this,points);this.type="catmullrom";this.closed=!0}ClosedSplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype);function SplineCurve3(points){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead.");CatmullRomCurve3.call(this,points);this.type="catmullrom"}SplineCurve3.prototype=Object.create(CatmullRomCurve3.prototype);function Spline(points){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead.");CatmullRomCurve3.call(this,points);this.type="catmullrom"}Spline.prototype=Object.create(CatmullRomCurve3.prototype);Object.assign(Spline.prototype,{initFromArray:function initFromArray(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function getControlPointsArray(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function reparametrizeByArcLength(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}});GridHelper.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")};SkeletonHelper.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")};Object.assign(Loader.prototype,{extractUrlBase:function extractUrlBase(url){console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead.");return LoaderUtils.extractUrlBase(url)}});Object.assign(Box2.prototype,{center:function center(optionalTarget){console.warn("THREE.Box2: .center() has been renamed to .getCenter().");return this.getCenter(optionalTarget)},empty:function empty(){console.warn("THREE.Box2: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function isIntersectionBox(box){console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(box)},size:function size(optionalTarget){console.warn("THREE.Box2: .size() has been renamed to .getSize().");return this.getSize(optionalTarget)}});Object.assign(Box3.prototype,{center:function center(optionalTarget){console.warn("THREE.Box3: .center() has been renamed to .getCenter().");return this.getCenter(optionalTarget)},empty:function empty(){console.warn("THREE.Box3: .empty() has been renamed to .isEmpty().");return this.isEmpty()},isIntersectionBox:function isIntersectionBox(box){console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(box)},isIntersectionSphere:function isIntersectionSphere(sphere){console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(sphere)},size:function size(optionalTarget){console.warn("THREE.Box3: .size() has been renamed to .getSize().");return this.getSize(optionalTarget)}});Line3.prototype.center=function(optionalTarget){console.warn("THREE.Line3: .center() has been renamed to .getCenter().");return this.getCenter(optionalTarget)};Object.assign(_Math,{random16:function random16(){console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead.");return Math.random()},nearestPowerOfTwo:function nearestPowerOfTwo(value){console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo().");return _Math.floorPowerOfTwo(value)},nextPowerOfTwo:function nextPowerOfTwo(value){console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo().");return _Math.ceilPowerOfTwo(value)}});Object.assign(Matrix3.prototype,{flattenToArrayOffset:function flattenToArrayOffset(array,offset){console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(array,offset)},multiplyVector3:function multiplyVector3(vector){console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead.");return vector.applyMatrix3(this)},multiplyVector3Array:function multiplyVector3Array(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBuffer:function applyToBuffer(buffer){console.warn("THREE.Matrix3: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(buffer)},applyToVector3Array:function applyToVector3Array(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}});Object.assign(Matrix4.prototype,{extractPosition:function extractPosition(m){console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition().");return this.copyPosition(m)},flattenToArrayOffset:function flattenToArrayOffset(array,offset){console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead.");return this.toArray(array,offset)},getPosition:function(){var v1;return function(){if(v1===void 0)v1=new Vector3;console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");return v1.setFromMatrixColumn(this,3)}}(),setRotationFromQuaternion:function setRotationFromQuaternion(q){console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion().");return this.makeRotationFromQuaternion(q)},multiplyToArray:function multiplyToArray(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function multiplyVector3(vector){console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead.");return vector.applyMatrix4(this)},multiplyVector4:function multiplyVector4(vector){console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead.");return vector.applyMatrix4(this)},multiplyVector3Array:function multiplyVector3Array(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function rotateAxis(v){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead.");v.transformDirection(this)},crossVector:function crossVector(vector){console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead.");return vector.applyMatrix4(this)},translate:function translate(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function rotateX(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function rotateY(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function rotateZ(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function rotateByAxis(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBuffer:function applyToBuffer(buffer){console.warn("THREE.Matrix4: .applyToBuffer() has been removed. Use matrix.applyToBufferAttribute( attribute ) instead.");return this.applyToBufferAttribute(buffer)},applyToVector3Array:function applyToVector3Array(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function makeFrustum(left,right,bottom,top,near,far){console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead.");return this.makePerspective(left,right,top,bottom,near,far)}});Plane.prototype.isIntersectionLine=function(line){console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine().");return this.intersectsLine(line)};Quaternion.prototype.multiplyVector3=function(vector){console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead.");return vector.applyQuaternion(this)};Object.assign(Ray.prototype,{isIntersectionBox:function isIntersectionBox(box){console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox().");return this.intersectsBox(box)},isIntersectionPlane:function isIntersectionPlane(plane){console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane().");return this.intersectsPlane(plane)},isIntersectionSphere:function isIntersectionSphere(sphere){console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere().");return this.intersectsSphere(sphere)}});Object.assign(Shape.prototype,{extractAllPoints:function extractAllPoints(divisions){console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead.");return this.extractPoints(divisions)},extrude:function extrude(options){console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead.");return new ExtrudeGeometry(this,options)},makeGeometry:function makeGeometry(options){console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead.");return new ShapeGeometry(this,options)}});Object.assign(Vector2.prototype,{fromAttribute:function fromAttribute(attribute,index,offset){console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(attribute,index,offset)},distanceToManhattan:function distanceToManhattan(v){console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(v)},lengthManhattan:function lengthManhattan(){console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(Vector3.prototype,{setEulerFromRotationMatrix:function setEulerFromRotationMatrix(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function setEulerFromQuaternion(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function getPositionFromMatrix(m){console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition().");return this.setFromMatrixPosition(m)},getScaleFromMatrix:function getScaleFromMatrix(m){console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale().");return this.setFromMatrixScale(m)},getColumnFromMatrix:function getColumnFromMatrix(index,matrix){console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn().");return this.setFromMatrixColumn(matrix,index)},applyProjection:function applyProjection(m){console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead.");return this.applyMatrix4(m)},fromAttribute:function fromAttribute(attribute,index,offset){console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(attribute,index,offset)},distanceToManhattan:function distanceToManhattan(v){console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo().");return this.manhattanDistanceTo(v)},lengthManhattan:function lengthManhattan(){console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(Vector4.prototype,{fromAttribute:function fromAttribute(attribute,index,offset){console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute().");return this.fromBufferAttribute(attribute,index,offset)},lengthManhattan:function lengthManhattan(){console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength().");return this.manhattanLength()}});Object.assign(Geometry.prototype,{computeTangents:function computeTangents(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function computeLineDistances(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")}});Object.assign(Object3D.prototype,{getChildByName:function getChildByName(name){console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName().");return this.getObjectByName(name)},renderDepth:function renderDepth(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function translate(distance,axis){console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead.");return this.translateOnAxis(axis,distance)}});Object.defineProperties(Object3D.prototype,{eulerOrder:{get:function get(){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");return this.rotation.order},set:function set(value){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order.");this.rotation.order=value}},useQuaternion:{get:function get(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function set(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}});Object.defineProperties(LOD.prototype,{objects:{get:function get(){console.warn("THREE.LOD: .objects has been renamed to .levels.");return this.levels}}});Object.defineProperty(Skeleton.prototype,"useVertexTexture",{get:function get(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function set(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}});Object.defineProperty(Curve.prototype,"__arcLengthDivisions",{get:function get(){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");return this.arcLengthDivisions},set:function set(value){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions.");this.arcLengthDivisions=value}});PerspectiveCamera.prototype.setLens=function(focalLength,filmGauge){console.warn("THREE.PerspectiveCamera.setLens is deprecated. "+"Use .setFocalLength and .filmGauge for a photographic setup.");if(filmGauge!==void 0)this.filmGauge=filmGauge;this.setFocalLength(focalLength)};Object.defineProperties(Light.prototype,{onlyShadow:{set:function set(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function set(value){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov.");this.shadow.camera.fov=value}},shadowCameraLeft:{set:function set(value){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left.");this.shadow.camera.left=value}},shadowCameraRight:{set:function set(value){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right.");this.shadow.camera.right=value}},shadowCameraTop:{set:function set(value){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top.");this.shadow.camera.top=value}},shadowCameraBottom:{set:function set(value){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom.");this.shadow.camera.bottom=value}},shadowCameraNear:{set:function set(value){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near.");this.shadow.camera.near=value}},shadowCameraFar:{set:function set(value){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far.");this.shadow.camera.far=value}},shadowCameraVisible:{set:function set(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function set(value){console.warn("THREE.Light: .shadowBias is now .shadow.bias.");this.shadow.bias=value}},shadowDarkness:{set:function set(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function set(value){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width.");this.shadow.mapSize.width=value}},shadowMapHeight:{set:function set(value){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height.");this.shadow.mapSize.height=value}}});Object.defineProperties(BufferAttribute.prototype,{length:{get:function get(){console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead.");return this.array.length}}});Object.assign(BufferGeometry.prototype,{addIndex:function addIndex(index){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex().");this.setIndex(index)},addDrawCall:function addDrawCall(start,count,indexOffset){if(indexOffset!==void 0){console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset.")}console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup().");this.addGroup(start,count)},clearDrawCalls:function clearDrawCalls(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups().");this.clearGroups()},computeTangents:function computeTangents(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function computeOffsets(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")}});Object.defineProperties(BufferGeometry.prototype,{drawcalls:{get:function get(){console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups.");return this.groups}},offsets:{get:function get(){console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups.");return this.groups}}});Object.defineProperties(Uniform.prototype,{dynamic:{set:function set(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function value(){console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead.");return this}}});Object.defineProperties(Material.prototype,{wrapAround:{get:function get(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function set(){console.warn("THREE.Material: .wrapAround has been removed.")}},wrapRGB:{get:function get(){console.warn("THREE.Material: .wrapRGB has been removed.");return new Color}},shading:{get:function get(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function set(value){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.");this.flatShading=value===FlatShading}}});Object.defineProperties(MeshPhongMaterial.prototype,{metal:{get:function get(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead.");return!1},set:function set(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}});Object.defineProperties(ShaderMaterial.prototype,{derivatives:{get:function get(){console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");return this.extensions.derivatives},set:function set(value){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives.");this.extensions.derivatives=value}}});Object.assign(WebGLRenderer.prototype,{getCurrentRenderTarget:function getCurrentRenderTarget(){console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget().");return this.getRenderTarget()},getMaxAnisotropy:function getMaxAnisotropy(){console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy().");return this.capabilities.getMaxAnisotropy()},getPrecision:function getPrecision(){console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision.");return this.capabilities.precision},resetGLState:function resetGLState(){console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset().");return this.state.reset()},supportsFloatTextures:function supportsFloatTextures(){console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' ).");return this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function supportsHalfFloatTextures(){console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' ).");return this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function supportsStandardDerivatives(){console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' ).");return this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function supportsCompressedTextureS3TC(){console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' ).");return this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function supportsCompressedTexturePVRTC(){console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' ).");return this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function supportsBlendMinMax(){console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' ).");return this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function supportsVertexTextures(){console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures.");return this.capabilities.vertexTextures},supportsInstancedArrays:function supportsInstancedArrays(){console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' ).");return this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function enableScissorTest(boolean){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest().");this.setScissorTest(boolean)},initMaterial:function initMaterial(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function addPrePlugin(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function addPostPlugin(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function updateShadowMap(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function setFaceCulling(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")}});Object.defineProperties(WebGLRenderer.prototype,{shadowMapEnabled:{get:function get(){return this.shadowMap.enabled},set:function set(value){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled.");this.shadowMap.enabled=value}},shadowMapType:{get:function get(){return this.shadowMap.type},set:function set(value){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type.");this.shadowMap.type=value}},shadowMapCullFace:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(WebGLShadowMap.prototype,{cullFace:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function get(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function set(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}});Object.defineProperties(WebGLRenderTarget.prototype,{wrapS:{get:function get(){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");return this.texture.wrapS},set:function set(value){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS.");this.texture.wrapS=value}},wrapT:{get:function get(){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");return this.texture.wrapT},set:function set(value){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT.");this.texture.wrapT=value}},magFilter:{get:function get(){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");return this.texture.magFilter},set:function set(value){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter.");this.texture.magFilter=value}},minFilter:{get:function get(){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");return this.texture.minFilter},set:function set(value){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter.");this.texture.minFilter=value}},anisotropy:{get:function get(){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");return this.texture.anisotropy},set:function set(value){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy.");this.texture.anisotropy=value}},offset:{get:function get(){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");return this.texture.offset},set:function set(value){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset.");this.texture.offset=value}},repeat:{get:function get(){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");return this.texture.repeat},set:function set(value){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat.");this.texture.repeat=value}},format:{get:function get(){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");return this.texture.format},set:function set(value){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format.");this.texture.format=value}},type:{get:function get(){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");return this.texture.type},set:function set(value){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type.");this.texture.type=value}},generateMipmaps:{get:function get(){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");return this.texture.generateMipmaps},set:function set(value){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps.");this.texture.generateMipmaps=value}}});Object.defineProperties(WebVRManager.prototype,{standing:{set:function set(){console.warn("THREE.WebVRManager: .standing has been removed.")}}});Audio.prototype.load=function(file){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var scope=this,audioLoader=new AudioLoader;audioLoader.load(file,function(buffer){scope.setBuffer(buffer)});return this};AudioAnalyser.prototype.getData=function(){console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData().");return this.getFrequencyData()};CubeCamera.prototype.updateCubeMap=function(renderer,scene){console.warn("THREE.CubeCamera: .updateCubeMap() is now .update().");return this.update(renderer,scene)};exports.WebGLRenderTargetCube=WebGLRenderTargetCube;exports.WebGLRenderTarget=WebGLRenderTarget;exports.WebGLRenderer=WebGLRenderer;exports.ShaderLib=ShaderLib;exports.UniformsLib=UniformsLib;exports.UniformsUtils=UniformsUtils;exports.ShaderChunk=ShaderChunk;exports.FogExp2=FogExp2;exports.Fog=Fog;exports.Scene=Scene;exports.Sprite=Sprite;exports.LOD=LOD;exports.SkinnedMesh=SkinnedMesh;exports.Skeleton=Skeleton;exports.Bone=Bone;exports.Mesh=Mesh;exports.LineSegments=LineSegments;exports.LineLoop=LineLoop;exports.Line=Line;exports.Points=Points;exports.Group=Group;exports.VideoTexture=VideoTexture;exports.DataTexture=DataTexture;exports.CompressedTexture=CompressedTexture;exports.CubeTexture=CubeTexture;exports.CanvasTexture=CanvasTexture;exports.DepthTexture=DepthTexture;exports.Texture=Texture;exports.CompressedTextureLoader=CompressedTextureLoader;exports.DataTextureLoader=DataTextureLoader;exports.CubeTextureLoader=CubeTextureLoader;exports.TextureLoader=TextureLoader;exports.ObjectLoader=ObjectLoader;exports.MaterialLoader=MaterialLoader;exports.BufferGeometryLoader=BufferGeometryLoader;exports.DefaultLoadingManager=DefaultLoadingManager;exports.LoadingManager=LoadingManager;exports.JSONLoader=JSONLoader;exports.ImageLoader=ImageLoader;exports.ImageBitmapLoader=ImageBitmapLoader;exports.FontLoader=FontLoader;exports.FileLoader=FileLoader;exports.Loader=Loader;exports.LoaderUtils=LoaderUtils;exports.Cache=Cache;exports.AudioLoader=AudioLoader;exports.SpotLightShadow=SpotLightShadow;exports.SpotLight=SpotLight;exports.PointLight=PointLight;exports.RectAreaLight=RectAreaLight;exports.HemisphereLight=HemisphereLight;exports.DirectionalLightShadow=DirectionalLightShadow;exports.DirectionalLight=DirectionalLight;exports.AmbientLight=AmbientLight;exports.LightShadow=LightShadow;exports.Light=Light;exports.StereoCamera=StereoCamera;exports.PerspectiveCamera=PerspectiveCamera;exports.OrthographicCamera=OrthographicCamera;exports.CubeCamera=CubeCamera;exports.ArrayCamera=ArrayCamera;exports.Camera=Camera;exports.AudioListener=AudioListener;exports.PositionalAudio=PositionalAudio;exports.AudioContext=AudioContext;exports.AudioAnalyser=AudioAnalyser;exports.Audio=Audio;exports.VectorKeyframeTrack=VectorKeyframeTrack;exports.StringKeyframeTrack=StringKeyframeTrack;exports.QuaternionKeyframeTrack=QuaternionKeyframeTrack;exports.NumberKeyframeTrack=NumberKeyframeTrack;exports.ColorKeyframeTrack=ColorKeyframeTrack;exports.BooleanKeyframeTrack=BooleanKeyframeTrack;exports.PropertyMixer=PropertyMixer;exports.PropertyBinding=PropertyBinding;exports.KeyframeTrack=KeyframeTrack;exports.AnimationUtils=AnimationUtils;exports.AnimationObjectGroup=AnimationObjectGroup;exports.AnimationMixer=AnimationMixer;exports.AnimationClip=AnimationClip;exports.Uniform=Uniform;exports.InstancedBufferGeometry=InstancedBufferGeometry;exports.BufferGeometry=BufferGeometry;exports.Geometry=Geometry;exports.InterleavedBufferAttribute=InterleavedBufferAttribute;exports.InstancedInterleavedBuffer=InstancedInterleavedBuffer;exports.InterleavedBuffer=InterleavedBuffer;exports.InstancedBufferAttribute=InstancedBufferAttribute;exports.Face3=Face3;exports.Object3D=Object3D;exports.Raycaster=Raycaster;exports.Layers=Layers;exports.EventDispatcher=EventDispatcher;exports.Clock=Clock;exports.QuaternionLinearInterpolant=QuaternionLinearInterpolant;exports.LinearInterpolant=LinearInterpolant;exports.DiscreteInterpolant=DiscreteInterpolant;exports.CubicInterpolant=CubicInterpolant;exports.Interpolant=Interpolant;exports.Triangle=Triangle;exports.Math=_Math;exports.Spherical=Spherical;exports.Cylindrical=Cylindrical;exports.Plane=Plane;exports.Frustum=Frustum;exports.Sphere=Sphere;exports.Ray=Ray;exports.Matrix4=Matrix4;exports.Matrix3=Matrix3;exports.Box3=Box3;exports.Box2=Box2;exports.Line3=Line3;exports.Euler=Euler;exports.Vector4=Vector4;exports.Vector3=Vector3;exports.Vector2=Vector2;exports.Quaternion=Quaternion;exports.Color=Color;exports.ImmediateRenderObject=ImmediateRenderObject;exports.VertexNormalsHelper=VertexNormalsHelper;exports.SpotLightHelper=SpotLightHelper;exports.SkeletonHelper=SkeletonHelper;exports.PointLightHelper=PointLightHelper;exports.RectAreaLightHelper=RectAreaLightHelper;exports.HemisphereLightHelper=HemisphereLightHelper;exports.GridHelper=GridHelper;exports.PolarGridHelper=PolarGridHelper;exports.FaceNormalsHelper=FaceNormalsHelper;exports.DirectionalLightHelper=DirectionalLightHelper;exports.CameraHelper=CameraHelper;exports.BoxHelper=BoxHelper;exports.Box3Helper=Box3Helper;exports.PlaneHelper=PlaneHelper;exports.ArrowHelper=ArrowHelper;exports.AxesHelper=AxesHelper;exports.Shape=Shape;exports.Path=Path;exports.ShapePath=ShapePath;exports.Font=Font;exports.CurvePath=CurvePath;exports.Curve=Curve;exports.ShapeUtils=ShapeUtils;exports.WebGLUtils=WebGLUtils;exports.WireframeGeometry=WireframeGeometry;exports.ParametricGeometry=ParametricGeometry;exports.ParametricBufferGeometry=ParametricBufferGeometry;exports.TetrahedronGeometry=TetrahedronGeometry;exports.TetrahedronBufferGeometry=TetrahedronBufferGeometry;exports.OctahedronGeometry=OctahedronGeometry;exports.OctahedronBufferGeometry=OctahedronBufferGeometry;exports.IcosahedronGeometry=IcosahedronGeometry;exports.IcosahedronBufferGeometry=IcosahedronBufferGeometry;exports.DodecahedronGeometry=DodecahedronGeometry;exports.DodecahedronBufferGeometry=DodecahedronBufferGeometry;exports.PolyhedronGeometry=PolyhedronGeometry;exports.PolyhedronBufferGeometry=PolyhedronBufferGeometry;exports.TubeGeometry=TubeGeometry;exports.TubeBufferGeometry=TubeBufferGeometry;exports.TorusKnotGeometry=TorusKnotGeometry;exports.TorusKnotBufferGeometry=TorusKnotBufferGeometry;exports.TorusGeometry=TorusGeometry;exports.TorusBufferGeometry=TorusBufferGeometry;exports.TextGeometry=TextGeometry;exports.TextBufferGeometry=TextBufferGeometry;exports.SphereGeometry=SphereGeometry;exports.SphereBufferGeometry=SphereBufferGeometry;exports.RingGeometry=RingGeometry;exports.RingBufferGeometry=RingBufferGeometry;exports.PlaneGeometry=PlaneGeometry;exports.PlaneBufferGeometry=PlaneBufferGeometry;exports.LatheGeometry=LatheGeometry;exports.LatheBufferGeometry=LatheBufferGeometry;exports.ShapeGeometry=ShapeGeometry;exports.ShapeBufferGeometry=ShapeBufferGeometry;exports.ExtrudeGeometry=ExtrudeGeometry;exports.ExtrudeBufferGeometry=ExtrudeBufferGeometry;exports.EdgesGeometry=EdgesGeometry;exports.ConeGeometry=ConeGeometry;exports.ConeBufferGeometry=ConeBufferGeometry;exports.CylinderGeometry=CylinderGeometry;exports.CylinderBufferGeometry=CylinderBufferGeometry;exports.CircleGeometry=CircleGeometry;exports.CircleBufferGeometry=CircleBufferGeometry;exports.BoxGeometry=BoxGeometry;exports.BoxBufferGeometry=BoxBufferGeometry;exports.ShadowMaterial=ShadowMaterial;exports.SpriteMaterial=SpriteMaterial;exports.RawShaderMaterial=RawShaderMaterial;exports.ShaderMaterial=ShaderMaterial;exports.PointsMaterial=PointsMaterial;exports.MeshPhysicalMaterial=MeshPhysicalMaterial;exports.MeshStandardMaterial=MeshStandardMaterial;exports.MeshPhongMaterial=MeshPhongMaterial;exports.MeshToonMaterial=MeshToonMaterial;exports.MeshNormalMaterial=MeshNormalMaterial;exports.MeshLambertMaterial=MeshLambertMaterial;exports.MeshDepthMaterial=MeshDepthMaterial;exports.MeshDistanceMaterial=MeshDistanceMaterial;exports.MeshBasicMaterial=MeshBasicMaterial;exports.LineDashedMaterial=LineDashedMaterial;exports.LineBasicMaterial=LineBasicMaterial;exports.Material=Material;exports.Float64BufferAttribute=Float64BufferAttribute;exports.Float32BufferAttribute=Float32BufferAttribute;exports.Uint32BufferAttribute=Uint32BufferAttribute;exports.Int32BufferAttribute=Int32BufferAttribute;exports.Uint16BufferAttribute=Uint16BufferAttribute;exports.Int16BufferAttribute=Int16BufferAttribute;exports.Uint8ClampedBufferAttribute=Uint8ClampedBufferAttribute;exports.Uint8BufferAttribute=Uint8BufferAttribute;exports.Int8BufferAttribute=Int8BufferAttribute;exports.BufferAttribute=BufferAttribute;exports.ArcCurve=ArcCurve;exports.CatmullRomCurve3=CatmullRomCurve3;exports.CubicBezierCurve=CubicBezierCurve;exports.CubicBezierCurve3=CubicBezierCurve3;exports.EllipseCurve=EllipseCurve;exports.LineCurve=LineCurve;exports.LineCurve3=LineCurve3;exports.QuadraticBezierCurve=QuadraticBezierCurve;exports.QuadraticBezierCurve3=QuadraticBezierCurve3;exports.SplineCurve=SplineCurve;exports.REVISION=REVISION;exports.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2};exports.CullFaceNone=CullFaceNone;exports.CullFaceBack=CullFaceBack;exports.CullFaceFront=CullFaceFront;exports.CullFaceFrontBack=3;exports.FrontFaceDirectionCW=0;exports.FrontFaceDirectionCCW=1;exports.BasicShadowMap=0;exports.PCFShadowMap=PCFShadowMap;exports.PCFSoftShadowMap=PCFSoftShadowMap;exports.FrontSide=FrontSide;exports.BackSide=BackSide;exports.DoubleSide=DoubleSide;exports.FlatShading=FlatShading;exports.SmoothShading=2;exports.NoColors=NoColors;exports.FaceColors=FaceColors;exports.VertexColors=VertexColors;exports.NoBlending=NoBlending;exports.NormalBlending=NormalBlending;exports.AdditiveBlending=AdditiveBlending;exports.SubtractiveBlending=SubtractiveBlending;exports.MultiplyBlending=MultiplyBlending;exports.CustomBlending=CustomBlending;exports.AddEquation=AddEquation;exports.SubtractEquation=SubtractEquation;exports.ReverseSubtractEquation=ReverseSubtractEquation;exports.MinEquation=MinEquation;exports.MaxEquation=MaxEquation;exports.ZeroFactor=ZeroFactor;exports.OneFactor=OneFactor;exports.SrcColorFactor=SrcColorFactor;exports.OneMinusSrcColorFactor=OneMinusSrcColorFactor;exports.SrcAlphaFactor=SrcAlphaFactor;exports.OneMinusSrcAlphaFactor=OneMinusSrcAlphaFactor;exports.DstAlphaFactor=DstAlphaFactor;exports.OneMinusDstAlphaFactor=OneMinusDstAlphaFactor;exports.DstColorFactor=DstColorFactor;exports.OneMinusDstColorFactor=OneMinusDstColorFactor;exports.SrcAlphaSaturateFactor=SrcAlphaSaturateFactor;exports.NeverDepth=NeverDepth;exports.AlwaysDepth=AlwaysDepth;exports.LessDepth=LessDepth;exports.LessEqualDepth=LessEqualDepth;exports.EqualDepth=EqualDepth;exports.GreaterEqualDepth=GreaterEqualDepth;exports.GreaterDepth=GreaterDepth;exports.NotEqualDepth=NotEqualDepth;exports.MultiplyOperation=MultiplyOperation;exports.MixOperation=MixOperation;exports.AddOperation=AddOperation;exports.NoToneMapping=NoToneMapping;exports.LinearToneMapping=LinearToneMapping;exports.ReinhardToneMapping=ReinhardToneMapping;exports.Uncharted2ToneMapping=Uncharted2ToneMapping;exports.CineonToneMapping=CineonToneMapping;exports.UVMapping=UVMapping;exports.CubeReflectionMapping=CubeReflectionMapping;exports.CubeRefractionMapping=CubeRefractionMapping;exports.EquirectangularReflectionMapping=EquirectangularReflectionMapping;exports.EquirectangularRefractionMapping=EquirectangularRefractionMapping;exports.SphericalReflectionMapping=SphericalReflectionMapping;exports.CubeUVReflectionMapping=CubeUVReflectionMapping;exports.CubeUVRefractionMapping=CubeUVRefractionMapping;exports.RepeatWrapping=RepeatWrapping;exports.ClampToEdgeWrapping=ClampToEdgeWrapping;exports.MirroredRepeatWrapping=MirroredRepeatWrapping;exports.NearestFilter=NearestFilter;exports.NearestMipMapNearestFilter=NearestMipMapNearestFilter;exports.NearestMipMapLinearFilter=NearestMipMapLinearFilter;exports.LinearFilter=LinearFilter;exports.LinearMipMapNearestFilter=LinearMipMapNearestFilter;exports.LinearMipMapLinearFilter=LinearMipMapLinearFilter;exports.UnsignedByteType=UnsignedByteType;exports.ByteType=ByteType;exports.ShortType=ShortType;exports.UnsignedShortType=UnsignedShortType;exports.IntType=IntType;exports.UnsignedIntType=UnsignedIntType;exports.FloatType=FloatType;exports.HalfFloatType=HalfFloatType;exports.UnsignedShort4444Type=UnsignedShort4444Type;exports.UnsignedShort5551Type=UnsignedShort5551Type;exports.UnsignedShort565Type=UnsignedShort565Type;exports.UnsignedInt248Type=UnsignedInt248Type;exports.AlphaFormat=AlphaFormat;exports.RGBFormat=RGBFormat;exports.RGBAFormat=RGBAFormat;exports.LuminanceFormat=LuminanceFormat;exports.LuminanceAlphaFormat=LuminanceAlphaFormat;exports.RGBEFormat=RGBAFormat;exports.DepthFormat=DepthFormat;exports.DepthStencilFormat=DepthStencilFormat;exports.RGB_S3TC_DXT1_Format=RGB_S3TC_DXT1_Format;exports.RGBA_S3TC_DXT1_Format=RGBA_S3TC_DXT1_Format;exports.RGBA_S3TC_DXT3_Format=RGBA_S3TC_DXT3_Format;exports.RGBA_S3TC_DXT5_Format=RGBA_S3TC_DXT5_Format;exports.RGB_PVRTC_4BPPV1_Format=RGB_PVRTC_4BPPV1_Format;exports.RGB_PVRTC_2BPPV1_Format=RGB_PVRTC_2BPPV1_Format;exports.RGBA_PVRTC_4BPPV1_Format=RGBA_PVRTC_4BPPV1_Format;exports.RGBA_PVRTC_2BPPV1_Format=RGBA_PVRTC_2BPPV1_Format;exports.RGB_ETC1_Format=RGB_ETC1_Format;exports.RGBA_ASTC_4x4_Format=RGBA_ASTC_4x4_Format;exports.RGBA_ASTC_5x4_Format=RGBA_ASTC_5x4_Format;exports.RGBA_ASTC_5x5_Format=RGBA_ASTC_5x5_Format;exports.RGBA_ASTC_6x5_Format=RGBA_ASTC_6x5_Format;exports.RGBA_ASTC_6x6_Format=RGBA_ASTC_6x6_Format;exports.RGBA_ASTC_8x5_Format=RGBA_ASTC_8x5_Format;exports.RGBA_ASTC_8x6_Format=RGBA_ASTC_8x6_Format;exports.RGBA_ASTC_8x8_Format=RGBA_ASTC_8x8_Format;exports.RGBA_ASTC_10x5_Format=RGBA_ASTC_10x5_Format;exports.RGBA_ASTC_10x6_Format=RGBA_ASTC_10x6_Format;exports.RGBA_ASTC_10x8_Format=RGBA_ASTC_10x8_Format;exports.RGBA_ASTC_10x10_Format=RGBA_ASTC_10x10_Format;exports.RGBA_ASTC_12x10_Format=RGBA_ASTC_12x10_Format;exports.RGBA_ASTC_12x12_Format=RGBA_ASTC_12x12_Format;exports.LoopOnce=LoopOnce;exports.LoopRepeat=LoopRepeat;exports.LoopPingPong=LoopPingPong;exports.InterpolateDiscrete=InterpolateDiscrete;exports.InterpolateLinear=InterpolateLinear;exports.InterpolateSmooth=InterpolateSmooth;exports.ZeroCurvatureEnding=ZeroCurvatureEnding;exports.ZeroSlopeEnding=ZeroSlopeEnding;exports.WrapAroundEnding=WrapAroundEnding;exports.TrianglesDrawMode=TrianglesDrawMode;exports.TriangleStripDrawMode=TriangleStripDrawMode;exports.TriangleFanDrawMode=TriangleFanDrawMode;exports.LinearEncoding=LinearEncoding;exports.sRGBEncoding=sRGBEncoding;exports.GammaEncoding=GammaEncoding;exports.RGBEEncoding=RGBEEncoding;exports.LogLuvEncoding=3003;exports.RGBM7Encoding=RGBM7Encoding;exports.RGBM16Encoding=RGBM16Encoding;exports.RGBDEncoding=RGBDEncoding;exports.BasicDepthPacking=BasicDepthPacking;exports.RGBADepthPacking=RGBADepthPacking;exports.CubeGeometry=BoxGeometry;exports.Face4=function(a,b,c,d,normal,color,materialIndex){console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead.");return new Face3(a,b,c,normal,color,materialIndex)};exports.LineStrip=0;exports.LinePieces=1;exports.MeshFaceMaterial=function(materials){console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead.");return materials};exports.MultiMaterial=function(materials){if(materials===void 0)materials=[];console.warn("THREE.MultiMaterial has been removed. Use an Array instead.");materials.isMultiMaterial=!0;materials.materials=materials;materials.clone=function(){return materials.slice()};return materials};exports.PointCloud=function(geometry,material){console.warn("THREE.PointCloud has been renamed to THREE.Points.");return new Points(geometry,material)};exports.Particle=function(material){console.warn("THREE.Particle has been renamed to THREE.Sprite.");return new Sprite(material)};exports.ParticleSystem=function(geometry,material){console.warn("THREE.ParticleSystem has been renamed to THREE.Points.");return new Points(geometry,material)};exports.PointCloudMaterial=function(parameters){console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial.");return new PointsMaterial(parameters)};exports.ParticleBasicMaterial=function(parameters){console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial.");return new PointsMaterial(parameters)};exports.ParticleSystemMaterial=function(parameters){console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial.");return new PointsMaterial(parameters)};exports.Vertex=function(x,y,z){console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead.");return new Vector3(x,y,z)};exports.DynamicBufferAttribute=function(array,itemSize){console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setDynamic( true ) instead.");return new BufferAttribute(array,itemSize).setDynamic(!0)};exports.Int8Attribute=function(array,itemSize){console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead.");return new Int8BufferAttribute(array,itemSize)};exports.Uint8Attribute=function(array,itemSize){console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead.");return new Uint8BufferAttribute(array,itemSize)};exports.Uint8ClampedAttribute=function(array,itemSize){console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead.");return new Uint8ClampedBufferAttribute(array,itemSize)};exports.Int16Attribute=function(array,itemSize){console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead.");return new Int16BufferAttribute(array,itemSize)};exports.Uint16Attribute=function(array,itemSize){console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead.");return new Uint16BufferAttribute(array,itemSize)};exports.Int32Attribute=function(array,itemSize){console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead.");return new Int32BufferAttribute(array,itemSize)};exports.Uint32Attribute=function(array,itemSize){console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead.");return new Uint32BufferAttribute(array,itemSize)};exports.Float32Attribute=function(array,itemSize){console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead.");return new Float32BufferAttribute(array,itemSize)};exports.Float64Attribute=function(array,itemSize){console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead.");return new Float64BufferAttribute(array,itemSize)};exports.ClosedSplineCurve3=ClosedSplineCurve3;exports.SplineCurve3=SplineCurve3;exports.Spline=Spline;exports.AxisHelper=function(size){console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper.");return new AxesHelper(size)};exports.BoundingBoxHelper=function(object,color){console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead.");return new BoxHelper(object,color)};exports.EdgesHelper=function(object,hex){console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead.");return new LineSegments(new EdgesGeometry(object.geometry),new LineBasicMaterial({color:hex!==void 0?hex:16777215}))};exports.WireframeHelper=function(object,hex){console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead.");return new LineSegments(new WireframeGeometry(object.geometry),new LineBasicMaterial({color:hex!==void 0?hex:16777215}))};exports.XHRLoader=function(manager){console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader.");return new FileLoader(manager)};exports.BinaryTextureLoader=function(manager){console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader.");return new DataTextureLoader(manager)};exports.GeometryUtils={merge:function merge(geometry1,geometry2,materialIndexOffset){console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead.");var matrix;if(geometry2.isMesh){geometry2.matrixAutoUpdate&&geometry2.updateMatrix();matrix=geometry2.matrix;geometry2=geometry2.geometry}geometry1.merge(geometry2,matrix,materialIndexOffset)},center:function center(geometry){console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead.");return geometry.center()}};exports.ImageUtils={crossOrigin:void 0,loadTexture:function loadTexture(url,mapping,onLoad,onError){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var loader=new TextureLoader;loader.setCrossOrigin(this.crossOrigin);var texture=loader.load(url,onLoad,void 0,onError);if(mapping)texture.mapping=mapping;return texture},loadTextureCube:function loadTextureCube(urls,mapping,onLoad,onError){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var loader=new CubeTextureLoader;loader.setCrossOrigin(this.crossOrigin);var texture=loader.load(urls,onLoad,void 0,onError);if(mapping)texture.mapping=mapping;return texture},loadCompressedTexture:function loadCompressedTexture(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},loadCompressedTextureCube:function loadCompressedTextureCube(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")}};exports.Projector=function(){console.error("THREE.Projector has been moved to /examples/js/renderers/Projector.js.");this.projectVector=function(vector,camera){console.warn("THREE.Projector: .projectVector() is now vector.project().");vector.project(camera)};this.unprojectVector=function(vector,camera){console.warn("THREE.Projector: .unprojectVector() is now vector.unproject().");vector.unproject(camera)};this.pickingRay=function(){console.error("THREE.Projector: .pickingRay() is now raycaster.setFromCamera().")}};exports.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been moved to /examples/js/renderers/CanvasRenderer.js");this.domElement=document.createElementNS("http://www.w3.org/1999/xhtml","canvas");this.clear=function(){};this.render=function(){};this.setClearColor=function(){};this.setSize=function(){}};exports.SceneUtils={createMultiMaterialObject:function createMultiMaterialObject(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function detach(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function attach(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};exports.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")};Object.defineProperty(exports,"__esModule",{value:!0})})},{}],41:[function(){THREE.ColladaLoader=function(manager){this.manager=manager!==void 0?manager:THREE.DefaultLoadingManager};THREE.ColladaLoader.prototype={constructor:THREE.ColladaLoader,crossOrigin:"Anonymous",load:function load(url,onLoad,onProgress,onError){var scope=this,path=scope.path===void 0?THREE.LoaderUtils.extractUrlBase(url):scope.path,loader=new THREE.FileLoader(scope.manager);loader.load(url,function(text){onLoad(scope.parse(text,path))},onProgress,onError)},setPath:function setPath(value){this.path=value},options:{set convertUpAxis(value){console.warn("THREE.ColladaLoader: options.convertUpAxis() has been removed. Up axis is converted automatically.")}},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value},parse:function parse(text,path){function getElementsByTagName(xml,name){for(var array=[],childNodes=xml.childNodes,i=0,l=childNodes.length,child;i<l;i++){child=childNodes[i];if(child.nodeName===name){array.push(child)}}return array}function parseStrings(text){if(0===text.length)return[];for(var parts=text.trim().split(/\s+/),array=Array(parts.length),i=0,l=parts.length;i<l;i++){array[i]=parts[i]}return array}function parseFloats(text){if(0===text.length)return[];for(var parts=text.trim().split(/\s+/),array=Array(parts.length),i=0,l=parts.length;i<l;i++){array[i]=parseFloat(parts[i])}return array}function parseInts(text){if(0===text.length)return[];for(var parts=text.trim().split(/\s+/),array=Array(parts.length),i=0,l=parts.length;i<l;i++){array[i]=parseInt(parts[i])}return array}function parseId(text){return text.substring(1)}function generateId(){return"three_default_"+count++}function isEmpty(object){return 0===Object.keys(object).length}function parseAssetUnit(xml){return xml!==void 0?parseFloat(xml.getAttribute("meter")):1}function parseAssetUpAxis(xml){return xml!==void 0?xml.textContent:"Y_UP"}function parseLibrary(xml,libraryName,nodeName,parser){var library=getElementsByTagName(xml,libraryName)[0];if(library!==void 0){for(var elements=getElementsByTagName(library,nodeName),i=0;i<elements.length;i++){parser(elements[i])}}}function buildLibrary(data,builder){for(var name in data){var object=data[name];object.build=builder(data[name])}}function getBuild(data,builder){if(data.build!==void 0)return data.build;data.build=builder(data);return data.build}function parseAnimationSampler(xml){for(var data={inputs:{}},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"input":var id=parseId(child.getAttribute("source")),semantic=child.getAttribute("semantic");data.inputs[semantic]=id;break;}}return data}function parseAnimationChannel(xml){var data={},target=xml.getAttribute("target"),parts=target.split("/"),id=parts.shift(),sid=parts.shift(),arraySyntax=-1!==sid.indexOf("("),memberSyntax=-1!==sid.indexOf(".");if(memberSyntax){parts=sid.split(".");sid=parts.shift();data.member=parts.shift()}else if(arraySyntax){var indices=sid.split("(");sid=indices.shift();for(var i=0;i<indices.length;i++){indices[i]=parseInt(indices[i].replace(/\)/,""))}data.indices=indices}data.id=id;data.sid=sid;data.arraySyntax=arraySyntax;data.memberSyntax=memberSyntax;data.sampler=parseId(xml.getAttribute("source"));return data}function buildAnimation(data){var tracks=[],channels=data.channels,samplers=data.samplers,sources=data.sources;for(var target in channels){if(channels.hasOwnProperty(target)){var channel=channels[target],sampler=samplers[channel.sampler],inputId=sampler.inputs.INPUT,outputId=sampler.inputs.OUTPUT,inputSource=sources[inputId],outputSource=sources[outputId],animation=buildAnimationChannel(channel,inputSource,outputSource);createKeyframeTracks(animation,tracks)}}return tracks}function getAnimation(id){return getBuild(library.animations[id],buildAnimation)}function buildAnimationChannel(channel,inputSource,outputSource){var node=library.nodes[channel.id],object3D=getNode(node.id),transform=node.transforms[channel.sid],defaultMatrix=node.matrix.clone().transpose(),time,stride,i,il,j,jl,data={};switch(transform){case"matrix":for(i=0,il=inputSource.array.length;i<il;i++){time=inputSource.array[i];stride=i*outputSource.stride;if(data[time]===void 0)data[time]={};if(!0===channel.arraySyntax){var value=outputSource.array[stride],index=channel.indices[0]+4*channel.indices[1];data[time][index]=value}else{for(j=0,jl=outputSource.stride;j<jl;j++){data[time][j]=outputSource.array[stride+j]}}}break;case"translate":console.warn("THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.",transform);break;case"rotate":console.warn("THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.",transform);break;case"scale":console.warn("THREE.ColladaLoader: Animation transform type \"%s\" not yet implemented.",transform);break;}var keyframes=prepareAnimationData(data,defaultMatrix),animation={name:object3D.uuid,keyframes:keyframes};return animation}function prepareAnimationData(data,defaultMatrix){var keyframes=[];for(var time in data){keyframes.push({time:parseFloat(time),value:data[time]})}keyframes.sort(function(a,b){return a.time-b.time});for(var i=0;16>i;i++){transformAnimationData(keyframes,i,defaultMatrix.elements[i])}return keyframes}var position=new THREE.Vector3,scale=new THREE.Vector3,quaternion=new THREE.Quaternion;function createKeyframeTracks(animation,tracks){for(var keyframes=animation.keyframes,name=animation.name,times=[],positionData=[],quaternionData=[],scaleData=[],i=0,l=keyframes.length;i<l;i++){var keyframe=keyframes[i],time=keyframe.time,value=keyframe.value;matrix.fromArray(value).transpose();matrix.decompose(position,quaternion,scale);times.push(time);positionData.push(position.x,position.y,position.z);quaternionData.push(quaternion.x,quaternion.y,quaternion.z,quaternion.w);scaleData.push(scale.x,scale.y,scale.z)}if(0<positionData.length)tracks.push(new THREE.VectorKeyframeTrack(name+".position",times,positionData));if(0<quaternionData.length)tracks.push(new THREE.QuaternionKeyframeTrack(name+".quaternion",times,quaternionData));if(0<scaleData.length)tracks.push(new THREE.VectorKeyframeTrack(name+".scale",times,scaleData));return tracks}function transformAnimationData(keyframes,property,defaultValue){var keyframe,empty=!0,i,l;for(i=0,l=keyframes.length;i<l;i++){keyframe=keyframes[i];if(keyframe.value[property]===void 0){keyframe.value[property]=null}else{empty=!1}}if(!0===empty){for(i=0,l=keyframes.length;i<l;i++){keyframe=keyframes[i];keyframe.value[property]=defaultValue}}else{createMissingKeyframes(keyframes,property)}}function createMissingKeyframes(keyframes,property){for(var prev,next,i=0,l=keyframes.length,keyframe;i<l;i++){keyframe=keyframes[i];if(null===keyframe.value[property]){prev=getPrev(keyframes,i,property);next=getNext(keyframes,i,property);if(null===prev){keyframe.value[property]=next.value[property];continue}if(null===next){keyframe.value[property]=prev.value[property];continue}interpolate(keyframe,prev,next,property)}}}function getPrev(keyframes,i,property){while(0<=i){var keyframe=keyframes[i];if(null!==keyframe.value[property])return keyframe;i--}return null}function getNext(keyframes,i,property){while(i<keyframes.length){var keyframe=keyframes[i];if(null!==keyframe.value[property])return keyframe;i++}return null}function interpolate(key,prev,next,property){if(0===next.time-prev.time){key.value[property]=prev.value[property];return}key.value[property]=(key.time-prev.time)*(next.value[property]-prev.value[property])/(next.time-prev.time)+prev.value[property]}function buildAnimationClip(data){for(var tracks=[],name=data.name,duration=data.end-data.start||-1,animations=data.animations,i=0,il=animations.length,animationTracks;i<il;i++){animationTracks=getAnimation(animations[i]);for(var j=0,jl=animationTracks.length;j<jl;j++){tracks.push(animationTracks[j])}}return new THREE.AnimationClip(name,duration,tracks)}function getAnimationClip(id){return getBuild(library.clips[id],buildAnimationClip)}function parseSkin(xml){for(var data={sources:{}},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"bind_shape_matrix":data.bindShapeMatrix=parseFloats(child.textContent);break;case"source":var id=child.getAttribute("id");data.sources[id]=parseSource(child);break;case"joints":data.joints=parseJoints(child);break;case"vertex_weights":data.vertexWeights=parseVertexWeights(child);break;}}return data}function parseJoints(xml){for(var data={inputs:{}},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"input":var semantic=child.getAttribute("semantic"),id=parseId(child.getAttribute("source"));data.inputs[semantic]=id;break;}}return data}function parseVertexWeights(xml){for(var data={inputs:{}},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"input":var semantic=child.getAttribute("semantic"),id=parseId(child.getAttribute("source")),offset=parseInt(child.getAttribute("offset"));data.inputs[semantic]={id:id,offset:offset};break;case"vcount":data.vcount=parseInts(child.textContent);break;case"v":data.v=parseInts(child.textContent);break;}}return data}function buildController(data){var build={id:data.id},geometry=library.geometries[build.id];if(data.skin!==void 0){build.skin=buildSkin(data.skin);geometry.sources.skinIndices=build.skin.indices;geometry.sources.skinWeights=build.skin.weights}return build}function buildSkin(data){var BONE_LIMIT=4,build={joints:[],indices:{array:[],stride:BONE_LIMIT},weights:{array:[],stride:BONE_LIMIT}},sources=data.sources,vertexWeights=data.vertexWeights,vcount=vertexWeights.vcount,v=vertexWeights.v,jointOffset=vertexWeights.inputs.JOINT.offset,weightOffset=vertexWeights.inputs.WEIGHT.offset,jointSource=data.sources[data.joints.inputs.JOINT],inverseSource=data.sources[data.joints.inputs.INV_BIND_MATRIX],weights=sources[vertexWeights.inputs.WEIGHT.id].array,stride=0,i,j,l;for(i=0,l=vcount.length;i<l;i++){var jointCount=vcount[i],vertexSkinData=[];for(j=0;j<jointCount;j++){var skinIndex=v[stride+jointOffset],weightId=v[stride+weightOffset],skinWeight=weights[weightId];vertexSkinData.push({index:skinIndex,weight:skinWeight});stride+=2}vertexSkinData.sort(descending);for(j=0;j<BONE_LIMIT;j++){var d=vertexSkinData[j];if(d!==void 0){build.indices.array.push(d.index);build.weights.array.push(d.weight)}else{build.indices.array.push(0);build.weights.array.push(0)}}}build.bindMatrix=new THREE.Matrix4().fromArray(data.bindShapeMatrix).transpose();for(i=0,l=jointSource.array.length;i<l;i++){var name=jointSource.array[i],boneInverse=new THREE.Matrix4().fromArray(inverseSource.array,i*inverseSource.stride).transpose();build.joints.push({name:name,boneInverse:boneInverse})}return build;function descending(a,b){return b.weight-a.weight}}function getController(id){return getBuild(library.controllers[id],buildController)}function buildImage(data){if(data.build!==void 0)return data.build;return data.init_from}function getImage(id){return getBuild(library.images[id],buildImage)}function parseEffectProfileCOMMON(xml){for(var data={surfaces:{},samplers:{}},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"newparam":parseEffectNewparam(child,data);break;case"technique":data.technique=parseEffectTechnique(child);break;case"extra":data.extra=parseEffectExtra(child);break;}}return data}function parseEffectNewparam(xml,data){for(var sid=xml.getAttribute("sid"),i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"surface":data.surfaces[sid]=parseEffectSurface(child);break;case"sampler2D":data.samplers[sid]=parseEffectSampler(child);break;}}}function parseEffectSurface(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"init_from":data.init_from=child.textContent;break;}}return data}function parseEffectSampler(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"source":data.source=child.textContent;break;}}return data}function parseEffectTechnique(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"constant":case"lambert":case"blinn":case"phong":data.type=child.nodeName;data.parameters=parseEffectParameters(child);break;}}return data}function parseEffectParameters(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"emission":case"diffuse":case"specular":case"shininess":case"transparency":data[child.nodeName]=parseEffectParameter(child);break;case"transparent":data[child.nodeName]={opaque:child.getAttribute("opaque"),data:parseEffectParameter(child)};break;}}return data}function parseEffectParameter(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"color":data[child.nodeName]=parseFloats(child.textContent);break;case"float":data[child.nodeName]=parseFloat(child.textContent);break;case"texture":data[child.nodeName]={id:child.getAttribute("texture"),extra:parseEffectParameterTexture(child)};break;}}return data}function parseEffectParameterTexture(xml){for(var data={technique:{}},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"extra":parseEffectParameterTextureExtra(child,data);break;}}return data}function parseEffectParameterTextureExtra(xml,data){for(var i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"technique":parseEffectParameterTextureExtraTechnique(child,data);break;}}}function parseEffectParameterTextureExtraTechnique(xml,data){for(var i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"repeatU":case"repeatV":case"offsetU":case"offsetV":data.technique[child.nodeName]=parseFloat(child.textContent);break;case"wrapU":case"wrapV":if("TRUE"===child.textContent.toUpperCase()){data.technique[child.nodeName]=1}else if("FALSE"===child.textContent.toUpperCase()){data.technique[child.nodeName]=0}else{data.technique[child.nodeName]=parseInt(child.textContent)}break;}}}function parseEffectExtra(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"technique":data.technique=parseEffectExtraTechnique(child);break;}}return data}function parseEffectExtraTechnique(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"double_sided":data[child.nodeName]=parseInt(child.textContent);break;}}return data}function buildEffect(data){return data}function getEffect(id){return getBuild(library.effects[id],buildEffect)}function buildMaterial(data){var effect=getEffect(data.url),technique=effect.profile.technique,extra=effect.profile.extra,material;switch(technique.type){case"phong":case"blinn":material=new THREE.MeshPhongMaterial;break;case"lambert":material=new THREE.MeshLambertMaterial;break;default:material=new THREE.MeshBasicMaterial;break;}material.name=data.name;function getTexture(textureObject){var sampler=effect.profile.samplers[textureObject.id],image;if(sampler!==void 0){var surface=effect.profile.surfaces[sampler.source];image=getImage(surface.init_from)}else{console.warn("THREE.ColladaLoader: Undefined sampler. Access image directly (see #12530).");image=getImage(textureObject.id)}if(image!==void 0){var texture=textureLoader.load(image),extra=textureObject.extra;if(extra!==void 0&&extra.technique!==void 0&&!1===isEmpty(extra.technique)){var technique=extra.technique;texture.wrapS=technique.wrapU?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;texture.wrapT=technique.wrapV?THREE.RepeatWrapping:THREE.ClampToEdgeWrapping;texture.offset.set(technique.offsetU||0,technique.offsetV||0);texture.repeat.set(technique.repeatU||1,technique.repeatV||1)}else{texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping}return texture}else{console.error("THREE.ColladaLoader: Unable to load texture with ID:",textureObject.id);return null}}var parameters=technique.parameters;for(var key in parameters){var parameter=parameters[key];switch(key){case"diffuse":if(parameter.color)material.color.fromArray(parameter.color);if(parameter.texture)material.map=getTexture(parameter.texture);break;case"specular":if(parameter.color&&material.specular)material.specular.fromArray(parameter.color);if(parameter.texture)material.specularMap=getTexture(parameter.texture);break;case"shininess":if(parameter.float&&material.shininess)material.shininess=parameter.float;break;case"emission":if(parameter.color&&material.emissive)material.emissive.fromArray(parameter.color);break;}}var transparent=parameters.transparent,transparency=parameters.transparency;if(transparency===void 0&&transparent){transparency={float:1}}if(transparent===void 0&&transparency){transparent={opaque:"A_ONE",data:{color:[1,1,1,1]}}}if(transparent&&transparency){if(transparent.data.texture){material.alphaMap=getTexture(transparent.data.texture);material.transparent=!0}else{var color=transparent.data.color;switch(transparent.opaque){case"A_ONE":material.opacity=color[3]*transparency.float;break;case"RGB_ZERO":material.opacity=1-color[0]*transparency.float;break;case"A_ZERO":material.opacity=1-color[3]*transparency.float;break;case"RGB_ONE":material.opacity=color[0]*transparency.float;break;default:console.warn("THREE.ColladaLoader: Invalid opaque type \"%s\" of transparent tag.",transparent.opaque);}if(1>material.opacity)material.transparent=!0}}if(extra!==void 0&&extra.technique!==void 0&&1===extra.technique.double_sided){material.side=THREE.DoubleSide}return material}function getMaterial(id){return getBuild(library.materials[id],buildMaterial)}function parseCameraOptics(xml){for(var i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];switch(child.nodeName){case"technique_common":return parseCameraTechnique(child);}}return{}}function parseCameraTechnique(xml){for(var data={},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];switch(child.nodeName){case"perspective":case"orthographic":data.technique=child.nodeName;data.parameters=parseCameraParameters(child);break;}}return data}function parseCameraParameters(xml){for(var data={},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];switch(child.nodeName){case"xfov":case"yfov":case"xmag":case"ymag":case"znear":case"zfar":case"aspect_ratio":data[child.nodeName]=parseFloat(child.textContent);break;}}return data}function buildCamera(data){var camera;switch(data.optics.technique){case"perspective":camera=new THREE.PerspectiveCamera(data.optics.parameters.yfov,data.optics.parameters.aspect_ratio,data.optics.parameters.znear,data.optics.parameters.zfar);break;case"orthographic":var ymag=data.optics.parameters.ymag,xmag=data.optics.parameters.xmag,aspectRatio=data.optics.parameters.aspect_ratio;xmag=xmag===void 0?ymag*aspectRatio:xmag;ymag=ymag===void 0?xmag/aspectRatio:ymag;xmag*=.5;ymag*=.5;camera=new THREE.OrthographicCamera(-xmag,xmag,ymag,-ymag,data.optics.parameters.znear,data.optics.parameters.zfar);break;default:camera=new THREE.PerspectiveCamera;break;}camera.name=data.name;return camera}function getCamera(id){var data=library.cameras[id];if(data!==void 0){return getBuild(data,buildCamera)}console.warn("THREE.ColladaLoader: Couldn't find camera with ID:",id);return null}function parseLightTechnique(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"directional":case"point":case"spot":case"ambient":data.technique=child.nodeName;data.parameters=parseLightParameters(child);}}return data}function parseLightParameters(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"color":var array=parseFloats(child.textContent);data.color=new THREE.Color().fromArray(array);break;case"falloff_angle":data.falloffAngle=parseFloat(child.textContent);break;case"quadratic_attenuation":var f=parseFloat(child.textContent);data.distance=f?_Mathsqrt(1/f):0;break;}}return data}function buildLight(data){var light;switch(data.technique){case"directional":light=new THREE.DirectionalLight;break;case"point":light=new THREE.PointLight;break;case"spot":light=new THREE.SpotLight;break;case"ambient":light=new THREE.AmbientLight;break;}if(data.parameters.color)light.color.copy(data.parameters.color);if(data.parameters.distance)light.distance=data.parameters.distance;return light}function getLight(id){var data=library.lights[id];if(data!==void 0){return getBuild(data,buildLight)}console.warn("THREE.ColladaLoader: Couldn't find light with ID:",id);return null}function parseSource(xml){for(var data={array:[],stride:3},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"float_array":data.array=parseFloats(child.textContent);break;case"Name_array":data.array=parseStrings(child.textContent);break;case"technique_common":var accessor=getElementsByTagName(child,"accessor")[0];if(accessor!==void 0){data.stride=parseInt(accessor.getAttribute("stride"))}break;}}return data}function parseGeometryVertices(xml){for(var data={},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;data[child.getAttribute("semantic")]=parseId(child.getAttribute("source"))}return data}function parseGeometryPrimitive(xml){for(var primitive={type:xml.nodeName,material:xml.getAttribute("material"),count:parseInt(xml.getAttribute("count")),inputs:{},stride:0},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"input":var id=parseId(child.getAttribute("source")),semantic=child.getAttribute("semantic"),offset=parseInt(child.getAttribute("offset"));primitive.inputs[semantic]={id:id,offset:offset};primitive.stride=_Mathmax(primitive.stride,offset+1);break;case"vcount":primitive.vcount=parseInts(child.textContent);break;case"p":primitive.p=parseInts(child.textContent);break;}}return primitive}function groupPrimitives(primitives){for(var build={},i=0,primitive;i<primitives.length;i++){primitive=primitives[i];if(build[primitive.type]===void 0)build[primitive.type]=[];build[primitive.type].push(primitive)}return build}function buildGeometry(data){var build={},sources=data.sources,vertices=data.vertices,primitives=data.primitives;if(0===primitives.length)return{};var groupedPrimitives=groupPrimitives(primitives);for(var type in groupedPrimitives){build[type]=buildGeometryType(groupedPrimitives[type],sources,vertices)}return build}function buildGeometryType(primitives,sources,vertices){for(var build={},position={array:[],stride:0},normal={array:[],stride:0},uv={array:[],stride:0},color={array:[],stride:0},skinIndex={array:[],stride:4},skinWeight={array:[],stride:4},geometry=new THREE.BufferGeometry,materialKeys=[],start=0,count=0,p=0;p<primitives.length;p++){var primitive=primitives[p],inputs=primitive.inputs,triangleCount=1;if(primitive.vcount&&4===primitive.vcount[0]){triangleCount=2}if("lines"===primitive.type||"linestrips"===primitive.type){count=2*primitive.count}else{count=3*primitive.count*triangleCount}geometry.addGroup(start,count,p);start+=count;if(primitive.material){materialKeys.push(primitive.material)}for(var name in inputs){var input=inputs[name];switch(name){case"VERTEX":for(var key in vertices){var id=vertices[key];switch(key){case"POSITION":buildGeometryData(primitive,sources[id],input.offset,position.array);position.stride=sources[id].stride;if(sources.skinWeights&&sources.skinIndices){buildGeometryData(primitive,sources.skinIndices,input.offset,skinIndex.array);buildGeometryData(primitive,sources.skinWeights,input.offset,skinWeight.array)}break;case"NORMAL":buildGeometryData(primitive,sources[id],input.offset,normal.array);normal.stride=sources[id].stride;break;case"COLOR":buildGeometryData(primitive,sources[id],input.offset,color.array);color.stride=sources[id].stride;break;case"TEXCOORD":buildGeometryData(primitive,sources[id],input.offset,uv.array);uv.stride=sources[id].stride;break;default:console.warn("THREE.ColladaLoader: Semantic \"%s\" not handled in geometry build process.",key);}}break;case"NORMAL":buildGeometryData(primitive,sources[input.id],input.offset,normal.array);normal.stride=sources[input.id].stride;break;case"COLOR":buildGeometryData(primitive,sources[input.id],input.offset,color.array);color.stride=sources[input.id].stride;break;case"TEXCOORD":buildGeometryData(primitive,sources[input.id],input.offset,uv.array);uv.stride=sources[input.id].stride;break;}}}if(0<position.array.length)geometry.addAttribute("position",new THREE.Float32BufferAttribute(position.array,position.stride));if(0<normal.array.length)geometry.addAttribute("normal",new THREE.Float32BufferAttribute(normal.array,normal.stride));if(0<color.array.length)geometry.addAttribute("color",new THREE.Float32BufferAttribute(color.array,color.stride));if(0<uv.array.length)geometry.addAttribute("uv",new THREE.Float32BufferAttribute(uv.array,uv.stride));if(0<skinIndex.array.length)geometry.addAttribute("skinIndex",new THREE.Float32BufferAttribute(skinIndex.array,skinIndex.stride));if(0<skinWeight.array.length)geometry.addAttribute("skinWeight",new THREE.Float32BufferAttribute(skinWeight.array,skinWeight.stride));build.data=geometry;build.type=primitives[0].type;build.materialKeys=materialKeys;return build}function buildGeometryData(primitive,source,offset,array){var indices=primitive.p,stride=primitive.stride,vcount=primitive.vcount;function pushVector(i){var index=indices[i+offset]*sourceStride,length=index+sourceStride;for(;index<length;index++){array.push(sourceArray[index])}}var maxcount=0,sourceArray=source.array,sourceStride=source.stride;if(primitive.vcount!==void 0){for(var index=0,i=0,l=vcount.length,count;i<l;i++){count=vcount[i];if(4===count){var a=index+0*stride,b=index+1*stride,c=index+2*stride,d=index+3*stride;pushVector(a);pushVector(b);pushVector(d);pushVector(b);pushVector(c);pushVector(d)}else if(3===count){var a=index+0*stride,b=index+1*stride,c=index+2*stride;pushVector(a);pushVector(b);pushVector(c)}else{maxcount=_Mathmax(maxcount,count)}index+=stride*count}if(0<maxcount){console.log("THREE.ColladaLoader: Geometry has faces with more than 4 vertices.")}}else{for(var i=0,l=indices.length;i<l;i+=stride){pushVector(i)}}}function getGeometry(id){return getBuild(library.geometries[id],buildGeometry)}function buildKinematicsModel(data){if(data.build!==void 0)return data.build;return data}function getKinematicsModel(id){return getBuild(library.kinematicsModels[id],buildKinematicsModel)}function parseKinematicsTechniqueCommon(xml,data){for(var i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"joint":data.joints[child.getAttribute("sid")]=parseKinematicsJoint(child);break;case"link":data.links.push(parseKinematicsLink(child));break;}}}function parseKinematicsJoint(xml){for(var data,i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"prismatic":case"revolute":data=parseKinematicsJointParameter(child);break;}}return data}function parseKinematicsJointParameter(xml,data){for(var data={sid:xml.getAttribute("sid"),name:xml.getAttribute("name")||"",axis:new THREE.Vector3,limits:{min:0,max:0},type:xml.nodeName,static:!1,zeroPosition:0,middlePosition:0},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"axis":var array=parseFloats(child.textContent);data.axis.fromArray(array);break;case"limits":var max=child.getElementsByTagName("max")[0],min=child.getElementsByTagName("min")[0];data.limits.max=parseFloat(max.textContent);data.limits.min=parseFloat(min.textContent);break;}}if(data.limits.min>=data.limits.max){data.static=!0}data.middlePosition=(data.limits.min+data.limits.max)/2;return data}function parseKinematicsLink(xml){for(var data={sid:xml.getAttribute("sid"),name:xml.getAttribute("name")||"",attachments:[],transforms:[]},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"attachment_full":data.attachments.push(parseKinematicsAttachment(child));break;case"matrix":case"translate":case"rotate":data.transforms.push(parseKinematicsTransform(child));break;}}return data}function parseKinematicsAttachment(xml){for(var data={joint:xml.getAttribute("joint").split("/").pop(),transforms:[],links:[]},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"link":data.links.push(parseKinematicsLink(child));break;case"matrix":case"translate":case"rotate":data.transforms.push(parseKinematicsTransform(child));break;}}return data}function parseKinematicsTransform(xml){var data={type:xml.nodeName},array=parseFloats(xml.textContent);switch(data.type){case"matrix":data.obj=new THREE.Matrix4;data.obj.fromArray(array).transpose();break;case"translate":data.obj=new THREE.Vector3;data.obj.fromArray(array);break;case"rotate":data.obj=new THREE.Vector3;data.obj.fromArray(array);data.angle=THREE.Math.degToRad(array[3]);break;}return data}function parseKinematicsBindJointAxis(xml){for(var data={target:xml.getAttribute("target").split("/").pop()},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"axis":var param=child.getElementsByTagName("param")[0];data.axis=param.textContent;var tmpJointIndex=data.axis.split("inst_").pop().split("axis")[0];data.jointIndex=tmpJointIndex.substr(0,tmpJointIndex.length-1);break;}}return data}function buildKinematicsScene(data){if(data.build!==void 0)return data.build;return data}function getKinematicsScene(id){return getBuild(library.kinematicsScenes[id],buildKinematicsScene)}function buildTransformList(node){for(var transforms=[],xml=collada.querySelector("[id=\""+node.id+"\"]"),i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"matrix":var array=parseFloats(child.textContent),matrix=new THREE.Matrix4().fromArray(array).transpose();transforms.push({sid:child.getAttribute("sid"),type:child.nodeName,obj:matrix});break;case"translate":case"scale":var array=parseFloats(child.textContent),vector=new THREE.Vector3().fromArray(array);transforms.push({sid:child.getAttribute("sid"),type:child.nodeName,obj:vector});break;case"rotate":var array=parseFloats(child.textContent),vector=new THREE.Vector3().fromArray(array),angle=THREE.Math.degToRad(array[3]);transforms.push({sid:child.getAttribute("sid"),type:child.nodeName,obj:vector,angle:angle});break;}}return transforms}function prepareNodes(xml){for(var elements=xml.getElementsByTagName("node"),i=0,element;i<elements.length;i++){element=elements[i];if(!1===element.hasAttribute("id")){element.setAttribute("id",generateId())}}}var matrix=new THREE.Matrix4,vector=new THREE.Vector3;function parseNode(xml){for(var data={name:xml.getAttribute("name")||"",type:xml.getAttribute("type"),id:xml.getAttribute("id"),sid:xml.getAttribute("sid"),matrix:new THREE.Matrix4,nodes:[],instanceCameras:[],instanceControllers:[],instanceLights:[],instanceGeometries:[],instanceNodes:[],transforms:{}},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"node":data.nodes.push(child.getAttribute("id"));parseNode(child);break;case"instance_camera":data.instanceCameras.push(parseId(child.getAttribute("url")));break;case"instance_controller":data.instanceControllers.push(parseNodeInstance(child));break;case"instance_light":data.instanceLights.push(parseId(child.getAttribute("url")));break;case"instance_geometry":data.instanceGeometries.push(parseNodeInstance(child));break;case"instance_node":data.instanceNodes.push(parseId(child.getAttribute("url")));break;case"matrix":var array=parseFloats(child.textContent);data.matrix.multiply(matrix.fromArray(array).transpose());data.transforms[child.getAttribute("sid")]=child.nodeName;break;case"translate":var array=parseFloats(child.textContent);vector.fromArray(array);data.matrix.multiply(matrix.makeTranslation(vector.x,vector.y,vector.z));data.transforms[child.getAttribute("sid")]=child.nodeName;break;case"rotate":var array=parseFloats(child.textContent),angle=THREE.Math.degToRad(array[3]);data.matrix.multiply(matrix.makeRotationAxis(vector.fromArray(array),angle));data.transforms[child.getAttribute("sid")]=child.nodeName;break;case"scale":var array=parseFloats(child.textContent);data.matrix.scale(vector.fromArray(array));data.transforms[child.getAttribute("sid")]=child.nodeName;break;case"extra":break;default:console.log(child);}}library.nodes[data.id]=data;return data}function parseNodeInstance(xml){for(var data={id:parseId(xml.getAttribute("url")),materials:{},skeletons:[]},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];switch(child.nodeName){case"bind_material":for(var instances=child.getElementsByTagName("instance_material"),j=0;j<instances.length;j++){var instance=instances[j],symbol=instance.getAttribute("symbol"),target=instance.getAttribute("target");data.materials[symbol]=parseId(target)}break;case"skeleton":data.skeletons.push(parseId(child.textContent));break;default:break;}}return data}function buildSkeleton(skeletons,joints){var boneData=[],sortedBoneData=[],i,j,data;for(i=0;i<skeletons.length;i++){var skeleton=skeletons[i],root=getNode(skeleton);buildBoneHierarchy(root,joints,boneData)}for(i=0;i<joints.length;i++){for(j=0;j<boneData.length;j++){data=boneData[j];if(data.bone.name===joints[i].name){sortedBoneData[i]=data;data.processed=!0;break}}}for(i=0;i<boneData.length;i++){data=boneData[i];if(!1===data.processed){sortedBoneData.push(data);data.processed=!0}}var bones=[],boneInverses=[];for(i=0;i<sortedBoneData.length;i++){data=sortedBoneData[i];bones.push(data.bone);boneInverses.push(data.boneInverse)}return new THREE.Skeleton(bones,boneInverses)}function buildBoneHierarchy(root,joints,boneData){root.traverse(function(object){if(!0===object.isBone){for(var boneInverse,i=0,joint;i<joints.length;i++){joint=joints[i];if(joint.name===object.name){boneInverse=joint.boneInverse;break}}if(boneInverse===void 0){boneInverse=new THREE.Matrix4}boneData.push({bone:object,boneInverse:boneInverse,processed:!1})}})}function buildNode(data){for(var objects=[],matrix=data.matrix,nodes=data.nodes,type=data.type,instanceCameras=data.instanceCameras,instanceControllers=data.instanceControllers,instanceLights=data.instanceLights,instanceGeometries=data.instanceGeometries,instanceNodes=data.instanceNodes,i=0,l=nodes.length;i<l;i++){objects.push(getNode(nodes[i]))}for(var i=0,l=instanceCameras.length,instanceCamera;i<l;i++){instanceCamera=getCamera(instanceCameras[i]);if(null!==instanceCamera){objects.push(instanceCamera.clone())}}for(var i=0,l=instanceControllers.length;i<l;i++){for(var instance=instanceControllers[i],controller=getController(instance.id),geometries=getGeometry(controller.id),newObjects=buildObjects(geometries,instance.materials),skeletons=instance.skeletons,joints=controller.skin.joints,skeleton=buildSkeleton(skeletons,joints),j=0,jl=newObjects.length,object;j<jl;j++){object=newObjects[j];if(object.isSkinnedMesh){object.bind(skeleton,controller.skin.bindMatrix);object.normalizeSkinWeights()}objects.push(object)}}for(var i=0,l=instanceLights.length,instanceLight;i<l;i++){instanceLight=getLight(instanceLights[i]);if(null!==instanceLight){objects.push(instanceLight.clone())}}for(var i=0,l=instanceGeometries.length;i<l;i++){for(var instance=instanceGeometries[i],geometries=getGeometry(instance.id),newObjects=buildObjects(geometries,instance.materials),j=0,jl=newObjects.length;j<jl;j++){objects.push(newObjects[j])}}for(var i=0,l=instanceNodes.length;i<l;i++){objects.push(getNode(instanceNodes[i]).clone())}var object;if(0===nodes.length&&1===objects.length){object=objects[0]}else{object="JOINT"===type?new THREE.Bone:new THREE.Group;for(var i=0;i<objects.length;i++){object.add(objects[i])}}object.name="JOINT"===type?data.sid:data.name;object.matrix.copy(matrix);object.matrix.decompose(object.position,object.quaternion,object.scale);return object}function resolveMaterialBinding(keys,instanceMaterials){for(var materials=[],i=0,l=keys.length,id;i<l;i++){id=instanceMaterials[keys[i]];materials.push(getMaterial(id))}return materials}function buildObjects(geometries,instanceMaterials){var objects=[];for(var type in geometries){var geometry=geometries[type],materials=resolveMaterialBinding(geometry.materialKeys,instanceMaterials);if(0===materials.length){if("lines"===type||"linestrips"===type){materials.push(new THREE.LineBasicMaterial)}else{materials.push(new THREE.MeshPhongMaterial)}}var skinning=geometry.data.attributes.skinIndex!==void 0;if(skinning){for(var i=0,l=materials.length;i<l;i++){materials[i].skinning=!0}}var material=1===materials.length?materials[0]:materials,object;switch(type){case"lines":object=new THREE.LineSegments(geometry.data,material);break;case"linestrips":object=new THREE.Line(geometry.data,material);break;case"triangles":case"polylist":if(skinning){object=new THREE.SkinnedMesh(geometry.data,material)}else{object=new THREE.Mesh(geometry.data,material)}break;}objects.push(object)}return objects}function getNode(id){return getBuild(library.nodes[id],buildNode)}function buildVisualScene(data){var group=new THREE.Group;group.name=data.name;for(var children=data.children,i=0,child;i<children.length;i++){child=children[i];if(null===child.id){group.add(buildNode(child))}else{group.add(getNode(child.id))}}return group}function getVisualScene(id){return getBuild(library.visualScenes[id],buildVisualScene)}console.time("THREE.ColladaLoader");if(0===text.length){return{scene:new THREE.Scene}}console.time("THREE.ColladaLoader: DOMParser");var xml=new DOMParser().parseFromString(text,"application/xml");console.timeEnd("THREE.ColladaLoader: DOMParser");var collada=getElementsByTagName(xml,"COLLADA")[0],version=collada.getAttribute("version");console.log("THREE.ColladaLoader: File version",version);var asset=function(xml){return{unit:parseAssetUnit(getElementsByTagName(xml,"unit")[0]),upAxis:parseAssetUpAxis(getElementsByTagName(xml,"up_axis")[0])}}(getElementsByTagName(collada,"asset")[0]),textureLoader=new THREE.TextureLoader(this.manager);textureLoader.setPath(path).setCrossOrigin(this.crossOrigin);var animations=[],kinematics={},count=0,library={animations:{},clips:{},controllers:{},images:{},effects:{},materials:{},cameras:{},lights:{},geometries:{},nodes:{},visualScenes:{},kinematicsModels:{},kinematicsScenes:{}};console.time("THREE.ColladaLoader: Parse");parseLibrary(collada,"library_animations","animation",function(xml){for(var data={sources:{},samplers:{},channels:{}},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;var id;switch(child.nodeName){case"source":id=child.getAttribute("id");data.sources[id]=parseSource(child);break;case"sampler":id=child.getAttribute("id");data.samplers[id]=parseAnimationSampler(child);break;case"channel":id=child.getAttribute("target");data.channels[id]=parseAnimationChannel(child);break;default:console.log(child);}}library.animations[xml.getAttribute("id")]=data});parseLibrary(collada,"library_animation_clips","animation_clip",function(xml){for(var data={name:xml.getAttribute("id")||"default",start:parseFloat(xml.getAttribute("start")||0),end:parseFloat(xml.getAttribute("end")||0),animations:[]},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"instance_animation":data.animations.push(parseId(child.getAttribute("url")));break;}}library.clips[xml.getAttribute("id")]=data});parseLibrary(collada,"library_controllers","controller",function(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"skin":data.id=parseId(child.getAttribute("source"));data.skin=parseSkin(child);break;case"morph":data.id=parseId(child.getAttribute("source"));console.warn("THREE.ColladaLoader: Morph target animation not supported yet.");break;}}library.controllers[xml.getAttribute("id")]=data});parseLibrary(collada,"library_images","image",function(xml){var data={init_from:getElementsByTagName(xml,"init_from")[0].textContent};library.images[xml.getAttribute("id")]=data});parseLibrary(collada,"library_effects","effect",function(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"profile_COMMON":data.profile=parseEffectProfileCOMMON(child);break;}}library.effects[xml.getAttribute("id")]=data});parseLibrary(collada,"library_materials","material",function(xml){for(var data={name:xml.getAttribute("name")},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"instance_effect":data.url=parseId(child.getAttribute("url"));break;}}library.materials[xml.getAttribute("id")]=data});parseLibrary(collada,"library_cameras","camera",function(xml){for(var data={name:xml.getAttribute("name")},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"optics":data.optics=parseCameraOptics(child);break;}}library.cameras[xml.getAttribute("id")]=data});parseLibrary(collada,"library_lights","light",function(xml){for(var data={},i=0,l=xml.childNodes.length,child;i<l;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"technique_common":data=parseLightTechnique(child);break;}}library.lights[xml.getAttribute("id")]=data});parseLibrary(collada,"library_geometries","geometry",function(xml){var data={name:xml.getAttribute("name"),sources:{},vertices:{},primitives:[]},mesh=getElementsByTagName(xml,"mesh")[0];if(mesh===void 0)return;for(var i=0,child;i<mesh.childNodes.length;i++){child=mesh.childNodes[i];if(1!==child.nodeType)continue;var id=child.getAttribute("id");switch(child.nodeName){case"source":data.sources[id]=parseSource(child);break;case"vertices":data.vertices=parseGeometryVertices(child);break;case"polygons":console.warn("THREE.ColladaLoader: Unsupported primitive type: ",child.nodeName);break;case"lines":case"linestrips":case"polylist":case"triangles":data.primitives.push(parseGeometryPrimitive(child));break;default:console.log(child);}}library.geometries[xml.getAttribute("id")]=data});parseLibrary(collada,"library_nodes","node",parseNode);parseLibrary(collada,"library_visual_scenes","visual_scene",function(xml){var data={name:xml.getAttribute("name"),children:[]};prepareNodes(xml);for(var elements=getElementsByTagName(xml,"node"),i=0;i<elements.length;i++){data.children.push(parseNode(elements[i]))}library.visualScenes[xml.getAttribute("id")]=data});parseLibrary(collada,"library_kinematics_models","kinematics_model",function(xml){for(var data={name:xml.getAttribute("name")||"",joints:{},links:[]},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"technique_common":parseKinematicsTechniqueCommon(child,data);break;}}library.kinematicsModels[xml.getAttribute("id")]=data});parseLibrary(collada,"scene","instance_kinematics_scene",function(xml){for(var data={bindJointAxis:[]},i=0,child;i<xml.childNodes.length;i++){child=xml.childNodes[i];if(1!==child.nodeType)continue;switch(child.nodeName){case"bind_joint_axis":data.bindJointAxis.push(parseKinematicsBindJointAxis(child));break;}}library.kinematicsScenes[parseId(xml.getAttribute("url"))]=data});console.timeEnd("THREE.ColladaLoader: Parse");console.time("THREE.ColladaLoader: Build");buildLibrary(library.animations,buildAnimation);buildLibrary(library.clips,buildAnimationClip);buildLibrary(library.controllers,buildController);buildLibrary(library.images,buildImage);buildLibrary(library.effects,buildEffect);buildLibrary(library.materials,buildMaterial);buildLibrary(library.cameras,buildCamera);buildLibrary(library.lights,buildLight);buildLibrary(library.geometries,buildGeometry);buildLibrary(library.visualScenes,buildVisualScene);console.timeEnd("THREE.ColladaLoader: Build");(function(){var clips=library.clips;if(!0===isEmpty(clips)){if(!1===isEmpty(library.animations)){var tracks=[];for(var id in library.animations){for(var animationTracks=getAnimation(id),i=0,l=animationTracks.length;i<l;i++){tracks.push(animationTracks[i])}}animations.push(new THREE.AnimationClip("default",-1,tracks))}}else{for(var id in clips){animations.push(getAnimationClip(id))}}})();(function(){var kinematicsModelId=Object.keys(library.kinematicsModels)[0],kinematicsSceneId=Object.keys(library.kinematicsScenes)[0],visualSceneId=Object.keys(library.visualScenes)[0];if(kinematicsModelId===void 0||kinematicsSceneId===void 0)return;for(var kinematicsModel=getKinematicsModel(kinematicsModelId),kinematicsScene=getKinematicsScene(kinematicsSceneId),visualScene=getVisualScene(visualSceneId),bindJointAxis=kinematicsScene.bindJointAxis,jointMap={},i=0,l=bindJointAxis.length;i<l;i++){var axis=bindJointAxis[i],targetElement=collada.querySelector("[sid=\""+axis.target+"\"]");if(targetElement){var parentVisualElement=targetElement.parentElement;connect(axis.jointIndex,parentVisualElement)}}function connect(jointIndex,visualElement){var visualElementName=visualElement.getAttribute("name"),joint=kinematicsModel.joints[jointIndex];visualScene.traverse(function(object){if(object.name===visualElementName){jointMap[jointIndex]={object:object,transforms:buildTransformList(visualElement),joint:joint,position:joint.zeroPosition}}})}var m0=new THREE.Matrix4;kinematics={joints:kinematicsModel&&kinematicsModel.joints,getJointValue:function getJointValue(jointIndex){var jointData=jointMap[jointIndex];if(jointData){return jointData.position}else{console.warn("THREE.ColladaLoader: Joint "+jointIndex+" doesn't exist.")}},setJointValue:function setJointValue(jointIndex,value){var jointData=jointMap[jointIndex];if(jointData){var joint=jointData.joint;if(value>joint.limits.max||value<joint.limits.min){console.warn("THREE.ColladaLoader: Joint "+jointIndex+" value "+value+" outside of limits (min: "+joint.limits.min+", max: "+joint.limits.max+").")}else if(joint.static){console.warn("THREE.ColladaLoader: Joint "+jointIndex+" is static.")}else{var object=jointData.object,axis=joint.axis,transforms=jointData.transforms;matrix.identity();for(var i=0,transform;i<transforms.length;i++){transform=transforms[i];if(transform.sid&&-1!==transform.sid.indexOf(jointIndex)){switch(joint.type){case"revolute":matrix.multiply(m0.makeRotationAxis(axis,THREE.Math.degToRad(value)));break;case"prismatic":matrix.multiply(m0.makeTranslation(axis.x*value,axis.y*value,axis.z*value));break;default:console.warn("THREE.ColladaLoader: Unknown joint type: "+joint.type);break;}}else{switch(transform.type){case"matrix":matrix.multiply(transform.obj);break;case"translate":matrix.multiply(m0.makeTranslation(transform.obj.x,transform.obj.y,transform.obj.z));break;case"scale":matrix.scale(transform.obj);break;case"rotate":matrix.multiply(m0.makeRotationAxis(transform.obj,transform.angle));break;}}}object.matrix.copy(matrix);object.matrix.decompose(object.position,object.quaternion,object.scale);jointMap[jointIndex].position=value}}else{console.log("THREE.ColladaLoader: "+jointIndex+" does not exist.")}}}})();var scene=function(xml){var instance=getElementsByTagName(xml,"instance_visual_scene")[0];return getVisualScene(parseId(instance.getAttribute("url")))}(getElementsByTagName(collada,"scene")[0]);if("Z_UP"===asset.upAxis){scene.rotation.x=-_MathPI/2}scene.scale.multiplyScalar(asset.unit);console.timeEnd("THREE.ColladaLoader");return{animations:animations,kinematics:kinematics,library:library,scene:scene}}}},{}],42:[function(){THREE.GLTFLoader=function(){function GLTFLoader(manager){this.manager=manager!==void 0?manager:THREE.DefaultLoadingManager}GLTFLoader.prototype={constructor:GLTFLoader,crossOrigin:"Anonymous",load:function load(url,onLoad,onProgress,onError){var scope=this,path=this.path!==void 0?this.path:THREE.LoaderUtils.extractUrlBase(url),loader=new THREE.FileLoader(scope.manager);loader.setResponseType("arraybuffer");loader.load(url,function(data){try{scope.parse(data,path,onLoad,onError)}catch(e){if(onError!==void 0){onError(e)}else{throw e}}},onProgress,onError)},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value;return this},setPath:function setPath(value){this.path=value;return this},parse:function parse(data,path,onLoad,onError){var content,extensions={};if("string"===typeof data){content=data}else{var magic=THREE.LoaderUtils.decodeText(new Uint8Array(data,0,4));if(magic===BINARY_EXTENSION_HEADER_MAGIC){try{extensions[EXTENSIONS.KHR_BINARY_GLTF]=new GLTFBinaryExtension(data)}catch(error){if(onError)onError(error);return}content=extensions[EXTENSIONS.KHR_BINARY_GLTF].content}else{content=THREE.LoaderUtils.decodeText(new Uint8Array(data))}}var json=JSON.parse(content);if(json.asset===void 0||2>json.asset.version[0]){if(onError)onError(new Error("THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported. Use LegacyGLTFLoader instead."));return}if(json.extensionsUsed){if(0<=json.extensionsUsed.indexOf(EXTENSIONS.KHR_LIGHTS)){extensions[EXTENSIONS.KHR_LIGHTS]=new GLTFLightsExtension(json)}if(0<=json.extensionsUsed.indexOf(EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS)){extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]=new GLTFMaterialsPbrSpecularGlossinessExtension}}console.time("GLTFLoader");var parser=new GLTFParser(json,extensions,{path:path||this.path||"",crossOrigin:this.crossOrigin,manager:this.manager});parser.parse(function(scene,scenes,cameras,animations,asset){console.timeEnd("GLTFLoader");onLoad({scene:scene,scenes:scenes,cameras:cameras,animations:animations,asset:asset})},onError)}};function GLTFRegistry(){var objects={};return{get:function get(key){return objects[key]},add:function add(key,object){objects[key]=object},remove:function remove(key){delete objects[key]},removeAll:function removeAll(){objects={}}}}var EXTENSIONS={KHR_BINARY_GLTF:"KHR_binary_glTF",KHR_LIGHTS:"KHR_lights",KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS:"KHR_materials_pbrSpecularGlossiness"};function GLTFLightsExtension(json){this.name=EXTENSIONS.KHR_LIGHTS;this.lights={};var extension=json.extensions&&json.extensions[EXTENSIONS.KHR_LIGHTS]||{},lights=extension.lights||{};for(var lightId in lights){var light=lights[lightId],lightNode,color=new THREE.Color().fromArray(light.color);switch(light.type){case"directional":lightNode=new THREE.DirectionalLight(color);lightNode.position.set(0,0,1);break;case"point":lightNode=new THREE.PointLight(color);break;case"spot":lightNode=new THREE.SpotLight(color);lightNode.position.set(0,0,1);break;case"ambient":lightNode=new THREE.AmbientLight(color);break;}if(lightNode){if(light.constantAttenuation!==void 0){lightNode.intensity=light.constantAttenuation}if(light.linearAttenuation!==void 0){lightNode.distance=1/light.linearAttenuation}if(light.quadraticAttenuation!==void 0){lightNode.decay=light.quadraticAttenuation}if(light.fallOffAngle!==void 0){lightNode.angle=light.fallOffAngle}if(light.fallOffExponent!==void 0){console.warn("THREE.GLTFLoader:: light.fallOffExponent not currently supported.")}lightNode.name=light.name||"light_"+lightId;this.lights[lightId]=lightNode}}}var BINARY_EXTENSION_HEADER_MAGIC="glTF",BINARY_EXTENSION_HEADER_LENGTH=12,BINARY_EXTENSION_CHUNK_TYPES={JSON:1313821514,BIN:5130562};function GLTFBinaryExtension(data){this.name=EXTENSIONS.KHR_BINARY_GLTF;this.content=null;this.body=null;var headerView=new DataView(data,0,BINARY_EXTENSION_HEADER_LENGTH);this.header={magic:THREE.LoaderUtils.decodeText(new Uint8Array(data.slice(0,4))),version:headerView.getUint32(4,!0),length:headerView.getUint32(8,!0)};if(this.header.magic!==BINARY_EXTENSION_HEADER_MAGIC){throw new Error("THREE.GLTFLoader: Unsupported glTF-Binary header.")}else if(2>this.header.version){throw new Error("THREE.GLTFLoader: Legacy binary file detected. Use LegacyGLTFLoader instead.")}var chunkView=new DataView(data,BINARY_EXTENSION_HEADER_LENGTH),chunkIndex=0;while(chunkIndex<chunkView.byteLength){var chunkLength=chunkView.getUint32(chunkIndex,!0);chunkIndex+=4;var chunkType=chunkView.getUint32(chunkIndex,!0);chunkIndex+=4;if(chunkType===BINARY_EXTENSION_CHUNK_TYPES.JSON){var contentArray=new Uint8Array(data,BINARY_EXTENSION_HEADER_LENGTH+chunkIndex,chunkLength);this.content=THREE.LoaderUtils.decodeText(contentArray)}else if(chunkType===BINARY_EXTENSION_CHUNK_TYPES.BIN){var byteOffset=BINARY_EXTENSION_HEADER_LENGTH+chunkIndex;this.body=data.slice(byteOffset,byteOffset+chunkLength)}chunkIndex+=chunkLength}if(null===this.content){throw new Error("THREE.GLTFLoader: JSON content not found.")}}function GLTFMaterialsPbrSpecularGlossinessExtension(){return{name:EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS,specularGlossinessParams:["color","map","lightMap","lightMapIntensity","aoMap","aoMapIntensity","emissive","emissiveIntensity","emissiveMap","bumpMap","bumpScale","normalMap","displacementMap","displacementScale","displacementBias","specularMap","specular","glossinessMap","glossiness","alphaMap","envMap","envMapIntensity","refractionRatio"],getMaterialType:function getMaterialType(){return THREE.ShaderMaterial},extendParams:function extendParams(params,material,parser){var pbrSpecularGlossiness=material.extensions[this.name],shader=THREE.ShaderLib.standard,uniforms=THREE.UniformsUtils.clone(shader.uniforms),specularMapParsFragmentChunk=["#ifdef USE_SPECULARMAP","\tuniform sampler2D specularMap;","#endif"].join("\n"),glossinessMapParsFragmentChunk=["#ifdef USE_GLOSSINESSMAP","\tuniform sampler2D glossinessMap;","#endif"].join("\n"),specularMapFragmentChunk=["vec3 specularFactor = specular;","#ifdef USE_SPECULARMAP","\tvec4 texelSpecular = texture2D( specularMap, vUv );","\ttexelSpecular = sRGBToLinear( texelSpecular );","\t// reads channel RGB, compatible with a glTF Specular-Glossiness (RGBA) texture","\tspecularFactor *= texelSpecular.rgb;","#endif"].join("\n"),glossinessMapFragmentChunk=["float glossinessFactor = glossiness;","#ifdef USE_GLOSSINESSMAP","\tvec4 texelGlossiness = texture2D( glossinessMap, vUv );","\t// reads channel A, compatible with a glTF Specular-Glossiness (RGBA) texture","\tglossinessFactor *= texelGlossiness.a;","#endif"].join("\n"),lightPhysicalFragmentChunk=["PhysicalMaterial material;","material.diffuseColor = diffuseColor.rgb;","material.specularRoughness = clamp( 1.0 - glossinessFactor, 0.04, 1.0 );","material.specularColor = specularFactor.rgb;"].join("\n"),fragmentShader=shader.fragmentShader.replace("#include <specularmap_fragment>","").replace("uniform float roughness;","uniform vec3 specular;").replace("uniform float metalness;","uniform float glossiness;").replace("#include <roughnessmap_pars_fragment>",specularMapParsFragmentChunk).replace("#include <metalnessmap_pars_fragment>",glossinessMapParsFragmentChunk).replace("#include <roughnessmap_fragment>",specularMapFragmentChunk).replace("#include <metalnessmap_fragment>",glossinessMapFragmentChunk).replace("#include <lights_physical_fragment>",lightPhysicalFragmentChunk);delete uniforms.roughness;delete uniforms.metalness;delete uniforms.roughnessMap;delete uniforms.metalnessMap;uniforms.specular={value:new THREE.Color().setHex(1118481)};uniforms.glossiness={value:.5};uniforms.specularMap={value:null};uniforms.glossinessMap={value:null};params.vertexShader=shader.vertexShader;params.fragmentShader=fragmentShader;params.uniforms=uniforms;params.defines={STANDARD:""};params.color=new THREE.Color(1,1,1);params.opacity=1;var pending=[];if(Array.isArray(pbrSpecularGlossiness.diffuseFactor)){var array=pbrSpecularGlossiness.diffuseFactor;params.color.fromArray(array);params.opacity=array[3]}if(pbrSpecularGlossiness.diffuseTexture!==void 0){pending.push(parser.assignTexture(params,"map",pbrSpecularGlossiness.diffuseTexture.index))}params.emissive=new THREE.Color(0,0,0);params.glossiness=pbrSpecularGlossiness.glossinessFactor!==void 0?pbrSpecularGlossiness.glossinessFactor:1;params.specular=new THREE.Color(1,1,1);if(Array.isArray(pbrSpecularGlossiness.specularFactor)){params.specular.fromArray(pbrSpecularGlossiness.specularFactor)}if(pbrSpecularGlossiness.specularGlossinessTexture!==void 0){var specGlossIndex=pbrSpecularGlossiness.specularGlossinessTexture.index;pending.push(parser.assignTexture(params,"glossinessMap",specGlossIndex));pending.push(parser.assignTexture(params,"specularMap",specGlossIndex))}return Promise.all(pending)},createMaterial:function createMaterial(params){var material=new THREE.ShaderMaterial({defines:params.defines,vertexShader:params.vertexShader,fragmentShader:params.fragmentShader,uniforms:params.uniforms,fog:!0,lights:!0,opacity:params.opacity,transparent:params.transparent});material.isGLTFSpecularGlossinessMaterial=!0;material.color=params.color;material.map=params.map===void 0?null:params.map;material.lightMap=null;material.lightMapIntensity=1;material.aoMap=params.aoMap===void 0?null:params.aoMap;material.aoMapIntensity=1;material.emissive=params.emissive;material.emissiveIntensity=1;material.emissiveMap=params.emissiveMap===void 0?null:params.emissiveMap;material.bumpMap=params.bumpMap===void 0?null:params.bumpMap;material.bumpScale=1;material.normalMap=params.normalMap===void 0?null:params.normalMap;if(params.normalScale)material.normalScale=params.normalScale;material.displacementMap=null;material.displacementScale=1;material.displacementBias=0;material.specularMap=params.specularMap===void 0?null:params.specularMap;material.specular=params.specular;material.glossinessMap=params.glossinessMap===void 0?null:params.glossinessMap;material.glossiness=params.glossiness;material.alphaMap=null;material.envMap=params.envMap===void 0?null:params.envMap;material.envMapIntensity=1;material.refractionRatio=.98;material.extensions.derivatives=!0;return material},cloneMaterial:function cloneMaterial(source){var target=source.clone();target.isGLTFSpecularGlossinessMaterial=!0;for(var params=this.specularGlossinessParams,i=0,il=params.length;i<il;i++){target[params[i]]=source[params[i]]}return target},refreshUniforms:function refreshUniforms(renderer,scene,camera,geometry,material){if(!0!==material.isGLTFSpecularGlossinessMaterial){return}var uniforms=material.uniforms,defines=material.defines;uniforms.opacity.value=material.opacity;uniforms.diffuse.value.copy(material.color);uniforms.emissive.value.copy(material.emissive).multiplyScalar(material.emissiveIntensity);uniforms.map.value=material.map;uniforms.specularMap.value=material.specularMap;uniforms.alphaMap.value=material.alphaMap;uniforms.lightMap.value=material.lightMap;uniforms.lightMapIntensity.value=material.lightMapIntensity;uniforms.aoMap.value=material.aoMap;uniforms.aoMapIntensity.value=material.aoMapIntensity;var uvScaleMap;if(material.map){uvScaleMap=material.map}else if(material.specularMap){uvScaleMap=material.specularMap}else if(material.displacementMap){uvScaleMap=material.displacementMap}else if(material.normalMap){uvScaleMap=material.normalMap}else if(material.bumpMap){uvScaleMap=material.bumpMap}else if(material.glossinessMap){uvScaleMap=material.glossinessMap}else if(material.alphaMap){uvScaleMap=material.alphaMap}else if(material.emissiveMap){uvScaleMap=material.emissiveMap}if(uvScaleMap!==void 0){if(uvScaleMap.isWebGLRenderTarget){uvScaleMap=uvScaleMap.texture}var offset,repeat;if(uvScaleMap.matrix!==void 0){if(!0===uvScaleMap.matrixAutoUpdate){offset=uvScaleMap.offset;repeat=uvScaleMap.repeat;var rotation=uvScaleMap.rotation,center=uvScaleMap.center;uvScaleMap.matrix.setUvTransform(offset.x,offset.y,repeat.x,repeat.y,rotation,center.x,center.y)}uniforms.uvTransform.value.copy(uvScaleMap.matrix)}else{offset=uvScaleMap.offset;repeat=uvScaleMap.repeat;uniforms.offsetRepeat.value.set(offset.x,offset.y,repeat.x,repeat.y)}}uniforms.envMap.value=material.envMap;uniforms.envMapIntensity.value=material.envMapIntensity;uniforms.flipEnvMap.value=material.envMap&&material.envMap.isCubeTexture?-1:1;uniforms.refractionRatio.value=material.refractionRatio;uniforms.specular.value.copy(material.specular);uniforms.glossiness.value=material.glossiness;uniforms.glossinessMap.value=material.glossinessMap;uniforms.emissiveMap.value=material.emissiveMap;uniforms.bumpMap.value=material.bumpMap;uniforms.normalMap.value=material.normalMap;uniforms.displacementMap.value=material.displacementMap;uniforms.displacementScale.value=material.displacementScale;uniforms.displacementBias.value=material.displacementBias;if(null!==uniforms.glossinessMap.value&&defines.USE_GLOSSINESSMAP===void 0){defines.USE_GLOSSINESSMAP="";defines.USE_ROUGHNESSMAP=""}if(null===uniforms.glossinessMap.value&&defines.USE_GLOSSINESSMAP!==void 0){delete defines.USE_GLOSSINESSMAP;delete defines.USE_ROUGHNESSMAP}}}}function GLTFCubicSplineInterpolant(parameterPositions,sampleValues,sampleSize,resultBuffer){THREE.Interpolant.call(this,parameterPositions,sampleValues,sampleSize,resultBuffer)}GLTFCubicSplineInterpolant.prototype=Object.create(THREE.Interpolant.prototype);GLTFCubicSplineInterpolant.prototype.constructor=GLTFCubicSplineInterpolant;GLTFCubicSplineInterpolant.prototype.interpolate_=function(i1,t0,t,t1){for(var result=this.resultBuffer,values=this.sampleValues,stride=this.valueSize,stride3=3*stride,td=t1-t0,p=(t-t0)/td,pp=p*p,ppp=pp*p,offset1=i1*stride3,offset0=offset1-stride3,i=0;i!==stride;i++){var p0=values[offset0+i+stride],m0=values[offset0+i+2*stride]*td,p1=values[offset1+i+stride],m1=values[offset1+i]*td;result[i]=(2*ppp-3*pp+1)*p0+(ppp-2*pp+p)*m0+(-2*ppp+3*pp)*p1+(ppp-pp)*m1}return result};var WEBGL_CONSTANTS={FLOAT:5126,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,LINEAR:9729,REPEAT:10497,SAMPLER_2D:35678,POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,UNSIGNED_BYTE:5121,UNSIGNED_SHORT:5123},WEBGL_TYPE={5126:Number,35675:THREE.Matrix3,35676:THREE.Matrix4,35664:THREE.Vector2,35665:THREE.Vector3,35666:THREE.Vector4,35678:THREE.Texture},WEBGL_COMPONENT_TYPES={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WEBGL_FILTERS={9728:THREE.NearestFilter,9729:THREE.LinearFilter,9984:THREE.NearestMipMapNearestFilter,9985:THREE.LinearMipMapNearestFilter,9986:THREE.NearestMipMapLinearFilter,9987:THREE.LinearMipMapLinearFilter},WEBGL_WRAPPINGS={33071:THREE.ClampToEdgeWrapping,33648:THREE.MirroredRepeatWrapping,10497:THREE.RepeatWrapping},WEBGL_TEXTURE_FORMATS={6406:THREE.AlphaFormat,6407:THREE.RGBFormat,6408:THREE.RGBAFormat,6409:THREE.LuminanceFormat,6410:THREE.LuminanceAlphaFormat},WEBGL_TEXTURE_DATATYPES={5121:THREE.UnsignedByteType,32819:THREE.UnsignedShort4444Type,32820:THREE.UnsignedShort5551Type,33635:THREE.UnsignedShort565Type},WEBGL_SIDES={1028:THREE.BackSide,1029:THREE.FrontSide},WEBGL_DEPTH_FUNCS={512:THREE.NeverDepth,513:THREE.LessDepth,514:THREE.EqualDepth,515:THREE.LessEqualDepth,516:THREE.GreaterEqualDepth,517:THREE.NotEqualDepth,518:THREE.GreaterEqualDepth,519:THREE.AlwaysDepth},WEBGL_BLEND_EQUATIONS={32774:THREE.AddEquation,32778:THREE.SubtractEquation,32779:THREE.ReverseSubtractEquation},WEBGL_BLEND_FUNCS={0:THREE.ZeroFactor,1:THREE.OneFactor,768:THREE.SrcColorFactor,769:THREE.OneMinusSrcColorFactor,770:THREE.SrcAlphaFactor,771:THREE.OneMinusSrcAlphaFactor,772:THREE.DstAlphaFactor,773:THREE.OneMinusDstAlphaFactor,774:THREE.DstColorFactor,775:THREE.OneMinusDstColorFactor,776:THREE.SrcAlphaSaturateFactor},WEBGL_TYPE_SIZES={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},PATH_PROPERTIES={scale:"scale",translation:"position",rotation:"quaternion",weights:"morphTargetInfluences"},INTERPOLATION={CUBICSPLINE:THREE.InterpolateSmooth,LINEAR:THREE.InterpolateLinear,STEP:THREE.InterpolateDiscrete},ALPHA_MODES={OPAQUE:"OPAQUE",MASK:"MASK",BLEND:"BLEND"};function resolveURL(url,path){if("string"!==typeof url||""===url)return"";if(/^(https?:)?\/\//i.test(url))return url;if(/^data:.*,.*$/i.test(url))return url;if(/^blob:.*$/i.test(url))return url;return path+url}function createDefaultMaterial(){return new THREE.MeshStandardMaterial({color:16777215,emissive:0,metalness:1,roughness:1,transparent:!1,depthTest:!0,side:THREE.FrontSide})}function addMorphTargets(mesh,meshDef,primitiveDef,accessors){var geometry=mesh.geometry,material=mesh.material,targets=primitiveDef.targets,morphAttributes=geometry.morphAttributes;morphAttributes.position=[];morphAttributes.normal=[];material.morphTargets=!0;for(var i=0,il=targets.length;i<il;i++){var target=targets[i],attributeName="morphTarget"+i,positionAttribute,normalAttribute;if(target.POSITION!==void 0){positionAttribute=cloneBufferAttribute(accessors[target.POSITION]);for(var position=geometry.attributes.position,j=0,jl=positionAttribute.count;j<jl;j++){positionAttribute.setXYZ(j,positionAttribute.getX(j)+position.getX(j),positionAttribute.getY(j)+position.getY(j),positionAttribute.getZ(j)+position.getZ(j))}}else if(geometry.attributes.position){positionAttribute=cloneBufferAttribute(geometry.attributes.position)}if(positionAttribute!==void 0){positionAttribute.name=attributeName;morphAttributes.position.push(positionAttribute)}if(target.NORMAL!==void 0){material.morphNormals=!0;normalAttribute=cloneBufferAttribute(accessors[target.NORMAL]);for(var normal=geometry.attributes.normal,j=0,jl=normalAttribute.count;j<jl;j++){normalAttribute.setXYZ(j,normalAttribute.getX(j)+normal.getX(j),normalAttribute.getY(j)+normal.getY(j),normalAttribute.getZ(j)+normal.getZ(j))}}else if(geometry.attributes.normal!==void 0){normalAttribute=cloneBufferAttribute(geometry.attributes.normal)}if(normalAttribute!==void 0){normalAttribute.name=attributeName;morphAttributes.normal.push(normalAttribute)}}mesh.updateMorphTargets();if(meshDef.weights!==void 0){for(var i=0,il=meshDef.weights.length;i<il;i++){mesh.morphTargetInfluences[i]=meshDef.weights[i]}}}function isPrimitiveEqual(a,b){if(a.indices!==b.indices){return!1}var attribA=a.attributes||{},attribB=b.attributes||{},keysA=Object.keys(attribA),keysB=Object.keys(attribB);if(keysA.length!==keysB.length){return!1}for(var i=0,il=keysA.length,key;i<il;i++){key=keysA[i];if(attribA[key]!==attribB[key]){return!1}}return!0}function getCachedGeometry(cache,newPrimitive){for(var i=0,il=cache.length,cached;i<il;i++){cached=cache[i];if(isPrimitiveEqual(cached.primitive,newPrimitive)){return cached.geometry}}return null}function cloneBufferAttribute(attribute){if(attribute.isInterleavedBufferAttribute){for(var count=attribute.count,itemSize=attribute.itemSize,array=attribute.array.slice(0,count*itemSize),i=0;i<count;++i){array[i]=attribute.getX(i);if(2<=itemSize)array[i+1]=attribute.getY(i);if(3<=itemSize)array[i+2]=attribute.getZ(i);if(4<=itemSize)array[i+3]=attribute.getW(i)}return new THREE.BufferAttribute(array,itemSize,attribute.normalized)}return attribute.clone()}function GLTFParser(json,extensions,options){this.json=json||{};this.extensions=extensions||{};this.options=options||{};this.cache=new GLTFRegistry;this.primitiveCache=[];this.textureLoader=new THREE.TextureLoader(this.options.manager);this.textureLoader.setCrossOrigin(this.options.crossOrigin);this.fileLoader=new THREE.FileLoader(this.options.manager);this.fileLoader.setResponseType("arraybuffer")}GLTFParser.prototype.parse=function(onLoad,onError){var json=this.json;this.cache.removeAll();this.markDefs();this.getMultiDependencies(["scene","animation","camera"]).then(function(dependencies){var scenes=dependencies.scenes||[],scene=scenes[json.scene||0],animations=dependencies.animations||[],asset=json.asset,cameras=dependencies.cameras||[];onLoad(scene,scenes,cameras,animations,asset)}).catch(onError)};GLTFParser.prototype.markDefs=function(){for(var nodeDefs=this.json.nodes||[],skinDefs=this.json.skins||[],meshDefs=this.json.meshes||[],meshReferences={},meshUses={},skinIndex=0,skinLength=skinDefs.length,joints;skinIndex<skinLength;skinIndex++){joints=skinDefs[skinIndex].joints;for(var i=0,il=joints.length;i<il;i++){nodeDefs[joints[i]].isBone=!0}}for(var nodeIndex=0,nodeLength=nodeDefs.length,nodeDef;nodeIndex<nodeLength;nodeIndex++){nodeDef=nodeDefs[nodeIndex];if(nodeDef.mesh!==void 0){if(meshReferences[nodeDef.mesh]===void 0){meshReferences[nodeDef.mesh]=meshUses[nodeDef.mesh]=0}meshReferences[nodeDef.mesh]++;if(nodeDef.skin!==void 0){meshDefs[nodeDef.mesh].isSkinnedMesh=!0}}}this.json.meshReferences=meshReferences;this.json.meshUses=meshUses};GLTFParser.prototype.getDependency=function(type,index){var cacheKey=type+":"+index,dependency=this.cache.get(cacheKey);if(!dependency){var fnName="load"+type.charAt(0).toUpperCase()+type.slice(1);dependency=this[fnName](index);this.cache.add(cacheKey,dependency)}return dependency};GLTFParser.prototype.getDependencies=function(type){var dependencies=this.cache.get(type);if(!dependencies){var parser=this,defs=this.json[type+("mesh"===type?"es":"s")]||[];dependencies=Promise.all(defs.map(function(def,index){return parser.getDependency(type,index)}));this.cache.add(type,dependencies)}return dependencies};GLTFParser.prototype.getMultiDependencies=function(types){for(var results={},pendings=[],i=0,il=types.length;i<il;i++){var type=types[i],value=this.getDependencies(type);value=value.then(function(key,value){results[key]=value}.bind(this,type+("mesh"===type?"es":"s")));pendings.push(value)}return Promise.all(pendings).then(function(){return results})};GLTFParser.prototype.loadBuffer=function(bufferIndex){var bufferDef=this.json.buffers[bufferIndex],loader=this.fileLoader;if(bufferDef.type&&"arraybuffer"!==bufferDef.type){throw new Error("THREE.GLTFLoader: "+bufferDef.type+" buffer type is not supported.")}if(bufferDef.uri===void 0&&0===bufferIndex){return Promise.resolve(this.extensions[EXTENSIONS.KHR_BINARY_GLTF].body)}var options=this.options;return new Promise(function(resolve,reject){loader.load(resolveURL(bufferDef.uri,options.path),resolve,void 0,function(){reject(new Error("THREE.GLTFLoader: Failed to load buffer \""+bufferDef.uri+"\"."))})})};GLTFParser.prototype.loadBufferView=function(bufferViewIndex){var bufferViewDef=this.json.bufferViews[bufferViewIndex];return this.getDependency("buffer",bufferViewDef.buffer).then(function(buffer){var byteLength=bufferViewDef.byteLength||0,byteOffset=bufferViewDef.byteOffset||0;return buffer.slice(byteOffset,byteOffset+byteLength)})};GLTFParser.prototype.loadAccessor=function(accessorIndex){var parser=this,json=this.json,accessorDef=this.json.accessors[accessorIndex],pendingBufferViews=[];if(accessorDef.bufferView!==void 0){pendingBufferViews.push(this.getDependency("bufferView",accessorDef.bufferView))}else{pendingBufferViews.push(null)}if(accessorDef.sparse!==void 0){pendingBufferViews.push(this.getDependency("bufferView",accessorDef.sparse.indices.bufferView));pendingBufferViews.push(this.getDependency("bufferView",accessorDef.sparse.values.bufferView))}return Promise.all(pendingBufferViews).then(function(bufferViews){var bufferView=bufferViews[0],itemSize=WEBGL_TYPE_SIZES[accessorDef.type],TypedArray=WEBGL_COMPONENT_TYPES[accessorDef.componentType],elementBytes=TypedArray.BYTES_PER_ELEMENT,byteOffset=accessorDef.byteOffset||0,byteStride=json.bufferViews[accessorDef.bufferView].byteStride,normalized=!0===accessorDef.normalized,array,bufferAttribute;if(byteStride&&byteStride!==elementBytes*itemSize){var ibCacheKey="InterleavedBuffer:"+accessorDef.bufferView+":"+accessorDef.componentType,ib=parser.cache.get(ibCacheKey);if(!ib){array=new TypedArray(bufferView);ib=new THREE.InterleavedBuffer(array,byteStride/elementBytes);parser.cache.add(ibCacheKey,ib)}bufferAttribute=new THREE.InterleavedBufferAttribute(ib,itemSize,byteOffset/elementBytes,normalized)}else{if(null===bufferView){array=new TypedArray(accessorDef.count*itemSize)}else{array=new TypedArray(bufferView,byteOffset,accessorDef.count*itemSize)}bufferAttribute=new THREE.BufferAttribute(array,itemSize,normalized)}if(accessorDef.sparse!==void 0){var itemSizeIndices=WEBGL_TYPE_SIZES.SCALAR,TypedArrayIndices=WEBGL_COMPONENT_TYPES[accessorDef.sparse.indices.componentType],byteOffsetIndices=accessorDef.sparse.indices.byteOffset||0,byteOffsetValues=accessorDef.sparse.values.byteOffset||0,sparseIndices=new TypedArrayIndices(bufferViews[1],byteOffsetIndices,accessorDef.sparse.count*itemSizeIndices),sparseValues=new TypedArray(bufferViews[2],byteOffsetValues,accessorDef.sparse.count*itemSize);if(null!==bufferView){bufferAttribute.setArray(bufferAttribute.array.slice())}for(var i=0,il=sparseIndices.length,index;i<il;i++){index=sparseIndices[i];bufferAttribute.setX(index,sparseValues[i*itemSize]);if(2<=itemSize)bufferAttribute.setY(index,sparseValues[i*itemSize+1]);if(3<=itemSize)bufferAttribute.setZ(index,sparseValues[i*itemSize+2]);if(4<=itemSize)bufferAttribute.setW(index,sparseValues[i*itemSize+3]);if(5<=itemSize)throw new Error("THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.")}}return bufferAttribute})};GLTFParser.prototype.loadTexture=function(textureIndex){var parser=this,json=this.json,options=this.options,textureLoader=this.textureLoader,URL=window.URL||window.webkitURL,textureDef=json.textures[textureIndex],source=json.images[textureDef.source],sourceURI=source.uri,isObjectURL=!1;if(source.bufferView!==void 0){sourceURI=parser.getDependency("bufferView",source.bufferView).then(function(bufferView){isObjectURL=!0;var blob=new Blob([bufferView],{type:source.mimeType});sourceURI=URL.createObjectURL(blob);return sourceURI})}return Promise.resolve(sourceURI).then(function(sourceURI){var loader=THREE.Loader.Handlers.get(sourceURI)||textureLoader;return new Promise(function(resolve,reject){loader.load(resolveURL(sourceURI,options.path),resolve,void 0,reject)})}).then(function(texture){if(!0===isObjectURL){URL.revokeObjectURL(sourceURI)}texture.flipY=!1;if(textureDef.name!==void 0)texture.name=textureDef.name;texture.format=textureDef.format!==void 0?WEBGL_TEXTURE_FORMATS[textureDef.format]:THREE.RGBAFormat;if(textureDef.internalFormat!==void 0&&texture.format!==WEBGL_TEXTURE_FORMATS[textureDef.internalFormat]){console.warn("THREE.GLTFLoader: Three.js does not support texture internalFormat which is different from texture format. "+"internalFormat will be forced to be the same value as format.")}texture.type=textureDef.type!==void 0?WEBGL_TEXTURE_DATATYPES[textureDef.type]:THREE.UnsignedByteType;var samplers=json.samplers||{},sampler=samplers[textureDef.sampler]||{};texture.magFilter=WEBGL_FILTERS[sampler.magFilter]||THREE.LinearFilter;texture.minFilter=WEBGL_FILTERS[sampler.minFilter]||THREE.LinearMipMapLinearFilter;texture.wrapS=WEBGL_WRAPPINGS[sampler.wrapS]||THREE.RepeatWrapping;texture.wrapT=WEBGL_WRAPPINGS[sampler.wrapT]||THREE.RepeatWrapping;return texture})};GLTFParser.prototype.assignTexture=function(materialParams,textureName,textureIndex){return this.getDependency("texture",textureIndex).then(function(texture){materialParams[textureName]=texture})};GLTFParser.prototype.loadMaterial=function(materialIndex){var parser=this,json=this.json,extensions=this.extensions,materialDef=this.json.materials[materialIndex],materialType,materialParams={},materialExtensions=materialDef.extensions||{},pending=[];if(materialExtensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS]){var sgExtension=extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];materialType=sgExtension.getMaterialType(materialDef);pending.push(sgExtension.extendParams(materialParams,materialDef,parser))}else if(materialDef.pbrMetallicRoughness!==void 0){materialType=THREE.MeshStandardMaterial;var metallicRoughness=materialDef.pbrMetallicRoughness;materialParams.color=new THREE.Color(1,1,1);materialParams.opacity=1;if(Array.isArray(metallicRoughness.baseColorFactor)){var array=metallicRoughness.baseColorFactor;materialParams.color.fromArray(array);materialParams.opacity=array[3]}if(metallicRoughness.baseColorTexture!==void 0){pending.push(parser.assignTexture(materialParams,"map",metallicRoughness.baseColorTexture.index))}materialParams.metalness=metallicRoughness.metallicFactor!==void 0?metallicRoughness.metallicFactor:1;materialParams.roughness=metallicRoughness.roughnessFactor!==void 0?metallicRoughness.roughnessFactor:1;if(metallicRoughness.metallicRoughnessTexture!==void 0){var textureIndex=metallicRoughness.metallicRoughnessTexture.index;pending.push(parser.assignTexture(materialParams,"metalnessMap",textureIndex));pending.push(parser.assignTexture(materialParams,"roughnessMap",textureIndex))}}else{materialType=THREE.MeshPhongMaterial}if(!0===materialDef.doubleSided){materialParams.side=THREE.DoubleSide}var alphaMode=materialDef.alphaMode||ALPHA_MODES.OPAQUE;if(alphaMode===ALPHA_MODES.BLEND){materialParams.transparent=!0}else{materialParams.transparent=!1;if(alphaMode===ALPHA_MODES.MASK){materialParams.alphaTest=materialDef.alphaCutoff!==void 0?materialDef.alphaCutoff:.5}}if(materialDef.normalTexture!==void 0){pending.push(parser.assignTexture(materialParams,"normalMap",materialDef.normalTexture.index));materialParams.normalScale=new THREE.Vector2(1,1);if(materialDef.normalTexture.scale!==void 0){materialParams.normalScale.set(materialDef.normalTexture.scale,materialDef.normalTexture.scale)}}if(materialDef.occlusionTexture!==void 0){pending.push(parser.assignTexture(materialParams,"aoMap",materialDef.occlusionTexture.index));if(materialDef.occlusionTexture.strength!==void 0){materialParams.aoMapIntensity=materialDef.occlusionTexture.strength}}if(materialDef.emissiveFactor!==void 0){if(materialType===THREE.MeshBasicMaterial){materialParams.color=new THREE.Color().fromArray(materialDef.emissiveFactor)}else{materialParams.emissive=new THREE.Color().fromArray(materialDef.emissiveFactor)}}if(materialDef.emissiveTexture!==void 0){if(materialType===THREE.MeshBasicMaterial){pending.push(parser.assignTexture(materialParams,"map",materialDef.emissiveTexture.index))}else{pending.push(parser.assignTexture(materialParams,"emissiveMap",materialDef.emissiveTexture.index))}}return Promise.all(pending).then(function(){var material;if(materialType===THREE.ShaderMaterial){material=extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].createMaterial(materialParams)}else{material=new materialType(materialParams)}if(materialDef.name!==void 0)material.name=materialDef.name;if(material.normalScale){material.normalScale.x=-material.normalScale.x}if(material.map)material.map.encoding=THREE.sRGBEncoding;if(material.emissiveMap)material.emissiveMap.encoding=THREE.sRGBEncoding;if(materialDef.extras)material.userData=materialDef.extras;return material})};GLTFParser.prototype.loadGeometries=function(primitives){var cache=this.primitiveCache;return this.getDependencies("accessor").then(function(accessors){for(var geometries=[],i=0,il=primitives.length;i<il;i++){var primitive=primitives[i],cached=getCachedGeometry(cache,primitive);if(cached){geometries.push(cached)}else{var geometry=new THREE.BufferGeometry,attributes=primitive.attributes;for(var attributeId in attributes){var attributeEntry=attributes[attributeId],bufferAttribute=accessors[attributeEntry];switch(attributeId){case"POSITION":geometry.addAttribute("position",bufferAttribute);break;case"NORMAL":geometry.addAttribute("normal",bufferAttribute);break;case"TEXCOORD_0":case"TEXCOORD0":case"TEXCOORD":geometry.addAttribute("uv",bufferAttribute);break;case"TEXCOORD_1":geometry.addAttribute("uv2",bufferAttribute);break;case"COLOR_0":case"COLOR0":case"COLOR":geometry.addAttribute("color",bufferAttribute);break;case"WEIGHTS_0":case"WEIGHT":geometry.addAttribute("skinWeight",bufferAttribute);break;case"JOINTS_0":case"JOINT":geometry.addAttribute("skinIndex",bufferAttribute);break;}}if(primitive.indices!==void 0){geometry.setIndex(accessors[primitive.indices])}cache.push({primitive:primitive,geometry:geometry});geometries.push(geometry)}}return geometries})};GLTFParser.prototype.loadMesh=function(meshIndex){var scope=this,json=this.json,extensions=this.extensions,meshDef=this.json.meshes[meshIndex];return this.getMultiDependencies(["accessor","material"]).then(function(dependencies){var group=new THREE.Group,primitives=meshDef.primitives;return scope.loadGeometries(primitives).then(function(geometries){for(var i=0,il=primitives.length;i<il;i++){var primitive=primitives[i],geometry=geometries[i],material=primitive.material===void 0?createDefaultMaterial():dependencies.materials[primitive.material];if(material.aoMap&&geometry.attributes.uv2===void 0&&geometry.attributes.uv!==void 0){console.log("THREE.GLTFLoader: Duplicating UVs to support aoMap.");geometry.addAttribute("uv2",new THREE.BufferAttribute(geometry.attributes.uv.array,2))}var useVertexColors=geometry.attributes.color!==void 0,useFlatShading=geometry.attributes.normal===void 0,useSkinning=!0===meshDef.isSkinnedMesh,useMorphTargets=primitive.targets!==void 0;if(useVertexColors||useFlatShading||useSkinning||useMorphTargets){if(material.isGLTFSpecularGlossinessMaterial){var specGlossExtension=extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS];material=specGlossExtension.cloneMaterial(material)}else{material=material.clone()}}if(useVertexColors){material.vertexColors=THREE.VertexColors;material.needsUpdate=!0}if(useFlatShading){material.flatShading=!0}var mesh;if(primitive.mode===WEBGL_CONSTANTS.TRIANGLES||primitive.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP||primitive.mode===WEBGL_CONSTANTS.TRIANGLE_FAN||primitive.mode===void 0){if(useSkinning){mesh=new THREE.SkinnedMesh(geometry,material);material.skinning=!0}else{mesh=new THREE.Mesh(geometry,material)}if(primitive.mode===WEBGL_CONSTANTS.TRIANGLE_STRIP){mesh.drawMode=THREE.TriangleStripDrawMode}else if(primitive.mode===WEBGL_CONSTANTS.TRIANGLE_FAN){mesh.drawMode=THREE.TriangleFanDrawMode}}else if(primitive.mode===WEBGL_CONSTANTS.LINES||primitive.mode===WEBGL_CONSTANTS.LINE_STRIP||primitive.mode===WEBGL_CONSTANTS.LINE_LOOP){var cacheKey="LineBasicMaterial:"+material.uuid,lineMaterial=scope.cache.get(cacheKey);if(!lineMaterial){lineMaterial=new THREE.LineBasicMaterial;THREE.Material.prototype.copy.call(lineMaterial,material);lineMaterial.color.copy(material.color);lineMaterial.lights=!1;scope.cache.add(cacheKey,lineMaterial)}material=lineMaterial;if(primitive.mode===WEBGL_CONSTANTS.LINES){mesh=new THREE.LineSegments(geometry,material)}else if(primitive.mode===WEBGL_CONSTANTS.LINE_STRIP){mesh=new THREE.Line(geometry,material)}else{mesh=new THREE.LineLoop(geometry,material)}}else if(primitive.mode===WEBGL_CONSTANTS.POINTS){var cacheKey="PointsMaterial:"+material.uuid,pointsMaterial=scope.cache.get(cacheKey);if(!pointsMaterial){pointsMaterial=new THREE.PointsMaterial;THREE.Material.prototype.copy.call(pointsMaterial,material);pointsMaterial.color.copy(material.color);pointsMaterial.map=material.map;pointsMaterial.lights=!1;scope.cache.add(cacheKey,pointsMaterial)}material=pointsMaterial;mesh=new THREE.Points(geometry,material)}else{throw new Error("THREE.GLTFLoader: Primitive mode unsupported: "+primitive.mode)}mesh.name=meshDef.name||"mesh_"+meshIndex;if(useMorphTargets){addMorphTargets(mesh,meshDef,primitive,dependencies.accessors)}if(meshDef.extras!==void 0)mesh.userData=meshDef.extras;if(primitive.extras!==void 0)mesh.geometry.userData=primitive.extras;if(!0===material.isGLTFSpecularGlossinessMaterial){mesh.onBeforeRender=extensions[EXTENSIONS.KHR_MATERIALS_PBR_SPECULAR_GLOSSINESS].refreshUniforms}if(1<primitives.length){mesh.name+="_"+i;group.add(mesh)}else{return mesh}}return group})})};GLTFParser.prototype.loadCamera=function(cameraIndex){var camera,cameraDef=this.json.cameras[cameraIndex],params=cameraDef[cameraDef.type];if(!params){console.warn("THREE.GLTFLoader: Missing camera parameters.");return}if("perspective"===cameraDef.type){var aspectRatio=params.aspectRatio||1,xfov=params.yfov*aspectRatio;camera=new THREE.PerspectiveCamera(THREE.Math.radToDeg(xfov),aspectRatio,params.znear||1,params.zfar||2e6)}else if("orthographic"===cameraDef.type){camera=new THREE.OrthographicCamera(params.xmag/-2,params.xmag/2,params.ymag/2,params.ymag/-2,params.znear,params.zfar)}if(cameraDef.name!==void 0)camera.name=cameraDef.name;if(cameraDef.extras)camera.userData=cameraDef.extras;return Promise.resolve(camera)};GLTFParser.prototype.loadSkin=function(skinIndex){var skinDef=this.json.skins[skinIndex],skinEntry={joints:skinDef.joints};if(skinDef.inverseBindMatrices===void 0){return Promise.resolve(skinEntry)}return this.getDependency("accessor",skinDef.inverseBindMatrices).then(function(accessor){skinEntry.inverseBindMatrices=accessor;return skinEntry})};GLTFParser.prototype.loadAnimation=function(animationIndex){var json=this.json,animationDef=this.json.animations[animationIndex];return this.getMultiDependencies(["accessor","node"]).then(function(dependencies){for(var tracks=[],i=0,il=animationDef.channels.length;i<il;i++){var channel=animationDef.channels[i],sampler=animationDef.samplers[channel.sampler];if(sampler){var target=channel.target,name=target.node!==void 0?target.node:target.id,input=animationDef.parameters!==void 0?animationDef.parameters[sampler.input]:sampler.input,output=animationDef.parameters!==void 0?animationDef.parameters[sampler.output]:sampler.output,inputAccessor=dependencies.accessors[input],outputAccessor=dependencies.accessors[output],node=dependencies.nodes[name];if(node){node.updateMatrix();node.matrixAutoUpdate=!0;var TypedKeyframeTrack;switch(PATH_PROPERTIES[target.path]){case PATH_PROPERTIES.weights:TypedKeyframeTrack=THREE.NumberKeyframeTrack;break;case PATH_PROPERTIES.rotation:TypedKeyframeTrack=THREE.QuaternionKeyframeTrack;break;case PATH_PROPERTIES.position:case PATH_PROPERTIES.scale:default:TypedKeyframeTrack=THREE.VectorKeyframeTrack;break;}var targetName=node.name?node.name:node.uuid,interpolation=sampler.interpolation!==void 0?INTERPOLATION[sampler.interpolation]:THREE.InterpolateLinear,targetNames=[];if(PATH_PROPERTIES[target.path]===PATH_PROPERTIES.weights){node.traverse(function(object){if(!0===object.isMesh&&!0===object.material.morphTargets){targetNames.push(object.name?object.name:object.uuid)}})}else{targetNames.push(targetName)}for(var j=0,jl=targetNames.length,track;j<jl;j++){track=new TypedKeyframeTrack(targetNames[j]+"."+PATH_PROPERTIES[target.path],THREE.AnimationUtils.arraySlice(inputAccessor.array,0),THREE.AnimationUtils.arraySlice(outputAccessor.array,0),interpolation);if("CUBICSPLINE"===sampler.interpolation){track.createInterpolant=function(result){return new GLTFCubicSplineInterpolant(this.times,this.values,this.getValueSize()/3,result)}}tracks.push(track)}}}}var name=animationDef.name!==void 0?animationDef.name:"animation_"+animationIndex;return new THREE.AnimationClip(name,void 0,tracks)})};GLTFParser.prototype.loadNode=function(nodeIndex){var json=this.json,extensions=this.extensions,meshReferences=this.json.meshReferences,meshUses=this.json.meshUses,nodeDef=this.json.nodes[nodeIndex];return this.getMultiDependencies(["mesh","skin","camera"]).then(function(dependencies){var node;if(!0===nodeDef.isBone){node=new THREE.Bone}else if(nodeDef.mesh!==void 0){var mesh=dependencies.meshes[nodeDef.mesh];node=mesh.clone();if(!0===mesh.isGroup){for(var i=0,il=mesh.children.length,child;i<il;i++){child=mesh.children[i];if(child.material&&!0===child.material.isGLTFSpecularGlossinessMaterial){node.children[i].onBeforeRender=child.onBeforeRender}}}else{if(mesh.material&&!0===mesh.material.isGLTFSpecularGlossinessMaterial){node.onBeforeRender=mesh.onBeforeRender}}if(1<meshReferences[nodeDef.mesh]){node.name+="_instance_"+meshUses[nodeDef.mesh]++}}else if(nodeDef.camera!==void 0){node=dependencies.cameras[nodeDef.camera]}else if(nodeDef.extensions&&nodeDef.extensions[EXTENSIONS.KHR_LIGHTS]&&nodeDef.extensions[EXTENSIONS.KHR_LIGHTS].light!==void 0){var lights=extensions[EXTENSIONS.KHR_LIGHTS].lights;node=lights[nodeDef.extensions[EXTENSIONS.KHR_LIGHTS].light]}else{node=new THREE.Object3D}if(nodeDef.name!==void 0){node.name=THREE.PropertyBinding.sanitizeNodeName(nodeDef.name)}if(nodeDef.extras)node.userData=nodeDef.extras;if(nodeDef.matrix!==void 0){var matrix=new THREE.Matrix4;matrix.fromArray(nodeDef.matrix);node.applyMatrix(matrix)}else{if(nodeDef.translation!==void 0){node.position.fromArray(nodeDef.translation)}if(nodeDef.rotation!==void 0){node.quaternion.fromArray(nodeDef.rotation)}if(nodeDef.scale!==void 0){node.scale.fromArray(nodeDef.scale)}}return node})};GLTFParser.prototype.loadScene=function(){function buildNodeHierachy(nodeId,parentObject,json,allNodes,skins){var node=allNodes[nodeId],nodeDef=json.nodes[nodeId];if(nodeDef.skin!==void 0){for(var meshes=!0===node.isGroup?node.children:[node],i=0,il=meshes.length;i<il;i++){for(var mesh=meshes[i],skinEntry=skins[nodeDef.skin],bones=[],boneInverses=[],j=0,jl=skinEntry.joints.length;j<jl;j++){var jointId=skinEntry.joints[j],jointNode=allNodes[jointId];if(jointNode){bones.push(jointNode);var mat=new THREE.Matrix4;if(skinEntry.inverseBindMatrices!==void 0){mat.fromArray(skinEntry.inverseBindMatrices.array,16*j)}boneInverses.push(mat)}else{console.warn("THREE.GLTFLoader: Joint \"%s\" could not be found.",jointId)}}mesh.bind(new THREE.Skeleton(bones,boneInverses),mesh.matrixWorld)}}parentObject.add(node);if(nodeDef.children){for(var children=nodeDef.children,i=0,il=children.length,child;i<il;i++){child=children[i];buildNodeHierachy(child,node,json,allNodes,skins)}}}return function(sceneIndex){var json=this.json,extensions=this.extensions,sceneDef=this.json.scenes[sceneIndex];return this.getMultiDependencies(["node","skin"]).then(function(dependencies){var scene=new THREE.Scene;if(sceneDef.name!==void 0)scene.name=sceneDef.name;if(sceneDef.extras)scene.userData=sceneDef.extras;for(var nodeIds=sceneDef.nodes||[],i=0,il=nodeIds.length;i<il;i++){buildNodeHierachy(nodeIds[i],scene,json,dependencies.nodes,dependencies.skins)}if(sceneDef.extensions&&sceneDef.extensions[EXTENSIONS.KHR_LIGHTS]&&sceneDef.extensions[EXTENSIONS.KHR_LIGHTS].light!==void 0){var lights=extensions[EXTENSIONS.KHR_LIGHTS].lights;scene.add(lights[sceneDef.extensions[EXTENSIONS.KHR_LIGHTS].light])}return scene})}}();return GLTFLoader}()},{}],43:[function(){THREE.MTLLoader=function(manager){this.manager=manager!==void 0?manager:THREE.DefaultLoadingManager};THREE.MTLLoader.prototype={constructor:THREE.MTLLoader,load:function load(url,onLoad,onProgress,onError){var scope=this,loader=new THREE.FileLoader(this.manager);loader.setPath(this.path);loader.load(url,function(text){onLoad(scope.parse(text))},onProgress,onError)},setPath:function setPath(path){this.path=path},setTexturePath:function setTexturePath(path){this.texturePath=path},setBaseUrl:function setBaseUrl(path){console.warn("THREE.MTLLoader: .setBaseUrl() is deprecated. Use .setTexturePath( path ) for texture path or .setPath( path ) for general base path instead.");this.setTexturePath(path)},setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value},setMaterialOptions:function setMaterialOptions(value){this.materialOptions=value},parse:function parse(text){for(var lines=text.split("\n"),info={},delimiter_pattern=/\s+/,materialsInfo={},i=0,line;i<lines.length;i++){line=lines[i];line=line.trim();if(0===line.length||"#"===line.charAt(0)){continue}var pos=line.indexOf(" "),key=0<=pos?line.substring(0,pos):line;key=key.toLowerCase();var value=0<=pos?line.substring(pos+1):"";value=value.trim();if("newmtl"===key){info={name:value};materialsInfo[value]=info}else if(info){if("ka"===key||"kd"===key||"ks"===key){var ss=value.split(delimiter_pattern,3);info[key]=[parseFloat(ss[0]),parseFloat(ss[1]),parseFloat(ss[2])]}else{info[key]=value}}}var materialCreator=new THREE.MTLLoader.MaterialCreator(this.texturePath||this.path,this.materialOptions);materialCreator.setCrossOrigin(this.crossOrigin);materialCreator.setManager(this.manager);materialCreator.setMaterials(materialsInfo);return materialCreator}};THREE.MTLLoader.MaterialCreator=function(baseUrl,options){this.baseUrl=baseUrl||"";this.options=options;this.materialsInfo={};this.materials={};this.materialsArray=[];this.nameLookup={};this.side=this.options&&this.options.side?this.options.side:THREE.FrontSide;this.wrap=this.options&&this.options.wrap?this.options.wrap:THREE.RepeatWrapping};THREE.MTLLoader.MaterialCreator.prototype={constructor:THREE.MTLLoader.MaterialCreator,crossOrigin:"Anonymous",setCrossOrigin:function setCrossOrigin(value){this.crossOrigin=value},setManager:function setManager(value){this.manager=value},setMaterials:function setMaterials(materialsInfo){this.materialsInfo=this.convert(materialsInfo);this.materials={};this.materialsArray=[];this.nameLookup={}},convert:function convert(materialsInfo){if(!this.options)return materialsInfo;var converted={};for(var mn in materialsInfo){var mat=materialsInfo[mn],covmat={};converted[mn]=covmat;for(var prop in mat){var save=!0,value=mat[prop],lprop=prop.toLowerCase();switch(lprop){case"kd":case"ka":case"ks":if(this.options&&this.options.normalizeRGB){value=[value[0]/255,value[1]/255,value[2]/255]}if(this.options&&this.options.ignoreZeroRGBs){if(0===value[0]&&0===value[1]&&0===value[2]){save=!1}}break;default:break;}if(save){covmat[lprop]=value}}}return converted},preload:function preload(){for(var mn in this.materialsInfo){this.create(mn)}},getIndex:function getIndex(materialName){return this.nameLookup[materialName]},getAsArray:function getAsArray(){var index=0;for(var mn in this.materialsInfo){this.materialsArray[index]=this.create(mn);this.nameLookup[mn]=index;index++}return this.materialsArray},create:function create(materialName){if(this.materials[materialName]===void 0){this.createMaterial_(materialName)}return this.materials[materialName]},createMaterial_:function createMaterial_(materialName){var scope=this,mat=this.materialsInfo[materialName],params={name:materialName,side:this.side};function resolveURL(baseUrl,url){if("string"!==typeof url||""===url)return"";if(/^https?:\/\//i.test(url))return url;return baseUrl+url}function setMapForType(mapType,value){if(params[mapType])return;var texParams=scope.getTextureParams(value,params),map=scope.loadTexture(resolveURL(scope.baseUrl,texParams.url));map.repeat.copy(texParams.scale);map.offset.copy(texParams.offset);map.wrapS=scope.wrap;map.wrapT=scope.wrap;params[mapType]=map}for(var prop in mat){var value=mat[prop],n;if(""===value)continue;switch(prop.toLowerCase()){case"kd":params.color=new THREE.Color().fromArray(value);break;case"ks":params.specular=new THREE.Color().fromArray(value);break;case"map_kd":setMapForType("map",value);break;case"map_ks":setMapForType("specularMap",value);break;case"norm":setMapForType("normalMap",value);break;case"map_bump":case"bump":setMapForType("bumpMap",value);break;case"ns":params.shininess=parseFloat(value);break;case"d":n=parseFloat(value);if(1>n){params.opacity=n;params.transparent=!0}break;case"tr":n=parseFloat(value);if(this.options&&this.options.invertTrProperty)n=1-n;if(0<n){params.opacity=1-n;params.transparent=!0}break;default:break;}}this.materials[materialName]=new THREE.MeshPhongMaterial(params);return this.materials[materialName]},getTextureParams:function getTextureParams(value,matParams){var texParams={scale:new THREE.Vector2(1,1),offset:new THREE.Vector2(0,0)},items=value.split(/\s+/),pos;pos=items.indexOf("-bm");if(0<=pos){matParams.bumpScale=parseFloat(items[pos+1]);items.splice(pos,2)}pos=items.indexOf("-s");if(0<=pos){texParams.scale.set(parseFloat(items[pos+1]),parseFloat(items[pos+2]));items.splice(pos,4)}pos=items.indexOf("-o");if(0<=pos){texParams.offset.set(parseFloat(items[pos+1]),parseFloat(items[pos+2]));items.splice(pos,4)}texParams.url=items.join(" ").trim();return texParams},loadTexture:function loadTexture(url,mapping,onLoad,onProgress,onError){var texture,loader=THREE.Loader.Handlers.get(url),manager=this.manager!==void 0?this.manager:THREE.DefaultLoadingManager;if(null===loader){loader=new THREE.TextureLoader(manager)}if(loader.setCrossOrigin)loader.setCrossOrigin(this.crossOrigin);texture=loader.load(url,onLoad,onProgress,onError);if(mapping!==void 0)texture.mapping=mapping;return texture}}},{}],44:[function(){THREE.OBJLoader=function(){var object_pattern=/^[og]\s*(.+)?/,material_library_pattern=/^mtllib /,material_use_pattern=/^usemtl /;function ParserState(){var state={objects:[],object:{},vertices:[],normals:[],colors:[],uvs:[],materialLibraries:[],startObject:function startObject(name,fromDeclaration){if(this.object&&!1===this.object.fromDeclaration){this.object.name=name;this.object.fromDeclaration=!1!==fromDeclaration;return}var previousMaterial=this.object&&"function"===typeof this.object.currentMaterial?this.object.currentMaterial():void 0;if(this.object&&"function"===typeof this.object._finalize){this.object._finalize(!0)}this.object={name:name||"",fromDeclaration:!1!==fromDeclaration,geometry:{vertices:[],normals:[],colors:[],uvs:[]},materials:[],smooth:!0,startMaterial:function startMaterial(name,libraries){var previous=this._finalize(!1);if(previous&&(previous.inherited||0>=previous.groupCount)){this.materials.splice(previous.index,1)}var material={index:this.materials.length,name:name||"",mtllib:Array.isArray(libraries)&&0<libraries.length?libraries[libraries.length-1]:"",smooth:previous!==void 0?previous.smooth:this.smooth,groupStart:previous!==void 0?previous.groupEnd:0,groupEnd:-1,groupCount:-1,inherited:!1,clone:function clone(index){var cloned={index:"number"===typeof index?index:this.index,name:this.name,mtllib:this.mtllib,smooth:this.smooth,groupStart:0,groupEnd:-1,groupCount:-1,inherited:!1};cloned.clone=this.clone.bind(cloned);return cloned}};this.materials.push(material);return material},currentMaterial:function currentMaterial(){if(0<this.materials.length){return this.materials[this.materials.length-1]}},_finalize:function _finalize(end){var lastMultiMaterial=this.currentMaterial();if(lastMultiMaterial&&-1===lastMultiMaterial.groupEnd){lastMultiMaterial.groupEnd=this.geometry.vertices.length/3;lastMultiMaterial.groupCount=lastMultiMaterial.groupEnd-lastMultiMaterial.groupStart;lastMultiMaterial.inherited=!1}if(end&&1<this.materials.length){for(var mi=this.materials.length-1;0<=mi;mi--){if(0>=this.materials[mi].groupCount){this.materials.splice(mi,1)}}}if(end&&0===this.materials.length){this.materials.push({name:"",smooth:this.smooth})}return lastMultiMaterial}};if(previousMaterial&&previousMaterial.name&&"function"===typeof previousMaterial.clone){var declared=previousMaterial.clone(0);declared.inherited=!0;this.object.materials.push(declared)}this.objects.push(this.object)},finalize:function finalize(){if(this.object&&"function"===typeof this.object._finalize){this.object._finalize(!0)}},parseVertexIndex:function parseVertexIndex(value,len){var index=parseInt(value,10);return 3*(0<=index?index-1:index+len/3)},parseNormalIndex:function parseNormalIndex(value,len){var index=parseInt(value,10);return 3*(0<=index?index-1:index+len/3)},parseUVIndex:function parseUVIndex(value,len){var index=parseInt(value,10);return 2*(0<=index?index-1:index+len/2)},addVertex:function addVertex(a,b,c){var src=this.vertices,dst=this.object.geometry.vertices;dst.push(src[a+0],src[a+1],src[a+2]);dst.push(src[b+0],src[b+1],src[b+2]);dst.push(src[c+0],src[c+1],src[c+2])},addVertexPoint:function addVertexPoint(a){var src=this.vertices,dst=this.object.geometry.vertices;dst.push(src[a+0],src[a+1],src[a+2])},addVertexLine:function addVertexLine(a){var src=this.vertices,dst=this.object.geometry.vertices;dst.push(src[a+0],src[a+1],src[a+2])},addNormal:function addNormal(a,b,c){var src=this.normals,dst=this.object.geometry.normals;dst.push(src[a+0],src[a+1],src[a+2]);dst.push(src[b+0],src[b+1],src[b+2]);dst.push(src[c+0],src[c+1],src[c+2])},addColor:function addColor(a,b,c){var src=this.colors,dst=this.object.geometry.colors;dst.push(src[a+0],src[a+1],src[a+2]);dst.push(src[b+0],src[b+1],src[b+2]);dst.push(src[c+0],src[c+1],src[c+2])},addUV:function addUV(a,b,c){var src=this.uvs,dst=this.object.geometry.uvs;dst.push(src[a+0],src[a+1]);dst.push(src[b+0],src[b+1]);dst.push(src[c+0],src[c+1])},addUVLine:function addUVLine(a){var src=this.uvs,dst=this.object.geometry.uvs;dst.push(src[a+0],src[a+1])},addFace:function addFace(a,b,c,ua,ub,uc,na,nb,nc){var vLen=this.vertices.length,ia=this.parseVertexIndex(a,vLen),ib=this.parseVertexIndex(b,vLen),ic=this.parseVertexIndex(c,vLen);this.addVertex(ia,ib,ic);if(ua!==void 0){var uvLen=this.uvs.length;ia=this.parseUVIndex(ua,uvLen);ib=this.parseUVIndex(ub,uvLen);ic=this.parseUVIndex(uc,uvLen);this.addUV(ia,ib,ic)}if(na!==void 0){var nLen=this.normals.length;ia=this.parseNormalIndex(na,nLen);ib=na===nb?ia:this.parseNormalIndex(nb,nLen);ic=na===nc?ia:this.parseNormalIndex(nc,nLen);this.addNormal(ia,ib,ic)}if(0<this.colors.length){this.addColor(ia,ib,ic)}},addPointGeometry:function addPointGeometry(vertices){this.object.geometry.type="Points";for(var vLen=this.vertices.length,vi=0,l=vertices.length;vi<l;vi++){this.addVertexPoint(this.parseVertexIndex(vertices[vi],vLen))}},addLineGeometry:function addLineGeometry(vertices,uvs){this.object.geometry.type="Line";for(var vLen=this.vertices.length,uvLen=this.uvs.length,vi=0,l=vertices.length;vi<l;vi++){this.addVertexLine(this.parseVertexIndex(vertices[vi],vLen))}for(var uvi=0,l=uvs.length;uvi<l;uvi++){this.addUVLine(this.parseUVIndex(uvs[uvi],uvLen))}}};state.startObject("",!1);return state}function OBJLoader(manager){this.manager=manager!==void 0?manager:THREE.DefaultLoadingManager;this.materials=null}OBJLoader.prototype={constructor:OBJLoader,load:function load(url,onLoad,onProgress,onError){var scope=this,loader=new THREE.FileLoader(scope.manager);loader.setPath(this.path);loader.load(url,function(text){onLoad(scope.parse(text))},onProgress,onError)},setPath:function setPath(value){this.path=value},setMaterials:function setMaterials(materials){this.materials=materials;return this},parse:function parse(text){console.time("OBJLoader");var state=new ParserState;if(-1!==text.indexOf("\r\n")){text=text.replace(/\r\n/g,"\n")}if(-1!==text.indexOf("\\\n")){text=text.replace(/\\\n/g,"")}for(var lines=text.split("\n"),line="",lineFirstChar="",lineLength=0,result=[],trimLeft="function"===typeof"".trimLeft,i=0,l=lines.length;i<l;i++){line=lines[i];line=trimLeft?line.trimLeft():line.trim();lineLength=line.length;if(0===lineLength)continue;lineFirstChar=line.charAt(0);if("#"===lineFirstChar)continue;if("v"===lineFirstChar){var data=line.split(/\s+/);switch(data[0]){case"v":state.vertices.push(parseFloat(data[1]),parseFloat(data[2]),parseFloat(data[3]));if(8===data.length){state.colors.push(parseFloat(data[4]),parseFloat(data[5]),parseFloat(data[6]))}break;case"vn":state.normals.push(parseFloat(data[1]),parseFloat(data[2]),parseFloat(data[3]));break;case"vt":state.uvs.push(parseFloat(data[1]),parseFloat(data[2]));break;}}else if("f"===lineFirstChar){for(var lineData=line.substr(1).trim(),vertexData=lineData.split(/\s+/),faceVertices=[],j=0,jl=vertexData.length,vertex;j<jl;j++){vertex=vertexData[j];if(0<vertex.length){var vertexParts=vertex.split("/");faceVertices.push(vertexParts)}}for(var v1=faceVertices[0],j=1,jl=faceVertices.length-1;j<jl;j++){var v2=faceVertices[j],v3=faceVertices[j+1];state.addFace(v1[0],v2[0],v3[0],v1[1],v2[1],v3[1],v1[2],v2[2],v3[2])}}else if("l"===lineFirstChar){var lineParts=line.substring(1).trim().split(" "),lineVertices=[],lineUVs=[];if(-1===line.indexOf("/")){lineVertices=lineParts}else{for(var li=0,llen=lineParts.length,parts;li<llen;li++){parts=lineParts[li].split("/");if(""!==parts[0])lineVertices.push(parts[0]);if(""!==parts[1])lineUVs.push(parts[1])}}state.addLineGeometry(lineVertices,lineUVs)}else if("p"===lineFirstChar){var lineData=line.substr(1).trim(),pointData=lineData.split(" ");state.addPointGeometry(pointData)}else if(null!==(result=object_pattern.exec(line))){var name=(" "+result[0].substr(1).trim()).substr(1);state.startObject(name)}else if(material_use_pattern.test(line)){state.object.startMaterial(line.substring(7).trim(),state.materialLibraries)}else if(material_library_pattern.test(line)){state.materialLibraries.push(line.substring(7).trim())}else if("s"===lineFirstChar){result=line.split(" ");if(1<result.length){var value=result[1].trim().toLowerCase();state.object.smooth="0"!==value&&"off"!==value}else{state.object.smooth=!0}var material=state.object.currentMaterial();if(material)material.smooth=state.object.smooth}else{if("\0"===line)continue;throw new Error("THREE.OBJLoader: Unexpected line: \""+line+"\"")}}state.finalize();var container=new THREE.Group;container.materialLibraries=[].concat(state.materialLibraries);for(var i=0,l=state.objects.length;i<l;i++){var object=state.objects[i],geometry=object.geometry,materials=object.materials,isLine="Line"===geometry.type,isPoints="Points"===geometry.type,hasVertexColors=!1;if(0===geometry.vertices.length)continue;var buffergeometry=new THREE.BufferGeometry;buffergeometry.addAttribute("position",new THREE.Float32BufferAttribute(geometry.vertices,3));if(0<geometry.normals.length){buffergeometry.addAttribute("normal",new THREE.Float32BufferAttribute(geometry.normals,3))}else{buffergeometry.computeVertexNormals()}if(0<geometry.colors.length){hasVertexColors=!0;buffergeometry.addAttribute("color",new THREE.Float32BufferAttribute(geometry.colors,3))}if(0<geometry.uvs.length){buffergeometry.addAttribute("uv",new THREE.Float32BufferAttribute(geometry.uvs,2))}for(var createdMaterials=[],mi=0,miLen=materials.length;mi<miLen;mi++){var sourceMaterial=materials[mi],material=void 0;if(null!==this.materials){material=this.materials.create(sourceMaterial.name);if(isLine&&material&&!babelHelpers.instanceof(material,THREE.LineBasicMaterial)){var materialLine=new THREE.LineBasicMaterial;materialLine.copy(material);materialLine.lights=!1;material=materialLine}else if(isPoints&&material&&!babelHelpers.instanceof(material,THREE.PointsMaterial)){var materialPoints=new THREE.PointsMaterial({size:10,sizeAttenuation:!1});materialLine.copy(material);material=materialPoints}}if(!material){if(isLine){material=new THREE.LineBasicMaterial}else if(isPoints){material=new THREE.PointsMaterial({size:1,sizeAttenuation:!1})}else{material=new THREE.MeshPhongMaterial}material.name=sourceMaterial.name}material.flatShading=sourceMaterial.smooth?!1:!0;material.vertexColors=hasVertexColors?THREE.VertexColors:THREE.NoColors;createdMaterials.push(material)}var mesh;if(1<createdMaterials.length){for(var mi=0,miLen=materials.length,sourceMaterial;mi<miLen;mi++){sourceMaterial=materials[mi];buffergeometry.addGroup(sourceMaterial.groupStart,sourceMaterial.groupCount,mi)}if(isLine){mesh=new THREE.LineSegments(buffergeometry,createdMaterials)}else if(isPoints){mesh=new THREE.Points(buffergeometry,createdMaterials)}else{mesh=new THREE.Mesh(buffergeometry,createdMaterials)}}else{if(isLine){mesh=new THREE.LineSegments(buffergeometry,createdMaterials[0])}else if(isPoints){mesh=new THREE.Points(buffergeometry,createdMaterials[0])}else{mesh=new THREE.Mesh(buffergeometry,createdMaterials[0])}}mesh.name=object.name;container.add(mesh)}console.timeEnd("OBJLoader");return container}};return OBJLoader}()},{}],45:[function(_dereq_,module,exports){exports=module.exports=function(str){return str.replace(/^\s*|\s*$/g,"")};exports.left=function(str){return str.replace(/^\s*/,"")};exports.right=function(str){return str.replace(/\s*$/,"")}},{}],46:[function(_dereq_,module,exports){(function(global){(function(global,factory){"object"===babelHelpers.typeof(exports)&&"undefined"!==typeof module?module.exports=factory():"function"===typeof define&&define.amd?define(factory):global.WebVRPolyfill=factory()})(this,function(){"use strict";var commonjsGlobal="undefined"!==typeof window?window:"undefined"!==typeof global?global:"undefined"!==typeof self?self:{};var race=function(promises){if(Promise.race){return Promise.race(promises)}return new Promise(function(resolve,reject){for(var i=0;i<promises.length;i++){promises[i].then(resolve,reject)}})},isMobile=function(){return /Android/i.test(navigator.userAgent)||/iPhone|iPad|iPod/i.test(navigator.userAgent)},copyArray=function(source,dest){for(var i=0,n=source.length;i<n;i++){dest[i]=source[i]}},extend=function(dest,src){for(var key in src){if(src.hasOwnProperty(key)){dest[key]=src[key]}}return dest},cardboardVrDisplay=function(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}(function(module){(function(global,factory){module.exports=factory()})(commonjsGlobal,function(){var classCallCheck=function(instance,Constructor){if(!babelHelpers.instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}},createClass=function(){function defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}(),slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=!0){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=!0;_e=err}finally{try{if(!_n&&_i["return"])_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError("Invalid attempt to destructure non-iterable instance")}}}(),MIN_TIMESTEP=.001,MAX_TIMESTEP=1,base64=function(mimeType,_base){return"data:"+mimeType+";base64,"+_base},lerp=function(a,b,t){return a+(b-a)*t},isIOS=function(){var isIOS=/iPad|iPhone|iPod/.test(navigator.platform);return function(){return isIOS}}(),isWebViewAndroid=function(){var isWebViewAndroid=-1!==navigator.userAgent.indexOf("Version")&&-1!==navigator.userAgent.indexOf("Android")&&-1!==navigator.userAgent.indexOf("Chrome");return function(){return isWebViewAndroid}}(),isSafari=function(){var isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);return function(){return isSafari}}(),isFirefoxAndroid=function(){var isFirefoxAndroid=-1!==navigator.userAgent.indexOf("Firefox")&&-1!==navigator.userAgent.indexOf("Android");return function(){return isFirefoxAndroid}}(),getChromeVersion=function(){var match=navigator.userAgent.match(/.*Chrome\/([0-9]+)/),value=match?parseInt(match[1],10):null;return function(){return value}}(),isChromeWithoutDeviceMotion=function(){var value=!1;if(65===getChromeVersion()){var match=navigator.userAgent.match(/.*Chrome\/([0-9\.]*)/);if(match){var _match$1$split=match[1].split("."),_match$1$split2=slicedToArray(_match$1$split,4),major=_match$1$split2[0],minor=_match$1$split2[1],branch=_match$1$split2[2],build=_match$1$split2[3];value=3325===parseInt(branch,10)&&148>parseInt(build,10)}}return function(){return value}}(),isR7=function(){var isR7=-1!==navigator.userAgent.indexOf("R7 Build");return function(){return isR7}}(),isLandscapeMode=function(){var rtn=90==window.orientation||-90==window.orientation;return isR7()?!rtn:rtn},isTimestampDeltaValid=function(timestampDeltaS){if(isNaN(timestampDeltaS)){return!1}if(timestampDeltaS<=MIN_TIMESTEP){return!1}if(timestampDeltaS>MAX_TIMESTEP){return!1}return!0},getScreenWidth=function(){return _Mathmax(window.screen.width,window.screen.height)*window.devicePixelRatio},getScreenHeight=function(){return _Mathmin(window.screen.width,window.screen.height)*window.devicePixelRatio},requestFullscreen=function(element){if(isWebViewAndroid()){return!1}if(element.requestFullscreen){element.requestFullscreen()}else if(element.webkitRequestFullscreen){element.webkitRequestFullscreen()}else if(element.mozRequestFullScreen){element.mozRequestFullScreen()}else if(element.msRequestFullscreen){element.msRequestFullscreen()}else{return!1}return!0},exitFullscreen=function(){if(document.exitFullscreen){document.exitFullscreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.msExitFullscreen){document.msExitFullscreen()}else{return!1}return!0},getFullscreenElement=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},linkProgram=function(gl,vertexSource,fragmentSource,attribLocationMap){var vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,vertexSource);gl.compileShader(vertexShader);var fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,fragmentSource);gl.compileShader(fragmentShader);var program=gl.createProgram();gl.attachShader(program,vertexShader);gl.attachShader(program,fragmentShader);for(var attribName in attribLocationMap){gl.bindAttribLocation(program,attribLocationMap[attribName],attribName)}gl.linkProgram(program);gl.deleteShader(vertexShader);gl.deleteShader(fragmentShader);return program},getProgramUniforms=function(gl,program){for(var uniforms={},uniformCount=gl.getProgramParameter(program,gl.ACTIVE_UNIFORMS),uniformName="",i=0,uniformInfo;i<uniformCount;i++){uniformInfo=gl.getActiveUniform(program,i);uniformName=uniformInfo.name.replace("[0]","");uniforms[uniformName]=gl.getUniformLocation(program,uniformName)}return uniforms},orthoMatrix=function(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out},isMobile=function(){var check=!1;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=!0})(navigator.userAgent||navigator.vendor||window.opera);return check},extend=function(dest,src){for(var key in src){if(src.hasOwnProperty(key)){dest[key]=src[key]}}return dest},safariCssSizeWorkaround=function(canvas){if(isIOS()){var width=canvas.style.width,height=canvas.style.height;canvas.style.width=parseInt(width)+1+"px";canvas.style.height=parseInt(height)+"px";setTimeout(function(){canvas.style.width=width;canvas.style.height=height},100)}window.canvas=canvas},frameDataFromPose=function(){var piOver180=_MathPI/180,rad45=.25*_MathPI;function mat4_perspectiveFromFieldOfView(out,fov,near,far){var upTan=_Mathtan(fov?fov.upDegrees*piOver180:rad45),downTan=_Mathtan(fov?fov.downDegrees*piOver180:rad45),leftTan=_Mathtan(fov?fov.leftDegrees*piOver180:rad45),rightTan=_Mathtan(fov?fov.rightDegrees*piOver180:rad45),xScale=2/(leftTan+rightTan),yScale=2/(upTan+downTan);out[0]=xScale;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=yScale;out[6]=0;out[7]=0;out[8]=-(.5*((leftTan-rightTan)*xScale));out[9]=.5*((upTan-downTan)*yScale);out[10]=far/(near-far);out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near/(near-far);out[15]=0;return out}function mat4_fromRotationTranslation(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out}function mat4_translate(out,a,v){var x=v[0],y=v[1],z=v[2],a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15]}return out}function mat4_invert(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out}var defaultOrientation=new Float32Array([0,0,0,1]),defaultPosition=new Float32Array([0,0,0]);function updateEyeMatrices(projection,view,pose,fov,offset,vrDisplay){mat4_perspectiveFromFieldOfView(projection,fov||null,vrDisplay.depthNear,vrDisplay.depthFar);var orientation=pose.orientation||defaultOrientation,position=pose.position||defaultPosition;mat4_fromRotationTranslation(view,orientation,position);if(offset)mat4_translate(view,view,offset);mat4_invert(view,view)}return function(frameData,pose,vrDisplay){if(!frameData||!pose)return!1;frameData.pose=pose;frameData.timestamp=pose.timestamp;updateEyeMatrices(frameData.leftProjectionMatrix,frameData.leftViewMatrix,pose,vrDisplay._getFieldOfView("left"),vrDisplay._getEyeOffset("left"),vrDisplay);updateEyeMatrices(frameData.rightProjectionMatrix,frameData.rightViewMatrix,pose,vrDisplay._getFieldOfView("right"),vrDisplay._getEyeOffset("right"),vrDisplay);return!0}}(),isInsideCrossOriginIFrame=function(){var isFramed=window.self!==window.top,refOrigin=getOriginFromUrl(document.referrer),thisOrigin=getOriginFromUrl(window.location.href);return isFramed&&refOrigin!==thisOrigin},getOriginFromUrl=function(url){var domainIdx,protoSepIdx=url.indexOf("://");if(-1!==protoSepIdx){domainIdx=protoSepIdx+3}else{domainIdx=0}var domainEndIdx=url.indexOf("/",domainIdx);if(-1===domainEndIdx){domainEndIdx=url.length}return url.substring(0,domainEndIdx)},getQuaternionAngle=function(quat){if(1<quat.w){console.warn("getQuaternionAngle: w > 1");return 0}var angle=2*_Mathacos(quat.w);return angle},warnOnce=function(){var observedWarnings={};return function(key,message){if(observedWarnings[key]===void 0){console.warn("webvr-polyfill: "+message);observedWarnings[key]=!0}}}(),deprecateWarning=function(deprecated,suggested){var alternative=suggested?"Please use "+suggested+" instead.":"";warnOnce(deprecated,deprecated+" has been deprecated. "+"This may not work on native WebVR displays. "+alternative)};var glPreserveState=function(gl,bindings,callback){if(!bindings){callback(gl);return}for(var boundValues=[],activeTexture=null,i=0,binding;i<bindings.length;++i){binding=bindings[i];switch(binding){case gl.TEXTURE_BINDING_2D:case gl.TEXTURE_BINDING_CUBE_MAP:var textureUnit=bindings[++i];if(textureUnit<gl.TEXTURE0||textureUnit>gl.TEXTURE31){console.error("TEXTURE_BINDING_2D or TEXTURE_BINDING_CUBE_MAP must be followed by a valid texture unit");boundValues.push(null,null);break}if(!activeTexture){activeTexture=gl.getParameter(gl.ACTIVE_TEXTURE)}gl.activeTexture(textureUnit);boundValues.push(gl.getParameter(binding),null);break;case gl.ACTIVE_TEXTURE:activeTexture=gl.getParameter(gl.ACTIVE_TEXTURE);boundValues.push(null);break;default:boundValues.push(gl.getParameter(binding));break;}}callback(gl);for(var i=0;i<bindings.length;++i){var binding=bindings[i],boundValue=boundValues[i];switch(binding){case gl.ACTIVE_TEXTURE:break;case gl.ARRAY_BUFFER_BINDING:gl.bindBuffer(gl.ARRAY_BUFFER,boundValue);break;case gl.COLOR_CLEAR_VALUE:gl.clearColor(boundValue[0],boundValue[1],boundValue[2],boundValue[3]);break;case gl.COLOR_WRITEMASK:gl.colorMask(boundValue[0],boundValue[1],boundValue[2],boundValue[3]);break;case gl.CURRENT_PROGRAM:gl.useProgram(boundValue);break;case gl.ELEMENT_ARRAY_BUFFER_BINDING:gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,boundValue);break;case gl.FRAMEBUFFER_BINDING:gl.bindFramebuffer(gl.FRAMEBUFFER,boundValue);break;case gl.RENDERBUFFER_BINDING:gl.bindRenderbuffer(gl.RENDERBUFFER,boundValue);break;case gl.TEXTURE_BINDING_2D:var textureUnit=bindings[++i];if(textureUnit<gl.TEXTURE0||textureUnit>gl.TEXTURE31)break;gl.activeTexture(textureUnit);gl.bindTexture(gl.TEXTURE_2D,boundValue);break;case gl.TEXTURE_BINDING_CUBE_MAP:var textureUnit=bindings[++i];if(textureUnit<gl.TEXTURE0||textureUnit>gl.TEXTURE31)break;gl.activeTexture(textureUnit);gl.bindTexture(gl.TEXTURE_CUBE_MAP,boundValue);break;case gl.VIEWPORT:gl.viewport(boundValue[0],boundValue[1],boundValue[2],boundValue[3]);break;case gl.BLEND:case gl.CULL_FACE:case gl.DEPTH_TEST:case gl.SCISSOR_TEST:case gl.STENCIL_TEST:if(boundValue){gl.enable(binding)}else{gl.disable(binding)}break;default:console.log("No GL restore behavior for 0x"+binding.toString(16));break;}if(activeTexture){gl.activeTexture(activeTexture)}}},distortionVS=["attribute vec2 position;","attribute vec3 texCoord;","varying vec2 vTexCoord;","uniform vec4 viewportOffsetScale[2];","void main() {","  vec4 viewport = viewportOffsetScale[int(texCoord.z)];","  vTexCoord = (texCoord.xy * viewport.zw) + viewport.xy;","  gl_Position = vec4( position, 1.0, 1.0 );","}"].join("\n"),distortionFS=["precision mediump float;","uniform sampler2D diffuse;","varying vec2 vTexCoord;","void main() {","  gl_FragColor = texture2D(diffuse, vTexCoord);","}"].join("\n");function CardboardDistorter(gl,cardboardUI,bufferScale,dirtySubmitFrameBindings){this.gl=gl;this.cardboardUI=cardboardUI;this.bufferScale=bufferScale;this.dirtySubmitFrameBindings=dirtySubmitFrameBindings;this.ctxAttribs=gl.getContextAttributes();this.meshWidth=20;this.meshHeight=20;this.bufferWidth=gl.drawingBufferWidth;this.bufferHeight=gl.drawingBufferHeight;this.realBindFramebuffer=gl.bindFramebuffer;this.realEnable=gl.enable;this.realDisable=gl.disable;this.realColorMask=gl.colorMask;this.realClearColor=gl.clearColor;this.realViewport=gl.viewport;if(!isIOS()){this.realCanvasWidth=Object.getOwnPropertyDescriptor(gl.canvas.__proto__,"width");this.realCanvasHeight=Object.getOwnPropertyDescriptor(gl.canvas.__proto__,"height")}this.isPatched=!1;this.lastBoundFramebuffer=null;this.cullFace=!1;this.depthTest=!1;this.blend=!1;this.scissorTest=!1;this.stencilTest=!1;this.viewport=[0,0,0,0];this.colorMask=[!0,!0,!0,!0];this.clearColor=[0,0,0,0];this.attribs={position:0,texCoord:1};this.program=linkProgram(gl,distortionVS,distortionFS,this.attribs);this.uniforms=getProgramUniforms(gl,this.program);this.viewportOffsetScale=new Float32Array(8);this.setTextureBounds();this.vertexBuffer=gl.createBuffer();this.indexBuffer=gl.createBuffer();this.indexCount=0;this.renderTarget=gl.createTexture();this.framebuffer=gl.createFramebuffer();this.depthStencilBuffer=null;this.depthBuffer=null;this.stencilBuffer=null;if(this.ctxAttribs.depth&&this.ctxAttribs.stencil){this.depthStencilBuffer=gl.createRenderbuffer()}else if(this.ctxAttribs.depth){this.depthBuffer=gl.createRenderbuffer()}else if(this.ctxAttribs.stencil){this.stencilBuffer=gl.createRenderbuffer()}this.patch();this.onResize()}CardboardDistorter.prototype.destroy=function(){var gl=this.gl;this.unpatch();gl.deleteProgram(this.program);gl.deleteBuffer(this.vertexBuffer);gl.deleteBuffer(this.indexBuffer);gl.deleteTexture(this.renderTarget);gl.deleteFramebuffer(this.framebuffer);if(this.depthStencilBuffer){gl.deleteRenderbuffer(this.depthStencilBuffer)}if(this.depthBuffer){gl.deleteRenderbuffer(this.depthBuffer)}if(this.stencilBuffer){gl.deleteRenderbuffer(this.stencilBuffer)}if(this.cardboardUI){this.cardboardUI.destroy()}};CardboardDistorter.prototype.onResize=function(){var gl=this.gl,self=this,glState=[gl.RENDERBUFFER_BINDING,gl.TEXTURE_BINDING_2D,gl.TEXTURE0];glPreserveState(gl,glState,function(gl){self.realBindFramebuffer.call(gl,gl.FRAMEBUFFER,null);if(self.scissorTest){self.realDisable.call(gl,gl.SCISSOR_TEST)}self.realColorMask.call(gl,!0,!0,!0,!0);self.realViewport.call(gl,0,0,gl.drawingBufferWidth,gl.drawingBufferHeight);self.realClearColor.call(gl,0,0,0,1);gl.clear(gl.COLOR_BUFFER_BIT);self.realBindFramebuffer.call(gl,gl.FRAMEBUFFER,self.framebuffer);gl.bindTexture(gl.TEXTURE_2D,self.renderTarget);gl.texImage2D(gl.TEXTURE_2D,0,self.ctxAttribs.alpha?gl.RGBA:gl.RGB,self.bufferWidth,self.bufferHeight,0,self.ctxAttribs.alpha?gl.RGBA:gl.RGB,gl.UNSIGNED_BYTE,null);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,self.renderTarget,0);if(self.ctxAttribs.depth&&self.ctxAttribs.stencil){gl.bindRenderbuffer(gl.RENDERBUFFER,self.depthStencilBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_STENCIL,self.bufferWidth,self.bufferHeight);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,self.depthStencilBuffer)}else if(self.ctxAttribs.depth){gl.bindRenderbuffer(gl.RENDERBUFFER,self.depthBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.DEPTH_COMPONENT16,self.bufferWidth,self.bufferHeight);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_ATTACHMENT,gl.RENDERBUFFER,self.depthBuffer)}else if(self.ctxAttribs.stencil){gl.bindRenderbuffer(gl.RENDERBUFFER,self.stencilBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,gl.STENCIL_INDEX8,self.bufferWidth,self.bufferHeight);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.STENCIL_ATTACHMENT,gl.RENDERBUFFER,self.stencilBuffer)}if(!gl.checkFramebufferStatus(gl.FRAMEBUFFER)===gl.FRAMEBUFFER_COMPLETE){console.error("Framebuffer incomplete!")}self.realBindFramebuffer.call(gl,gl.FRAMEBUFFER,self.lastBoundFramebuffer);if(self.scissorTest){self.realEnable.call(gl,gl.SCISSOR_TEST)}self.realColorMask.apply(gl,self.colorMask);self.realViewport.apply(gl,self.viewport);self.realClearColor.apply(gl,self.clearColor)});if(this.cardboardUI){this.cardboardUI.onResize()}};CardboardDistorter.prototype.patch=function(){if(this.isPatched){return}var self=this,canvas=this.gl.canvas,gl=this.gl;if(!isIOS()){canvas.width=getScreenWidth()*this.bufferScale;canvas.height=getScreenHeight()*this.bufferScale;Object.defineProperty(canvas,"width",{configurable:!0,enumerable:!0,get:function(){return self.bufferWidth},set:function(value){self.bufferWidth=value;self.realCanvasWidth.set.call(canvas,value);self.onResize()}});Object.defineProperty(canvas,"height",{configurable:!0,enumerable:!0,get:function(){return self.bufferHeight},set:function(value){self.bufferHeight=value;self.realCanvasHeight.set.call(canvas,value);self.onResize()}})}this.lastBoundFramebuffer=gl.getParameter(gl.FRAMEBUFFER_BINDING);if(null==this.lastBoundFramebuffer){this.lastBoundFramebuffer=this.framebuffer;this.gl.bindFramebuffer(gl.FRAMEBUFFER,this.framebuffer)}this.gl.bindFramebuffer=function(target,framebuffer){self.lastBoundFramebuffer=framebuffer?framebuffer:self.framebuffer;self.realBindFramebuffer.call(gl,target,self.lastBoundFramebuffer)};this.cullFace=gl.getParameter(gl.CULL_FACE);this.depthTest=gl.getParameter(gl.DEPTH_TEST);this.blend=gl.getParameter(gl.BLEND);this.scissorTest=gl.getParameter(gl.SCISSOR_TEST);this.stencilTest=gl.getParameter(gl.STENCIL_TEST);gl.enable=function(pname){switch(pname){case gl.CULL_FACE:self.cullFace=!0;break;case gl.DEPTH_TEST:self.depthTest=!0;break;case gl.BLEND:self.blend=!0;break;case gl.SCISSOR_TEST:self.scissorTest=!0;break;case gl.STENCIL_TEST:self.stencilTest=!0;break;}self.realEnable.call(gl,pname)};gl.disable=function(pname){switch(pname){case gl.CULL_FACE:self.cullFace=!1;break;case gl.DEPTH_TEST:self.depthTest=!1;break;case gl.BLEND:self.blend=!1;break;case gl.SCISSOR_TEST:self.scissorTest=!1;break;case gl.STENCIL_TEST:self.stencilTest=!1;break;}self.realDisable.call(gl,pname)};this.colorMask=gl.getParameter(gl.COLOR_WRITEMASK);gl.colorMask=function(r,g,b,a){self.colorMask[0]=r;self.colorMask[1]=g;self.colorMask[2]=b;self.colorMask[3]=a;self.realColorMask.call(gl,r,g,b,a)};this.clearColor=gl.getParameter(gl.COLOR_CLEAR_VALUE);gl.clearColor=function(r,g,b,a){self.clearColor[0]=r;self.clearColor[1]=g;self.clearColor[2]=b;self.clearColor[3]=a;self.realClearColor.call(gl,r,g,b,a)};this.viewport=gl.getParameter(gl.VIEWPORT);gl.viewport=function(x,y,w,h){self.viewport[0]=x;self.viewport[1]=y;self.viewport[2]=w;self.viewport[3]=h;self.realViewport.call(gl,x,y,w,h)};this.isPatched=!0;safariCssSizeWorkaround(canvas)};CardboardDistorter.prototype.unpatch=function(){if(!this.isPatched){return}var gl=this.gl,canvas=this.gl.canvas;if(!isIOS()){Object.defineProperty(canvas,"width",this.realCanvasWidth);Object.defineProperty(canvas,"height",this.realCanvasHeight)}canvas.width=this.bufferWidth;canvas.height=this.bufferHeight;gl.bindFramebuffer=this.realBindFramebuffer;gl.enable=this.realEnable;gl.disable=this.realDisable;gl.colorMask=this.realColorMask;gl.clearColor=this.realClearColor;gl.viewport=this.realViewport;if(this.lastBoundFramebuffer==this.framebuffer){gl.bindFramebuffer(gl.FRAMEBUFFER,null)}this.isPatched=!1;setTimeout(function(){safariCssSizeWorkaround(canvas)},1)};CardboardDistorter.prototype.setTextureBounds=function(leftBounds,rightBounds){if(!leftBounds){leftBounds=[0,0,.5,1]}if(!rightBounds){rightBounds=[.5,0,.5,1]}this.viewportOffsetScale[0]=leftBounds[0];this.viewportOffsetScale[1]=leftBounds[1];this.viewportOffsetScale[2]=leftBounds[2];this.viewportOffsetScale[3]=leftBounds[3];this.viewportOffsetScale[4]=rightBounds[0];this.viewportOffsetScale[5]=rightBounds[1];this.viewportOffsetScale[6]=rightBounds[2];this.viewportOffsetScale[7]=rightBounds[3]};CardboardDistorter.prototype.submitFrame=function(){var gl=this.gl,self=this,glState=[];if(!this.dirtySubmitFrameBindings){glState.push(gl.CURRENT_PROGRAM,gl.ARRAY_BUFFER_BINDING,gl.ELEMENT_ARRAY_BUFFER_BINDING,gl.TEXTURE_BINDING_2D,gl.TEXTURE0)}glPreserveState(gl,glState,function(gl){self.realBindFramebuffer.call(gl,gl.FRAMEBUFFER,null);if(self.cullFace){self.realDisable.call(gl,gl.CULL_FACE)}if(self.depthTest){self.realDisable.call(gl,gl.DEPTH_TEST)}if(self.blend){self.realDisable.call(gl,gl.BLEND)}if(self.scissorTest){self.realDisable.call(gl,gl.SCISSOR_TEST)}if(self.stencilTest){self.realDisable.call(gl,gl.STENCIL_TEST)}self.realColorMask.call(gl,!0,!0,!0,!0);self.realViewport.call(gl,0,0,gl.drawingBufferWidth,gl.drawingBufferHeight);if(self.ctxAttribs.alpha||isIOS()){self.realClearColor.call(gl,0,0,0,1);gl.clear(gl.COLOR_BUFFER_BIT)}gl.useProgram(self.program);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.indexBuffer);gl.bindBuffer(gl.ARRAY_BUFFER,self.vertexBuffer);gl.enableVertexAttribArray(self.attribs.position);gl.enableVertexAttribArray(self.attribs.texCoord);gl.vertexAttribPointer(self.attribs.position,2,gl.FLOAT,!1,20,0);gl.vertexAttribPointer(self.attribs.texCoord,3,gl.FLOAT,!1,20,8);gl.activeTexture(gl.TEXTURE0);gl.uniform1i(self.uniforms.diffuse,0);gl.bindTexture(gl.TEXTURE_2D,self.renderTarget);gl.uniform4fv(self.uniforms.viewportOffsetScale,self.viewportOffsetScale);gl.drawElements(gl.TRIANGLES,self.indexCount,gl.UNSIGNED_SHORT,0);if(self.cardboardUI){self.cardboardUI.renderNoState()}self.realBindFramebuffer.call(self.gl,gl.FRAMEBUFFER,self.framebuffer);if(!self.ctxAttribs.preserveDrawingBuffer){self.realClearColor.call(gl,0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT)}if(!self.dirtySubmitFrameBindings){self.realBindFramebuffer.call(gl,gl.FRAMEBUFFER,self.lastBoundFramebuffer)}if(self.cullFace){self.realEnable.call(gl,gl.CULL_FACE)}if(self.depthTest){self.realEnable.call(gl,gl.DEPTH_TEST)}if(self.blend){self.realEnable.call(gl,gl.BLEND)}if(self.scissorTest){self.realEnable.call(gl,gl.SCISSOR_TEST)}if(self.stencilTest){self.realEnable.call(gl,gl.STENCIL_TEST)}self.realColorMask.apply(gl,self.colorMask);self.realViewport.apply(gl,self.viewport);if(self.ctxAttribs.alpha||!self.ctxAttribs.preserveDrawingBuffer){self.realClearColor.apply(gl,self.clearColor)}});if(isIOS()){var canvas=gl.canvas;if(canvas.width!=self.bufferWidth||canvas.height!=self.bufferHeight){self.bufferWidth=canvas.width;self.bufferHeight=canvas.height;self.onResize()}}};CardboardDistorter.prototype.updateDeviceInfo=function(deviceInfo){var gl=this.gl,self=this,glState=[gl.ARRAY_BUFFER_BINDING,gl.ELEMENT_ARRAY_BUFFER_BINDING];glPreserveState(gl,glState,function(gl){var vertices=self.computeMeshVertices_(self.meshWidth,self.meshHeight,deviceInfo);gl.bindBuffer(gl.ARRAY_BUFFER,self.vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,vertices,gl.STATIC_DRAW);if(!self.indexCount){var indices=self.computeMeshIndices_(self.meshWidth,self.meshHeight);gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,self.indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,indices,gl.STATIC_DRAW);self.indexCount=indices.length}})};CardboardDistorter.prototype.computeMeshVertices_=function(width,height,deviceInfo){for(var vertices=new Float32Array(5*(2*width*height)),lensFrustum=deviceInfo.getLeftEyeVisibleTanAngles(),noLensFrustum=deviceInfo.getLeftEyeNoLensTanAngles(),viewport=deviceInfo.getLeftEyeVisibleScreenRect(noLensFrustum),vidx=0,e=0;2>e;e++){for(var j=0;j<height;j++){for(var i=0;i<width;i++,vidx++){var u=i/(width-1),v=j/(height-1),s=u,t=v,x=lerp(lensFrustum[0],lensFrustum[2],u),y=lerp(lensFrustum[3],lensFrustum[1],v),d=_Mathsqrt(x*x+y*y),r=deviceInfo.distortion.distortInverse(d);u=(x*r/d-noLensFrustum[0])/(noLensFrustum[2]-noLensFrustum[0]);v=(y*r/d-noLensFrustum[3])/(noLensFrustum[1]-noLensFrustum[3]);u=2*(viewport.x+u*viewport.width-.5);v=2*(viewport.y+v*viewport.height-.5);vertices[5*vidx+0]=u;vertices[5*vidx+1]=v;vertices[5*vidx+2]=s;vertices[5*vidx+3]=t;vertices[5*vidx+4]=e}}var w=lensFrustum[2]-lensFrustum[0];lensFrustum[0]=-(w+lensFrustum[0]);lensFrustum[2]=w-lensFrustum[2];w=noLensFrustum[2]-noLensFrustum[0];noLensFrustum[0]=-(w+noLensFrustum[0]);noLensFrustum[2]=w-noLensFrustum[2];viewport.x=1-(viewport.x+viewport.width)}return vertices};CardboardDistorter.prototype.computeMeshIndices_=function(width,height){for(var indices=new Uint16Array(6*(2*(width-1)*(height-1))),vidx=0,iidx=0,e=0;2>e;e++){for(var j=0;j<height;j++){for(var i=0;i<width;i++,vidx++){if(0==i||0==j)continue;if(i<=width/2==j<=height/2){indices[iidx++]=vidx;indices[iidx++]=vidx-width-1;indices[iidx++]=vidx-width;indices[iidx++]=vidx-width-1;indices[iidx++]=vidx;indices[iidx++]=vidx-1}else{indices[iidx++]=vidx-1;indices[iidx++]=vidx-width;indices[iidx++]=vidx;indices[iidx++]=vidx-width;indices[iidx++]=vidx-1;indices[iidx++]=vidx-width-1}}}}return indices};CardboardDistorter.prototype.getOwnPropertyDescriptor_=function(proto,attrName){var descriptor=Object.getOwnPropertyDescriptor(proto,attrName);if(descriptor.get===void 0||descriptor.set===void 0){descriptor.configurable=!0;descriptor.enumerable=!0;descriptor.get=function(){return this.getAttribute(attrName)};descriptor.set=function(val){this.setAttribute(attrName,val)}}return descriptor};var uiVS=["attribute vec2 position;","uniform mat4 projectionMat;","void main() {","  gl_Position = projectionMat * vec4( position, -1.0, 1.0 );","}"].join("\n"),uiFS=["precision mediump float;","uniform vec4 color;","void main() {","  gl_FragColor = color;","}"].join("\n"),DEG2RAD=_MathPI/180,kAnglePerGearSection=60,kOuterRimEndAngle=12,kInnerRimBeginAngle=20,kOuterRadius=1,kMiddleRadius=.75,kInnerRadius=.3125,kButtonWidthDp=28,kTouchSlopFactor=1.5;function CardboardUI(gl){this.gl=gl;this.attribs={position:0};this.program=linkProgram(gl,uiVS,uiFS,this.attribs);this.uniforms=getProgramUniforms(gl,this.program);this.vertexBuffer=gl.createBuffer();this.gearOffset=0;this.gearVertexCount=0;this.arrowOffset=0;this.arrowVertexCount=0;this.projMat=new Float32Array(16);this.listener=null;this.onResize()}CardboardUI.prototype.destroy=function(){var gl=this.gl;if(this.listener){gl.canvas.removeEventListener("click",this.listener,!1)}gl.deleteProgram(this.program);gl.deleteBuffer(this.vertexBuffer)};CardboardUI.prototype.listen=function(optionsCallback,backCallback){var canvas=this.gl.canvas;this.listener=function(event){var midline=canvas.clientWidth/2,buttonSize=kButtonWidthDp*kTouchSlopFactor;if(event.clientX>midline-buttonSize&&event.clientX<midline+buttonSize&&event.clientY>canvas.clientHeight-buttonSize){optionsCallback(event)}else if(event.clientX<buttonSize&&event.clientY<buttonSize){backCallback(event)}};canvas.addEventListener("click",this.listener,!1)};CardboardUI.prototype.onResize=function(){var gl=this.gl,self=this,glState=[gl.ARRAY_BUFFER_BINDING];glPreserveState(gl,glState,function(gl){var vertices=[],midline=gl.drawingBufferWidth/2,physicalPixels=_Mathmax(screen.width,screen.height)*window.devicePixelRatio,scalingRatio=gl.drawingBufferWidth/physicalPixels,dps=scalingRatio*window.devicePixelRatio,lineWidth=4*dps/2,buttonSize=kButtonWidthDp*kTouchSlopFactor*dps,buttonScale=kButtonWidthDp*dps/2,buttonBorder=(kButtonWidthDp*kTouchSlopFactor-kButtonWidthDp)*dps;vertices.push(midline-lineWidth,buttonSize);vertices.push(midline-lineWidth,gl.drawingBufferHeight);vertices.push(midline+lineWidth,buttonSize);vertices.push(midline+lineWidth,gl.drawingBufferHeight);self.gearOffset=vertices.length/2;function addGearSegment(theta,r){var angle=(90-theta)*DEG2RAD,x=_Mathcos(angle),y=_Mathsin(angle);vertices.push(kInnerRadius*x*buttonScale+midline,kInnerRadius*y*buttonScale+buttonScale);vertices.push(r*x*buttonScale+midline,r*y*buttonScale+buttonScale)}for(var i=0,segmentTheta;6>=i;i++){segmentTheta=i*kAnglePerGearSection;addGearSegment(segmentTheta,kOuterRadius);addGearSegment(segmentTheta+kOuterRimEndAngle,kOuterRadius);addGearSegment(segmentTheta+kInnerRimBeginAngle,kMiddleRadius);addGearSegment(segmentTheta+(kAnglePerGearSection-kInnerRimBeginAngle),kMiddleRadius);addGearSegment(segmentTheta+(kAnglePerGearSection-kOuterRimEndAngle),kOuterRadius)}self.gearVertexCount=vertices.length/2-self.gearOffset;self.arrowOffset=vertices.length/2;function addArrowVertex(x,y){vertices.push(buttonBorder+x,gl.drawingBufferHeight-buttonBorder-y)}var angledLineWidth=lineWidth/_Mathsin(45*DEG2RAD);addArrowVertex(0,buttonScale);addArrowVertex(buttonScale,0);addArrowVertex(buttonScale+angledLineWidth,angledLineWidth);addArrowVertex(angledLineWidth,buttonScale+angledLineWidth);addArrowVertex(angledLineWidth,buttonScale-angledLineWidth);addArrowVertex(0,buttonScale);addArrowVertex(buttonScale,2*buttonScale);addArrowVertex(buttonScale+angledLineWidth,2*buttonScale-angledLineWidth);addArrowVertex(angledLineWidth,buttonScale-angledLineWidth);addArrowVertex(0,buttonScale);addArrowVertex(angledLineWidth,buttonScale-lineWidth);addArrowVertex(kButtonWidthDp*dps,buttonScale-lineWidth);addArrowVertex(angledLineWidth,buttonScale+lineWidth);addArrowVertex(kButtonWidthDp*dps,buttonScale+lineWidth);self.arrowVertexCount=vertices.length/2-self.arrowOffset;gl.bindBuffer(gl.ARRAY_BUFFER,self.vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,new Float32Array(vertices),gl.STATIC_DRAW)})};CardboardUI.prototype.render=function(){var gl=this.gl,self=this,glState=[gl.CULL_FACE,gl.DEPTH_TEST,gl.BLEND,gl.SCISSOR_TEST,gl.STENCIL_TEST,gl.COLOR_WRITEMASK,gl.VIEWPORT,gl.CURRENT_PROGRAM,gl.ARRAY_BUFFER_BINDING];glPreserveState(gl,glState,function(gl){gl.disable(gl.CULL_FACE);gl.disable(gl.DEPTH_TEST);gl.disable(gl.BLEND);gl.disable(gl.SCISSOR_TEST);gl.disable(gl.STENCIL_TEST);gl.colorMask(!0,!0,!0,!0);gl.viewport(0,0,gl.drawingBufferWidth,gl.drawingBufferHeight);self.renderNoState()})};CardboardUI.prototype.renderNoState=function(){var gl=this.gl;gl.useProgram(this.program);gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);gl.enableVertexAttribArray(this.attribs.position);gl.vertexAttribPointer(this.attribs.position,2,gl.FLOAT,!1,8,0);gl.uniform4f(this.uniforms.color,1,1,1,1);orthoMatrix(this.projMat,0,gl.drawingBufferWidth,0,gl.drawingBufferHeight,.1,1024);gl.uniformMatrix4fv(this.uniforms.projectionMat,!1,this.projMat);gl.drawArrays(gl.TRIANGLE_STRIP,0,4);gl.drawArrays(gl.TRIANGLE_STRIP,this.gearOffset,this.gearVertexCount);gl.drawArrays(gl.TRIANGLE_STRIP,this.arrowOffset,this.arrowVertexCount)};function Distortion(coefficients){this.coefficients=coefficients}Distortion.prototype.distortInverse=function(radius){var r0=0,r1=1,dr0=radius-this.distort(r0);while(1e-4<_Mathabs(r1-r0)){var dr1=radius-this.distort(r1),r2=r1-dr1*((r1-r0)/(dr1-dr0));r0=r1;r1=r2;dr0=dr1}return r1};Distortion.prototype.distort=function(radius){for(var ret=0,i=0;i<this.coefficients.length;i++){ret=radius*radius*(ret+this.coefficients[i])}return(ret+1)*radius};var degToRad=_MathPI/180,radToDeg=180/_MathPI,Vector3=function(x,y,z){this.x=x||0;this.y=y||0;this.z=z||0};Vector3.prototype={constructor:Vector3,set:function(x,y,z){this.x=x;this.y=y;this.z=z;return this},copy:function(v){this.x=v.x;this.y=v.y;this.z=v.z;return this},length:function(){return _Mathsqrt(this.x*this.x+this.y*this.y+this.z*this.z)},normalize:function(){var scalar=this.length();if(0!==scalar){this.multiplyScalar(1/scalar)}else{this.x=0;this.y=0;this.z=0}return this},multiplyScalar:function(scalar){this.x*=scalar;this.y*=scalar;this.z*=scalar},applyQuaternion:function(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z},crossVectors:function(a,b){var ax=a.x,ay=a.y,az=a.z,bx=b.x,by=b.y,bz=b.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this}};var Quaternion=function(x,y,z,w){this.x=x||0;this.y=y||0;this.z=z||0;this.w=w!==void 0?w:1};Quaternion.prototype={constructor:Quaternion,set:function(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;return this},copy:function(quaternion){this.x=quaternion.x;this.y=quaternion.y;this.z=quaternion.z;this.w=quaternion.w;return this},setFromEulerXYZ:function(x,y,z){var c1=_Mathcos(x/2),c2=_Mathcos(y/2),c3=_Mathcos(z/2),s1=_Mathsin(x/2),s2=_Mathsin(y/2),s3=_Mathsin(z/2);this.x=s1*c2*c3+c1*s2*s3;this.y=c1*s2*c3-s1*c2*s3;this.z=c1*c2*s3+s1*s2*c3;this.w=c1*c2*c3-s1*s2*s3;return this},setFromEulerYXZ:function(x,y,z){var c1=_Mathcos(x/2),c2=_Mathcos(y/2),c3=_Mathcos(z/2),s1=_Mathsin(x/2),s2=_Mathsin(y/2),s3=_Mathsin(z/2);this.x=s1*c2*c3+c1*s2*s3;this.y=c1*s2*c3-s1*c2*s3;this.z=c1*c2*s3-s1*s2*c3;this.w=c1*c2*c3+s1*s2*s3;return this},setFromAxisAngle:function(axis,angle){var halfAngle=angle/2,s=_Mathsin(halfAngle);this.x=axis.x*s;this.y=axis.y*s;this.z=axis.z*s;this.w=_Mathcos(halfAngle);return this},multiply:function(q){return this.multiplyQuaternions(this,q)},multiplyQuaternions:function(a,b){var qax=a.x,qay=a.y,qaz=a.z,qaw=a.w,qbx=b.x,qby=b.y,qbz=b.z,qbw=b.w;this.x=qax*qbw+qaw*qbx+qay*qbz-qaz*qby;this.y=qay*qbw+qaw*qby+qaz*qbx-qax*qbz;this.z=qaz*qbw+qaw*qbz+qax*qby-qay*qbx;this.w=qaw*qbw-qax*qbx-qay*qby-qaz*qbz;return this},inverse:function(){this.x*=-1;this.y*=-1;this.z*=-1;this.normalize();return this},normalize:function(){var l=_Mathsqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w);if(0===l){this.x=0;this.y=0;this.z=0;this.w=1}else{l=1/l;this.x=this.x*l;this.y=this.y*l;this.z=this.z*l;this.w=this.w*l}return this},slerp:function(qb,t){if(0===t)return this;if(1===t)return this.copy(qb);var x=this.x,y=this.y,z=this.z,w=this.w,cosHalfTheta=w*qb.w+x*qb.x+y*qb.y+z*qb.z;if(0>cosHalfTheta){this.w=-qb.w;this.x=-qb.x;this.y=-qb.y;this.z=-qb.z;cosHalfTheta=-cosHalfTheta}else{this.copy(qb)}if(1<=cosHalfTheta){this.w=w;this.x=x;this.y=y;this.z=z;return this}var halfTheta=_Mathacos(cosHalfTheta),sinHalfTheta=_Mathsqrt(1-cosHalfTheta*cosHalfTheta);if(.001>_Mathabs(sinHalfTheta)){this.w=.5*(w+this.w);this.x=.5*(x+this.x);this.y=.5*(y+this.y);this.z=.5*(z+this.z);return this}var ratioA=_Mathsin((1-t)*halfTheta)/sinHalfTheta,ratioB=_Mathsin(t*halfTheta)/sinHalfTheta;this.w=w*ratioA+this.w*ratioB;this.x=x*ratioA+this.x*ratioB;this.y=y*ratioA+this.y*ratioB;this.z=z*ratioA+this.z*ratioB;return this},setFromUnitVectors:function(){var v1,r;return function(vFrom,vTo){if(v1===void 0)v1=new Vector3;r=vFrom.dot(vTo)+1;if(r<1e-6){r=0;if(_Mathabs(vFrom.x)>_Mathabs(vFrom.z)){v1.set(-vFrom.y,vFrom.x,0)}else{v1.set(0,-vFrom.z,vFrom.y)}}else{v1.crossVectors(vFrom,vTo)}this.x=v1.x;this.y=v1.y;this.z=v1.z;this.w=r;this.normalize();return this}}()};function Device(params){this.width=params.width||getScreenWidth();this.height=params.height||getScreenHeight();this.widthMeters=params.widthMeters;this.heightMeters=params.heightMeters;this.bevelMeters=params.bevelMeters}var DEFAULT_ANDROID=new Device({widthMeters:.11,heightMeters:.062,bevelMeters:.004}),DEFAULT_IOS=new Device({widthMeters:.1038,heightMeters:.0584,bevelMeters:.004}),Viewers={CardboardV1:new CardboardViewer({id:"CardboardV1",label:"Cardboard I/O 2014",fov:40,interLensDistance:.06,baselineLensDistance:.035,screenLensDistance:.042,distortionCoefficients:[.441,.156],inverseCoefficients:[-.4410035,.42756155,-.4804439,.5460139,-.58821183,.5733938,-.48303202,.33299083,-.17573841,.0651772,-.01488963,.001559834]}),CardboardV2:new CardboardViewer({id:"CardboardV2",label:"Cardboard I/O 2015",fov:60,interLensDistance:.064,baselineLensDistance:.035,screenLensDistance:.039,distortionCoefficients:[.34,.55],inverseCoefficients:[-.33836704,-.18162185,.862655,-1.2462051,1.0560602,-.58208317,.21609078,-.05444823,.009177956,-9.904169E-4,6.183535E-5,-1.6981803E-6]})};function DeviceInfo(deviceParams){this.viewer=Viewers.CardboardV2;this.updateDeviceParams(deviceParams);this.distortion=new Distortion(this.viewer.distortionCoefficients)}DeviceInfo.prototype.updateDeviceParams=function(deviceParams){this.device=this.determineDevice_(deviceParams)||this.device};DeviceInfo.prototype.getDevice=function(){return this.device};DeviceInfo.prototype.setViewer=function(viewer){this.viewer=viewer;this.distortion=new Distortion(this.viewer.distortionCoefficients)};DeviceInfo.prototype.determineDevice_=function(deviceParams){if(!deviceParams){if(isIOS()){console.warn("Using fallback iOS device measurements.");return DEFAULT_IOS}else{console.warn("Using fallback Android device measurements.");return DEFAULT_ANDROID}}var METERS_PER_INCH=.0254,metersPerPixelX=METERS_PER_INCH/deviceParams.xdpi,metersPerPixelY=METERS_PER_INCH/deviceParams.ydpi,width=getScreenWidth(),height=getScreenHeight();return new Device({widthMeters:metersPerPixelX*width,heightMeters:metersPerPixelY*height,bevelMeters:.001*deviceParams.bevelMm})};DeviceInfo.prototype.getDistortedFieldOfViewLeftEye=function(){var viewer=this.viewer,device=this.device,distortion=this.distortion,eyeToScreenDistance=viewer.screenLensDistance,outerDist=(device.widthMeters-viewer.interLensDistance)/2,innerDist=viewer.interLensDistance/2,bottomDist=viewer.baselineLensDistance-device.bevelMeters,topDist=device.heightMeters-bottomDist,outerAngle=radToDeg*_Mathatan2(distortion.distort(outerDist/eyeToScreenDistance)),innerAngle=radToDeg*_Mathatan2(distortion.distort(innerDist/eyeToScreenDistance)),bottomAngle=radToDeg*_Mathatan2(distortion.distort(bottomDist/eyeToScreenDistance)),topAngle=radToDeg*_Mathatan2(distortion.distort(topDist/eyeToScreenDistance));return{leftDegrees:_Mathmin(outerAngle,viewer.fov),rightDegrees:_Mathmin(innerAngle,viewer.fov),downDegrees:_Mathmin(bottomAngle,viewer.fov),upDegrees:_Mathmin(topAngle,viewer.fov)}};DeviceInfo.prototype.getLeftEyeVisibleTanAngles=function(){var viewer=this.viewer,device=this.device,distortion=this.distortion,fovLeft=_Mathtan(-degToRad*viewer.fov),fovTop=_Mathtan(degToRad*viewer.fov),fovRight=_Mathtan(degToRad*viewer.fov),fovBottom=_Mathtan(-degToRad*viewer.fov),halfWidth=device.widthMeters/4,halfHeight=device.heightMeters/2,verticalLensOffset=viewer.baselineLensDistance-device.bevelMeters-halfHeight,centerX=viewer.interLensDistance/2-halfWidth,centerY=-verticalLensOffset,centerZ=viewer.screenLensDistance,screenLeft=distortion.distort((centerX-halfWidth)/centerZ),screenTop=distortion.distort((centerY+halfHeight)/centerZ),screenRight=distortion.distort((centerX+halfWidth)/centerZ),screenBottom=distortion.distort((centerY-halfHeight)/centerZ),result=new Float32Array(4);result[0]=_Mathmax(fovLeft,screenLeft);result[1]=_Mathmin(fovTop,screenTop);result[2]=_Mathmin(fovRight,screenRight);result[3]=_Mathmax(fovBottom,screenBottom);return result};DeviceInfo.prototype.getLeftEyeNoLensTanAngles=function(){var viewer=this.viewer,device=this.device,distortion=this.distortion,result=new Float32Array(4),fovLeft=distortion.distortInverse(_Mathtan(-degToRad*viewer.fov)),fovTop=distortion.distortInverse(_Mathtan(degToRad*viewer.fov)),fovRight=distortion.distortInverse(_Mathtan(degToRad*viewer.fov)),fovBottom=distortion.distortInverse(_Mathtan(-degToRad*viewer.fov)),halfWidth=device.widthMeters/4,halfHeight=device.heightMeters/2,verticalLensOffset=viewer.baselineLensDistance-device.bevelMeters-halfHeight,centerX=viewer.interLensDistance/2-halfWidth,centerY=-verticalLensOffset,centerZ=viewer.screenLensDistance;result[0]=_Mathmax(fovLeft,(centerX-halfWidth)/centerZ);result[1]=_Mathmin(fovTop,(centerY+halfHeight)/centerZ);result[2]=_Mathmin(fovRight,(centerX+halfWidth)/centerZ);result[3]=_Mathmax(fovBottom,(centerY-halfHeight)/centerZ);return result};DeviceInfo.prototype.getLeftEyeVisibleScreenRect=function(undistortedFrustum){var viewer=this.viewer,device=this.device,dist=viewer.screenLensDistance,eyeX=(device.widthMeters-viewer.interLensDistance)/2,eyeY=viewer.baselineLensDistance-device.bevelMeters,left=(undistortedFrustum[0]*dist+eyeX)/device.widthMeters,top=(undistortedFrustum[1]*dist+eyeY)/device.heightMeters,right=(undistortedFrustum[2]*dist+eyeX)/device.widthMeters,bottom=(undistortedFrustum[3]*dist+eyeY)/device.heightMeters;return{x:left,y:bottom,width:right-left,height:top-bottom}};DeviceInfo.prototype.getFieldOfViewLeftEye=function(opt_isUndistorted){return opt_isUndistorted?this.getUndistortedFieldOfViewLeftEye():this.getDistortedFieldOfViewLeftEye()};DeviceInfo.prototype.getFieldOfViewRightEye=function(opt_isUndistorted){var fov=this.getFieldOfViewLeftEye(opt_isUndistorted);return{leftDegrees:fov.rightDegrees,rightDegrees:fov.leftDegrees,upDegrees:fov.upDegrees,downDegrees:fov.downDegrees}};DeviceInfo.prototype.getUndistortedFieldOfViewLeftEye=function(){var p=this.getUndistortedParams_();return{leftDegrees:radToDeg*_Mathatan2(p.outerDist),rightDegrees:radToDeg*_Mathatan2(p.innerDist),downDegrees:radToDeg*_Mathatan2(p.bottomDist),upDegrees:radToDeg*_Mathatan2(p.topDist)}};DeviceInfo.prototype.getUndistortedViewportLeftEye=function(){var p=this.getUndistortedParams_(),viewer=this.viewer,device=this.device,eyeToScreenDistance=viewer.screenLensDistance,screenWidth=device.widthMeters/eyeToScreenDistance,screenHeight=device.heightMeters/eyeToScreenDistance,xPxPerTanAngle=device.width/screenWidth,yPxPerTanAngle=device.height/screenHeight,x=_Mathround((p.eyePosX-p.outerDist)*xPxPerTanAngle),y=_Mathround((p.eyePosY-p.bottomDist)*yPxPerTanAngle);return{x:x,y:y,width:_Mathround((p.eyePosX+p.innerDist)*xPxPerTanAngle)-x,height:_Mathround((p.eyePosY+p.topDist)*yPxPerTanAngle)-y}};DeviceInfo.prototype.getUndistortedParams_=function(){var viewer=this.viewer,device=this.device,distortion=this.distortion,eyeToScreenDistance=viewer.screenLensDistance,halfLensDistance=viewer.interLensDistance/2/eyeToScreenDistance,screenWidth=device.widthMeters/eyeToScreenDistance,screenHeight=device.heightMeters/eyeToScreenDistance,eyePosX=screenWidth/2-halfLensDistance,eyePosY=(viewer.baselineLensDistance-device.bevelMeters)/eyeToScreenDistance,maxFov=viewer.fov,viewerMax=distortion.distortInverse(_Mathtan(degToRad*maxFov)),outerDist=_Mathmin(eyePosX,viewerMax),innerDist=_Mathmin(halfLensDistance,viewerMax),bottomDist=_Mathmin(eyePosY,viewerMax),topDist=_Mathmin(screenHeight-eyePosY,viewerMax);return{outerDist:outerDist,innerDist:innerDist,topDist:topDist,bottomDist:bottomDist,eyePosX:eyePosX,eyePosY:eyePosY}};function CardboardViewer(params){this.id=params.id;this.label=params.label;this.fov=params.fov;this.interLensDistance=params.interLensDistance;this.baselineLensDistance=params.baselineLensDistance;this.screenLensDistance=params.screenLensDistance;this.distortionCoefficients=params.distortionCoefficients;this.inverseCoefficients=params.inverseCoefficients}DeviceInfo.Viewers=Viewers;var DPDB_CACHE={format:1,last_updated:"2018-02-20T22:55:10Z",devices:[{type:"android",rules:[{mdmh:"asus/*/Nexus 7/*"},{ua:"Nexus 7"}],dpi:[320.8,323],bw:3,ac:500},{type:"android",rules:[{mdmh:"asus/*/ASUS_Z00AD/*"},{ua:"ASUS_Z00AD"}],dpi:[403,404.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel XL/*"},{ua:"Pixel XL"}],dpi:[537.9,533],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Google/*/Pixel/*"},{ua:"Pixel"}],dpi:[432.6,436.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC6435LVW/*"},{ua:"HTC6435LVW"}],dpi:[449.7,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"HTC/*/HTC One XL/*"},{ua:"HTC One XL"}],dpi:[315.3,314.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"htc/*/Nexus 9/*"},{ua:"Nexus 9"}],dpi:289,bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One M9/*"},{ua:"HTC One M9"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One_M8/*"},{ua:"HTC One_M8"}],dpi:[449.7,447.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"HTC/*/HTC One/*"},{ua:"HTC One"}],dpi:472.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Huawei/*/Nexus 6P/*"},{ua:"Nexus 6P"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LENOVO/*/Lenovo PB2-690Y/*"},{ua:"Lenovo PB2-690Y"}],dpi:[457.2,454.713],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5X/*"},{ua:"Nexus 5X"}],dpi:[422,419.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS345/*"},{ua:"LGMS345"}],dpi:[221.7,219.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D800/*"},{ua:"LG-D800"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/LG-D850/*"},{ua:"LG-D850"}],dpi:[537.9,541.9],bw:3,ac:500},{type:"android",rules:[{mdmh:"LGE/*/VS985 4G/*"},{ua:"VS985 4G"}],dpi:[537.9,535.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 5/*"},{ua:"Nexus 5 B"}],dpi:[442.4,444.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/Nexus 4/*"},{ua:"Nexus 4"}],dpi:[319.8,318.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LG-P769/*"},{ua:"LG-P769"}],dpi:[240.6,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGMS323/*"},{ua:"LGMS323"}],dpi:[206.6,204.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"LGE/*/LGLS996/*"},{ua:"LGLS996"}],dpi:[403.4,401.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/4560MMX/*"},{ua:"4560MMX"}],dpi:[240,219.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/A250/*"},{ua:"Micromax A250"}],dpi:[480,446.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Micromax/*/Micromax AQ4501/*"},{ua:"Micromax AQ4501"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/G5/*"},{ua:"Moto G (5) Plus"}],dpi:[403.4,403],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/DROID RAZR/*"},{ua:"DROID RAZR"}],dpi:[368.1,256.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT830C/*"},{ua:"XT830C"}],dpi:[254,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1021/*"},{ua:"XT1021"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1023/*"},{ua:"XT1023"}],dpi:[254,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1028/*"},{ua:"XT1028"}],dpi:[326.6,327.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1034/*"},{ua:"XT1034"}],dpi:[326.6,328.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1053/*"},{ua:"XT1053"}],dpi:[315.3,316.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1562/*"},{ua:"XT1562"}],dpi:[403.4,402.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/Nexus 6/*"},{ua:"Nexus 6 B"}],dpi:[494.3,489.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1063/*"},{ua:"XT1063"}],dpi:[295,296.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/XT1064/*"},{ua:"XT1064"}],dpi:[295,295.6],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1092/*"},{ua:"XT1092"}],dpi:[422,424.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"motorola/*/XT1095/*"},{ua:"XT1095"}],dpi:[422,423.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"motorola/*/G4/*"},{ua:"Moto G (4)"}],dpi:401,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/A0001/*"},{ua:"A0001"}],dpi:[403.4,401],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE E1005/*"},{ua:"ONE E1005"}],dpi:[442.4,441.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A2005/*"},{ua:"ONE A2005"}],dpi:[391.9,405.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONEPLUS A5000/*"},{ua:"ONEPLUS A5000 "}],dpi:[403.411,399.737],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"OnePlus/*/ONE A5010/*"},{ua:"ONEPLUS A5010"}],dpi:[403,400],bw:2,ac:1e3},{type:"android",rules:[{mdmh:"OPPO/*/X909/*"},{ua:"X909"}],dpi:[442.4,444.1],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9082/*"},{ua:"GT-I9082"}],dpi:[184.7,185.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G360P/*"},{ua:"SM-G360P"}],dpi:[196.7,205.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Nexus S/*"},{ua:"Nexus S"}],dpi:[234.5,229.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[304.8,303.9],bw:5,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-T230NU/*"},{ua:"SM-T230NU"}],dpi:216,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SGH-T399/*"},{ua:"SGH-T399"}],dpi:[217.7,231.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SGH-M919/*"},{ua:"SGH-M919"}],dpi:[440.8,437.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N9005/*"},{ua:"SM-N9005"}],dpi:[386.4,387],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SM-N900A/*"},{ua:"SAMSUNG-SM-N900A"}],dpi:[386.4,387.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9500/*"},{ua:"GT-I9500"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/GT-I9505/*"},{ua:"GT-I9505"}],dpi:439.4,bw:4,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900F/*"},{ua:"SM-G900F"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G900M/*"},{ua:"SM-G900M"}],dpi:[415.6,431.6],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G800F/*"},{ua:"SM-G800F"}],dpi:326.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G906S/*"},{ua:"SM-G906S"}],dpi:[562.7,572.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300/*"},{ua:"GT-I9300"}],dpi:[306.7,304.8],bw:5,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-T535/*"},{ua:"SM-T535"}],dpi:[142.6,136.4],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-N920C/*"},{ua:"SM-N920C"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920P/*"},{ua:"SM-N920P"}],dpi:[386.3655,390.144],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N920W8/*"},{ua:"SM-N920W8"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9300I/*"},{ua:"GT-I9300I"}],dpi:[304.8,305.8],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-I9195/*"},{ua:"GT-I9195"}],dpi:[249.4,256.7],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SPH-L520/*"},{ua:"SPH-L520"}],dpi:[249.4,255.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SAMSUNG-SGH-I717/*"},{ua:"SAMSUNG-SGH-I717"}],dpi:285.8,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SPH-D710/*"},{ua:"SPH-D710"}],dpi:[217.7,204.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/GT-N7100/*"},{ua:"GT-N7100"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SCH-I605/*"},{ua:"SCH-I605"}],dpi:265.1,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/Galaxy Nexus/*"},{ua:"Galaxy Nexus"}],dpi:[315.3,314.2],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910H/*"},{ua:"SM-N910H"}],dpi:[515.1,518],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-N910C/*"},{ua:"SM-N910C"}],dpi:[515.2,520.2],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G130M/*"},{ua:"SM-G130M"}],dpi:[165.9,164.8],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G928I/*"},{ua:"SM-G928I"}],dpi:[515.1,518.4],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G920F/*"},{ua:"SM-G920F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G920P/*"},{ua:"SM-G920P"}],dpi:[522.5,577],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G925F/*"},{ua:"SM-G925F"}],dpi:580.6,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G925V/*"},{ua:"SM-G925V"}],dpi:[522.5,576.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G930F/*"},{ua:"SM-G930F"}],dpi:576.6,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"samsung/*/SM-G935F/*"},{ua:"SM-G935F"}],dpi:533,bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G950F/*"},{ua:"SM-G950F"}],dpi:[562.707,565.293],bw:3,ac:500},{type:"android",rules:[{mdmh:"samsung/*/SM-G955U/*"},{ua:"SM-G955U"}],dpi:[522.514,525.762],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/C6903/*"},{ua:"C6903"}],dpi:[442.5,443.3],bw:3,ac:500},{type:"android",rules:[{mdmh:"Sony/*/D6653/*"},{ua:"D6653"}],dpi:[428.6,427.6],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6653/*"},{ua:"E6653"}],dpi:[428.6,425.7],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/E6853/*"},{ua:"E6853"}],dpi:[403.4,401.9],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Sony/*/SGP321/*"},{ua:"SGP321"}],dpi:[224.7,224.1],bw:3,ac:500},{type:"android",rules:[{mdmh:"TCT/*/ALCATEL ONE TOUCH Fierce/*"},{ua:"ALCATEL ONE TOUCH Fierce"}],dpi:[240,247.5],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"THL/*/thl 5000/*"},{ua:"thl 5000"}],dpi:[480,443.3],bw:3,ac:1e3},{type:"android",rules:[{mdmh:"Fly/*/IQ4412/*"},{ua:"IQ4412"}],dpi:307.9,bw:3,ac:1e3},{type:"android",rules:[{mdmh:"ZTE/*/ZTE Blade L2/*"},{ua:"ZTE Blade L2"}],dpi:240,bw:3,ac:500},{type:"android",rules:[{mdmh:"BENEVE/*/VR518/*"},{ua:"VR518"}],dpi:480,bw:3,ac:500},{type:"ios",rules:[{res:[640,960]}],dpi:[325.1,328.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[640,1136]}],dpi:[317.1,320.2],bw:3,ac:1e3},{type:"ios",rules:[{res:[750,1334]}],dpi:326.4,bw:4,ac:1e3},{type:"ios",rules:[{res:[1242,2208]}],dpi:[453.6,458.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2001]}],dpi:[410.9,415.4],bw:4,ac:1e3},{type:"ios",rules:[{res:[1125,2436]}],dpi:458,bw:4,ac:1e3}]};function Dpdb(url,onDeviceParamsUpdated){this.dpdb=DPDB_CACHE;this.recalculateDeviceParams_();if(url){this.onDeviceParamsUpdated=onDeviceParamsUpdated;var xhr=new XMLHttpRequest,obj=this;xhr.open("GET",url,!0);xhr.addEventListener("load",function(){obj.loading=!1;if(200<=xhr.status&&299>=xhr.status){obj.dpdb=JSON.parse(xhr.response);obj.recalculateDeviceParams_()}else{console.error("Error loading online DPDB!")}});xhr.send()}}Dpdb.prototype.getDeviceParams=function(){return this.deviceParams};Dpdb.prototype.recalculateDeviceParams_=function(){var newDeviceParams=this.calcDeviceParams_();if(newDeviceParams){this.deviceParams=newDeviceParams;if(this.onDeviceParamsUpdated){this.onDeviceParamsUpdated(this.deviceParams)}}else{console.error("Failed to recalculate device parameters.")}};Dpdb.prototype.calcDeviceParams_=function(){var db=this.dpdb;if(!db){console.error("DPDB not available.");return null}if(1!=db.format){console.error("DPDB has unexpected format version.");return null}if(!db.devices||!db.devices.length){console.error("DPDB does not have a devices section.");return null}var userAgent=navigator.userAgent||navigator.vendor||window.opera,width=getScreenWidth(),height=getScreenHeight();if(!db.devices){console.error("DPDB has no devices section.");return null}for(var i=0,device;i<db.devices.length;i++){device=db.devices[i];if(!device.rules){console.warn("Device["+i+"] has no rules section.");continue}if("ios"!=device.type&&"android"!=device.type){console.warn("Device["+i+"] has invalid type.");continue}if(isIOS()!=("ios"==device.type))continue;for(var matched=!1,j=0,rule;j<device.rules.length;j++){rule=device.rules[j];if(this.matchRule_(rule,userAgent,width,height)){matched=!0;break}}if(!matched)continue;var xdpi=device.dpi[0]||device.dpi,ydpi=device.dpi[1]||device.dpi;return new DeviceParams({xdpi:xdpi,ydpi:ydpi,bevelMm:device.bw})}console.warn("No DPDB device match.");return null};Dpdb.prototype.matchRule_=function(rule,ua,screenWidth,screenHeight){if(!rule.ua&&!rule.res)return!1;if(rule.ua&&0>ua.indexOf(rule.ua))return!1;if(rule.res){if(!rule.res[0]||!rule.res[1])return!1;var resX=rule.res[0],resY=rule.res[1];if(_Mathmin(screenWidth,screenHeight)!=_Mathmin(resX,resY)||_Mathmax(screenWidth,screenHeight)!=_Mathmax(resX,resY)){return!1}}return!0};function DeviceParams(params){this.xdpi=params.xdpi;this.ydpi=params.ydpi;this.bevelMm=params.bevelMm}function SensorSample(sample,timestampS){this.set(sample,timestampS)}SensorSample.prototype.set=function(sample,timestampS){this.sample=sample;this.timestampS=timestampS};SensorSample.prototype.copy=function(sensorSample){this.set(sensorSample.sample,sensorSample.timestampS)};function ComplementaryFilter(kFilter,isDebug){this.kFilter=kFilter;this.isDebug=isDebug;this.currentAccelMeasurement=new SensorSample;this.currentGyroMeasurement=new SensorSample;this.previousGyroMeasurement=new SensorSample;if(isIOS()){this.filterQ=new Quaternion(-1,0,0,1)}else{this.filterQ=new Quaternion(1,0,0,1)}this.previousFilterQ=new Quaternion;this.previousFilterQ.copy(this.filterQ);this.accelQ=new Quaternion;this.isOrientationInitialized=!1;this.estimatedGravity=new Vector3;this.measuredGravity=new Vector3;this.gyroIntegralQ=new Quaternion}ComplementaryFilter.prototype.addAccelMeasurement=function(vector,timestampS){this.currentAccelMeasurement.set(vector,timestampS)};ComplementaryFilter.prototype.addGyroMeasurement=function(vector,timestampS){this.currentGyroMeasurement.set(vector,timestampS);var deltaT=timestampS-this.previousGyroMeasurement.timestampS;if(isTimestampDeltaValid(deltaT)){this.run_()}this.previousGyroMeasurement.copy(this.currentGyroMeasurement)};ComplementaryFilter.prototype.run_=function(){if(!this.isOrientationInitialized){this.accelQ=this.accelToQuaternion_(this.currentAccelMeasurement.sample);this.previousFilterQ.copy(this.accelQ);this.isOrientationInitialized=!0;return}var deltaT=this.currentGyroMeasurement.timestampS-this.previousGyroMeasurement.timestampS,gyroDeltaQ=this.gyroToQuaternionDelta_(this.currentGyroMeasurement.sample,deltaT);this.gyroIntegralQ.multiply(gyroDeltaQ);this.filterQ.copy(this.previousFilterQ);this.filterQ.multiply(gyroDeltaQ);var invFilterQ=new Quaternion;invFilterQ.copy(this.filterQ);invFilterQ.inverse();this.estimatedGravity.set(0,0,-1);this.estimatedGravity.applyQuaternion(invFilterQ);this.estimatedGravity.normalize();this.measuredGravity.copy(this.currentAccelMeasurement.sample);this.measuredGravity.normalize();var deltaQ=new Quaternion;deltaQ.setFromUnitVectors(this.estimatedGravity,this.measuredGravity);deltaQ.inverse();if(this.isDebug){console.log("Delta: %d deg, G_est: (%s, %s, %s), G_meas: (%s, %s, %s)",radToDeg*getQuaternionAngle(deltaQ),this.estimatedGravity.x.toFixed(1),this.estimatedGravity.y.toFixed(1),this.estimatedGravity.z.toFixed(1),this.measuredGravity.x.toFixed(1),this.measuredGravity.y.toFixed(1),this.measuredGravity.z.toFixed(1))}var targetQ=new Quaternion;targetQ.copy(this.filterQ);targetQ.multiply(deltaQ);this.filterQ.slerp(targetQ,1-this.kFilter);this.previousFilterQ.copy(this.filterQ)};ComplementaryFilter.prototype.getOrientation=function(){return this.filterQ};ComplementaryFilter.prototype.accelToQuaternion_=function(accel){var normAccel=new Vector3;normAccel.copy(accel);normAccel.normalize();var quat=new Quaternion;quat.setFromUnitVectors(new Vector3(0,0,-1),normAccel);quat.inverse();return quat};ComplementaryFilter.prototype.gyroToQuaternionDelta_=function(gyro,dt){var quat=new Quaternion,axis=new Vector3;axis.copy(gyro);axis.normalize();quat.setFromAxisAngle(axis,gyro.length()*dt);return quat};function PosePredictor(predictionTimeS,isDebug){this.predictionTimeS=predictionTimeS;this.isDebug=isDebug;this.previousQ=new Quaternion;this.previousTimestampS=null;this.deltaQ=new Quaternion;this.outQ=new Quaternion}PosePredictor.prototype.getPrediction=function(currentQ,gyro,timestampS){if(!this.previousTimestampS){this.previousQ.copy(currentQ);this.previousTimestampS=timestampS;return currentQ}var axis=new Vector3;axis.copy(gyro);axis.normalize();var angularSpeed=gyro.length();if(angularSpeed<20*degToRad){if(this.isDebug){console.log("Moving slowly, at %s deg/s: no prediction",(radToDeg*angularSpeed).toFixed(1))}this.outQ.copy(currentQ);this.previousQ.copy(currentQ);return this.outQ}var predictAngle=angularSpeed*this.predictionTimeS;this.deltaQ.setFromAxisAngle(axis,predictAngle);this.outQ.copy(this.previousQ);this.outQ.multiply(this.deltaQ);this.previousQ.copy(currentQ);this.previousTimestampS=timestampS;return this.outQ};function FusionPoseSensor(kFilter,predictionTime,yawOnly,isDebug){this.yawOnly=yawOnly;this.accelerometer=new Vector3;this.gyroscope=new Vector3;this.filter=new ComplementaryFilter(kFilter,isDebug);this.posePredictor=new PosePredictor(predictionTime,isDebug);this.isFirefoxAndroid=isFirefoxAndroid();this.isIOS=isIOS();var chromeVersion=getChromeVersion();this.isDeviceMotionInRadians=!this.isIOS&&chromeVersion&&66>chromeVersion;this.isWithoutDeviceMotion=isChromeWithoutDeviceMotion();this.filterToWorldQ=new Quaternion;if(isIOS()){this.filterToWorldQ.setFromAxisAngle(new Vector3(1,0,0),_MathPI/2)}else{this.filterToWorldQ.setFromAxisAngle(new Vector3(1,0,0),-_MathPI/2)}this.inverseWorldToScreenQ=new Quaternion;this.worldToScreenQ=new Quaternion;this.originalPoseAdjustQ=new Quaternion;this.originalPoseAdjustQ.setFromAxisAngle(new Vector3(0,0,1),-window.orientation*_MathPI/180);this.setScreenTransform_();if(isLandscapeMode()){this.filterToWorldQ.multiply(this.inverseWorldToScreenQ)}this.resetQ=new Quaternion;this.orientationOut_=new Float32Array(4);this.start()}FusionPoseSensor.prototype.getPosition=function(){return null};FusionPoseSensor.prototype.getOrientation=function(){var orientation;if(this.isWithoutDeviceMotion&&this._deviceOrientationQ){this.deviceOrientationFixQ=this.deviceOrientationFixQ||function(){var z=new Quaternion().setFromAxisAngle(new Vector3(0,0,-1),0),y=new Quaternion;if(-90===window.orientation){y.setFromAxisAngle(new Vector3(0,1,0),_MathPI/-2)}else{y.setFromAxisAngle(new Vector3(0,1,0),_MathPI/2)}return z.multiply(y)}();this.deviceOrientationFilterToWorldQ=this.deviceOrientationFilterToWorldQ||function(){var q=new Quaternion;q.setFromAxisAngle(new Vector3(1,0,0),-_MathPI/2);return q}();orientation=this._deviceOrientationQ;var out=new Quaternion;out.copy(orientation);out.multiply(this.deviceOrientationFilterToWorldQ);out.multiply(this.resetQ);out.multiply(this.worldToScreenQ);out.multiplyQuaternions(this.deviceOrientationFixQ,out);if(this.yawOnly){out.x=0;out.z=0;out.normalize()}this.orientationOut_[0]=out.x;this.orientationOut_[1]=out.y;this.orientationOut_[2]=out.z;this.orientationOut_[3]=out.w;return this.orientationOut_}else{var filterOrientation=this.filter.getOrientation();orientation=this.posePredictor.getPrediction(filterOrientation,this.gyroscope,this.previousTimestampS)}var out=new Quaternion;out.copy(this.filterToWorldQ);out.multiply(this.resetQ);out.multiply(orientation);out.multiply(this.worldToScreenQ);if(this.yawOnly){out.x=0;out.z=0;out.normalize()}this.orientationOut_[0]=out.x;this.orientationOut_[1]=out.y;this.orientationOut_[2]=out.z;this.orientationOut_[3]=out.w;return this.orientationOut_};FusionPoseSensor.prototype.resetPose=function(){this.resetQ.copy(this.filter.getOrientation());this.resetQ.x=0;this.resetQ.y=0;this.resetQ.z*=-1;this.resetQ.normalize();if(isLandscapeMode()){this.resetQ.multiply(this.inverseWorldToScreenQ)}this.resetQ.multiply(this.originalPoseAdjustQ)};FusionPoseSensor.prototype.onDeviceOrientation_=function(e){this._deviceOrientationQ=this._deviceOrientationQ||new Quaternion;var alpha=e.alpha,beta=e.beta,gamma=e.gamma;alpha=(alpha||0)*_MathPI/180;beta=(beta||0)*_MathPI/180;gamma=(gamma||0)*_MathPI/180;this._deviceOrientationQ.setFromEulerYXZ(beta,alpha,-gamma)};FusionPoseSensor.prototype.onDeviceMotion_=function(deviceMotion){this.updateDeviceMotion_(deviceMotion)};FusionPoseSensor.prototype.updateDeviceMotion_=function(deviceMotion){var accGravity=deviceMotion.accelerationIncludingGravity,rotRate=deviceMotion.rotationRate,timestampS=deviceMotion.timeStamp/1e3,deltaS=timestampS-this.previousTimestampS;if(0>deltaS){warnOnce("fusion-pose-sensor:invalid:non-monotonic","Invalid timestamps detected: non-monotonic timestamp from devicemotion");this.previousTimestampS=timestampS;return}else if(deltaS<=MIN_TIMESTEP||deltaS>MAX_TIMESTEP){warnOnce("fusion-pose-sensor:invalid:outside-threshold","Invalid timestamps detected: Timestamp from devicemotion outside expected range.");this.previousTimestampS=timestampS;return}this.accelerometer.set(-accGravity.x,-accGravity.y,-accGravity.z);if(isR7()){this.gyroscope.set(-rotRate.beta,rotRate.alpha,rotRate.gamma)}else{this.gyroscope.set(rotRate.alpha,rotRate.beta,rotRate.gamma)}if(!this.isDeviceMotionInRadians){this.gyroscope.multiplyScalar(_MathPI/180)}this.filter.addAccelMeasurement(this.accelerometer,timestampS);this.filter.addGyroMeasurement(this.gyroscope,timestampS);this.previousTimestampS=timestampS};FusionPoseSensor.prototype.onOrientationChange_=function(){this.setScreenTransform_()};FusionPoseSensor.prototype.onMessage_=function(event){var message=event.data;if(!message||!message.type){return}var type=message.type.toLowerCase();if("devicemotion"!==type){return}this.updateDeviceMotion_(message.deviceMotionEvent)};FusionPoseSensor.prototype.setScreenTransform_=function(){this.worldToScreenQ.set(0,0,0,1);switch(window.orientation){case 0:break;case 90:this.worldToScreenQ.setFromAxisAngle(new Vector3(0,0,1),-_MathPI/2);break;case-90:this.worldToScreenQ.setFromAxisAngle(new Vector3(0,0,1),_MathPI/2);break;case 180:break;}this.inverseWorldToScreenQ.copy(this.worldToScreenQ);this.inverseWorldToScreenQ.inverse()};FusionPoseSensor.prototype.start=function(){this.onDeviceMotionCallback_=this.onDeviceMotion_.bind(this);this.onOrientationChangeCallback_=this.onOrientationChange_.bind(this);this.onMessageCallback_=this.onMessage_.bind(this);this.onDeviceOrientationCallback_=this.onDeviceOrientation_.bind(this);if(isIOS()&&isInsideCrossOriginIFrame()){window.addEventListener("message",this.onMessageCallback_)}window.addEventListener("orientationchange",this.onOrientationChangeCallback_);if(this.isWithoutDeviceMotion){window.addEventListener("deviceorientation",this.onDeviceOrientationCallback_)}else{window.addEventListener("devicemotion",this.onDeviceMotionCallback_)}};FusionPoseSensor.prototype.stop=function(){window.removeEventListener("devicemotion",this.onDeviceMotionCallback_);window.removeEventListener("deviceorientation",this.onDeviceOrientationCallback_);window.removeEventListener("orientationchange",this.onOrientationChangeCallback_);window.removeEventListener("message",this.onMessageCallback_)};var X_AXIS=new Vector3(1,0,0),Z_AXIS=new Vector3(0,0,1),orientation={};if(screen.orientation){orientation=screen.orientation}else if(screen.msOrientation){orientation=screen.msOrientation}else{Object.defineProperty(orientation,"angle",{get:function(){return window.orientation||0}})}var SENSOR_TO_VR=new Quaternion;SENSOR_TO_VR.setFromAxisAngle(X_AXIS,-_MathPI/2);SENSOR_TO_VR.multiply(new Quaternion().setFromAxisAngle(Z_AXIS,_MathPI/2));var PoseSensor=function(){function PoseSensor(config){classCallCheck(this,PoseSensor);this.config=config;this.sensor=null;this.fusionSensor=null;this._out=new Float32Array(4);this.api=null;this.errors=[];this._sensorQ=new Quaternion;this._worldToScreenQ=new Quaternion;this._outQ=new Quaternion;this._onSensorRead=this._onSensorRead.bind(this);this._onSensorError=this._onSensorError.bind(this);this._onOrientationChange=this._onOrientationChange.bind(this);this._onOrientationChange();this.init()}createClass(PoseSensor,[{key:"init",value:function(){var sensor=null;try{sensor=new RelativeOrientationSensor({frequency:60});sensor.addEventListener("error",this._onSensorError)}catch(error){this.errors.push(error);if("SecurityError"===error.name){console.error("Cannot construct sensors due to the Feature Policy");console.warn("Attempting to fall back using \"devicemotion\"; however this will "+"fail in the future without correct permissions.");this.useDeviceMotion()}else if("ReferenceError"===error.name){this.useDeviceMotion()}else{console.error(error)}}if(sensor){this.api="sensor";this.sensor=sensor;this.sensor.addEventListener("reading",this._onSensorRead);this.sensor.start()}window.addEventListener("orientationchange",this._onOrientationChange)}},{key:"useDeviceMotion",value:function(){this.api="devicemotion";this.fusionSensor=new FusionPoseSensor(this.config.K_FILTER,this.config.PREDICTION_TIME_S,this.config.YAW_ONLY,this.config.DEBUG)}},{key:"getOrientation",value:function(){if(this.fusionSensor){return this.fusionSensor.getOrientation()}if(!this.sensor||!this.sensor.quaternion){this._out[0]=this._out[1]=this._out[2]=0;this._out[3]=1;return this._out}var q=this.sensor.quaternion;this._sensorQ.set(q[0],q[1],q[2],q[3]);var out=this._outQ;out.copy(SENSOR_TO_VR);out.multiply(this._sensorQ);out.multiply(this._worldToScreenQ);if(this.config.YAW_ONLY){out.x=out.z=0;out.normalize()}this._out[0]=out.x;this._out[1]=out.y;this._out[2]=out.z;this._out[3]=out.w;return this._out}},{key:"_onSensorError",value:function(event){this.errors.push(event.error);if("NotAllowedError"===event.error.name){console.error("Permission to access sensor was denied")}else if("NotReadableError"===event.error.name){console.error("Sensor could not be read")}else{console.error(event.error)}}},{key:"_onSensorRead",value:function(){}},{key:"_onOrientationChange",value:function(){var angle=-orientation.angle*_MathPI/180;this._worldToScreenQ.setFromAxisAngle(Z_AXIS,angle)}}]);return PoseSensor}();function RotateInstructions(){this.loadIcon_();var overlay=document.createElement("div"),s=overlay.style;s.position="fixed";s.top=0;s.right=0;s.bottom=0;s.left=0;s.backgroundColor="gray";s.fontFamily="sans-serif";s.zIndex=1e6;var img=document.createElement("img");img.src=this.icon;var s=img.style;s.marginLeft="25%";s.marginTop="25%";s.width="50%";overlay.appendChild(img);var text=document.createElement("div"),s=text.style;s.textAlign="center";s.fontSize="16px";s.lineHeight="24px";s.margin="24px 25%";s.width="50%";text.innerHTML="Place your phone into your Cardboard viewer.";overlay.appendChild(text);var snackbar=document.createElement("div"),s=snackbar.style;s.backgroundColor="#CFD8DC";s.position="fixed";s.bottom=0;s.width="100%";s.height="48px";s.padding="14px 24px";s.boxSizing="border-box";s.color="#656A6B";overlay.appendChild(snackbar);var snackbarText=document.createElement("div");snackbarText.style.float="left";snackbarText.innerHTML="No Cardboard viewer?";var snackbarButton=document.createElement("a");snackbarButton.href="https://www.google.com/get/cardboard/get-cardboard/";snackbarButton.innerHTML="get one";snackbarButton.target="_blank";var s=snackbarButton.style;s.float="right";s.fontWeight=600;s.textTransform="uppercase";s.borderLeft="1px solid gray";s.paddingLeft="24px";s.textDecoration="none";s.color="#656A6B";snackbar.appendChild(snackbarText);snackbar.appendChild(snackbarButton);this.overlay=overlay;this.text=text;this.hide()}RotateInstructions.prototype.show=function(parent){if(!parent&&!this.overlay.parentElement){document.body.appendChild(this.overlay)}else if(parent){if(this.overlay.parentElement&&this.overlay.parentElement!=parent)this.overlay.parentElement.removeChild(this.overlay);parent.appendChild(this.overlay)}this.overlay.style.display="block";var img=this.overlay.querySelector("img"),s=img.style;if(isLandscapeMode()){s.width="20%";s.marginLeft="40%";s.marginTop="3%"}else{s.width="50%";s.marginLeft="25%";s.marginTop="25%"}};RotateInstructions.prototype.hide=function(){this.overlay.style.display="none"};RotateInstructions.prototype.showTemporarily=function(ms,parent){this.show(parent);this.timer=setTimeout(this.hide.bind(this),ms)};RotateInstructions.prototype.disableShowTemporarily=function(){clearTimeout(this.timer)};RotateInstructions.prototype.update=function(){this.disableShowTemporarily();if(!isLandscapeMode()&&isMobile()){this.show()}else{this.hide()}};RotateInstructions.prototype.loadIcon_=function(){this.icon=base64("image/svg+xml","PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0iVVRGLTgiIHN0YW5kYWxvbmU9Im5vIj8+Cjxzdmcgd2lkdGg9IjE5OHB4IiBoZWlnaHQ9IjI0MHB4IiB2aWV3Qm94PSIwIDAgMTk4IDI0MCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB4bWxuczpza2V0Y2g9Imh0dHA6Ly93d3cuYm9oZW1pYW5jb2RpbmcuY29tL3NrZXRjaC9ucyI+CiAgICA8IS0tIEdlbmVyYXRvcjogU2tldGNoIDMuMy4zICgxMjA4MSkgLSBodHRwOi8vd3d3LmJvaGVtaWFuY29kaW5nLmNvbS9za2V0Y2ggLS0+CiAgICA8dGl0bGU+dHJhbnNpdGlvbjwvdGl0bGU+CiAgICA8ZGVzYz5DcmVhdGVkIHdpdGggU2tldGNoLjwvZGVzYz4KICAgIDxkZWZzPjwvZGVmcz4KICAgIDxnIGlkPSJQYWdlLTEiIHN0cm9rZT0ibm9uZSIgc3Ryb2tlLXdpZHRoPSIxIiBmaWxsPSJub25lIiBmaWxsLXJ1bGU9ImV2ZW5vZGQiIHNrZXRjaDp0eXBlPSJNU1BhZ2UiPgogICAgICAgIDxnIGlkPSJ0cmFuc2l0aW9uIiBza2V0Y2g6dHlwZT0iTVNBcnRib2FyZEdyb3VwIj4KICAgICAgICAgICAgPGcgaWQ9IkltcG9ydGVkLUxheWVycy1Db3B5LTQtKy1JbXBvcnRlZC1MYXllcnMtQ29weS0rLUltcG9ydGVkLUxheWVycy1Db3B5LTItQ29weSIgc2tldGNoOnR5cGU9Ik1TTGF5ZXJHcm91cCI+CiAgICAgICAgICAgICAgICA8ZyBpZD0iSW1wb3J0ZWQtTGF5ZXJzLUNvcHktNCIgdHJhbnNmb3JtPSJ0cmFuc2xhdGUoMC4wMDAwMDAsIDEwNy4wMDAwMDApIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ5LjYyNSwyLjUyNyBDMTQ5LjYyNSwyLjUyNyAxNTUuODA1LDYuMDk2IDE1Ni4zNjIsNi40MTggTDE1Ni4zNjIsNy4zMDQgQzE1Ni4zNjIsNy40ODEgMTU2LjM3NSw3LjY2NCAxNTYuNCw3Ljg1MyBDMTU2LjQxLDcuOTM0IDE1Ni40Miw4LjAxNSAxNTYuNDI3LDguMDk1IEMxNTYuNTY3LDkuNTEgMTU3LjQwMSwxMS4wOTMgMTU4LjUzMiwxMi4wOTQgTDE2NC4yNTIsMTcuMTU2IEwxNjQuMzMzLDE3LjA2NiBDMTY0LjMzMywxNy4wNjYgMTY4LjcxNSwxNC41MzYgMTY5LjU2OCwxNC4wNDIgQzE3MS4wMjUsMTQuODgzIDE5NS41MzgsMjkuMDM1IDE5NS41MzgsMjkuMDM1IEwxOTUuNTM4LDgzLjAzNiBDMTk1LjUzOCw4My44MDcgMTk1LjE1Miw4NC4yNTMgMTk0LjU5LDg0LjI1MyBDMTk0LjM1Nyw4NC4yNTMgMTk0LjA5NSw4NC4xNzcgMTkzLjgxOCw4NC4wMTcgTDE2OS44NTEsNzAuMTc5IEwxNjkuODM3LDcwLjIwMyBMMTQyLjUxNSw4NS45NzggTDE0MS42NjUsODQuNjU1IEMxMzYuOTM0LDgzLjEyNiAxMzEuOTE3LDgxLjkxNSAxMjYuNzE0LDgxLjA0NSBDMTI2LjcwOSw4MS4wNiAxMjYuNzA3LDgxLjA2OSAxMjYuNzA3LDgxLjA2OSBMMTIxLjY0LDk4LjAzIEwxMTMuNzQ5LDEwMi41ODYgTDExMy43MTIsMTAyLjUyMyBMMTEzLjcxMiwxMzAuMTEzIEMxMTMuNzEyLDEzMC44ODUgMTEzLjMyNiwxMzEuMzMgMTEyLjc2NCwxMzEuMzMgQzExMi41MzIsMTMxLjMzIDExMi4yNjksMTMxLjI1NCAxMTEuOTkyLDEzMS4wOTQgTDY5LjUxOSwxMDYuNTcyIEM2OC41NjksMTA2LjAyMyA2Ny43OTksMTA0LjY5NSA2Ny43OTksMTAzLjYwNSBMNjcuNzk5LDEwMi41NyBMNjcuNzc4LDEwMi42MTcgQzY3LjI3LDEwMi4zOTMgNjYuNjQ4LDEwMi4yNDkgNjUuOTYyLDEwMi4yMTggQzY1Ljg3NSwxMDIuMjE0IDY1Ljc4OCwxMDIuMjEyIDY1LjcwMSwxMDIuMjEyIEM2NS42MDYsMTAyLjIxMiA2NS41MTEsMTAyLjIxNSA2NS40MTYsMTAyLjIxOSBDNjUuMTk1LDEwMi4yMjkgNjQuOTc0LDEwMi4yMzUgNjQuNzU0LDEwMi4yMzUgQzY0LjMzMSwxMDIuMjM1IDYzLjkxMSwxMDIuMjE2IDYzLjQ5OCwxMDIuMTc4IEM2MS44NDMsMTAyLjAyNSA2MC4yOTgsMTAxLjU3OCA1OS4wOTQsMTAwLjg4MiBMMTIuNTE4LDczLjk5MiBMMTIuNTIzLDc0LjAwNCBMMi4yNDUsNTUuMjU0IEMxLjI0NCw1My40MjcgMi4wMDQsNTEuMDM4IDMuOTQzLDQ5LjkxOCBMNTkuOTU0LDE3LjU3MyBDNjAuNjI2LDE3LjE4NSA2MS4zNSwxNy4wMDEgNjIuMDUzLDE3LjAwMSBDNjMuMzc5LDE3LjAwMSA2NC42MjUsMTcuNjYgNjUuMjgsMTguODU0IEw2NS4yODUsMTguODUxIEw2NS41MTIsMTkuMjY0IEw2NS41MDYsMTkuMjY4IEM2NS45MDksMjAuMDAzIDY2LjQwNSwyMC42OCA2Ni45ODMsMjEuMjg2IEw2Ny4yNiwyMS41NTYgQzY5LjE3NCwyMy40MDYgNzEuNzI4LDI0LjM1NyA3NC4zNzMsMjQuMzU3IEM3Ni4zMjIsMjQuMzU3IDc4LjMyMSwyMy44NCA4MC4xNDgsMjIuNzg1IEM4MC4xNjEsMjIuNzg1IDg3LjQ2NywxOC41NjYgODcuNDY3LDE4LjU2NiBDODguMTM5LDE4LjE3OCA4OC44NjMsMTcuOTk0IDg5LjU2NiwxNy45OTQgQzkwLjg5MiwxNy45OTQgOTIuMTM4LDE4LjY1MiA5Mi43OTIsMTkuODQ3IEw5Ni4wNDIsMjUuNzc1IEw5Ni4wNjQsMjUuNzU3IEwxMDIuODQ5LDI5LjY3NCBMMTAyLjc0NCwyOS40OTIgTDE0OS42MjUsMi41MjcgTTE0OS42MjUsMC44OTIgQzE0OS4zNDMsMC44OTIgMTQ5LjA2MiwwLjk2NSAxNDguODEsMS4xMSBMMTAyLjY0MSwyNy42NjYgTDk3LjIzMSwyNC41NDIgTDk0LjIyNiwxOS4wNjEgQzkzLjMxMywxNy4zOTQgOTEuNTI3LDE2LjM1OSA4OS41NjYsMTYuMzU4IEM4OC41NTUsMTYuMzU4IDg3LjU0NiwxNi42MzIgODYuNjQ5LDE3LjE1IEM4My44NzgsMTguNzUgNzkuNjg3LDIxLjE2OSA3OS4zNzQsMjEuMzQ1IEM3OS4zNTksMjEuMzUzIDc5LjM0NSwyMS4zNjEgNzkuMzMsMjEuMzY5IEM3Ny43OTgsMjIuMjU0IDc2LjA4NCwyMi43MjIgNzQuMzczLDIyLjcyMiBDNzIuMDgxLDIyLjcyMiA2OS45NTksMjEuODkgNjguMzk3LDIwLjM4IEw2OC4xNDUsMjAuMTM1IEM2Ny43MDYsMTkuNjcyIDY3LjMyMywxOS4xNTYgNjcuMDA2LDE4LjYwMSBDNjYuOTg4LDE4LjU1OSA2Ni45NjgsMTguNTE5IDY2Ljk0NiwxOC40NzkgTDY2LjcxOSwxOC4wNjUgQzY2LjY5LDE4LjAxMiA2Ni42NTgsMTcuOTYgNjYuNjI0LDE3LjkxMSBDNjUuNjg2LDE2LjMzNyA2My45NTEsMTUuMzY2IDYyLjA1MywxNS4zNjYgQzYxLjA0MiwxNS4zNjYgNjAuMDMzLDE1LjY0IDU5LjEzNiwxNi4xNTggTDMuMTI1LDQ4LjUwMiBDMC40MjYsNTAuMDYxIC0wLjYxMyw1My40NDIgMC44MTEsNTYuMDQgTDExLjA4OSw3NC43OSBDMTEuMjY2LDc1LjExMyAxMS41MzcsNzUuMzUzIDExLjg1LDc1LjQ5NCBMNTguMjc2LDEwMi4yOTggQzU5LjY3OSwxMDMuMTA4IDYxLjQzMywxMDMuNjMgNjMuMzQ4LDEwMy44MDYgQzYzLjgxMiwxMDMuODQ4IDY0LjI4NSwxMDMuODcgNjQuNzU0LDEwMy44NyBDNjUsMTAzLjg3IDY1LjI0OSwxMDMuODY0IDY1LjQ5NCwxMDMuODUyIEM2NS41NjMsMTAzLjg0OSA2NS42MzIsMTAzLjg0NyA2NS43MDEsMTAzLjg0NyBDNjUuNzY0LDEwMy44NDcgNjUuODI4LDEwMy44NDkgNjUuODksMTAzLjg1MiBDNjUuOTg2LDEwMy44NTYgNjYuMDgsMTAzLjg2MyA2Ni4xNzMsMTAzLjg3NCBDNjYuMjgyLDEwNS40NjcgNjcuMzMyLDEwNy4xOTcgNjguNzAyLDEwNy45ODggTDExMS4xNzQsMTMyLjUxIEMxMTEuNjk4LDEzMi44MTIgMTEyLjIzMiwxMzIuOTY1IDExMi43NjQsMTMyLjk2NSBDMTE0LjI2MSwxMzIuOTY1IDExNS4zNDcsMTMxLjc2NSAxMTUuMzQ3LDEzMC4xMTMgTDExNS4zNDcsMTAzLjU1MSBMMTIyLjQ1OCw5OS40NDYgQzEyMi44MTksOTkuMjM3IDEyMy4wODcsOTguODk4IDEyMy4yMDcsOTguNDk4IEwxMjcuODY1LDgyLjkwNSBDMTMyLjI3OSw4My43MDIgMTM2LjU1Nyw4NC43NTMgMTQwLjYwNyw4Ni4wMzMgTDE0MS4xNCw4Ni44NjIgQzE0MS40NTEsODcuMzQ2IDE0MS45NzcsODcuNjEzIDE0Mi41MTYsODcuNjEzIEMxNDIuNzk0LDg3LjYxMyAxNDMuMDc2LDg3LjU0MiAxNDMuMzMzLDg3LjM5MyBMMTY5Ljg2NSw3Mi4wNzYgTDE5Myw4NS40MzMgQzE5My41MjMsODUuNzM1IDE5NC4wNTgsODUuODg4IDE5NC41OSw4NS44ODggQzE5Ni4wODcsODUuODg4IDE5Ny4xNzMsODQuNjg5IDE5Ny4xNzMsODMuMDM2IEwxOTcuMTczLDI5LjAzNSBDMTk3LjE3MywyOC40NTEgMTk2Ljg2MSwyNy45MTEgMTk2LjM1NSwyNy42MTkgQzE5Ni4zNTUsMjcuNjE5IDE3MS44NDMsMTMuNDY3IDE3MC4zODUsMTIuNjI2IEMxNzAuMTMyLDEyLjQ4IDE2OS44NSwxMi40MDcgMTY5LjU2OCwxMi40MDcgQzE2OS4yODUsMTIuNDA3IDE2OS4wMDIsMTIuNDgxIDE2OC43NDksMTIuNjI3IEMxNjguMTQzLDEyLjk3OCAxNjUuNzU2LDE0LjM1NyAxNjQuNDI0LDE1LjEyNSBMMTU5LjYxNSwxMC44NyBDMTU4Ljc5NiwxMC4xNDUgMTU4LjE1NCw4LjkzNyAxNTguMDU0LDcuOTM0IEMxNTguMDQ1LDcuODM3IDE1OC4wMzQsNy43MzkgMTU4LjAyMSw3LjY0IEMxNTguMDA1LDcuNTIzIDE1Ny45OTgsNy40MSAxNTcuOTk4LDcuMzA0IEwxNTcuOTk4LDYuNDE4IEMxNTcuOTk4LDUuODM0IDE1Ny42ODYsNS4yOTUgMTU3LjE4MSw1LjAwMiBDMTU2LjYyNCw0LjY4IDE1MC40NDIsMS4xMTEgMTUwLjQ0MiwxLjExMSBDMTUwLjE4OSwwLjk2NSAxNDkuOTA3LDAuODkyIDE0OS42MjUsMC44OTIiIGlkPSJGaWxsLTEiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTYuMDI3LDI1LjYzNiBMMTQyLjYwMyw1Mi41MjcgQzE0My44MDcsNTMuMjIyIDE0NC41ODIsNTQuMTE0IDE0NC44NDUsNTUuMDY4IEwxNDQuODM1LDU1LjA3NSBMNjMuNDYxLDEwMi4wNTcgTDYzLjQ2LDEwMi4wNTcgQzYxLjgwNiwxMDEuOTA1IDYwLjI2MSwxMDEuNDU3IDU5LjA1NywxMDAuNzYyIEwxMi40ODEsNzMuODcxIEw5Ni4wMjcsMjUuNjM2IiBpZD0iRmlsbC0yIiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTYzLjQ2MSwxMDIuMTc0IEM2My40NTMsMTAyLjE3NCA2My40NDYsMTAyLjE3NCA2My40MzksMTAyLjE3MiBDNjEuNzQ2LDEwMi4wMTYgNjAuMjExLDEwMS41NjMgNTguOTk4LDEwMC44NjMgTDEyLjQyMiw3My45NzMgQzEyLjM4Niw3My45NTIgMTIuMzY0LDczLjkxNCAxMi4zNjQsNzMuODcxIEMxMi4zNjQsNzMuODMgMTIuMzg2LDczLjc5MSAxMi40MjIsNzMuNzcgTDk1Ljk2OCwyNS41MzUgQzk2LjAwNCwyNS41MTQgOTYuMDQ5LDI1LjUxNCA5Ni4wODUsMjUuNTM1IEwxNDIuNjYxLDUyLjQyNiBDMTQzLjg4OCw1My4xMzQgMTQ0LjY4Miw1NC4wMzggMTQ0Ljk1Nyw1NS4wMzcgQzE0NC45Nyw1NS4wODMgMTQ0Ljk1Myw1NS4xMzMgMTQ0LjkxNSw1NS4xNjEgQzE0NC45MTEsNTUuMTY1IDE0NC44OTgsNTUuMTc0IDE0NC44OTQsNTUuMTc3IEw2My41MTksMTAyLjE1OCBDNjMuNTAxLDEwMi4xNjkgNjMuNDgxLDEwMi4xNzQgNjMuNDYxLDEwMi4xNzQgTDYzLjQ2MSwxMDIuMTc0IFogTTEyLjcxNCw3My44NzEgTDU5LjExNSwxMDAuNjYxIEM2MC4yOTMsMTAxLjM0MSA2MS43ODYsMTAxLjc4MiA2My40MzUsMTAxLjkzNyBMMTQ0LjcwNyw1NS4wMTUgQzE0NC40MjgsNTQuMTA4IDE0My42ODIsNTMuMjg1IDE0Mi41NDQsNTIuNjI4IEw5Ni4wMjcsMjUuNzcxIEwxMi43MTQsNzMuODcxIEwxMi43MTQsNzMuODcxIFoiIGlkPSJGaWxsLTMiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ4LjMyNyw1OC40NzEgQzE0OC4xNDUsNTguNDggMTQ3Ljk2Miw1OC40OCAxNDcuNzgxLDU4LjQ3MiBDMTQ1Ljg4Nyw1OC4zODkgMTQ0LjQ3OSw1Ny40MzQgMTQ0LjYzNiw1Ni4zNCBDMTQ0LjY4OSw1NS45NjcgMTQ0LjY2NCw1NS41OTcgMTQ0LjU2NCw1NS4yMzUgTDYzLjQ2MSwxMDIuMDU3IEM2NC4wODksMTAyLjExNSA2NC43MzMsMTAyLjEzIDY1LjM3OSwxMDIuMDk5IEM2NS41NjEsMTAyLjA5IDY1Ljc0MywxMDIuMDkgNjUuOTI1LDEwMi4wOTggQzY3LjgxOSwxMDIuMTgxIDY5LjIyNywxMDMuMTM2IDY5LjA3LDEwNC4yMyBMMTQ4LjMyNyw1OC40NzEiIGlkPSJGaWxsLTQiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNjkuMDcsMTA0LjM0NyBDNjkuMDQ4LDEwNC4zNDcgNjkuMDI1LDEwNC4zNCA2OS4wMDUsMTA0LjMyNyBDNjguOTY4LDEwNC4zMDEgNjguOTQ4LDEwNC4yNTcgNjguOTU1LDEwNC4yMTMgQzY5LDEwMy44OTYgNjguODk4LDEwMy41NzYgNjguNjU4LDEwMy4yODggQzY4LjE1MywxMDIuNjc4IDY3LjEwMywxMDIuMjY2IDY1LjkyLDEwMi4yMTQgQzY1Ljc0MiwxMDIuMjA2IDY1LjU2MywxMDIuMjA3IDY1LjM4NSwxMDIuMjE1IEM2NC43NDIsMTAyLjI0NiA2NC4wODcsMTAyLjIzMiA2My40NSwxMDIuMTc0IEM2My4zOTksMTAyLjE2OSA2My4zNTgsMTAyLjEzMiA2My4zNDcsMTAyLjA4MiBDNjMuMzM2LDEwMi4wMzMgNjMuMzU4LDEwMS45ODEgNjMuNDAyLDEwMS45NTYgTDE0NC41MDYsNTUuMTM0IEMxNDQuNTM3LDU1LjExNiAxNDQuNTc1LDU1LjExMyAxNDQuNjA5LDU1LjEyNyBDMTQ0LjY0Miw1NS4xNDEgMTQ0LjY2OCw1NS4xNyAxNDQuNjc3LDU1LjIwNCBDMTQ0Ljc4MSw1NS41ODUgMTQ0LjgwNiw1NS45NzIgMTQ0Ljc1MSw1Ni4zNTcgQzE0NC43MDYsNTYuNjczIDE0NC44MDgsNTYuOTk0IDE0NS4wNDcsNTcuMjgyIEMxNDUuNTUzLDU3Ljg5MiAxNDYuNjAyLDU4LjMwMyAxNDcuNzg2LDU4LjM1NSBDMTQ3Ljk2NCw1OC4zNjMgMTQ4LjE0Myw1OC4zNjMgMTQ4LjMyMSw1OC4zNTQgQzE0OC4zNzcsNTguMzUyIDE0OC40MjQsNTguMzg3IDE0OC40MzksNTguNDM4IEMxNDguNDU0LDU4LjQ5IDE0OC40MzIsNTguNTQ1IDE0OC4zODUsNTguNTcyIEw2OS4xMjksMTA0LjMzMSBDNjkuMTExLDEwNC4zNDIgNjkuMDksMTA0LjM0NyA2OS4wNywxMDQuMzQ3IEw2OS4wNywxMDQuMzQ3IFogTTY1LjY2NSwxMDEuOTc1IEM2NS43NTQsMTAxLjk3NSA2NS44NDIsMTAxLjk3NyA2NS45MywxMDEuOTgxIEM2Ny4xOTYsMTAyLjAzNyA2OC4yODMsMTAyLjQ2OSA2OC44MzgsMTAzLjEzOSBDNjkuMDY1LDEwMy40MTMgNjkuMTg4LDEwMy43MTQgNjkuMTk4LDEwNC4wMjEgTDE0Ny44ODMsNTguNTkyIEMxNDcuODQ3LDU4LjU5MiAxNDcuODExLDU4LjU5MSAxNDcuNzc2LDU4LjU4OSBDMTQ2LjUwOSw1OC41MzMgMTQ1LjQyMiw1OC4xIDE0NC44NjcsNTcuNDMxIEMxNDQuNTg1LDU3LjA5MSAxNDQuNDY1LDU2LjcwNyAxNDQuNTIsNTYuMzI0IEMxNDQuNTYzLDU2LjAyMSAxNDQuNTUyLDU1LjcxNiAxNDQuNDg4LDU1LjQxNCBMNjMuODQ2LDEwMS45NyBDNjQuMzUzLDEwMi4wMDIgNjQuODY3LDEwMi4wMDYgNjUuMzc0LDEwMS45ODIgQzY1LjQ3MSwxMDEuOTc3IDY1LjU2OCwxMDEuOTc1IDY1LjY2NSwxMDEuOTc1IEw2NS42NjUsMTAxLjk3NSBaIiBpZD0iRmlsbC01IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTIuMjA4LDU1LjEzNCBDMS4yMDcsNTMuMzA3IDEuOTY3LDUwLjkxNyAzLjkwNiw0OS43OTcgTDU5LjkxNywxNy40NTMgQzYxLjg1NiwxNi4zMzMgNjQuMjQxLDE2LjkwNyA2NS4yNDMsMTguNzM0IEw2NS40NzUsMTkuMTQ0IEM2NS44NzIsMTkuODgyIDY2LjM2OCwyMC41NiA2Ni45NDUsMjEuMTY1IEw2Ny4yMjMsMjEuNDM1IEM3MC41NDgsMjQuNjQ5IDc1LjgwNiwyNS4xNTEgODAuMTExLDIyLjY2NSBMODcuNDMsMTguNDQ1IEM4OS4zNywxNy4zMjYgOTEuNzU0LDE3Ljg5OSA5Mi43NTUsMTkuNzI3IEw5Ni4wMDUsMjUuNjU1IEwxMi40ODYsNzMuODg0IEwyLjIwOCw1NS4xMzQgWiIgaWQ9IkZpbGwtNiIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMi40ODYsNzQuMDAxIEMxMi40NzYsNzQuMDAxIDEyLjQ2NSw3My45OTkgMTIuNDU1LDczLjk5NiBDMTIuNDI0LDczLjk4OCAxMi4zOTksNzMuOTY3IDEyLjM4NCw3My45NCBMMi4xMDYsNTUuMTkgQzEuMDc1LDUzLjMxIDEuODU3LDUwLjg0NSAzLjg0OCw0OS42OTYgTDU5Ljg1OCwxNy4zNTIgQzYwLjUyNSwxNi45NjcgNjEuMjcxLDE2Ljc2NCA2Mi4wMTYsMTYuNzY0IEM2My40MzEsMTYuNzY0IDY0LjY2NiwxNy40NjYgNjUuMzI3LDE4LjY0NiBDNjUuMzM3LDE4LjY1NCA2NS4zNDUsMTguNjYzIDY1LjM1MSwxOC42NzQgTDY1LjU3OCwxOS4wODggQzY1LjU4NCwxOS4xIDY1LjU4OSwxOS4xMTIgNjUuNTkxLDE5LjEyNiBDNjUuOTg1LDE5LjgzOCA2Ni40NjksMjAuNDk3IDY3LjAzLDIxLjA4NSBMNjcuMzA1LDIxLjM1MSBDNjkuMTUxLDIzLjEzNyA3MS42NDksMjQuMTIgNzQuMzM2LDI0LjEyIEM3Ni4zMTMsMjQuMTIgNzguMjksMjMuNTgyIDgwLjA1MywyMi41NjMgQzgwLjA2NCwyMi41NTcgODAuMDc2LDIyLjU1MyA4MC4wODgsMjIuNTUgTDg3LjM3MiwxOC4zNDQgQzg4LjAzOCwxNy45NTkgODguNzg0LDE3Ljc1NiA4OS41MjksMTcuNzU2IEM5MC45NTYsMTcuNzU2IDkyLjIwMSwxOC40NzIgOTIuODU4LDE5LjY3IEw5Ni4xMDcsMjUuNTk5IEM5Ni4xMzgsMjUuNjU0IDk2LjExOCwyNS43MjQgOTYuMDYzLDI1Ljc1NiBMMTIuNTQ1LDczLjk4NSBDMTIuNTI2LDczLjk5NiAxMi41MDYsNzQuMDAxIDEyLjQ4Niw3NC4wMDEgTDEyLjQ4Niw3NC4wMDEgWiBNNjIuMDE2LDE2Ljk5NyBDNjEuMzEyLDE2Ljk5NyA2MC42MDYsMTcuMTkgNTkuOTc1LDE3LjU1NCBMMy45NjUsNDkuODk5IEMyLjA4Myw1MC45ODUgMS4zNDEsNTMuMzA4IDIuMzEsNTUuMDc4IEwxMi41MzEsNzMuNzIzIEw5NS44NDgsMjUuNjExIEw5Mi42NTMsMTkuNzgyIEM5Mi4wMzgsMTguNjYgOTAuODcsMTcuOTkgODkuNTI5LDE3Ljk5IEM4OC44MjUsMTcuOTkgODguMTE5LDE4LjE4MiA4Ny40ODksMTguNTQ3IEw4MC4xNzIsMjIuNzcyIEM4MC4xNjEsMjIuNzc4IDgwLjE0OSwyMi43ODIgODAuMTM3LDIyLjc4NSBDNzguMzQ2LDIzLjgxMSA3Ni4zNDEsMjQuMzU0IDc0LjMzNiwyNC4zNTQgQzcxLjU4OCwyNC4zNTQgNjkuMDMzLDIzLjM0NyA2Ny4xNDIsMjEuNTE5IEw2Ni44NjQsMjEuMjQ5IEM2Ni4yNzcsMjAuNjM0IDY1Ljc3NCwxOS45NDcgNjUuMzY3LDE5LjIwMyBDNjUuMzYsMTkuMTkyIDY1LjM1NiwxOS4xNzkgNjUuMzU0LDE5LjE2NiBMNjUuMTYzLDE4LjgxOSBDNjUuMTU0LDE4LjgxMSA2NS4xNDYsMTguODAxIDY1LjE0LDE4Ljc5IEM2NC41MjUsMTcuNjY3IDYzLjM1NywxNi45OTcgNjIuMDE2LDE2Ljk5NyBMNjIuMDE2LDE2Ljk5NyBaIiBpZD0iRmlsbC03IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTQyLjQzNCw0OC44MDggTDQyLjQzNCw0OC44MDggQzM5LjkyNCw0OC44MDcgMzcuNzM3LDQ3LjU1IDM2LjU4Miw0NS40NDMgQzM0Ljc3MSw0Mi4xMzkgMzYuMTQ0LDM3LjgwOSAzOS42NDEsMzUuNzg5IEw1MS45MzIsMjguNjkxIEM1My4xMDMsMjguMDE1IDU0LjQxMywyNy42NTggNTUuNzIxLDI3LjY1OCBDNTguMjMxLDI3LjY1OCA2MC40MTgsMjguOTE2IDYxLjU3MywzMS4wMjMgQzYzLjM4NCwzNC4zMjcgNjIuMDEyLDM4LjY1NyA1OC41MTQsNDAuNjc3IEw0Ni4yMjMsNDcuNzc1IEM0NS4wNTMsNDguNDUgNDMuNzQyLDQ4LjgwOCA0Mi40MzQsNDguODA4IEw0Mi40MzQsNDguODA4IFogTTU1LjcyMSwyOC4xMjUgQzU0LjQ5NSwyOC4xMjUgNTMuMjY1LDI4LjQ2MSA1Mi4xNjYsMjkuMDk2IEwzOS44NzUsMzYuMTk0IEMzNi41OTYsMzguMDg3IDM1LjMwMiw0Mi4xMzYgMzYuOTkyLDQ1LjIxOCBDMzguMDYzLDQ3LjE3MyA0MC4wOTgsNDguMzQgNDIuNDM0LDQ4LjM0IEM0My42NjEsNDguMzQgNDQuODksNDguMDA1IDQ1Ljk5LDQ3LjM3IEw1OC4yODEsNDAuMjcyIEM2MS41NiwzOC4zNzkgNjIuODUzLDM0LjMzIDYxLjE2NCwzMS4yNDggQzYwLjA5MiwyOS4yOTMgNTguMDU4LDI4LjEyNSA1NS43MjEsMjguMTI1IEw1NS43MjEsMjguMTI1IFoiIGlkPSJGaWxsLTgiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTQ5LjU4OCwyLjQwNyBDMTQ5LjU4OCwyLjQwNyAxNTUuNzY4LDUuOTc1IDE1Ni4zMjUsNi4yOTcgTDE1Ni4zMjUsNy4xODQgQzE1Ni4zMjUsNy4zNiAxNTYuMzM4LDcuNTQ0IDE1Ni4zNjIsNy43MzMgQzE1Ni4zNzMsNy44MTQgMTU2LjM4Miw3Ljg5NCAxNTYuMzksNy45NzUgQzE1Ni41Myw5LjM5IDE1Ny4zNjMsMTAuOTczIDE1OC40OTUsMTEuOTc0IEwxNjUuODkxLDE4LjUxOSBDMTY2LjA2OCwxOC42NzUgMTY2LjI0OSwxOC44MTQgMTY2LjQzMiwxOC45MzQgQzE2OC4wMTEsMTkuOTc0IDE2OS4zODIsMTkuNCAxNjkuNDk0LDE3LjY1MiBDMTY5LjU0MywxNi44NjggMTY5LjU1MSwxNi4wNTcgMTY5LjUxNywxNS4yMjMgTDE2OS41MTQsMTUuMDYzIEwxNjkuNTE0LDEzLjkxMiBDMTcwLjc4LDE0LjY0MiAxOTUuNTAxLDI4LjkxNSAxOTUuNTAxLDI4LjkxNSBMMTk1LjUwMSw4Mi45MTUgQzE5NS41MDEsODQuMDA1IDE5NC43MzEsODQuNDQ1IDE5My43ODEsODMuODk3IEwxNTEuMzA4LDU5LjM3NCBDMTUwLjM1OCw1OC44MjYgMTQ5LjU4OCw1Ny40OTcgMTQ5LjU4OCw1Ni40MDggTDE0OS41ODgsMjIuMzc1IiBpZD0iRmlsbC05IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE5NC41NTMsODQuMjUgQzE5NC4yOTYsODQuMjUgMTk0LjAxMyw4NC4xNjUgMTkzLjcyMiw4My45OTcgTDE1MS4yNSw1OS40NzYgQzE1MC4yNjksNTguOTA5IDE0OS40NzEsNTcuNTMzIDE0OS40NzEsNTYuNDA4IEwxNDkuNDcxLDIyLjM3NSBMMTQ5LjcwNSwyMi4zNzUgTDE0OS43MDUsNTYuNDA4IEMxNDkuNzA1LDU3LjQ1OSAxNTAuNDUsNTguNzQ0IDE1MS4zNjYsNTkuMjc0IEwxOTMuODM5LDgzLjc5NSBDMTk0LjI2Myw4NC4wNCAxOTQuNjU1LDg0LjA4MyAxOTQuOTQyLDgzLjkxNyBDMTk1LjIyNyw4My43NTMgMTk1LjM4NCw4My4zOTcgMTk1LjM4NCw4Mi45MTUgTDE5NS4zODQsMjguOTgyIEMxOTQuMTAyLDI4LjI0MiAxNzIuMTA0LDE1LjU0MiAxNjkuNjMxLDE0LjExNCBMMTY5LjYzNCwxNS4yMiBDMTY5LjY2OCwxNi4wNTIgMTY5LjY2LDE2Ljg3NCAxNjkuNjEsMTcuNjU5IEMxNjkuNTU2LDE4LjUwMyAxNjkuMjE0LDE5LjEyMyAxNjguNjQ3LDE5LjQwNSBDMTY4LjAyOCwxOS43MTQgMTY3LjE5NywxOS41NzggMTY2LjM2NywxOS4wMzIgQzE2Ni4xODEsMTguOTA5IDE2NS45OTUsMTguNzY2IDE2NS44MTQsMTguNjA2IEwxNTguNDE3LDEyLjA2MiBDMTU3LjI1OSwxMS4wMzYgMTU2LjQxOCw5LjQzNyAxNTYuMjc0LDcuOTg2IEMxNTYuMjY2LDcuOTA3IDE1Ni4yNTcsNy44MjcgMTU2LjI0Nyw3Ljc0OCBDMTU2LjIyMSw3LjU1NSAxNTYuMjA5LDcuMzY1IDE1Ni4yMDksNy4xODQgTDE1Ni4yMDksNi4zNjQgQzE1NS4zNzUsNS44ODMgMTQ5LjUyOSwyLjUwOCAxNDkuNTI5LDIuNTA4IEwxNDkuNjQ2LDIuMzA2IEMxNDkuNjQ2LDIuMzA2IDE1NS44MjcsNS44NzQgMTU2LjM4NCw2LjE5NiBMMTU2LjQ0Miw2LjIzIEwxNTYuNDQyLDcuMTg0IEMxNTYuNDQyLDcuMzU1IDE1Ni40NTQsNy41MzUgMTU2LjQ3OCw3LjcxNyBDMTU2LjQ4OSw3LjggMTU2LjQ5OSw3Ljg4MiAxNTYuNTA3LDcuOTYzIEMxNTYuNjQ1LDkuMzU4IDE1Ny40NTUsMTAuODk4IDE1OC41NzIsMTEuODg2IEwxNjUuOTY5LDE4LjQzMSBDMTY2LjE0MiwxOC41ODQgMTY2LjMxOSwxOC43MiAxNjYuNDk2LDE4LjgzNyBDMTY3LjI1NCwxOS4zMzYgMTY4LDE5LjQ2NyAxNjguNTQzLDE5LjE5NiBDMTY5LjAzMywxOC45NTMgMTY5LjMyOSwxOC40MDEgMTY5LjM3NywxNy42NDUgQzE2OS40MjcsMTYuODY3IDE2OS40MzQsMTYuMDU0IDE2OS40MDEsMTUuMjI4IEwxNjkuMzk3LDE1LjA2NSBMMTY5LjM5NywxMy43MSBMMTY5LjU3MiwxMy44MSBDMTcwLjgzOSwxNC41NDEgMTk1LjU1OSwyOC44MTQgMTk1LjU1OSwyOC44MTQgTDE5NS42MTgsMjguODQ3IEwxOTUuNjE4LDgyLjkxNSBDMTk1LjYxOCw4My40ODQgMTk1LjQyLDgzLjkxMSAxOTUuMDU5LDg0LjExOSBDMTk0LjkwOCw4NC4yMDYgMTk0LjczNyw4NC4yNSAxOTQuNTUzLDg0LjI1IiBpZD0iRmlsbC0xMCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNDUuNjg1LDU2LjE2MSBMMTY5LjgsNzAuMDgzIEwxNDMuODIyLDg1LjA4MSBMMTQyLjM2LDg0Ljc3NCBDMTM1LjgyNiw4Mi42MDQgMTI4LjczMiw4MS4wNDYgMTIxLjM0MSw4MC4xNTggQzExNi45NzYsNzkuNjM0IDExMi42NzgsODEuMjU0IDExMS43NDMsODMuNzc4IEMxMTEuNTA2LDg0LjQxNCAxMTEuNTAzLDg1LjA3MSAxMTEuNzMyLDg1LjcwNiBDMTEzLjI3LDg5Ljk3MyAxMTUuOTY4LDk0LjA2OSAxMTkuNzI3LDk3Ljg0MSBMMTIwLjI1OSw5OC42ODYgQzEyMC4yNiw5OC42ODUgOTQuMjgyLDExMy42ODMgOTQuMjgyLDExMy42ODMgTDcwLjE2Nyw5OS43NjEgTDE0NS42ODUsNTYuMTYxIiBpZD0iRmlsbC0xMSIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik05NC4yODIsMTEzLjgxOCBMOTQuMjIzLDExMy43ODUgTDY5LjkzMyw5OS43NjEgTDcwLjEwOCw5OS42NiBMMTQ1LjY4NSw1Ni4wMjYgTDE0NS43NDMsNTYuMDU5IEwxNzAuMDMzLDcwLjA4MyBMMTQzLjg0Miw4NS4yMDUgTDE0My43OTcsODUuMTk1IEMxNDMuNzcyLDg1LjE5IDE0Mi4zMzYsODQuODg4IDE0Mi4zMzYsODQuODg4IEMxMzUuNzg3LDgyLjcxNCAxMjguNzIzLDgxLjE2MyAxMjEuMzI3LDgwLjI3NCBDMTIwLjc4OCw4MC4yMDkgMTIwLjIzNiw4MC4xNzcgMTE5LjY4OSw4MC4xNzcgQzExNS45MzEsODAuMTc3IDExMi42MzUsODEuNzA4IDExMS44NTIsODMuODE5IEMxMTEuNjI0LDg0LjQzMiAxMTEuNjIxLDg1LjA1MyAxMTEuODQyLDg1LjY2NyBDMTEzLjM3Nyw4OS45MjUgMTE2LjA1OCw5My45OTMgMTE5LjgxLDk3Ljc1OCBMMTE5LjgyNiw5Ny43NzkgTDEyMC4zNTIsOTguNjE0IEMxMjAuMzU0LDk4LjYxNyAxMjAuMzU2LDk4LjYyIDEyMC4zNTgsOTguNjI0IEwxMjAuNDIyLDk4LjcyNiBMMTIwLjMxNyw5OC43ODcgQzEyMC4yNjQsOTguODE4IDk0LjU5OSwxMTMuNjM1IDk0LjM0LDExMy43ODUgTDk0LjI4MiwxMTMuODE4IEw5NC4yODIsMTEzLjgxOCBaIE03MC40MDEsOTkuNzYxIEw5NC4yODIsMTEzLjU0OSBMMTE5LjA4NCw5OS4yMjkgQzExOS42Myw5OC45MTQgMTE5LjkzLDk4Ljc0IDEyMC4xMDEsOTguNjU0IEwxMTkuNjM1LDk3LjkxNCBDMTE1Ljg2NCw5NC4xMjcgMTEzLjE2OCw5MC4wMzMgMTExLjYyMiw4NS43NDYgQzExMS4zODIsODUuMDc5IDExMS4zODYsODQuNDA0IDExMS42MzMsODMuNzM4IEMxMTIuNDQ4LDgxLjUzOSAxMTUuODM2LDc5Ljk0MyAxMTkuNjg5LDc5Ljk0MyBDMTIwLjI0Niw3OS45NDMgMTIwLjgwNiw3OS45NzYgMTIxLjM1NSw4MC4wNDIgQzEyOC43NjcsODAuOTMzIDEzNS44NDYsODIuNDg3IDE0Mi4zOTYsODQuNjYzIEMxNDMuMjMyLDg0LjgzOCAxNDMuNjExLDg0LjkxNyAxNDMuNzg2LDg0Ljk2NyBMMTY5LjU2Niw3MC4wODMgTDE0NS42ODUsNTYuMjk1IEw3MC40MDEsOTkuNzYxIEw3MC40MDEsOTkuNzYxIFoiIGlkPSJGaWxsLTEyIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2Ny4yMywxOC45NzkgTDE2Ny4yMyw2OS44NSBMMTM5LjkwOSw4NS42MjMgTDEzMy40NDgsNzEuNDU2IEMxMzIuNTM4LDY5LjQ2IDEzMC4wMiw2OS43MTggMTI3LjgyNCw3Mi4wMyBDMTI2Ljc2OSw3My4xNCAxMjUuOTMxLDc0LjU4NSAxMjUuNDk0LDc2LjA0OCBMMTE5LjAzNCw5Ny42NzYgTDkxLjcxMiwxMTMuNDUgTDkxLjcxMiw2Mi41NzkgTDE2Ny4yMywxOC45NzkiIGlkPSJGaWxsLTEzIiBmaWxsPSIjRkZGRkZGIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTkxLjcxMiwxMTMuNTY3IEM5MS42OTIsMTEzLjU2NyA5MS42NzIsMTEzLjU2MSA5MS42NTMsMTEzLjU1MSBDOTEuNjE4LDExMy41MyA5MS41OTUsMTEzLjQ5MiA5MS41OTUsMTEzLjQ1IEw5MS41OTUsNjIuNTc5IEM5MS41OTUsNjIuNTM3IDkxLjYxOCw2Mi40OTkgOTEuNjUzLDYyLjQ3OCBMMTY3LjE3MiwxOC44NzggQzE2Ny4yMDgsMTguODU3IDE2Ny4yNTIsMTguODU3IDE2Ny4yODgsMTguODc4IEMxNjcuMzI0LDE4Ljg5OSAxNjcuMzQ3LDE4LjkzNyAxNjcuMzQ3LDE4Ljk3OSBMMTY3LjM0Nyw2OS44NSBDMTY3LjM0Nyw2OS44OTEgMTY3LjMyNCw2OS45MyAxNjcuMjg4LDY5Ljk1IEwxMzkuOTY3LDg1LjcyNSBDMTM5LjkzOSw4NS43NDEgMTM5LjkwNSw4NS43NDUgMTM5Ljg3Myw4NS43MzUgQzEzOS44NDIsODUuNzI1IDEzOS44MTYsODUuNzAyIDEzOS44MDIsODUuNjcyIEwxMzMuMzQyLDcxLjUwNCBDMTMyLjk2Nyw3MC42ODIgMTMyLjI4LDcwLjIyOSAxMzEuNDA4LDcwLjIyOSBDMTMwLjMxOSw3MC4yMjkgMTI5LjA0NCw3MC45MTUgMTI3LjkwOCw3Mi4xMSBDMTI2Ljg3NCw3My4yIDEyNi4wMzQsNzQuNjQ3IDEyNS42MDYsNzYuMDgyIEwxMTkuMTQ2LDk3LjcwOSBDMTE5LjEzNyw5Ny43MzggMTE5LjExOCw5Ny43NjIgMTE5LjA5Miw5Ny43NzcgTDkxLjc3LDExMy41NTEgQzkxLjc1MiwxMTMuNTYxIDkxLjczMiwxMTMuNTY3IDkxLjcxMiwxMTMuNTY3IEw5MS43MTIsMTEzLjU2NyBaIE05MS44MjksNjIuNjQ3IEw5MS44MjksMTEzLjI0OCBMMTE4LjkzNSw5Ny41OTggTDEyNS4zODIsNzYuMDE1IEMxMjUuODI3LDc0LjUyNSAxMjYuNjY0LDczLjA4MSAxMjcuNzM5LDcxLjk1IEMxMjguOTE5LDcwLjcwOCAxMzAuMjU2LDY5Ljk5NiAxMzEuNDA4LDY5Ljk5NiBDMTMyLjM3Nyw2OS45OTYgMTMzLjEzOSw3MC40OTcgMTMzLjU1NCw3MS40MDcgTDEzOS45NjEsODUuNDU4IEwxNjcuMTEzLDY5Ljc4MiBMMTY3LjExMywxOS4xODEgTDkxLjgyOSw2Mi42NDcgTDkxLjgyOSw2Mi42NDcgWiIgaWQ9IkZpbGwtMTQiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTY4LjU0MywxOS4yMTMgTDE2OC41NDMsNzAuMDgzIEwxNDEuMjIxLDg1Ljg1NyBMMTM0Ljc2MSw3MS42ODkgQzEzMy44NTEsNjkuNjk0IDEzMS4zMzMsNjkuOTUxIDEyOS4xMzcsNzIuMjYzIEMxMjguMDgyLDczLjM3NCAxMjcuMjQ0LDc0LjgxOSAxMjYuODA3LDc2LjI4MiBMMTIwLjM0Niw5Ny45MDkgTDkzLjAyNSwxMTMuNjgzIEw5My4wMjUsNjIuODEzIEwxNjguNTQzLDE5LjIxMyIgaWQ9IkZpbGwtMTUiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTMuMDI1LDExMy44IEM5My4wMDUsMTEzLjggOTIuOTg0LDExMy43OTUgOTIuOTY2LDExMy43ODUgQzkyLjkzMSwxMTMuNzY0IDkyLjkwOCwxMTMuNzI1IDkyLjkwOCwxMTMuNjg0IEw5Mi45MDgsNjIuODEzIEM5Mi45MDgsNjIuNzcxIDkyLjkzMSw2Mi43MzMgOTIuOTY2LDYyLjcxMiBMMTY4LjQ4NCwxOS4xMTIgQzE2OC41MiwxOS4wOSAxNjguNTY1LDE5LjA5IDE2OC42MDEsMTkuMTEyIEMxNjguNjM3LDE5LjEzMiAxNjguNjYsMTkuMTcxIDE2OC42NiwxOS4yMTIgTDE2OC42Niw3MC4wODMgQzE2OC42Niw3MC4xMjUgMTY4LjYzNyw3MC4xNjQgMTY4LjYwMSw3MC4xODQgTDE0MS4yOCw4NS45NTggQzE0MS4yNTEsODUuOTc1IDE0MS4yMTcsODUuOTc5IDE0MS4xODYsODUuOTY4IEMxNDEuMTU0LDg1Ljk1OCAxNDEuMTI5LDg1LjkzNiAxNDEuMTE1LDg1LjkwNiBMMTM0LjY1NSw3MS43MzggQzEzNC4yOCw3MC45MTUgMTMzLjU5Myw3MC40NjMgMTMyLjcyLDcwLjQ2MyBDMTMxLjYzMiw3MC40NjMgMTMwLjM1Nyw3MS4xNDggMTI5LjIyMSw3Mi4zNDQgQzEyOC4xODYsNzMuNDMzIDEyNy4zNDcsNzQuODgxIDEyNi45MTksNzYuMzE1IEwxMjAuNDU4LDk3Ljk0MyBDMTIwLjQ1LDk3Ljk3MiAxMjAuNDMxLDk3Ljk5NiAxMjAuNDA1LDk4LjAxIEw5My4wODMsMTEzLjc4NSBDOTMuMDY1LDExMy43OTUgOTMuMDQ1LDExMy44IDkzLjAyNSwxMTMuOCBMOTMuMDI1LDExMy44IFogTTkzLjE0Miw2Mi44ODEgTDkzLjE0MiwxMTMuNDgxIEwxMjAuMjQ4LDk3LjgzMiBMMTI2LjY5NSw3Ni4yNDggQzEyNy4xNCw3NC43NTggMTI3Ljk3Nyw3My4zMTUgMTI5LjA1Miw3Mi4xODMgQzEzMC4yMzEsNzAuOTQyIDEzMS41NjgsNzAuMjI5IDEzMi43Miw3MC4yMjkgQzEzMy42ODksNzAuMjI5IDEzNC40NTIsNzAuNzMxIDEzNC44NjcsNzEuNjQxIEwxNDEuMjc0LDg1LjY5MiBMMTY4LjQyNiw3MC4wMTYgTDE2OC40MjYsMTkuNDE1IEw5My4xNDIsNjIuODgxIEw5My4xNDIsNjIuODgxIFoiIGlkPSJGaWxsLTE2IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2OS44LDcwLjA4MyBMMTQyLjQ3OCw4NS44NTcgTDEzNi4wMTgsNzEuNjg5IEMxMzUuMTA4LDY5LjY5NCAxMzIuNTksNjkuOTUxIDEzMC4zOTMsNzIuMjYzIEMxMjkuMzM5LDczLjM3NCAxMjguNSw3NC44MTkgMTI4LjA2NCw3Ni4yODIgTDEyMS42MDMsOTcuOTA5IEw5NC4yODIsMTEzLjY4MyBMOTQuMjgyLDYyLjgxMyBMMTY5LjgsMTkuMjEzIEwxNjkuOCw3MC4wODMgWiIgaWQ9IkZpbGwtMTciIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNOTQuMjgyLDExMy45MTcgQzk0LjI0MSwxMTMuOTE3IDk0LjIwMSwxMTMuOTA3IDk0LjE2NSwxMTMuODg2IEM5NC4wOTMsMTEzLjg0NSA5NC4wNDgsMTEzLjc2NyA5NC4wNDgsMTEzLjY4NCBMOTQuMDQ4LDYyLjgxMyBDOTQuMDQ4LDYyLjczIDk0LjA5Myw2Mi42NTIgOTQuMTY1LDYyLjYxMSBMMTY5LjY4MywxOS4wMSBDMTY5Ljc1NSwxOC45NjkgMTY5Ljg0NCwxOC45NjkgMTY5LjkxNywxOS4wMSBDMTY5Ljk4OSwxOS4wNTIgMTcwLjAzMywxOS4xMjkgMTcwLjAzMywxOS4yMTIgTDE3MC4wMzMsNzAuMDgzIEMxNzAuMDMzLDcwLjE2NiAxNjkuOTg5LDcwLjI0NCAxNjkuOTE3LDcwLjI4NSBMMTQyLjU5NSw4Ni4wNiBDMTQyLjUzOCw4Ni4wOTIgMTQyLjQ2OSw4Ni4xIDE0Mi40MDcsODYuMDggQzE0Mi4zNDQsODYuMDYgMTQyLjI5Myw4Ni4wMTQgMTQyLjI2Niw4NS45NTQgTDEzNS44MDUsNzEuNzg2IEMxMzUuNDQ1LDcwLjk5NyAxMzQuODEzLDcwLjU4IDEzMy45NzcsNzAuNTggQzEzMi45MjEsNzAuNTggMTMxLjY3Niw3MS4yNTIgMTMwLjU2Miw3Mi40MjQgQzEyOS41NCw3My41MDEgMTI4LjcxMSw3NC45MzEgMTI4LjI4Nyw3Ni4zNDggTDEyMS44MjcsOTcuOTc2IEMxMjEuODEsOTguMDM0IDEyMS43NzEsOTguMDgyIDEyMS43Miw5OC4xMTIgTDk0LjM5OCwxMTMuODg2IEM5NC4zNjIsMTEzLjkwNyA5NC4zMjIsMTEzLjkxNyA5NC4yODIsMTEzLjkxNyBMOTQuMjgyLDExMy45MTcgWiBNOTQuNTE1LDYyLjk0OCBMOTQuNTE1LDExMy4yNzkgTDEyMS40MDYsOTcuNzU0IEwxMjcuODQsNzYuMjE1IEMxMjguMjksNzQuNzA4IDEyOS4xMzcsNzMuMjQ3IDEzMC4yMjQsNzIuMTAzIEMxMzEuNDI1LDcwLjgzOCAxMzIuNzkzLDcwLjExMiAxMzMuOTc3LDcwLjExMiBDMTM0Ljk5NSw3MC4xMTIgMTM1Ljc5NSw3MC42MzggMTM2LjIzLDcxLjU5MiBMMTQyLjU4NCw4NS41MjYgTDE2OS41NjYsNjkuOTQ4IEwxNjkuNTY2LDE5LjYxNyBMOTQuNTE1LDYyLjk0OCBMOTQuNTE1LDYyLjk0OCBaIiBpZD0iRmlsbC0xOCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMDkuODk0LDkyLjk0MyBMMTA5Ljg5NCw5Mi45NDMgQzEwOC4xMiw5Mi45NDMgMTA2LjY1Myw5Mi4yMTggMTA1LjY1LDkwLjgyMyBDMTA1LjU4Myw5MC43MzEgMTA1LjU5Myw5MC42MSAxMDUuNjczLDkwLjUyOSBDMTA1Ljc1Myw5MC40NDggMTA1Ljg4LDkwLjQ0IDEwNS45NzQsOTAuNTA2IEMxMDYuNzU0LDkxLjA1MyAxMDcuNjc5LDkxLjMzMyAxMDguNzI0LDkxLjMzMyBDMTEwLjA0Nyw5MS4zMzMgMTExLjQ3OCw5MC44OTQgMTEyLjk4LDkwLjAyNyBDMTE4LjI5MSw4Ni45NiAxMjIuNjExLDc5LjUwOSAxMjIuNjExLDczLjQxNiBDMTIyLjYxMSw3MS40ODkgMTIyLjE2OSw2OS44NTYgMTIxLjMzMyw2OC42OTIgQzEyMS4yNjYsNjguNiAxMjEuMjc2LDY4LjQ3MyAxMjEuMzU2LDY4LjM5MiBDMTIxLjQzNiw2OC4zMTEgMTIxLjU2Myw2OC4yOTkgMTIxLjY1Niw2OC4zNjUgQzEyMy4zMjcsNjkuNTM3IDEyNC4yNDcsNzEuNzQ2IDEyNC4yNDcsNzQuNTg0IEMxMjQuMjQ3LDgwLjgyNiAxMTkuODIxLDg4LjQ0NyAxMTQuMzgyLDkxLjU4NyBDMTEyLjgwOCw5Mi40OTUgMTExLjI5OCw5Mi45NDMgMTA5Ljg5NCw5Mi45NDMgTDEwOS44OTQsOTIuOTQzIFogTTEwNi45MjUsOTEuNDAxIEMxMDcuNzM4LDkyLjA1MiAxMDguNzQ1LDkyLjI3OCAxMDkuODkzLDkyLjI3OCBMMTA5Ljg5NCw5Mi4yNzggQzExMS4yMTUsOTIuMjc4IDExMi42NDcsOTEuOTUxIDExNC4xNDgsOTEuMDg0IEMxMTkuNDU5LDg4LjAxNyAxMjMuNzgsODAuNjIxIDEyMy43OCw3NC41MjggQzEyMy43OCw3Mi41NDkgMTIzLjMxNyw3MC45MjkgMTIyLjQ1NCw2OS43NjcgQzEyMi44NjUsNzAuODAyIDEyMy4wNzksNzIuMDQyIDEyMy4wNzksNzMuNDAyIEMxMjMuMDc5LDc5LjY0NSAxMTguNjUzLDg3LjI4NSAxMTMuMjE0LDkwLjQyNSBDMTExLjY0LDkxLjMzNCAxMTAuMTMsOTEuNzQyIDEwOC43MjQsOTEuNzQyIEMxMDguMDgzLDkxLjc0MiAxMDcuNDgxLDkxLjU5MyAxMDYuOTI1LDkxLjQwMSBMMTA2LjkyNSw5MS40MDEgWiIgaWQ9IkZpbGwtMTkiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjA5Nyw5MC4yMyBDMTE4LjQ4MSw4Ny4xMjIgMTIyLjg0NSw3OS41OTQgMTIyLjg0NSw3My40MTYgQzEyMi44NDUsNzEuMzY1IDEyMi4zNjIsNjkuNzI0IDEyMS41MjIsNjguNTU2IEMxMTkuNzM4LDY3LjMwNCAxMTcuMTQ4LDY3LjM2MiAxMTQuMjY1LDY5LjAyNiBDMTA4Ljg4MSw3Mi4xMzQgMTA0LjUxNyw3OS42NjIgMTA0LjUxNyw4NS44NCBDMTA0LjUxNyw4Ny44OTEgMTA1LDg5LjUzMiAxMDUuODQsOTAuNyBDMTA3LjYyNCw5MS45NTIgMTEwLjIxNCw5MS44OTQgMTEzLjA5Nyw5MC4yMyIgaWQ9IkZpbGwtMjAiIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTA4LjcyNCw5MS42MTQgTDEwOC43MjQsOTEuNjE0IEMxMDcuNTgyLDkxLjYxNCAxMDYuNTY2LDkxLjQwMSAxMDUuNzA1LDkwLjc5NyBDMTA1LjY4NCw5MC43ODMgMTA1LjY2NSw5MC44MTEgMTA1LjY1LDkwLjc5IEMxMDQuNzU2LDg5LjU0NiAxMDQuMjgzLDg3Ljg0MiAxMDQuMjgzLDg1LjgxNyBDMTA0LjI4Myw3OS41NzUgMTA4LjcwOSw3MS45NTMgMTE0LjE0OCw2OC44MTIgQzExNS43MjIsNjcuOTA0IDExNy4yMzIsNjcuNDQ5IDExOC42MzgsNjcuNDQ5IEMxMTkuNzgsNjcuNDQ5IDEyMC43OTYsNjcuNzU4IDEyMS42NTYsNjguMzYyIEMxMjEuNjc4LDY4LjM3NyAxMjEuNjk3LDY4LjM5NyAxMjEuNzEyLDY4LjQxOCBDMTIyLjYwNiw2OS42NjIgMTIzLjA3OSw3MS4zOSAxMjMuMDc5LDczLjQxNSBDMTIzLjA3OSw3OS42NTggMTE4LjY1Myw4Ny4xOTggMTEzLjIxNCw5MC4zMzggQzExMS42NCw5MS4yNDcgMTEwLjEzLDkxLjYxNCAxMDguNzI0LDkxLjYxNCBMMTA4LjcyNCw5MS42MTQgWiBNMTA2LjAwNiw5MC41MDUgQzEwNi43OCw5MS4wMzcgMTA3LjY5NCw5MS4yODEgMTA4LjcyNCw5MS4yODEgQzExMC4wNDcsOTEuMjgxIDExMS40NzgsOTAuODY4IDExMi45OCw5MC4wMDEgQzExOC4yOTEsODYuOTM1IDEyMi42MTEsNzkuNDk2IDEyMi42MTEsNzMuNDAzIEMxMjIuNjExLDcxLjQ5NCAxMjIuMTc3LDY5Ljg4IDEyMS4zNTYsNjguNzE4IEMxMjAuNTgyLDY4LjE4NSAxMTkuNjY4LDY3LjkxOSAxMTguNjM4LDY3LjkxOSBDMTE3LjMxNSw2Ny45MTkgMTE1Ljg4Myw2OC4zNiAxMTQuMzgyLDY5LjIyNyBDMTA5LjA3MSw3Mi4yOTMgMTA0Ljc1MSw3OS43MzMgMTA0Ljc1MSw4NS44MjYgQzEwNC43NTEsODcuNzM1IDEwNS4xODUsODkuMzQzIDEwNi4wMDYsOTAuNTA1IEwxMDYuMDA2LDkwLjUwNSBaIiBpZD0iRmlsbC0yMSIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNDkuMzE4LDcuMjYyIEwxMzkuMzM0LDE2LjE0IEwxNTUuMjI3LDI3LjE3MSBMMTYwLjgxNiwyMS4wNTkgTDE0OS4zMTgsNy4yNjIiIGlkPSJGaWxsLTIyIiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE2OS42NzYsMTMuODQgTDE1OS45MjgsMTkuNDY3IEMxNTYuMjg2LDIxLjU3IDE1MC40LDIxLjU4IDE0Ni43ODEsMTkuNDkxIEMxNDMuMTYxLDE3LjQwMiAxNDMuMTgsMTQuMDAzIDE0Ni44MjIsMTEuOSBMMTU2LjMxNyw2LjI5MiBMMTQ5LjU4OCwyLjQwNyBMNjcuNzUyLDQ5LjQ3OCBMMTEzLjY3NSw3NS45OTIgTDExNi43NTYsNzQuMjEzIEMxMTcuMzg3LDczLjg0OCAxMTcuNjI1LDczLjMxNSAxMTcuMzc0LDcyLjgyMyBDMTE1LjAxNyw2OC4xOTEgMTE0Ljc4MSw2My4yNzcgMTE2LjY5MSw1OC41NjEgQzEyMi4zMjksNDQuNjQxIDE0MS4yLDMzLjc0NiAxNjUuMzA5LDMwLjQ5MSBDMTczLjQ3OCwyOS4zODggMTgxLjk4OSwyOS41MjQgMTkwLjAxMywzMC44ODUgQzE5MC44NjUsMzEuMDMgMTkxLjc4OSwzMC44OTMgMTkyLjQyLDMwLjUyOCBMMTk1LjUwMSwyOC43NSBMMTY5LjY3NiwxMy44NCIgaWQ9IkZpbGwtMjMiIGZpbGw9IiNGQUZBRkEiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjY3NSw3Ni40NTkgQzExMy41OTQsNzYuNDU5IDExMy41MTQsNzYuNDM4IDExMy40NDIsNzYuMzk3IEw2Ny41MTgsNDkuODgyIEM2Ny4zNzQsNDkuNzk5IDY3LjI4NCw0OS42NDUgNjcuMjg1LDQ5LjQ3OCBDNjcuMjg1LDQ5LjMxMSA2Ny4zNzQsNDkuMTU3IDY3LjUxOSw0OS4wNzMgTDE0OS4zNTUsMi4wMDIgQzE0OS40OTksMS45MTkgMTQ5LjY3NywxLjkxOSAxNDkuODIxLDIuMDAyIEwxNTYuNTUsNS44ODcgQzE1Ni43NzQsNi4wMTcgMTU2Ljg1LDYuMzAyIDE1Ni43MjIsNi41MjYgQzE1Ni41OTIsNi43NDkgMTU2LjMwNyw2LjgyNiAxNTYuMDgzLDYuNjk2IEwxNDkuNTg3LDIuOTQ2IEw2OC42ODcsNDkuNDc5IEwxMTMuNjc1LDc1LjQ1MiBMMTE2LjUyMyw3My44MDggQzExNi43MTUsNzMuNjk3IDExNy4xNDMsNzMuMzk5IDExNi45NTgsNzMuMDM1IEMxMTQuNTQyLDY4LjI4NyAxMTQuMyw2My4yMjEgMTE2LjI1OCw1OC4zODUgQzExOS4wNjQsNTEuNDU4IDEyNS4xNDMsNDUuMTQzIDEzMy44NCw0MC4xMjIgQzE0Mi40OTcsMzUuMTI0IDE1My4zNTgsMzEuNjMzIDE2NS4yNDcsMzAuMDI4IEMxNzMuNDQ1LDI4LjkyMSAxODIuMDM3LDI5LjA1OCAxOTAuMDkxLDMwLjQyNSBDMTkwLjgzLDMwLjU1IDE5MS42NTIsMzAuNDMyIDE5Mi4xODYsMzAuMTI0IEwxOTQuNTY3LDI4Ljc1IEwxNjkuNDQyLDE0LjI0NCBDMTY5LjIxOSwxNC4xMTUgMTY5LjE0MiwxMy44MjkgMTY5LjI3MSwxMy42MDYgQzE2OS40LDEzLjM4MiAxNjkuNjg1LDEzLjMwNiAxNjkuOTA5LDEzLjQzNSBMMTk1LjczNCwyOC4zNDUgQzE5NS44NzksMjguNDI4IDE5NS45NjgsMjguNTgzIDE5NS45NjgsMjguNzUgQzE5NS45NjgsMjguOTE2IDE5NS44NzksMjkuMDcxIDE5NS43MzQsMjkuMTU0IEwxOTIuNjUzLDMwLjkzMyBDMTkxLjkzMiwzMS4zNSAxOTAuODksMzEuNTA4IDE4OS45MzUsMzEuMzQ2IEMxODEuOTcyLDI5Ljk5NSAxNzMuNDc4LDI5Ljg2IDE2NS4zNzIsMzAuOTU0IEMxNTMuNjAyLDMyLjU0MyAxNDIuODYsMzUuOTkzIDEzNC4zMDcsNDAuOTMxIEMxMjUuNzkzLDQ1Ljg0NyAxMTkuODUxLDUyLjAwNCAxMTcuMTI0LDU4LjczNiBDMTE1LjI3LDYzLjMxNCAxMTUuNTAxLDY4LjExMiAxMTcuNzksNzIuNjExIEMxMTguMTYsNzMuMzM2IDExNy44NDUsNzQuMTI0IDExNi45OSw3NC42MTcgTDExMy45MDksNzYuMzk3IEMxMTMuODM2LDc2LjQzOCAxMTMuNzU2LDc2LjQ1OSAxMTMuNjc1LDc2LjQ1OSIgaWQ9IkZpbGwtMjQiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUzLjMxNiwyMS4yNzkgQzE1MC45MDMsMjEuMjc5IDE0OC40OTUsMjAuNzUxIDE0Ni42NjQsMTkuNjkzIEMxNDQuODQ2LDE4LjY0NCAxNDMuODQ0LDE3LjIzMiAxNDMuODQ0LDE1LjcxOCBDMTQzLjg0NCwxNC4xOTEgMTQ0Ljg2LDEyLjc2MyAxNDYuNzA1LDExLjY5OCBMMTU2LjE5OCw2LjA5MSBDMTU2LjMwOSw2LjAyNSAxNTYuNDUyLDYuMDYyIDE1Ni41MTgsNi4xNzMgQzE1Ni41ODMsNi4yODQgMTU2LjU0Nyw2LjQyNyAxNTYuNDM2LDYuNDkzIEwxNDYuOTQsMTIuMTAyIEMxNDUuMjQ0LDEzLjA4MSAxNDQuMzEyLDE0LjM2NSAxNDQuMzEyLDE1LjcxOCBDMTQ0LjMxMiwxNy4wNTggMTQ1LjIzLDE4LjMyNiAxNDYuODk3LDE5LjI4OSBDMTUwLjQ0NiwyMS4zMzggMTU2LjI0LDIxLjMyNyAxNTkuODExLDE5LjI2NSBMMTY5LjU1OSwxMy42MzcgQzE2OS42NywxMy41NzMgMTY5LjgxMywxMy42MTEgMTY5Ljg3OCwxMy43MjMgQzE2OS45NDMsMTMuODM0IDE2OS45MDQsMTMuOTc3IDE2OS43OTMsMTQuMDQyIEwxNjAuMDQ1LDE5LjY3IEMxNTguMTg3LDIwLjc0MiAxNTUuNzQ5LDIxLjI3OSAxNTMuMzE2LDIxLjI3OSIgaWQ9IkZpbGwtMjUiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEzLjY3NSw3NS45OTIgTDY3Ljc2Miw0OS40ODQiIGlkPSJGaWxsLTI2IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTExMy42NzUsNzYuMzQyIEMxMTMuNjE1LDc2LjM0MiAxMTMuNTU1LDc2LjMyNyAxMTMuNSw3Ni4yOTUgTDY3LjU4Nyw0OS43ODcgQzY3LjQxOSw0OS42OSA2Ny4zNjIsNDkuNDc2IDY3LjQ1OSw0OS4zMDkgQzY3LjU1Niw0OS4xNDEgNjcuNzcsNDkuMDgzIDY3LjkzNyw0OS4xOCBMMTEzLjg1LDc1LjY4OCBDMTE0LjAxOCw3NS43ODUgMTE0LjA3NSw3NiAxMTMuOTc4LDc2LjE2NyBDMTEzLjkxNCw3Ni4yNzkgMTEzLjc5Niw3Ni4zNDIgMTEzLjY3NSw3Ni4zNDIiIGlkPSJGaWxsLTI3IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTY3Ljc2Miw0OS40ODQgTDY3Ljc2MiwxMDMuNDg1IEM2Ny43NjIsMTA0LjU3NSA2OC41MzIsMTA1LjkwMyA2OS40ODIsMTA2LjQ1MiBMMTExLjk1NSwxMzAuOTczIEMxMTIuOTA1LDEzMS41MjIgMTEzLjY3NSwxMzEuMDgzIDExMy42NzUsMTI5Ljk5MyBMMTEzLjY3NSw3NS45OTIiIGlkPSJGaWxsLTI4IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTExMi43MjcsMTMxLjU2MSBDMTEyLjQzLDEzMS41NjEgMTEyLjEwNywxMzEuNDY2IDExMS43OCwxMzEuMjc2IEw2OS4zMDcsMTA2Ljc1NSBDNjguMjQ0LDEwNi4xNDIgNjcuNDEyLDEwNC43MDUgNjcuNDEyLDEwMy40ODUgTDY3LjQxMiw0OS40ODQgQzY3LjQxMiw0OS4yOSA2Ny41NjksNDkuMTM0IDY3Ljc2Miw0OS4xMzQgQzY3Ljk1Niw0OS4xMzQgNjguMTEzLDQ5LjI5IDY4LjExMyw0OS40ODQgTDY4LjExMywxMDMuNDg1IEM2OC4xMTMsMTA0LjQ0NSA2OC44MiwxMDUuNjY1IDY5LjY1NywxMDYuMTQ4IEwxMTIuMTMsMTMwLjY3IEMxMTIuNDc0LDEzMC44NjggMTEyLjc5MSwxMzAuOTEzIDExMywxMzAuNzkyIEMxMTMuMjA2LDEzMC42NzMgMTEzLjMyNSwxMzAuMzgxIDExMy4zMjUsMTI5Ljk5MyBMMTEzLjMyNSw3NS45OTIgQzExMy4zMjUsNzUuNzk4IDExMy40ODIsNzUuNjQxIDExMy42NzUsNzUuNjQxIEMxMTMuODY5LDc1LjY0MSAxMTQuMDI1LDc1Ljc5OCAxMTQuMDI1LDc1Ljk5MiBMMTE0LjAyNSwxMjkuOTkzIEMxMTQuMDI1LDEzMC42NDggMTEzLjc4NiwxMzEuMTQ3IDExMy4zNSwxMzEuMzk5IEMxMTMuMTYyLDEzMS41MDcgMTEyLjk1MiwxMzEuNTYxIDExMi43MjcsMTMxLjU2MSIgaWQ9IkZpbGwtMjkiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTEyLjg2LDQwLjUxMiBDMTEyLjg2LDQwLjUxMiAxMTIuODYsNDAuNTEyIDExMi44NTksNDAuNTEyIEMxMTAuNTQxLDQwLjUxMiAxMDguMzYsMzkuOTkgMTA2LjcxNywzOS4wNDEgQzEwNS4wMTIsMzguMDU3IDEwNC4wNzQsMzYuNzI2IDEwNC4wNzQsMzUuMjkyIEMxMDQuMDc0LDMzLjg0NyAxMDUuMDI2LDMyLjUwMSAxMDYuNzU0LDMxLjUwNCBMMTE4Ljc5NSwyNC41NTEgQzEyMC40NjMsMjMuNTg5IDEyMi42NjksMjMuMDU4IDEyNS4wMDcsMjMuMDU4IEMxMjcuMzI1LDIzLjA1OCAxMjkuNTA2LDIzLjU4MSAxMzEuMTUsMjQuNTMgQzEzMi44NTQsMjUuNTE0IDEzMy43OTMsMjYuODQ1IDEzMy43OTMsMjguMjc4IEMxMzMuNzkzLDI5LjcyNCAxMzIuODQxLDMxLjA2OSAxMzEuMTEzLDMyLjA2NyBMMTE5LjA3MSwzOS4wMTkgQzExNy40MDMsMzkuOTgyIDExNS4xOTcsNDAuNTEyIDExMi44Niw0MC41MTIgTDExMi44Niw0MC41MTIgWiBNMTI1LjAwNywyMy43NTkgQzEyMi43OSwyMy43NTkgMTIwLjcwOSwyNC4yNTYgMTE5LjE0NiwyNS4xNTggTDEwNy4xMDQsMzIuMTEgQzEwNS42MDIsMzIuOTc4IDEwNC43NzQsMzQuMTA4IDEwNC43NzQsMzUuMjkyIEMxMDQuNzc0LDM2LjQ2NSAxMDUuNTg5LDM3LjU4MSAxMDcuMDY3LDM4LjQzNCBDMTA4LjYwNSwzOS4zMjMgMTEwLjY2MywzOS44MTIgMTEyLjg1OSwzOS44MTIgTDExMi44NiwzOS44MTIgQzExNS4wNzYsMzkuODEyIDExNy4xNTgsMzkuMzE1IDExOC43MjEsMzguNDEzIEwxMzAuNzYyLDMxLjQ2IEMxMzIuMjY0LDMwLjU5MyAxMzMuMDkyLDI5LjQ2MyAxMzMuMDkyLDI4LjI3OCBDMTMzLjA5MiwyNy4xMDYgMTMyLjI3OCwyNS45OSAxMzAuOCwyNS4xMzYgQzEyOS4yNjEsMjQuMjQ4IDEyNy4yMDQsMjMuNzU5IDEyNS4wMDcsMjMuNzU5IEwxMjUuMDA3LDIzLjc1OSBaIiBpZD0iRmlsbC0zMCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNjUuNjMsMTYuMjE5IEwxNTkuODk2LDE5LjUzIEMxNTYuNzI5LDIxLjM1OCAxNTEuNjEsMjEuMzY3IDE0OC40NjMsMTkuNTUgQzE0NS4zMTYsMTcuNzMzIDE0NS4zMzIsMTQuNzc4IDE0OC40OTksMTIuOTQ5IEwxNTQuMjMzLDkuNjM5IEwxNjUuNjMsMTYuMjE5IiBpZD0iRmlsbC0zMSIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xNTQuMjMzLDEwLjQ0OCBMMTY0LjIyOCwxNi4yMTkgTDE1OS41NDYsMTguOTIzIEMxNTguMTEyLDE5Ljc1IDE1Ni4xOTQsMjAuMjA2IDE1NC4xNDcsMjAuMjA2IEMxNTIuMTE4LDIwLjIwNiAxNTAuMjI0LDE5Ljc1NyAxNDguODE0LDE4Ljk0MyBDMTQ3LjUyNCwxOC4xOTkgMTQ2LjgxNCwxNy4yNDkgMTQ2LjgxNCwxNi4yNjkgQzE0Ni44MTQsMTUuMjc4IDE0Ny41MzcsMTQuMzE0IDE0OC44NSwxMy41NTYgTDE1NC4yMzMsMTAuNDQ4IE0xNTQuMjMzLDkuNjM5IEwxNDguNDk5LDEyLjk0OSBDMTQ1LjMzMiwxNC43NzggMTQ1LjMxNiwxNy43MzMgMTQ4LjQ2MywxOS41NSBDMTUwLjAzMSwyMC40NTUgMTUyLjA4NiwyMC45MDcgMTU0LjE0NywyMC45MDcgQzE1Ni4yMjQsMjAuOTA3IDE1OC4zMDYsMjAuNDQ3IDE1OS44OTYsMTkuNTMgTDE2NS42MywxNi4yMTkgTDE1NC4yMzMsOS42MzkiIGlkPSJGaWxsLTMyIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0NS40NDUsNzIuNjY3IEwxNDUuNDQ1LDcyLjY2NyBDMTQzLjY3Miw3Mi42NjcgMTQyLjIwNCw3MS44MTcgMTQxLjIwMiw3MC40MjIgQzE0MS4xMzUsNzAuMzMgMTQxLjE0NSw3MC4xNDcgMTQxLjIyNSw3MC4wNjYgQzE0MS4zMDUsNjkuOTg1IDE0MS40MzIsNjkuOTQ2IDE0MS41MjUsNzAuMDExIEMxNDIuMzA2LDcwLjU1OSAxNDMuMjMxLDcwLjgyMyAxNDQuMjc2LDcwLjgyMiBDMTQ1LjU5OCw3MC44MjIgMTQ3LjAzLDcwLjM3NiAxNDguNTMyLDY5LjUwOSBDMTUzLjg0Miw2Ni40NDMgMTU4LjE2Myw1OC45ODcgMTU4LjE2Myw1Mi44OTQgQzE1OC4xNjMsNTAuOTY3IDE1Ny43MjEsNDkuMzMyIDE1Ni44ODQsNDguMTY4IEMxNTYuODE4LDQ4LjA3NiAxNTYuODI4LDQ3Ljk0OCAxNTYuOTA4LDQ3Ljg2NyBDMTU2Ljk4OCw0Ny43ODYgMTU3LjExNCw0Ny43NzQgMTU3LjIwOCw0Ny44NCBDMTU4Ljg3OCw0OS4wMTIgMTU5Ljc5OCw1MS4yMiAxNTkuNzk4LDU0LjA1OSBDMTU5Ljc5OCw2MC4zMDEgMTU1LjM3Myw2OC4wNDYgMTQ5LjkzMyw3MS4xODYgQzE0OC4zNiw3Mi4wOTQgMTQ2Ljg1LDcyLjY2NyAxNDUuNDQ1LDcyLjY2NyBMMTQ1LjQ0NSw3Mi42NjcgWiBNMTQyLjQ3Niw3MSBDMTQzLjI5LDcxLjY1MSAxNDQuMjk2LDcyLjAwMiAxNDUuNDQ1LDcyLjAwMiBDMTQ2Ljc2Nyw3Mi4wMDIgMTQ4LjE5OCw3MS41NSAxNDkuNyw3MC42ODIgQzE1NS4wMSw2Ny42MTcgMTU5LjMzMSw2MC4xNTkgMTU5LjMzMSw1NC4wNjUgQzE1OS4zMzEsNTIuMDg1IDE1OC44NjgsNTAuNDM1IDE1OC4wMDYsNDkuMjcyIEMxNTguNDE3LDUwLjMwNyAxNTguNjMsNTEuNTMyIDE1OC42Myw1Mi44OTIgQzE1OC42Myw1OS4xMzQgMTU0LjIwNSw2Ni43NjcgMTQ4Ljc2NSw2OS45MDcgQzE0Ny4xOTIsNzAuODE2IDE0NS42ODEsNzEuMjgzIDE0NC4yNzYsNzEuMjgzIEMxNDMuNjM0LDcxLjI4MyAxNDMuMDMzLDcxLjE5MiAxNDIuNDc2LDcxIEwxNDIuNDc2LDcxIFoiIGlkPSJGaWxsLTMzIiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0OC42NDgsNjkuNzA0IEMxNTQuMDMyLDY2LjU5NiAxNTguMzk2LDU5LjA2OCAxNTguMzk2LDUyLjg5MSBDMTU4LjM5Niw1MC44MzkgMTU3LjkxMyw0OS4xOTggMTU3LjA3NCw0OC4wMyBDMTU1LjI4OSw0Ni43NzggMTUyLjY5OSw0Ni44MzYgMTQ5LjgxNiw0OC41MDEgQzE0NC40MzMsNTEuNjA5IDE0MC4wNjgsNTkuMTM3IDE0MC4wNjgsNjUuMzE0IEMxNDAuMDY4LDY3LjM2NSAxNDAuNTUyLDY5LjAwNiAxNDEuMzkxLDcwLjE3NCBDMTQzLjE3Niw3MS40MjcgMTQ1Ljc2NSw3MS4zNjkgMTQ4LjY0OCw2OS43MDQiIGlkPSJGaWxsLTM0IiBmaWxsPSIjRkFGQUZBIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTE0NC4yNzYsNzEuMjc2IEwxNDQuMjc2LDcxLjI3NiBDMTQzLjEzMyw3MS4yNzYgMTQyLjExOCw3MC45NjkgMTQxLjI1Nyw3MC4zNjUgQzE0MS4yMzYsNzAuMzUxIDE0MS4yMTcsNzAuMzMyIDE0MS4yMDIsNzAuMzExIEMxNDAuMzA3LDY5LjA2NyAxMzkuODM1LDY3LjMzOSAxMzkuODM1LDY1LjMxNCBDMTM5LjgzNSw1OS4wNzMgMTQ0LjI2LDUxLjQzOSAxNDkuNyw0OC4yOTggQzE1MS4yNzMsNDcuMzkgMTUyLjc4NCw0Ni45MjkgMTU0LjE4OSw0Ni45MjkgQzE1NS4zMzIsNDYuOTI5IDE1Ni4zNDcsNDcuMjM2IDE1Ny4yMDgsNDcuODM5IEMxNTcuMjI5LDQ3Ljg1NCAxNTcuMjQ4LDQ3Ljg3MyAxNTcuMjYzLDQ3Ljg5NCBDMTU4LjE1Nyw0OS4xMzggMTU4LjYzLDUwLjg2NSAxNTguNjMsNTIuODkxIEMxNTguNjMsNTkuMTMyIDE1NC4yMDUsNjYuNzY2IDE0OC43NjUsNjkuOTA3IEMxNDcuMTkyLDcwLjgxNSAxNDUuNjgxLDcxLjI3NiAxNDQuMjc2LDcxLjI3NiBMMTQ0LjI3Niw3MS4yNzYgWiBNMTQxLjU1OCw3MC4xMDQgQzE0Mi4zMzEsNzAuNjM3IDE0My4yNDUsNzEuMDA1IDE0NC4yNzYsNzEuMDA1IEMxNDUuNTk4LDcxLjAwNSAxNDcuMDMsNzAuNDY3IDE0OC41MzIsNjkuNiBDMTUzLjg0Miw2Ni41MzQgMTU4LjE2Myw1OS4wMzMgMTU4LjE2Myw1Mi45MzkgQzE1OC4xNjMsNTEuMDMxIDE1Ny43MjksNDkuMzg1IDE1Ni45MDcsNDguMjIzIEMxNTYuMTMzLDQ3LjY5MSAxNTUuMjE5LDQ3LjQwOSAxNTQuMTg5LDQ3LjQwOSBDMTUyLjg2Nyw0Ny40MDkgMTUxLjQzNSw0Ny44NDIgMTQ5LjkzMyw0OC43MDkgQzE0NC42MjMsNTEuNzc1IDE0MC4zMDIsNTkuMjczIDE0MC4zMDIsNjUuMzY2IEMxNDAuMzAyLDY3LjI3NiAxNDAuNzM2LDY4Ljk0MiAxNDEuNTU4LDcwLjEwNCBMMTQxLjU1OCw3MC4xMDQgWiIgaWQ9IkZpbGwtMzUiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTUwLjcyLDY1LjM2MSBMMTUwLjM1Nyw2NS4wNjYgQzE1MS4xNDcsNjQuMDkyIDE1MS44NjksNjMuMDQgMTUyLjUwNSw2MS45MzggQzE1My4zMTMsNjAuNTM5IDE1My45NzgsNTkuMDY3IDE1NC40ODIsNTcuNTYzIEwxNTQuOTI1LDU3LjcxMiBDMTU0LjQxMiw1OS4yNDUgMTUzLjczMyw2MC43NDUgMTUyLjkxLDYyLjE3MiBDMTUyLjI2Miw2My4yOTUgMTUxLjUyNSw2NC4zNjggMTUwLjcyLDY1LjM2MSIgaWQ9IkZpbGwtMzYiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTE1LjkxNyw4NC41MTQgTDExNS41NTQsODQuMjIgQzExNi4zNDQsODMuMjQ1IDExNy4wNjYsODIuMTk0IDExNy43MDIsODEuMDkyIEMxMTguNTEsNzkuNjkyIDExOS4xNzUsNzguMjIgMTE5LjY3OCw3Ni43MTcgTDEyMC4xMjEsNzYuODY1IEMxMTkuNjA4LDc4LjM5OCAxMTguOTMsNzkuODk5IDExOC4xMDYsODEuMzI2IEMxMTcuNDU4LDgyLjQ0OCAxMTYuNzIyLDgzLjUyMSAxMTUuOTE3LDg0LjUxNCIgaWQ9IkZpbGwtMzciIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTE0LDEzMC40NzYgTDExNCwxMzAuMDA4IEwxMTQsNzYuMDUyIEwxMTQsNzUuNTg0IEwxMTQsNzYuMDUyIEwxMTQsMTMwLjAwOCBMMTE0LDEzMC40NzYiIGlkPSJGaWxsLTM4IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICA8L2c+CiAgICAgICAgICAgICAgICA8ZyBpZD0iSW1wb3J0ZWQtTGF5ZXJzLUNvcHkiIHRyYW5zZm9ybT0idHJhbnNsYXRlKDYyLjAwMDAwMCwgMC4wMDAwMDApIiBza2V0Y2g6dHlwZT0iTVNTaGFwZUdyb3VwIj4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTkuODIyLDM3LjQ3NCBDMTkuODM5LDM3LjMzOSAxOS43NDcsMzcuMTk0IDE5LjU1NSwzNy4wODIgQzE5LjIyOCwzNi44OTQgMTguNzI5LDM2Ljg3MiAxOC40NDYsMzcuMDM3IEwxMi40MzQsNDAuNTA4IEMxMi4zMDMsNDAuNTg0IDEyLjI0LDQwLjY4NiAxMi4yNDMsNDAuNzkzIEMxMi4yNDUsNDAuOTI1IDEyLjI0NSw0MS4yNTQgMTIuMjQ1LDQxLjM3MSBMMTIuMjQ1LDQxLjQxNCBMMTIuMjM4LDQxLjU0MiBDOC4xNDgsNDMuODg3IDUuNjQ3LDQ1LjMyMSA1LjY0Nyw0NS4zMjEgQzUuNjQ2LDQ1LjMyMSAzLjU3LDQ2LjM2NyAyLjg2LDUwLjUxMyBDMi44Niw1MC41MTMgMS45NDgsNTcuNDc0IDEuOTYyLDcwLjI1OCBDMS45NzcsODIuODI4IDIuNTY4LDg3LjMyOCAzLjEyOSw5MS42MDkgQzMuMzQ5LDkzLjI5MyA2LjEzLDkzLjczNCA2LjEzLDkzLjczNCBDNi40NjEsOTMuNzc0IDYuODI4LDkzLjcwNyA3LjIxLDkzLjQ4NiBMODIuNDgzLDQ5LjkzNSBDODQuMjkxLDQ4Ljg2NiA4NS4xNSw0Ni4yMTYgODUuNTM5LDQzLjY1MSBDODYuNzUyLDM1LjY2MSA4Ny4yMTQsMTAuNjczIDg1LjI2NCwzLjc3MyBDODUuMDY4LDMuMDggODQuNzU0LDIuNjkgODQuMzk2LDIuNDkxIEw4Mi4zMSwxLjcwMSBDODEuNTgzLDEuNzI5IDgwLjg5NCwyLjE2OCA4MC43NzYsMi4yMzYgQzgwLjYzNiwyLjMxNyA0MS44MDcsMjQuNTg1IDIwLjAzMiwzNy4wNzIgTDE5LjgyMiwzNy40NzQiIGlkPSJGaWxsLTEiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNODIuMzExLDEuNzAxIEw4NC4zOTYsMi40OTEgQzg0Ljc1NCwyLjY5IDg1LjA2OCwzLjA4IDg1LjI2NCwzLjc3MyBDODcuMjEzLDEwLjY3MyA4Ni43NTEsMzUuNjYgODUuNTM5LDQzLjY1MSBDODUuMTQ5LDQ2LjIxNiA4NC4yOSw0OC44NjYgODIuNDgzLDQ5LjkzNSBMNy4yMSw5My40ODYgQzYuODk3LDkzLjY2NyA2LjU5NSw5My43NDQgNi4zMTQsOTMuNzQ0IEw2LjEzMSw5My43MzMgQzYuMTMxLDkzLjczNCAzLjM0OSw5My4yOTMgMy4xMjgsOTEuNjA5IEMyLjU2OCw4Ny4zMjcgMS45NzcsODIuODI4IDEuOTYzLDcwLjI1OCBDMS45NDgsNTcuNDc0IDIuODYsNTAuNTEzIDIuODYsNTAuNTEzIEMzLjU3LDQ2LjM2NyA1LjY0Nyw0NS4zMjEgNS42NDcsNDUuMzIxIEM1LjY0Nyw0NS4zMjEgOC4xNDgsNDMuODg3IDEyLjIzOCw0MS41NDIgTDEyLjI0NSw0MS40MTQgTDEyLjI0NSw0MS4zNzEgQzEyLjI0NSw0MS4yNTQgMTIuMjQ1LDQwLjkyNSAxMi4yNDMsNDAuNzkzIEMxMi4yNCw0MC42ODYgMTIuMzAyLDQwLjU4MyAxMi40MzQsNDAuNTA4IEwxOC40NDYsMzcuMDM2IEMxOC41NzQsMzYuOTYyIDE4Ljc0NiwzNi45MjYgMTguOTI3LDM2LjkyNiBDMTkuMTQ1LDM2LjkyNiAxOS4zNzYsMzYuOTc5IDE5LjU1NCwzNy4wODIgQzE5Ljc0NywzNy4xOTQgMTkuODM5LDM3LjM0IDE5LjgyMiwzNy40NzQgTDIwLjAzMywzNy4wNzIgQzQxLjgwNiwyNC41ODUgODAuNjM2LDIuMzE4IDgwLjc3NywyLjIzNiBDODAuODk0LDIuMTY4IDgxLjU4MywxLjcyOSA4Mi4zMTEsMS43MDEgTTgyLjMxMSwwLjcwNCBMODIuMjcyLDAuNzA1IEM4MS42NTQsMC43MjggODAuOTg5LDAuOTQ5IDgwLjI5OCwxLjM2MSBMODAuMjc3LDEuMzczIEM4MC4xMjksMS40NTggNTkuNzY4LDEzLjEzNSAxOS43NTgsMzYuMDc5IEMxOS41LDM1Ljk4MSAxOS4yMTQsMzUuOTI5IDE4LjkyNywzNS45MjkgQzE4LjU2MiwzNS45MjkgMTguMjIzLDM2LjAxMyAxNy45NDcsMzYuMTczIEwxMS45MzUsMzkuNjQ0IEMxMS40OTMsMzkuODk5IDExLjIzNiw0MC4zMzQgMTEuMjQ2LDQwLjgxIEwxMS4yNDcsNDAuOTYgTDUuMTY3LDQ0LjQ0NyBDNC43OTQsNDQuNjQ2IDIuNjI1LDQ1Ljk3OCAxLjg3Nyw1MC4zNDUgTDEuODcxLDUwLjM4NCBDMS44NjIsNTAuNDU0IDAuOTUxLDU3LjU1NyAwLjk2NSw3MC4yNTkgQzAuOTc5LDgyLjg3OSAxLjU2OCw4Ny4zNzUgMi4xMzcsOTEuNzI0IEwyLjEzOSw5MS43MzkgQzIuNDQ3LDk0LjA5NCA1LjYxNCw5NC42NjIgNS45NzUsOTQuNzE5IEw2LjAwOSw5NC43MjMgQzYuMTEsOTQuNzM2IDYuMjEzLDk0Ljc0MiA2LjMxNCw5NC43NDIgQzYuNzksOTQuNzQyIDcuMjYsOTQuNjEgNy43MSw5NC4zNSBMODIuOTgzLDUwLjc5OCBDODQuNzk0LDQ5LjcyNyA4NS45ODIsNDcuMzc1IDg2LjUyNSw0My44MDEgQzg3LjcxMSwzNS45ODcgODguMjU5LDEwLjcwNSA4Ni4yMjQsMy41MDIgQzg1Ljk3MSwyLjYwOSA4NS41MiwxLjk3NSA4NC44ODEsMS42MiBMODQuNzQ5LDEuNTU4IEw4Mi42NjQsMC43NjkgQzgyLjU1MSwwLjcyNSA4Mi40MzEsMC43MDQgODIuMzExLDAuNzA0IiBpZD0iRmlsbC0yIiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTY2LjI2NywxMS41NjUgTDY3Ljc2MiwxMS45OTkgTDExLjQyMyw0NC4zMjUiIGlkPSJGaWxsLTMiIGZpbGw9IiNGRkZGRkYiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIuMjAyLDkwLjU0NSBDMTIuMDI5LDkwLjU0NSAxMS44NjIsOTAuNDU1IDExLjc2OSw5MC4yOTUgQzExLjYzMiw5MC4wNTcgMTEuNzEzLDg5Ljc1MiAxMS45NTIsODkuNjE0IEwzMC4zODksNzguOTY5IEMzMC42MjgsNzguODMxIDMwLjkzMyw3OC45MTMgMzEuMDcxLDc5LjE1MiBDMzEuMjA4LDc5LjM5IDMxLjEyNyw3OS42OTYgMzAuODg4LDc5LjgzMyBMMTIuNDUxLDkwLjQ3OCBMMTIuMjAyLDkwLjU0NSIgaWQ9IkZpbGwtNCIgZmlsbD0iIzYwN0Q4QiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMy43NjQsNDIuNjU0IEwxMy42NTYsNDIuNTkyIEwxMy43MDIsNDIuNDIxIEwxOC44MzcsMzkuNDU3IEwxOS4wMDcsMzkuNTAyIEwxOC45NjIsMzkuNjczIEwxMy44MjcsNDIuNjM3IEwxMy43NjQsNDIuNjU0IiBpZD0iRmlsbC01IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTguNTIsOTAuMzc1IEw4LjUyLDQ2LjQyMSBMOC41ODMsNDYuMzg1IEw3NS44NCw3LjU1NCBMNzUuODQsNTEuNTA4IEw3NS43NzgsNTEuNTQ0IEw4LjUyLDkwLjM3NSBMOC41Miw5MC4zNzUgWiBNOC43Nyw0Ni41NjQgTDguNzcsODkuOTQ0IEw3NS41OTEsNTEuMzY1IEw3NS41OTEsNy45ODUgTDguNzcsNDYuNTY0IEw4Ljc3LDQ2LjU2NCBaIiBpZD0iRmlsbC02IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTI0Ljk4Niw4My4xODIgQzI0Ljc1Niw4My4zMzEgMjQuMzc0LDgzLjU2NiAyNC4xMzcsODMuNzA1IEwxMi42MzIsOTAuNDA2IEMxMi4zOTUsOTAuNTQ1IDEyLjQyNiw5MC42NTggMTIuNyw5MC42NTggTDEzLjI2NSw5MC42NTggQzEzLjU0LDkwLjY1OCAxMy45NTgsOTAuNTQ1IDE0LjE5NSw5MC40MDYgTDI1LjcsODMuNzA1IEMyNS45MzcsODMuNTY2IDI2LjEyOCw4My40NTIgMjYuMTI1LDgzLjQ0OSBDMjYuMTIyLDgzLjQ0NyAyNi4xMTksODMuMjIgMjYuMTE5LDgyLjk0NiBDMjYuMTE5LDgyLjY3MiAyNS45MzEsODIuNTY5IDI1LjcwMSw4Mi43MTkgTDI0Ljk4Niw4My4xODIiIGlkPSJGaWxsLTciIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTMuMjY2LDkwLjc4MiBMMTIuNyw5MC43ODIgQzEyLjUsOTAuNzgyIDEyLjM4NCw5MC43MjYgMTIuMzU0LDkwLjYxNiBDMTIuMzI0LDkwLjUwNiAxMi4zOTcsOTAuMzk5IDEyLjU2OSw5MC4yOTkgTDI0LjA3NCw4My41OTcgQzI0LjMxLDgzLjQ1OSAyNC42ODksODMuMjI2IDI0LjkxOCw4My4wNzggTDI1LjYzMyw4Mi42MTQgQzI1LjcyMyw4Mi41NTUgMjUuODEzLDgyLjUyNSAyNS44OTksODIuNTI1IEMyNi4wNzEsODIuNTI1IDI2LjI0NCw4Mi42NTUgMjYuMjQ0LDgyLjk0NiBDMjYuMjQ0LDgzLjE2IDI2LjI0NSw4My4zMDkgMjYuMjQ3LDgzLjM4MyBMMjYuMjUzLDgzLjM4NyBMMjYuMjQ5LDgzLjQ1NiBDMjYuMjQ2LDgzLjUzMSAyNi4yNDYsODMuNTMxIDI1Ljc2Myw4My44MTIgTDE0LjI1OCw5MC41MTQgQzE0LDkwLjY2NSAxMy41NjQsOTAuNzgyIDEzLjI2Niw5MC43ODIgTDEzLjI2Niw5MC43ODIgWiBNMTIuNjY2LDkwLjUzMiBMMTIuNyw5MC41MzMgTDEzLjI2Niw5MC41MzMgQzEzLjUxOCw5MC41MzMgMTMuOTE1LDkwLjQyNSAxNC4xMzIsOTAuMjk5IEwyNS42MzcsODMuNTk3IEMyNS44MDUsODMuNDk5IDI1LjkzMSw4My40MjQgMjUuOTk4LDgzLjM4MyBDMjUuOTk0LDgzLjI5OSAyNS45OTQsODMuMTY1IDI1Ljk5NCw4Mi45NDYgTDI1Ljg5OSw4Mi43NzUgTDI1Ljc2OCw4Mi44MjQgTDI1LjA1NCw4My4yODcgQzI0LjgyMiw4My40MzcgMjQuNDM4LDgzLjY3MyAyNC4yLDgzLjgxMiBMMTIuNjk1LDkwLjUxNCBMMTIuNjY2LDkwLjUzMiBMMTIuNjY2LDkwLjUzMiBaIiBpZD0iRmlsbC04IiBmaWxsPSIjNjA3RDhCIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEzLjI2Niw4OS44NzEgTDEyLjcsODkuODcxIEMxMi41LDg5Ljg3MSAxMi4zODQsODkuODE1IDEyLjM1NCw4OS43MDUgQzEyLjMyNCw4OS41OTUgMTIuMzk3LDg5LjQ4OCAxMi41NjksODkuMzg4IEwyNC4wNzQsODIuNjg2IEMyNC4zMzIsODIuNTM1IDI0Ljc2OCw4Mi40MTggMjUuMDY3LDgyLjQxOCBMMjUuNjMyLDgyLjQxOCBDMjUuODMyLDgyLjQxOCAyNS45NDgsODIuNDc0IDI1Ljk3OCw4Mi41ODQgQzI2LjAwOCw4Mi42OTQgMjUuOTM1LDgyLjgwMSAyNS43NjMsODIuOTAxIEwxNC4yNTgsODkuNjAzIEMxNCw4OS43NTQgMTMuNTY0LDg5Ljg3MSAxMy4yNjYsODkuODcxIEwxMy4yNjYsODkuODcxIFogTTEyLjY2Niw4OS42MjEgTDEyLjcsODkuNjIyIEwxMy4yNjYsODkuNjIyIEMxMy41MTgsODkuNjIyIDEzLjkxNSw4OS41MTUgMTQuMTMyLDg5LjM4OCBMMjUuNjM3LDgyLjY4NiBMMjUuNjY3LDgyLjY2OCBMMjUuNjMyLDgyLjY2NyBMMjUuMDY3LDgyLjY2NyBDMjQuODE1LDgyLjY2NyAyNC40MTgsODIuNzc1IDI0LjIsODIuOTAxIEwxMi42OTUsODkuNjAzIEwxMi42NjYsODkuNjIxIEwxMi42NjYsODkuNjIxIFoiIGlkPSJGaWxsLTkiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNMTIuMzcsOTAuODAxIEwxMi4zNyw4OS41NTQgTDEyLjM3LDkwLjgwMSIgaWQ9IkZpbGwtMTAiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNi4xMyw5My45MDEgQzUuMzc5LDkzLjgwOCA0LjgxNiw5My4xNjQgNC42OTEsOTIuNTI1IEMzLjg2LDg4LjI4NyAzLjU0LDgzLjc0MyAzLjUyNiw3MS4xNzMgQzMuNTExLDU4LjM4OSA0LjQyMyw1MS40MjggNC40MjMsNTEuNDI4IEM1LjEzNCw0Ny4yODIgNy4yMSw0Ni4yMzYgNy4yMSw0Ni4yMzYgQzcuMjEsNDYuMjM2IDgxLjY2NywzLjI1IDgyLjA2OSwzLjAxNyBDODIuMjkyLDIuODg4IDg0LjU1NiwxLjQzMyA4NS4yNjQsMy45NCBDODcuMjE0LDEwLjg0IDg2Ljc1MiwzNS44MjcgODUuNTM5LDQzLjgxOCBDODUuMTUsNDYuMzgzIDg0LjI5MSw0OS4wMzMgODIuNDgzLDUwLjEwMSBMNy4yMSw5My42NTMgQzYuODI4LDkzLjg3NCA2LjQ2MSw5My45NDEgNi4xMyw5My45MDEgQzYuMTMsOTMuOTAxIDMuMzQ5LDkzLjQ2IDMuMTI5LDkxLjc3NiBDMi41NjgsODcuNDk1IDEuOTc3LDgyLjk5NSAxLjk2Miw3MC40MjUgQzEuOTQ4LDU3LjY0MSAyLjg2LDUwLjY4IDIuODYsNTAuNjggQzMuNTcsNDYuNTM0IDUuNjQ3LDQ1LjQ4OSA1LjY0Nyw0NS40ODkgQzUuNjQ2LDQ1LjQ4OSA4LjA2NSw0NC4wOTIgMTIuMjQ1LDQxLjY3OSBMMTMuMTE2LDQxLjU2IEwxOS43MTUsMzcuNzMgTDE5Ljc2MSwzNy4yNjkgTDYuMTMsOTMuOTAxIiBpZD0iRmlsbC0xMSIgZmlsbD0iI0ZBRkFGQSI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02LjMxNyw5NC4xNjEgTDYuMTAyLDk0LjE0OCBMNi4xMDEsOTQuMTQ4IEw1Ljg1Nyw5NC4xMDEgQzUuMTM4LDkzLjk0NSAzLjA4NSw5My4zNjUgMi44ODEsOTEuODA5IEMyLjMxMyw4Ny40NjkgMS43MjcsODIuOTk2IDEuNzEzLDcwLjQyNSBDMS42OTksNTcuNzcxIDIuNjA0LDUwLjcxOCAyLjYxMyw1MC42NDggQzMuMzM4LDQ2LjQxNyA1LjQ0NSw0NS4zMSA1LjUzNSw0NS4yNjYgTDEyLjE2Myw0MS40MzkgTDEzLjAzMyw0MS4zMiBMMTkuNDc5LDM3LjU3OCBMMTkuNTEzLDM3LjI0NCBDMTkuNTI2LDM3LjEwNyAxOS42NDcsMzcuMDA4IDE5Ljc4NiwzNy4wMjEgQzE5LjkyMiwzNy4wMzQgMjAuMDIzLDM3LjE1NiAyMC4wMDksMzcuMjkzIEwxOS45NSwzNy44ODIgTDEzLjE5OCw0MS44MDEgTDEyLjMyOCw0MS45MTkgTDUuNzcyLDQ1LjcwNCBDNS43NDEsNDUuNzIgMy43ODIsNDYuNzcyIDMuMTA2LDUwLjcyMiBDMy4wOTksNTAuNzgyIDIuMTk4LDU3LjgwOCAyLjIxMiw3MC40MjQgQzIuMjI2LDgyLjk2MyAyLjgwOSw4Ny40MiAzLjM3Myw5MS43MjkgQzMuNDY0LDkyLjQyIDQuMDYyLDkyLjg4MyA0LjY4Miw5My4xODEgQzQuNTY2LDkyLjk4NCA0LjQ4Niw5Mi43NzYgNC40NDYsOTIuNTcyIEMzLjY2NSw4OC41ODggMy4yOTEsODQuMzcgMy4yNzYsNzEuMTczIEMzLjI2Miw1OC41MiA0LjE2Nyw1MS40NjYgNC4xNzYsNTEuMzk2IEM0LjkwMSw0Ny4xNjUgNy4wMDgsNDYuMDU5IDcuMDk4LDQ2LjAxNCBDNy4wOTQsNDYuMDE1IDgxLjU0MiwzLjAzNCA4MS45NDQsMi44MDIgTDgxLjk3MiwyLjc4NSBDODIuODc2LDIuMjQ3IDgzLjY5MiwyLjA5NyA4NC4zMzIsMi4zNTIgQzg0Ljg4NywyLjU3MyA4NS4yODEsMy4wODUgODUuNTA0LDMuODcyIEM4Ny41MTgsMTEgODYuOTY0LDM2LjA5MSA4NS43ODUsNDMuODU1IEM4NS4yNzgsNDcuMTk2IDg0LjIxLDQ5LjM3IDgyLjYxLDUwLjMxNyBMNy4zMzUsOTMuODY5IEM2Ljk5OSw5NC4wNjMgNi42NTgsOTQuMTYxIDYuMzE3LDk0LjE2MSBMNi4zMTcsOTQuMTYxIFogTTYuMTcsOTMuNjU0IEM2LjQ2Myw5My42OSA2Ljc3NCw5My42MTcgNy4wODUsOTMuNDM3IEw4Mi4zNTgsNDkuODg2IEM4NC4xODEsNDguODA4IDg0Ljk2LDQ1Ljk3MSA4NS4yOTIsNDMuNzggQzg2LjQ2NiwzNi4wNDkgODcuMDIzLDExLjA4NSA4NS4wMjQsNC4wMDggQzg0Ljg0NiwzLjM3NyA4NC41NTEsMi45NzYgODQuMTQ4LDIuODE2IEM4My42NjQsMi42MjMgODIuOTgyLDIuNzY0IDgyLjIyNywzLjIxMyBMODIuMTkzLDMuMjM0IEM4MS43OTEsMy40NjYgNy4zMzUsNDYuNDUyIDcuMzM1LDQ2LjQ1MiBDNy4zMDQsNDYuNDY5IDUuMzQ2LDQ3LjUyMSA0LjY2OSw1MS40NzEgQzQuNjYyLDUxLjUzIDMuNzYxLDU4LjU1NiAzLjc3NSw3MS4xNzMgQzMuNzksODQuMzI4IDQuMTYxLDg4LjUyNCA0LjkzNiw5Mi40NzYgQzUuMDI2LDkyLjkzNyA1LjQxMiw5My40NTkgNS45NzMsOTMuNjE1IEM2LjA4Nyw5My42NCA2LjE1OCw5My42NTIgNi4xNjksOTMuNjU0IEw2LjE3LDkzLjY1NCBMNi4xNyw5My42NTQgWiIgaWQ9IkZpbGwtMTIiIGZpbGw9IiM0NTVBNjQiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNy4zMTcsNjguOTgyIEM3LjgwNiw2OC43MDEgOC4yMDIsNjguOTI2IDguMjAyLDY5LjQ4NyBDOC4yMDIsNzAuMDQ3IDcuODA2LDcwLjczIDcuMzE3LDcxLjAxMiBDNi44MjksNzEuMjk0IDYuNDMzLDcxLjA2OSA2LjQzMyw3MC41MDggQzYuNDMzLDY5Ljk0OCA2LjgyOSw2OS4yNjUgNy4zMTcsNjguOTgyIiBpZD0iRmlsbC0xMyIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik02LjkyLDcxLjEzMyBDNi42MzEsNzEuMTMzIDYuNDMzLDcwLjkwNSA2LjQzMyw3MC41MDggQzYuNDMzLDY5Ljk0OCA2LjgyOSw2OS4yNjUgNy4zMTcsNjguOTgyIEM3LjQ2LDY4LjkgNy41OTUsNjguODYxIDcuNzE0LDY4Ljg2MSBDOC4wMDMsNjguODYxIDguMjAyLDY5LjA5IDguMjAyLDY5LjQ4NyBDOC4yMDIsNzAuMDQ3IDcuODA2LDcwLjczIDcuMzE3LDcxLjAxMiBDNy4xNzQsNzEuMDk0IDcuMDM5LDcxLjEzMyA2LjkyLDcxLjEzMyBNNy43MTQsNjguNjc0IEM3LjU1Nyw2OC42NzQgNy4zOTIsNjguNzIzIDcuMjI0LDY4LjgyMSBDNi42NzYsNjkuMTM4IDYuMjQ2LDY5Ljg3OSA2LjI0Niw3MC41MDggQzYuMjQ2LDcwLjk5NCA2LjUxNyw3MS4zMiA2LjkyLDcxLjMyIEM3LjA3OCw3MS4zMiA3LjI0Myw3MS4yNzEgNy40MTEsNzEuMTc0IEM3Ljk1OSw3MC44NTcgOC4zODksNzAuMTE3IDguMzg5LDY5LjQ4NyBDOC4zODksNjkuMDAxIDguMTE3LDY4LjY3NCA3LjcxNCw2OC42NzQiIGlkPSJGaWxsLTE0IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTYuOTIsNzAuOTQ3IEM2LjY0OSw3MC45NDcgNi42MjEsNzAuNjQgNi42MjEsNzAuNTA4IEM2LjYyMSw3MC4wMTcgNi45ODIsNjkuMzkyIDcuNDExLDY5LjE0NSBDNy41MjEsNjkuMDgyIDcuNjI1LDY5LjA0OSA3LjcxNCw2OS4wNDkgQzcuOTg2LDY5LjA0OSA4LjAxNSw2OS4zNTUgOC4wMTUsNjkuNDg3IEM4LjAxNSw2OS45NzggNy42NTIsNzAuNjAzIDcuMjI0LDcwLjg1MSBDNy4xMTUsNzAuOTE0IDcuMDEsNzAuOTQ3IDYuOTIsNzAuOTQ3IE03LjcxNCw2OC44NjEgQzcuNTk1LDY4Ljg2MSA3LjQ2LDY4LjkgNy4zMTcsNjguOTgyIEM2LjgyOSw2OS4yNjUgNi40MzMsNjkuOTQ4IDYuNDMzLDcwLjUwOCBDNi40MzMsNzAuOTA1IDYuNjMxLDcxLjEzMyA2LjkyLDcxLjEzMyBDNy4wMzksNzEuMTMzIDcuMTc0LDcxLjA5NCA3LjMxNyw3MS4wMTIgQzcuODA2LDcwLjczIDguMjAyLDcwLjA0NyA4LjIwMiw2OS40ODcgQzguMjAyLDY5LjA5IDguMDAzLDY4Ljg2MSA3LjcxNCw2OC44NjEiIGlkPSJGaWxsLTE1IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTcuNDQ0LDg1LjM1IEM3LjcwOCw4NS4xOTggNy45MjEsODUuMzE5IDcuOTIxLDg1LjYyMiBDNy45MjEsODUuOTI1IDcuNzA4LDg2LjI5MiA3LjQ0NCw4Ni40NDQgQzcuMTgxLDg2LjU5NyA2Ljk2Nyw4Ni40NzUgNi45NjcsODYuMTczIEM2Ljk2Nyw4NS44NzEgNy4xODEsODUuNTAyIDcuNDQ0LDg1LjM1IiBpZD0iRmlsbC0xNiIgZmlsbD0iI0ZGRkZGRiI+PC9wYXRoPgogICAgICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik03LjIzLDg2LjUxIEM3LjA3NCw4Ni41MSA2Ljk2Nyw4Ni4zODcgNi45NjcsODYuMTczIEM2Ljk2Nyw4NS44NzEgNy4xODEsODUuNTAyIDcuNDQ0LDg1LjM1IEM3LjUyMSw4NS4zMDUgNy41OTQsODUuMjg0IDcuNjU4LDg1LjI4NCBDNy44MTQsODUuMjg0IDcuOTIxLDg1LjQwOCA3LjkyMSw4NS42MjIgQzcuOTIxLDg1LjkyNSA3LjcwOCw4Ni4yOTIgNy40NDQsODYuNDQ0IEM3LjM2Nyw4Ni40ODkgNy4yOTQsODYuNTEgNy4yMyw4Ni41MSBNNy42NTgsODUuMDk4IEM3LjU1OCw4NS4wOTggNy40NTUsODUuMTI3IDcuMzUxLDg1LjE4OCBDNy4wMzEsODUuMzczIDYuNzgxLDg1LjgwNiA2Ljc4MSw4Ni4xNzMgQzYuNzgxLDg2LjQ4MiA2Ljk2Niw4Ni42OTcgNy4yMyw4Ni42OTcgQzcuMzMsODYuNjk3IDcuNDMzLDg2LjY2NiA3LjUzOCw4Ni42MDcgQzcuODU4LDg2LjQyMiA4LjEwOCw4NS45ODkgOC4xMDgsODUuNjIyIEM4LjEwOCw4NS4zMTMgNy45MjMsODUuMDk4IDcuNjU4LDg1LjA5OCIgaWQ9IkZpbGwtMTciIGZpbGw9IiM4MDk3QTIiPjwvcGF0aD4KICAgICAgICAgICAgICAgICAgICA8cGF0aCBkPSJNNy4yMyw4Ni4zMjIgTDcuMTU0LDg2LjE3MyBDNy4xNTQsODUuOTM4IDcuMzMzLDg1LjYyOSA3LjUzOCw4NS41MTIgTDcuNjU4LDg1LjQ3MSBMNy43MzQsODUuNjIyIEM3LjczNCw4NS44NTYgNy41NTUsODYuMTY0IDcuMzUxLDg2LjI4MiBMNy4yMyw4Ni4zMjIgTTcuNjU4LDg1LjI4NCBDNy41OTQsODUuMjg0IDcuNTIxLDg1LjMwNSA3LjQ0NCw4NS4zNSBDNy4xODEsODUuNTAyIDYuOTY3LDg1Ljg3MSA2Ljk2Nyw4Ni4xNzMgQzYuOTY3LDg2LjM4NyA3LjA3NCw4Ni41MSA3LjIzLDg2LjUxIEM3LjI5NCw4Ni41MSA3LjM2Nyw4Ni40ODkgNy40NDQsODYuNDQ0IEM3LjcwOCw4Ni4yOTIgNy45MjEsODUuOTI1IDcuOTIxLDg1LjYyMiBDNy45MjEsODUuNDA4IDcuODE0LDg1LjI4NCA3LjY1OCw4NS4yODQiIGlkPSJGaWxsLTE4IiBmaWxsPSIjODA5N0EyIj48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTc3LjI3OCw3Ljc2OSBMNzcuMjc4LDUxLjQzNiBMMTAuMjA4LDkwLjE2IEwxMC4yMDgsNDYuNDkzIEw3Ny4yNzgsNy43NjkiIGlkPSJGaWxsLTE5IiBmaWxsPSIjNDU1QTY0Ij48L3BhdGg+CiAgICAgICAgICAgICAgICAgICAgPHBhdGggZD0iTTEwLjA4Myw5MC4zNzUgTDEwLjA4Myw0Ni40MjEgTDEwLjE0Niw0Ni4zODUgTDc3LjQwMyw3LjU1NCBMNzcuNDAzLDUxLjUwOCBMNzcuMzQxLDUxLjU0NCBMMTAuMDgzLDkwLjM3NSBMMTAuMDgzLDkwLjM3NSBaIE0xMC4zMzMsNDYuNTY0IEwxMC4zMzMsODkuOTQ0IEw3Ny4xNTQsNTEuMzY1IEw3Ny4xNTQsNy45ODUgTDEwLjMzMyw0Ni41NjQgTDEwLjMzMyw0Ni41NjQgWiIgaWQ9IkZpbGwtMjAiIGZpbGw9IiM2MDdEOEIiPjwvcGF0aD4KICAgICAgICAgICAgICAgIDwvZz4KICAgICAgICAgICAgICAgIDxwYXRoIGQ9Ik0xMjUuNzM3LDg4LjY0NyBMMTE4LjA5OCw5MS45ODEgTDExOC4wOTgsODQgTDEwNi42MzksODguNzEzIEwxMDYuNjM5LDk2Ljk4MiBMOTksMTAwLjMxNSBMMTEyLjM2OSwxMDMuOTYxIEwxMjUuNzM3LDg4LjY0NyIgaWQ9IkltcG9ydGVkLUxheWVycy1Db3B5LTIiIGZpbGw9IiM0NTVBNjQiIHNrZXRjaDp0eXBlPSJNU1NoYXBlR3JvdXAiPjwvcGF0aD4KICAgICAgICAgICAgPC9nPgogICAgICAgIDwvZz4KICAgIDwvZz4KPC9zdmc+")};var VIEWER_KEY="WEBVR_CARDBOARD_VIEWER";function ViewerSelector(){try{this.selectedKey=localStorage.getItem(VIEWER_KEY)}catch(error){console.error("Failed to load viewer profile: %s",error)}if(!this.selectedKey){this.selectedKey="CardboardV1"}this.dialog=this.createDialog_(DeviceInfo.Viewers);this.root=null;this.onChangeCallbacks_=[]}ViewerSelector.prototype.show=function(root){this.root=root;root.appendChild(this.dialog);var selected=this.dialog.querySelector("#"+this.selectedKey);selected.checked=!0;this.dialog.style.display="block"};ViewerSelector.prototype.hide=function(){if(this.root&&this.root.contains(this.dialog)){this.root.removeChild(this.dialog)}this.dialog.style.display="none"};ViewerSelector.prototype.getCurrentViewer=function(){return DeviceInfo.Viewers[this.selectedKey]};ViewerSelector.prototype.getSelectedKey_=function(){var input=this.dialog.querySelector("input[name=field]:checked");if(input){return input.id}return null};ViewerSelector.prototype.onChange=function(cb){this.onChangeCallbacks_.push(cb)};ViewerSelector.prototype.fireOnChange_=function(viewer){for(var i=0;i<this.onChangeCallbacks_.length;i++){this.onChangeCallbacks_[i](viewer)}};ViewerSelector.prototype.onSave_=function(){this.selectedKey=this.getSelectedKey_();if(!this.selectedKey||!DeviceInfo.Viewers[this.selectedKey]){console.error("ViewerSelector.onSave_: this should never happen!");return}this.fireOnChange_(DeviceInfo.Viewers[this.selectedKey]);try{localStorage.setItem(VIEWER_KEY,this.selectedKey)}catch(error){console.error("Failed to save viewer profile: %s",error)}this.hide()};ViewerSelector.prototype.createDialog_=function(options){var container=document.createElement("div");container.classList.add("webvr-polyfill-viewer-selector");container.style.display="none";var overlay=document.createElement("div"),s=overlay.style;s.position="fixed";s.left=0;s.top=0;s.width="100%";s.height="100%";s.background="rgba(0, 0, 0, 0.3)";overlay.addEventListener("click",this.hide.bind(this));var width=280,dialog=document.createElement("div"),s=dialog.style;s.boxSizing="border-box";s.position="fixed";s.top="24px";s.left="50%";s.marginLeft=-width/2+"px";s.width=width+"px";s.padding="24px";s.overflow="hidden";s.background="#fafafa";s.fontFamily="'Roboto', sans-serif";s.boxShadow="0px 5px 20px #666";dialog.appendChild(this.createH1_("Select your viewer"));for(var id in options){dialog.appendChild(this.createChoice_(id,options[id].label))}dialog.appendChild(this.createButton_("Save",this.onSave_.bind(this)));container.appendChild(overlay);container.appendChild(dialog);return container};ViewerSelector.prototype.createH1_=function(name){var h1=document.createElement("h1"),s=h1.style;s.color="black";s.fontSize="20px";s.fontWeight="bold";s.marginTop=0;s.marginBottom="24px";h1.innerHTML=name;return h1};ViewerSelector.prototype.createChoice_=function(id,name){var div=document.createElement("div");div.style.marginTop="8px";div.style.color="black";var input=document.createElement("input");input.style.fontSize="30px";input.setAttribute("id",id);input.setAttribute("type","radio");input.setAttribute("value",id);input.setAttribute("name","field");var label=document.createElement("label");label.style.marginLeft="4px";label.setAttribute("for",id);label.innerHTML=name;div.appendChild(input);div.appendChild(label);return div};ViewerSelector.prototype.createButton_=function(label,onclick){var button=document.createElement("button");button.innerHTML=label;var s=button.style;s.float="right";s.textTransform="uppercase";s.color="#1094f7";s.fontSize="14px";s.letterSpacing=0;s.border=0;s.background="none";s.marginTop="16px";button.addEventListener("click",onclick);return button};var commonjsGlobal$$1="undefined"!==typeof window?window:"undefined"!==typeof commonjsGlobal?commonjsGlobal:"undefined"!==typeof self?self:{};var NoSleep=function(fn,module){return module={exports:{}},fn(module,module.exports),module.exports}(function(module){(function(root,factory){module.exports=factory()})(commonjsGlobal$$1,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId]){return installedModules[moduleId].exports}var module=installedModules[moduleId]={i:moduleId,l:!1,exports:{}};modules[moduleId].call(module.exports,module,module.exports,__webpack_require__);module.l=!0;return module.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.d=function(exports,name,getter){if(!__webpack_require__.o(exports,name)){Object.defineProperty(exports,name,{configurable:!1,enumerable:!0,get:getter})}};__webpack_require__.n=function(module){var getter=module&&module.__esModule?function(){return module["default"]}:function(){return module};__webpack_require__.d(getter,"a",getter);return getter};__webpack_require__.o=function(object,property){return Object.prototype.hasOwnProperty.call(object,property)};__webpack_require__.p="";return __webpack_require__(__webpack_require__.s=0)}([function(module,exports,__webpack_require__){var _createClass=function(){function defineProperties(target,props){for(var i=0,descriptor;i<props.length;i++){descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1;descriptor.configurable=!0;if("value"in descriptor)descriptor.writable=!0;Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor}}();function _classCallCheck(instance,Constructor){if(!babelHelpers.instanceof(instance,Constructor)){throw new TypeError("Cannot call a class as a function")}}var mediaFile=__webpack_require__(1),oldIOS="undefined"!==typeof navigator&&10>parseFloat((""+(/CPU.*OS ([0-9_]{3,4})[0-9_]{0,1}|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent)||[0,""])[1]).replace("undefined","3_2").replace("_",".").replace("_",""))&&!window.MSStream,NoSleep=function(){function NoSleep(){_classCallCheck(this,NoSleep);if(oldIOS){this.noSleepTimer=null}else{this.noSleepVideo=document.createElement("video");this.noSleepVideo.setAttribute("playsinline","");this.noSleepVideo.setAttribute("src",mediaFile);this.noSleepVideo.addEventListener("timeupdate",function(){if(.5<this.noSleepVideo.currentTime){this.noSleepVideo.currentTime=Math.random()}}.bind(this))}}_createClass(NoSleep,[{key:"enable",value:function(){if(oldIOS){this.disable();this.noSleepTimer=window.setInterval(function(){window.location.href="/";window.setTimeout(window.stop,0)},15e3)}else{this.noSleepVideo.play()}}},{key:"disable",value:function(){if(oldIOS){if(this.noSleepTimer){window.clearInterval(this.noSleepTimer);this.noSleepTimer=null}}else{this.noSleepVideo.pause()}}}]);return NoSleep}();module.exports=NoSleep},function(module){module.exports="data:video/mp4;base64,AAAAIGZ0eXBtcDQyAAACAGlzb21pc28yYXZjMW1wNDEAAAAIZnJlZQAACKBtZGF0AAAC8wYF///v3EXpvebZSLeWLNgg2SPu73gyNjQgLSBjb3JlIDE0MiByMjQ3OSBkZDc5YTYxIC0gSC4yNjQvTVBFRy00IEFWQyBjb2RlYyAtIENvcHlsZWZ0IDIwMDMtMjAxNCAtIGh0dHA6Ly93d3cudmlkZW9sYW4ub3JnL3gyNjQuaHRtbCAtIG9wdGlvbnM6IGNhYmFjPTEgcmVmPTEgZGVibG9jaz0xOjA6MCBhbmFseXNlPTB4MToweDExMSBtZT1oZXggc3VibWU9MiBwc3k9MSBwc3lfcmQ9MS4wMDowLjAwIG1peGVkX3JlZj0wIG1lX3JhbmdlPTE2IGNocm9tYV9tZT0xIHRyZWxsaXM9MCA4eDhkY3Q9MCBjcW09MCBkZWFkem9uZT0yMSwxMSBmYXN0X3Bza2lwPTEgY2hyb21hX3FwX29mZnNldD0wIHRocmVhZHM9NiBsb29rYWhlYWRfdGhyZWFkcz0xIHNsaWNlZF90aHJlYWRzPTAgbnI9MCBkZWNpbWF0ZT0xIGludGVybGFjZWQ9MCBibHVyYXlfY29tcGF0PTAgY29uc3RyYWluZWRfaW50cmE9MCBiZnJhbWVzPTMgYl9weXJhbWlkPTIgYl9hZGFwdD0xIGJfYmlhcz0wIGRpcmVjdD0xIHdlaWdodGI9MSBvcGVuX2dvcD0wIHdlaWdodHA9MSBrZXlpbnQ9MzAwIGtleWludF9taW49MzAgc2NlbmVjdXQ9NDAgaW50cmFfcmVmcmVzaD0wIHJjX2xvb2thaGVhZD0xMCByYz1jcmYgbWJ0cmVlPTEgY3JmPTIwLjAgcWNvbXA9MC42MCBxcG1pbj0wIHFwbWF4PTY5IHFwc3RlcD00IHZidl9tYXhyYXRlPTIwMDAwIHZidl9idWZzaXplPTI1MDAwIGNyZl9tYXg9MC4wIG5hbF9ocmQ9bm9uZSBmaWxsZXI9MCBpcF9yYXRpbz0xLjQwIGFxPTE6MS4wMACAAAAAOWWIhAA3//p+C7v8tDDSTjf97w55i3SbRPO4ZY+hkjD5hbkAkL3zpJ6h/LR1CAABzgB1kqqzUorlhQAAAAxBmiQYhn/+qZYADLgAAAAJQZ5CQhX/AAj5IQADQGgcIQADQGgcAAAACQGeYUQn/wALKCEAA0BoHAAAAAkBnmNEJ/8ACykhAANAaBwhAANAaBwAAAANQZpoNExDP/6plgAMuSEAA0BoHAAAAAtBnoZFESwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBnqVEJ/8ACykhAANAaBwAAAAJAZ6nRCf/AAsoIQADQGgcIQADQGgcAAAADUGarDRMQz/+qZYADLghAANAaBwAAAALQZ7KRRUsK/8ACPkhAANAaBwAAAAJAZ7pRCf/AAsoIQADQGgcIQADQGgcAAAACQGe60Qn/wALKCEAA0BoHAAAAA1BmvA0TEM//qmWAAy5IQADQGgcIQADQGgcAAAAC0GfDkUVLCv/AAj5IQADQGgcAAAACQGfLUQn/wALKSEAA0BoHCEAA0BoHAAAAAkBny9EJ/8ACyghAANAaBwAAAANQZs0NExDP/6plgAMuCEAA0BoHAAAAAtBn1JFFSwr/wAI+SEAA0BoHCEAA0BoHAAAAAkBn3FEJ/8ACyghAANAaBwAAAAJAZ9zRCf/AAsoIQADQGgcIQADQGgcAAAADUGbeDRMQz/+qZYADLkhAANAaBwAAAALQZ+WRRUsK/8ACPghAANAaBwhAANAaBwAAAAJAZ+1RCf/AAspIQADQGgcAAAACQGft0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bm7w0TEM//qmWAAy4IQADQGgcAAAAC0Gf2kUVLCv/AAj5IQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHAAAAAkBn/tEJ/8ACykhAANAaBwAAAANQZvgNExDP/6plgAMuSEAA0BoHCEAA0BoHAAAAAtBnh5FFSwr/wAI+CEAA0BoHAAAAAkBnj1EJ/8ACyghAANAaBwhAANAaBwAAAAJAZ4/RCf/AAspIQADQGgcAAAADUGaJDRMQz/+qZYADLghAANAaBwAAAALQZ5CRRUsK/8ACPkhAANAaBwhAANAaBwAAAAJAZ5hRCf/AAsoIQADQGgcAAAACQGeY0Qn/wALKSEAA0BoHCEAA0BoHAAAAA1Bmmg0TEM//qmWAAy5IQADQGgcAAAAC0GehkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGepUQn/wALKSEAA0BoHAAAAAkBnqdEJ/8ACyghAANAaBwAAAANQZqsNExDP/6plgAMuCEAA0BoHCEAA0BoHAAAAAtBnspFFSwr/wAI+SEAA0BoHAAAAAkBnulEJ/8ACyghAANAaBwhAANAaBwAAAAJAZ7rRCf/AAsoIQADQGgcAAAADUGa8DRMQz/+qZYADLkhAANAaBwhAANAaBwAAAALQZ8ORRUsK/8ACPkhAANAaBwAAAAJAZ8tRCf/AAspIQADQGgcIQADQGgcAAAACQGfL0Qn/wALKCEAA0BoHAAAAA1BmzQ0TEM//qmWAAy4IQADQGgcAAAAC0GfUkUVLCv/AAj5IQADQGgcIQADQGgcAAAACQGfcUQn/wALKCEAA0BoHAAAAAkBn3NEJ/8ACyghAANAaBwhAANAaBwAAAANQZt4NExC//6plgAMuSEAA0BoHAAAAAtBn5ZFFSwr/wAI+CEAA0BoHCEAA0BoHAAAAAkBn7VEJ/8ACykhAANAaBwAAAAJAZ+3RCf/AAspIQADQGgcAAAADUGbuzRMQn/+nhAAYsAhAANAaBwhAANAaBwAAAAJQZ/aQhP/AAspIQADQGgcAAAACQGf+UQn/wALKCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHCEAA0BoHAAACiFtb292AAAAbG12aGQAAAAA1YCCX9WAgl8AAAPoAAAH/AABAAABAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADAAAAGGlvZHMAAAAAEICAgAcAT////v7/AAAF+XRyYWsAAABcdGtoZAAAAAPVgIJf1YCCXwAAAAEAAAAAAAAH0AAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAEAAAAAAygAAAMoAAAAAACRlZHRzAAAAHGVsc3QAAAAAAAAAAQAAB9AAABdwAAEAAAAABXFtZGlhAAAAIG1kaGQAAAAA1YCCX9WAgl8AAV+QAAK/IFXEAAAAAAAtaGRscgAAAAAAAAAAdmlkZQAAAAAAAAAAAAAAAFZpZGVvSGFuZGxlcgAAAAUcbWluZgAAABR2bWhkAAAAAQAAAAAAAAAAAAAAJGRpbmYAAAAcZHJlZgAAAAAAAAABAAAADHVybCAAAAABAAAE3HN0YmwAAACYc3RzZAAAAAAAAAABAAAAiGF2YzEAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAygDKAEgAAABIAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAY//8AAAAyYXZjQwFNQCj/4QAbZ01AKOyho3ySTUBAQFAAAAMAEAAr8gDxgxlgAQAEaO+G8gAAABhzdHRzAAAAAAAAAAEAAAA8AAALuAAAABRzdHNzAAAAAAAAAAEAAAABAAAB8GN0dHMAAAAAAAAAPAAAAAEAABdwAAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAADqYAAAAAQAAF3AAAAABAAAAAAAAAAEAAAu4AAAAAQAAOpgAAAABAAAXcAAAAAEAAAAAAAAAAQAAC7gAAAABAAA6mAAAAAEAABdwAAAAAQAAAAAAAAABAAALuAAAAAEAAC7gAAAAAQAAF3AAAAABAAAAAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAEEc3RzegAAAAAAAAAAAAAAPAAAAzQAAAAQAAAADQAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAAPAAAADQAAAA0AAAARAAAADwAAAA0AAAANAAAAEQAAAA8AAAANAAAADQAAABEAAAANAAAADQAAAQBzdGNvAAAAAAAAADwAAAAwAAADZAAAA3QAAAONAAADoAAAA7kAAAPQAAAD6wAAA/4AAAQXAAAELgAABEMAAARcAAAEbwAABIwAAAShAAAEugAABM0AAATkAAAE/wAABRIAAAUrAAAFQgAABV0AAAVwAAAFiQAABaAAAAW1AAAFzgAABeEAAAX+AAAGEwAABiwAAAY/AAAGVgAABnEAAAaEAAAGnQAABrQAAAbPAAAG4gAABvUAAAcSAAAHJwAAB0AAAAdTAAAHcAAAB4UAAAeeAAAHsQAAB8gAAAfjAAAH9gAACA8AAAgmAAAIQQAACFQAAAhnAAAIhAAACJcAAAMsdHJhawAAAFx0a2hkAAAAA9WAgl/VgIJfAAAAAgAAAAAAAAf8AAAAAAAAAAAAAAABAQAAAAABAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAACsm1kaWEAAAAgbWRoZAAAAADVgIJf1YCCXwAArEQAAWAAVcQAAAAAACdoZGxyAAAAAAAAAABzb3VuAAAAAAAAAAAAAAAAU3RlcmVvAAAAAmNtaW5mAAAAEHNtaGQAAAAAAAAAAAAAACRkaW5mAAAAHGRyZWYAAAAAAAAAAQAAAAx1cmwgAAAAAQAAAidzdGJsAAAAZ3N0c2QAAAAAAAAAAQAAAFdtcDRhAAAAAAAAAAEAAAAAAAAAAAACABAAAAAArEQAAAAAADNlc2RzAAAAAAOAgIAiAAIABICAgBRAFQAAAAADDUAAAAAABYCAgAISEAaAgIABAgAAABhzdHRzAAAAAAAAAAEAAABYAAAEAAAAABxzdHNjAAAAAAAAAAEAAAABAAAAAQAAAAEAAAAUc3RzegAAAAAAAAAGAAAAWAAAAXBzdGNvAAAAAAAAAFgAAAOBAAADhwAAA5oAAAOtAAADswAAA8oAAAPfAAAD5QAAA/gAAAQLAAAEEQAABCgAAAQ9AAAEUAAABFYAAARpAAAEgAAABIYAAASbAAAErgAABLQAAATHAAAE3gAABPMAAAT5AAAFDAAABR8AAAUlAAAFPAAABVEAAAVXAAAFagAABX0AAAWDAAAFmgAABa8AAAXCAAAFyAAABdsAAAXyAAAF+AAABg0AAAYgAAAGJgAABjkAAAZQAAAGZQAABmsAAAZ+AAAGkQAABpcAAAauAAAGwwAABskAAAbcAAAG7wAABwYAAAcMAAAHIQAABzQAAAc6AAAHTQAAB2QAAAdqAAAHfwAAB5IAAAeYAAAHqwAAB8IAAAfXAAAH3QAAB/AAAAgDAAAICQAACCAAAAg1AAAIOwAACE4AAAhhAAAIeAAACH4AAAiRAAAIpAAACKoAAAiwAAAItgAACLwAAAjCAAAAFnVkdGEAAAAObmFtZVN0ZXJlbwAAAHB1ZHRhAAAAaG1ldGEAAAAAAAAAIWhkbHIAAAAAAAAAAG1kaXJhcHBsAAAAAAAAAAAAAAAAO2lsc3QAAAAzqXRvbwAAACtkYXRhAAAAAQAAAABIYW5kQnJha2UgMC4xMC4yIDIwMTUwNjExMDA="}])})}),NoSleep$1=function(x){return x&&x.__esModule?x["default"]:x}(NoSleep),nextDisplayId=1e3,defaultLeftBounds=[0,0,.5,1],defaultRightBounds=[.5,0,.5,1],raf=window.requestAnimationFrame,caf=window.cancelAnimationFrame;function VRDisplayCapabilities(config){Object.defineProperties(this,{hasPosition:{writable:!1,enumerable:!0,value:config.hasPosition},hasExternalDisplay:{writable:!1,enumerable:!0,value:config.hasExternalDisplay},canPresent:{writable:!1,enumerable:!0,value:config.canPresent},maxLayers:{writable:!1,enumerable:!0,value:config.maxLayers},hasOrientation:{enumerable:!0,get:function(){deprecateWarning("VRDisplayCapabilities.prototype.hasOrientation","VRDisplay.prototype.getFrameData");return config.hasOrientation}}})}function VRDisplay(config){config=config||{};var USE_WAKELOCK="wakelock"in config?config.wakelock:!0;this.isPolyfilled=!0;this.displayId=nextDisplayId++;this.displayName="";this.depthNear=.01;this.depthFar=1e4;this.isPresenting=!1;Object.defineProperty(this,"isConnected",{get:function(){deprecateWarning("VRDisplay.prototype.isConnected","VRDisplayCapabilities.prototype.hasExternalDisplay");return!1}});this.capabilities=new VRDisplayCapabilities({hasPosition:!1,hasOrientation:!1,hasExternalDisplay:!1,canPresent:!1,maxLayers:1});this.stageParameters=null;this.waitingForPresent_=!1;this.layer_=null;this.originalParent_=null;this.fullscreenElement_=null;this.fullscreenWrapper_=null;this.fullscreenElementCachedStyle_=null;this.fullscreenEventTarget_=null;this.fullscreenChangeHandler_=null;this.fullscreenErrorHandler_=null;if(USE_WAKELOCK&&isMobile()){this.wakelock_=new NoSleep$1}}VRDisplay.prototype.getFrameData=function(frameData){return frameDataFromPose(frameData,this._getPose(),this)};VRDisplay.prototype.getPose=function(){deprecateWarning("VRDisplay.prototype.getPose","VRDisplay.prototype.getFrameData");return this._getPose()};VRDisplay.prototype.resetPose=function(){deprecateWarning("VRDisplay.prototype.resetPose");return this._resetPose()};VRDisplay.prototype.getImmediatePose=function(){deprecateWarning("VRDisplay.prototype.getImmediatePose","VRDisplay.prototype.getFrameData");return this._getPose()};VRDisplay.prototype.requestAnimationFrame=function(callback){return raf(callback)};VRDisplay.prototype.cancelAnimationFrame=function(id){return caf(id)};VRDisplay.prototype.wrapForFullscreen=function(element){if(isIOS()){return element}if(!this.fullscreenWrapper_){this.fullscreenWrapper_=document.createElement("div");var cssProperties=["height: "+_Mathmin(screen.height,screen.width)+"px !important","top: 0 !important","left: 0 !important","right: 0 !important","border: 0","margin: 0","padding: 0","z-index: 999999 !important","position: fixed"];this.fullscreenWrapper_.setAttribute("style",cssProperties.join("; ")+";");this.fullscreenWrapper_.classList.add("webvr-polyfill-fullscreen-wrapper")}if(this.fullscreenElement_==element){return this.fullscreenWrapper_}if(this.fullscreenElement_){if(this.originalParent_){this.originalParent_.appendChild(this.fullscreenElement_)}else{this.fullscreenElement_.parentElement.removeChild(this.fullscreenElement_)}}this.fullscreenElement_=element;this.originalParent_=element.parentElement;if(!this.originalParent_){document.body.appendChild(element)}if(!this.fullscreenWrapper_.parentElement){var parent=this.fullscreenElement_.parentElement;parent.insertBefore(this.fullscreenWrapper_,this.fullscreenElement_);parent.removeChild(this.fullscreenElement_)}this.fullscreenWrapper_.insertBefore(this.fullscreenElement_,this.fullscreenWrapper_.firstChild);this.fullscreenElementCachedStyle_=this.fullscreenElement_.getAttribute("style");var self=this;(function(){if(!self.fullscreenElement_){return}var cssProperties=["position: absolute","top: 0","left: 0","width: "+_Mathmax(screen.width,screen.height)+"px","height: "+_Mathmin(screen.height,screen.width)+"px","border: 0","margin: 0","padding: 0"];self.fullscreenElement_.setAttribute("style",cssProperties.join("; ")+";")})();return this.fullscreenWrapper_};VRDisplay.prototype.removeFullscreenWrapper=function(){if(!this.fullscreenElement_){return}var element=this.fullscreenElement_;if(this.fullscreenElementCachedStyle_){element.setAttribute("style",this.fullscreenElementCachedStyle_)}else{element.removeAttribute("style")}this.fullscreenElement_=null;this.fullscreenElementCachedStyle_=null;var parent=this.fullscreenWrapper_.parentElement;this.fullscreenWrapper_.removeChild(element);if(this.originalParent_===parent){parent.insertBefore(element,this.fullscreenWrapper_)}else if(this.originalParent_){this.originalParent_.appendChild(element)}parent.removeChild(this.fullscreenWrapper_);return element};VRDisplay.prototype.requestPresent=function(layers){var wasPresenting=this.isPresenting,self=this;if(!babelHelpers.instanceof(layers,Array)){deprecateWarning("VRDisplay.prototype.requestPresent with non-array argument","an array of VRLayers as the first argument");layers=[layers]}return new Promise(function(resolve,reject){if(!self.capabilities.canPresent){reject(new Error("VRDisplay is not capable of presenting."));return}if(0==layers.length||layers.length>self.capabilities.maxLayers){reject(new Error("Invalid number of layers."));return}var incomingLayer=layers[0];if(!incomingLayer.source){resolve();return}var leftBounds=incomingLayer.leftBounds||defaultLeftBounds,rightBounds=incomingLayer.rightBounds||defaultRightBounds;if(wasPresenting){var layer=self.layer_;if(layer.source!==incomingLayer.source){layer.source=incomingLayer.source}for(var i=0;4>i;i++){layer.leftBounds[i]=leftBounds[i];layer.rightBounds[i]=rightBounds[i]}self.wrapForFullscreen(self.layer_.source);self.updatePresent_();resolve();return}self.layer_={predistorted:incomingLayer.predistorted,source:incomingLayer.source,leftBounds:leftBounds.slice(0),rightBounds:rightBounds.slice(0)};self.waitingForPresent_=!1;if(self.layer_&&self.layer_.source){var fullscreenElement=self.wrapForFullscreen(self.layer_.source),onFullscreenChange=function(){var actualFullscreenElement=getFullscreenElement();self.isPresenting=fullscreenElement===actualFullscreenElement;if(self.isPresenting){if(screen.orientation&&screen.orientation.lock){screen.orientation.lock("landscape-primary").catch(function(error){console.error("screen.orientation.lock() failed due to",error.message)})}self.waitingForPresent_=!1;self.beginPresent_();resolve()}else{if(screen.orientation&&screen.orientation.unlock){screen.orientation.unlock()}self.removeFullscreenWrapper();self.disableWakeLock();self.endPresent_();self.removeFullscreenListeners_()}self.fireVRDisplayPresentChange_()},onFullscreenError=function(){if(!self.waitingForPresent_){return}self.removeFullscreenWrapper();self.removeFullscreenListeners_();self.disableWakeLock();self.waitingForPresent_=!1;self.isPresenting=!1;reject(new Error("Unable to present."))};self.addFullscreenListeners_(fullscreenElement,onFullscreenChange,onFullscreenError);if(requestFullscreen(fullscreenElement)){self.enableWakeLock();self.waitingForPresent_=!0}else if(isIOS()||isWebViewAndroid()){self.enableWakeLock();self.isPresenting=!0;self.beginPresent_();self.fireVRDisplayPresentChange_();resolve()}}if(!self.waitingForPresent_&&!isIOS()){exitFullscreen();reject(new Error("Unable to present."))}})};VRDisplay.prototype.exitPresent=function(){var wasPresenting=this.isPresenting,self=this;this.isPresenting=!1;this.layer_=null;this.disableWakeLock();return new Promise(function(resolve,reject){if(wasPresenting){if(!exitFullscreen()&&isIOS()){self.endPresent_();self.fireVRDisplayPresentChange_()}if(isWebViewAndroid()){self.removeFullscreenWrapper();self.removeFullscreenListeners_();self.endPresent_();self.fireVRDisplayPresentChange_()}resolve()}else{reject(new Error("Was not presenting to VRDisplay."))}})};VRDisplay.prototype.getLayers=function(){if(this.layer_){return[this.layer_]}return[]};VRDisplay.prototype.fireVRDisplayPresentChange_=function(){var event=new CustomEvent("vrdisplaypresentchange",{detail:{display:this}});window.dispatchEvent(event)};VRDisplay.prototype.fireVRDisplayConnect_=function(){var event=new CustomEvent("vrdisplayconnect",{detail:{display:this}});window.dispatchEvent(event)};VRDisplay.prototype.addFullscreenListeners_=function(element,changeHandler,errorHandler){this.removeFullscreenListeners_();this.fullscreenEventTarget_=element;this.fullscreenChangeHandler_=changeHandler;this.fullscreenErrorHandler_=errorHandler;if(changeHandler){if(document.fullscreenEnabled){element.addEventListener("fullscreenchange",changeHandler,!1)}else if(document.webkitFullscreenEnabled){element.addEventListener("webkitfullscreenchange",changeHandler,!1)}else if(document.mozFullScreenEnabled){document.addEventListener("mozfullscreenchange",changeHandler,!1)}else if(document.msFullscreenEnabled){element.addEventListener("msfullscreenchange",changeHandler,!1)}}if(errorHandler){if(document.fullscreenEnabled){element.addEventListener("fullscreenerror",errorHandler,!1)}else if(document.webkitFullscreenEnabled){element.addEventListener("webkitfullscreenerror",errorHandler,!1)}else if(document.mozFullScreenEnabled){document.addEventListener("mozfullscreenerror",errorHandler,!1)}else if(document.msFullscreenEnabled){element.addEventListener("msfullscreenerror",errorHandler,!1)}}};VRDisplay.prototype.removeFullscreenListeners_=function(){if(!this.fullscreenEventTarget_)return;var element=this.fullscreenEventTarget_;if(this.fullscreenChangeHandler_){var changeHandler=this.fullscreenChangeHandler_;element.removeEventListener("fullscreenchange",changeHandler,!1);element.removeEventListener("webkitfullscreenchange",changeHandler,!1);document.removeEventListener("mozfullscreenchange",changeHandler,!1);element.removeEventListener("msfullscreenchange",changeHandler,!1)}if(this.fullscreenErrorHandler_){var errorHandler=this.fullscreenErrorHandler_;element.removeEventListener("fullscreenerror",errorHandler,!1);element.removeEventListener("webkitfullscreenerror",errorHandler,!1);document.removeEventListener("mozfullscreenerror",errorHandler,!1);element.removeEventListener("msfullscreenerror",errorHandler,!1)}this.fullscreenEventTarget_=null;this.fullscreenChangeHandler_=null;this.fullscreenErrorHandler_=null};VRDisplay.prototype.enableWakeLock=function(){if(this.wakelock_){this.wakelock_.enable()}};VRDisplay.prototype.disableWakeLock=function(){if(this.wakelock_){this.wakelock_.disable()}};VRDisplay.prototype.beginPresent_=function(){};VRDisplay.prototype.endPresent_=function(){};VRDisplay.prototype.submitFrame=function(){};VRDisplay.prototype.getEyeParameters=function(){return null};var config={MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1},Eye={LEFT:"left",RIGHT:"right"};function CardboardVRDisplay(config$$1){var defaults=extend({},config);config$$1=extend(defaults,config$$1||{});VRDisplay.call(this,{wakelock:config$$1.MOBILE_WAKE_LOCK});this.config=config$$1;this.displayName="Cardboard VRDisplay";this.capabilities=new VRDisplayCapabilities({hasPosition:!1,hasOrientation:!0,hasExternalDisplay:!1,canPresent:!0,maxLayers:1});this.stageParameters=null;this.bufferScale_=this.config.BUFFER_SCALE;this.poseSensor_=new PoseSensor(this.config);this.distorter_=null;this.cardboardUI_=null;this.dpdb_=new Dpdb(this.config.DPDB_URL,this.onDeviceParamsUpdated_.bind(this));this.deviceInfo_=new DeviceInfo(this.dpdb_.getDeviceParams());this.viewerSelector_=new ViewerSelector;this.viewerSelector_.onChange(this.onViewerChanged_.bind(this));this.deviceInfo_.setViewer(this.viewerSelector_.getCurrentViewer());if(!this.config.ROTATE_INSTRUCTIONS_DISABLED){this.rotateInstructions_=new RotateInstructions}if(isIOS()){window.addEventListener("resize",this.onResize_.bind(this))}}CardboardVRDisplay.prototype=Object.create(VRDisplay.prototype);CardboardVRDisplay.prototype._getPose=function(){return{position:null,orientation:this.poseSensor_.getOrientation(),linearVelocity:null,linearAcceleration:null,angularVelocity:null,angularAcceleration:null}};CardboardVRDisplay.prototype._resetPose=function(){if(this.poseSensor_.resetPose){this.poseSensor_.resetPose()}};CardboardVRDisplay.prototype._getFieldOfView=function(whichEye){var fieldOfView;if(whichEye==Eye.LEFT){fieldOfView=this.deviceInfo_.getFieldOfViewLeftEye()}else if(whichEye==Eye.RIGHT){fieldOfView=this.deviceInfo_.getFieldOfViewRightEye()}else{console.error("Invalid eye provided: %s",whichEye);return null}return fieldOfView};CardboardVRDisplay.prototype._getEyeOffset=function(whichEye){var offset;if(whichEye==Eye.LEFT){offset=[.5*-this.deviceInfo_.viewer.interLensDistance,0,0]}else if(whichEye==Eye.RIGHT){offset=[.5*this.deviceInfo_.viewer.interLensDistance,0,0]}else{console.error("Invalid eye provided: %s",whichEye);return null}return offset};CardboardVRDisplay.prototype.getEyeParameters=function(whichEye){var offset=this._getEyeOffset(whichEye),fieldOfView=this._getFieldOfView(whichEye),eyeParams={offset:offset,renderWidth:.5*this.deviceInfo_.device.width*this.bufferScale_,renderHeight:this.deviceInfo_.device.height*this.bufferScale_};Object.defineProperty(eyeParams,"fieldOfView",{enumerable:!0,get:function(){deprecateWarning("VRFieldOfView","VRFrameData's projection matrices");return fieldOfView}});return eyeParams};CardboardVRDisplay.prototype.onDeviceParamsUpdated_=function(newParams){if(this.config.DEBUG){console.log("DPDB reported that device params were updated.")}this.deviceInfo_.updateDeviceParams(newParams);if(this.distorter_){this.distorter_.updateDeviceInfo(this.deviceInfo_)}};CardboardVRDisplay.prototype.updateBounds_=function(){if(this.layer_&&this.distorter_&&(this.layer_.leftBounds||this.layer_.rightBounds)){this.distorter_.setTextureBounds(this.layer_.leftBounds,this.layer_.rightBounds)}};CardboardVRDisplay.prototype.beginPresent_=function(){var gl=this.layer_.source.getContext("webgl");if(!gl)gl=this.layer_.source.getContext("experimental-webgl");if(!gl)gl=this.layer_.source.getContext("webgl2");if(!gl)return;if(this.layer_.predistorted){if(!this.config.CARDBOARD_UI_DISABLED){gl.canvas.width=getScreenWidth()*this.bufferScale_;gl.canvas.height=getScreenHeight()*this.bufferScale_;this.cardboardUI_=new CardboardUI(gl)}}else{if(!this.config.CARDBOARD_UI_DISABLED){this.cardboardUI_=new CardboardUI(gl)}this.distorter_=new CardboardDistorter(gl,this.cardboardUI_,this.config.BUFFER_SCALE,this.config.DIRTY_SUBMIT_FRAME_BINDINGS);this.distorter_.updateDeviceInfo(this.deviceInfo_)}if(this.cardboardUI_){this.cardboardUI_.listen(function(e){this.viewerSelector_.show(this.layer_.source.parentElement);e.stopPropagation();e.preventDefault()}.bind(this),function(e){this.exitPresent();e.stopPropagation();e.preventDefault()}.bind(this))}if(this.rotateInstructions_){if(isLandscapeMode()&&isMobile()){this.rotateInstructions_.showTemporarily(3e3,this.layer_.source.parentElement)}else{this.rotateInstructions_.update()}}this.orientationHandler=this.onOrientationChange_.bind(this);window.addEventListener("orientationchange",this.orientationHandler);this.vrdisplaypresentchangeHandler=this.updateBounds_.bind(this);window.addEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler);this.fireVRDisplayDeviceParamsChange_()};CardboardVRDisplay.prototype.endPresent_=function(){if(this.distorter_){this.distorter_.destroy();this.distorter_=null}if(this.cardboardUI_){this.cardboardUI_.destroy();this.cardboardUI_=null}if(this.rotateInstructions_){this.rotateInstructions_.hide()}this.viewerSelector_.hide();window.removeEventListener("orientationchange",this.orientationHandler);window.removeEventListener("vrdisplaypresentchange",this.vrdisplaypresentchangeHandler)};CardboardVRDisplay.prototype.updatePresent_=function(){this.endPresent_();this.beginPresent_()};CardboardVRDisplay.prototype.submitFrame=function(){if(this.distorter_){this.updateBounds_();this.distorter_.submitFrame()}else if(this.cardboardUI_&&this.layer_){var canvas=this.layer_.source.getContext("webgl").canvas;if(canvas.width!=this.lastWidth||canvas.height!=this.lastHeight){this.cardboardUI_.onResize()}this.lastWidth=canvas.width;this.lastHeight=canvas.height;this.cardboardUI_.render()}};CardboardVRDisplay.prototype.onOrientationChange_=function(){this.viewerSelector_.hide();if(this.rotateInstructions_){this.rotateInstructions_.update()}this.onResize_()};CardboardVRDisplay.prototype.onResize_=function(){if(this.layer_){var gl=this.layer_.source.getContext("webgl");gl.canvas.setAttribute("style",["position: absolute","top: 0","left: 0","width: 100vw","height: 100vh","border: 0","margin: 0","padding: 0px","box-sizing: content-box"].join("; ")+";");safariCssSizeWorkaround(gl.canvas)}};CardboardVRDisplay.prototype.onViewerChanged_=function(viewer){this.deviceInfo_.setViewer(viewer);if(this.distorter_){this.distorter_.updateDeviceInfo(this.deviceInfo_)}this.fireVRDisplayDeviceParamsChange_()};CardboardVRDisplay.prototype.fireVRDisplayDeviceParamsChange_=function(){var event=new CustomEvent("vrdisplaydeviceparamschange",{detail:{vrdisplay:this,deviceInfo:this.deviceInfo_}});window.dispatchEvent(event)};CardboardVRDisplay.VRFrameData=function(){this.leftProjectionMatrix=new Float32Array(16);this.leftViewMatrix=new Float32Array(16);this.rightProjectionMatrix=new Float32Array(16);this.rightViewMatrix=new Float32Array(16);this.pose=null};CardboardVRDisplay.VRDisplay=VRDisplay;return CardboardVRDisplay})}),CardboardVRDisplay=function(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x["default"]:x}(cardboardVrDisplay),DefaultConfig={PROVIDE_MOBILE_VRDISPLAY:!0,GET_VR_DISPLAYS_TIMEOUT:1e3,MOBILE_WAKE_LOCK:!0,DEBUG:!1,DPDB_URL:"https://dpdb.webvr.rocks/dpdb.json",K_FILTER:.98,PREDICTION_TIME_S:.04,TOUCH_PANNER_DISABLED:!0,CARDBOARD_UI_DISABLED:!1,ROTATE_INSTRUCTIONS_DISABLED:!1,YAW_ONLY:!1,BUFFER_SCALE:.5,DIRTY_SUBMIT_FRAME_BINDINGS:!1};function WebVRPolyfill(config){this.config=extend(extend({},DefaultConfig),config);this.polyfillDisplays=[];this.enabled=!1;this.hasNative="getVRDisplays"in navigator;this.native={};this.native.getVRDisplays=navigator.getVRDisplays;this.native.VRFrameData=window.VRFrameData;this.native.VRDisplay=window.VRDisplay;if(!this.hasNative||this.config.PROVIDE_MOBILE_VRDISPLAY&&isMobile()){this.enable();this.getVRDisplays().then(function(displays){if(displays&&displays[0]&&displays[0].fireVRDisplayConnect_){displays[0].fireVRDisplayConnect_()}})}}WebVRPolyfill.prototype.getPolyfillDisplays=function(){if(this._polyfillDisplaysPopulated){return this.polyfillDisplays}if(isMobile()){var vrDisplay=new CardboardVRDisplay({MOBILE_WAKE_LOCK:this.config.MOBILE_WAKE_LOCK,DEBUG:this.config.DEBUG,DPDB_URL:this.config.DPDB_URL,CARDBOARD_UI_DISABLED:this.config.CARDBOARD_UI_DISABLED,K_FILTER:this.config.K_FILTER,PREDICTION_TIME_S:this.config.PREDICTION_TIME_S,TOUCH_PANNER_DISABLED:this.config.TOUCH_PANNER_DISABLED,ROTATE_INSTRUCTIONS_DISABLED:this.config.ROTATE_INSTRUCTIONS_DISABLED,YAW_ONLY:this.config.YAW_ONLY,BUFFER_SCALE:this.config.BUFFER_SCALE,DIRTY_SUBMIT_FRAME_BINDINGS:this.config.DIRTY_SUBMIT_FRAME_BINDINGS});this.polyfillDisplays.push(vrDisplay)}this._polyfillDisplaysPopulated=!0;return this.polyfillDisplays};WebVRPolyfill.prototype.enable=function(){this.enabled=!0;if(this.hasNative&&this.native.VRFrameData){var NativeVRFrameData=this.native.VRFrameData,nativeFrameData=new this.native.VRFrameData,nativeGetFrameData=this.native.VRDisplay.prototype.getFrameData;window.VRDisplay.prototype.getFrameData=function(frameData){if(babelHelpers.instanceof(frameData,NativeVRFrameData)){nativeGetFrameData.call(this,frameData);return}nativeGetFrameData.call(this,nativeFrameData);frameData.pose=nativeFrameData.pose;copyArray(nativeFrameData.leftProjectionMatrix,frameData.leftProjectionMatrix);copyArray(nativeFrameData.rightProjectionMatrix,frameData.rightProjectionMatrix);copyArray(nativeFrameData.leftViewMatrix,frameData.leftViewMatrix);copyArray(nativeFrameData.rightViewMatrix,frameData.rightViewMatrix)}}navigator.getVRDisplays=this.getVRDisplays.bind(this);window.VRDisplay=CardboardVRDisplay.VRDisplay;window.VRFrameData=CardboardVRDisplay.VRFrameData};WebVRPolyfill.prototype.getVRDisplays=function(){var _this=this,config=this.config;if(!this.hasNative){return Promise.resolve(this.getPolyfillDisplays())}var timeoutId,vrDisplaysNative=this.native.getVRDisplays.call(navigator),timeoutPromise=new Promise(function(resolve){timeoutId=setTimeout(function(){console.warn("Native WebVR implementation detected, but `getVRDisplays()` failed to resolve. Falling back to polyfill.");resolve([])},config.GET_VR_DISPLAYS_TIMEOUT)});return race([vrDisplaysNative,timeoutPromise]).then(function(nativeDisplays){clearTimeout(timeoutId);return 0<nativeDisplays.length?nativeDisplays:_this.getPolyfillDisplays()})};WebVRPolyfill.version="0.10.5";WebVRPolyfill.VRFrameData=CardboardVRDisplay.VRFrameData;WebVRPolyfill.VRDisplay=CardboardVRDisplay.VRDisplay;var webvrPolyfill=Object.freeze({default:WebVRPolyfill});if("undefined"!==typeof commonjsGlobal&&commonjsGlobal.window){if(!commonjsGlobal.document){commonjsGlobal.document=commonjsGlobal.window.document}if(!commonjsGlobal.navigator){commonjsGlobal.navigator=commonjsGlobal.window.navigator}}return webvrPolyfill&&WebVRPolyfill||webvrPolyfill})}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{}],47:[function(_dereq_,module){var newline=/\n/,newlineChar="\n",whitespace=/\s/;module.exports=function(text,opt){var lines=module.exports.lines(text,opt);return lines.map(function(line){return text.substring(line.start,line.end)}).join("\n")};module.exports.lines=function(text,opt){opt=opt||{};if(0===opt.width&&"nowrap"!==opt.mode)return[];text=text||"";var width="number"===typeof opt.width?opt.width:_NumberMAX_VALUE,start=_Mathmax(0,opt.start||0),end="number"===typeof opt.end?opt.end:text.length,mode=opt.mode,measure=opt.measure||monospace;if("pre"===mode)return pre(measure,text,start,end,width);else return greedy(measure,text,start,end,width,mode)};function idxOf(text,chr,start,end){var idx=text.indexOf(chr,start);if(-1===idx||idx>end)return end;return idx}function isWhitespace(chr){return whitespace.test(chr)}function pre(measure,text,start,end,width){for(var lines=[],lineStart=start,i=start;i<end&&i<text.length;i++){var chr=text.charAt(i),isNewline=newline.test(chr);if(isNewline||i===end-1){var lineEnd=isNewline?i:i+1,measured=measure(text,lineStart,lineEnd,width);lines.push(measured);lineStart=i+1}}return lines}function greedy(measure,text,start,end,width,mode){var lines=[],testWidth=width;if("nowrap"===mode)testWidth=_NumberMAX_VALUE;while(start<end&&start<text.length){var newLine=idxOf(text,newlineChar,start,end);while(start<newLine){if(!isWhitespace(text.charAt(start)))break;start++}var measured=measure(text,start,newLine,testWidth),lineEnd=start+(measured.end-measured.start),nextStart=lineEnd+newlineChar.length;if(lineEnd<newLine){while(lineEnd>start){if(isWhitespace(text.charAt(lineEnd)))break;lineEnd--}if(lineEnd===start){if(nextStart>start+newlineChar.length)nextStart--;lineEnd=nextStart}else{nextStart=lineEnd;while(lineEnd>start){if(!isWhitespace(text.charAt(lineEnd-newlineChar.length)))break;lineEnd--}}}if(lineEnd>=start){var result=measure(text,start,lineEnd,testWidth);lines.push(result)}start=nextStart}return lines}function monospace(text,start,end,width){var glyphs=_Mathmin(width,end-start);return{start:start,end:start+glyphs}}},{}],48:[function(_dereq_,module){"use strict";var window=_dereq_("global/window"),isFunction=_dereq_("is-function"),parseHeaders=_dereq_("parse-headers"),xtend=_dereq_("xtend");module.exports=createXHR;createXHR.XMLHttpRequest=window.XMLHttpRequest||function(){};createXHR.XDomainRequest="withCredentials"in new createXHR.XMLHttpRequest?createXHR.XMLHttpRequest:window.XDomainRequest;(function(array,iterator){for(var i=0;i<array.length;i++){iterator(array[i])}})(["get","put","post","patch","head","delete"],function(method){createXHR["delete"===method?"del":method]=function(uri,options,callback){options=initParams(uri,options,callback);options.method=method.toUpperCase();return _createXHR(options)}});function isEmpty(obj){for(var i in obj){if(obj.hasOwnProperty(i))return!1}return!0}function initParams(uri,options,callback){var params=uri;if(isFunction(options)){callback=options;if("string"===typeof uri){params={uri:uri}}}else{params=xtend(options,{uri:uri})}params.callback=callback;return params}function createXHR(uri,options,callback){options=initParams(uri,options,callback);return _createXHR(options)}function _createXHR(options){if("undefined"===typeof options.callback){throw new Error("callback argument missing")}var called=!1,callback=function(err,response,body){if(!called){called=!0;options.callback(err,response,body)}};function readystatechange(){if(4===xhr.readyState){setTimeout(loadFunc,0)}}function getBody(){var body;if(xhr.response){body=xhr.response}else{body=xhr.responseText||getXml(xhr)}if(isJson){try{body=JSON.parse(body)}catch(e){}}return body}function errorFunc(evt){clearTimeout(timeoutTimer);if(!babelHelpers.instanceof(evt,Error)){evt=new Error(""+(evt||"Unknown XMLHttpRequest Error"))}evt.statusCode=0;return callback(evt,failureResponse)}function loadFunc(){if(aborted)return;var status;clearTimeout(timeoutTimer);if(options.useXDR&&xhr.status===void 0){status=200}else{status=1223===xhr.status?204:xhr.status}var response=failureResponse,err=null;if(0!==status){response={body:getBody(),statusCode:status,method:method,headers:{},url:uri,rawRequest:xhr};if(xhr.getAllResponseHeaders){response.headers=parseHeaders(xhr.getAllResponseHeaders())}}else{err=new Error("Internal XMLHttpRequest Error")}return callback(err,response,response.body)}var xhr=options.xhr||null;if(!xhr){if(options.cors||options.useXDR){xhr=new createXHR.XDomainRequest}else{xhr=new createXHR.XMLHttpRequest}}var key,aborted,uri=xhr.url=options.uri||options.url,method=xhr.method=options.method||"GET",body=options.body||options.data,headers=xhr.headers=options.headers||{},sync=!!options.sync,isJson=!1,timeoutTimer,failureResponse={body:void 0,headers:{},statusCode:0,method:method,url:uri,rawRequest:xhr};if("json"in options&&!1!==options.json){isJson=!0;headers.accept||headers.Accept||(headers.Accept="application/json");if("GET"!==method&&"HEAD"!==method){headers["content-type"]||headers["Content-Type"]||(headers["Content-Type"]="application/json");body=JSON.stringify(!0===options.json?body:options.json)}}xhr.onreadystatechange=readystatechange;xhr.onload=loadFunc;xhr.onerror=errorFunc;xhr.onprogress=function(){};xhr.onabort=function(){aborted=!0};xhr.ontimeout=errorFunc;xhr.open(method,uri,!sync,options.username,options.password);if(!sync){xhr.withCredentials=!!options.withCredentials}if(!sync&&0<options.timeout){timeoutTimer=setTimeout(function(){if(aborted)return;aborted=!0;xhr.abort("timeout");var e=new Error("XMLHttpRequest timeout");e.code="ETIMEDOUT";errorFunc(e)},options.timeout)}if(xhr.setRequestHeader){for(key in headers){if(headers.hasOwnProperty(key)){xhr.setRequestHeader(key,headers[key])}}}else if(options.headers&&!isEmpty(options.headers)){throw new Error("Headers cannot be set on an XDomainRequest object")}if("responseType"in options){xhr.responseType=options.responseType}if("beforeSend"in options&&"function"===typeof options.beforeSend){options.beforeSend(xhr)}xhr.send(body||null);return xhr}function getXml(xhr){try{if("document"===xhr.responseType){return xhr.responseXML}var firefoxBugTakenEffect=xhr.responseXML&&"parsererror"===xhr.responseXML.documentElement.nodeName;if(""===xhr.responseType&&!firefoxBugTakenEffect){return xhr.responseXML}}catch(e){}return null}},{"global/window":15,"is-function":19,"parse-headers":30,xtend:50}],49:[function(_dereq_,module){module.exports=function(){if("undefined"!==typeof self.DOMParser){return function(str){var parser=new self.DOMParser;return parser.parseFromString(str,"application/xml")}}if("undefined"!==typeof self.ActiveXObject&&new self.ActiveXObject("Microsoft.XMLDOM")){return function(str){var xmlDoc=new self.ActiveXObject("Microsoft.XMLDOM");xmlDoc.async="false";xmlDoc.loadXML(str);return xmlDoc}}return function(str){var div=document.createElement("div");div.innerHTML=str;return div}}()},{}],50:[function(_dereq_,module){module.exports=function(){for(var target={},i=0,source;i<arguments.length;i++){source=arguments[i];for(var key in source){if(hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var hasOwnProperty=Object.prototype.hasOwnProperty},{}],51:[function(_dereq_,module){module.exports={name:"aframe",version:"0.8.2",description:"A web framework for building virtual reality experiences.",homepage:"https://aframe.io/",main:"dist/aframe-master.js",scripts:{browserify:"browserify src/index.js -s 'AFRAME' -p browserify-derequire",build:"shx mkdir -p build/ && npm run browserify -- --debug -t [envify --INSPECTOR_VERSION dev] -o build/aframe.js",codecov:"codecov",dev:"npm run build && cross-env INSPECTOR_VERSION=dev node ./scripts/budo -t envify",dist:"node scripts/updateVersionLog.js && npm run dist:min && npm run dist:max","dist:max":"npm run browserify -s -- --debug | exorcist dist/aframe-master.js.map > dist/aframe-master.js","dist:min":"npm run browserify -s -- --debug -p [minifyify --map aframe-master.min.js.map --output dist/aframe-master.min.js.map] -o dist/aframe-master.min.js",docs:"markserv --dir docs --port 9001",preghpages:"node ./scripts/preghpages.js",ghpages:"ghpages -p gh-pages/",lint:"semistandard -v | snazzy","lint:fix":"semistandard --fix",precommit:"npm run lint",prepush:"node scripts/testOnlyCheck.js",prerelease:"node scripts/release.js 0.7.1 0.8.0",start:"npm run dev",test:"karma start ./tests/karma.conf.js","test:docs":"node scripts/docsLint.js","test:firefox":"npm test -- --browsers Firefox","test:chrome":"npm test -- --browsers Chrome","test:node":"mocha --ui tdd tests/node"},repository:"aframevr/aframe",license:"MIT",dependencies:{"@tweenjs/tween.js":"^16.8.0","browserify-css":"^0.8.2",debug:"ngokevin/debug#noTimestamp","deep-assign":"^2.0.0","document-register-element":"dmarcos/document-register-element#8ccc532b7",envify:"^3.4.1","load-bmfont":"^1.2.3","object-assign":"^4.0.1",present:"0.0.6","promise-polyfill":"^3.1.0","style-attr":"^1.0.2",three:"github:supermedium/three.js#r90fixMTLLoader","three-bmfont-text":"^2.1.0","webvr-polyfill":"^0.10.5"},devDependencies:{browserify:"^13.1.0","browserify-derequire":"^0.9.4","browserify-istanbul":"^2.0.0",budo:"^9.2.0",chai:"^3.5.0","chai-shallow-deep-equal":"^1.4.0",chalk:"^1.1.3",codecov:"^1.0.1","cross-env":"^5.0.1",exorcist:"^0.4.0",ghpages:"0.0.8","git-rev":"^0.2.1",glob:"^7.1.1",husky:"^0.11.7",istanbul:"^0.4.5",jsdom:"^9.11.0",karma:"1.4.1","karma-browserify":"^5.1.0","karma-chai-shallow-deep-equal":"0.0.4","karma-chrome-launcher":"^2.0.0","karma-coverage":"^1.1.1","karma-env-preprocessor":"^0.1.1","karma-firefox-launcher":"^1.0.0","karma-mocha":"^1.1.1","karma-mocha-reporter":"^2.1.0","karma-sinon-chai":"1.2.4",lolex:"^1.5.1",markserv:"github:sukima/markserv#feature/fix-broken-websoketio-link",minifyify:"^7.3.3",mocha:"^3.0.2","mozilla-download":"^1.1.1","replace-in-file":"^2.5.3",semistandard:"^9.0.0",shelljs:"^0.7.7",shx:"^0.2.2",sinon:"^1.17.5","sinon-chai":"2.8.0",snazzy:"^5.0.0","too-wordy":"ngokevin/too-wordy",uglifyjs:"^2.4.10","write-good":"^0.9.1"},link:!0,browserify:{transform:["browserify-css","envify"]},semistandard:{ignore:["build/**","dist/**","examples/**/shaders/*.js","**/vendor/**"]},keywords:["3d","aframe","cardboard","components","oculus","three","three.js","rift","vive","vr","web-components","webvr"],"browserify-css":{minify:!0},engines:{node:">= 4.6.0",npm:"^2.15.9"}}},{}],52:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,THREE=_dereq_("../lib/three");module.exports.Component=registerComponent("camera",{schema:{active:{default:!0},far:{default:1e4},fov:{default:80,min:0},near:{default:.005,min:0},spectator:{default:!1},zoom:{default:1,min:0}},init:function init(){var camera,el=this.el;camera=this.camera=new THREE.PerspectiveCamera;el.setObject3D("camera",camera)},update:function update(oldData){var data=this.data,camera=this.camera;camera.aspect=data.aspect||window.innerWidth/window.innerHeight;camera.far=data.far;camera.fov=data.fov;camera.near=data.near;camera.zoom=data.zoom;camera.updateProjectionMatrix();this.updateActiveCamera(oldData);this.updateSpectatorCamera(oldData)},updateActiveCamera:function updateActiveCamera(oldData){var data=this.data,el=this.el,system=this.system;if(oldData&&oldData.active===data.active||data.spectator){return}if(data.active&&system.activeCameraEl!==el){system.setActiveCamera(el)}else if(!data.active&&system.activeCameraEl===el){system.disableActiveCamera()}},updateSpectatorCamera:function updateSpectatorCamera(oldData){var data=this.data,el=this.el,system=this.system;if(oldData&&oldData.spectator===data.spectator){return}if(data.spectator&&system.spectatorCameraEl!==el){system.setSpectatorCamera(el)}else if(!data.spectator&&system.spectatorCameraEl===el){system.disableSpectatorCamera()}},remove:function remove(){this.el.removeObject3D("camera")}})},{"../core/component":102,"../lib/three":150}],53:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,THREE=_dereq_("../lib/three");module.exports.Component=registerComponent("collada-model",{schema:{type:"asset"},init:function init(){this.model=null;this.loader=new THREE.ColladaLoader;this.loader.options.convertUpAxis=!0},update:function update(){var self=this,el=this.el,src=this.data;if(!src){return}this.remove();this.loader.load(src,function(colladaModel){self.model=colladaModel.scene;el.setObject3D("mesh",self.model);el.emit("model-loaded",{format:"collada",model:self.model})})},remove:function remove(){if(!this.model){return}this.el.removeObject3D("mesh")}})},{"../core/component":102,"../lib/three":150}],54:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,utils=_dereq_("../utils/"),bind=utils.bind,EVENTS={CLICK:"click",FUSING:"fusing",MOUSEENTER:"mouseenter",MOUSEDOWN:"mousedown",MOUSELEAVE:"mouseleave",MOUSEUP:"mouseup"},STATES={FUSING:"cursor-fusing",HOVERING:"cursor-hovering",HOVERED:"cursor-hovered"},CANVAS_EVENTS={DOWN:["mousedown","touchstart"],UP:["mouseup","touchend"]};module.exports.Component=registerComponent("cursor",{dependencies:["raycaster"],schema:{downEvents:{default:[]},fuse:{default:utils.device.isMobile()},fuseTimeout:{default:1500,min:0},upEvents:{default:[]},rayOrigin:{default:"entity",oneOf:["mouse","entity"]}},init:function init(){var self=this;this.fuseTimeout=void 0;this.cursorDownEl=null;this.intersectedEl=null;this.canvasBounds=document.body.getBoundingClientRect();this.updateCanvasBounds=utils.debounce(function(){self.canvasBounds=self.el.sceneEl.canvas.getBoundingClientRect()},1e3);this.eventDetail={};this.intersectedEventDetail={cursorEl:this.el};this.onCursorDown=bind(this.onCursorDown,this);this.onCursorUp=bind(this.onCursorUp,this);this.onIntersection=bind(this.onIntersection,this);this.onIntersectionCleared=bind(this.onIntersectionCleared,this);this.onMouseMove=bind(this.onMouseMove,this)},update:function update(oldData){if(this.data.rayOrigin===oldData.rayOrigin){return}this.updateMouseEventListeners()},play:function play(){this.addEventListeners()},pause:function pause(){this.removeEventListeners()},remove:function remove(){var el=this.el;el.removeState(STATES.HOVERING);el.removeState(STATES.FUSING);clearTimeout(this.fuseTimeout);if(this.intersectedEl){this.intersectedEl.removeState(STATES.HOVERED)}this.removeEventListeners()},addEventListeners:function addEventListeners(){var canvas,data=this.data,el=this.el,self=this;function addCanvasListeners(){canvas=el.sceneEl.canvas;if(data.downEvents.length||data.upEvents.length){return}CANVAS_EVENTS.DOWN.forEach(function(downEvent){canvas.addEventListener(downEvent,self.onCursorDown)});CANVAS_EVENTS.UP.forEach(function(upEvent){canvas.addEventListener(upEvent,self.onCursorUp)})}canvas=el.sceneEl.canvas;if(canvas){addCanvasListeners()}else{el.sceneEl.addEventListener("render-target-loaded",addCanvasListeners)}data.downEvents.forEach(function(downEvent){el.addEventListener(downEvent,self.onCursorDown)});data.upEvents.forEach(function(upEvent){el.addEventListener(upEvent,self.onCursorUp)});el.addEventListener("raycaster-intersection",this.onIntersection);el.addEventListener("raycaster-intersection-cleared",this.onIntersectionCleared);window.addEventListener("resize",this.updateCanvasBounds)},removeEventListeners:function removeEventListeners(){var canvas,data=this.data,el=this.el,self=this;canvas=el.sceneEl.canvas;if(canvas&&!data.downEvents.length&&!data.upEvents.length){CANVAS_EVENTS.DOWN.forEach(function(downEvent){canvas.removeEventListener(downEvent,self.onCursorDown)});CANVAS_EVENTS.UP.forEach(function(upEvent){canvas.removeEventListener(upEvent,self.onCursorUp)})}data.downEvents.forEach(function(downEvent){el.removeEventListener(downEvent,self.onCursorDown)});data.upEvents.forEach(function(upEvent){el.removeEventListener(upEvent,self.onCursorUp)});el.removeEventListener("raycaster-intersection",this.onIntersection);el.removeEventListener("raycaster-intersection-cleared",this.onIntersectionCleared);canvas.removeEventListener("mousemove",this.onMouseMove);canvas.removeEventListener("touchstart",this.onMouseMove);canvas.removeEventListener("touchmove",this.onMouseMove);canvas.removeEventListener("resize",this.updateCanvasBounds)},updateMouseEventListeners:function updateMouseEventListeners(){var canvas,el=this.el;canvas=el.sceneEl.canvas;canvas.removeEventListener("mousemove",this.onMouseMove);canvas.removeEventListener("touchmove",this.onMouseMove);el.setAttribute("raycaster","useWorldCoordinates",!1);if("mouse"!==this.data.rayOrigin){return}canvas.addEventListener("mousemove",this.onMouseMove,!1);canvas.addEventListener("touchmove",this.onMouseMove,!1);el.setAttribute("raycaster","useWorldCoordinates",!0);this.updateCanvasBounds()},onMouseMove:function(){var direction=new THREE.Vector3,mouse=new THREE.Vector2,origin=new THREE.Vector3,rayCasterConfig={origin:origin,direction:direction};return function(evt){var bounds=this.canvasBounds,camera=this.el.sceneEl.camera,left,point,top;camera.parent.updateMatrixWorld();if("touchmove"===evt.type||"touchstart"===evt.type){point=evt.touches.item(0)}else{point=evt}left=point.clientX-bounds.left;top=point.clientY-bounds.top;mouse.x=2*(left/bounds.width)-1;mouse.y=2*-(top/bounds.height)+1;origin.setFromMatrixPosition(camera.matrixWorld);direction.set(mouse.x,mouse.y,.5).unproject(camera).sub(origin).normalize();this.el.setAttribute("raycaster",rayCasterConfig);if("touchmove"===evt.type){evt.preventDefault()}}}(),onCursorDown:function onCursorDown(evt){if("mouse"===this.data.rayOrigin&&"touchstart"===evt.type){this.onMouseMove(evt);this.el.components.raycaster.checkIntersections();evt.preventDefault()}this.twoWayEmit(EVENTS.MOUSEDOWN);this.cursorDownEl=this.intersectedEl},onCursorUp:function onCursorUp(evt){this.twoWayEmit(EVENTS.MOUSEUP);if(this.cursorDownEl&&this.cursorDownEl!==this.intersectedEl){this.intersectedEventDetail.intersection=null;this.cursorDownEl.emit(EVENTS.MOUSEUP,this.intersectedEventDetail)}if(!this.data.fuse&&this.intersectedEl&&this.cursorDownEl===this.intersectedEl){this.twoWayEmit(EVENTS.CLICK)}this.cursorDownEl=null;if("touchend"===evt.type){evt.preventDefault()}},onIntersection:function onIntersection(evt){var currentIntersection,cursorEl=this.el,index,intersectedEl,intersection;index=evt.detail.els[0]===cursorEl?1:0;intersection=evt.detail.intersections[index];intersectedEl=evt.detail.els[index];if(!intersectedEl){return}if(this.intersectedEl===intersectedEl){return}if(this.intersectedEl){currentIntersection=this.el.components.raycaster.getIntersection(this.intersectedEl);if(currentIntersection.distance<=intersection.distance){return}}this.clearCurrentIntersection(!0);this.setIntersection(intersectedEl,intersection)},onIntersectionCleared:function onIntersectionCleared(evt){var clearedEls=evt.detail.clearedEls;if(-1===clearedEls.indexOf(this.intersectedEl)){return}this.clearCurrentIntersection()},setIntersection:function setIntersection(intersectedEl){var cursorEl=this.el,data=this.data,self=this;if(this.intersectedEl===intersectedEl){return}this.intersectedEl=intersectedEl;cursorEl.addState(STATES.HOVERING);intersectedEl.addState(STATES.HOVERED);this.twoWayEmit(EVENTS.MOUSEENTER);if(0===data.fuseTimeout||!data.fuse){return}cursorEl.addState(STATES.FUSING);this.twoWayEmit(EVENTS.FUSING);this.fuseTimeout=setTimeout(function(){cursorEl.removeState(STATES.FUSING);self.twoWayEmit(EVENTS.CLICK)},data.fuseTimeout)},clearCurrentIntersection:function clearCurrentIntersection(ignoreRemaining){var index,intersection,intersections,cursorEl=this.el;if(!this.intersectedEl){return}this.intersectedEl.removeState(STATES.HOVERED);cursorEl.removeState(STATES.HOVERING);cursorEl.removeState(STATES.FUSING);this.twoWayEmit(EVENTS.MOUSELEAVE);this.intersectedEl=null;clearTimeout(this.fuseTimeout);if(!0===ignoreRemaining){return}intersections=this.el.components.raycaster.intersections;if(0===intersections.length){return}index=intersections[0].object.el===cursorEl?1:0;intersection=intersections[index];if(!intersection){return}this.setIntersection(intersection.object.el,intersection)},twoWayEmit:function twoWayEmit(evtName){var el=this.el,intersectedEl=this.intersectedEl,intersection;intersection=this.el.components.raycaster.getIntersection(intersectedEl);this.eventDetail.intersectedEl=intersectedEl;this.eventDetail.intersection=intersection;el.emit(evtName,this.eventDetail);if(!intersectedEl){return}this.intersectedEventDetail.intersection=intersection;intersectedEl.emit(evtName,this.intersectedEventDetail)}})},{"../core/component":102,"../utils/":172}],55:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,bind=_dereq_("../utils/bind"),checkControllerPresentAndSetup=_dereq_("../utils/tracked-controls").checkControllerPresentAndSetup,trackedControlsUtils=_dereq_("../utils/tracked-controls"),emitIfAxesChanged=trackedControlsUtils.emitIfAxesChanged,onButtonEvent=trackedControlsUtils.onButtonEvent,DAYDREAM_CONTROLLER_MODEL_BASE_URL="https://cdn.aframe.io/controllers/google/",GAMEPAD_ID_PREFIX="Daydream Controller";module.exports.Component=registerComponent("daydream-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:{axes:{trackpad:[0,1]},buttons:["trackpad","menu","system"]},bindMethods:function bindMethods(){this.onModelLoaded=bind(this.onModelLoaded,this);this.onControllersUpdate=bind(this.onControllersUpdate,this);this.checkIfControllerPresent=bind(this.checkIfControllerPresent,this);this.removeControllersUpdateListener=bind(this.removeControllersUpdateListener,this);this.onAxisMoved=bind(this.onAxisMoved,this)},init:function init(){var self=this;this.animationActive="pointing";this.onButtonChanged=bind(this.onButtonChanged,this);this.onButtonDown=function(evt){onButtonEvent(evt.detail.id,"down",self)};this.onButtonUp=function(evt){onButtonEvent(evt.detail.id,"up",self)};this.onButtonTouchStart=function(evt){onButtonEvent(evt.detail.id,"touchstart",self)};this.onButtonTouchEnd=function(evt){onButtonEvent(evt.detail.id,"touchend",self)};this.onAxisMoved=bind(this.onAxisMoved,this);this.controllerPresent=!1;this.lastControllerCheck=0;this.bindMethods();this.checkControllerPresentAndSetup=checkControllerPresentAndSetup;this.emitIfAxesChanged=emitIfAxesChanged},addEventListeners:function addEventListeners(){var el=this.el;el.addEventListener("buttonchanged",this.onButtonChanged);el.addEventListener("buttondown",this.onButtonDown);el.addEventListener("buttonup",this.onButtonUp);el.addEventListener("touchstart",this.onButtonTouchStart);el.addEventListener("touchend",this.onButtonTouchEnd);el.addEventListener("model-loaded",this.onModelLoaded);el.addEventListener("axismove",this.onAxisMoved);this.controllerEventsActive=!0},removeEventListeners:function removeEventListeners(){var el=this.el;el.removeEventListener("buttonchanged",this.onButtonChanged);el.removeEventListener("buttondown",this.onButtonDown);el.removeEventListener("buttonup",this.onButtonUp);el.removeEventListener("touchstart",this.onButtonTouchStart);el.removeEventListener("touchend",this.onButtonTouchEnd);el.removeEventListener("model-loaded",this.onModelLoaded);el.removeEventListener("axismove",this.onAxisMoved);this.controllerEventsActive=!1},checkIfControllerPresent:function checkIfControllerPresent(){this.checkControllerPresentAndSetup(this,GAMEPAD_ID_PREFIX,{hand:this.data.hand})},play:function play(){this.checkIfControllerPresent();this.addControllersUpdateListener()},pause:function pause(){this.removeEventListeners();this.removeControllersUpdateListener()},injectTrackedControls:function injectTrackedControls(){var el=this.el,data=this.data;el.setAttribute("tracked-controls",{armModel:data.armModel,hand:data.hand,idPrefix:GAMEPAD_ID_PREFIX,orientationOffset:data.orientationOffset});if(!this.data.model){return}this.el.setAttribute("obj-model",{obj:DAYDREAM_CONTROLLER_MODEL_BASE_URL+"vr_controller_daydream.obj",mtl:DAYDREAM_CONTROLLER_MODEL_BASE_URL+"vr_controller_daydream.mtl"})},addControllersUpdateListener:function addControllersUpdateListener(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function removeControllersUpdateListener(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function onControllersUpdate(){this.checkIfControllerPresent()},onModelLoaded:function onModelLoaded(evt){var controllerObject3D=evt.detail.model,buttonMeshes;if(!this.data.model){return}buttonMeshes=this.buttonMeshes={};buttonMeshes.menu=controllerObject3D.getObjectByName("AppButton_AppButton_Cylinder.004");buttonMeshes.system=controllerObject3D.getObjectByName("HomeButton_HomeButton_Cylinder.005");buttonMeshes.trackpad=controllerObject3D.getObjectByName("TouchPad_TouchPad_Cylinder.003");controllerObject3D.position.set(0,0,-.04)},onAxisMoved:function onAxisMoved(evt){this.emitIfAxesChanged(this,this.mapping.axes,evt)},onButtonChanged:function onButtonChanged(evt){var button=this.mapping.buttons[evt.detail.id];if(!button)return;this.el.emit(button+"changed",evt.detail.state)},updateModel:function updateModel(buttonName,evtName){if(!this.data.model){return}this.updateButtonModel(buttonName,evtName)},updateButtonModel:function updateButtonModel(buttonName,state){var buttonMeshes=this.buttonMeshes;if(!buttonMeshes||!buttonMeshes[buttonName]){return}var color;switch(state){case"down":color=this.data.buttonHighlightColor;break;case"touchstart":color=this.data.buttonTouchedColor;break;default:color=this.data.buttonColor;}buttonMeshes[buttonName].material.color.set(color)}})},{"../core/component":102,"../utils/bind":166,"../utils/tracked-controls":178}],56:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,bind=_dereq_("../utils/bind"),trackedControlsUtils=_dereq_("../utils/tracked-controls"),checkControllerPresentAndSetup=trackedControlsUtils.checkControllerPresentAndSetup,emitIfAxesChanged=trackedControlsUtils.emitIfAxesChanged,onButtonEvent=trackedControlsUtils.onButtonEvent,GEARVR_CONTROLLER_MODEL_BASE_URL="https://cdn.aframe.io/controllers/samsung/",GAMEPAD_ID_PREFIX="Gear VR|GearVR|Oculus Go";module.exports.Component=registerComponent("gearvr-controls",{schema:{hand:{default:""},buttonColor:{type:"color",default:"#000000"},buttonTouchedColor:{type:"color",default:"#777777"},buttonHighlightColor:{type:"color",default:"#FFFFFF"},model:{default:!0},orientationOffset:{type:"vec3"},armModel:{default:!0}},mapping:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger"]},bindMethods:function bindMethods(){this.onModelLoaded=bind(this.onModelLoaded,this);this.onControllersUpdate=bind(this.onControllersUpdate,this);this.checkIfControllerPresent=bind(this.checkIfControllerPresent,this);this.removeControllersUpdateListener=bind(this.removeControllersUpdateListener,this);this.onAxisMoved=bind(this.onAxisMoved,this)},init:function init(){var self=this;this.animationActive="pointing";this.onButtonChanged=bind(this.onButtonChanged,this);this.onButtonDown=function(evt){onButtonEvent(evt.detail.id,"down",self)};this.onButtonUp=function(evt){onButtonEvent(evt.detail.id,"up",self)};this.onButtonTouchStart=function(evt){onButtonEvent(evt.detail.id,"touchstart",self)};this.onButtonTouchEnd=function(evt){onButtonEvent(evt.detail.id,"touchend",self)};this.onAxisMoved=bind(this.onAxisMoved,this);this.controllerPresent=!1;this.lastControllerCheck=0;this.bindMethods();this.checkControllerPresentAndSetup=checkControllerPresentAndSetup;this.emitIfAxesChanged=emitIfAxesChanged},addEventListeners:function addEventListeners(){var el=this.el;el.addEventListener("buttonchanged",this.onButtonChanged);el.addEventListener("buttondown",this.onButtonDown);el.addEventListener("buttonup",this.onButtonUp);el.addEventListener("touchstart",this.onButtonTouchStart);el.addEventListener("touchend",this.onButtonTouchEnd);el.addEventListener("model-loaded",this.onModelLoaded);el.addEventListener("axismove",this.onAxisMoved);this.controllerEventsActive=!0;this.addControllersUpdateListener()},removeEventListeners:function removeEventListeners(){var el=this.el;el.removeEventListener("buttonchanged",this.onButtonChanged);el.removeEventListener("buttondown",this.onButtonDown);el.removeEventListener("buttonup",this.onButtonUp);el.removeEventListener("touchstart",this.onButtonTouchStart);el.removeEventListener("touchend",this.onButtonTouchEnd);el.removeEventListener("model-loaded",this.onModelLoaded);el.removeEventListener("axismove",this.onAxisMoved);this.controllerEventsActive=!1;this.removeControllersUpdateListener()},checkIfControllerPresent:function checkIfControllerPresent(){this.checkControllerPresentAndSetup(this,GAMEPAD_ID_PREFIX,this.data.hand?{hand:this.data.hand}:{})},play:function play(){this.checkIfControllerPresent();this.addControllersUpdateListener()},pause:function pause(){this.removeEventListeners();this.removeControllersUpdateListener()},injectTrackedControls:function injectTrackedControls(){var el=this.el,data=this.data;el.setAttribute("tracked-controls",{armModel:data.armModel,idPrefix:GAMEPAD_ID_PREFIX,orientationOffset:data.orientationOffset});if(!this.data.model){return}this.el.setAttribute("obj-model",{obj:GEARVR_CONTROLLER_MODEL_BASE_URL+"gear_vr_controller.obj",mtl:GEARVR_CONTROLLER_MODEL_BASE_URL+"gear_vr_controller.mtl"})},addControllersUpdateListener:function addControllersUpdateListener(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function removeControllersUpdateListener(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function onControllersUpdate(){this.checkIfControllerPresent()},onModelLoaded:function onModelLoaded(evt){var controllerObject3D=evt.detail.model,buttonMeshes;if(!this.data.model){return}buttonMeshes=this.buttonMeshes={};buttonMeshes.trigger=controllerObject3D.children[2];buttonMeshes.trackpad=controllerObject3D.children[1]},onButtonChanged:function onButtonChanged(evt){var button=this.mapping.buttons[evt.detail.id];if(!button)return;this.el.emit(button+"changed",evt.detail.state)},onAxisMoved:function onAxisMoved(evt){this.emitIfAxesChanged(this,this.mapping.axes,evt)},updateModel:function updateModel(buttonName,evtName){if(!this.data.model){return}this.updateButtonModel(buttonName,evtName)},updateButtonModel:function updateButtonModel(buttonName,state){var buttonMeshes=this.buttonMeshes;if(!buttonMeshes||!buttonMeshes[buttonName]){return}var color;switch(state){case"down":color=this.data.buttonHighlightColor;break;case"touchstart":color=this.data.buttonTouchedColor;break;default:color=this.data.buttonColor;}buttonMeshes[buttonName].material.color.set(color)}})},{"../core/component":102,"../utils/bind":166,"../utils/tracked-controls":178}],57:[function(_dereq_,module){var geometries=_dereq_("../core/geometry").geometries,geometryNames=_dereq_("../core/geometry").geometryNames,registerComponent=_dereq_("../core/component").registerComponent,THREE=_dereq_("../lib/three"),dummyGeometry=new THREE.Geometry;module.exports.Component=registerComponent("geometry",{schema:{buffer:{default:!0},primitive:{default:"box",oneOf:geometryNames},skipCache:{default:!1}},init:function init(){this.geometry=null},update:function update(previousData){var data=this.data,el=this.el,mesh,system=this.system;if(this.geometry){system.unuseGeometry(previousData);this.geometry=null}this.geometry=system.getOrCreateGeometry(data);mesh=el.getObject3D("mesh");if(mesh){mesh.geometry=this.geometry}else{mesh=new THREE.Mesh;mesh.geometry=this.geometry;el.setObject3D("mesh",mesh)}},remove:function remove(){this.system.unuseGeometry(this.data);this.el.getObject3D("mesh").geometry=dummyGeometry;this.geometry=null},updateSchema:function updateSchema(data){var newGeometryType=data.primitive,currentGeometryType=this.data&&this.data.primitive,schema=geometries[newGeometryType]&&geometries[newGeometryType].schema;if(!schema){throw new Error("Unknown geometry schema `"+newGeometryType+"`")}if(currentGeometryType&&currentGeometryType===newGeometryType){return}this.extendSchema(schema)}})},{"../core/component":102,"../core/geometry":103,"../lib/three":150}],58:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,THREE=_dereq_("../lib/three"),utils=_dereq_("../utils/"),warn=utils.debug("components:gltf-model:warn");module.exports.Component=registerComponent("gltf-model",{schema:{type:"model"},init:function init(){this.model=null;this.loader=new THREE.GLTFLoader},update:function update(){var self=this,el=this.el,src=this.data;if(!src){return}this.remove();this.loader.load(src,function(gltfModel){self.model=gltfModel.scene||gltfModel.scenes[0];self.model.animations=gltfModel.animations;el.setObject3D("mesh",self.model);el.emit("model-loaded",{format:"gltf",model:self.model})},void 0,function(error){var message=error&&error.message?error.message:"Failed to load glTF model";warn(message);el.emit("model-error",{format:"gltf",src:src})})},remove:function remove(){if(!this.model){return}this.el.removeObject3D("mesh")}})},{"../core/component":102,"../lib/three":150,"../utils/":172}],59:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,MODEL_URLS={left:"https://cdn.aframe.io/controllers/oculus-hands/v2/leftHand.json",right:"https://cdn.aframe.io/controllers/oculus-hands/v2/rightHand.json"},ANIMATIONS={open:"Open",point:"Point",pointThumb:"Point + Thumb",fist:"Fist",hold:"Hold",thumbUp:"Thumb Up"},EVENTS={};EVENTS[ANIMATIONS.fist]="grip";EVENTS[ANIMATIONS.thumbUp]="pistol";EVENTS[ANIMATIONS.point]="pointing";EVENTS[ANIMATIONS.thumb]="thumb";module.exports.Component=registerComponent("hand-controls",{schema:{default:"left"},init:function init(){var self=this,el=this.el;this.gesture=ANIMATIONS.open;this.pressedButtons={};this.touchedButtons={};this.loader=new THREE.ObjectLoader;this.loader.setCrossOrigin("anonymous");this.onGripDown=function(){self.handleButton("grip","down")};this.onGripUp=function(){self.handleButton("grip","up")};this.onTrackpadDown=function(){self.handleButton("trackpad","down")};this.onTrackpadUp=function(){self.handleButton("trackpad","up")};this.onTrackpadTouchStart=function(){self.handleButton("trackpad","touchstart")};this.onTrackpadTouchEnd=function(){self.handleButton("trackpad","touchend")};this.onTriggerDown=function(){self.handleButton("trigger","down")};this.onTriggerUp=function(){self.handleButton("trigger","up")};this.onTriggerTouchStart=function(){self.handleButton("trigger","touchstart")};this.onTriggerTouchEnd=function(){self.handleButton("trigger","touchend")};this.onGripTouchStart=function(){self.handleButton("grip","touchstart")};this.onGripTouchEnd=function(){self.handleButton("grip","touchend")};this.onThumbstickDown=function(){self.handleButton("thumbstick","down")};this.onThumbstickUp=function(){self.handleButton("thumbstick","up")};this.onAorXTouchStart=function(){self.handleButton("AorX","touchstart")};this.onAorXTouchEnd=function(){self.handleButton("AorX","touchend")};this.onBorYTouchStart=function(){self.handleButton("BorY","touchstart")};this.onBorYTouchEnd=function(){self.handleButton("BorY","touchend")};this.onSurfaceTouchStart=function(){self.handleButton("surface","touchstart")};this.onSurfaceTouchEnd=function(){self.handleButton("surface","touchend")};this.onControllerConnected=function(){self.setModelVisibility(!0)};this.onControllerDisconnected=function(){self.setModelVisibility(!1)};el.addEventListener("controllerconnected",this.onControllerConnected);el.addEventListener("controllerdisconnected",this.onControllerDisconnected)},play:function play(){this.addEventListeners()},pause:function pause(){this.removeEventListeners()},tick:function tick(time,delta){var mesh=this.el.getObject3D("mesh");if(!mesh||!mesh.mixer){return}mesh.mixer.update(delta/1e3)},addEventListeners:function addEventListeners(){var el=this.el;el.addEventListener("gripdown",this.onGripDown);el.addEventListener("gripup",this.onGripUp);el.addEventListener("trackpaddown",this.onTrackpadDown);el.addEventListener("trackpadup",this.onTrackpadUp);el.addEventListener("trackpadtouchstart",this.onTrackpadTouchStart);el.addEventListener("trackpadtouchend",this.onTrackpadTouchEnd);el.addEventListener("triggerdown",this.onTriggerDown);el.addEventListener("triggerup",this.onTriggerUp);el.addEventListener("triggertouchstart",this.onTriggerTouchStart);el.addEventListener("triggertouchend",this.onTriggerTouchEnd);el.addEventListener("griptouchstart",this.onGripTouchStart);el.addEventListener("griptouchend",this.onGripTouchEnd);el.addEventListener("thumbstickdown",this.onThumbstickDown);el.addEventListener("thumbstickup",this.onThumbstickUp);el.addEventListener("abuttontouchstart",this.onAorXTouchStart);el.addEventListener("abuttontouchend",this.onAorXTouchEnd);el.addEventListener("bbuttontouchstart",this.onBorYTouchStart);el.addEventListener("bbuttontouchend",this.onBorYTouchEnd);el.addEventListener("xbuttontouchstart",this.onAorXTouchStart);el.addEventListener("xbuttontouchend",this.onAorXTouchEnd);el.addEventListener("ybuttontouchstart",this.onBorYTouchStart);el.addEventListener("ybuttontouchend",this.onBorYTouchEnd);el.addEventListener("surfacetouchstart",this.onSurfaceTouchStart);el.addEventListener("surfacetouchend",this.onSurfaceTouchEnd)},removeEventListeners:function removeEventListeners(){var el=this.el;el.removeEventListener("gripdown",this.onGripDown);el.removeEventListener("gripup",this.onGripUp);el.removeEventListener("trackpaddown",this.onTrackpadDown);el.removeEventListener("trackpadup",this.onTrackpadUp);el.removeEventListener("trackpadtouchstart",this.onTrackpadTouchStart);el.removeEventListener("trackpadtouchend",this.onTrackpadTouchEnd);el.removeEventListener("triggerdown",this.onTriggerDown);el.removeEventListener("triggerup",this.onTriggerUp);el.removeEventListener("triggertouchstart",this.onTriggerTouchStart);el.removeEventListener("triggertouchend",this.onTriggerTouchEnd);el.removeEventListener("griptouchstart",this.onGripTouchStart);el.removeEventListener("griptouchend",this.onGripTouchEnd);el.removeEventListener("thumbstickdown",this.onThumbstickDown);el.removeEventListener("thumbstickup",this.onThumbstickUp);el.removeEventListener("abuttontouchstart",this.onAorXTouchStart);el.removeEventListener("abuttontouchend",this.onAorXTouchEnd);el.removeEventListener("bbuttontouchstart",this.onBorYTouchStart);el.removeEventListener("bbuttontouchend",this.onBorYTouchEnd);el.removeEventListener("xbuttontouchstart",this.onAorXTouchStart);el.removeEventListener("xbuttontouchend",this.onAorXTouchEnd);el.removeEventListener("ybuttontouchstart",this.onBorYTouchStart);el.removeEventListener("ybuttontouchend",this.onBorYTouchEnd);el.removeEventListener("surfacetouchstart",this.onSurfaceTouchStart);el.removeEventListener("surfacetouchend",this.onSurfaceTouchEnd)},update:function update(previousHand){var controlConfiguration,el=this.el,hand=this.data;controlConfiguration={hand:hand,model:!1,orientationOffset:{x:0,y:0,z:"left"===hand?90:-90}};if(hand!==previousHand){this.loader.load(MODEL_URLS[hand],function(scene){var mesh=scene.getObjectByName("Hand");mesh.material.skinning=!0;mesh.mixer=new THREE.AnimationMixer(mesh);el.setObject3D("mesh",mesh);mesh.position.set(0,0,0);mesh.rotation.set(0,0,0);mesh.visible=!1;el.setAttribute("vive-controls",controlConfiguration);el.setAttribute("oculus-touch-controls",controlConfiguration);el.setAttribute("windows-motion-controls",controlConfiguration)})}},remove:function remove(){this.el.removeObject3D("mesh")},handleButton:function handleButton(button,evt){var lastGesture,isPressed="down"===evt,isTouched="touchstart"===evt;if(0===evt.indexOf("touch")){if(isTouched===this.touchedButtons[button]){return}this.touchedButtons[button]=isTouched}else{if(isPressed===this.pressedButtons[button]){return}this.pressedButtons[button]=isPressed}lastGesture=this.gesture;this.gesture=this.determineGesture();if(this.gesture===lastGesture){return}this.animateGesture(this.gesture,lastGesture);this.emitGestureEvents(this.gesture,lastGesture)},determineGesture:function determineGesture(){var gesture,isGripActive=this.pressedButtons.grip,isSurfaceActive=this.pressedButtons.surface||this.touchedButtons.surface,isTrackpadActive=this.pressedButtons.trackpad||this.touchedButtons.trackpad,isTriggerActive=this.pressedButtons.trigger||this.touchedButtons.trigger,isABXYActive=this.touchedButtons.AorX||this.touchedButtons.BorY,isVive=isViveController(this.el.components["tracked-controls"]);if(isGripActive){if(isVive){gesture=ANIMATIONS.fist}else if(isSurfaceActive||isABXYActive||isTrackpadActive){gesture=isTriggerActive?ANIMATIONS.fist:ANIMATIONS.point}else{gesture=isTriggerActive?ANIMATIONS.thumbUp:ANIMATIONS.pointThumb}}else{if(isTriggerActive){gesture=!isVive?ANIMATIONS.hold:ANIMATIONS.fist}else if(isVive&&isTrackpadActive){gesture=ANIMATIONS.point}}return gesture},animateGesture:function animateGesture(gesture,lastGesture){if(gesture){this.playAnimation(gesture||ANIMATIONS.open,lastGesture,!1);return}this.playAnimation(lastGesture,lastGesture,!0)},emitGestureEvents:function emitGestureEvents(gesture,lastGesture){var el=this.el,eventName;if(lastGesture===gesture){return}eventName=getGestureEventName(lastGesture,!1);if(eventName){el.emit(eventName)}eventName=getGestureEventName(gesture,!0);if(eventName){el.emit(eventName)}},playAnimation:function playAnimation(gesture,lastGesture,reverse){var fromAction,mesh=this.el.getObject3D("mesh"),toAction;if(!mesh){return}toAction=mesh.mixer.clipAction(gesture);toAction.clampWhenFinished=!0;toAction.loop=THREE.LoopRepeat;toAction.repetitions=0;toAction.timeScale=reverse?-1:1;toAction.weight=1;if(!lastGesture||gesture===lastGesture){mesh.mixer.stopAllAction();toAction.play();return}fromAction=mesh.mixer.clipAction(lastGesture);mesh.mixer.stopAllAction();fromAction.weight=.15;fromAction.play();toAction.play();fromAction.crossFadeTo(toAction,.15,!0)},setModelVisibility:function setModelVisibility(visible){var model=this.el.getObject3D("mesh");if(!model){return}model.visible=visible}});function getGestureEventName(gesture,active){var eventName;if(!gesture){return}eventName=EVENTS[gesture];if("grip"===eventName){return eventName+(active?"close":"open")}if("point"===eventName||"thumb"===eventName){return eventName+(active?"up":"down")}if("pointing"===eventName||"pistol"===eventName){return eventName+(active?"start":"end")}}function isViveController(trackedControls){var controllerId=trackedControls&&trackedControls.controller&&trackedControls.controller.id;return controllerId&&0===controllerId.indexOf("OpenVR ")}},{"../core/component":102}],60:[function(_dereq_){_dereq_("./camera");_dereq_("./collada-model");_dereq_("./cursor");_dereq_("./daydream-controls");_dereq_("./gearvr-controls");_dereq_("./geometry");_dereq_("./gltf-model");_dereq_("./hand-controls");_dereq_("./laser-controls");_dereq_("./light");_dereq_("./line");_dereq_("./link");_dereq_("./look-controls");_dereq_("./material");_dereq_("./obj-model");_dereq_("./oculus-touch-controls");_dereq_("./position");_dereq_("./raycaster");_dereq_("./rotation");_dereq_("./scale");_dereq_("./shadow");_dereq_("./sound");_dereq_("./text");_dereq_("./tracked-controls");_dereq_("./visible");_dereq_("./vive-controls");_dereq_("./wasd-controls");_dereq_("./windows-motion-controls");_dereq_("./scene/background");_dereq_("./scene/debug");_dereq_("./scene/embedded");_dereq_("./scene/inspector");_dereq_("./scene/fog");_dereq_("./scene/keyboard-shortcuts");_dereq_("./scene/pool");_dereq_("./scene/renderer");_dereq_("./scene/screenshot");_dereq_("./scene/stats");_dereq_("./scene/vr-mode-ui")},{"./camera":52,"./collada-model":53,"./cursor":54,"./daydream-controls":55,"./gearvr-controls":56,"./geometry":57,"./gltf-model":58,"./hand-controls":59,"./laser-controls":61,"./light":62,"./line":63,"./link":64,"./look-controls":65,"./material":66,"./obj-model":67,"./oculus-touch-controls":68,"./position":69,"./raycaster":70,"./rotation":71,"./scale":72,"./scene/background":73,"./scene/debug":74,"./scene/embedded":75,"./scene/fog":76,"./scene/inspector":77,"./scene/keyboard-shortcuts":78,"./scene/pool":79,"./scene/renderer":80,"./scene/screenshot":81,"./scene/stats":82,"./scene/vr-mode-ui":83,"./shadow":84,"./sound":85,"./text":86,"./tracked-controls":87,"./visible":88,"./vive-controls":89,"./wasd-controls":90,"./windows-motion-controls":91}],61:[function(_dereq_){var registerComponent=_dereq_("../core/component").registerComponent,utils=_dereq_("../utils/");registerComponent("laser-controls",{schema:{hand:{default:"right"}},init:function init(){var config=this.config,data=this.data,el=this.el,self=this;el.setAttribute("daydream-controls",{hand:data.hand});el.setAttribute("gearvr-controls",{hand:data.hand});el.setAttribute("oculus-touch-controls",{hand:data.hand});el.setAttribute("vive-controls",{hand:data.hand});el.setAttribute("windows-motion-controls",{hand:data.hand});el.addEventListener("controllerconnected",createRay);el.addEventListener("controllerdisconnected",function(){el.setAttribute("raycaster","showLine",!1)});el.addEventListener("controllermodelready",function(evt){createRay(evt);self.modelReady=!0});function createRay(evt){var controllerConfig=config[evt.detail.name];if(!controllerConfig){return}var raycasterConfig=utils.extend({showLine:!0},controllerConfig.raycaster||{});if(evt.detail.rayOrigin){raycasterConfig.origin=evt.detail.rayOrigin.origin;raycasterConfig.direction=evt.detail.rayOrigin.direction;raycasterConfig.showLine=!0}if(evt.detail.rayOrigin||!self.modelReady){el.setAttribute("raycaster",raycasterConfig)}else{el.setAttribute("raycaster","showLine",!0)}el.setAttribute("cursor",utils.extend({fuse:!1},controllerConfig.cursor))}},config:{"daydream-controls":{cursor:{downEvents:["trackpaddown"],upEvents:["trackpadup"]}},"gearvr-controls":{cursor:{downEvents:["trackpaddown","triggerdown"],upEvents:["trackpadup","triggerup"]},raycaster:{origin:{x:0,y:5e-4,z:0}}},"oculus-touch-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{origin:{x:0,y:0,z:0}}},"vive-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]}},"windows-motion-controls":{cursor:{downEvents:["triggerdown"],upEvents:["triggerup"]},raycaster:{showLine:!1}}}})},{"../core/component":102,"../utils/":172}],62:[function(_dereq_,module){var bind=_dereq_("../utils/bind"),diff=_dereq_("../utils").diff,debug=_dereq_("../utils/debug"),registerComponent=_dereq_("../core/component").registerComponent,THREE=_dereq_("../lib/three"),degToRad=THREE.Math.degToRad,warn=debug("components:light:warn");module.exports.Component=registerComponent("light",{schema:{angle:{default:60,if:{type:["spot"]}},color:{type:"color"},groundColor:{type:"color",if:{type:["hemisphere"]}},decay:{default:1,if:{type:["point","spot"]}},distance:{default:0,min:0,if:{type:["point","spot"]}},intensity:{default:1,min:0,if:{type:["ambient","directional","hemisphere","point","spot"]}},penumbra:{default:0,min:0,max:1,if:{type:["spot"]}},type:{default:"directional",oneOf:["ambient","directional","hemisphere","point","spot"]},target:{type:"selector",if:{type:["spot","directional"]}},castShadow:{default:!1,if:{type:["point","spot","directional"]}},shadowBias:{default:0,if:{castShadow:!0}},shadowCameraFar:{default:500,if:{castShadow:!0}},shadowCameraFov:{default:90,if:{castShadow:!0}},shadowCameraNear:{default:.5,if:{castShadow:!0}},shadowCameraTop:{default:5,if:{castShadow:!0}},shadowCameraRight:{default:5,if:{castShadow:!0}},shadowCameraBottom:{default:-5,if:{castShadow:!0}},shadowCameraLeft:{default:-5,if:{castShadow:!0}},shadowCameraVisible:{default:!1,if:{castShadow:!0}},shadowMapHeight:{default:512,if:{castShadow:!0}},shadowMapWidth:{default:512,if:{castShadow:!0}}},init:function init(){var el=this.el;this.light=null;this.defaultTarget=null;this.system.registerLight(el)},update:function update(oldData){var data=this.data,diffData=diff(data,oldData),light=this.light,self=this;if(light&&!("type"in diffData)){var shadowsLoaded=!1;Object.keys(diffData).forEach(function(key){var value=data[key];switch(key){case"color":{light.color.set(value);break}case"groundColor":{light.groundColor.set(value);break}case"angle":{light.angle=degToRad(value);break}case"target":{if(null===value){if("spot"===data.type||"directional"===data.type){light.target=self.defaultTarget}}else{if(value.hasLoaded){self.onSetTarget(value,light)}else{value.addEventListener("loaded",bind(self.onSetTarget,self,value,light))}}break}case"castShadow":case"shadowBias":case"shadowCameraFar":case"shadowCameraFov":case"shadowCameraNear":case"shadowCameraTop":case"shadowCameraRight":case"shadowCameraBottom":case"shadowCameraLeft":case"shadowCameraVisible":case"shadowMapHeight":case"shadowMapWidth":if(!shadowsLoaded){self.updateShadow();shadowsLoaded=!0}break;default:{light[key]=value}}});return}this.setLight(this.data);this.updateShadow()},setLight:function setLight(data){var el=this.el,newLight=this.getLight(data);if(newLight){if(this.light){el.removeObject3D("light")}this.light=newLight;this.light.el=el;el.setObject3D("light",this.light);if("spot"===data.type||"directional"===data.type||"hemisphere"===data.type){el.getObject3D("light").translateY(-1)}if("spot"===data.type){el.setObject3D("light-target",this.defaultTarget);el.getObject3D("light-target").position.set(0,0,-1)}}},updateShadow:function updateShadow(){var el=this.el,data=this.data,light=this.light;light.castShadow=data.castShadow;var cameraHelper=el.getObject3D("cameraHelper");if(data.shadowCameraVisible&&!cameraHelper){el.setObject3D("cameraHelper",new THREE.CameraHelper(light.shadow.camera))}else if(!data.shadowCameraVisible&&cameraHelper){el.removeObject3D("cameraHelper")}if(!data.castShadow){return light}light.shadow.bias=data.shadowBias;light.shadow.mapSize.height=data.shadowMapHeight;light.shadow.mapSize.width=data.shadowMapWidth;light.shadow.camera.near=data.shadowCameraNear;light.shadow.camera.far=data.shadowCameraFar;if(babelHelpers.instanceof(light.shadow.camera,THREE.OrthographicCamera)){light.shadow.camera.top=data.shadowCameraTop;light.shadow.camera.right=data.shadowCameraRight;light.shadow.camera.bottom=data.shadowCameraBottom;light.shadow.camera.left=data.shadowCameraLeft}else{light.shadow.camera.fov=data.shadowCameraFov}light.shadow.camera.updateProjectionMatrix();if(cameraHelper){cameraHelper.update()}},getLight:function getLight(data){var angle=data.angle,color=new THREE.Color(data.color).getHex(),decay=data.decay,distance=data.distance,groundColor=new THREE.Color(data.groundColor).getHex(),intensity=data.intensity,type=data.type,target=data.target,light=null;switch(type.toLowerCase()){case"ambient":{return new THREE.AmbientLight(color,intensity)}case"directional":{light=new THREE.DirectionalLight(color,intensity);this.defaultTarget=light.target;if(target){if(target.hasLoaded){this.onSetTarget(target,light)}else{target.addEventListener("loaded",bind(this.onSetTarget,this,target,light))}}return light}case"hemisphere":{return new THREE.HemisphereLight(color,groundColor,intensity)}case"point":{return new THREE.PointLight(color,intensity,distance,decay)}case"spot":{light=new THREE.SpotLight(color,intensity,distance,degToRad(angle),data.penumbra,decay);this.defaultTarget=light.target;if(target){if(target.hasLoaded){this.onSetTarget(target,light)}else{target.addEventListener("loaded",bind(this.onSetTarget,this,target,light))}}return light}default:{warn("%s is not a valid light type. "+"Choose from ambient, directional, hemisphere, point, spot.",type)}}},onSetTarget:function onSetTarget(targetEl,light){light.target=targetEl.object3D},remove:function remove(){var el=this.el;el.removeObject3D("light");if(el.getObject3D("cameraHelper")){el.removeObject3D("cameraHelper")}}})},{"../core/component":102,"../lib/three":150,"../utils":172,"../utils/bind":166,"../utils/debug":168}],63:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent;module.exports.Component=registerComponent("line",{schema:{start:{type:"vec3",default:{x:0,y:0,z:0}},end:{type:"vec3",default:{x:0,y:0,z:0}},color:{type:"color",default:"#74BEC1"},opacity:{type:"number",default:1},visible:{default:!0}},multiple:!0,init:function init(){var data=this.data,geometry,material;material=this.material=new THREE.LineBasicMaterial({color:data.color,opacity:data.opacity,transparent:1>data.opacity,visible:data.visible});geometry=this.geometry=new THREE.BufferGeometry;geometry.addAttribute("position",new THREE.BufferAttribute(new Float32Array(3*2),3));this.line=new THREE.Line(geometry,material);this.el.setObject3D(this.attrName,this.line)},update:function update(oldData){var data=this.data,geometry=this.geometry,geoNeedsUpdate=!1,material=this.material,positionArray=geometry.attributes.position.array;if(!isEqualVec3(data.start,oldData.start)){positionArray[0]=data.start.x;positionArray[1]=data.start.y;positionArray[2]=data.start.z;geoNeedsUpdate=!0}if(!isEqualVec3(data.end,oldData.end)){positionArray[3]=data.end.x;positionArray[4]=data.end.y;positionArray[5]=data.end.z;geoNeedsUpdate=!0}if(geoNeedsUpdate){geometry.attributes.position.needsUpdate=!0;geometry.computeBoundingSphere()}material.color.setStyle(data.color);material.opacity=data.opacity;material.transparent=1>data.opacity;material.visible=data.visible},remove:function remove(){this.el.removeObject3D("line",this.line)}});function isEqualVec3(a,b){if(!a||!b){return!1}return a.x===b.x&&a.y===b.y&&a.z===b.z}},{"../core/component":102}],64:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,registerShader=_dereq_("../core/shader").registerShader,THREE=_dereq_("../lib/three");module.exports.Component=registerComponent("link",{schema:{backgroundColor:{default:"red",type:"color"},borderColor:{default:"white",type:"color"},highlighted:{default:!1},highlightedColor:{default:"#24CAFF",type:"color"},href:{default:""},image:{type:"asset"},on:{default:"click"},peekMode:{default:!1},title:{default:""},titleColor:{default:"white",type:"color"},visualAspectEnabled:{default:!0}},init:function init(){this.navigate=this.navigate.bind(this);this.previousQuaternion=void 0;this.quaternionClone=new THREE.Quaternion;this.hiddenEls=[];this.initVisualAspect()},update:function update(oldData){var data=this.data,el=this.el,backgroundColor,strokeColor;backgroundColor=data.highlighted?data.highlightedColor:data.backgroundColor;strokeColor=data.highlighted?data.highlightedColor:data.borderColor;el.setAttribute("material","backgroundColor",backgroundColor);el.setAttribute("material","strokeColor",strokeColor);if(data.on!==oldData.on){this.updateEventListener()}if(data.visualAspectEnabled&&oldData.peekMode!==void 0&&data.peekMode!==oldData.peekMode){this.updatePeekMode()}if(!data.image||oldData.image===data.image){return}el.setAttribute("material","pano","string"===typeof data.image?data.image:data.image.src)},updatePeekMode:function updatePeekMode(){var el=this.el,sphereEl=this.sphereEl;if(this.data.peekMode){this.hideAll();el.getObject3D("mesh").visible=!1;sphereEl.setAttribute("visible",!0)}else{this.showAll();el.getObject3D("mesh").visible=!0;sphereEl.setAttribute("visible",!1)}},play:function play(){this.updateEventListener()},pause:function pause(){this.removeEventListener()},updateEventListener:function updateEventListener(){var el=this.el;if(!el.isPlaying){return}this.removeEventListener();el.addEventListener(this.data.on,this.navigate)},removeEventListener:function removeEventListener(){var on=this.data.on;if(!on){return}this.el.removeEventListener(on,this.navigate)},initVisualAspect:function initVisualAspect(){var el=this.el,semiSphereEl,sphereEl,textEl;if(!this.data.visualAspectEnabled){return}textEl=this.textEl=this.textEl||document.createElement("a-entity");sphereEl=this.sphereEl=this.sphereEl||document.createElement("a-entity");semiSphereEl=this.semiSphereEl=this.semiSphereEl||document.createElement("a-entity");el.setAttribute("geometry",{primitive:"circle",radius:1,segments:64});el.setAttribute("material",{shader:"portal",pano:this.data.image,side:"double"});textEl.setAttribute("text",{color:this.data.titleColor,align:"center",font:"kelsonsans",value:this.data.title||this.data.href,width:4});textEl.setAttribute("position","0 1.5 0");el.appendChild(textEl);semiSphereEl.setAttribute("geometry",{primitive:"sphere",radius:1,phiStart:0,segmentsWidth:64,segmentsHeight:64,phiLength:180,thetaStart:0,thetaLength:360});semiSphereEl.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"});semiSphereEl.setAttribute("rotation","0 180 0");semiSphereEl.setAttribute("position","0 0 0");semiSphereEl.setAttribute("visible",!1);el.appendChild(semiSphereEl);sphereEl.setAttribute("geometry",{primitive:"sphere",radius:10,segmentsWidth:64,segmentsHeight:64});sphereEl.setAttribute("material",{shader:"portal",borderEnabled:0,pano:this.data.image,side:"back"});sphereEl.setAttribute("visible",!1);el.appendChild(sphereEl)},navigate:function navigate(){window.location=this.data.href},tick:function(){var cameraWorldPosition=new THREE.Vector3,elWorldPosition=new THREE.Vector3,quaternion=new THREE.Quaternion,scale=new THREE.Vector3;return function(){var el=this.el,object3D=el.object3D,camera=el.sceneEl.camera,cameraPortalOrientation,distance,textEl=this.textEl;if(!this.data.visualAspectEnabled){return}object3D.updateMatrixWorld();camera.parent.updateMatrixWorld();camera.updateMatrixWorld();object3D.matrix.decompose(elWorldPosition,quaternion,scale);elWorldPosition.setFromMatrixPosition(object3D.matrixWorld);cameraWorldPosition.setFromMatrixPosition(camera.matrixWorld);distance=elWorldPosition.distanceTo(cameraWorldPosition);if(20<distance){if(!this.previousQuaternion){this.quaternionClone.copy(quaternion);this.previousQuaternion=this.quaternionClone}object3D.lookAt(cameraWorldPosition)}else{cameraPortalOrientation=this.calculateCameraPortalOrientation();if(.5>distance){if(!0===this.semiSphereEl.getAttribute("visible")){return}textEl.setAttribute("text","width",1.5);if(0>=cameraPortalOrientation){textEl.setAttribute("position","0 0 0.75");textEl.setAttribute("rotation","0 180 0");this.semiSphereEl.setAttribute("rotation","0 0 0")}else{textEl.setAttribute("position","0 0 -0.75");textEl.setAttribute("rotation","0 0 0");this.semiSphereEl.setAttribute("rotation","0 180 0")}el.getObject3D("mesh").visible=!1;this.semiSphereEl.setAttribute("visible",!0);this.peekCameraPortalOrientation=cameraPortalOrientation}else{if(0>=cameraPortalOrientation){textEl.setAttribute("rotation","0 180 0")}else{textEl.setAttribute("rotation","0 0 0")}textEl.setAttribute("text","width",5);textEl.setAttribute("position","0 1.5 0");el.getObject3D("mesh").visible=!0;this.semiSphereEl.setAttribute("visible",!1);this.peekCameraPortalOrientation=void 0}if(this.previousQuaternion){object3D.quaternion.copy(this.previousQuaternion);this.previousQuaternion=void 0}}}}(),hideAll:function hideAll(){var el=this.el,hiddenEls=this.hiddenEls,self=this;if(0<hiddenEls.length){return}el.sceneEl.object3D.traverse(function(object){if(object&&object.el&&object.el.hasAttribute("link-controls")){return}if(!object.el||object===el.sceneEl.object3D||object.el===el||object.el===self.sphereEl||object.el===el.sceneEl.cameraEl||!1===object.el.getAttribute("visible")||object.el===self.textEl||object.el===self.semiSphereEl){return}object.el.setAttribute("visible",!1);hiddenEls.push(object.el)})},showAll:function showAll(){this.hiddenEls.forEach(function(el){el.setAttribute("visible",!0)});this.hiddenEls=[]},calculateCameraPortalOrientation:function(){var mat4=new THREE.Matrix4,cameraPosition=new THREE.Vector3,portalNormal=new THREE.Vector3(0,0,1),portalPosition=new THREE.Vector3(0,0,0);return function(){var el=this.el,camera=el.sceneEl.camera;cameraPosition.set(0,0,0);portalNormal.set(0,0,1);portalPosition.set(0,0,0);el.object3D.matrixWorld.extractRotation(mat4);portalNormal.applyMatrix4(mat4);el.object3D.updateMatrixWorld();el.object3D.localToWorld(portalPosition);camera.parent.parent.updateMatrixWorld();camera.parent.updateMatrixWorld();camera.updateMatrixWorld();camera.localToWorld(cameraPosition);cameraPosition.sub(portalPosition).normalize();portalNormal.normalize();return _Mathsign(portalNormal.dot(cameraPosition))}}(),remove:function remove(){this.removeEventListener()}});registerShader("portal",{schema:{borderEnabled:{default:1,type:"int",is:"uniform"},backgroundColor:{default:"red",type:"color",is:"uniform"},pano:{type:"map",is:"uniform"},strokeColor:{default:"white",type:"color",is:"uniform"}},vertexShader:["vec3 portalPosition;","varying vec3 vWorldPosition;","varying float vDistanceToCenter;","varying float vDistance;","void main() {","vDistanceToCenter = clamp(length(position - vec3(0.0, 0.0, 0.0)), 0.0, 1.0);","portalPosition = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;","vDistance = length(portalPosition - cameraPosition);","vWorldPosition = (modelMatrix * vec4(position, 1.0)).xyz;","gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","}"].join("\n"),fragmentShader:["#define RECIPROCAL_PI2 0.15915494","uniform sampler2D pano;","uniform vec3 strokeColor;","uniform vec3 backgroundColor;","uniform float borderEnabled;","varying float vDistanceToCenter;","varying float vDistance;","varying vec3 vWorldPosition;","void main() {","vec3 direction = normalize(vWorldPosition - cameraPosition);","vec2 sampleUV;","float borderThickness = clamp(exp(-vDistance / 50.0), 0.6, 0.95);","sampleUV.y = saturate(direction.y * 0.5  + 0.5);","sampleUV.x = atan(direction.z, -direction.x) * -RECIPROCAL_PI2 + 0.5;","if (vDistanceToCenter > borderThickness && borderEnabled == 1.0) {","gl_FragColor = vec4(strokeColor, 1.0);","} else {","gl_FragColor = mix(texture2D(pano, sampleUV), vec4(backgroundColor, 1.0), clamp(pow((vDistance / 15.0), 2.0), 0.0, 1.0));","}","}"].join("\n")})},{"../core/component":102,"../core/shader":111,"../lib/three":150}],65:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,THREE=_dereq_("../lib/three"),utils=_dereq_("../utils/"),bind=utils.bind,PolyfillControls=_dereq_("../utils").device.PolyfillControls,GRABBING_CLASS="a-grabbing",PI_2=_MathPI/2,checkHasPositionalTracking=utils.device.checkHasPositionalTracking;module.exports.Component=registerComponent("look-controls",{dependencies:["position","rotation"],schema:{enabled:{default:!0},hmdEnabled:{default:!0},pointerLockEnabled:{default:!1},reverseMouseDrag:{default:!1},touchEnabled:{default:!0}},init:function init(){this.previousHMDPosition=new THREE.Vector3;this.hmdQuaternion=new THREE.Quaternion;this.hmdEuler=new THREE.Euler;this.position=new THREE.Vector3;this.savedRotation=new THREE.Vector3;this.savedPosition=new THREE.Vector3;this.polyfillObject=new THREE.Object3D;this.polyfillControls=new PolyfillControls(this.polyfillObject);this.rotation={};this.deltaRotation={};this.savedPose=null;this.pointerLocked=!1;this.setupMouseControls();this.bindMethods();this.savedPose={position:new THREE.Vector3,rotation:new THREE.Euler};if(this.el.sceneEl.is("vr-mode")){this.onEnterVR()}},update:function update(oldData){var data=this.data;if(data.enabled!==oldData.enabled){this.updateGrabCursor(data.enabled)}if(oldData&&!data.hmdEnabled&&!oldData.hmdEnabled){this.pitchObject.rotation.set(0,0,0);this.yawObject.rotation.set(0,0,0)}if(oldData&&!data.pointerLockEnabled!==oldData.pointerLockEnabled){this.removeEventListeners();this.addEventListeners();if(this.pointerLocked){document.exitPointerLock()}}},tick:function tick(){var data=this.data;if(!data.enabled){return}this.updateOrientation()},play:function play(){this.addEventListeners()},pause:function pause(){this.removeEventListeners()},remove:function remove(){this.removeEventListeners()},bindMethods:function bindMethods(){this.onMouseDown=bind(this.onMouseDown,this);this.onMouseMove=bind(this.onMouseMove,this);this.onMouseUp=bind(this.onMouseUp,this);this.onTouchStart=bind(this.onTouchStart,this);this.onTouchMove=bind(this.onTouchMove,this);this.onTouchEnd=bind(this.onTouchEnd,this);this.onEnterVR=bind(this.onEnterVR,this);this.onExitVR=bind(this.onExitVR,this);this.onPointerLockChange=bind(this.onPointerLockChange,this);this.onPointerLockError=bind(this.onPointerLockError,this)},setupMouseControls:function setupMouseControls(){this.mouseDown=!1;this.pitchObject=new THREE.Object3D;this.yawObject=new THREE.Object3D;this.yawObject.position.y=10;this.yawObject.add(this.pitchObject)},addEventListeners:function addEventListeners(){var sceneEl=this.el.sceneEl,canvasEl=sceneEl.canvas;if(!canvasEl){sceneEl.addEventListener("render-target-loaded",bind(this.addEventListeners,this));return}canvasEl.addEventListener("mousedown",this.onMouseDown,!1);window.addEventListener("mousemove",this.onMouseMove,!1);window.addEventListener("mouseup",this.onMouseUp,!1);canvasEl.addEventListener("touchstart",this.onTouchStart);window.addEventListener("touchmove",this.onTouchMove);window.addEventListener("touchend",this.onTouchEnd);sceneEl.addEventListener("enter-vr",this.onEnterVR);sceneEl.addEventListener("exit-vr",this.onExitVR);if(this.data.pointerLockEnabled){document.addEventListener("pointerlockchange",this.onPointerLockChange,!1);document.addEventListener("mozpointerlockchange",this.onPointerLockChange,!1);document.addEventListener("pointerlockerror",this.onPointerLockError,!1)}},removeEventListeners:function removeEventListeners(){var sceneEl=this.el.sceneEl,canvasEl=sceneEl&&sceneEl.canvas;if(!canvasEl){return}canvasEl.removeEventListener("mousedown",this.onMouseDown);window.removeEventListener("mousemove",this.onMouseMove);window.removeEventListener("mouseup",this.onMouseUp);canvasEl.removeEventListener("touchstart",this.onTouchStart);window.removeEventListener("touchmove",this.onTouchMove);window.removeEventListener("touchend",this.onTouchEnd);sceneEl.removeEventListener("enter-vr",this.onEnterVR);sceneEl.removeEventListener("exit-vr",this.onExitVR);document.removeEventListener("pointerlockchange",this.onPointerLockChange,!1);document.removeEventListener("mozpointerlockchange",this.onPointerLockChange,!1);document.removeEventListener("pointerlockerror",this.onPointerLockError,!1)},updateOrientation:function updateOrientation(){var el=this.el,hmdEuler=this.hmdEuler,pitchObject=this.pitchObject,yawObject=this.yawObject,sceneEl=this.el.sceneEl;if(sceneEl.is("vr-mode")&&sceneEl.checkHeadsetConnected()){return}this.polyfillControls.update();hmdEuler.setFromQuaternion(this.polyfillObject.quaternion,"YXZ");el.object3D.rotation.x=hmdEuler.x+pitchObject.rotation.x;el.object3D.rotation.y=hmdEuler.y+yawObject.rotation.y;el.object3D.rotation.z=0},onMouseMove:function onMouseMove(event){var direction,movementX,movementY,pitchObject=this.pitchObject,previousMouseEvent=this.previousMouseEvent,yawObject=this.yawObject;if(!this.data.enabled||!this.mouseDown&&!this.pointerLocked){return}if(this.pointerLocked){movementX=event.movementX||event.mozMovementX||0;movementY=event.movementY||event.mozMovementY||0}else{movementX=event.screenX-previousMouseEvent.screenX;movementY=event.screenY-previousMouseEvent.screenY}this.previousMouseEvent=event;direction=this.data.reverseMouseDrag?1:-1;yawObject.rotation.y+=.002*movementX*direction;pitchObject.rotation.x+=.002*movementY*direction;pitchObject.rotation.x=_Mathmax(-PI_2,_Mathmin(PI_2,pitchObject.rotation.x))},onMouseDown:function onMouseDown(evt){if(!this.data.enabled){return}if(0!==evt.button){return}var sceneEl=this.el.sceneEl,canvasEl=sceneEl&&sceneEl.canvas;this.mouseDown=!0;this.previousMouseEvent=evt;document.body.classList.add(GRABBING_CLASS);if(this.data.pointerLockEnabled&&!this.pointerLocked){if(canvasEl.requestPointerLock){canvasEl.requestPointerLock()}else if(canvasEl.mozRequestPointerLock){canvasEl.mozRequestPointerLock()}}},onMouseUp:function onMouseUp(){this.mouseDown=!1;document.body.classList.remove(GRABBING_CLASS)},onTouchStart:function onTouchStart(evt){if(1!==evt.touches.length||!this.data.touchEnabled){return}this.touchStart={x:evt.touches[0].pageX,y:evt.touches[0].pageY};this.touchStarted=!0},onTouchMove:function onTouchMove(evt){var canvas=this.el.sceneEl.canvas,deltaY,yawObject=this.yawObject;if(!this.touchStarted||!this.data.touchEnabled){return}deltaY=2*_MathPI*(evt.touches[0].pageX-this.touchStart.x)/canvas.clientWidth;yawObject.rotation.y-=.5*deltaY;this.touchStart={x:evt.touches[0].pageX,y:evt.touches[0].pageY}},onTouchEnd:function onTouchEnd(){this.touchStarted=!1},onEnterVR:function onEnterVR(){this.saveCameraPose()},onExitVR:function onExitVR(){this.restoreCameraPose();this.previousHMDPosition.set(0,0,0)},onPointerLockChange:function onPointerLockChange(){this.pointerLocked=!!(document.pointerLockElement||document.mozPointerLockElement)},onPointerLockError:function onPointerLockError(){this.pointerLocked=!1},updateGrabCursor:function updateGrabCursor(enabled){var sceneEl=this.el.sceneEl;function enableGrabCursor(){sceneEl.canvas.classList.add("a-grab-cursor")}function disableGrabCursor(){sceneEl.canvas.classList.remove("a-grab-cursor")}if(!sceneEl.canvas){if(enabled){sceneEl.addEventListener("render-target-loaded",enableGrabCursor)}else{sceneEl.addEventListener("render-target-loaded",disableGrabCursor)}return}if(enabled){enableGrabCursor();return}disableGrabCursor()},saveCameraPose:function saveCameraPose(){var el=this.el,hasPositionalTracking=this.hasPositionalTracking!==void 0?this.hasPositionalTracking:checkHasPositionalTracking();if(this.hasSavedPose||!hasPositionalTracking){return}this.savedPose.position.copy(el.object3D.position);this.savedPose.rotation.copy(el.object3D.rotation);this.hasSavedPose=!0},restoreCameraPose:function restoreCameraPose(){var el=this.el,savedPose=this.savedPose,hasPositionalTracking=this.hasPositionalTracking!==void 0?this.hasPositionalTracking:checkHasPositionalTracking();if(!this.hasSavedPose||!hasPositionalTracking){return}el.object3D.position.copy(savedPose.position);el.object3D.rotation.copy(savedPose.rotation);this.hasSavedPose=!1}})},{"../core/component":102,"../lib/three":150,"../utils":172,"../utils/":172}],66:[function(_dereq_,module){var utils=_dereq_("../utils/"),component=_dereq_("../core/component"),THREE=_dereq_("../lib/three"),shader=_dereq_("../core/shader"),error=utils.debug("components:material:error"),registerComponent=component.registerComponent,shaders=shader.shaders,shaderNames=shader.shaderNames;module.exports.Component=registerComponent("material",{schema:{alphaTest:{default:0,min:0,max:1},depthTest:{default:!0},depthWrite:{default:!0},flatShading:{default:!1},npot:{default:!1},offset:{type:"vec2",default:{x:0,y:0}},opacity:{default:1,min:0,max:1},repeat:{type:"vec2",default:{x:1,y:1}},shader:{default:"standard",oneOf:shaderNames},side:{default:"front",oneOf:["front","back","double"]},transparent:{default:!1},vertexColors:{type:"string",default:"none",oneOf:["face","vertex"]},visible:{default:!0}},init:function init(){this.material=null},update:function update(oldData){var data=this.data;if(!this.shader||data.shader!==oldData.shader){this.updateShader(data.shader)}this.shader.update(this.data);this.updateMaterial(oldData)},updateSchema:function updateSchema(data){var newShader=data.shader,currentShader=this.data&&this.data.shader,shader=newShader||currentShader,schema=shaders[shader]&&shaders[shader].schema;if(!schema){error("Unknown shader schema "+shader)}if(currentShader&&newShader===currentShader){return}this.extendSchema(schema);this.updateBehavior()},updateBehavior:function updateBehavior(){var schema=this.schema,self=this,sceneEl=this.el.sceneEl,tickProperties={},tick=function(time){Object.keys(tickProperties).forEach(function(key){tickProperties[key]=time});self.shader.update(tickProperties)};this.tick=void 0;Object.keys(schema).forEach(function(key){if("time"===schema[key].type){self.tick=tick;tickProperties[key]=!0}});if(!sceneEl){return}if(!this.tick){sceneEl.removeBehavior(this)}else{sceneEl.addBehavior(this)}},updateShader:function updateShader(shaderName){var data=this.data,Shader=shaders[shaderName]&&shaders[shaderName].Shader,shaderInstance;if(!Shader){throw new Error("Unknown shader "+shaderName)}shaderInstance=this.shader=new Shader;shaderInstance.el=this.el;shaderInstance.init(data);this.setMaterial(shaderInstance.material);this.updateSchema(data)},updateMaterial:function updateMaterial(oldData){var data=this.data,material=this.material;material.alphaTest=data.alphaTest;material.depthTest=!1!==data.depthTest;material.depthWrite=!1!==data.depthWrite;material.opacity=data.opacity;material.flatShading=data.flatShading;material.side=parseSide(data.side);material.transparent=!1!==data.transparent||1>data.opacity;material.vertexColors=parseVertexColors(data.vertexColors);material.visible=data.visible;if(Object.keys(oldData).length&&(oldData.alphaTest!==data.alphaTest||oldData.side!==data.side||oldData.vertexColors!==data.vertexColors)){material.needsUpdate=!0}},remove:function remove(){var defaultMaterial=new THREE.MeshBasicMaterial,material=this.material,object3D=this.el.getObject3D("mesh");if(object3D){object3D.material=defaultMaterial}disposeMaterial(material,this.system)},setMaterial:function setMaterial(material){var el=this.el,mesh,system=this.system;if(this.material){disposeMaterial(this.material,system)}this.material=material;system.registerMaterial(material);mesh=el.getObject3D("mesh");if(mesh){mesh.material=material}else{el.addEventListener("object3dset",function waitForMesh(evt){if("mesh"!==evt.detail.type||evt.target!==el){return}el.getObject3D("mesh").material=material;el.removeEventListener("object3dset",waitForMesh)})}}});function parseSide(side){switch(side){case"back":{return THREE.BackSide}case"double":{return THREE.DoubleSide}default:{return THREE.FrontSide}}}function parseVertexColors(coloring){switch(coloring){case"face":{return THREE.FaceColors}case"vertex":{return THREE.VertexColors}default:{return THREE.NoColors}}}function disposeMaterial(material,system){material.dispose();system.unregisterMaterial(material)}},{"../core/component":102,"../core/shader":111,"../lib/three":150,"../utils/":172}],67:[function(_dereq_,module){var debug=_dereq_("../utils/debug"),registerComponent=_dereq_("../core/component").registerComponent,THREE=_dereq_("../lib/three"),warn=debug("components:obj-model:warn");module.exports.Component=registerComponent("obj-model",{schema:{mtl:{type:"model"},obj:{type:"model"}},init:function init(){this.model=null;this.objLoader=new THREE.OBJLoader;this.mtlLoader=new THREE.MTLLoader(this.objLoader.manager);this.mtlLoader.crossOrigin=""},update:function update(){var data=this.data;if(!data.obj){return}this.remove();this.loadObj(data.obj,data.mtl)},remove:function remove(){if(!this.model){return}this.el.removeObject3D("mesh")},loadObj:function loadObj(objUrl,mtlUrl){var self=this,el=this.el,mtlLoader=this.mtlLoader,objLoader=this.objLoader;if(mtlUrl){if(el.hasAttribute("material")){warn("Material component properties are ignored when a .MTL is provided")}mtlLoader.setTexturePath(mtlUrl.substr(0,mtlUrl.lastIndexOf("/")+1));mtlLoader.load(mtlUrl,function(materials){materials.preload();objLoader.setMaterials(materials);objLoader.load(objUrl,function(objModel){self.model=objModel;el.setObject3D("mesh",objModel);el.emit("model-loaded",{format:"obj",model:objModel})})});return}objLoader.load(objUrl,function(objModel){var material=el.components.material;if(material){objModel.traverse(function(child){if(babelHelpers.instanceof(child,THREE.Mesh)){child.material=material.material}})}self.model=objModel;el.setObject3D("mesh",objModel);el.emit("model-loaded",{format:"obj",model:objModel})})}})},{"../core/component":102,"../lib/three":150,"../utils/debug":168}],68:[function(_dereq_,module){var bind=_dereq_("../utils/bind"),registerComponent=_dereq_("../core/component").registerComponent,trackedControlsUtils=_dereq_("../utils/tracked-controls"),THREE=_dereq_("../lib/three"),onButtonEvent=trackedControlsUtils.onButtonEvent,TOUCH_CONTROLLER_MODEL_BASE_URL="https://cdn.aframe.io/controllers/oculus/oculus-touch-controller-",DEFAULT_MODEL_PIVOT_OFFSET=new THREE.Vector3(0,0,-.053),RAY_ORIGIN={left:{origin:{x:.008,y:-.008,z:0},direction:{x:0,y:-.8,z:-1}},right:{origin:{x:-.008,y:-.008,z:0},direction:{x:0,y:-.8,z:-1}}};module.exports.Component=registerComponent("oculus-touch-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#999"},buttonTouchColor:{type:"color",default:"#8AB"},buttonHighlightColor:{type:"color",default:"#2DF"},model:{default:!0},orientationOffset:{type:"vec3",default:{x:43,y:0,z:0}}},mapping:{left:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","xbutton","ybutton","surface"]},right:{axes:{thumbstick:[0,1]},buttons:["thumbstick","trigger","grip","abutton","bbutton","surface"]}},bindMethods:function bindMethods(){this.onModelLoaded=bind(this.onModelLoaded,this);this.onControllersUpdate=bind(this.onControllersUpdate,this);this.checkIfControllerPresent=bind(this.checkIfControllerPresent,this);this.onAxisMoved=bind(this.onAxisMoved,this)},init:function init(){var self=this;this.onButtonChanged=bind(this.onButtonChanged,this);this.onButtonDown=function(evt){onButtonEvent(evt.detail.id,"down",self,self.data.hand)};this.onButtonUp=function(evt){onButtonEvent(evt.detail.id,"up",self,self.data.hand)};this.onButtonTouchStart=function(evt){onButtonEvent(evt.detail.id,"touchstart",self,self.data.hand)};this.onButtonTouchEnd=function(evt){onButtonEvent(evt.detail.id,"touchend",self,self.data.hand)};this.controllerPresent=!1;this.lastControllerCheck=0;this.previousButtonValues={};this.bindMethods();this.emitIfAxesChanged=trackedControlsUtils.emitIfAxesChanged;this.checkControllerPresentAndSetup=trackedControlsUtils.checkControllerPresentAndSetup},addEventListeners:function addEventListeners(){var el=this.el;el.addEventListener("buttonchanged",this.onButtonChanged);el.addEventListener("buttondown",this.onButtonDown);el.addEventListener("buttonup",this.onButtonUp);el.addEventListener("touchstart",this.onButtonTouchStart);el.addEventListener("touchend",this.onButtonTouchEnd);el.addEventListener("axismove",this.onAxisMoved);el.addEventListener("model-loaded",this.onModelLoaded);this.controllerEventsActive=!0},removeEventListeners:function removeEventListeners(){var el=this.el;el.removeEventListener("buttonchanged",this.onButtonChanged);el.removeEventListener("buttondown",this.onButtonDown);el.removeEventListener("buttonup",this.onButtonUp);el.removeEventListener("touchstart",this.onButtonTouchStart);el.removeEventListener("touchend",this.onButtonTouchEnd);el.removeEventListener("axismove",this.onAxisMoved);el.removeEventListener("model-loaded",this.onModelLoaded);this.controllerEventsActive=!1},checkIfControllerPresent:function checkIfControllerPresent(){this.checkControllerPresentAndSetup(this,"Oculus Touch",{hand:this.data.hand})},play:function play(){this.checkIfControllerPresent();this.addControllersUpdateListener()},pause:function pause(){this.removeEventListeners();this.removeControllersUpdateListener()},updateControllerModel:function updateControllerModel(){var objUrl,mtlUrl;if(!this.data.model){return}if("right"===this.data.hand){objUrl="url("+(TOUCH_CONTROLLER_MODEL_BASE_URL+"right.obj")+")";mtlUrl="url("+(TOUCH_CONTROLLER_MODEL_BASE_URL+"right.mtl")+")"}else{objUrl="url("+(TOUCH_CONTROLLER_MODEL_BASE_URL+"left.obj")+")";mtlUrl="url("+(TOUCH_CONTROLLER_MODEL_BASE_URL+"left.mtl")+")"}this.el.setAttribute("obj-model",{obj:objUrl,mtl:mtlUrl})},injectTrackedControls:function injectTrackedControls(){var data=this.data;this.el.setAttribute("tracked-controls",{id:"right"===data.hand?"Oculus Touch (Right)":"Oculus Touch (Left)",controller:0,orientationOffset:data.orientationOffset});this.updateControllerModel()},addControllersUpdateListener:function addControllersUpdateListener(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function removeControllersUpdateListener(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function onControllersUpdate(){this.checkIfControllerPresent()},onButtonChanged:function onButtonChanged(evt){var button=this.mapping[this.data.hand].buttons[evt.detail.id],buttonMeshes=this.buttonMeshes,analogValue;if(!button){return}if("trigger"===button||"grip"===button){analogValue=evt.detail.state.value}if(buttonMeshes){if("trigger"===button&&buttonMeshes.trigger){buttonMeshes.trigger.rotation.x=-analogValue*(_MathPI/24)}if("grip"===button&&buttonMeshes.grip){buttonMeshes.grip.rotation.y=("left"===this.data.hand?-1:1)*analogValue*(_MathPI/60)}}this.el.emit(button+"changed",evt.detail.state)},onModelLoaded:function onModelLoaded(evt){var controllerObject3D=evt.detail.model,buttonMeshes;if(!this.data.model){return}var leftHand="left"===this.data.hand;buttonMeshes=this.buttonMeshes={};buttonMeshes.grip=controllerObject3D.getObjectByName(leftHand?"buttonHand_oculus-touch-controller-left.004":"buttonHand_oculus-touch-controller-right.005");buttonMeshes.thumbstick=controllerObject3D.getObjectByName(leftHand?"stick_oculus-touch-controller-left.007":"stick_oculus-touch-controller-right.004");buttonMeshes.trigger=controllerObject3D.getObjectByName(leftHand?"buttonTrigger_oculus-touch-controller-left.005":"buttonTrigger_oculus-touch-controller-right.006");buttonMeshes.xbutton=controllerObject3D.getObjectByName("buttonX_oculus-touch-controller-left.002");buttonMeshes.abutton=controllerObject3D.getObjectByName("buttonA_oculus-touch-controller-right.002");buttonMeshes.ybutton=controllerObject3D.getObjectByName("buttonY_oculus-touch-controller-left.001");buttonMeshes.bbutton=controllerObject3D.getObjectByName("buttonB_oculus-touch-controller-right.003");controllerObject3D.position.copy(DEFAULT_MODEL_PIVOT_OFFSET);this.el.emit("controllermodelready",{name:"oculus-touch-controls",model:this.data.model,rayOrigin:RAY_ORIGIN[this.data.hand]})},onAxisMoved:function onAxisMoved(evt){this.emitIfAxesChanged(this,this.mapping[this.data.hand].axes,evt)},updateModel:function updateModel(buttonName,evtName){if(!this.data.model){return}this.updateButtonModel(buttonName,evtName)},updateButtonModel:function updateButtonModel(buttonName,state){var color="up"===state||"touchend"===state?this.data.buttonColor:"touchstart"===state?this.data.buttonTouchColor:this.data.buttonHighlightColor,buttonMeshes=this.buttonMeshes;if(!this.data.model){return}if(buttonMeshes&&buttonMeshes[buttonName]){buttonMeshes[buttonName].material.color.set(color)}}})},{"../core/component":102,"../lib/three":150,"../utils/bind":166,"../utils/tracked-controls":178}],69:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent;module.exports.Component=registerComponent("position",{schema:{type:"vec3"},update:function update(){var object3D=this.el.object3D,data=this.data;object3D.position.set(data.x,data.y,data.z)},remove:function remove(){this.el.object3D.position.set(0,0,0)}})},{"../core/component":102}],70:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,THREE=_dereq_("../lib/three"),utils=_dereq_("../utils/"),warn=utils.debug("components:raycaster:warn"),OBSERVER_SELECTOR_RE=/^[\w\s-.,[\]#]*$/,OBSERVER_CONFIG={childList:!0,attributes:!0,subtree:!0};module.exports.Component=registerComponent("raycaster",{schema:{autoRefresh:{default:!0},direction:{type:"vec3",default:{x:0,y:0,z:-1}},enabled:{default:!0},far:{default:1e3},interval:{default:0},near:{default:0},objects:{default:""},origin:{type:"vec3"},recursive:{default:!0},showLine:{default:!1},useWorldCoordinates:{default:!1}},init:function init(){this.clearedIntersectedEls=[];this.unitLineEndVec3=new THREE.Vector3;this.intersectedEls=[];this.intersections=[];this.newIntersectedEls=[];this.newIntersections=[];this.objects=[];this.prevCheckTime=void 0;this.prevIntersectedEls=[];this.rawIntersections=[];this.raycaster=new THREE.Raycaster;this.updateOriginDirection();this.setDirty=this.setDirty.bind(this);this.observer=new MutationObserver(this.setDirty);this.dirty=!0;this.lineEndVec3=new THREE.Vector3;this.otherLineEndVec3=new THREE.Vector3;this.lineData={end:this.lineEndVec3};this.intersectedClearedDetail={el:this.el};this.intersectionClearedDetail={clearedEls:this.clearedIntersectedEls};this.intersectionDetail={}},update:function update(oldData){var data=this.data,el=this.el,raycaster=this.raycaster;raycaster.far=data.far;raycaster.near=data.near;if(data.showLine&&(data.far!==oldData.far||data.origin!==oldData.origin||data.direction!==oldData.direction||!oldData.showLine)){this.unitLineEndVec3.copy(data.origin).add(data.direction).normalize();this.drawLine()}if(!data.showLine&&oldData.showLine){el.removeAttribute("line")}if(data.objects!==oldData.objects&&!OBSERVER_SELECTOR_RE.test(data.objects)){warn("Selector \""+data.objects+"\" may not update automatically with DOM changes.")}if(data.autoRefresh!==oldData.autoRefresh&&el.isPlaying){data.autoRefresh?this.addEventListeners():this.removeEventListeners()}this.setDirty()},play:function play(){this.addEventListeners()},pause:function pause(){this.removeEventListeners()},remove:function remove(){if(this.data.showLine){this.el.removeAttribute("line")}},addEventListeners:function addEventListeners(){if(!this.data.autoRefresh){return}this.observer.observe(this.el.sceneEl,OBSERVER_CONFIG);this.el.sceneEl.addEventListener("object3dset",this.setDirty);this.el.sceneEl.addEventListener("object3dremove",this.setDirty)},removeEventListeners:function removeEventListeners(){this.observer.disconnect();this.el.sceneEl.removeEventListener("object3dset",this.setDirty);this.el.sceneEl.removeEventListener("object3dremove",this.setDirty)},setDirty:function setDirty(){this.dirty=!0},refreshObjects:function refreshObjects(){var data=this.data,els;els=data.objects?this.el.sceneEl.querySelectorAll(data.objects):this.el.sceneEl.children;this.objects=this.flattenChildrenShallow(els);this.dirty=!1},tick:function tick(time){var data=this.data,prevCheckTime=this.prevCheckTime;if(prevCheckTime&&time-prevCheckTime<data.interval){return}this.prevCheckTime=time;this.checkIntersections()},checkIntersections:function checkIntersections(){var clearedIntersectedEls=this.clearedIntersectedEls,el=this.el,data=this.data,i,intersectedEls=this.intersectedEls,intersection,intersections=this.intersections,lineLength,newIntersectedEls=this.newIntersectedEls,newIntersections=this.newIntersections,prevIntersectedEls=this.prevIntersectedEls,rawIntersections=this.rawIntersections,self=this;if(!this.data.enabled){return}if(this.dirty){this.refreshObjects()}copyArray(this.prevIntersectedEls,this.intersectedEls);this.updateOriginDirection();rawIntersections.length=0;this.raycaster.intersectObjects(this.objects,data.recursive,rawIntersections);intersections.length=0;intersectedEls.length=0;for(i=0;i<rawIntersections.length;i++){intersection=rawIntersections[i];if(data.showLine&&intersection.object===el.getObject3D("line")){continue}if(intersection.object.el){intersections.push(intersection);intersectedEls.push(intersection.object.el)}}newIntersections.length=0;newIntersectedEls.length=0;for(i=0;i<intersections.length;i++){if(-1===prevIntersectedEls.indexOf(intersections[i].object.el)){newIntersections.push(intersections[i]);newIntersectedEls.push(intersections[i].object.el)}}clearedIntersectedEls.length=0;for(i=0;i<prevIntersectedEls.length;i++){if(-1!==intersectedEls.indexOf(prevIntersectedEls[i])){continue}prevIntersectedEls[i].emit("raycaster-intersected-cleared",this.intersectedClearedDetail);clearedIntersectedEls.push(prevIntersectedEls[i])}if(clearedIntersectedEls.length){el.emit("raycaster-intersection-cleared",this.intersectionClearedDetail)}for(i=0;i<newIntersectedEls.length;i++){newIntersectedEls[i].emit("raycaster-intersected",{el:el,intersection:newIntersections[i]})}if(newIntersections.length){this.intersectionDetail.els=newIntersectedEls;this.intersectionDetail.intersections=newIntersections;el.emit("raycaster-intersection",this.intersectionDetail)}setTimeout(function(){if(self.data.showLine){if(intersections.length){if(intersections[0].object.el===el&&intersections[1]){lineLength=intersections[1].distance}else{lineLength=intersections[0].distance}}self.drawLine(lineLength)}})},getIntersection:function getIntersection(el){var i,intersection;for(i=0;i<this.intersections.length;i++){intersection=this.intersections[i];if(intersection.object.el===el){return intersection}}return null},updateOriginDirection:function(){var direction=new THREE.Vector3,originVec3=new THREE.Vector3;return function(){var el=this.el,data=this.data;if(data.useWorldCoordinates){this.raycaster.set(data.origin,data.direction);return}el.object3D.updateMatrixWorld();el.object3D.getWorldPosition(originVec3);if(0!==data.origin.x||0!==data.origin.y||0!==data.origin.z){originVec3=el.object3D.localToWorld(originVec3.copy(data.origin))}direction.copy(data.direction).transformDirection(el.object3D.matrixWorld).normalize();this.raycaster.set(originVec3,direction)}}(),drawLine:function drawLine(length){var data=this.data,el=this.el,endVec3;endVec3=this.lineData.end===this.lineEndVec3?this.otherLineEndVec3:this.lineEndVec3;if(length===void 0){length=data.far===1/0?1e3:data.far}this.lineData.start=data.origin;this.lineData.end=endVec3.copy(this.unitLineEndVec3).multiplyScalar(length);el.setAttribute("line",this.lineData)},flattenChildrenShallow:function(){var groups=[];return function(els){var children,i,objects=this.objects;groups.length=0;for(i=0;i<els.length;i++){if(els[i].object3D){groups.push(els[i].object3D)}}objects.length=0;for(i=0;i<groups.length;i++){children=groups[i].children;if(children&&children.length){objects.push.apply(objects,children)}}return objects}}()});function copyArray(a,b){var i;a.length=b.length;for(i=0;i<b.length;i++){a[i]=b[i]}}},{"../core/component":102,"../lib/three":150,"../utils/":172}],71:[function(_dereq_,module){var degToRad=_dereq_("../lib/three").Math.degToRad,registerComponent=_dereq_("../core/component").registerComponent;module.exports.Component=registerComponent("rotation",{schema:{type:"vec3"},update:function update(){var data=this.data,object3D=this.el.object3D;object3D.rotation.set(degToRad(data.x),degToRad(data.y),degToRad(data.z));object3D.rotation.order="YXZ"},remove:function remove(){this.el.object3D.rotation.set(0,0,0)}})},{"../core/component":102,"../lib/three":150}],72:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,zeroScale=1e-5;module.exports.Component=registerComponent("scale",{schema:{type:"vec3",default:{x:1,y:1,z:1}},update:function update(){var data=this.data,object3D=this.el.object3D,x=0===data.x?zeroScale:data.x,y=0===data.y?zeroScale:data.y,z=0===data.z?zeroScale:data.z;object3D.scale.set(x,y,z)},remove:function remove(){this.el.object3D.scale.set(1,1,1)}})},{"../core/component":102}],73:[function(_dereq_,module){var register=_dereq_("../../core/component").registerComponent;module.exports.Component=register("background",{schema:{color:{type:"color",default:"black"},transparent:{default:!1}},update:function update(){var data=this.data,object3D=this.el.object3D;if(data.transparent){object3D.background=null;return}object3D.background=new THREE.Color(data.color)}})},{"../../core/component":102}],74:[function(_dereq_,module){var register=_dereq_("../../core/component").registerComponent;module.exports.Component=register("debug",{schema:{default:!0}})},{"../../core/component":102}],75:[function(_dereq_,module){var registerComponent=_dereq_("../../core/component").registerComponent;module.exports.Component=registerComponent("embedded",{dependencies:["vr-mode-ui"],schema:{default:!0},update:function update(){var sceneEl=this.el,enterVREl=sceneEl.querySelector(".a-enter-vr");if(!0===this.data){if(enterVREl){enterVREl.classList.add("embedded")}sceneEl.removeFullScreenStyles()}else{if(enterVREl){enterVREl.classList.remove("embedded")}sceneEl.addFullScreenStyles()}}})},{"../../core/component":102}],76:[function(_dereq_,module){var register=_dereq_("../../core/component").registerComponent,THREE=_dereq_("../../lib/three"),debug=_dereq_("../../utils/debug"),warn=debug("components:fog:warn");module.exports.Component=register("fog",{schema:{color:{type:"color",default:"#000"},density:{default:25e-5},far:{default:1e3,min:0},near:{default:1,min:0},type:{default:"linear",oneOf:["linear","exponential"]}},update:function update(){var data=this.data,el=this.el,fog=this.el.object3D.fog;if(!el.isScene){warn("Fog component can only be applied to <a-scene>");return}if(!fog||data.type!==fog.name){el.object3D.fog=getFog(data);el.systems.material.updateMaterials();return}Object.keys(this.schema).forEach(function(key){var value=data[key];if("color"===key){value=new THREE.Color(value)}fog[key]=value})},remove:function remove(){var fog=this.el.object3D.fog;if(!fog){return}fog.far=0;fog.near=.1}});function getFog(data){var fog;if("exponential"===data.type){fog=new THREE.FogExp2(data.color,data.density)}else{fog=new THREE.Fog(data.color,data.near,data.far)}fog.name=data.type;return fog}},{"../../core/component":102,"../../lib/three":150,"../../utils/debug":168}],77:[function(_dereq_,module){(function(process){var AFRAME_INJECTED=_dereq_("../../constants").AFRAME_INJECTED,bind=_dereq_("../../utils/bind"),pkg=_dereq_("../../../package"),registerComponent=_dereq_("../../core/component").registerComponent;var INSPECTOR_RELEASE_URL="https://unpkg.com/aframe-inspector@"+function(version){var split=version.split(".");split[2]="x";return split.join(".")}(pkg.version)+"/dist/aframe-inspector.min.js",INSPECTOR_URL="dev"===process.env.INSPECTOR_VERSION?"https://aframe.io/aframe-inspector/dist/aframe-inspector.js":INSPECTOR_RELEASE_URL;module.exports.Component=registerComponent("inspector",{schema:{url:{default:INSPECTOR_URL}},init:function init(){this.onKeydown=bind(this.onKeydown,this);this.onMessage=bind(this.onMessage,this);this.initOverlay();window.addEventListener("keydown",this.onKeydown);window.addEventListener("message",this.onMessage)},initOverlay:function initOverlay(){this.loadingMessageEl=document.createElement("div");this.loadingMessageEl.classList.add("a-inspector-loader");this.loadingMessageEl.innerHTML="Loading Inspector"+"<span class=\"dots\"><span>.</span><span>.</span><span>.</span></span>"},remove:function remove(){this.removeEventListeners()},onKeydown:function onKeydown(evt){var shortcutPressed=73===evt.keyCode&&evt.ctrlKey&&evt.altKey;if(!this.data||!shortcutPressed){return}this.injectInspector()},showLoader:function showLoader(){document.body.appendChild(this.loadingMessageEl)},hideLoader:function hideLoader(){document.body.removeChild(this.loadingMessageEl)},onMessage:function onMessage(evt){if("INJECT_AFRAME_INSPECTOR"===evt.data){this.injectInspector()}},injectInspector:function injectInspector(){var self=this,script;if(AFRAME.INSPECTOR||AFRAME.inspectorInjected){return}this.showLoader();script=document.createElement("script");script.src=this.data.url;script.setAttribute("data-name","aframe-inspector");script.setAttribute(AFRAME_INJECTED,"");script.onload=function(){AFRAME.INSPECTOR.open();self.hideLoader();self.removeEventListeners()};script.onerror=function(){self.loadingMessageEl.innerHTML="Error loading Inspector"};document.head.appendChild(script);AFRAME.inspectorInjected=!0},removeEventListeners:function removeEventListeners(){window.removeEventListener("keydown",this.onKeydown);window.removeEventListener("message",this.onMessage)}})}).call(this,_dereq_("_process"))},{"../../../package":51,"../../constants":93,"../../core/component":102,"../../utils/bind":166,_process:32}],78:[function(_dereq_,module){var registerComponent=_dereq_("../../core/component").registerComponent,shouldCaptureKeyEvent=_dereq_("../../utils/").shouldCaptureKeyEvent;module.exports.Component=registerComponent("keyboard-shortcuts",{schema:{enterVR:{default:!0},exitVR:{default:!0}},init:function init(){this.onKeyup=this.onKeyup.bind(this)},update:function update(){var data=this.data;this.enterVREnabled=data.enterVR},play:function play(){window.addEventListener("keyup",this.onKeyup,!1)},pause:function pause(){window.removeEventListener("keyup",this.onKeyup)},onKeyup:function onKeyup(evt){var scene=this.el;if(!shouldCaptureKeyEvent(evt)){return}if(this.enterVREnabled&&70===evt.keyCode){scene.enterVR()}if(this.enterVREnabled&&27===evt.keyCode){scene.exitVR()}}})},{"../../core/component":102,"../../utils/":172}],79:[function(_dereq_,module){var debug=_dereq_("../../utils/debug"),registerComponent=_dereq_("../../core/component").registerComponent,warn=debug("components:pool:warn");module.exports.Component=registerComponent("pool",{schema:{container:{default:""},mixin:{default:""},size:{default:0},dynamic:{default:!1}},multiple:!0,initPool:function initPool(){var i;this.availableEls=[];this.usedEls=[];if(!this.data.mixin){warn("No mixin provided for pool component.")}if(this.data.container){this.container=document.querySelector(this.data.container);if(!this.container){warn("Container "+this.data.container+" not found.")}}this.container=this.container||this.el;for(i=0;i<this.data.size;++i){this.createEntity()}},update:function update(oldData){var data=this.data;if(oldData.mixin!==data.mixin||oldData.size!==data.size){this.initPool()}},createEntity:function createEntity(){var el=document.createElement("a-entity");el.play=this.wrapPlay(el.play);el.setAttribute("mixin",this.data.mixin);el.object3D.visible=!1;el.pause();this.container.appendChild(el);this.availableEls.push(el)},wrapPlay:function wrapPlay(playMethod){var usedEls=this.usedEls;return function(){if(-1===usedEls.indexOf(this)){return}playMethod.call(this)}},requestEntity:function requestEntity(){var el;if(0===this.availableEls.length){if(!1===this.data.dynamic){warn("Requested entity from empty pool: "+this.name);return}else{warn("Requested entity from empty pool. This pool is dynamic and will resize "+"automatically. You might want to increase its initial size: "+this.name)}this.createEntity()}el=this.availableEls.shift();this.usedEls.push(el);el.object3D.visible=!0;return el},returnEntity:function returnEntity(el){var index=this.usedEls.indexOf(el);if(-1===index){warn("The returned entity was not previously pooled from "+this.name);return}this.usedEls.splice(index,1);this.availableEls.push(el);el.object3D.visible=!1;el.pause();return el}})},{"../../core/component":102,"../../utils/debug":168}],80:[function(_dereq_,module){var register=_dereq_("../../core/component").registerComponent,debug=_dereq_("../../utils/debug"),warn=debug("components:renderer:warn");module.exports.Component=register("renderer",{schema:{antialias:{default:"auto",oneOf:["true","false","auto"]},gammaOutput:{default:!1},physicallyCorrectLights:{default:!1},sortObjects:{default:!1}},init:function init(){var el=this.el;if(!el.isScene){warn("Renderer component can only be applied to <a-scene>")}},update:function update(prevData){var data=this.data,sceneEl=this.el,renderer=sceneEl.renderer,needsShaderUpdate=!1;if(0<sceneEl.time&&data.antialias!==prevData.antialias){warn("Property \"antialias\" cannot be changed after scene initialization")}if(data.sortObjects!==prevData.sortObjects){renderer.sortObjects=data.sortObjects}if(data.gammaOutput!==prevData.gammaOutput){renderer.gammaOutput=data.gammaOutput;needsShaderUpdate=!0}if(data.physicallyCorrectLights!==prevData.physicallyCorrectLights){renderer.physicallyCorrectLights=data.physicallyCorrectLights;needsShaderUpdate=!0}if(!needsShaderUpdate||0===sceneEl.time){return}warn("Modifying renderer properties at runtime requires shader update and may drop frames.");sceneEl.object3D.traverse(function(node){if(!node.isMesh){return}if(Array.isArray(node.material)){node.material.forEach(function(material){material.needsUpdate=!0})}else{node.material.needsUpdate=!0}})}})},{"../../core/component":102,"../../utils/debug":168}],81:[function(_dereq_,module){var registerComponent=_dereq_("../../core/component").registerComponent,THREE=_dereq_("../../lib/three"),VERTEX_SHADER=["attribute vec3 position;","attribute vec2 uv;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUv;","void main()  {","  vUv = vec2( 1.- uv.x, uv.y );","  gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),FRAGMENT_SHADER=["precision mediump float;","uniform samplerCube map;","varying vec2 vUv;","#define M_PI 3.141592653589793238462643383279","void main() {","  vec2 uv = vUv;","  float longitude = uv.x * 2. * M_PI - M_PI + M_PI / 2.;","  float latitude = uv.y * M_PI;","  vec3 dir = vec3(","    - sin( longitude ) * sin( latitude ),","    cos( latitude ),","    - cos( longitude ) * sin( latitude )","  );","  normalize( dir );","  gl_FragColor = vec4( textureCube( map, dir ).rgb, 1.0 );","}"].join("\n");module.exports.Component=registerComponent("screenshot",{schema:{width:{default:4096},height:{default:2048},camera:{type:"selector"}},init:function init(){var el=this.el,self=this;if(el.renderer){setup()}else{el.addEventListener("render-target-loaded",setup)}function setup(){var gl=el.renderer.getContext();if(!gl){return}self.cubeMapSize=gl.getParameter(gl.MAX_CUBE_MAP_TEXTURE_SIZE);self.material=new THREE.RawShaderMaterial({uniforms:{map:{type:"t",value:null}},vertexShader:VERTEX_SHADER,fragmentShader:FRAGMENT_SHADER,side:THREE.DoubleSide});self.quad=new THREE.Mesh(new THREE.PlaneBufferGeometry(1,1),self.material);self.quad.visible=!1;self.camera=new THREE.OrthographicCamera(-1/2,1/2,1/2,-1/2,-1e4,1e4);self.canvas=document.createElement("canvas");self.ctx=self.canvas.getContext("2d");if(el.camera){el.camera.add(self.quad)}self.onKeyDown=self.onKeyDown.bind(self);self.onCameraActive=self.onCameraActive.bind(self);el.addEventListener("camera-set-active",self.onCameraActive)}},getRenderTarget:function getRenderTarget(width,height){return new THREE.WebGLRenderTarget(width,height,{minFilter:THREE.LinearFilter,magFilter:THREE.LinearFilter,wrapS:THREE.ClampToEdgeWrapping,wrapT:THREE.ClampToEdgeWrapping,format:THREE.RGBAFormat,type:THREE.UnsignedByteType})},resize:function resize(width,height){this.quad.scale.set(width,height,1);this.camera.left=-1*width/2;this.camera.right=width/2;this.camera.top=height/2;this.camera.bottom=-1*height/2;this.camera.updateProjectionMatrix();this.canvas.width=width;this.canvas.height=height},play:function play(){window.addEventListener("keydown",this.onKeyDown)},onCameraActive:function onCameraActive(evt){var cameraParent=this.quad.parent;if(cameraParent){cameraParent.remove(this.quad)}evt.detail.cameraEl.getObject3D("camera").add(this.quad)},onKeyDown:function onKeyDown(evt){var shortcutPressed=83===evt.keyCode&&evt.ctrlKey&&evt.altKey;if(!this.data||!shortcutPressed){return}var projection=evt.shiftKey?"equirectangular":"perspective";this.capture(projection)},setCapture:function setCapture(projection){var el=this.el,size,camera,cubeCamera;if("perspective"===projection){this.quad.visible=!1;camera=this.data.camera&&this.data.camera.components.camera.camera||el.camera;size={width:this.data.width,height:this.data.height}}else{camera=this.camera;camera.position.copy(el.camera.getWorldPosition());camera.rotation.copy(el.camera.getWorldRotation());cubeCamera=new THREE.CubeCamera(el.camera.near,el.camera.far,_Mathmin(this.cubeMapSize,2048));cubeCamera.position.copy(el.camera.getWorldPosition());cubeCamera.rotation.copy(el.camera.getWorldRotation());cubeCamera.updateCubeMap(el.renderer,el.object3D);this.quad.material.uniforms.map.value=cubeCamera.renderTarget.texture;size={width:this.data.width,height:this.data.height};this.quad.visible=!0}return{camera:camera,size:size,projection:projection}},capture:function capture(projection){var params=this.setCapture(projection);this.renderCapture(params.camera,params.size,params.projection);this.saveCapture()},getCanvas:function getCanvas(projection){var params=this.setCapture(projection);this.renderCapture(params.camera,params.size,params.projection);return this.canvas},renderCapture:function renderCapture(camera,size,projection){var autoClear=this.el.renderer.autoClear,el=this.el,imageData,output,pixels,renderer=this.el.renderer;output=this.getRenderTarget(size.width,size.height);pixels=new Uint8Array(4*size.width*size.height);this.resize(size.width,size.height);renderer.autoClear=!0;renderer.render(el.object3D,camera,output,!0);renderer.autoClear=autoClear;renderer.readRenderTargetPixels(output,0,0,size.width,size.height,pixels);if("perspective"===projection){pixels=this.flipPixelsVertically(pixels,size.width,size.height)}imageData=new ImageData(new Uint8ClampedArray(pixels),size.width,size.height);this.quad.visible=!1;this.ctx.putImageData(imageData,0,0)},flipPixelsVertically:function flipPixelsVertically(pixels,width,height){for(var flippedPixels=pixels.slice(0),x=0;x<width;++x){for(var y=0;y<height;++y){flippedPixels[4*x+4*(y*width)]=pixels[4*x+4*((height-y)*width)];flippedPixels[4*x+1+4*(y*width)]=pixels[4*x+1+4*((height-y)*width)];flippedPixels[4*x+2+4*(y*width)]=pixels[4*x+2+4*((height-y)*width)];flippedPixels[4*x+3+4*(y*width)]=pixels[4*x+3+4*((height-y)*width)]}}return flippedPixels},saveCapture:function saveCapture(){this.canvas.toBlob(function(blob){var fileName="screenshot-"+document.title.toLowerCase()+"-"+Date.now()+".png",linkEl=document.createElement("a"),url=URL.createObjectURL(blob);linkEl.href=url;linkEl.setAttribute("download",fileName);linkEl.innerHTML="downloading...";linkEl.style.display="none";document.body.appendChild(linkEl);setTimeout(function(){linkEl.click();document.body.removeChild(linkEl)},1)},"image/png")}})},{"../../core/component":102,"../../lib/three":150}],82:[function(_dereq_,module){var registerComponent=_dereq_("../../core/component").registerComponent,RStats=_dereq_("../../../vendor/rStats"),utils=_dereq_("../../utils");_dereq_("../../../vendor/rStats.extras");_dereq_("../../lib/rStatsAframe");var AFrameStats=window.aframeStats,bind=utils.bind,HIDDEN_CLASS="a-hidden",ThreeStats=window.threeStats;module.exports.Component=registerComponent("stats",{schema:{default:!0},init:function init(){var scene=this.el;if("false"===utils.getUrlParameter("stats")){return}this.stats=createStats(scene);this.statsEl=document.querySelector(".rs-base");this.hideBound=bind(this.hide,this);this.showBound=bind(this.show,this);scene.addEventListener("enter-vr",this.hideBound);scene.addEventListener("exit-vr",this.showBound)},update:function update(){if(!this.stats){return}return!this.data?this.hide():this.show()},remove:function remove(){this.el.removeEventListener("enter-vr",this.hideBound);this.el.removeEventListener("exit-vr",this.showBound);if(!this.statsEl){return}this.statsEl.parentNode.removeChild(this.statsEl)},tick:function tick(){var stats=this.stats;if(!stats){return}stats("rAF").tick();stats("FPS").frame();stats().update()},hide:function hide(){this.statsEl.classList.add(HIDDEN_CLASS)},show:function show(){this.statsEl.classList.remove(HIDDEN_CLASS)}});function createStats(scene){var threeStats=new ThreeStats(scene.renderer),aframeStats=new AFrameStats(scene),plugins=scene.isMobile?[]:[threeStats,aframeStats];return new RStats({css:[],values:{fps:{caption:"fps",below:30}},groups:[{caption:"Framerate",values:["fps","raf"]}],plugins:plugins})}},{"../../../vendor/rStats":180,"../../../vendor/rStats.extras":179,"../../core/component":102,"../../lib/rStatsAframe":149,"../../utils":172}],83:[function(_dereq_,module){var registerComponent=_dereq_("../../core/component").registerComponent,constants=_dereq_("../../constants/"),utils=_dereq_("../../utils/"),bind=utils.bind,HIDDEN_CLASS="a-hidden";module.exports.Component=registerComponent("vr-mode-ui",{dependencies:["canvas"],schema:{enabled:{default:!0}},init:function init(){var self=this,sceneEl=this.el;if("false"===utils.getUrlParameter("ui")){return}this.insideLoader=!1;this.enterVREl=null;this.orientationModalEl=null;this.bindMethods();sceneEl.addEventListener("enter-vr",this.updateEnterVRInterface);sceneEl.addEventListener("exit-vr",this.updateEnterVRInterface);window.addEventListener("message",function(event){if("loaderReady"===event.data.type){self.insideLoader=!0;self.remove()}});window.addEventListener("orientationchange",this.toggleOrientationModalIfNeeded)},bindMethods:function bindMethods(){this.onEnterVRButtonClick=bind(this.onEnterVRButtonClick,this);this.onModalClick=bind(this.onModalClick,this);this.toggleOrientationModalIfNeeded=bind(this.toggleOrientationModalIfNeeded,this);this.updateEnterVRInterface=bind(this.updateEnterVRInterface,this)},onModalClick:function onModalClick(){this.el.exitVR()},onEnterVRButtonClick:function onEnterVRButtonClick(){this.el.enterVR()},update:function update(){var sceneEl=this.el;if(!this.data.enabled||this.insideLoader||"false"===utils.getUrlParameter("ui")){return this.remove()}if(this.enterVREl||this.orientationModalEl){return}this.enterVREl=createEnterVRButton(this.onEnterVRButtonClick);sceneEl.appendChild(this.enterVREl);this.orientationModalEl=createOrientationModal(this.onModalClick);sceneEl.appendChild(this.orientationModalEl);this.updateEnterVRInterface()},remove:function remove(){[this.enterVREl,this.orientationModalEl].forEach(function(uiElement){if(uiElement&&uiElement.parentNode){uiElement.parentNode.removeChild(uiElement)}})},updateEnterVRInterface:function updateEnterVRInterface(){this.toggleEnterVRButtonIfNeeded();this.toggleOrientationModalIfNeeded()},toggleEnterVRButtonIfNeeded:function toggleEnterVRButtonIfNeeded(){var sceneEl=this.el;if(!this.enterVREl){return}if(sceneEl.is("vr-mode")){this.enterVREl.classList.add(HIDDEN_CLASS)}else{this.enterVREl.classList.remove(HIDDEN_CLASS)}},toggleOrientationModalIfNeeded:function toggleOrientationModalIfNeeded(){var sceneEl=this.el,orientationModalEl=this.orientationModalEl;if(!orientationModalEl||!sceneEl.isMobile){return}if(!utils.device.isLandscape()&&sceneEl.is("vr-mode")){orientationModalEl.classList.remove(HIDDEN_CLASS)}else{orientationModalEl.classList.add(HIDDEN_CLASS)}}});function createEnterVRButton(onClick){var vrButton,wrapper;wrapper=document.createElement("div");wrapper.classList.add("a-enter-vr");wrapper.setAttribute(constants.AFRAME_INJECTED,"");vrButton=document.createElement("button");vrButton.className="a-enter-vr-button";vrButton.setAttribute("title","Enter VR mode with a headset or fullscreen mode on a desktop. Visit https://webvr.rocks or https://webvr.info for more information.");vrButton.setAttribute(constants.AFRAME_INJECTED,"");wrapper.appendChild(vrButton);vrButton.addEventListener("click",function(evt){onClick();evt.stopPropagation()});return wrapper}function createOrientationModal(onClick){var modal=document.createElement("div");modal.className="a-orientation-modal";modal.classList.add(HIDDEN_CLASS);modal.setAttribute(constants.AFRAME_INJECTED,"");var exit=document.createElement("button");exit.setAttribute(constants.AFRAME_INJECTED,"");exit.innerHTML="Exit VR";exit.addEventListener("click",onClick);modal.appendChild(exit);return modal}},{"../../constants/":93,"../../core/component":102,"../../utils/":172}],84:[function(_dereq_,module){var component=_dereq_("../core/component"),THREE=_dereq_("../lib/three"),bind=_dereq_("../utils/bind"),registerComponent=component.registerComponent;module.exports.Component=registerComponent("shadow",{schema:{cast:{default:!0},receive:{default:!0}},init:function init(){this.onMeshChanged=bind(this.update,this);this.el.addEventListener("object3dset",this.onMeshChanged);this.system.setShadowMapEnabled(!0)},update:function update(){var data=this.data;this.updateDescendants(data.cast,data.receive)},remove:function remove(){var el=this.el;el.removeEventListener("object3dset",this.onMeshChanged);this.updateDescendants(!1,!1)},updateDescendants:function updateDescendants(cast,receive){var sceneEl=this.el.sceneEl;this.el.object3D.traverse(function(node){if(!babelHelpers.instanceof(node,THREE.Mesh)){return}node.castShadow=cast;node.receiveShadow=receive;if(sceneEl.hasLoaded&&node.material){for(var materials=Array.isArray(node.material)?node.material:[node.material],i=0;i<materials.length;i++){materials[i].needsUpdate=!0}}})}})},{"../core/component":102,"../lib/three":150,"../utils/bind":166}],85:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,debug=_dereq_("../utils/debug"),bind=_dereq_("../utils/bind"),THREE=_dereq_("../lib/three"),warn=debug("components:sound:warn");module.exports.Component=registerComponent("sound",{schema:{autoplay:{default:!1},distanceModel:{default:"inverse",oneOf:["linear","inverse","exponential"]},loop:{default:!1},maxDistance:{default:1e4},on:{default:""},poolSize:{default:1},positional:{default:!0},refDistance:{default:1},rolloffFactor:{default:1},src:{type:"audio"},volume:{default:1}},multiple:!0,init:function init(){this.listener=null;this.audioLoader=new THREE.AudioLoader;this.pool=new THREE.Group;this.loaded=!1;this.mustPlay=!1;this.playSound=bind(this.playSound,this)},update:function update(oldData){var data=this.data,srcChanged=data.src!==oldData.src;if(srcChanged){if(!data.src){warn("Audio source was not specified with `src`");return}this.setupSound()}this.pool.children.forEach(function(sound){if(data.positional){sound.setDistanceModel(data.distanceModel);sound.setMaxDistance(data.maxDistance);sound.setRefDistance(data.refDistance);sound.setRolloffFactor(data.rolloffFactor)}sound.setLoop(data.loop);sound.setVolume(data.volume);sound.isPaused=!1});if(data.on!==oldData.on){this.updateEventListener(oldData.on)}if(srcChanged){var self=this;this.loaded=!1;this.audioLoader.load(data.src,function(buffer){self.pool.children.forEach(function(sound){sound.setBuffer(buffer)});self.loaded=!0;THREE.Cache.remove(data.src);if(self.data.autoplay||self.mustPlay){self.playSound()}self.el.emit("sound-loaded",self.evtDetail)})}},pause:function pause(){this.stopSound();this.removeEventListener()},play:function play(){if(this.data.autoplay){this.playSound()}this.updateEventListener()},remove:function remove(){this.removeEventListener();this.el.removeObject3D(this.attrName);try{this.pool.children.forEach(function(sound){sound.disconnect()})}catch(e){warn("Audio source not properly disconnected")}},updateEventListener:function updateEventListener(oldEvt){var el=this.el;if(oldEvt){el.removeEventListener(oldEvt,this.playSound)}el.addEventListener(this.data.on,this.playSound)},removeEventListener:function removeEventListener(){this.el.removeEventListener(this.data.on,this.playSound)},setupSound:function setupSound(){var self=this,el=this.el,sceneEl=el.sceneEl;if(0<this.pool.children.length){this.stopSound();el.removeObject3D("sound")}var listener=this.listener=sceneEl.audioListener||new THREE.AudioListener;sceneEl.audioListener=listener;if(sceneEl.camera){sceneEl.camera.add(listener)}sceneEl.addEventListener("camera-set-active",function(evt){evt.detail.cameraEl.getObject3D("camera").add(listener)});this.pool=new THREE.Group;for(var i=0,sound;i<this.data.poolSize;i++){sound=this.data.positional?new THREE.PositionalAudio(listener):new THREE.Audio(listener);this.pool.add(sound)}el.setObject3D(this.attrName,this.pool);this.pool.children.forEach(function(sound){sound.onEnded=function(){sound.isPlaying=!1;el.emit("sound-ended",self.evtDetail)}})},pauseSound:function pauseSound(){this.isPlaying=!1;this.pool.children.forEach(function(sound){if(!sound.source||!sound.source.buffer||!sound.isPlaying||sound.isPaused){return}sound.isPaused=!0;sound.pause()})},playSound:function playSound(){if(!this.loaded){warn("Sound not loaded yet. It will be played once it finished loading");this.mustPlay=!0;return}var found=!1;this.isPlaying=!0;this.pool.children.forEach(function(sound){if(!sound.isPlaying&&sound.buffer&&!found){sound.play();sound.isPaused=!1;found=!0}});if(!found){warn("All the sounds are playing. If you need to play more sounds simultaneously "+"consider increasing the size of pool with the `poolSize` attribute.",this.el);return}this.mustPlay=!1},stopSound:function stopSound(){this.isPlaying=!1;this.pool.children.forEach(function(sound){if(!sound.source||!sound.source.buffer){return}sound.stop()})}})},{"../core/component":102,"../lib/three":150,"../utils/bind":166,"../utils/debug":168}],86:[function(_dereq_,module){var createTextGeometry=_dereq_("three-bmfont-text"),loadBMFont=_dereq_("load-bmfont"),registerComponent=_dereq_("../core/component").registerComponent,coreShader=_dereq_("../core/shader"),THREE=_dereq_("../lib/three"),utils=_dereq_("../utils/"),error=utils.debug("components:text:error"),shaders=coreShader.shaders,warn=utils.debug("components:text:warn"),FONT_BASE_URL="https://cdn.aframe.io/fonts/",FONTS={aileronsemibold:FONT_BASE_URL+"Aileron-Semibold.fnt",dejavu:FONT_BASE_URL+"DejaVu-sdf.fnt",exo2bold:FONT_BASE_URL+"Exo2Bold.fnt",exo2semibold:FONT_BASE_URL+"Exo2SemiBold.fnt",kelsonsans:FONT_BASE_URL+"KelsonSans.fnt",monoid:FONT_BASE_URL+"Monoid.fnt",mozillavr:FONT_BASE_URL+"mozillavr.fnt",roboto:FONT_BASE_URL+"Roboto-msdf.json",sourcecodepro:FONT_BASE_URL+"SourceCodePro.fnt"},MSDF_FONTS=["roboto"],DEFAULT_FONT="roboto";module.exports.FONTS=FONTS;var cache=new function(){var cache=this.cache={};this.get=function(key,promiseGenerator){if(key in cache){return cache[key]}cache[key]=promiseGenerator();return cache[key]}},fontWidthFactors={},textures={};module.exports.Component=registerComponent("text",{multiple:!0,schema:{align:{type:"string",default:"left",oneOf:["left","right","center"]},alphaTest:{default:.5},anchor:{default:"center",oneOf:["left","right","center","align"]},baseline:{default:"center",oneOf:["top","center","bottom"]},color:{type:"color",default:"#FFF"},font:{type:"string",default:DEFAULT_FONT},fontImage:{type:"string"},height:{type:"number"},letterSpacing:{type:"number",default:0},lineHeight:{type:"number"},negate:{type:"boolean",default:!0},opacity:{type:"number",default:1},shader:{default:"sdf",oneOf:shaders},side:{default:"front",oneOf:["front","back","double"]},tabSize:{default:4},transparent:{default:!0},value:{type:"string"},whiteSpace:{default:"normal",oneOf:["normal","pre","nowrap"]},width:{type:"number"},wrapCount:{type:"number",default:40},wrapPixels:{type:"number"},xOffset:{type:"number",default:0},yOffset:{type:"number",default:0},zOffset:{type:"number",default:.001}},init:function init(){this.shaderData={};this.geometry=createTextGeometry();this.createOrUpdateMaterial();this.mesh=new THREE.Mesh(this.geometry,this.material);this.el.setObject3D(this.attrName,this.mesh)},update:function update(oldData){var data=coerceData(this.data),font=this.currentFont,fontImage=this.getFontImageSrc();if(textures[fontImage]){this.texture=textures[fontImage]}else{this.texture=textures[fontImage]=new THREE.Texture;this.texture.anisotropy=16}this.createOrUpdateMaterial();if(oldData.font!==data.font){this.updateFont();return}if(font){this.updateGeometry(this.geometry,data,font);this.updateLayout(data)}},remove:function remove(){this.geometry.dispose();this.geometry=null;this.el.removeObject3D(this.attrName);this.material.dispose();this.material=null;this.texture.dispose();this.texture=null;if(this.shaderObject){delete this.shaderObject}},createOrUpdateMaterial:function createOrUpdateMaterial(){var data=this.data,hasChangedShader,material=this.material,NewShader,shaderData=this.shaderData,shaderName;shaderName=data.shader;if(-1!==MSDF_FONTS.indexOf(data.font)||0<=data.font.indexOf("-msdf.")){shaderName="msdf"}else if(data.font in FONTS&&-1===MSDF_FONTS.indexOf(data.font)){shaderName="sdf"}hasChangedShader=(this.shaderObject&&this.shaderObject.name)!==shaderName;shaderData.alphaTest=data.alphaTest;shaderData.color=data.color;shaderData.map=this.texture;shaderData.opacity=data.opacity;shaderData.side=parseSide(data.side);shaderData.transparent=data.transparent;shaderData.negate=data.negate;if(!hasChangedShader){this.shaderObject.update(shaderData);material.transparent=shaderData.transparent;material.side=shaderData.side;return}NewShader=createShader(this.el,shaderName,shaderData);this.material=NewShader.material;this.shaderObject=NewShader.shader;this.material.side=shaderData.side;if(this.mesh){this.mesh.material=this.material}},updateFont:function updateFont(){var data=this.data,el=this.el,fontSrc,geometry=this.geometry,self=this;if(!data.font){warn("No font specified. Using the default font.")}this.mesh.visible=!1;fontSrc=this.lookupFont(data.font||DEFAULT_FONT)||data.font;cache.get(fontSrc,function(){return loadFont(fontSrc,data.yOffset)}).then(function(font){var coercedData,fontImgSrc;if(1!==font.pages.length){throw new Error("Currently only single-page bitmap fonts are supported.")}if(!fontWidthFactors[fontSrc]){font.widthFactor=fontWidthFactors[font]=computeFontWidthFactor(font)}coercedData=coerceData(data);self.updateGeometry(geometry,self.data,font);self.currentFont=font;self.updateLayout(coercedData);fontImgSrc=self.getFontImageSrc();cache.get(fontImgSrc,function(){return loadTexture(fontImgSrc)}).then(function(image){var texture=self.texture;texture.image=image;texture.needsUpdate=!0;textures[fontImgSrc]=texture;self.texture=texture;self.mesh.visible=!0;el.emit("textfontset",{font:data.font,fontObj:font})}).catch(function(err){error(err);throw err})}).catch(function(err){error(err);throw err})},getFontImageSrc:function getFontImageSrc(){var fontSrc=this.lookupFont(this.data.font||DEFAULT_FONT)||this.data.font;return this.data.fontImage||fontSrc.replace(/(\.fnt)|(\.json)/,".png")},updateLayout:function updateLayout(data){var anchor,baseline,el=this.el,geometry=this.geometry,geometryComponent=el.getAttribute("geometry"),height,layout=geometry.layout,mesh=this.mesh,textRenderWidth,textScale,width,x,y;geometryComponent=el.getAttribute("geometry");width=data.width||geometryComponent&&geometryComponent.width||1;textRenderWidth=computeWidth(data.wrapPixels,data.wrapCount,this.currentFont.widthFactor);textScale=width/textRenderWidth;height=textScale*(layout.height+layout.descender);if(geometryComponent){if(!geometryComponent.width){el.setAttribute("geometry","width",width)}if(!geometryComponent.height){el.setAttribute("geometry","height",height)}}anchor="align"===data.anchor?data.align:data.anchor;if("left"===anchor){x=0}else if("right"===anchor){x=-1*layout.width}else if("center"===anchor){x=-1*layout.width/2}else{throw new TypeError("Invalid text.anchor property value",anchor)}baseline=data.baseline;if("bottom"===baseline){y=0}else if("top"===baseline){y=-1*layout.height+layout.ascender}else if("center"===baseline){y=-1*layout.height/2}else{throw new TypeError("Invalid text.baseline property value",baseline)}mesh.position.x=x*textScale+data.xOffset;mesh.position.y=y*textScale;mesh.position.z=data.zOffset;mesh.scale.set(textScale,-1*textScale,textScale);this.geometry.computeBoundingSphere()},lookupFont:function lookupFont(key){return FONTS[key]},updateGeometry:function updateGeometry(geometry,data,font){geometry.update(utils.extend({},data,{font:font,width:computeWidth(data.wrapPixels,data.wrapCount,font.widthFactor),text:data.value.toString().replace(/\\n/g,"\n").replace(/\\t/g,"\t"),lineHeight:data.lineHeight||font.common.lineHeight}))}});function parseSide(side){switch(side){case"back":{return THREE.FrontSide}case"double":{return THREE.DoubleSide}default:{return THREE.BackSide}}}function coerceData(data){data=utils.clone(data);if(data.lineHeight!==void 0){data.lineHeight=parseFloat(data.lineHeight);if(!isFinite(data.lineHeight)){data.lineHeight=void 0}}if(data.width!==void 0){data.width=parseFloat(data.width);if(!isFinite(data.width)){data.width=void 0}}return data}function loadFont(src,yOffset){return new Promise(function(resolve,reject){loadBMFont(src,function(err,font){if(err){error("Error loading font",src);reject(err);return}if(0<=src.indexOf("/Roboto-msdf.json")){yOffset=30}if(yOffset){font.chars.map(function(ch){ch.yoffset+=yOffset})}resolve(font)})})}function loadTexture(src){return new Promise(function(resolve,reject){new THREE.ImageLoader().load(src,function(image){resolve(image)},void 0,function(){error("Error loading font image",src);reject(null)})})}function createShader(el,shaderName,data){var shader,shaderObject;shaderObject=new shaders[shaderName].Shader;shaderObject.el=el;shaderObject.init(data);shaderObject.update(data);shader=shaderObject.material;shader.transparent=data.transparent;return{material:shader,shader:shaderObject}}function computeWidth(wrapPixels,wrapCount,widthFactor){return wrapPixels||(.5+wrapCount)*widthFactor}function computeFontWidthFactor(font){var sum=0,digitsum=0,digits=0;font.chars.map(function(ch){sum+=ch.xadvance;if(48<=ch.id&&57>=ch.id){digits++;digitsum+=ch.xadvance}});return digits?digitsum/digits:sum/font.chars.length}},{"../core/component":102,"../core/shader":111,"../lib/three":150,"../utils/":172,"load-bmfont":23,"three-bmfont-text":36}],87:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,controllerUtils=_dereq_("../utils/tracked-controls"),DEFAULT_CAMERA_HEIGHT=_dereq_("../constants").DEFAULT_CAMERA_HEIGHT,THREE=_dereq_("../lib/three"),DEFAULT_HANDEDNESS=_dereq_("../constants").DEFAULT_HANDEDNESS,EYES_TO_ELBOW={x:.175,y:-.3,z:-.03},FOREARM={x:0,y:0,z:-.175};module.exports.Component=registerComponent("tracked-controls",{schema:{controller:{default:0},id:{type:"string",default:""},hand:{type:"string",default:""},idPrefix:{type:"string",default:""},orientationOffset:{type:"vec3"},armModel:{default:!0},headElement:{type:"selector"}},init:function init(){this.axis=[0,0,0];this.buttonStates={};this.changedAxes=[];this.targetControllerNumber=this.data.controller;this.axisMoveEventDetail={axis:this.axis,changed:this.changedAxes};this.deltaControllerPosition=new THREE.Vector3;this.controllerQuaternion=new THREE.Quaternion;this.controllerEuler=new THREE.Euler;this.updateGamepad();this.el.object3D.matrixAutoUpdate=!1},tick:function tick(time,delta){var mesh=this.el.getObject3D("mesh");if(mesh&&mesh.update){mesh.update(delta/1e3)}this.updateGamepad();this.updatePose();this.updateButtons()},defaultUserHeight:function defaultUserHeight(){return DEFAULT_CAMERA_HEIGHT},getHeadElement:function getHeadElement(){return this.data.headElement||this.el.sceneEl.camera.el},updateGamepad:function updateGamepad(){var data=this.data,controller=controllerUtils.findMatchingController(this.system.controllers,data.id,data.idPrefix,data.hand,data.controller);this.controller=controller},applyArmModel:function applyArmModel(controllerPosition){var controller=this.controller,controllerEuler=this.controllerEuler,controllerQuaternion=this.controllerQuaternion,deltaControllerPosition=this.deltaControllerPosition,hand,headEl,headObject3D,pose,userHeight;headEl=this.getHeadElement();headObject3D=headEl.object3D;userHeight=this.defaultUserHeight();pose=controller.pose;hand=(controller?controller.hand:void 0)||DEFAULT_HANDEDNESS;controllerPosition.copy(headObject3D.position);deltaControllerPosition.set(EYES_TO_ELBOW.x*("left"===hand?-1:"right"===hand?1:0),EYES_TO_ELBOW.y,EYES_TO_ELBOW.z);deltaControllerPosition.multiplyScalar(userHeight);deltaControllerPosition.applyAxisAngle(headObject3D.up,headObject3D.rotation.y);controllerPosition.add(deltaControllerPosition);deltaControllerPosition.set(FOREARM.x,FOREARM.y,FOREARM.z);deltaControllerPosition.multiplyScalar(userHeight);if(pose.orientation){controllerQuaternion.fromArray(pose.orientation)}else{controllerQuaternion.copy(headObject3D.quaternion)}controllerEuler.setFromQuaternion(controllerQuaternion);controllerEuler.set(controllerEuler.x,controllerEuler.y,0);deltaControllerPosition.applyEuler(controllerEuler);controllerPosition.add(deltaControllerPosition)},updatePose:function updatePose(){var controller=this.controller,data=this.data,object3D=this.el.object3D,pose,vrDisplay=this.system.vrDisplay,standingMatrix;if(!controller){return}pose=controller.pose;if(pose.position){object3D.position.fromArray(pose.position)}else{if(data.armModel){this.applyArmModel(object3D.position)}}if(pose.orientation){object3D.quaternion.fromArray(pose.orientation)}if(vrDisplay&&pose.position){standingMatrix=this.el.sceneEl.renderer.vr.getStandingMatrix();object3D.matrixAutoUpdate=!1;object3D.matrix.compose(object3D.position,object3D.quaternion,object3D.scale);object3D.matrix.multiplyMatrices(standingMatrix,object3D.matrix);object3D.matrix.decompose(object3D.position,object3D.quaternion,object3D.scale)}object3D.rotateX(this.data.orientationOffset.x*THREE.Math.DEG2RAD);object3D.rotateY(this.data.orientationOffset.y*THREE.Math.DEG2RAD);object3D.rotateZ(this.data.orientationOffset.z*THREE.Math.DEG2RAD);object3D.updateMatrix();object3D.matrixWorldNeedsUpdate=!0},updateButtons:function updateButtons(){var buttonState,controller=this.controller,id;if(!controller){return}for(id=0;id<controller.buttons.length;++id){if(!this.buttonStates[id]){this.buttonStates[id]={pressed:!1,touched:!1,value:0}}buttonState=controller.buttons[id];this.handleButton(id,buttonState)}this.handleAxes()},handleButton:function handleButton(id,buttonState){var changed=this.handlePress(id,buttonState)|this.handleTouch(id,buttonState)|this.handleValue(id,buttonState);if(!changed){return!1}this.el.emit("buttonchanged",{id:id,state:buttonState});return!0},handleAxes:function handleAxes(){var changed=!1,controllerAxes=this.controller.axes,i,previousAxis=this.axis,changedAxes=this.changedAxes;this.changedAxes.length=0;for(i=0;i<controllerAxes.length;++i){changedAxes.push(previousAxis[i]!==controllerAxes[i]);if(changedAxes[i]){changed=!0}}if(!changed){return!1}this.axis.length=0;for(i=0;i<controllerAxes.length;i++){this.axis.push(controllerAxes[i])}this.el.emit("axismove",this.axisMoveEventDetail);return!0},handlePress:function handlePress(id,buttonState){var evtName,previousButtonState=this.buttonStates[id];if(buttonState.pressed===previousButtonState.pressed){return!1}evtName=buttonState.pressed?"down":"up";this.el.emit("button"+evtName,{id:id,state:buttonState});previousButtonState.pressed=buttonState.pressed;return!0},handleTouch:function handleTouch(id,buttonState){var evtName,previousButtonState=this.buttonStates[id];if(buttonState.touched===previousButtonState.touched){return!1}evtName=buttonState.touched?"start":"end";this.el.emit("touch"+evtName,{id:id,state:buttonState},!0,{touches:[]});previousButtonState.touched=buttonState.touched;return!0},handleValue:function handleValue(id,buttonState){var previousButtonState=this.buttonStates[id];if(buttonState.value===previousButtonState.value){return!1}previousButtonState.value=buttonState.value;return!0}})},{"../constants":93,"../core/component":102,"../lib/three":150,"../utils/tracked-controls":178}],88:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent;module.exports.Component=registerComponent("visible",{schema:{default:!0},update:function update(){this.el.object3D.visible=this.data}})},{"../core/component":102}],89:[function(_dereq_,module){var registerComponent=_dereq_("../core/component").registerComponent,utils=_dereq_("../utils/"),bind=utils.bind,trackedControlsUtils=_dereq_("../utils/tracked-controls"),checkControllerPresentAndSetup=trackedControlsUtils.checkControllerPresentAndSetup,emitIfAxesChanged=trackedControlsUtils.emitIfAxesChanged,onButtonEvent=trackedControlsUtils.onButtonEvent,GAMEPAD_ID_PREFIX="OpenVR ";module.exports.Component=registerComponent("vive-controls",{schema:{hand:{default:"left"},buttonColor:{type:"color",default:"#FAFAFA"},buttonHighlightColor:{type:"color",default:"#22D1EE"},model:{default:!0},orientationOffset:{type:"vec3"}},mapping:{axes:{trackpad:[0,1]},buttons:["trackpad","trigger","grip","menu","system"]},init:function init(){var self=this;this.animationActive="pointing";this.checkControllerPresentAndSetup=checkControllerPresentAndSetup;this.controllerPresent=!1;this.emitIfAxesChanged=emitIfAxesChanged;this.lastControllerCheck=0;this.onButtonChanged=bind(this.onButtonChanged,this);this.onButtonDown=function(evt){onButtonEvent(evt.detail.id,"down",self)};this.onButtonUp=function(evt){onButtonEvent(evt.detail.id,"up",self)};this.onButtonTouchEnd=function(evt){onButtonEvent(evt.detail.id,"touchend",self)};this.onButtonTouchStart=function(evt){onButtonEvent(evt.detail.id,"touchstart",self)};this.onAxisMoved=bind(this.onAxisMoved,this);this.previousButtonValues={};this.bindMethods()},play:function play(){this.checkIfControllerPresent();this.addControllersUpdateListener()},pause:function pause(){this.removeEventListeners();this.removeControllersUpdateListener()},bindMethods:function bindMethods(){this.onModelLoaded=bind(this.onModelLoaded,this);this.onControllersUpdate=bind(this.onControllersUpdate,this);this.checkIfControllerPresent=bind(this.checkIfControllerPresent,this);this.removeControllersUpdateListener=bind(this.removeControllersUpdateListener,this);this.onAxisMoved=bind(this.onAxisMoved,this)},addEventListeners:function addEventListeners(){var el=this.el;el.addEventListener("buttonchanged",this.onButtonChanged);el.addEventListener("buttondown",this.onButtonDown);el.addEventListener("buttonup",this.onButtonUp);el.addEventListener("touchend",this.onButtonTouchEnd);el.addEventListener("touchstart",this.onButtonTouchStart);el.addEventListener("model-loaded",this.onModelLoaded);el.addEventListener("axismove",this.onAxisMoved);this.controllerEventsActive=!0},removeEventListeners:function removeEventListeners(){var el=this.el;el.removeEventListener("buttonchanged",this.onButtonChanged);el.removeEventListener("buttondown",this.onButtonDown);el.removeEventListener("buttonup",this.onButtonUp);el.removeEventListener("touchend",this.onButtonTouchEnd);el.removeEventListener("touchstart",this.onButtonTouchStart);el.removeEventListener("model-loaded",this.onModelLoaded);el.removeEventListener("axismove",this.onAxisMoved);this.controllerEventsActive=!1},checkIfControllerPresent:function checkIfControllerPresent(){var data=this.data,controllerIndex="right"===data.hand?0:"left"===data.hand?1:2;this.checkControllerPresentAndSetup(this,GAMEPAD_ID_PREFIX,{index:controllerIndex})},injectTrackedControls:function injectTrackedControls(){var el=this.el,data=this.data;el.setAttribute("tracked-controls",{idPrefix:GAMEPAD_ID_PREFIX,controller:"right"===data.hand?0:"left"===data.hand?1:2,orientationOffset:data.orientationOffset});if(!this.data.model){return}this.el.setAttribute("obj-model",{obj:"https://cdn.aframe.io/controllers/vive/vr_controller_vive.obj",mtl:"https://cdn.aframe.io/controllers/vive/vr_controller_vive.mtl"})},addControllersUpdateListener:function addControllersUpdateListener(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function removeControllersUpdateListener(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function onControllersUpdate(){this.checkIfControllerPresent()},onButtonChanged:function onButtonChanged(evt){var button=this.mapping.buttons[evt.detail.id],buttonMeshes=this.buttonMeshes,analogValue;if(!button){return}if("trigger"===button){analogValue=evt.detail.state.value;if(buttonMeshes&&buttonMeshes.trigger){buttonMeshes.trigger.rotation.x=-analogValue*(_MathPI/12)}}this.el.emit(button+"changed",evt.detail.state)},onModelLoaded:function onModelLoaded(evt){var buttonMeshes,controllerObject3D=evt.detail.model,self=this;if(!this.data.model){return}buttonMeshes=this.buttonMeshes={};buttonMeshes.grip={left:controllerObject3D.getObjectByName("leftgrip"),right:controllerObject3D.getObjectByName("rightgrip")};buttonMeshes.menu=controllerObject3D.getObjectByName("menubutton");buttonMeshes.system=controllerObject3D.getObjectByName("systembutton");buttonMeshes.trackpad=controllerObject3D.getObjectByName("touchpad");buttonMeshes.trigger=controllerObject3D.getObjectByName("trigger");Object.keys(buttonMeshes).forEach(function(buttonName){self.setButtonColor(buttonName,self.data.buttonColor)});controllerObject3D.position.set(0,-.015,.04)},onAxisMoved:function onAxisMoved(evt){this.emitIfAxesChanged(this,this.mapping.axes,evt)},updateModel:function updateModel(buttonName,evtName){var color,isTouch;if(!this.data.model){return}isTouch=-1!==evtName.indexOf("touch");if(isTouch){return}color="up"===evtName?this.data.buttonColor:this.data.buttonHighlightColor;this.setButtonColor(buttonName,color)},setButtonColor:function setButtonColor(buttonName,color){var buttonMeshes=this.buttonMeshes;if(!buttonMeshes){return}if("grip"===buttonName){buttonMeshes.grip.left.material.color.set(color);buttonMeshes.grip.right.material.color.set(color);return}buttonMeshes[buttonName].material.color.set(color)}})},{"../core/component":102,"../utils/":172,"../utils/tracked-controls":178}],90:[function(_dereq_,module){var KEYCODE_TO_CODE=_dereq_("../constants").keyboardevent.KEYCODE_TO_CODE,registerComponent=_dereq_("../core/component").registerComponent,THREE=_dereq_("../lib/three"),utils=_dereq_("../utils/"),bind=utils.bind,shouldCaptureKeyEvent=utils.shouldCaptureKeyEvent,CLAMP_VELOCITY=1e-5,KEYS=["KeyW","KeyA","KeyS","KeyD","ArrowUp","ArrowLeft","ArrowRight","ArrowDown"];module.exports.Component=registerComponent("wasd-controls",{schema:{acceleration:{default:65},adAxis:{default:"x",oneOf:["x","y","z"]},adEnabled:{default:!0},adInverted:{default:!1},easing:{default:20},enabled:{default:!0},fly:{default:!1},wsAxis:{default:"z",oneOf:["x","y","z"]},wsEnabled:{default:!0},wsInverted:{default:!1}},init:function init(){this.keys={};this.position={};this.velocity=new THREE.Vector3;this.onBlur=bind(this.onBlur,this);this.onFocus=bind(this.onFocus,this);this.onKeyDown=bind(this.onKeyDown,this);this.onKeyUp=bind(this.onKeyUp,this);this.onVisibilityChange=bind(this.onVisibilityChange,this);this.attachVisibilityEventListeners()},tick:function tick(time,delta){var currentPosition,data=this.data,el=this.el,movementVector,position=this.position,velocity=this.velocity;if(!velocity[data.adAxis]&&!velocity[data.wsAxis]&&isEmptyObject(this.keys)){return}delta=delta/1e3;this.updateVelocity(delta);if(!velocity[data.adAxis]&&!velocity[data.wsAxis]){return}currentPosition=el.getAttribute("position");movementVector=this.getMovementVector(delta);position.x=currentPosition.x+movementVector.x;position.y=currentPosition.y+movementVector.y;position.z=currentPosition.z+movementVector.z;el.setAttribute("position",position)},remove:function remove(){this.removeKeyEventListeners();this.removeVisibilityEventListeners()},play:function play(){this.attachKeyEventListeners()},pause:function pause(){this.keys={};this.removeKeyEventListeners()},updateVelocity:function updateVelocity(delta){var acceleration,adAxis,adSign,data=this.data,keys=this.keys,velocity=this.velocity,wsAxis,wsSign;adAxis=data.adAxis;wsAxis=data.wsAxis;if(delta>.2){velocity[adAxis]=0;velocity[wsAxis]=0;return}if(0!==velocity[adAxis]){velocity[adAxis]-=velocity[adAxis]*data.easing*delta}if(0!==velocity[wsAxis]){velocity[wsAxis]-=velocity[wsAxis]*data.easing*delta}if(_Mathabs(velocity[adAxis])<CLAMP_VELOCITY){velocity[adAxis]=0}if(_Mathabs(velocity[wsAxis])<CLAMP_VELOCITY){velocity[wsAxis]=0}if(!data.enabled){return}acceleration=data.acceleration;if(data.adEnabled){adSign=data.adInverted?-1:1;if(keys.KeyA||keys.ArrowLeft){velocity[adAxis]-=adSign*acceleration*delta}if(keys.KeyD||keys.ArrowRight){velocity[adAxis]+=adSign*acceleration*delta}}if(data.wsEnabled){wsSign=data.wsInverted?-1:1;if(keys.KeyW||keys.ArrowUp){velocity[wsAxis]-=wsSign*acceleration*delta}if(keys.KeyS||keys.ArrowDown){velocity[wsAxis]+=wsSign*acceleration*delta}}},getMovementVector:function(){var directionVector=new THREE.Vector3(0,0,0),rotationEuler=new THREE.Euler(0,0,0,"YXZ");return function(delta){var rotation=this.el.getAttribute("rotation"),velocity=this.velocity,xRotation;directionVector.copy(velocity);directionVector.multiplyScalar(delta);if(!rotation){return directionVector}xRotation=this.data.fly?rotation.x:0;rotationEuler.set(THREE.Math.degToRad(xRotation),THREE.Math.degToRad(rotation.y),0);directionVector.applyEuler(rotationEuler);return directionVector}}(),attachVisibilityEventListeners:function attachVisibilityEventListeners(){window.addEventListener("blur",this.onBlur);window.addEventListener("focus",this.onFocus);document.addEventListener("visibilitychange",this.onVisibilityChange)},removeVisibilityEventListeners:function removeVisibilityEventListeners(){window.removeEventListener("blur",this.onBlur);window.removeEventListener("focus",this.onFocus);document.removeEventListener("visibilitychange",this.onVisibilityChange)},attachKeyEventListeners:function attachKeyEventListeners(){window.addEventListener("keydown",this.onKeyDown);window.addEventListener("keyup",this.onKeyUp)},removeKeyEventListeners:function removeKeyEventListeners(){window.removeEventListener("keydown",this.onKeyDown);window.removeEventListener("keyup",this.onKeyUp)},onBlur:function onBlur(){this.pause()},onFocus:function onFocus(){this.play()},onVisibilityChange:function onVisibilityChange(){if(document.hidden){this.onBlur()}else{this.onFocus()}},onKeyDown:function onKeyDown(event){var code;if(!shouldCaptureKeyEvent(event)){return}code=event.code||KEYCODE_TO_CODE[event.keyCode];if(-1!==KEYS.indexOf(code)){this.keys[code]=!0}},onKeyUp:function onKeyUp(event){var code=event.code||KEYCODE_TO_CODE[event.keyCode];delete this.keys[code]}});function isEmptyObject(keys){for(var key in keys){return!1}return!0}},{"../constants":93,"../core/component":102,"../lib/three":150,"../utils/":172}],91:[function(_dereq_,module){var bind=_dereq_("../utils/bind"),registerComponent=_dereq_("../core/component").registerComponent,trackedControlsUtils=_dereq_("../utils/tracked-controls"),onButtonEvent=trackedControlsUtils.onButtonEvent,utils=_dereq_("../utils/"),debug=utils.debug("components:windows-motion-controls:debug"),warn=utils.debug("components:windows-motion-controls:warn"),DEFAULT_HANDEDNESS=_dereq_("../constants").DEFAULT_HANDEDNESS,MODEL_FILENAMES={left:"left.glb",right:"right.glb",default:"universal.glb"},GAMEPAD_ID_PREFIX="Spatial Controller (Spatial Interaction Source) ",GAMEPAD_ID_PATTERN=/([0-9a-zA-Z]+-[0-9a-zA-Z]+)$/;module.exports.Component=registerComponent("windows-motion-controls",{schema:{hand:{default:DEFAULT_HANDEDNESS},pair:{default:0},model:{default:!0},hideDisconnected:{default:!0}},mapping:{axes:{thumbstick:[0,1],trackpad:[2,3]},buttons:["thumbstick","trigger","grip","menu","trackpad"],axisMeshNames:["THUMBSTICK_X","THUMBSTICK_Y","TOUCHPAD_TOUCH_X","TOUCHPAD_TOUCH_Y"],buttonMeshNames:{trigger:"SELECT",menu:"MENU",grip:"GRASP",thumbstick:"THUMBSTICK_PRESS",trackpad:"TOUCHPAD_PRESS"},pointingPoseMeshName:"POINTING_POSE"},bindMethods:function bindMethods(){this.onModelError=bind(this.onModelError,this);this.onModelLoaded=bind(this.onModelLoaded,this);this.onControllersUpdate=bind(this.onControllersUpdate,this);this.checkIfControllerPresent=bind(this.checkIfControllerPresent,this);this.onAxisMoved=bind(this.onAxisMoved,this)},init:function init(){var self=this,el=this.el;this.onButtonChanged=bind(this.onButtonChanged,this);this.onButtonDown=function(evt){onButtonEvent(evt.detail.id,"down",self)};this.onButtonUp=function(evt){onButtonEvent(evt.detail.id,"up",self)};this.onButtonTouchStart=function(evt){onButtonEvent(evt.detail.id,"touchstart",self)};this.onButtonTouchEnd=function(evt){onButtonEvent(evt.detail.id,"touchend",self)};this.onControllerConnected=function(){self.setModelVisibility(!0)};this.onControllerDisconnected=function(){self.setModelVisibility(!1)};this.controllerPresent=!1;this.lastControllerCheck=0;this.previousButtonValues={};this.bindMethods();this.loadedMeshInfo={buttonMeshes:null,axisMeshes:null};this.rayOrigin={origin:new THREE.Vector3,direction:new THREE.Vector3(0,0,-1),createdFromMesh:!1};this.emitIfAxesChanged=trackedControlsUtils.emitIfAxesChanged;this.checkControllerPresentAndSetup=trackedControlsUtils.checkControllerPresentAndSetup;el.addEventListener("controllerconnected",this.onControllerConnected);el.addEventListener("controllerdisconnected",this.onControllerDisconnected)},addEventListeners:function addEventListeners(){var el=this.el;el.addEventListener("buttonchanged",this.onButtonChanged);el.addEventListener("buttondown",this.onButtonDown);el.addEventListener("buttonup",this.onButtonUp);el.addEventListener("touchstart",this.onButtonTouchStart);el.addEventListener("touchend",this.onButtonTouchEnd);el.addEventListener("axismove",this.onAxisMoved);el.addEventListener("model-error",this.onModelError);el.addEventListener("model-loaded",this.onModelLoaded);this.controllerEventsActive=!0},removeEventListeners:function removeEventListeners(){var el=this.el;el.removeEventListener("buttonchanged",this.onButtonChanged);el.removeEventListener("buttondown",this.onButtonDown);el.removeEventListener("buttonup",this.onButtonUp);el.removeEventListener("touchstart",this.onButtonTouchStart);el.removeEventListener("touchend",this.onButtonTouchEnd);el.removeEventListener("axismove",this.onAxisMoved);el.removeEventListener("model-error",this.onModelError);el.removeEventListener("model-loaded",this.onModelLoaded);this.controllerEventsActive=!1},checkIfControllerPresent:function checkIfControllerPresent(){this.checkControllerPresentAndSetup(this,GAMEPAD_ID_PREFIX,{hand:this.data.hand,index:this.data.pair})},play:function play(){this.checkIfControllerPresent();this.addControllersUpdateListener()},pause:function pause(){this.removeEventListeners();this.removeControllersUpdateListener()},updateControllerModel:function updateControllerModel(){if(!this.data.model||this.rayOrigin.createdFromMesh){this.modelReady();return}var sourceUrl=this.createControllerModelUrl();this.loadModel(sourceUrl)},createControllerModelUrl:function createControllerModelUrl(forceDefault){var trackedControlsComponent=this.el.components["tracked-controls"],controller=trackedControlsComponent?trackedControlsComponent.controller:null,device="default",hand=this.data.hand,filename;if(controller){hand=controller.hand;if(!forceDefault){var match=controller.id.match(GAMEPAD_ID_PATTERN);device=match&&match[0]||device}}filename=MODEL_FILENAMES[hand]||MODEL_FILENAMES.default;return"https://cdn.aframe.io/controllers/microsoft/"+device+"/"+filename},injectTrackedControls:function injectTrackedControls(){var data=this.data;this.el.setAttribute("tracked-controls",{idPrefix:GAMEPAD_ID_PREFIX,controller:data.pair,hand:data.hand,armModel:!1});this.updateControllerModel()},addControllersUpdateListener:function addControllersUpdateListener(){this.el.sceneEl.addEventListener("controllersupdated",this.onControllersUpdate,!1)},removeControllersUpdateListener:function removeControllersUpdateListener(){this.el.sceneEl.removeEventListener("controllersupdated",this.onControllersUpdate,!1)},onControllersUpdate:function onControllersUpdate(){this.checkIfControllerPresent()},onModelError:function onModelError(evt){var defaultUrl=this.createControllerModelUrl(!0);if(evt.detail.src!==defaultUrl){warn("Failed to load controller model for device, attempting to load default.");this.loadModel(defaultUrl)}else{warn("Failed to load default controller model.")}},loadModel:function loadModel(url){this.el.setAttribute("gltf-model","url("+url+")")},onModelLoaded:function onModelLoaded(evt){var rootNode=this.controllerModel=evt.detail.model,loadedMeshInfo=this.loadedMeshInfo,i,meshName,mesh,meshInfo;debug("Processing model");loadedMeshInfo.buttonMeshes={};loadedMeshInfo.axisMeshes={};if(rootNode){for(i=0;i<this.mapping.buttons.length;i++){meshName=this.mapping.buttonMeshNames[this.mapping.buttons[i]];if(!meshName){debug("Skipping unknown button at index: "+i+" with mapped name: "+this.mapping.buttons[i]);continue}mesh=rootNode.getObjectByName(meshName);if(!mesh){warn("Missing button mesh with name: "+meshName);continue}meshInfo={index:i,value:getImmediateChildByName(mesh,"VALUE"),pressed:getImmediateChildByName(mesh,"PRESSED"),unpressed:getImmediateChildByName(mesh,"UNPRESSED")};if(meshInfo.value&&meshInfo.pressed&&meshInfo.unpressed){loadedMeshInfo.buttonMeshes[this.mapping.buttons[i]]=meshInfo}else{warn("Missing button submesh under mesh with name: "+meshName+"(VALUE: "+!!meshInfo.value+", PRESSED: "+!!meshInfo.pressed+", UNPRESSED:"+!!meshInfo.unpressed+")")}}for(i=0;i<this.mapping.axisMeshNames.length;i++){meshName=this.mapping.axisMeshNames[i];if(!meshName){debug("Skipping unknown axis at index: "+i);continue}mesh=rootNode.getObjectByName(meshName);if(!mesh){warn("Missing axis mesh with name: "+meshName);continue}meshInfo={index:i,value:getImmediateChildByName(mesh,"VALUE"),min:getImmediateChildByName(mesh,"MIN"),max:getImmediateChildByName(mesh,"MAX")};if(meshInfo.value&&meshInfo.min&&meshInfo.max){loadedMeshInfo.axisMeshes[i]=meshInfo}else{warn("Missing axis submesh under mesh with name: "+meshName+"(VALUE: "+!!meshInfo.value+", MIN: "+!!meshInfo.min+", MAX:"+!!meshInfo.max+")")}}this.calculateRayOriginFromMesh(rootNode);this.setModelVisibility()}debug("Model load complete.");function getImmediateChildByName(object3d,value){for(var i=0,l=object3d.children.length,obj;i<l;i++){obj=object3d.children[i];if(obj&&obj.name===value){return obj}}}},calculateRayOriginFromMesh:function(){var quaternion=new THREE.Quaternion;return function(rootNode){var mesh;this.rayOrigin.origin.set(0,0,0);this.rayOrigin.direction.set(0,0,-1);this.rayOrigin.createdFromMesh=!0;mesh=rootNode.getObjectByName(this.mapping.pointingPoseMeshName);if(mesh){var parent=rootNode.parent;if(parent){rootNode.parent=null;rootNode.updateMatrixWorld(!0);rootNode.parent=parent}mesh.getWorldPosition(this.rayOrigin.origin);mesh.getWorldQuaternion(quaternion);this.rayOrigin.direction.applyQuaternion(quaternion);if(parent){rootNode.updateMatrixWorld(!0)}}else{debug("Mesh does not contain pointing origin data, defaulting to none.")}this.modelReady()}}(),lerpAxisTransform:function(){var quaternion=new THREE.Quaternion;return function(axis,axisValue){var axisMeshInfo=this.loadedMeshInfo.axisMeshes[axis];if(!axisMeshInfo)return;var min=axisMeshInfo.min,max=axisMeshInfo.max,target=axisMeshInfo.value,lerpValue=.5*axisValue+.5;target.setRotationFromQuaternion(quaternion.copy(min.quaternion).slerp(max.quaternion,lerpValue));target.position.lerpVectors(min.position,max.position,lerpValue)}}(),lerpButtonTransform:function(){var quaternion=new THREE.Quaternion;return function(buttonName,buttonValue){var buttonMeshInfo=this.loadedMeshInfo.buttonMeshes[buttonName];if(!buttonMeshInfo)return;var min=buttonMeshInfo.unpressed,max=buttonMeshInfo.pressed,target=buttonMeshInfo.value;target.setRotationFromQuaternion(quaternion.copy(min.quaternion).slerp(max.quaternion,buttonValue));target.position.lerpVectors(min.position,max.position,buttonValue)}}(),modelReady:function modelReady(){this.el.emit("controllermodelready",{name:"windows-motion-controls",model:this.data.model,rayOrigin:this.rayOrigin})},onButtonChanged:function onButtonChanged(evt){var buttonName=this.mapping.buttons[evt.detail.id];if(buttonName){if(this.loadedMeshInfo&&this.loadedMeshInfo.buttonMeshes){this.lerpButtonTransform(buttonName,evt.detail.state.value)}this.el.emit(buttonName+"changed",evt.detail.state)}},onAxisMoved:function onAxisMoved(evt){var numAxes=this.mapping.axisMeshNames.length;if(this.loadedMeshInfo&&this.loadedMeshInfo.axisMeshes){for(var axis=0;axis<numAxes;axis++){this.lerpAxisTransform(axis,evt.detail.axis[axis]||0)}}this.emitIfAxesChanged(this,this.mapping.axes,evt)},setModelVisibility:function setModelVisibility(visible){var model=this.el.getObject3D("mesh");visible=visible!==void 0?visible:this.modelVisible;this.modelVisible=visible;if(!model){return}model.visible=visible}})},{"../constants":93,"../core/component":102,"../utils/":172,"../utils/bind":166,"../utils/tracked-controls":178}],92:[function(_dereq_,module){var TWEEN=_dereq_("@tweenjs/tween.js"),DIRECTIONS={alternate:"alternate",alternateReverse:"alternate-reverse",normal:"normal",reverse:"reverse"},EASING_FUNCTIONS={linear:TWEEN.Easing.Linear.None,ease:TWEEN.Easing.Cubic.InOut,"ease-in":TWEEN.Easing.Cubic.In,"ease-out":TWEEN.Easing.Cubic.Out,"ease-in-out":TWEEN.Easing.Cubic.InOut,"ease-cubic":TWEEN.Easing.Cubic.In,"ease-in-cubic":TWEEN.Easing.Cubic.In,"ease-out-cubic":TWEEN.Easing.Cubic.Out,"ease-in-out-cubic":TWEEN.Easing.Cubic.InOut,"ease-quad":TWEEN.Easing.Quadratic.InOut,"ease-in-quad":TWEEN.Easing.Quadratic.In,"ease-out-quad":TWEEN.Easing.Quadratic.Out,"ease-in-out-quad":TWEEN.Easing.Quadratic.InOut,"ease-quart":TWEEN.Easing.Quartic.InOut,"ease-in-quart":TWEEN.Easing.Quartic.In,"ease-out-quart":TWEEN.Easing.Quartic.Out,"ease-in-out-quart":TWEEN.Easing.Quartic.InOut,"ease-quint":TWEEN.Easing.Quintic.InOut,"ease-in-quint":TWEEN.Easing.Quintic.In,"ease-out-quint":TWEEN.Easing.Quintic.Out,"ease-in-out-quint":TWEEN.Easing.Quintic.InOut,"ease-sine":TWEEN.Easing.Sinusoidal.InOut,"ease-in-sine":TWEEN.Easing.Sinusoidal.In,"ease-out-sine":TWEEN.Easing.Sinusoidal.Out,"ease-in-out-sine":TWEEN.Easing.Sinusoidal.InOut,"ease-expo":TWEEN.Easing.Exponential.InOut,"ease-in-expo":TWEEN.Easing.Exponential.In,"ease-out-expo":TWEEN.Easing.Exponential.Out,"ease-in-out-expo":TWEEN.Easing.Exponential.InOut,"ease-circ":TWEEN.Easing.Circular.InOut,"ease-in-circ":TWEEN.Easing.Circular.In,"ease-out-circ":TWEEN.Easing.Circular.Out,"ease-in-out-circ":TWEEN.Easing.Circular.InOut,"ease-elastic":TWEEN.Easing.Elastic.InOut,"ease-in-elastic":TWEEN.Easing.Elastic.In,"ease-out-elastic":TWEEN.Easing.Elastic.Out,"ease-in-out-elastic":TWEEN.Easing.Elastic.InOut,"ease-back":TWEEN.Easing.Back.InOut,"ease-in-back":TWEEN.Easing.Back.In,"ease-out-back":TWEEN.Easing.Back.Out,"ease-in-out-back":TWEEN.Easing.Back.InOut,"ease-bounce":TWEEN.Easing.Bounce.InOut,"ease-in-bounce":TWEEN.Easing.Bounce.In,"ease-out-bounce":TWEEN.Easing.Bounce.Out,"ease-in-out-bounce":TWEEN.Easing.Bounce.InOut},FILLS={backwards:"backwards",both:"both",forwards:"forwards",none:"none"},DEFAULTS={attribute:"rotation",begin:"",end:"",delay:0,dur:1e3,easing:"ease",direction:DIRECTIONS.normal,fill:FILLS.forwards,from:void 0,repeat:0,to:void 0};module.exports.defaults=DEFAULTS;module.exports.directions=DIRECTIONS;module.exports.easingFunctions=EASING_FUNCTIONS;module.exports.fills=FILLS;module.exports.repeats={indefinite:"indefinite"}},{"@tweenjs/tween.js":1}],93:[function(_dereq_,module){module.exports={AFRAME_INJECTED:"aframe-injected",DEFAULT_CAMERA_HEIGHT:1.6,DEFAULT_HANDEDNESS:"right",animation:_dereq_("./animation"),keyboardevent:_dereq_("./keyboardevent")}},{"./animation":92,"./keyboardevent":94}],94:[function(_dereq_,module){module.exports={KEYCODE_TO_CODE:{38:"ArrowUp",37:"ArrowLeft",40:"ArrowDown",39:"ArrowRight",87:"KeyW",65:"KeyA",83:"KeyS",68:"KeyD"}}},{}],95:[function(_dereq_,module){var ANode=_dereq_("./a-node"),animationConstants=_dereq_("../constants/animation"),coordinates=_dereq_("../utils/").coordinates,parseProperty=_dereq_("./schema").parseProperty,registerElement=_dereq_("./a-register-element").registerElement,TWEEN=_dereq_("@tweenjs/tween.js"),THREE=_dereq_("../lib/three"),utils=_dereq_("../utils/"),bind=utils.bind,getComponentProperty=utils.entity.getComponentProperty,DEFAULTS=animationConstants.defaults,DIRECTIONS=animationConstants.directions,EASING_FUNCTIONS=animationConstants.easingFunctions,FILLS=animationConstants.fills,REPEATS=animationConstants.repeats,isCoordinates=coordinates.isCoordinates,warn=utils.debug("core:a-animation:warn"),hasLoggedDeprecation=!1;module.exports.AAnimation=registerElement("a-animation",{prototype:Object.create(ANode.prototype,{createdCallback:{value:function value(){this.bindMethods();this.isRunning=!1;this.partialSetAttribute=function(){};this.tween=null;if(!hasLoggedDeprecation){warn("<a-animation> has been deprecated and will be replaced by the animation "+"component: https://www.npmjs.com/package/aframe-animation-component");hasLoggedDeprecation=!0}}},attachedCallback:{value:function value(){this.el=this.parentNode;this.handleMixinUpdate();this.update();this.load()}},attributeChangedCallback:{value:function value(){if(!this.hasLoaded||!this.isRunning){return}this.stop();this.handleMixinUpdate();this.update()}},detachedCallback:{value:function value(){if(!this.isRunning){return}this.stop()}},getTween:{value:function value(){var self=this,data=self.data,el=self.el,animationValues,attribute=data.attribute,delay=parseInt(data.delay,10),currentValue=getComponentProperty(el,attribute),direction=self.getDirection(data.direction),easing=EASING_FUNCTIONS[data.easing],fill=data.fill,from,repeat=data.repeat===REPEATS.indefinite?1/0:0,to,toTemp,yoyo=!1;animationValues=getAnimationValues(el,attribute,data.from||self.initialValue,data.to,currentValue);from=animationValues.from;to=animationValues.to;self.partialSetAttribute=animationValues.partialSetAttribute;if(self.count===void 0){self.count=repeat===1/0?0:parseInt(data.repeat,10)}if(isNaN(delay)){delay=0}self.initialValue=self.initialValue||cloneValue(currentValue);if(repeat===1/0&&fill===FILLS.forwards&&-1!==[DIRECTIONS.alternate,DIRECTIONS.alternateReverse].indexOf(data.direction)){yoyo=!0}if(direction===DIRECTIONS.reverse){toTemp=to;to=cloneValue(from);from=cloneValue(toTemp)}if(-1!==[FILLS.backwards,FILLS.both].indexOf(fill)){self.partialSetAttribute(from)}return new TWEEN.Tween(cloneValue(from)).to(to,data.dur).delay(delay).easing(easing).repeat(repeat).yoyo(yoyo).onUpdate(function(){self.partialSetAttribute(this)}).onComplete(bind(self.onCompleted,self))}},update:{value:function value(){var data=this.data;if("infinite"===data.repeat){console.warn("Using 'infinite' as 'repeat' value is invalid.  Use 'indefinite' instead.")}if(""!==data.begin&&!isNaN(data.begin)){console.warn("Using 'begin' to specify a delay is deprecated. Use 'delay' instead.");data.delay=data.begin;data.begin=""}var begin=data.begin,end=data.end;if(this.evt){this.removeEventListeners(this.evt)}this.evt={begin:begin,end:end};this.addEventListeners(this.evt);if(""===begin){this.stop();this.start()}},writable:window.debug},onCompleted:{value:function value(){var data=this.data;this.isRunning=!1;if(-1!==[FILLS.backwards,FILLS.none].indexOf(data.fill)){this.partialSetAttribute(this.initialValue)}if(0===this.count){this.count=void 0;this.emit("animationend");return}this.isRunning=!1;this.count--;this.start()}},start:{value:function value(){var self=this;if(!this.el.hasLoaded){this.el.addEventListener("loaded",function(){self.start()});return}if(this.isRunning||!this.el.isPlaying){return}this.tween=this.getTween();this.isRunning=!0;this.tween.start();this.emit("animationstart")},writable:!0},stop:{value:function value(){var tween=this.tween;if(!tween){return}tween.stop();this.isRunning=!1;if(-1!==[FILLS.backwards,FILLS.none].indexOf(this.data.fill)){this.partialSetAttribute(this.initialValue)}this.emit("animationstop")},writable:!0},getDirection:{value:function value(direction){if(direction===DIRECTIONS.alternate){this.prevDirection=this.prevDirection===DIRECTIONS.normal?DIRECTIONS.reverse:DIRECTIONS.normal;return this.prevDirection}if(direction===DIRECTIONS.alternateReverse){this.prevDirection=this.prevDirection===DIRECTIONS.reverse?DIRECTIONS.normal:DIRECTIONS.reverse;return this.prevDirection}return direction}},bindMethods:{value:function value(){this.start=bind(this.start,this);this.stop=bind(this.stop,this);this.onStateAdded=bind(this.onStateAdded,this);this.onStateRemoved=bind(this.onStateRemoved,this)}},addEventListeners:{value:function value(evts){var el=this.el,self=this;utils.splitString(evts.begin).forEach(function(evt){el.addEventListener(evt,self.start)});utils.splitString(evts.end).forEach(function(evt){el.addEventListener(evt,self.stop)});if(""===evts.begin){el.addEventListener("play",this.start)}el.addEventListener("pause",this.stop);el.addEventListener("stateadded",this.onStateAdded);el.addEventListener("stateremoved",this.onStateRemoved)}},removeEventListeners:{value:function value(evts){var el=this.el,start=this.start,stop=this.stop;utils.splitString(evts.begin).forEach(function(evt){el.removeEventListener(evt,start)});utils.splitString(evts.end).forEach(function(evt){el.removeEventListener(evt,stop)});el.removeEventListener("stateadded",this.onStateAdded);el.removeEventListener("stateremoved",this.onStateRemoved)}},onStateAdded:{value:function value(evt){if(evt.detail===this.data.begin){this.start()}},writable:!0},onStateRemoved:{value:function value(evt){if(evt.detail===this.data.begin){this.stop()}},writable:!0},handleMixinUpdate:{value:function value(){var data={},elData,mixinData,mixinEl;mixinEl=document.querySelector("#"+this.getAttribute("mixin"));mixinData=mixinEl?utils.getElData(mixinEl,DEFAULTS):{};elData=utils.getElData(this,DEFAULTS);utils.extend(data,DEFAULTS,mixinData,elData);this.data=data}}})});function cloneValue(val){return utils.extend({},val)}function getAnimationValues(el,attribute,dataFrom,dataTo,currentValue){var attributeSplit=attribute.split("."),schema,component,componentPropName,componentName,from={},partialSetAttribute,to={};if(2===attributeSplit.length){if(isColor()){getForColorComponent()}else{getForComponentAttribute()}}else if(dataTo&&isCoordinates(dataTo)){getForCoordinateComponent()}else if(-1!==["true","false"].indexOf(dataTo)){getForBoolean()}else if(isNaN(dataTo)){getForColorComponent()}else{getForNumber()}return{from:from,partialSetAttribute:partialSetAttribute,to:to};function isColor(){var componentName=attributeSplit[0],propertyName=attributeSplit[1],component=el.components[componentName],schema=component&&component.schema;return schema&&schema[propertyName]&&"color"===schema[propertyName].type}function getForComponentAttribute(){componentName=attributeSplit[0];componentPropName=attributeSplit[1];component=el.components[componentName];if(!component){el.setAttribute(componentName,"");component=el.components[componentName]}schema=component.schema;if(dataFrom===void 0){from[attribute]=getComponentProperty(el,attribute)}else{from[attribute]=dataFrom}from[attribute]=parseProperty(from[attribute],schema[componentPropName]);to[attribute]=parseProperty(dataTo,schema[componentPropName]);partialSetAttribute=function(value){if(!(attribute in value)){return}el.setAttribute(componentName,componentPropName,value[attribute])}}function getForCoordinateComponent(){from=dataFrom?coordinates.parse(dataFrom):currentValue;to=coordinates.parse(dataTo);partialSetAttribute=function(value){el.setAttribute(attribute,value)}}function getForBoolean(){if(dataFrom===void 0){from[attribute]=!1}else{from[attribute]=strToBool(dataFrom)}from[attribute]=boolToNum(from[attribute]);to[attribute]=boolToNum(strToBool(dataTo));partialSetAttribute=function(value){el.setAttribute(attribute,!!value[attribute])}}function getForColorComponent(){from=new THREE.Color(dataFrom||el.getAttribute(attribute));to=new THREE.Color(dataTo);partialSetAttribute=function(value){if(1<attributeSplit.length){el.setAttribute(attributeSplit[0],attributeSplit[1],rgbVectorToHex(value))}el.setAttribute(attribute,rgbVectorToHex(value))}}function getForNumber(){if(dataFrom===void 0){from[attribute]=parseFloat(el.getAttribute(attribute))}else{from[attribute]=parseFloat(dataFrom)}to[attribute]=parseFloat(dataTo);partialSetAttribute=function(value){el.setAttribute(attribute,value[attribute])}}}module.exports.getAnimationValues=getAnimationValues;function strToBool(str){if("true"===str){return!0}return!1}function boolToNum(bool){return bool?1:0}function componentToHex(color){var hex=color.toString(16);return 1===hex.length?"0"+hex:hex}function convertToIntegerColor(color){return _Mathfloor(255*_Mathmin(_Mathabs(color),1))}function rgbVectorToHex(color){return"#"+["r","g","b"].map(function(prop){return componentToHex(convertToIntegerColor(color[prop]))}).join("")}},{"../constants/animation":92,"../lib/three":150,"../utils/":172,"./a-node":100,"./a-register-element":101,"./schema":110,"@tweenjs/tween.js":1}],96:[function(_dereq_,module){var ANode=_dereq_("./a-node"),bind=_dereq_("../utils/bind"),debug=_dereq_("../utils/debug"),registerElement=_dereq_("./a-register-element").registerElement,THREE=_dereq_("../lib/three"),fileLoader=new THREE.FileLoader,warn=debug("core:a-assets:warn");module.exports=registerElement("a-assets",{prototype:Object.create(ANode.prototype,{createdCallback:{value:function value(){this.isAssets=!0;this.fileLoader=fileLoader;this.timeout=null}},attachedCallback:{value:function value(){var self=this,i,loaded=[],mediaEl,mediaEls,imgEl,imgEls,timeout;if(!this.parentNode.isScene){throw new Error("<a-assets> must be a child of a <a-scene>.")}imgEls=this.querySelectorAll("img");for(i=0;i<imgEls.length;i++){imgEl=fixUpMediaElement(imgEls[i]);loaded.push(new Promise(function(resolve,reject){THREE.Cache.files[imgEls[i].getAttribute("src")]=imgEl;imgEl.onload=resolve;imgEl.onerror=reject}))}mediaEls=this.querySelectorAll("audio, video");for(i=0;i<mediaEls.length;i++){mediaEl=fixUpMediaElement(mediaEls[i]);if(!mediaEl.src&&!mediaEl.srcObject){warn("Audio/video asset has neither `src` nor `srcObject` attributes.")}loaded.push(mediaElementLoaded(mediaEl))}Promise.all(loaded).then(bind(this.load,this));timeout=parseInt(this.getAttribute("timeout"),10)||3e3;this.timeout=setTimeout(function(){if(self.hasLoaded){return}warn("Asset loading timed out in ",timeout,"ms");self.emit("timeout");self.load()},timeout)}},detachedCallback:{value:function value(){if(this.timeout){clearTimeout(this.timeout)}}},load:{value:function value(){ANode.prototype.load.call(this,null,function(el){return el.isAssetItem&&el.hasAttribute("src")})}}})});registerElement("a-asset-item",{prototype:Object.create(ANode.prototype,{createdCallback:{value:function value(){this.data=null;this.isAssetItem=!0}},attachedCallback:{value:function value(){var self=this,src=this.getAttribute("src");fileLoader.setResponseType(this.getAttribute("response-type")||inferResponseType(src));fileLoader.load(src,function(response){self.data=response;setTimeout(function(){ANode.prototype.load.call(self)})},function(xhr){self.emit("progress",{loadedBytes:xhr.loaded,totalBytes:xhr.total,xhr:xhr})},function(xhr){self.emit("error",{xhr:xhr})})}}})});function mediaElementLoaded(el){if(!el.hasAttribute("autoplay")&&"auto"!==el.getAttribute("preload")){return}return new Promise(function(resolve,reject){if(4===el.readyState){return resolve()}if(el.error){return reject()}el.addEventListener("loadeddata",checkProgress,!1);el.addEventListener("progress",checkProgress,!1);el.addEventListener("error",reject,!1);function checkProgress(){for(var secondsBuffered=0,i=0;i<el.buffered.length;i++){secondsBuffered+=el.buffered.end(i)-el.buffered.start(i)}if(secondsBuffered>=el.duration){THREE.Cache.files[el.getAttribute("src")]=el;resolve()}}})}function fixUpMediaElement(mediaEl){var newMediaEl=setCrossOrigin(mediaEl);if(newMediaEl.tagName&&"video"===newMediaEl.tagName.toLowerCase()){newMediaEl.setAttribute("playsinline","");newMediaEl.setAttribute("webkit-playsinline","")}if(newMediaEl!==mediaEl){mediaEl.parentNode.appendChild(newMediaEl);mediaEl.parentNode.removeChild(mediaEl)}return newMediaEl}function setCrossOrigin(mediaEl){var newMediaEl,src;if(mediaEl.hasAttribute("crossorigin")){return mediaEl}src=mediaEl.getAttribute("src");if(null!==src){if(-1===src.indexOf("://")){return mediaEl}if(extractDomain(src)===window.location.host){return mediaEl}}warn("Cross-origin element (e.g., <img>) was requested without `crossorigin` set. "+"A-Frame will re-request the asset with `crossorigin` attribute set. "+"Please set `crossorigin` on the element (e.g., <img crossorigin=\"anonymous\">)",src);mediaEl.crossOrigin="anonymous";newMediaEl=mediaEl.cloneNode(!0);return newMediaEl}function extractDomain(url){var domain=-1<url.indexOf("://")?url.split("/")[2]:url.split("/")[0];return domain.substring(0,domain.indexOf(":"))}function inferResponseType(src){var dotLastIndex=src.lastIndexOf(".");if(0<=dotLastIndex){var extension=src.slice(dotLastIndex,src.length);if(".gltf"===extension||".glb"===extension){return"arraybuffer"}}return"text"}module.exports.inferResponseType=inferResponseType},{"../lib/three":150,"../utils/bind":166,"../utils/debug":168,"./a-node":100,"./a-register-element":101}],97:[function(_dereq_,module){var debug=_dereq_("../utils/debug"),registerElement=_dereq_("./a-register-element").registerElement,warn=debug("core:cubemap:warn");module.exports=registerElement("a-cubemap",{prototype:Object.create(window.HTMLElement.prototype,{attachedCallback:{value:function value(){this.srcs=this.validate()},writable:window.debug},validate:{value:function value(){var elements=this.querySelectorAll("[src]"),i,srcs=[];if(6===elements.length){for(i=0;i<elements.length;i++){srcs.push(elements[i].getAttribute("src"))}return srcs}warn("<a-cubemap> did not contain exactly six elements each with a "+"`src` attribute.")},writable:window.debug}})})},{"../utils/debug":168,"./a-register-element":101}],98:[function(_dereq_,module){var ANode=_dereq_("./a-node"),COMPONENTS=_dereq_("./component").components,registerElement=_dereq_("./a-register-element").registerElement,THREE=_dereq_("../lib/three"),utils=_dereq_("../utils/"),AEntity,debug=utils.debug("core:a-entity:debug"),warn=utils.debug("core:a-entity:warn"),MULTIPLE_COMPONENT_DELIMITER="__",OBJECT3D_COMPONENTS=["position","rotation","scale","visible"],proto=Object.create(ANode.prototype,{createdCallback:{value:function value(){this.components={};this.initializingComponents={};this.componentsToUpdate={};this.isEntity=!0;this.isPlaying=!1;this.object3D=new THREE.Group;this.object3D.el=this;this.object3DMap={};this.parentEl=null;this.rotationObj={};this.states=[]}},attributeChangedCallback:{value:function value(attr,oldVal,newVal){var component=this.components[attr];if(component&&component.justInitialized&&""===newVal){delete component.justInitialized;return}if(!component&&null===newVal){return}this.setEntityAttribute(attr,oldVal,newVal)}},attachedCallback:{value:function value(){var assetsEl,sceneEl=this.sceneEl,self=this;this.addToParent();if(this.isScene){return}if(!sceneEl){this.load();return}assetsEl=sceneEl.querySelector("a-assets");if(assetsEl&&!assetsEl.hasLoaded){assetsEl.addEventListener("loaded",function(){self.load()});return}this.load()}},detachedCallback:{value:function value(){if(!this.parentEl){return}for(var componentName in this.components){this.removeComponent(componentName)}if(this.isScene){return}this.removeFromParent();ANode.prototype.detachedCallback.call(this);this.object3D.el=null}},handleMixinUpdate:{value:function value(attrName){if(!attrName){this.updateComponents();return}this.updateComponent(attrName,this.getDOMAttribute(attrName))}},getObject3D:{value:function value(type){return this.object3DMap[type]}},setObject3D:{value:function value(type,obj){var oldObj,self=this;if(!babelHelpers.instanceof(obj,THREE.Object3D)){throw new Error("`Entity.setObject3D` was called with an object that was not an instance of "+"THREE.Object3D.")}oldObj=this.getObject3D(type);if(oldObj){this.object3D.remove(oldObj)}obj.el=this;if(obj.children.length){obj.traverse(function(child){child.el=self})}this.object3D.add(obj);this.object3DMap[type]=obj;this.emit("object3dset",{object:obj,type:type})}},removeObject3D:{value:function value(type){var obj=this.getObject3D(type);if(!obj){warn("Tried to remove `Object3D` of type:",type,"which was not defined.");return}this.object3D.remove(obj);delete this.object3DMap[type];this.emit("object3dremove",{type:type})}},getOrCreateObject3D:{value:function value(type,Constructor){var object3D=this.getObject3D(type);if(!object3D&&Constructor){object3D=new Constructor;this.setObject3D(type,object3D)}warn("`getOrCreateObject3D` has been deprecated. Use `setObject3D()` "+"and `object3dset` event instead.");return object3D}},add:{value:function value(el){if(!el.object3D){throw new Error("Trying to add an element that doesn't have an `object3D`")}this.object3D.add(el.object3D);this.emit("child-attached",{el:el})}},addToParent:{value:function value(){var parentNode=this.parentEl=this.parentNode;if(!parentNode||!parentNode.add||this.attachedToParent){return}parentNode.add(this);this.attachedToParent=!0}},removeFromParent:{value:function value(){var parentEl=this.parentEl;this.parentEl.remove(this);this.attachedToParent=!1;this.parentEl=this.parentNode=null;parentEl.emit("child-detached",{el:this})}},load:{value:function value(){var self=this;if(this.hasLoaded||!this.parentEl){return}ANode.prototype.load.call(this,function(){if(!self.parentEl){return}self.updateComponents();if(self.isScene||self.parentEl.isPlaying){self.play()}})},writable:window.debug},remove:{value:function value(el){this.object3D.remove(el.object3D)}},getChildEntities:{value:function value(){for(var children=this.children,childEntities=[],i=0,child;i<children.length;i++){child=children[i];if(babelHelpers.instanceof(child,AEntity)){childEntities.push(child)}}return childEntities}},initComponent:{value:function value(attrName,data,isDependency){var component,componentId,componentInfo,componentName,isComponentDefined;componentInfo=utils.split(attrName,MULTIPLE_COMPONENT_DELIMITER);componentId=componentInfo[1];componentName=componentInfo[0];if(!COMPONENTS[componentName]){return}isComponentDefined=checkComponentDefined(this,attrName)||data!==void 0;if(!isComponentDefined&&!isDependency){return}if(attrName in this.components){return}this.initComponentDependencies(componentName);if(componentId&&!COMPONENTS[componentName].multiple){throw new Error("Trying to initialize multiple "+"components of type `"+componentName+"`. There can only be one component of this type per entity.")}component=new COMPONENTS[componentName].Component(this,data,componentId);if(this.isPlaying){component.play()}if(!this.hasAttribute(attrName)){component.justInitialized=!0;window.HTMLElement.prototype.setAttribute.call(this,attrName,"")}debug("Component initialized: %s",attrName)},writable:window.debug},initComponentDependencies:{value:function value(name){var self=this,component=COMPONENTS[name],dependencies,i;if(!component){return}dependencies=COMPONENTS[name].dependencies;if(!dependencies){return}for(i=0;i<dependencies.length;i++){self.initComponent(dependencies[i],window.HTMLElement.prototype.getAttribute.call(self,dependencies[i])||void 0,!0)}}},removeComponent:{value:function value(name){var component=this.components[name];if(!component){return}if(!component.initialized){this.addEventListener("componentinitialized",function tryRemoveLater(evt){if(evt.detail.name!==name){return}this.removeComponent(name);this.removeEventListener("componentinitialized",tryRemoveLater)});return}component.pause();component.remove();delete this.components[name];this.emit("componentremoved",component.evtDetail)},writable:window.debug},updateComponents:{value:function value(){var data,extraComponents,i,name,componentsToUpdate=this.componentsToUpdate;if(!this.hasLoaded){return}for(i=0;i<this.mixinEls.length;i++){for(name in this.mixinEls[i].componentCache){if(isComponent(name)){componentsToUpdate[name]=!0}}}if(this.getExtraComponents){extraComponents=this.getExtraComponents();for(name in extraComponents){if(isComponent(name)){componentsToUpdate[name]=!0}}}for(i=0;i<this.attributes.length;++i){name=this.attributes[i].name;if(-1!==OBJECT3D_COMPONENTS.indexOf(name)){continue}if(isComponent(name)){componentsToUpdate[name]=!0}}for(i=0;i<OBJECT3D_COMPONENTS.length;i++){name=OBJECT3D_COMPONENTS[i];if(!this.hasAttribute(name)){continue}this.updateComponent(name,this.getDOMAttribute(name))}for(name in componentsToUpdate){data=mergeComponentData(this.getDOMAttribute(name),extraComponents&&extraComponents[name]);this.updateComponent(name,data);delete componentsToUpdate[name]}},writable:window.debug},updateComponent:{value:function value(attr,attrValue,clobber){var component=this.components[attr];if(component){if(null===attrValue&&!checkComponentDefined(this,attr)){this.removeComponent(attr);return}component.updateProperties(attrValue,clobber);return}this.initComponent(attr,attrValue,!1)}},removeAttribute:{value:function value(attr,propertyName){var component=this.components[attr];if(component&&propertyName===void 0){this.removeComponent(attr)}if(component&&propertyName!==void 0){component.resetProperty(propertyName);return}if("mixin"===attr){this.mixinUpdate("")}window.HTMLElement.prototype.removeAttribute.call(this,attr)}},play:{value:function value(){var entities,i,key;if(this.isPlaying||!this.hasLoaded){return}this.isPlaying=!0;for(key in this.components){this.components[key].play()}entities=this.getChildEntities();for(i=0;i<entities.length;i++){entities[i].play()}this.emit("play")},writable:!0},pause:{value:function value(){var entities,i,key;if(!this.isPlaying){return}this.isPlaying=!1;for(key in this.components){this.components[key].pause()}entities=this.getChildEntities();for(i=0;i<entities.length;i++){entities[i].pause()}this.emit("pause")},writable:!0},setEntityAttribute:{value:function value(attr,oldVal,newVal){if(COMPONENTS[attr]||this.components[attr]){this.updateComponent(attr,newVal);return}if("mixin"===attr){if(newVal===this.computedMixinStr){return}this.mixinUpdate(newVal,oldVal)}}},mixinUpdate:{value:function value(newMixins,oldMixins){oldMixins=oldMixins||this.getAttribute("mixin");this.updateMixins(newMixins,oldMixins);this.updateComponents()}},setAttribute:{value:function value(attrName,arg1,arg2){var newAttrValue,clobber,componentName,delimiterIndex,isDebugMode;delimiterIndex=attrName.indexOf(MULTIPLE_COMPONENT_DELIMITER);componentName=0<delimiterIndex?attrName.substring(0,delimiterIndex):attrName;if(!COMPONENTS[componentName]){if("mixin"===attrName){this.mixinUpdate(arg1)}ANode.prototype.setAttribute.call(this,attrName,arg1);return}if(!this.components[attrName]&&this.hasAttribute(attrName)){this.updateComponent(attrName,window.HTMLElement.prototype.getAttribute.call(this,attrName))}if("undefined"!==typeof arg2&&"string"===typeof arg1&&0<arg1.length&&"string"===typeof utils.styleParser.parse(arg1)){newAttrValue={};newAttrValue[arg1]=arg2;clobber=!1}else{newAttrValue=arg1;clobber=!0===arg2}this.updateComponent(attrName,newAttrValue,clobber);isDebugMode=this.sceneEl&&this.sceneEl.getAttribute("debug");if(isDebugMode){this.components[attrName].flushToDOM()}},writable:window.debug},flushToDOM:{value:function value(recursive){var components=this.components,child,children=this.children,i,key;for(key in components){components[key].flushToDOM()}if(!recursive){return}for(i=0;i<children.length;++i){child=children[i];if(!child.flushToDOM){continue}child.flushToDOM(recursive)}}},getAttribute:{value:function value(attr){var component;if("position"===attr){return this.object3D.position}if("rotation"===attr){return getRotation(this)}if("scale"===attr){return this.object3D.scale}if("visible"===attr){return this.object3D.visible}component=this.components[attr];if(component){return component.data}return window.HTMLElement.prototype.getAttribute.call(this,attr)},writable:window.debug},getDOMAttribute:{value:function value(attr){var component=this.components[attr];if(component){return component.attrValue}return window.HTMLElement.prototype.getAttribute.call(this,attr)},writable:window.debug},addState:{value:function value(state){if(this.is(state)){return}this.states.push(state);this.emit("stateadded",state)}},removeState:{value:function value(state){var stateIndex=this.states.indexOf(state);if(-1===stateIndex){return}this.states.splice(stateIndex,1);this.emit("stateremoved",state)}},is:{value:function value(state){return-1!==this.states.indexOf(state)}}});function checkComponentDefined(el,name){if(el.components[name]&&el.components[name].attrValue){return!0}return isComponentMixedIn(name,el.mixinEls)}function isComponentMixedIn(name,mixinEls){var i,inMixin=!1;for(i=0;i<mixinEls.length;++i){inMixin=mixinEls[i].hasAttribute(name);if(inMixin){break}}return inMixin}function mergeComponentData(attrValue,extraData){if(!extraData){return attrValue}if(extraData.constructor===Object){return utils.extend(extraData,utils.styleParser.parse(attrValue||{}))}return attrValue||extraData}function isComponent(componentName){if(-1!==componentName.indexOf(MULTIPLE_COMPONENT_DELIMITER)){componentName=utils.split(componentName,MULTIPLE_COMPONENT_DELIMITER)[0]}if(!COMPONENTS[componentName]){return!1}return!0}function getRotation(entityEl){var radToDeg=THREE.Math.radToDeg,rotation=entityEl.object3D.rotation,rotationObj=entityEl.rotationObj;rotationObj.x=radToDeg(rotation.x);rotationObj.y=radToDeg(rotation.y);rotationObj.z=radToDeg(rotation.z);return rotationObj}AEntity=registerElement("a-entity",{prototype:proto});module.exports=AEntity},{"../lib/three":150,"../utils/":172,"./a-node":100,"./a-register-element":101,"./component":102}],99:[function(_dereq_,module){var ANode=_dereq_("./a-node"),registerElement=_dereq_("./a-register-element").registerElement,components=_dereq_("./component").components,utils=_dereq_("../utils");module.exports=registerElement("a-mixin",{prototype:Object.create(ANode.prototype,{createdCallback:{value:function value(){this.componentCache={};this.id=this.getAttribute("id");this.isMixin=!0}},attributeChangedCallback:{value:function value(attr,oldVal,newVal){this.cacheAttribute(attr,newVal)}},attachedCallback:{value:function value(){this.sceneEl=this.closestScene();this.cacheAttributes();this.updateEntities();this.load()}},setAttribute:{value:function value(attr,_value2){window.HTMLElement.prototype.setAttribute.call(this,attr,_value2);this.cacheAttribute(attr,_value2)}},cacheAttribute:{value:function value(attr,_value3){var component,componentName;componentName=utils.split(attr,"__")[0];component=components[componentName];if(!component){return}if(_value3===void 0){_value3=window.HTMLElement.prototype.getAttribute.call(this,attr)}this.componentCache[attr]=component.parseAttrValueForCache(_value3)}},getAttribute:{value:function value(attr){return this.componentCache[attr]||window.HTMLElement.prototype.getAttribute.call(this,attr)}},cacheAttributes:{value:function value(){var attributes=this.attributes,attrName,i;for(i=0;i<attributes.length;i++){attrName=attributes[i].name;this.cacheAttribute(attrName)}}},updateEntities:{value:function value(){var entity,entities,i;if(!this.sceneEl){return}entities=this.sceneEl.querySelectorAll("[mixin~="+this.id+"]");for(i=0;i<entities.length;i++){entity=entities[i];if(!entity.hasLoaded||entity.isMixin){continue}entity.mixinUpdate(this.id)}}}})})},{"../utils":172,"./a-node":100,"./a-register-element":101,"./component":102}],100:[function(_dereq_,module){var registerElement=_dereq_("./a-register-element").registerElement,isNode=_dereq_("./a-register-element").isNode,utils=_dereq_("../utils/"),warn=utils.debug("core:a-node:warn"),MIXIN_OBSERVER_CONFIG={attributes:!0};module.exports=registerElement("a-node",{prototype:Object.create(window.HTMLElement.prototype,{createdCallback:{value:function value(){this.computedMixinStr="";this.hasLoaded=!1;this.isNode=!0;this.mixinEls=[];this.mixinObservers={}},writable:window.debug},attachedCallback:{value:function value(){var mixins;this.sceneEl=this.closestScene();if(!this.sceneEl){warn("You are attempting to attach <"+this.tagName+"> outside of an A-Frame "+"scene. Append this element to `<a-scene>` instead.")}this.hasLoaded=!1;this.emit("nodeready",void 0,!1);if(!this.isMixin){mixins=this.getAttribute("mixin");if(mixins){this.updateMixins(mixins)}}},writable:window.debug},attributeChangedCallback:{value:function value(attr,oldVal,newVal){if(newVal===this.computedMixinStr){return}if("mixin"===attr&&!this.isMixin){this.updateMixins(newVal,oldVal)}}},closestScene:{value:function(){var element=this;while(element){if(element.isScene){break}element=element.parentElement}return element}},closest:{value:function(selector){var matches=this.matches||this.mozMatchesSelector||this.msMatchesSelector||this.oMatchesSelector||this.webkitMatchesSelector,element=this;while(element){if(matches.call(element,selector)){break}element=element.parentElement}return element}},detachedCallback:{value:function value(){this.hasLoaded=!1}},load:{value:function value(cb,childFilter){var children,childrenLoaded,self=this;if(this.hasLoaded){return}childFilter=childFilter||isNode;children=this.getChildren();childrenLoaded=children.filter(childFilter).map(function(child){return new Promise(function(resolve){if(child.hasLoaded){return resolve()}child.addEventListener("loaded",resolve)})});Promise.all(childrenLoaded).then(function(){self.hasLoaded=!0;if(cb){cb()}self.emit("loaded",void 0,!1)})},writable:!0},getChildren:{value:function value(){return Array.prototype.slice.call(this.children,0)}},updateMixins:{value:function(){var newMixinIdArray=[],oldMixinIdArray=[];return function(newMixins,oldMixins){var i,newMixinIds,oldMixinIds;newMixinIdArray.length=0;oldMixinIdArray.length=0;newMixinIds=newMixins?utils.split(newMixins.trim(),/\s+/):newMixinIdArray;oldMixinIds=oldMixins?utils.split(oldMixins.trim(),/\s+/):oldMixinIdArray;for(i=0;i<oldMixinIds.length;i++){if(-1===newMixinIds.indexOf(oldMixinIds[i])){this.unregisterMixin(oldMixinIds[i])}}this.computedMixinStr="";this.mixinEls.length=0;for(i=0;i<newMixinIds.length;i++){this.registerMixin(document.getElementById(newMixinIds[i]))}if(this.computedMixinStr){this.computedMixinStr=this.computedMixinStr.trim();window.HTMLElement.prototype.setAttribute.call(this,"mixin",this.computedMixinStr)}}}()},registerMixin:{value:function value(mixinEl){var compositedMixinIds,i,mixin;if(!mixinEl){return}mixin=mixinEl.getAttribute("mixin");if(mixin){compositedMixinIds=utils.split(mixin.trim(),/\s+/);for(i=0;i<compositedMixinIds.length;i++){this.registerMixin(document.getElementById(compositedMixinIds[i]))}}this.computedMixinStr=this.computedMixinStr+" "+mixinEl.id;this.mixinEls.push(mixinEl);this.attachMixinListener(mixinEl)}},setAttribute:{value:function value(attr,newValue){if("mixin"===attr){this.updateMixins(newValue)}window.HTMLElement.prototype.setAttribute.call(this,attr,newValue)}},unregisterMixin:{value:function value(mixinId){var i,mixinEls=this.mixinEls,mixinEl;for(i=0;i<mixinEls.length;++i){mixinEl=mixinEls[i];if(mixinId===mixinEl.id){mixinEls.splice(i,1);break}}this.removeMixinListener(mixinId)}},removeMixinListener:{value:function value(mixinId){var observer=this.mixinObservers[mixinId];if(!observer){return}observer.disconnect();this.mixinObservers[mixinId]=null}},attachMixinListener:{value:function value(mixinEl){var currentObserver,mixinId,observer,self=this;if(!mixinEl){return}mixinId=mixinEl.id;currentObserver=this.mixinObservers[mixinId];if(currentObserver){return}observer=new MutationObserver(function(mutations){self.handleMixinUpdate(mutations[0].attributeName)});observer.observe(mixinEl,MIXIN_OBSERVER_CONFIG);this.mixinObservers[mixinId]=observer}},handleMixinUpdate:{value:function value(){}},emit:{value:function(){var data={};return function(name,detail,bubbles,extraData){if(bubbles===void 0){bubbles=!0}data.bubbles=!!bubbles;data.detail=detail;if(extraData){data=utils.extend({},extraData,data)}this.dispatchEvent(new CustomEvent(name,data))}}(),writable:window.debug}})})},{"../utils/":172,"./a-register-element":101}],101:[function(_dereq_,module){_dereq_("document-register-element");var ANode,AEntity,knownTags=module.exports.knownTags={};function addTagName(tagName){knownTags[tagName.toLowerCase()]=!0}module.exports.isNode=function(node){return node.tagName.toLowerCase()in knownTags||node.isNode};module.exports.registerElement=function(tagName,obj){var proto=Object.getPrototypeOf(obj.prototype),newObj=obj,isANode=ANode&&proto===ANode.prototype,isAEntity=AEntity&&proto===AEntity.prototype;if(isANode||isAEntity){addTagName(tagName)}if(isANode){newObj=wrapANodeMethods(obj.prototype);newObj={prototype:Object.create(proto,newObj)}}if(isAEntity){newObj=wrapAEntityMethods(obj.prototype);newObj={prototype:Object.create(proto,newObj)}}Object.getOwnPropertyNames(newObj.prototype).forEach(function(propName){var propVal=newObj.prototype[propName];if("function"===typeof propVal){propVal.displayName=propName}});return document.registerElement(tagName,newObj)};function wrapANodeMethods(obj){var newObj={};wrapMethods(newObj,["attachedCallback","attributeChangedCallback","createdCallback"],obj,ANode.prototype);copyProperties(obj,newObj);return newObj}function wrapAEntityMethods(obj){var newObj={};wrapMethods(newObj,["attachedCallback","attributeChangedCallback","createdCallback"],obj,ANode.prototype);wrapMethods(newObj,["attachedCallback","attributeChangedCallback","createdCallback","detachedCallback"],obj,AEntity.prototype);copyProperties(obj,newObj);return newObj}function wrapMethods(targetObj,methodList,derivedObj,baseObj){methodList.forEach(function(methodName){wrapMethod(targetObj,methodName,derivedObj,baseObj)})}module.exports.wrapMethods=wrapMethods;function wrapMethod(obj,methodName,derivedObj,baseObj){var derivedMethod=derivedObj[methodName],baseMethod=baseObj[methodName];if(!derivedMethod||!baseMethod){return}if(derivedMethod===baseMethod){return}obj[methodName]={value:function(){baseMethod.apply(this,arguments);return derivedMethod.apply(this,arguments)},writable:window.debug}}function copyProperties(source,destination){var props=Object.getOwnPropertyNames(source);props.forEach(function(prop){var desc;if(!destination[prop]){desc=Object.getOwnPropertyDescriptor(source,prop);destination[prop]={value:source[prop],writable:desc.writable}}})}ANode=_dereq_("./a-node");AEntity=_dereq_("./a-entity")},{"./a-entity":98,"./a-node":100,"document-register-element":11}],102:[function(_dereq_,module){var schema=_dereq_("./schema"),scenes=_dereq_("./scene/scenes"),systems=_dereq_("./system"),utils=_dereq_("../utils/"),components=module.exports.components={},parseProperties=schema.parseProperties,parseProperty=schema.parseProperty,processSchema=schema.process,isSingleProp=schema.isSingleProperty,stringifyProperties=schema.stringifyProperties,stringifyProperty=schema.stringifyProperty,styleParser=utils.styleParser,warn=utils.debug("core:component:warn"),aframeScript=document.currentScript,upperCaseRegExp=/[A-Z]+/,Component=module.exports.Component=function(el,attrValue,id){var self=this;this.el=el;this.id=id;this.attrName=this.name+(id?"__"+id:"");this.evtDetail={id:this.id,name:this.name};this.initialized=!1;this.el.components[this.attrName]=this;this.oldData=void 0;this.previousAttrValue=void 0;this.throttledEmitComponentChanged=utils.throttle(function(){el.emit("componentchanged",self.evtDetail,!1)},200);this.updateProperties(attrValue)};Component.prototype={schema:{},init:function init(){},update:function update(){},updateSchema:void 0,tick:void 0,tock:void 0,play:function play(){},pause:function pause(){},remove:function remove(){},parse:function parse(value,silent){var schema=this.schema;if(isSingleProp(schema)){return parseProperty(value,schema)}return parseProperties(styleParser.parse(value),schema,!0,this.name,silent)},stringify:function stringify(data){var schema=this.schema;if("string"===typeof data){return data}if(isSingleProp(schema)){return stringifyProperty(data,schema)}data=stringifyProperties(data,schema);return styleParser.stringify(data)},updateCachedAttrValue:function updateCachedAttrValue(value,clobber){var attrValue=this.parseAttrValueForCache(value),isSinglePropSchema=isSingleProp(this.schema),property;if(value===void 0){return}if(!isSinglePropSchema&&!clobber){this.attrValue=this.attrValue?cloneData(this.attrValue):{};for(property in attrValue){this.attrValue[property]=attrValue[property]}return}this.attrValue=attrValue},parseAttrValueForCache:function parseAttrValueForCache(value){var parsedValue;if("string"!==typeof value){return value}if(isSingleProp(this.schema)){parsedValue=this.schema.parse(value);if("string"===typeof parsedValue){parsedValue=value}}else{parsedValue=styleParser.parse(value)}return parsedValue},flushToDOM:function flushToDOM(isDefault){var attrValue=isDefault?this.data:this.attrValue;if(!attrValue){return}window.HTMLElement.prototype.setAttribute.call(this.el,this.attrName,this.stringify(attrValue))},updateProperties:function updateProperties(attrValue,clobber){var el=this.el,isSinglePropSchema,key,skipTypeChecking,oldData=this.oldData;if(!el.hasLoaded){this.updateCachedAttrValue(attrValue);return}isSinglePropSchema=isSingleProp(this.schema);skipTypeChecking=null!==attrValue&&"object"===babelHelpers.typeof(this.previousAttrValue)&&attrValue===this.previousAttrValue;if(skipTypeChecking){for(key in this.attrValue){if(!(key in attrValue)){skipTypeChecking=!1;break}}for(key in attrValue){if(!(key in this.attrValue)){skipTypeChecking=!1;break}}}this.previousAttrValue=attrValue;attrValue=this.parseAttrValueForCache(attrValue);this.updateCachedAttrValue(attrValue,clobber);if(this.updateSchema){this.updateSchema(this.buildData(this.attrValue,!1,!0))}this.data=this.buildData(this.attrValue,clobber,!1,skipTypeChecking);if(!this.initialized){if(el.initializingComponents[this.name]){return}el.initializingComponents[this.name]=!0;this.init();this.initialized=!0;delete el.initializingComponents[this.name];oldData=!isSinglePropSchema||"object"===babelHelpers.typeof(parseProperty(void 0,this.schema))?{}:void 0;this.oldData=extendProperties({},this.data,isSinglePropSchema);this.update(oldData);if(el.isPlaying){this.play()}el.emit("componentinitialized",this.evtDetail,!1)}else{if(utils.deepEqual(this.oldData,this.data)){return}this.oldData=extendProperties({},this.data,isSinglePropSchema);this.update(oldData);this.throttledEmitComponentChanged()}},resetProperty:function resetProperty(propertyName){if(isSingleProp(this.schema)){this.attrValue=void 0}else{if(!(propertyName in this.attrValue)){return}delete this.attrValue[propertyName]}this.updateProperties(this.attrValue)},extendSchema:function extendSchema(schemaAddon){var extendedSchema=utils.extend({},components[this.name].schema);utils.extend(extendedSchema,schemaAddon);this.schema=processSchema(extendedSchema);this.el.emit("schemachanged",{component:this.name})},buildData:function buildData(newData,clobber,silent,skipTypeChecking){var componentDefined,data,defaultValue,keys,keysLength,mixinData,schema=this.schema,i,isSinglePropSchema=isSingleProp(schema),mixinEls=this.el.mixinEls,previousData;componentDefined=newData&&newData.constructor===Array?newData.length:newData!==void 0&&null!==newData;if(isSinglePropSchema){data=isObjectOrArray(schema.default)?utils.clone(schema.default):schema.default}else{previousData=!clobber&&this.attrValue;data="object"===babelHelpers.typeof(previousData)?cloneData(previousData):{};for(i=0,keys=Object.keys(schema),keysLength=keys.length;i<keysLength;i++){defaultValue=schema[keys[i]].default;if(data[keys[i]]!==void 0){continue}data[keys[i]]=isObjectOrArray(defaultValue)?utils.clone(defaultValue):defaultValue}}for(i=0;i<mixinEls.length;i++){mixinData=mixinEls[i].getAttribute(this.attrName);if(mixinData){data=extendProperties(data,mixinData,isSinglePropSchema)}}if(componentDefined){if(isSinglePropSchema){if(!0===skipTypeChecking){return newData}return parseProperty(newData,schema)}data=extendProperties(data,newData,isSinglePropSchema)}else{if(!0===skipTypeChecking){return data}if(isSinglePropSchema){return parseProperty(data,schema)}}if(!0===skipTypeChecking){return data}return parseProperties(data,schema,void 0,this.name,silent)}};if(window.debug){var registrationOrderWarnings=module.exports.registrationOrderWarnings={}}module.exports.registerComponent=function(name,definition){var NewComponent,proto={};if(document.currentScript&&document.currentScript!==aframeScript){scenes.forEach(function(sceneEl){if(sceneEl.hasLoaded){return}if(document.currentScript.compareDocumentPosition(sceneEl)===Node.DOCUMENT_POSITION_FOLLOWING){return}warn("The component `"+name+"` was registered in a <script> tag after the scene. "+"Component <script> tags in an HTML file should be declared *before* the scene "+"such that the component is available to entities during scene initialization.");if(window.debug){registrationOrderWarnings[name]=!0}})}if(!0===upperCaseRegExp.test(name)){warn("The component name `"+name+"` contains uppercase characters, but "+"HTML will ignore the capitalization of attribute names. "+"Change the name to be lowercase: `"+name.toLowerCase()+"`")}if(-1!==name.indexOf("__")){throw new Error("The component name `"+name+"` is not allowed. "+"The sequence __ (double underscore) is reserved to specify an id"+" for multiple components of the same type")}Object.keys(definition).forEach(function(key){proto[key]={value:definition[key],writable:!0}});if(components[name]){throw new Error("The component `"+name+"` has been already registered. "+"Check that you are not loading two versions of the same component "+"or two different components of the same name.")}NewComponent=function(el,attr,id){Component.call(this,el,attr,id)};NewComponent.prototype=Object.create(Component.prototype,proto);NewComponent.prototype.name=name;NewComponent.prototype.constructor=NewComponent;NewComponent.prototype.system=systems&&systems.systems[name];NewComponent.prototype.play=wrapPlay(NewComponent.prototype.play);NewComponent.prototype.pause=wrapPause(NewComponent.prototype.pause);components[name]={Component:NewComponent,dependencies:NewComponent.prototype.dependencies,isSingleProp:isSingleProp(NewComponent.prototype.schema),multiple:NewComponent.prototype.multiple,parse:NewComponent.prototype.parse,parseAttrValueForCache:NewComponent.prototype.parseAttrValueForCache,schema:utils.extend(processSchema(NewComponent.prototype.schema,NewComponent.prototype.name)),stringify:NewComponent.prototype.stringify,type:NewComponent.prototype.type};return NewComponent};function cloneData(data){var clone={},parsedProperty,key;for(key in data){parsedProperty=data[key];clone[key]=isObjectOrArray(parsedProperty)?utils.clone(parsedProperty):parsedProperty}return clone}function extendProperties(dest,source,isSinglePropSchema){if(isSinglePropSchema&&(null===source||"object"!==babelHelpers.typeof(source))){return source}var copy=utils.extend(dest,source),key;for(key in copy){if(!copy[key]||copy[key].constructor!==Object){continue}copy[key]=utils.clone(copy[key])}return copy}function hasBehavior(component){return component.tick||component.tock}function wrapPause(pauseMethod){return function(){var sceneEl=this.el.sceneEl;if(!this.isPlaying){return}pauseMethod.call(this);this.isPlaying=!1;if(!hasBehavior(this)){return}sceneEl.removeBehavior(this)}}function wrapPlay(playMethod){return function(){var sceneEl=this.el.sceneEl,shouldPlay=this.el.isPlaying&&!this.isPlaying;if(!this.initialized||!shouldPlay){return}playMethod.call(this);this.isPlaying=!0;if(!hasBehavior(this)){return}sceneEl.addBehavior(this)}}function isObjectOrArray(value){return value&&(value.constructor===Object||value.constructor===Array)}},{"../utils/":172,"./scene/scenes":108,"./schema":110,"./system":112}],103:[function(_dereq_,module){var schema=_dereq_("./schema"),processSchema=schema.process,geometries=module.exports.geometries={},geometryNames=module.exports.geometryNames=[],THREE=_dereq_("../lib/three"),Geometry=module.exports.Geometry=function(){};Geometry.prototype={schema:{},init:function init(){this.geometry=new THREE.Geometry;return this.geometry},update:function update(){}};module.exports.registerGeometry=function(name,definition){var NewGeometry,proto={};Object.keys(definition).forEach(function(key){proto[key]={value:definition[key],writable:!0}});if(geometries[name]){throw new Error("The geometry `"+name+"` has been already registered")}NewGeometry=function(){Geometry.call(this)};NewGeometry.prototype=Object.create(Geometry.prototype,proto);NewGeometry.prototype.name=name;NewGeometry.prototype.constructor=NewGeometry;geometries[name]={Geometry:NewGeometry,schema:processSchema(NewGeometry.prototype.schema)};geometryNames.push(name);return NewGeometry}},{"../lib/three":150,"./schema":110}],104:[function(_dereq_,module){var coordinates=_dereq_("../utils/coordinates"),debug=_dereq_("debug"),error=debug("core:propertyTypes:warn"),warn=debug("core:propertyTypes:warn"),propertyTypes=module.exports.propertyTypes={},nonCharRegex=/[,> .[\]:]/;registerPropertyType("audio","",assetParse);registerPropertyType("array",[],function(value){if(Array.isArray(value)){return value}if(!value||"string"!==typeof value){return[]}return value.split(",").map(function(str){return str.trim()})},function(value){return value.join(", ")});registerPropertyType("asset","",assetParse);registerPropertyType("boolean",!1,function(value){return"false"!==value&&!1!==value});registerPropertyType("color","#FFF",defaultParse,defaultStringify);registerPropertyType("int",0,intParse);registerPropertyType("number",0,function(value){return parseFloat(value,10)});registerPropertyType("map","",assetParse);registerPropertyType("model","",assetParse);registerPropertyType("selector",null,function(value){if(!value){return null}if("string"!==typeof value){return value}if("#"===value[0]&&!nonCharRegex.test(value)){return document.getElementById(value.substring(1))}return document.querySelector(value)},function(value){if(value.getAttribute){return"#"+value.getAttribute("id")}return defaultStringify(value)});registerPropertyType("selectorAll",null,function(value){if(!value){return null}if("string"!==typeof value){return value}return Array.prototype.slice.call(document.querySelectorAll(value),0)},function(value){if(babelHelpers.instanceof(value,Array)){return value.map(function(element){return"#"+element.getAttribute("id")}).join(", ")}return defaultStringify(value)});registerPropertyType("src","",function(value){warn("`src` property type is deprecated. Use `asset` instead.");return assetParse(value)});registerPropertyType("string","",defaultParse,defaultStringify);registerPropertyType("time",0,intParse);registerPropertyType("vec2",{x:0,y:0},vecParse,coordinates.stringify);registerPropertyType("vec3",{x:0,y:0,z:0},vecParse,coordinates.stringify);registerPropertyType("vec4",{x:0,y:0,z:0,w:1},vecParse,coordinates.stringify);function registerPropertyType(type,defaultValue,parse,stringify){if("type"in propertyTypes){error("Property type "+type+" is already registered.");return}propertyTypes[type]={default:defaultValue,parse:parse||defaultParse,stringify:stringify||defaultStringify}}module.exports.registerPropertyType=registerPropertyType;function assetParse(value){var el,parsedUrl;if("string"!==typeof value){return value}parsedUrl=value.match(/\url\((.+)\)/);if(parsedUrl){return parsedUrl[1]}if("#"===value.charAt(0)){el=document.getElementById(value.substring(1));if(el){if("CANVAS"===el.tagName||"VIDEO"===el.tagName||"IMG"===el.tagName){return el}return el.getAttribute("src")}warn("\""+value+"\" asset not found.");return}return value}function defaultParse(value){return value}function defaultStringify(value){if(null===value){return"null"}return value.toString()}function intParse(value){return parseInt(value,10)}function vecParse(value){return coordinates.parse(value,this.default)}module.exports.isValidDefaultValue=function(type,defaultVal){if("audio"===type&&"string"!==typeof defaultVal){return!1}if("array"===type&&!Array.isArray(defaultVal)){return!1}if("asset"===type&&"string"!==typeof defaultVal){return!1}if("boolean"===type&&"boolean"!==typeof defaultVal){return!1}if("color"===type&&"string"!==typeof defaultVal){return!1}if("int"===type&&"number"!==typeof defaultVal){return!1}if("number"===type&&"number"!==typeof defaultVal){return!1}if("map"===type&&"string"!==typeof defaultVal){return!1}if("model"===type&&"string"!==typeof defaultVal){return!1}if("selector"===type&&"string"!==typeof defaultVal&&null!==defaultVal){return!1}if("selectorAll"===type&&"string"!==typeof defaultVal&&null!==defaultVal){return!1}if("src"===type&&"string"!==typeof defaultVal){return!1}if("string"===type&&"string"!==typeof defaultVal){return!1}if("time"===type&&"number"!==typeof defaultVal){return!1}if("vec2"===type){return isValidDefaultCoordinate(defaultVal,2)}if("vec3"===type){return isValidDefaultCoordinate(defaultVal,3)}if("vec4"===type){return isValidDefaultCoordinate(defaultVal,4)}return!0};function isValidDefaultCoordinate(possibleCoordinates,dimensions){if(null===possibleCoordinates){return!0}if("object"!==babelHelpers.typeof(possibleCoordinates)){return!1}if(Object.keys(possibleCoordinates).length!==dimensions){return!1}else{var x=possibleCoordinates.x,y=possibleCoordinates.y,z=possibleCoordinates.z,w=possibleCoordinates.w;if("number"!==typeof x||"number"!==typeof y){return!1}if(2<dimensions&&"number"!==typeof z){return!1}if(3<dimensions&&"number"!==typeof w){return!1}}return!0}module.exports.isValidDefaultCoordinate=isValidDefaultCoordinate},{"../utils/coordinates":167,debug:8}],105:[function(_dereq_,module){var initMetaTags=_dereq_("./metaTags").inject,initWakelock=_dereq_("./wakelock"),re=_dereq_("../a-register-element"),scenes=_dereq_("./scenes"),systems=_dereq_("../system").systems,THREE=_dereq_("../../lib/three"),TWEEN=_dereq_("@tweenjs/tween.js"),utils=_dereq_("../../utils/"),AEntity=_dereq_("../a-entity"),ANode=_dereq_("../a-node"),initPostMessageAPI=_dereq_("./postMessage"),bind=utils.bind,isIOS=utils.device.isIOS(),isMobile=utils.device.isMobile(),registerElement=re.registerElement,warn=utils.debug("core:a-scene:warn");module.exports.AScene=registerElement("a-scene",{prototype:Object.create(AEntity.prototype,{createdCallback:{value:function value(){this.isIOS=isIOS;this.isMobile=isMobile;this.isScene=!0;this.object3D=new THREE.Scene;var self=this;this.object3D.onAfterRender=function(renderer,scene,camera){if(self.isPlaying){self.tock(self.time,self.delta,camera)}};this.render=bind(this.render,this);this.systems={};this.systemNames=[];this.time=this.delta=0;this.init()}},init:{value:function value(){this.behaviors={tick:[],tock:[]};this.hasLoaded=!1;this.isPlaying=!1;this.originalHTML=this.innerHTML;this.renderTarget=null;setupCanvas(this);this.setupRenderer();this.resize();this.addFullScreenStyles();initPostMessageAPI(this);this.setAttribute("inspector","");this.setAttribute("keyboard-shortcuts","");this.setAttribute("screenshot","");this.setAttribute("vr-mode-ui","")},writable:!0},addFullScreenStyles:{value:function value(){var htmlEl=document.documentElement;htmlEl.classList.add("a-html");document.body.classList.add("a-body");this.classList.add("fullscreen")}},removeFullScreenStyles:{value:function value(){var htmlEl=document.documentElement;htmlEl.classList.remove("a-html");document.body.classList.remove("a-body");this.classList.remove("fullscreen")}},attachedCallback:{value:function value(){var resize,self=this;initMetaTags(this);initWakelock(this);this.initSystems();resize=bind(this.resize,this);window.addEventListener("load",resize);window.addEventListener("resize",function(){if(this.isIOS){setTimeout(resize,100)}else{resize()}});this.play();scenes.push(this);this.onVRPresentChangeBound=bind(this.onVRPresentChange,this);window.addEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound);this.enterVRBound=function(){self.enterVR()};this.exitVRBound=function(){self.exitVR()};this.exitVRTrueBound=function(){self.exitVR(!0)};this.pointerRestrictedBound=function(){self.pointerRestricted()};this.pointerUnrestrictedBound=function(){self.pointerUnrestricted()};window.addEventListener("vrdisplayactivate",this.enterVRBound);window.addEventListener("vrdisplaydeactivate",this.exitVRBound);window.addEventListener("vrdisplaydisconnect",this.exitVRTrueBound);window.addEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound);window.addEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)},writable:window.debug},initSystems:{value:function value(){Object.keys(systems).forEach(bind(this.initSystem,this))}},initSystem:{value:function value(name){if(this.systems[name]){return}this.systems[name]=new systems[name](this);this.systemNames.push(name)}},detachedCallback:{value:function value(){var sceneIndex=scenes.indexOf(this);scenes.splice(sceneIndex,1);window.removeEventListener("vrdisplaypresentchange",this.onVRPresentChangeBound);window.removeEventListener("vrdisplayactivate",this.enterVRBound);window.removeEventListener("vrdisplaydeactivate",this.exitVRBound);window.removeEventListener("vrdisplayconnect",this.enterVRBound);window.removeEventListener("vrdisplaydisconnect",this.exitVRTrueBound);window.removeEventListener("vrdisplaypointerrestricted",this.pointerRestrictedBound);window.removeEventListener("vrdisplaypointerunrestricted",this.pointerUnrestrictedBound)}},addBehavior:{value:function value(behavior){var behaviorArr,behaviors=this.behaviors,behaviorType;for(behaviorType in behaviors){if(!behavior[behaviorType]){continue}behaviorArr=this.behaviors[behaviorType];if(-1===behaviorArr.indexOf(behavior)){behaviorArr.push(behavior)}}}},getPointerLockElement:{value:function value(){return document.pointerLockElement},writable:window.debug},checkHeadsetConnected:{value:utils.device.checkHeadsetConnected,writable:window.debug},enterVR:{value:function value(fromExternal){var self=this,vrDisplay,vrManager=self.renderer.vr;if(this.is("vr-mode")){return Promise.resolve("Already in VR.")}if(!fromExternal&&(this.checkHeadsetConnected()||this.isMobile)){vrDisplay=utils.device.getVRDisplay();vrManager.setDevice(vrDisplay);vrManager.enabled=!0;return vrDisplay.requestPresent([{source:this.canvas}]).then(enterVRSuccess,enterVRFailure)}enterVRSuccess();return Promise.resolve();function enterVRSuccess(){self.addState("vr-mode");self.emit("enter-vr",{target:self});if(self.isMobile&&screen.orientation&&screen.orientation.lock){screen.orientation.lock("landscape")}self.addFullScreenStyles();if(!self.isMobile&&!self.checkHeadsetConnected()){requestFullscreen(self.canvas)}self.resize()}function enterVRFailure(err){if(err&&err.message){throw new Error("Failed to enter VR mode (`requestPresent`): "+err.message)}else{throw new Error("Failed to enter VR mode (`requestPresent`).")}}},writable:!0},exitVR:{value:function value(fromExternal){var self=this,vrDisplay;if(!this.is("vr-mode")){return Promise.resolve("Not in VR.")}exitFullscreen();if(!fromExternal&&(this.checkHeadsetConnected()||this.isMobile)){this.renderer.vr.enabled=!1;vrDisplay=utils.device.getVRDisplay();return vrDisplay.exitPresent().then(exitVRSuccess,exitVRFailure)}exitVRSuccess();return Promise.resolve();function exitVRSuccess(){self.removeState("vr-mode");if(self.isMobile&&screen.orientation&&screen.orientation.unlock){screen.orientation.unlock()}if(self.hasAttribute("embedded")){self.removeFullScreenStyles()}self.resize();if(self.isIOS){utils.forceCanvasResizeSafariMobile(this.canvas)}self.emit("exit-vr",{target:self})}function exitVRFailure(err){if(err&&err.message){throw new Error("Failed to exit VR mode (`exitPresent`): "+err.message)}else{throw new Error("Failed to exit VR mode (`exitPresent`).")}}},writable:!0},pointerRestricted:{value:function value(){if(this.canvas){var pointerLockElement=this.getPointerLockElement();if(pointerLockElement&&pointerLockElement!==this.canvas&&document.exitPointerLock){document.exitPointerLock()}if(this.canvas.requestPointerLock){this.canvas.requestPointerLock()}}}},pointerUnrestricted:{value:function value(){var pointerLockElement=this.getPointerLockElement();if(pointerLockElement&&pointerLockElement===this.canvas&&document.exitPointerLock){document.exitPointerLock()}}},onVRPresentChange:{value:function value(evt){var display=evt.display||evt.detail.display;if(display.isPresenting){this.enterVR(!0);return}this.exitVR(!0)}},getAttribute:{value:function value(attr){var system=this.systems[attr];if(system){return system.data}return AEntity.prototype.getAttribute.call(this,attr)}},getComputedAttribute:{value:function value(attr){warn("`getComputedAttribute` is deprecated. Use `getAttribute` instead.");this.getAttribute(attr)}},getDOMAttribute:{value:function value(attr){var system=this.systems[attr];if(system){return system.data}return AEntity.prototype.getDOMAttribute.call(this,attr)}},setAttribute:{value:function value(attr,_value4,componentPropValue){var system=this.systems[attr];if(system){ANode.prototype.setAttribute.call(this,attr,_value4);system.updateProperties(_value4);return}AEntity.prototype.setAttribute.call(this,attr,_value4,componentPropValue)}},removeBehavior:{value:function value(behavior){var behaviorArr,behaviorType,behaviors=this.behaviors,index;for(behaviorType in behaviors){if(!behavior[behaviorType]){continue}behaviorArr=this.behaviors[behaviorType];index=behaviorArr.indexOf(behavior);if(-1!==index){behaviorArr.splice(index,1)}}}},resize:{value:function value(){var camera=this.camera,canvas=this.canvas,embedded=this.getAttribute("embedded")&&!this.is("vr-mode"),size,vrDevice,isVRPresenting;vrDevice=this.renderer.vr.getDevice();isVRPresenting=this.renderer.vr.enabled&&vrDevice&&vrDevice.isPresenting;if(!camera||!canvas||this.is("vr-mode")&&(this.isMobile||isVRPresenting)){return}size=getCanvasSize(canvas,embedded);camera.aspect=size.width/size.height;camera.updateProjectionMatrix();this.renderer.setSize(size.width,size.height,!1)},writable:!0},setupRenderer:{value:function value(){var self=this,renderer,rendererAttr,rendererAttrString,rendererConfig={canvas:this.canvas,antialias:!isMobile,alpha:!0};if(this.hasAttribute("antialias")){rendererConfig.antialias="true"===this.getAttribute("antialias")}if(this.hasAttribute("renderer")){rendererAttrString=this.getAttribute("renderer");rendererAttr=utils.styleParser.parse(rendererAttrString);if(rendererAttr.antialias&&"auto"!==rendererAttr.antialias){rendererConfig.antialias="true"===rendererAttr.antialias}}renderer=this.renderer=new THREE.WebGLRenderer(rendererConfig);renderer.setPixelRatio(window.devicePixelRatio);renderer.sortObjects=!1;this.addEventListener("camera-set-active",function(){renderer.vr.setPoseTarget(self.camera.el.object3D)})},writable:window.debug},play:{value:function value(){var self=this;if(this.renderStarted){AEntity.prototype.play.call(this);return}this.addEventListener("loaded",function(){AEntity.prototype.play.call(this);if(this.camera){startRender(this);return}this.addEventListener("camera-set-active",function(){startRender(this)});function startRender(sceneEl){if(sceneEl.renderStarted){return}sceneEl.resize();if(sceneEl.renderer){if(window.performance){window.performance.mark("render-started")}sceneEl.clock=new THREE.Clock;sceneEl.render();sceneEl.renderStarted=!0;sceneEl.emit("renderstart")}}});setTimeout(function(){AEntity.prototype.load.call(self)})}},updateComponent:{value:function value(componentName){if(componentName in systems){return}AEntity.prototype.updateComponent.apply(this,arguments)}},tick:{value:function value(time,timeDelta){var i,systems=this.systems;TWEEN.update();for(i=0;i<this.behaviors.tick.length;i++){if(!this.behaviors.tick[i].el.isPlaying){continue}this.behaviors.tick[i].tick(time,timeDelta)}for(i=0;i<this.systemNames.length;i++){if(!systems[this.systemNames[i]].tick){continue}systems[this.systemNames[i]].tick(time,timeDelta)}}},tock:{value:function value(time,timeDelta,camera){var i,systems=this.systems;for(i=0;i<this.behaviors.tock.length;i++){if(!this.behaviors.tock[i].el.isPlaying){continue}this.behaviors.tock[i].tock(time,timeDelta,camera)}for(i=0;i<this.systemNames.length;i++){if(!systems[this.systemNames[i]].tock){continue}systems[this.systemNames[i]].tock(time,timeDelta,camera)}}},render:{value:function value(){this.delta=1e3*this.clock.getDelta();var renderer=this.renderer;this.time=1e3*this.clock.elapsedTime;if(this.isPlaying){this.tick(this.time,this.delta)}renderer.animate(this.render);renderer.render(this.object3D,this.camera,this.renderTarget)},writable:!0}})});function getCanvasSize(canvasEl,embedded){if(embedded){return{height:canvasEl.parentElement.offsetHeight,width:canvasEl.parentElement.offsetWidth}}return{height:window.innerHeight,width:window.innerWidth}}function requestFullscreen(canvas){var requestFullscreen=canvas.requestFullscreen||canvas.webkitRequestFullscreen||canvas.mozRequestFullScreen||canvas.msRequestFullscreen;requestFullscreen.apply(canvas)}function exitFullscreen(){if(document.exitFullscreen){document.exitFullscreen()}else if(document.mozCancelFullScreen){document.mozCancelFullScreen()}else if(document.webkitExitFullscreen){document.webkitExitFullscreen()}}function setupCanvas(sceneEl){var canvasEl=document.createElement("canvas");canvasEl.classList.add("a-canvas");canvasEl.dataset.aframeCanvas=!0;sceneEl.appendChild(canvasEl);document.addEventListener("fullscreenchange",onFullScreenChange);document.addEventListener("mozfullscreenchange",onFullScreenChange);document.addEventListener("webkitfullscreenchange",onFullScreenChange);canvasEl.addEventListener("touchmove",function(event){event.preventDefault()});sceneEl.canvas=canvasEl;sceneEl.emit("render-target-loaded",{target:canvasEl});setTimeout(bind(sceneEl.resize,sceneEl),0);function onFullScreenChange(){var fullscreenEl=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;if(!fullscreenEl){sceneEl.exitVR()}document.activeElement.blur();document.body.focus()}}module.exports.setupCanvas=setupCanvas},{"../../lib/three":150,"../../utils/":172,"../a-entity":98,"../a-node":100,"../a-register-element":101,"../system":112,"./metaTags":106,"./postMessage":107,"./scenes":108,"./wakelock":109,"@tweenjs/tween.js":1}],106:[function(_dereq_,module){var constants=_dereq_("../../constants/"),extend=_dereq_("../../utils").extend,MOBILE_HEAD_TAGS=module.exports.MOBILE_HEAD_TAGS=[Meta({name:"viewport",content:"width=device-width,initial-scale=1,maximum-scale=1,shrink-to-fit=no,user-scalable=no,minimal-ui"}),Meta({name:"mobile-web-app-capable",content:"yes"}),Meta({name:"theme-color",content:"black"})],MOBILE_IOS_HEAD_TAGS=[Meta({name:"apple-mobile-web-app-capable",content:"yes"}),Meta({name:"apple-mobile-web-app-status-bar-style",content:"black"}),function(attrs){return{tagName:"link",attributes:attrs,exists:function exists(){return document.querySelector("link[rel=\""+attrs.rel+"\"]")}}}({rel:"apple-touch-icon",href:"https://aframe.io/images/aframe-logo-152.png"})];function Meta(attrs){return{tagName:"meta",attributes:attrs,exists:function exists(){return document.querySelector("meta[name=\""+attrs.name+"\"]")}}}module.exports.inject=function(scene){var headEl=document.head,headScriptEl=headEl.querySelector("script"),tag,headTags=[];MOBILE_HEAD_TAGS.forEach(createAndInjectTag);if(scene.isIOS){MOBILE_IOS_HEAD_TAGS.forEach(createAndInjectTag)}return headTags;function createAndInjectTag(tagObj){if(!tagObj||tagObj.exists()){return}tag=createTag(tagObj);if(!tag){return}if(headScriptEl){headScriptEl.parentNode.insertBefore(tag,headScriptEl)}else{headEl.appendChild(tag)}headTags.push(tag)}};function createTag(tagObj){if(!tagObj||!tagObj.tagName){return}var meta=document.createElement(tagObj.tagName);meta.setAttribute(constants.AFRAME_INJECTED,"");return extend(meta,tagObj.attributes)}},{"../../constants/":93,"../../utils":172}],107:[function(_dereq_,module){var bind=_dereq_("../../utils/bind"),isIframed=_dereq_("../../utils/").isIframed;module.exports=function(scene){if(!isIframed()){return}window.addEventListener("message",bind(postMessageAPIHandler,scene))};function postMessageAPIHandler(event){var scene=this;if(!event.data){return}switch(event.data.type){case"vr":{switch(event.data.data){case"enter":scene.enterVR();break;case"exit":scene.exitVR();break;}}}}},{"../../utils/":172,"../../utils/bind":166}],108:[function(_dereq_,module){module.exports=[]},{}],109:[function(_dereq_,module){var Wakelock=_dereq_("../../../vendor/wakelock/wakelock");module.exports=function(scene){if(!scene.isMobile){return}var wakelock=scene.wakelock=new Wakelock;scene.addEventListener("enter-vr",function(){wakelock.request()});scene.addEventListener("exit-vr",function(){wakelock.release()})}},{"../../../vendor/wakelock/wakelock":182}],110:[function(_dereq_,module){var utils=_dereq_("../utils/"),PropertyTypes=_dereq_("./propertyTypes"),debug=utils.debug,isValidDefaultValue=PropertyTypes.isValidDefaultValue,propertyTypes=PropertyTypes.propertyTypes,warn=debug("core:schema:warn");function isSingleProperty(schema){if("type"in schema){return"string"===typeof schema.type}return"default"in schema}module.exports.isSingleProperty=isSingleProperty;module.exports.process=function(schema,componentName){if(isSingleProperty(schema)){return processPropertyDefinition(schema,componentName)}for(var propName in schema){schema[propName]=processPropertyDefinition(schema[propName],componentName)}return schema};function processPropertyDefinition(propDefinition,componentName){var defaultVal=propDefinition.default,isCustomType,propType,typeName=propDefinition.type;if(!propDefinition.type){if(defaultVal!==void 0&&("boolean"===typeof defaultVal||"number"===typeof defaultVal)){typeName=babelHelpers.typeof(defaultVal)}else if(Array.isArray(defaultVal)){typeName="array"}else{typeName="string"}}else if("bool"===propDefinition.type){typeName="boolean"}else if("float"===propDefinition.type){typeName="number"}propType=propertyTypes[typeName];if(!propType){warn("Unknown property type for component `"+componentName+"`: "+typeName)}isCustomType=!!propDefinition.parse;propDefinition.parse=propDefinition.parse||propType.parse;propDefinition.stringify=propDefinition.stringify||propType.stringify;propDefinition.type=typeName;if("default"in propDefinition){if(!isCustomType&&!isValidDefaultValue(typeName,defaultVal)){warn("Default value `"+defaultVal+"` does not match type `"+typeName+"` in component `"+componentName+"`")}}else{propDefinition.default=propType.default}return propDefinition}module.exports.processPropertyDefinition=processPropertyDefinition;module.exports.parseProperties=function(){var propNames=[];return function(propData,schema,getPartialData,componentName,silent){var i,propName,propDefinition,propValue;propNames.length=0;for(propName in getPartialData?propData:schema){propNames.push(propName)}if(null===propData||"object"!==babelHelpers.typeof(propData)){return propData}for(propName in propData){if(!schema[propName]&&!silent){warn("Unknown property `"+propName+"` for component/system `"+componentName+"`.")}}for(i=0;i<propNames.length;i++){propName=propNames[i];propDefinition=schema[propName];propValue=propData[propName];if(!schema[propName]){return}propData[propName]=parseProperty(propValue,propDefinition)}return propData}}();function parseProperty(value,propDefinition){if(value===void 0||null===value||""===value){value=propDefinition.default;if(Array.isArray(value)){value=value.slice()}}return propDefinition.parse(value,propDefinition.default)}module.exports.parseProperty=parseProperty;module.exports.stringifyProperties=function(propData,schema){var propName,propDefinition,propValue,stringifiedData={},value;for(propName in propData){propDefinition=schema[propName];propValue=propData[propName];value=propValue;if("object"===babelHelpers.typeof(value)){value=stringifyProperty(propValue,propDefinition);if(!propDefinition){warn("Unknown component property: "+propName)}}stringifiedData[propName]=value}return stringifiedData};function stringifyProperty(value,propDefinition){if("object"!==babelHelpers.typeof(value)){return value}if(!propDefinition||null===value){return JSON.stringify(value)}return propDefinition.stringify(value)}module.exports.stringifyProperty=stringifyProperty},{"../utils/":172,"./propertyTypes":104}],111:[function(_dereq_,module){var schema=_dereq_("./schema"),processSchema=schema.process,shaders=module.exports.shaders={},shaderNames=module.exports.shaderNames=[],THREE=_dereq_("../lib/three"),utils=_dereq_("../utils"),propertyToThreeMapping={array:"v3",color:"v3",int:"i",number:"f",map:"t",time:"f",vec2:"v2",vec3:"v3",vec4:"v4"},Shader=module.exports.Shader=function(){};Shader.prototype={schema:{},vertexShader:"void main() {"+"gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);"+"}",fragmentShader:"void main() {"+"gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);"+"}",init:function init(data){this.attributes=this.initVariables(data,"attribute");this.uniforms=this.initVariables(data,"uniform");this.material=new(this.raw?THREE.RawShaderMaterial:THREE.ShaderMaterial)({uniforms:this.uniforms,vertexShader:this.vertexShader,fragmentShader:this.fragmentShader});return this.material},initVariables:function initVariables(data,type){var key,schema=this.schema,variables={},varType;for(key in schema){if(schema[key].is!==type){continue}varType=propertyToThreeMapping[schema[key].type];variables[key]={type:varType,value:void 0}}return variables},update:function update(data){this.updateVariables(data,"attribute");this.updateVariables(data,"uniform")},updateVariables:function updateVariables(data,type){var key,materialKey,schema=this.schema,variables;variables="uniform"===type?this.uniforms:this.attributes;for(key in data){if(!schema[key]||schema[key].is!==type){continue}if("map"===schema[key].type){if(!variables[key]||variables[key].value===data[key]){continue}materialKey="_texture_"+key;this.setMapOnTextureLoad(variables,key,materialKey);utils.material.updateMapMaterialFromData(materialKey,key,this,data);continue}variables[key].value=this.parseValue(schema[key].type,data[key]);variables[key].needsUpdate=!0}},parseValue:function parseValue(type,value){var color;switch(type){case"vec2":{return new THREE.Vector2(value.x,value.y)}case"vec3":{return new THREE.Vector3(value.x,value.y,value.z)}case"vec4":{return new THREE.Vector4(value.x,value.y,value.z,value.w)}case"color":{color=new THREE.Color(value);return new THREE.Vector3(color.r,color.g,color.b)}case"map":{return THREE.ImageUtils.loadTexture(value)}default:{return value}}},setMapOnTextureLoad:function setMapOnTextureLoad(variables,key,materialKey){var self=this;this.el.addEventListener("materialtextureloaded",function(){variables[key].value=self.material[materialKey];variables[key].needsUpdate=!0})}};module.exports.registerShader=function(name,definition){var NewShader,proto={};Object.keys(definition).forEach(function(key){proto[key]={value:definition[key],writable:!0}});if(shaders[name]){throw new Error("The shader "+name+" has been already registered")}NewShader=function(){Shader.call(this)};NewShader.prototype=Object.create(Shader.prototype,proto);NewShader.prototype.name=name;NewShader.prototype.constructor=NewShader;shaders[name]={Shader:NewShader,schema:processSchema(NewShader.prototype.schema)};shaderNames.push(name);return NewShader}},{"../lib/three":150,"../utils":172,"./schema":110}],112:[function(_dereq_,module){var components=_dereq_("./component"),schema=_dereq_("./schema"),utils=_dereq_("../utils/"),parseProperties=schema.parseProperties,parseProperty=schema.parseProperty,processSchema=schema.process,isSingleProp=schema.isSingleProperty,styleParser=utils.styleParser,systems=module.exports.systems={},System=module.exports.System=function(sceneEl){var component=components&&components.components[this.name];this.el=sceneEl;this.sceneEl=sceneEl;if(component){component.Component.prototype.system=this}this.buildData();this.init();this.update({})};System.prototype={schema:{},init:function init(){},update:function update(){},updateProperties:function updateProperties(rawData){var oldData=this.data;if(!Object.keys(schema).length){return}this.buildData(rawData);this.update(oldData)},buildData:function buildData(rawData){var schema=this.schema;if(!Object.keys(schema).length){return}rawData=rawData||window.HTMLElement.prototype.getAttribute.call(this.sceneEl,this.name);if(isSingleProp(schema)){this.data=parseProperty(rawData,schema)}else{this.data=parseProperties(styleParser.parse(rawData)||{},schema)}},tick:void 0,tock:void 0,play:function play(){},pause:function pause(){}};module.exports.registerSystem=function(name,definition){var i,NewSystem,proto={},scenes=utils.findAllScenes(document);Object.keys(definition).forEach(function(key){proto[key]={value:definition[key],writable:!0}});if(systems[name]){throw new Error("The system `"+name+"` has been already registered. "+"Check that you are not loading two versions of the same system "+"or two different systems of the same name.")}NewSystem=function(sceneEl){System.call(this,sceneEl)};NewSystem.prototype=Object.create(System.prototype,proto);NewSystem.prototype.name=name;NewSystem.prototype.constructor=NewSystem;NewSystem.prototype.schema=utils.extend(processSchema(NewSystem.prototype.schema));systems[name]=NewSystem;for(i=0;i<scenes.length;i++){scenes[i].initSystem(name)}}},{"../utils/":172,"./component":102,"./schema":110}],113:[function(_dereq_){_dereq_("./pivot")},{"./pivot":114}],114:[function(_dereq_){var registerComponent=_dereq_("../../core/component").registerComponent,THREE=_dereq_("../../lib/three"),originalPosition=new THREE.Vector3,originalRotation=new THREE.Vector3;registerComponent("pivot",{dependencies:["position"],schema:{type:"vec3"},init:function init(){var data=this.data,el=this.el,originalParent=el.object3D.parent,originalGroup=el.object3D,outerGroup=new THREE.Group;originalPosition.copy(originalGroup.position);originalRotation.copy(originalGroup.rotation);originalParent.remove(originalGroup);outerGroup.add(originalGroup);originalParent.add(outerGroup);el.object3D=outerGroup;originalGroup.position.set(-1*data.x,-1*data.y,-1*data.z);outerGroup.position.set(data.x+originalPosition.x,data.y+originalPosition.y,data.z+originalPosition.z);outerGroup.rotation.copy(originalGroup.rotation);originalGroup.rotation.set(0,0,0)}})},{"../../core/component":102,"../../lib/three":150}],115:[function(_dereq_,module){var components=_dereq_("../../core/component").components,shaders=_dereq_("../../core/shader").shaders,utils=_dereq_("../../utils/"),materialMappings={};Object.keys(components.material.schema).forEach(addMapping);Object.keys(shaders.standard.schema).forEach(addMapping);function addMapping(prop){var htmlAttrName=prop.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();if("fog"===prop){htmlAttrName="material-fog"}if("visible"===prop){htmlAttrName="material-visible"}materialMappings[htmlAttrName]="material."+prop}module.exports=function(){return{defaultComponents:{material:{}},mappings:utils.extend({},materialMappings)}}},{"../../core/component":102,"../../core/shader":111,"../../utils/":172}],116:[function(_dereq_){_dereq_("./primitives/a-camera");_dereq_("./primitives/a-collada-model");_dereq_("./primitives/a-cursor");_dereq_("./primitives/a-curvedimage");_dereq_("./primitives/a-gltf-model");_dereq_("./primitives/a-image");_dereq_("./primitives/a-light");_dereq_("./primitives/a-link");_dereq_("./primitives/a-obj-model");_dereq_("./primitives/a-sky");_dereq_("./primitives/a-sound");_dereq_("./primitives/a-text");_dereq_("./primitives/a-video");_dereq_("./primitives/a-videosphere");_dereq_("./primitives/meshPrimitives")},{"./primitives/a-camera":118,"./primitives/a-collada-model":119,"./primitives/a-cursor":120,"./primitives/a-curvedimage":121,"./primitives/a-gltf-model":122,"./primitives/a-image":123,"./primitives/a-light":124,"./primitives/a-link":125,"./primitives/a-obj-model":126,"./primitives/a-sky":127,"./primitives/a-sound":128,"./primitives/a-text":129,"./primitives/a-video":130,"./primitives/a-videosphere":131,"./primitives/meshPrimitives":132}],117:[function(_dereq_,module){var AEntity=_dereq_("../../core/a-entity"),components=_dereq_("../../core/component").components,registerElement=_dereq_("../../core/a-register-element").registerElement,utils=_dereq_("../../utils/"),debug=utils.debug,setComponentProperty=utils.entity.setComponentProperty,log=debug("extras:primitives:debug"),warn=debug("extras:primitives:warn"),primitives=module.exports.primitives={};module.exports.registerPrimitive=function(name,definition){name=name.toLowerCase();log("Registering <%s>",name);if(definition.defaultAttributes){warn("The 'defaultAttributes' object is deprecated. Use 'defaultComponents' instead.")}var primitive=registerElement(name,{prototype:Object.create(AEntity.prototype,{defaultComponentsFromPrimitive:{value:definition.defaultComponents||definition.defaultAttributes||{}},deprecated:{value:definition.deprecated||null},deprecatedMappings:{value:definition.deprecatedMappings||{}},mappings:{value:definition.mappings||{}},createdCallback:{value:function value(){if(definition.deprecated){console.warn(definition.deprecated)}this.resolveMappingCollisions()}},resolveMappingCollisions:{value:function value(){var mappings=this.mappings,self=this;Object.keys(mappings).forEach(function(key){var newAttribute;if(key!==key.toLowerCase()){warn("Mapping keys should be specified in lower case. The mapping key "+key+" may not be recognized")}if(components[key]){newAttribute=mappings[key].replace(".","-");mappings[newAttribute]=mappings[key];delete mappings[key];console.warn("The primitive "+self.tagName.toLowerCase()+" has a mapping collision. "+"The attribute "+key+" has the same name as a registered component and"+" has been renamed to "+newAttribute)}})}},getExtraComponents:{value:function value(){var attr,data,i,mapping,mixins,path,self=this;data=utils.clone(this.defaultComponentsFromPrimitive);mixins=this.getAttribute("mixin");if(mixins){mixins=mixins.trim().split(" ");mixins.forEach(function(mixinId){var mixinComponents=self.sceneEl.querySelector("#"+mixinId).componentCache;Object.keys(mixinComponents).forEach(function(name){data[name]=extend(data[name],mixinComponents[name])})})}for(i=0;i<this.attributes.length;i++){attr=this.attributes[i];mapping=this.mappings[attr.name];if(mapping){path=utils.entity.getComponentPropertyPath(mapping);if(path.constructor===Array){data[path[0]]=data[path[0]]||{};data[path[0]][path[1]]=attr.value.trim()}else{data[path]=attr.value.trim()}continue}}return data;function extend(base,extension){if(isUndefined(base)){return copy(extension)}if(isUndefined(extension)){return copy(base)}if(isPureObject(base)&&isPureObject(extension)){return utils.extendDeep(base,extension)}return copy(extension)}function isUndefined(value){return"undefined"===typeof value}function copy(value){if(isPureObject(value)){return utils.extendDeep({},value)}return value}function isPureObject(value){return null!==value&&value.constructor===Object}}},attributeChangedCallback:{value:function value(attr,oldVal,_value5){var componentName=this.mappings[attr];if(attr in this.deprecatedMappings){console.warn(this.deprecatedMappings[attr])}if(!attr||!componentName){return}setComponentProperty(this,componentName,_value5)}}})});primitives[name]=primitive;return primitive};function addComponentMapping(componentName,mappings){var schema=components[componentName].schema;Object.keys(schema).map(function(prop){var attrName=prop.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();if(mappings[attrName]!==void 0){attrName=componentName+"-"+prop}mappings[attrName]=componentName+"."+prop})}module.exports.definePrimitive=function(tagName,defaultComponents,mappings){mappings=mappings||{};Object.keys(defaultComponents).map(function(componentName){addComponentMapping(componentName,mappings)});module.exports.registerPrimitive(tagName,utils.extendDeep({},null,{defaultComponents:defaultComponents,mappings:mappings}))}},{"../../core/a-entity":98,"../../core/a-register-element":101,"../../core/component":102,"../../utils/":172}],118:[function(_dereq_){var registerPrimitive=_dereq_("../primitives").registerPrimitive;registerPrimitive("a-camera",{defaultComponents:{camera:{},"look-controls":{},"wasd-controls":{},position:{y:1.6}},mappings:{active:"camera.active",far:"camera.far",fov:"camera.fov","look-controls-enabled":"look-controls.enabled",near:"camera.near","pointer-lock-enabled":"look-controls.pointerLockEnabled","wasd-controls-enabled":"wasd-controls.enabled","reverse-mouse-drag":"look-controls.reverseMouseDrag",zoom:"camera.zoom"}})},{"../primitives":117}],119:[function(_dereq_){var registerPrimitive=_dereq_("../primitives").registerPrimitive;registerPrimitive("a-collada-model",{mappings:{src:"collada-model"}})},{"../primitives":117}],120:[function(_dereq_){var getMeshMixin=_dereq_("../getMeshMixin"),registerPrimitive=_dereq_("../primitives").registerPrimitive,utils=_dereq_("../../../utils/");registerPrimitive("a-cursor",utils.extendDeep({},getMeshMixin(),{defaultComponents:{cursor:{},geometry:{primitive:"ring",radiusOuter:.016,radiusInner:.01,segmentsTheta:32},material:{color:"#000",shader:"flat",opacity:.8},position:{x:0,y:0,z:-1}},mappings:{far:"raycaster.far",fuse:"cursor.fuse","fuse-timeout":"cursor.fuseTimeout",interval:"raycaster.interval",objects:"raycaster.objects"}}))},{"../../../utils/":172,"../getMeshMixin":115,"../primitives":117}],121:[function(_dereq_){var getMeshMixin=_dereq_("../getMeshMixin"),registerPrimitive=_dereq_("../primitives").registerPrimitive,utils=_dereq_("../../../utils/");registerPrimitive("a-curvedimage",utils.extendDeep({},getMeshMixin(),{defaultComponents:{geometry:{height:1,primitive:"cylinder",radius:2,segmentsRadial:48,thetaLength:270,openEnded:!0,thetaStart:0},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0,repeat:"-1 1"}},mappings:{height:"geometry.height","open-ended":"geometry.openEnded",radius:"geometry.radius",segments:"geometry.segmentsRadial",start:"geometry.thetaStart","theta-length":"geometry.thetaLength","theta-start":"geometry.thetaStart",width:"geometry.thetaLength"}}))},{"../../../utils/":172,"../getMeshMixin":115,"../primitives":117}],122:[function(_dereq_){var registerPrimitive=_dereq_("../primitives").registerPrimitive;registerPrimitive("a-gltf-model",{mappings:{src:"gltf-model"}})},{"../primitives":117}],123:[function(_dereq_){var getMeshMixin=_dereq_("../getMeshMixin"),registerPrimitive=_dereq_("../primitives").registerPrimitive,utils=_dereq_("../../../utils/");registerPrimitive("a-image",utils.extendDeep({},getMeshMixin(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},{"../../../utils/":172,"../getMeshMixin":115,"../primitives":117}],124:[function(_dereq_){var registerPrimitive=_dereq_("../primitives").registerPrimitive;registerPrimitive("a-light",{defaultComponents:{light:{}},mappings:{angle:"light.angle",color:"light.color","ground-color":"light.groundColor",decay:"light.decay",distance:"light.distance",intensity:"light.intensity",penumbra:"light.penumbra",type:"light.type",target:"light.target"}})},{"../primitives":117}],125:[function(_dereq_){var registerPrimitive=_dereq_("../primitives").registerPrimitive;registerPrimitive("a-link",{defaultComponents:{},mappings:{href:"link.href",image:"link.image",title:"link.title"}})},{"../primitives":117}],126:[function(_dereq_){var meshMixin=_dereq_("../getMeshMixin")(),registerPrimitive=_dereq_("../primitives").registerPrimitive,utils=_dereq_("../../../utils/");registerPrimitive("a-obj-model",utils.extendDeep({},meshMixin,{defaultComponents:{"obj-model":{}},mappings:{src:"obj-model.obj",mtl:"obj-model.mtl"}}))},{"../../../utils/":172,"../getMeshMixin":115,"../primitives":117}],127:[function(_dereq_){var getMeshMixin=_dereq_("../getMeshMixin"),registerPrimitive=_dereq_("../primitives").registerPrimitive,utils=_dereq_("../../../utils/"),meshPrimitives=_dereq_("./meshPrimitives");registerPrimitive("a-sky",utils.extendDeep({},getMeshMixin(),{defaultComponents:{geometry:{primitive:"sphere",radius:5e3,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",side:"back",shader:"flat",npot:!0},scale:"-1 1 1"},mappings:utils.extendDeep({},meshPrimitives["a-sphere"].prototype.mappings)}))},{"../../../utils/":172,"../getMeshMixin":115,"../primitives":117,"./meshPrimitives":132}],128:[function(_dereq_){var registerPrimitive=_dereq_("../primitives").registerPrimitive;registerPrimitive("a-sound",{defaultComponents:{sound:{}},mappings:{src:"sound.src",on:"sound.on",autoplay:"sound.autoplay",loop:"sound.loop",volume:"sound.volume"}})},{"../primitives":117}],129:[function(_dereq_){var definePrimitive=_dereq_("../primitives").definePrimitive;definePrimitive("a-text",{text:{anchor:"align",width:5}})},{"../primitives":117}],130:[function(_dereq_){var getMeshMixin=_dereq_("../getMeshMixin"),registerPrimitive=_dereq_("../primitives").registerPrimitive,utils=_dereq_("../../../utils/");registerPrimitive("a-video",utils.extendDeep({},getMeshMixin(),{defaultComponents:{geometry:{primitive:"plane"},material:{color:"#FFF",shader:"flat",side:"double",transparent:!0}},mappings:{height:"geometry.height",width:"geometry.width"}}))},{"../../../utils/":172,"../getMeshMixin":115,"../primitives":117}],131:[function(_dereq_){var getMeshMixin=_dereq_("../getMeshMixin"),registerPrimitive=_dereq_("../primitives").registerPrimitive,utils=_dereq_("../../../utils/");registerPrimitive("a-videosphere",utils.extendDeep({},getMeshMixin(),{defaultComponents:{geometry:{primitive:"sphere",radius:5e3,segmentsWidth:64,segmentsHeight:32},material:{color:"#FFF",shader:"flat",side:"back",npot:!0},scale:"-1 1 1"},mappings:{radius:"geometry.radius","segments-height":"geometry.segmentsHeight","segments-width":"geometry.segmentsWidth"}}))},{"../../../utils/":172,"../getMeshMixin":115,"../primitives":117}],132:[function(_dereq_,module){var getMeshMixin=_dereq_("../getMeshMixin"),geometries=_dereq_("../../../core/geometry").geometries,geometryNames=_dereq_("../../../core/geometry").geometryNames,registerPrimitive=_dereq_("../primitives").registerPrimitive,utils=_dereq_("../../../utils/"),meshPrimitives=module.exports={};geometryNames.forEach(function(geometryName){var geometry=geometries[geometryName],geometryHyphened=unCamelCase(geometryName),mappings={};Object.keys(geometry.schema).forEach(function(property){mappings[unCamelCase(property)]="geometry."+property});var tagName="a-"+geometryHyphened,primitive=registerPrimitive(tagName,utils.extendDeep({},getMeshMixin(),{defaultComponents:{geometry:{primitive:geometryName}},mappings:mappings}));meshPrimitives[tagName]=primitive});function unCamelCase(str){return str.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}},{"../../../core/geometry":103,"../../../utils/":172,"../getMeshMixin":115,"../primitives":117}],133:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three");registerGeometry("box",{schema:{depth:{default:1,min:0},height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"},segmentsDepth:{default:1,min:1,max:20,type:"int"}},init:function init(data){this.geometry=new THREE.BoxGeometry(data.width,data.height,data.depth,data.segmentsWidth,data.segmentsHeight,data.segmentsDepth)}})},{"../core/geometry":103,"../lib/three":150}],134:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three"),degToRad=THREE.Math.degToRad;registerGeometry("circle",{schema:{radius:{default:1,min:0},segments:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function init(data){this.geometry=new THREE.CircleGeometry(data.radius,data.segments,degToRad(data.thetaStart),degToRad(data.thetaLength))}})},{"../core/geometry":103,"../lib/three":150}],135:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three"),degToRad=THREE.Math.degToRad;registerGeometry("cone",{schema:{height:{default:1,min:0},openEnded:{default:!1},radiusBottom:{default:1,min:0},radiusTop:{default:.01,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function init(data){this.geometry=new THREE.CylinderGeometry(data.radiusTop,data.radiusBottom,data.height,data.segmentsRadial,data.segmentsHeight,data.openEnded,degToRad(data.thetaStart),degToRad(data.thetaLength))}})},{"../core/geometry":103,"../lib/three":150}],136:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three"),degToRad=THREE.Math.degToRad;registerGeometry("cylinder",{schema:{height:{default:1,min:0},openEnded:{default:!1},radius:{default:1,min:0},segmentsHeight:{default:18,min:1,type:"int"},segmentsRadial:{default:36,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function init(data){this.geometry=new THREE.CylinderGeometry(data.radius,data.radius,data.height,data.segmentsRadial,data.segmentsHeight,data.openEnded,degToRad(data.thetaStart),degToRad(data.thetaLength))}})},{"../core/geometry":103,"../lib/three":150}],137:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three");registerGeometry("dodecahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function init(data){this.geometry=new THREE.DodecahedronGeometry(data.radius,data.detail)}})},{"../core/geometry":103,"../lib/three":150}],138:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three");registerGeometry("icosahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function init(data){this.geometry=new THREE.IcosahedronGeometry(data.radius,data.detail)}})},{"../core/geometry":103,"../lib/three":150}],139:[function(_dereq_){_dereq_("./box.js");_dereq_("./circle.js");_dereq_("./cone.js");_dereq_("./cylinder.js");_dereq_("./dodecahedron.js");_dereq_("./icosahedron.js");_dereq_("./octahedron.js");_dereq_("./plane.js");_dereq_("./ring.js");_dereq_("./sphere.js");_dereq_("./tetrahedron.js");_dereq_("./torus.js");_dereq_("./torusKnot.js");_dereq_("./triangle.js")},{"./box.js":133,"./circle.js":134,"./cone.js":135,"./cylinder.js":136,"./dodecahedron.js":137,"./icosahedron.js":138,"./octahedron.js":140,"./plane.js":141,"./ring.js":142,"./sphere.js":143,"./tetrahedron.js":144,"./torus.js":145,"./torusKnot.js":146,"./triangle.js":147}],140:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three");registerGeometry("octahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function init(data){this.geometry=new THREE.OctahedronGeometry(data.radius,data.detail)}})},{"../core/geometry":103,"../lib/three":150}],141:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three");registerGeometry("plane",{schema:{height:{default:1,min:0},width:{default:1,min:0},segmentsHeight:{default:1,min:1,max:20,type:"int"},segmentsWidth:{default:1,min:1,max:20,type:"int"}},init:function init(data){this.geometry=new THREE.PlaneGeometry(data.width,data.height,data.segmentsWidth,data.segmentsHeight)}})},{"../core/geometry":103,"../lib/three":150}],142:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three"),degToRad=THREE.Math.degToRad;registerGeometry("ring",{schema:{radiusInner:{default:.8,min:0},radiusOuter:{default:1.2,min:0},segmentsPhi:{default:10,min:1,type:"int"},segmentsTheta:{default:32,min:3,type:"int"},thetaLength:{default:360,min:0},thetaStart:{default:0}},init:function init(data){this.geometry=new THREE.RingGeometry(data.radiusInner,data.radiusOuter,data.segmentsTheta,data.segmentsPhi,degToRad(data.thetaStart),degToRad(data.thetaLength))}})},{"../core/geometry":103,"../lib/three":150}],143:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three"),degToRad=THREE.Math.degToRad;registerGeometry("sphere",{schema:{radius:{default:1,min:0},phiLength:{default:360},phiStart:{default:0,min:0},thetaLength:{default:180,min:0},thetaStart:{default:0},segmentsHeight:{default:18,min:2,type:"int"},segmentsWidth:{default:36,min:3,type:"int"}},init:function init(data){this.geometry=new THREE.SphereGeometry(data.radius,data.segmentsWidth,data.segmentsHeight,degToRad(data.phiStart),degToRad(data.phiLength),degToRad(data.thetaStart),degToRad(data.thetaLength))}})},{"../core/geometry":103,"../lib/three":150}],144:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three");registerGeometry("tetrahedron",{schema:{detail:{default:0,min:0,max:5,type:"int"},radius:{default:1,min:0}},init:function init(data){this.geometry=new THREE.TetrahedronGeometry(data.radius,data.detail)}})},{"../core/geometry":103,"../lib/three":150}],145:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three"),degToRad=THREE.Math.degToRad;registerGeometry("torus",{schema:{arc:{default:360},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:36,min:2,type:"int"},segmentsTubular:{default:32,min:3,type:"int"}},init:function init(data){this.geometry=new THREE.TorusGeometry(data.radius,2*data.radiusTubular,data.segmentsRadial,data.segmentsTubular,degToRad(data.arc))}})},{"../core/geometry":103,"../lib/three":150}],146:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three");registerGeometry("torusKnot",{schema:{p:{default:2,min:1},q:{default:3,min:1},radius:{default:1,min:0},radiusTubular:{default:.2,min:0},segmentsRadial:{default:8,min:3,type:"int"},segmentsTubular:{default:100,min:3,type:"int"}},init:function init(data){this.geometry=new THREE.TorusKnotGeometry(data.radius,2*data.radiusTubular,data.segmentsTubular,data.segmentsRadial,data.p,data.q)}})},{"../core/geometry":103,"../lib/three":150}],147:[function(_dereq_){var registerGeometry=_dereq_("../core/geometry").registerGeometry,THREE=_dereq_("../lib/three"),quaternion=new THREE.Quaternion,rotateVector=new THREE.Vector3(0,0,1),uvMinVector=new THREE.Vector2,uvMaxVector=new THREE.Vector2,uvScaleVector=new THREE.Vector2;registerGeometry("triangle",{schema:{vertexA:{type:"vec3",default:{x:0,y:.5,z:0}},vertexB:{type:"vec3",default:{x:-.5,y:-.5,z:0}},vertexC:{type:"vec3",default:{x:.5,y:-.5,z:0}}},init:function init(data){var geometry,normal,triangle,uvA,uvB,uvC;triangle=new THREE.Triangle;triangle.a.set(data.vertexA.x,data.vertexA.y,data.vertexA.z);triangle.b.set(data.vertexB.x,data.vertexB.y,data.vertexB.z);triangle.c.set(data.vertexC.x,data.vertexC.y,data.vertexC.z);normal=triangle.normal();quaternion.setFromUnitVectors(normal,rotateVector);uvA=triangle.a.clone().applyQuaternion(quaternion);uvB=triangle.b.clone().applyQuaternion(quaternion);uvC=triangle.c.clone().applyQuaternion(quaternion);uvMinVector.set(_Mathmin(uvA.x,uvB.x,uvC.x),_Mathmin(uvA.y,uvB.y,uvC.y));uvMaxVector.set(_Mathmax(uvA.x,uvB.x,uvC.x),_Mathmax(uvA.y,uvB.y,uvC.y));uvScaleVector.set(0,0).subVectors(uvMaxVector,uvMinVector);uvA=new THREE.Vector2().subVectors(uvA,uvMinVector).divide(uvScaleVector);uvB=new THREE.Vector2().subVectors(uvB,uvMinVector).divide(uvScaleVector);uvC=new THREE.Vector2().subVectors(uvC,uvMinVector).divide(uvScaleVector);geometry=this.geometry=new THREE.Geometry;geometry.vertices.push(triangle.a);geometry.vertices.push(triangle.b);geometry.vertices.push(triangle.c);geometry.faces.push(new THREE.Face3(0,1,2,normal));geometry.faceVertexUvs[0]=[[uvA,uvB,uvC]]}})},{"../core/geometry":103,"../lib/three":150}],148:[function(_dereq_,module){window.hasNativeWebVRImplementation=!!window.navigator.getVRDisplays||!!window.navigator.getVRDevices;var WebVRPolyfill=_dereq_("webvr-polyfill");window.webvrpolyfill=new WebVRPolyfill({BUFFER_SCALE:1,CARDBOARD_UI_DISABLED:!0,ROTATE_INSTRUCTIONS_DISABLED:!0});var utils=_dereq_("./utils/"),debug=utils.debug,error=debug("A-Frame:error"),warn=debug("A-Frame:warn");if(window.document.currentScript&&window.document.currentScript.parentNode!==window.document.head&&!window.debug){warn("Put the A-Frame <script> tag in the <head> of the HTML *before* the scene to "+"ensure everything for A-Frame is properly registered before they are used from "+"HTML.")}if("file:"===window.location.protocol){error("This HTML file is currently being served via the file:// protocol. "+"Assets, textures, and models WILL NOT WORK due to cross-origin policy! "+"Please use a local or hosted server: "+"https://aframe.io/docs/0.5.0/introduction/getting-started.html#using-a-local-server.")}window.Promise=window.Promise||_dereq_("promise-polyfill");if(utils.device.isIOSOlderThan10(window.navigator.userAgent)){window.WebVRConfig.BUFFER_SCALE=1/window.devicePixelRatio}_dereq_("present");if(utils.device.isBrowserEnvironment){_dereq_("./style/aframe.css");_dereq_("./style/rStats.css")}var AScene=_dereq_("./core/scene/a-scene").AScene,components=_dereq_("./core/component").components,registerComponent=_dereq_("./core/component").registerComponent,registerGeometry=_dereq_("./core/geometry").registerGeometry,registerPrimitive=_dereq_("./extras/primitives/primitives").registerPrimitive,registerShader=_dereq_("./core/shader").registerShader,registerSystem=_dereq_("./core/system").registerSystem,shaders=_dereq_("./core/shader").shaders,systems=_dereq_("./core/system").systems,THREE=window.THREE=_dereq_("./lib/three"),TWEEN=window.TWEEN=_dereq_("@tweenjs/tween.js"),pkg=_dereq_("../package");_dereq_("./components/index");_dereq_("./geometries/index");_dereq_("./shaders/index");_dereq_("./systems/index");var ANode=_dereq_("./core/a-node"),AEntity=_dereq_("./core/a-entity");_dereq_("./core/a-animation");_dereq_("./core/a-assets");_dereq_("./core/a-cubemap");_dereq_("./core/a-mixin");_dereq_("./extras/components/");_dereq_("./extras/primitives/");console.log("A-Frame Version: 0.8.2 (Date 2018-04-15, Commit #b20527f)");console.log("three Version:",pkg.dependencies.three);console.log("WebVR Polyfill Version:",pkg.dependencies["webvr-polyfill"]);module.exports=window.AFRAME={AComponent:_dereq_("./core/component").Component,AEntity:AEntity,ANode:ANode,AScene:AScene,components:components,geometries:_dereq_("./core/geometry").geometries,registerComponent:registerComponent,registerElement:_dereq_("./core/a-register-element").registerElement,registerGeometry:registerGeometry,registerPrimitive:registerPrimitive,registerShader:registerShader,registerSystem:registerSystem,primitives:{getMeshMixin:_dereq_("./extras/primitives/getMeshMixin"),primitives:_dereq_("./extras/primitives/primitives").primitives},scenes:_dereq_("./core/scene/scenes"),schema:_dereq_("./core/schema"),shaders:shaders,systems:systems,THREE:THREE,TWEEN:TWEEN,utils:utils,version:pkg.version}},{"../package":51,"./components/index":60,"./core/a-animation":95,"./core/a-assets":96,"./core/a-cubemap":97,"./core/a-entity":98,"./core/a-mixin":99,"./core/a-node":100,"./core/a-register-element":101,"./core/component":102,"./core/geometry":103,"./core/scene/a-scene":105,"./core/scene/scenes":108,"./core/schema":110,"./core/shader":111,"./core/system":112,"./extras/components/":113,"./extras/primitives/":116,"./extras/primitives/getMeshMixin":115,"./extras/primitives/primitives":117,"./geometries/index":139,"./lib/three":150,"./shaders/index":152,"./style/aframe.css":157,"./style/rStats.css":158,"./systems/index":161,"./utils/":172,"@tweenjs/tween.js":1,present:31,"promise-polyfill":33,"webvr-polyfill":46}],149:[function(_dereq_,module){window.aframeStats=function(scene){var _rS=null;function _update(){_rS("te").set(getEntityCount());if(window.performance.getEntriesByName){_rS("lt").set(window.performance.getEntriesByName("render-started")[0].startTime.toFixed(0))}}function getEntityCount(){var elements=scene.querySelectorAll("*");Array.prototype.slice.call(elements).filter(function(el){return el.isEntity});return elements.length}return{update:_update,start:function(){},end:function(){},attach:function(r){_rS=r},values:{te:{caption:"Entities"},lt:{caption:"Load Time"}},groups:[{caption:"A-Frame",values:["te","lt"]}],fractions:[]}};if("object"===babelHelpers.typeof(module)){module.exports={aframeStats:window.aframeStats}}},{}],150:[function(_dereq_,module){(function(global){var THREE=global.THREE=_dereq_("three");if(THREE.TextureLoader){THREE.TextureLoader.prototype.crossOrigin="anonymous"}if(THREE.ImageLoader){THREE.ImageLoader.prototype.crossOrigin="anonymous"}if(THREE.Cache){THREE.Cache.enabled=!0}_dereq_("three/examples/js/loaders/GLTFLoader");_dereq_("three/examples/js/loaders/OBJLoader");_dereq_("three/examples/js/loaders/MTLLoader");_dereq_("three/examples/js/loaders/ColladaLoader");THREE.ColladaLoader.prototype.crossOrigin="anonymous";THREE.GLTFLoader.prototype.crossOrigin="anonymous";THREE.MTLLoader.prototype.crossOrigin="anonymous";THREE.OBJLoader.prototype.crossOrigin="anonymous";module.exports=THREE}).call(this,"undefined"!==typeof global?global:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{})},{three:40,"three/examples/js/loaders/ColladaLoader":41,"three/examples/js/loaders/GLTFLoader":42,"three/examples/js/loaders/MTLLoader":43,"three/examples/js/loaders/OBJLoader":44}],151:[function(_dereq_,module){var registerShader=_dereq_("../core/shader").registerShader,THREE=_dereq_("../lib/three"),utils=_dereq_("../utils/");module.exports.Shader=registerShader("flat",{schema:{color:{type:"color"},fog:{default:!0},height:{default:256},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function init(data){this.textureSrc=null;this.material=new THREE.MeshBasicMaterial(getMaterialData(data));utils.material.updateMap(this,data)},update:function update(data){this.updateMaterial(data);utils.material.updateMap(this,data)},updateMaterial:function updateMaterial(data){var material=this.material;data=getMaterialData(data);Object.keys(data).forEach(function(key){material[key]=data[key]})}});function getMaterialData(data){return{fog:data.fog,color:new THREE.Color(data.color),wireframe:data.wireframe,wireframeLinewidth:data.wireframeLinewidth}}},{"../core/shader":111,"../lib/three":150,"../utils/":172}],152:[function(_dereq_){_dereq_("./flat");_dereq_("./standard");_dereq_("./sdf");_dereq_("./msdf");_dereq_("./ios10hls")},{"./flat":151,"./ios10hls":153,"./msdf":154,"./sdf":155,"./standard":156}],153:[function(_dereq_,module){var registerShader=_dereq_("../core/shader").registerShader;module.exports.Shader=registerShader("ios10hls",{schema:{src:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},vertexShader:["varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),fragmentShader:["uniform sampler2D src;","uniform float opacity;","varying vec2 vUV;","void main() {","  vec2 offset = vec2(0, 0);","  vec2 repeat = vec2(1, 1);","  vec4 color = texture2D(src, vec2(vUV.x / repeat.x + offset.x, (1.0 - vUV.y) / repeat.y + offset.y)).bgra;","  gl_FragColor = vec4(color.rgb, opacity);","}"].join("\n")})},{"../core/shader":111}],154:[function(_dereq_,module){var registerShader=_dereq_("../core/shader").registerShader;module.exports.Shader=registerShader("msdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},negate:{type:"boolean",is:"uniform",default:!0},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:["attribute vec2 uv;","attribute vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),fragmentShader:["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives: enable","#endif","precision highp float;","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","#define ALL_SMOOTH 0.4","#define ALL_ROUGH 0.02","#define DISCARD_ALPHA (alphaTest / (2.2 - 1.2 * ratio))","uniform sampler2D map;","uniform vec3 color;","uniform float opacity;","uniform float alphaTest;","uniform bool negate;","varying vec2 vUV;","float median(float r, float g, float b) {","  return max(min(r, g), min(max(r, g), b));","}","void main() {","  vec3 sample = texture2D(map, vUV).rgb;","  if (negate) {","    sample = 1.0 - sample;","  }","  float sigDist = median(sample.r, sample.g, sample.b) - 0.5;","  float alpha = clamp(sigDist/fwidth(sigDist) + 0.5, 0.0, 1.0);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(vUV) + dFdy(vUV));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * (sigDist + 0.5);","  }","  if (isBigEnough <= BIG_ENOUGH && alpha < alphaTest) { discard; return; }","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","  gl_FragColor = vec4(color.xyz, alpha * opacity);","}"].join("\n")})},{"../core/shader":111}],155:[function(_dereq_,module){var registerShader=_dereq_("../core/shader").registerShader;module.exports.Shader=registerShader("sdf",{schema:{alphaTest:{type:"number",is:"uniform",default:.5},color:{type:"color",is:"uniform",default:"white"},map:{type:"map",is:"uniform"},opacity:{type:"number",is:"uniform",default:1}},raw:!0,vertexShader:["attribute vec2 uv;","attribute vec3 position;","uniform mat4 projectionMatrix;","uniform mat4 modelViewMatrix;","varying vec2 vUV;","void main(void) {","  gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);","  vUV = uv;","}"].join("\n"),fragmentShader:["#ifdef GL_OES_standard_derivatives","#extension GL_OES_standard_derivatives: enable","#endif","precision highp float;","#define BIG_ENOUGH 0.001","#define MODIFIED_ALPHATEST (0.02 * isBigEnough / BIG_ENOUGH)","#define ALL_SMOOTH 0.4","#define ALL_ROUGH 0.02","#define DISCARD_ALPHA (alphaTest / (2.2 - 1.2 * ratio))","uniform sampler2D map;","uniform vec3 color;","uniform float opacity;","uniform float alphaTest;","varying vec2 vUV;","#ifdef GL_OES_standard_derivatives","float contour(float width, float value) {","  return smoothstep(0.5 - value, 0.5 + value, width);","}","#else","float aastep(float value, float afwidth) {","  return smoothstep(0.5 - afwidth, 0.5 + afwidth, value);","}","#endif","void main() {","#ifdef GL_OES_standard_derivatives","  vec2 uv = vUV;","  vec4 texColor = texture2D(map, uv);","  float dist = texColor.a;","  float width = fwidth(dist);","  float alpha = contour(dist, width);","  float dscale = 0.353505;","  vec2 duv = dscale * (dFdx(uv) + dFdy(uv));","  float isBigEnough = max(abs(duv.x), abs(duv.y));","  if (isBigEnough > BIG_ENOUGH) {","    float ratio = BIG_ENOUGH / isBigEnough;","    alpha = ratio * alpha + (1.0 - ratio) * dist;","  }","  else if (isBigEnough <= BIG_ENOUGH) {","    vec4 box = vec4 (uv - duv, uv + duv);","    alpha = (alpha + 0.5 * (","      contour(texture2D(map, box.xy).a, width)","      + contour(texture2D(map, box.zw).a, width)","      + contour(texture2D(map, box.xw).a, width)","      + contour(texture2D(map, box.zy).a, width)","    )) / 3.0;","  }","  if (isBigEnough <= BIG_ENOUGH && alpha < alphaTest) { discard; return; }","  if (alpha < alphaTest * MODIFIED_ALPHATEST) { discard; return; }","#else","  vec4 texColor = texture2D(map, vUV);","  float value = texColor.a;","  float afwidth = (1.0 / 32.0) * (1.4142135623730951 / (2.0 * gl_FragCoord.w));","  float alpha = aastep(value, afwidth);","  float ratio = (gl_FragCoord.w >= ALL_SMOOTH) ? 1.0 : (gl_FragCoord.w < ALL_ROUGH) ? 0.0 : (gl_FragCoord.w - ALL_ROUGH) / (ALL_SMOOTH - ALL_ROUGH);","  if (alpha < alphaTest) { if (ratio >= 1.0) { discard; return; } alpha = 0.0; }","  alpha = alpha * ratio + (1.0 - ratio) * value;","  if (ratio < 1.0)","    if (alpha <= DISCARD_ALPHA) { discard; return; }","#endif","  gl_FragColor = vec4(color, opacity * alpha);","}"].join("\n")})},{"../core/shader":111}],156:[function(_dereq_,module){var registerShader=_dereq_("../core/shader").registerShader,THREE=_dereq_("../lib/three"),utils=_dereq_("../utils/"),CubeLoader=new THREE.CubeTextureLoader,texturePromises={};module.exports.Shader=registerShader("standard",{schema:{ambientOcclusionMap:{type:"map"},ambientOcclusionMapIntensity:{default:1},ambientOcclusionTextureOffset:{type:"vec2"},ambientOcclusionTextureRepeat:{type:"vec2",default:{x:1,y:1}},color:{type:"color"},displacementMap:{type:"map"},displacementScale:{default:1},displacementBias:{default:.5},displacementTextureOffset:{type:"vec2"},displacementTextureRepeat:{type:"vec2",default:{x:1,y:1}},emissive:{type:"color",default:"#000"},emissiveIntensity:{default:1},envMap:{default:""},fog:{default:!0},height:{default:256},metalness:{default:0,min:0,max:1},metalnessMap:{type:"map"},metalnessTextureOffset:{type:"vec2"},metalnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},normalMap:{type:"map"},normalScale:{type:"vec2",default:{x:1,y:1}},normalTextureOffset:{type:"vec2"},normalTextureRepeat:{type:"vec2",default:{x:1,y:1}},offset:{type:"vec2",default:{x:0,y:0}},repeat:{type:"vec2",default:{x:1,y:1}},roughness:{default:.5,min:0,max:1},roughnessMap:{type:"map"},roughnessTextureOffset:{type:"vec2"},roughnessTextureRepeat:{type:"vec2",default:{x:1,y:1}},sphericalEnvMap:{type:"map"},src:{type:"map"},width:{default:512},wireframe:{default:!1},wireframeLinewidth:{default:2}},init:function init(data){this.material=new THREE.MeshStandardMaterial(getMaterialData(data));utils.material.updateMap(this,data);if(data.normalMap){utils.material.updateDistortionMap("normal",this,data)}if(data.displacementMap){utils.material.updateDistortionMap("displacement",this,data)}if(data.ambientOcclusionMap){utils.material.updateDistortionMap("ambientOcclusion",this,data)}if(data.metalnessMap){utils.material.updateDistortionMap("metalness",this,data)}if(data.roughnessMap){utils.material.updateDistortionMap("roughness",this,data)}this.updateEnvMap(data)},update:function update(data){this.updateMaterial(data);utils.material.updateMap(this,data);if(data.normalMap){utils.material.updateDistortionMap("normal",this,data)}if(data.displacementMap){utils.material.updateDistortionMap("displacement",this,data)}if(data.ambientOcclusionMap){utils.material.updateDistortionMap("ambientOcclusion",this,data)}if(data.metalnessMap){utils.material.updateDistortionMap("metalness",this,data)}if(data.roughnessMap){utils.material.updateDistortionMap("roughness",this,data)}this.updateEnvMap(data)},updateMaterial:function updateMaterial(data){var material=this.material;data=getMaterialData(data);Object.keys(data).forEach(function(key){material[key]=data[key]})},updateEnvMap:function updateEnvMap(data){var self=this,material=this.material,envMap=data.envMap,sphericalEnvMap=data.sphericalEnvMap;if(!envMap&&!sphericalEnvMap||this.isLoadingEnvMap){material.envMap=null;material.needsUpdate=!0;return}this.isLoadingEnvMap=!0;if(sphericalEnvMap){this.el.sceneEl.systems.material.loadTexture(sphericalEnvMap,{src:sphericalEnvMap},function(texture){self.isLoadingEnvMap=!1;texture.mapping=THREE.SphericalReflectionMapping;material.envMap=texture;utils.material.handleTextureEvents(self.el,texture);material.needsUpdate=!0});return}if(texturePromises[envMap]){texturePromises[envMap].then(function(cube){self.isLoadingEnvMap=!1;material.envMap=cube;utils.material.handleTextureEvents(self.el,cube);material.needsUpdate=!0});return}texturePromises[envMap]=new Promise(function(resolve){utils.srcLoader.validateCubemapSrc(envMap,function(urls){CubeLoader.load(urls,function(cube){self.isLoadingEnvMap=!1;material.envMap=cube;utils.material.handleTextureEvents(self.el,cube);resolve(cube)})})})}});function getMaterialData(data){var newData={color:new THREE.Color(data.color),emissive:new THREE.Color(data.emissive),emissiveIntensity:data.emissiveIntensity,fog:data.fog,metalness:data.metalness,roughness:data.roughness,wireframe:data.wireframe,wireframeLinewidth:data.wireframeLinewidth};if(data.normalMap){newData.normalScale=data.normalScale}if(data.ambientOcclusionMap){newData.aoMapIntensity=data.ambientOcclusionMapIntensity}if(data.displacementMap){newData.displacementScale=data.displacementScale;newData.displacementBias=data.displacementBias}return newData}},{"../core/shader":111,"../lib/three":150,"../utils/":172}],157:[function(_dereq_,module){var css=".a-html{bottom:0;left:0;position:fixed;right:0;top:0}.a-body{height:100%;margin:0;overflow:hidden;padding:0;width:100%}:-webkit-full-screen{background-color:transparent}.a-hidden{display:none!important}.a-canvas{height:100%;left:0;position:absolute;top:0;width:100%}.a-canvas.a-grab-cursor:hover{cursor:grab;cursor:-moz-grab;cursor:-webkit-grab}.a-canvas.a-grab-cursor:active,.a-grabbing{cursor:grabbing;cursor:-moz-grabbing;cursor:-webkit-grabbing}a-scene.fullscreen .a-canvas{width:100%!important;height:100%!important;top:0!important;left:0!important;right:0!important;bottom:0!important;position:fixed!important}.a-inspector-loader{background-color:#ed3160;position:fixed;left:3px;top:3px;padding:6px 10px;color:#fff;text-decoration:none;font-size:12px;font-family:Roboto,sans-serif;text-align:center;z-index:99999;width:204px}@keyframes dots-1{from{opacity:0}25%{opacity:1}}@keyframes dots-2{from{opacity:0}50%{opacity:1}}@keyframes dots-3{from{opacity:0}75%{opacity:1}}@-webkit-keyframes dots-1{from{opacity:0}25%{opacity:1}}@-webkit-keyframes dots-2{from{opacity:0}50%{opacity:1}}@-webkit-keyframes dots-3{from{opacity:0}75%{opacity:1}}.a-inspector-loader .dots span{animation:dots-1 2s infinite steps(1);-webkit-animation:dots-1 2s infinite steps(1)}.a-inspector-loader .dots span:first-child+span{animation-name:dots-2;-webkit-animation-name:dots-2}.a-inspector-loader .dots span:first-child+span+span{animation-name:dots-3;-webkit-animation-name:dots-3}a-scene{display:block;position:relative;height:100%;width:100%}a-assets,a-scene audio,a-scene img,a-scene video{display:none}.a-enter-vr-modal,.a-orientation-modal{font-family:Consolas,Andale Mono,Courier New,monospace}.a-enter-vr-modal a{border-bottom:1px solid #fff;padding:2px 0;text-decoration:none;transition:.1s color ease-in}.a-enter-vr-modal a:hover{background-color:#fff;color:#111;padding:2px 4px;position:relative;left:-4px}.a-enter-vr{font-family:sans-serif,monospace;font-size:13px;width:100%;font-weight:200;line-height:16px;position:absolute;right:20px;bottom:20px}.a-enter-vr.embedded{right:5px;bottom:5px}.a-enter-vr-button,.a-enter-vr-modal,.a-enter-vr-modal a{color:#fff}.a-enter-vr-button{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20viewBox%3D%220%200%20245.82%20141.73%22%3E%3Cdefs%3E%3Cstyle%3E.a%7Bfill%3A%23fff%3Bfill-rule%3Aevenodd%3B%7D%3C%2Fstyle%3E%3C%2Fdefs%3E%3Ctitle%3Emask%3C%2Ftitle%3E%3Cpath%20class%3D%22a%22%20d%3D%22M175.56%2C111.37c-22.52%2C0-40.77-18.84-40.77-42.07S153%2C27.24%2C175.56%2C27.24s40.77%2C18.84%2C40.77%2C42.07S198.08%2C111.37%2C175.56%2C111.37ZM26.84%2C69.31c0-23.23%2C18.25-42.07%2C40.77-42.07s40.77%2C18.84%2C40.77%2C42.07-18.26%2C42.07-40.77%2C42.07S26.84%2C92.54%2C26.84%2C69.31ZM27.27%2C0C11.54%2C0%2C0%2C12.34%2C0%2C28.58V110.9c0%2C16.24%2C11.54%2C30.83%2C27.27%2C30.83H99.57c2.17%2C0%2C4.19-1.83%2C5.4-3.7L116.47%2C118a8%2C8%2C0%2C0%2C1%2C12.52-.18l11.51%2C20.34c1.2%2C1.86%2C3.22%2C3.61%2C5.39%2C3.61h72.29c15.74%2C0%2C27.63-14.6%2C27.63-30.83V28.58C245.82%2C12.34%2C233.93%2C0%2C218.19%2C0H27.27Z%22%2F%3E%3C%2Fsvg%3E) 50% 50%/70% 70% no-repeat rgba(0,0,0,.35);border:0;bottom:0;cursor:pointer;min-width:50px;min-height:30px;padding-right:5%;padding-top:4%;position:absolute;right:0;transition:background-color .05s ease;-webkit-transition:background-color .05s ease;z-index:9999}.a-enter-vr-button:active,.a-enter-vr-button:hover{background-color:#666}[data-a-enter-vr-no-webvr] .a-enter-vr-button{border-color:#666;opacity:.65}[data-a-enter-vr-no-webvr] .a-enter-vr-button:active,[data-a-enter-vr-no-webvr] .a-enter-vr-button:hover{background-color:rgba(0,0,0,.35);cursor:not-allowed}.a-enter-vr-modal{background-color:#666;border-radius:0;display:none;min-height:32px;margin-right:70px;padding:9px;width:280px;right:2%;position:absolute}.a-enter-vr-modal:after{border-bottom:10px solid transparent;border-left:10px solid #666;border-top:10px solid transparent;display:inline-block;content:'';position:absolute;right:-5px;top:5px;width:0;height:0}.a-enter-vr-modal a,.a-enter-vr-modal p{display:inline}.a-enter-vr-modal p{margin:0}.a-enter-vr-modal p:after{content:' '}[data-a-enter-vr-no-headset].a-enter-vr:hover .a-enter-vr-modal,[data-a-enter-vr-no-webvr].a-enter-vr:hover .a-enter-vr-modal{display:block}.a-orientation-modal{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%2090%2090%22%20enable-background%3D%22new%200%200%2090%2090%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpolygon%20points%3D%220%2C0%200%2C0%200%2C0%20%22%3E%3C/polygon%3E%3Cg%3E%3Cpath%20d%3D%22M71.545%2C48.145h-31.98V20.743c0-2.627-2.138-4.765-4.765-4.765H18.456c-2.628%2C0-4.767%2C2.138-4.767%2C4.765v42.789%20%20%20c0%2C2.628%2C2.138%2C4.766%2C4.767%2C4.766h5.535v0.959c0%2C2.628%2C2.138%2C4.765%2C4.766%2C4.765h42.788c2.628%2C0%2C4.766-2.137%2C4.766-4.765V52.914%20%20%20C76.311%2C50.284%2C74.173%2C48.145%2C71.545%2C48.145z%20M18.455%2C16.935h16.344c2.1%2C0%2C3.808%2C1.708%2C3.808%2C3.808v27.401H37.25V22.636%20%20%20c0-0.264-0.215-0.478-0.479-0.478H16.482c-0.264%2C0-0.479%2C0.214-0.479%2C0.478v36.585c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h7.507v7.644%20%20%20h-5.534c-2.101%2C0-3.81-1.709-3.81-3.81V20.743C14.645%2C18.643%2C16.354%2C16.935%2C18.455%2C16.935z%20M16.96%2C23.116h19.331v25.031h-7.535%20%20%20c-2.628%2C0-4.766%2C2.139-4.766%2C4.768v5.828h-7.03V23.116z%20M71.545%2C73.064H28.757c-2.101%2C0-3.81-1.708-3.81-3.808V52.914%20%20%20c0-2.102%2C1.709-3.812%2C3.81-3.812h42.788c2.1%2C0%2C3.809%2C1.71%2C3.809%2C3.812v16.343C75.354%2C71.356%2C73.645%2C73.064%2C71.545%2C73.064z%22%3E%3C/path%3E%3Cpath%20d%3D%22M28.919%2C58.424c-1.466%2C0-2.659%2C1.193-2.659%2C2.66c0%2C1.466%2C1.193%2C2.658%2C2.659%2C2.658c1.468%2C0%2C2.662-1.192%2C2.662-2.658%20%20%20C31.581%2C59.617%2C30.387%2C58.424%2C28.919%2C58.424z%20M28.919%2C62.786c-0.939%2C0-1.703-0.764-1.703-1.702c0-0.939%2C0.764-1.704%2C1.703-1.704%20%20%20c0.94%2C0%2C1.705%2C0.765%2C1.705%2C1.704C30.623%2C62.022%2C29.858%2C62.786%2C28.919%2C62.786z%22%3E%3C/path%3E%3Cpath%20d%3D%22M69.654%2C50.461H33.069c-0.264%2C0-0.479%2C0.215-0.479%2C0.479v20.288c0%2C0.264%2C0.215%2C0.478%2C0.479%2C0.478h36.585%20%20%20c0.263%2C0%2C0.477-0.214%2C0.477-0.478V50.939C70.131%2C50.676%2C69.917%2C50.461%2C69.654%2C50.461z%20M69.174%2C51.417V70.75H33.548V51.417H69.174z%22%3E%3C/path%3E%3Cpath%20d%3D%22M45.201%2C30.296c6.651%2C0%2C12.233%2C5.351%2C12.551%2C11.977l-3.033-2.638c-0.193-0.165-0.507-0.142-0.675%2C0.048%20%20%20c-0.174%2C0.198-0.153%2C0.501%2C0.045%2C0.676l3.883%2C3.375c0.09%2C0.075%2C0.198%2C0.115%2C0.312%2C0.115c0.141%2C0%2C0.273-0.061%2C0.362-0.166%20%20%20l3.371-3.877c0.173-0.2%2C0.151-0.502-0.047-0.675c-0.194-0.166-0.508-0.144-0.676%2C0.048l-2.592%2C2.979%20%20%20c-0.18-3.417-1.629-6.605-4.099-9.001c-2.538-2.461-5.877-3.817-9.404-3.817c-0.264%2C0-0.479%2C0.215-0.479%2C0.479%20%20%20C44.72%2C30.083%2C44.936%2C30.296%2C45.201%2C30.296z%22%3E%3C/path%3E%3C/g%3E%3C/svg%3E) center/50% 50% no-repeat rgba(244,244,244,1);bottom:0;font-size:14px;font-weight:600;left:0;line-height:20px;right:0;position:fixed;top:0;z-index:9999999}.a-orientation-modal:after{color:#666;content:\"Insert phone into Cardboard holder.\";display:block;position:absolute;text-align:center;top:70%;transform:translateY(-70%);width:100%}.a-orientation-modal button{background:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20xmlns%3Axlink%3D%22http%3A//www.w3.org/1999/xlink%22%20version%3D%221.1%22%20x%3D%220px%22%20y%3D%220px%22%20viewBox%3D%220%200%20100%20100%22%20enable-background%3D%22new%200%200%20100%20100%22%20xml%3Aspace%3D%22preserve%22%3E%3Cpath%20fill%3D%22%23000000%22%20d%3D%22M55.209%2C50l17.803-17.803c1.416-1.416%2C1.416-3.713%2C0-5.129c-1.416-1.417-3.713-1.417-5.129%2C0L50.08%2C44.872%20%20L32.278%2C27.069c-1.416-1.417-3.714-1.417-5.129%2C0c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129L44.951%2C50L27.149%2C67.803%20%20c-1.417%2C1.416-1.417%2C3.713%2C0%2C5.129c0.708%2C0.708%2C1.636%2C1.062%2C2.564%2C1.062c0.928%2C0%2C1.856-0.354%2C2.564-1.062L50.08%2C55.13l17.803%2C17.802%20%20c0.708%2C0.708%2C1.637%2C1.062%2C2.564%2C1.062s1.856-0.354%2C2.564-1.062c1.416-1.416%2C1.416-3.713%2C0-5.129L55.209%2C50z%22%3E%3C/path%3E%3C/svg%3E) no-repeat;border:none;height:50px;text-indent:-9999px;width:50px}";_dereq_("browserify-css").createStyle(css,{href:"src/style/aframe.css"});module.exports=css},{"browserify-css":5}],158:[function(_dereq_,module){var css=".rs-base{background-color:#333;color:#fafafa;border-radius:0;font:10px monospace;left:5px;line-height:1em;opacity:.85;overflow:hidden;padding:10px;position:fixed;top:5px;width:300px;z-index:10000}.rs-base div.hidden{display:none}.rs-base h1{color:#fff;cursor:pointer;font-size:1.4em;font-weight:300;margin:0 0 5px;padding:0}.rs-group{display:-webkit-box;display:-webkit-flex;display:flex;-webkit-flex-direction:column-reverse;flex-direction:column-reverse;margin-bottom:5px}.rs-group:last-child{margin-bottom:0}.rs-counter-base{align-items:center;display:-webkit-box;display:-webkit-flex;display:flex;height:10px;-webkit-justify-content:space-between;justify-content:space-between;margin:2px 0}.rs-counter-base.alarm{color:#b70000;text-shadow:0 0 0 #b70000,0 0 1px #fff,0 0 1px #fff,0 0 2px #fff,0 0 2px #fff,0 0 3px #fff,0 0 3px #fff,0 0 4px #fff,0 0 4px #fff}.rs-counter-id{font-weight:300;-webkit-box-ordinal-group:0;-webkit-order:0;order:0;width:54px}.rs-counter-value{font-weight:300;-webkit-box-ordinal-group:1;-webkit-order:1;order:1;text-align:right;width:35px}.rs-canvas{-webkit-box-ordinal-group:2;-webkit-order:2;order:2}@media (min-width:480px){.rs-base{left:20px;top:20px}}";_dereq_("browserify-css").createStyle(css,{href:"src/style/rStats.css"});module.exports=css},{"browserify-css":5}],159:[function(_dereq_,module){var bind=_dereq_("../utils/bind"),constants=_dereq_("../constants/"),registerSystem=_dereq_("../core/system").registerSystem,DEFAULT_CAMERA_ATTR="data-aframe-default-camera";module.exports.System=registerSystem("camera",{init:function init(){this.activeCameraEl=null;this.sceneEl.addEventListener("loaded",bind(this.setupDefaultCamera,this))},setupDefaultCamera:function setupDefaultCamera(){var sceneEl=this.sceneEl,defaultCameraEl;if(sceneEl.camera&&!sceneEl.camera.el.getAttribute("camera").spectator){sceneEl.emit("camera-ready",{cameraEl:sceneEl.camera.el});return}defaultCameraEl=document.createElement("a-entity");defaultCameraEl.setAttribute("camera",{active:!0});defaultCameraEl.setAttribute("wasd-controls","");defaultCameraEl.setAttribute("look-controls","");defaultCameraEl.setAttribute(constants.AFRAME_INJECTED,"");defaultCameraEl.setAttribute("position",{x:0,y:constants.DEFAULT_CAMERA_HEIGHT,z:0});sceneEl.appendChild(defaultCameraEl);sceneEl.addEventListener("enter-vr",this.removeDefaultOffset);sceneEl.addEventListener("exit-vr",this.addDefaultOffset);sceneEl.emit("camera-ready",{cameraEl:defaultCameraEl})},disableActiveCamera:function disableActiveCamera(){var cameraEls=this.sceneEl.querySelectorAll("[camera]"),newActiveCameraEl=cameraEls[cameraEls.length-1];newActiveCameraEl.setAttribute("camera","active",!0)},setActiveCamera:function setActiveCamera(newCameraEl){var cameraEl,cameraEls,i,newCamera,previousCamera=this.activeCameraEl,sceneEl=this.sceneEl;newCamera=newCameraEl.getObject3D("camera");if(!newCamera||newCameraEl===this.activeCameraEl){return}var defaultCameraWrapper=sceneEl.querySelector("["+DEFAULT_CAMERA_ATTR+"]"),defaultCameraEl=defaultCameraWrapper&&defaultCameraWrapper.querySelector("[camera]");if(newCameraEl!==defaultCameraEl){removeDefaultCamera(sceneEl)}this.activeCameraEl=newCameraEl;this.activeCameraEl.play();sceneEl.camera=newCamera;if(previousCamera){previousCamera.setAttribute("camera","active",!1)}cameraEls=sceneEl.querySelectorAll("[camera]");for(i=0;i<cameraEls.length;i++){cameraEl=cameraEls[i];if(!cameraEl.isEntity||newCameraEl===cameraEl){continue}cameraEl.setAttribute("camera","active",!1);cameraEl.pause()}sceneEl.emit("camera-set-active",{cameraEl:newCameraEl})},setSpectatorCamera:function setSpectatorCamera(newCameraEl){var newCamera,previousCamera=this.spectatorCameraEl,sceneEl=this.sceneEl,spectatorCameraEl;newCamera=newCameraEl.getObject3D("camera");if(!newCamera||newCameraEl===this.spectatorCameraEl){return}if(previousCamera){previousCamera.setAttribute("camera","spectator",!1)}spectatorCameraEl=this.spectatorCameraEl=newCameraEl;spectatorCameraEl.setAttribute("camera","active",!1);spectatorCameraEl.play();sceneEl.emit("camera-set-spectator",{cameraEl:newCameraEl})},disableSpectatorCamera:function disableSpectatorCamera(){this.spectatorCameraEl=void 0},tock:function tock(){var spectatorCamera,sceneEl=this.sceneEl,isVREnabled=sceneEl.renderer.vr.enabled;if(!this.spectatorCameraEl||sceneEl.isMobile){return}spectatorCamera=this.spectatorCameraEl.components.camera.camera;sceneEl.renderer.vr.enabled=!1;sceneEl.renderer.render(sceneEl.object3D,spectatorCamera);sceneEl.renderer.vr.enabled=isVREnabled}});function removeDefaultCamera(sceneEl){var defaultCamera,camera=sceneEl.camera;if(!camera){return}defaultCamera=sceneEl.querySelector("["+DEFAULT_CAMERA_ATTR+"]");if(!defaultCamera){return}sceneEl.removeChild(defaultCamera)}},{"../constants/":93,"../core/system":112,"../utils/bind":166}],160:[function(_dereq_,module){var geometries=_dereq_("../core/geometry").geometries,registerSystem=_dereq_("../core/system").registerSystem,THREE=_dereq_("../lib/three");module.exports.System=registerSystem("geometry",{init:function init(){this.cache={};this.cacheCount={}},clearCache:function clearCache(){this.cache={};this.cacheCount={}},getOrCreateGeometry:function getOrCreateGeometry(data){var cache=this.cache,cachedGeometry,hash;if(data.skipCache){return createGeometry(data)}hash=this.hash(data);cachedGeometry=cache[hash];incrementCacheCount(this.cacheCount,hash);if(cachedGeometry){return cachedGeometry}cachedGeometry=createGeometry(data);cache[hash]=cachedGeometry;return cachedGeometry},unuseGeometry:function unuseGeometry(data){var cache=this.cache,cacheCount=this.cacheCount,geometry,hash;if(data.skipCache){return}hash=this.hash(data);if(!cache[hash]){return}decrementCacheCount(cacheCount,hash);if(0<cacheCount[hash]){return}geometry=cache[hash];geometry.dispose();delete cache[hash];delete cacheCount[hash]},hash:function hash(data){return JSON.stringify(data)}});function createGeometry(data){var geometryType=data.primitive,GeometryClass=geometries[geometryType]&&geometries[geometryType].Geometry,geometryInstance=new GeometryClass;if(!GeometryClass){throw new Error("Unknown geometry `"+geometryType+"`")}geometryInstance.init(data);return toBufferGeometry(geometryInstance.geometry,data.buffer)}function decrementCacheCount(cacheCount,hash){cacheCount[hash]--}function incrementCacheCount(cacheCount,hash){cacheCount[hash]=cacheCount[hash]===void 0?1:cacheCount[hash]+1}function toBufferGeometry(geometry,doBuffer){var bufferGeometry;if(!doBuffer){return geometry}bufferGeometry=new THREE.BufferGeometry().fromGeometry(geometry);bufferGeometry.metadata={type:geometry.type,parameters:geometry.parameters||{}};geometry.dispose();return bufferGeometry}},{"../core/geometry":103,"../core/system":112,"../lib/three":150}],161:[function(_dereq_){_dereq_("./camera");_dereq_("./geometry");_dereq_("./light");_dereq_("./material");_dereq_("./shadow");_dereq_("./tracked-controls")},{"./camera":159,"./geometry":160,"./light":162,"./material":163,"./shadow":164,"./tracked-controls":165}],162:[function(_dereq_,module){var registerSystem=_dereq_("../core/system").registerSystem,bind=_dereq_("../utils/bind"),constants=_dereq_("../constants/"),DEFAULT_LIGHT_ATTR="data-aframe-default-light";module.exports.System=registerSystem("light",{schema:{defaultLightsEnabled:{default:!0}},init:function init(){this.defaultLights=!1;this.userDefinedLights=!1;this.sceneEl.addEventListener("loaded",bind(this.setupDefaultLights,this))},registerLight:function registerLight(el){if(!el.hasAttribute(DEFAULT_LIGHT_ATTR)){this.removeDefaultLights();this.userDefinedLights=!0}},removeDefaultLights:function removeDefaultLights(){var defaultLights,sceneEl=this.sceneEl;if(!this.defaultLights){return}defaultLights=document.querySelectorAll("["+DEFAULT_LIGHT_ATTR+"]");for(var i=0;i<defaultLights.length;i++){sceneEl.removeChild(defaultLights[i])}this.defaultLights=!1},setupDefaultLights:function setupDefaultLights(){var sceneEl=this.sceneEl,ambientLight,directionalLight;if(this.userDefinedLights||this.defaultLights||!this.data.defaultLightsEnabled){return}ambientLight=document.createElement("a-entity");ambientLight.setAttribute("light",{color:"#BBB",type:"ambient"});ambientLight.setAttribute(DEFAULT_LIGHT_ATTR,"");ambientLight.setAttribute(constants.AFRAME_INJECTED,"");sceneEl.appendChild(ambientLight);directionalLight=document.createElement("a-entity");directionalLight.setAttribute("light",{color:"#FFF",intensity:.6,castShadow:!0});directionalLight.setAttribute("position",{x:-.5,y:1,z:1});directionalLight.setAttribute(DEFAULT_LIGHT_ATTR,"");directionalLight.setAttribute(constants.AFRAME_INJECTED,"");sceneEl.appendChild(directionalLight);this.defaultLights=!0}})},{"../constants/":93,"../core/system":112,"../utils/bind":166}],163:[function(_dereq_,module){var registerSystem=_dereq_("../core/system").registerSystem,THREE=_dereq_("../lib/three"),utils=_dereq_("../utils/"),isHLS=_dereq_("../utils/material").isHLS,bind=utils.bind,debug=utils.debug,error=debug("components:texture:error"),TextureLoader=new THREE.TextureLoader,warn=debug("components:texture:warn");TextureLoader.setCrossOrigin("anonymous");module.exports.System=registerSystem("material",{init:function init(){this.materials={};this.textureCounts={};this.textureCache={};this.sceneEl.addEventListener("materialtextureloaded",bind(this.onMaterialTextureLoaded,this))},clearTextureCache:function clearTextureCache(){this.textureCache={}},loadTexture:function loadTexture(src,data,cb){var self=this;if("CANVAS"===src.tagName){this.loadCanvas(src,data,cb);return}if("VIDEO"===src.tagName){if(!src.src&&!src.srcObject&&!src.childElementCount){warn("Video element was defined with neither `source` elements nor `src` / `srcObject` attributes.")}this.loadVideo(src,data,cb);return}utils.srcLoader.validateSrc(src,function(src){self.loadImage(src,data,cb)},function(src){self.loadVideo(src,data,cb)})},loadImage:function loadImage(src,data,handleImageTextureLoaded){var hash=this.hash(data),textureCache=this.textureCache;if(textureCache[hash]){textureCache[hash].then(handleImageTextureLoaded);return}textureCache[hash]=loadImageTexture(src,data);textureCache[hash].then(handleImageTextureLoaded)},loadCanvas:function loadCanvas(src,data,cb){src.readyState=2;src.HAVE_CURRENT_DATA=2;this.loadVideo(src,data,cb)},loadVideo:function loadVideo(src,data,cb){var hash,texture,textureCache=this.textureCache,videoEl,videoTextureResult;function handleVideoTextureLoaded(result){result.texture.needsUpdate=!0;cb(result.texture,result.videoEl)}if("string"!==typeof src){videoEl=src;hash=this.hashVideo(data,videoEl);if(textureCache[hash]){textureCache[hash].then(handleVideoTextureLoaded);return}fixVideoAttributes(videoEl)}videoEl=videoEl||createVideoEl(src,data.width,data.height);hash=this.hashVideo(data,videoEl);if(textureCache[hash]){textureCache[hash].then(handleVideoTextureLoaded);return}texture=new THREE.VideoTexture(videoEl);texture.minFilter=THREE.LinearFilter;setTextureProperties(texture,data);if(this.sceneEl.isIOS&&isHLS(videoEl.src||videoEl.getAttribute("src"),videoEl.type||videoEl.getAttribute("type"))){texture.format=THREE.RGBAFormat;texture.needsCorrectionBGRA=!0;texture.flipY=!1;texture.needsCorrectionFlipY=!0}videoTextureResult={texture:texture,videoEl:videoEl};textureCache[hash]=Promise.resolve(videoTextureResult);handleVideoTextureLoaded(videoTextureResult)},hash:function hash(data){if(data.src.tagName){data=utils.extendDeep({},data);data.src=data.src.src}return JSON.stringify(data)},hashVideo:function hashVideo(data,videoEl){return calculateVideoCacheHash(data,videoEl)},registerMaterial:function registerMaterial(material){this.materials[material.uuid]=material},unregisterMaterial:function unregisterMaterial(material){delete this.materials[material.uuid];var textureCounts=this.textureCounts;Object.keys(material).filter(function(propName){return material[propName]&&material[propName].isTexture}).forEach(function(mapName){textureCounts[material[mapName].uuid]--;if(0>=textureCounts[material[mapName].uuid]){material[mapName].dispose()}})},updateMaterials:function updateMaterials(){var materials=this.materials;Object.keys(materials).forEach(function(uuid){materials[uuid].needsUpdate=!0})},onMaterialTextureLoaded:function onMaterialTextureLoaded(e){if(!this.textureCounts[e.detail.texture.uuid]){this.textureCounts[e.detail.texture.uuid]=0}this.textureCounts[e.detail.texture.uuid]++}});function calculateVideoCacheHash(data,videoEl){var i,id=videoEl.getAttribute("id"),hash,videoAttributes;if(id){return id}hash="";videoAttributes=data||{};for(i=0;i<videoEl.attributes.length;i++){videoAttributes[videoEl.attributes[i].name]=videoEl.attributes[i].value}Object.keys(videoAttributes).sort().forEach(function(name){hash+=name+":"+videoAttributes[name]+";"});return hash}function loadImageTexture(src,data){return new Promise(function(resolve){function resolveTexture(texture){setTextureProperties(texture,data);texture.needsUpdate=!0;resolve(texture)}if("string"!==typeof src){resolveTexture(new THREE.Texture(src));return}TextureLoader.load(src,resolveTexture,function(){},function(xhr){error("`$s` could not be fetched (Error code: %s; Response: %s)",xhr.status,xhr.statusText)})})}function setTextureProperties(texture,data){var offset=data.offset||{x:0,y:0},repeat=data.repeat||{x:1,y:1},npot=data.npot||!1;if(npot){texture.wrapS=THREE.ClampToEdgeWrapping;texture.wrapT=THREE.ClampToEdgeWrapping;texture.magFilter=THREE.LinearFilter;texture.minFilter=THREE.LinearFilter}if(1!==repeat.x||1!==repeat.y){texture.wrapS=THREE.RepeatWrapping;texture.wrapT=THREE.RepeatWrapping;texture.repeat.set(repeat.x,repeat.y)}if(0!==offset.x||0!==offset.y){texture.offset.set(offset.x,offset.y)}}function createVideoEl(src,width,height){var videoEl=document.createElement("video");videoEl.width=width;videoEl.height=height;videoEl.setAttribute("playsinline","");videoEl.setAttribute("webkit-playsinline","");videoEl.autoplay=!0;videoEl.loop=!0;videoEl.crossOrigin="anonymous";videoEl.addEventListener("error",function(){warn("`$s` is not a valid video",src)},!0);videoEl.src=src;return videoEl}function fixVideoAttributes(videoEl){videoEl.autoplay=videoEl.hasAttribute("autoplay")&&"false"!==videoEl.getAttribute("autoplay");videoEl.controls=videoEl.hasAttribute("controls")&&"false"!==videoEl.getAttribute("controls");if("false"===videoEl.getAttribute("loop")){videoEl.removeAttribute("loop")}if("false"===videoEl.getAttribute("preload")){videoEl.preload="none"}videoEl.crossOrigin=videoEl.crossOrigin||"anonymous";videoEl.setAttribute("playsinline","");videoEl.setAttribute("webkit-playsinline","");return videoEl}},{"../core/system":112,"../lib/three":150,"../utils/":172,"../utils/material":173}],164:[function(_dereq_,module){var registerSystem=_dereq_("../core/system").registerSystem,THREE=_dereq_("../lib/three"),SHADOW_MAP_TYPE_MAP={basic:THREE.BasicShadowMap,pcf:THREE.PCFShadowMap,pcfsoft:THREE.PCFSoftShadowMap};module.exports.System=registerSystem("shadow",{schema:{autoUpdate:{default:!0},type:{default:"pcf",oneOf:["basic","pcf","pcfsoft"]}},init:function init(){var sceneEl=this.sceneEl,data=this.data;this.shadowMapEnabled=!1;if(!sceneEl.renderer){return}sceneEl.renderer.shadowMap.type=SHADOW_MAP_TYPE_MAP[data.type];sceneEl.renderer.shadowMap.autoUpdate=data.autoUpdate;this.setShadowMapEnabled(this.shadowMapEnabled)},setShadowMapEnabled:function setShadowMapEnabled(enabled){var renderer=this.sceneEl.renderer;this.shadowMapEnabled=enabled;if(renderer){renderer.shadowMap.enabled=enabled}}})},{"../core/system":112,"../lib/three":150}],165:[function(_dereq_,module){var registerSystem=_dereq_("../core/system").registerSystem,utils=_dereq_("../utils");module.exports.System=registerSystem("tracked-controls",{init:function init(){var self=this;this.controllers=[];this.updateControllerList(navigator.getGamepads&&navigator.getGamepads());this.throttledUpdateControllerList=utils.throttle(this.updateControllerList,500,this);if(!navigator.getVRDisplays){return}this.sceneEl.addEventListener("enter-vr",function(){navigator.getVRDisplays().then(function(displays){if(displays.length){self.vrDisplay=displays[0]}})})},tick:function tick(){var gamepads=navigator.getGamepads&&navigator.getGamepads();this.throttledUpdateControllerList(gamepads)},updateControllerList:function updateControllerList(gamepads){var controllers=this.controllers,gamepad,i,prevCount;if(!gamepads){return}prevCount=controllers.length;controllers.length=0;for(i=0;i<gamepads.length;++i){gamepad=gamepads[i];if(gamepad&&gamepad.pose){controllers.push(gamepad)}}if(controllers.length!==prevCount){this.el.emit("controllersupdated",void 0,!1)}}})},{"../core/system":112,"../utils":172}],166:[function(_dereq_,module){module.exports=function(fn,ctx){return function(prependedArgs){return function(){var args=prependedArgs.concat(Array.prototype.slice.call(arguments,0));return fn.apply(ctx,args)}}(Array.prototype.slice.call(arguments,2))}},{}],167:[function(_dereq_,module){var debug=_dereq_("./debug"),extend=_dereq_("object-assign"),warn=debug("utils:coordinates:warn"),regex=/^\s*((-?\d*\.{0,1}\d+(e-?\d+)?)\s+){2,3}(-?\d*\.{0,1}\d+(e-?\d+)?)\s*$/;module.exports.regex=regex;module.exports.parse=function(value,defaultVec){var coordinate,vec;if(value&&babelHelpers.instanceof(value,Object)){if(defaultVec){value.x=value.x===void 0?defaultVec.x:value.x;value.y=value.y===void 0?defaultVec.y:value.y;value.z=value.z===void 0?defaultVec.z:value.z;value.w=value.w===void 0?defaultVec.w:value.w}return vecParseFloat(value)}if(null===value||value===void 0){return"object"===babelHelpers.typeof(defaultVec)?extend({},defaultVec):defaultVec}coordinate=value.trim().replace(/\s+/g," ").split(" ");vec={};vec.x=coordinate[0]||defaultVec&&defaultVec.x;vec.y=coordinate[1]||defaultVec&&defaultVec.y;vec.z=coordinate[2]||defaultVec&&defaultVec.z;vec.w=coordinate[3]||defaultVec&&defaultVec.w;return vecParseFloat(vec)};module.exports.stringify=function(data){if("object"!==babelHelpers.typeof(data)){return data}return[data.x,data.y,data.z,data.w].join(" ").trim()};function isCoordinates(value){return regex.test(value)}module.exports.isCoordinates=isCoordinates;module.exports.isCoordinate=function(value){warn("`AFRAME.utils.isCoordinate` has been renamed to `AFRAME.utils.isCoordinates`");return isCoordinates(value)};function vecParseFloat(vec){for(var key in vec){if(vec[key]===void 0){delete vec[key];continue}if(vec[key].constructor===String){vec[key]=parseFloat(vec[key],10)}}return vec}module.exports.toVector3=function(vec3){return new THREE.Vector3(vec3.x,vec3.y,vec3.z)}},{"./debug":168,"object-assign":25}],168:[function(_dereq_,module){(function(process){var debugLib=_dereq_("debug"),extend=_dereq_("object-assign"),settings={colors:{debug:"gray",error:"red",info:"gray",warn:"orange"}},debug=function(namespace){var d=debugLib(namespace);d.color=getDebugNamespaceColor(namespace);return d};extend(debug,debugLib);function getDebugNamespaceType(namespace){var chunks=namespace.split(":");return chunks[chunks.length-1]}function getDebugNamespaceColor(namespace){var type=getDebugNamespaceType(namespace),color=settings.colors&&settings.colors[type];return color||null}var ls=function(){try{return window.localStorage}catch(e){}}();if(ls&&(parseInt(ls.logs,10)||"true"===ls.logs)){debug.enable("*")}else{debug.enable("*:error,*:info,*:warn")}if(process.browser){window.logs=debug}module.exports=debug}).call(this,_dereq_("_process"))},{_process:32,debug:8,"object-assign":25}],169:[function(_dereq_,module){(function(process){var vrDisplay,polyfilledVRDisplay;if(navigator.getVRDisplays){navigator.getVRDisplays().then(function(displays){vrDisplay=displays.length&&displays[0];polyfilledVRDisplay=vrDisplay.displayName==="Cardboard VRDisplay"})}function getVRDisplay(){return vrDisplay}module.exports.getVRDisplay=getVRDisplay;module.exports.checkHeadsetConnected=function(){return!!getVRDisplay()};function checkHasPositionalTracking(){var vrDisplay=getVRDisplay();if(isMobile()||isGearVR()){return!1}return vrDisplay&&vrDisplay.capabilities.hasPosition}module.exports.checkHasPositionalTracking=checkHasPositionalTracking;var isMobile=function(){var _isMobile=!1;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4))){_isMobile=!0}if(isIOS()||isTablet()||isR7()){_isMobile=!0}})(window.navigator.userAgent||window.navigator.vendor||window.opera);return function(){return _isMobile}}();module.exports.isMobile=isMobile;function isTablet(mockUserAgent){var userAgent=mockUserAgent||window.navigator.userAgent;return /ipad|Nexus (7|9)|xoom|sch-i800|playbook|tablet|kindle/i.test(userAgent)}module.exports.isTablet=isTablet;function isIOS(){return /iPad|iPhone|iPod/.test(window.navigator.platform)}module.exports.isIOS=isIOS;function isGearVR(){return /SamsungBrowser.+Mobile VR/i.test(window.navigator.userAgent)}module.exports.isGearVR=isGearVR;function isR7(){return /R7 Build/.test(window.navigator.userAgent)}module.exports.isR7=isR7;module.exports.isLandscape=function(){var orientation=window.orientation;if(isR7()){orientation+=90}return 90===orientation||-90===orientation};module.exports.isIOSOlderThan10=function(userAgent){return /(iphone|ipod|ipad).*os.(7|8|9)/i.test(userAgent)};module.exports.isBrowserEnvironment=!!(!process||process.browser);module.exports.isNodeEnvironment=!module.exports.isBrowserEnvironment;module.exports.PolyfillControls=function(object){var frameData;if(window.VRFrameData){frameData=new window.VRFrameData}this.update=function(){var pose;if(!vrDisplay||!polyfilledVRDisplay){return}vrDisplay.getFrameData(frameData);pose=frameData.pose;if(null!==pose.orientation){object.quaternion.fromArray(pose.orientation)}if(null!==pose.position){object.position.fromArray(pose.position)}else{object.position.set(0,0,0)}}}}).call(this,_dereq_("_process"))},{_process:32}],170:[function(_dereq_,module){var propertyPathCache={};function getComponentPropertyPath(str,delimiter){delimiter=delimiter||".";if(!propertyPathCache[delimiter]){propertyPathCache[delimiter]={}}if(-1!==str.indexOf(delimiter)){propertyPathCache[delimiter][str]=str.split(delimiter)}else{propertyPathCache[delimiter][str]=str}return propertyPathCache[delimiter][str]}module.exports.getComponentPropertyPath=getComponentPropertyPath;module.exports.propertyPathCache=propertyPathCache;module.exports.getComponentProperty=function(el,name,delimiter){var splitName;delimiter=delimiter||".";if(-1!==name.indexOf(delimiter)){splitName=getComponentPropertyPath(name,delimiter);if(splitName.constructor===String){return el.getAttribute(splitName)}return el.getAttribute(splitName[0])[splitName[1]]}return el.getAttribute(name)};module.exports.setComponentProperty=function(el,name,value,delimiter){var splitName;delimiter=delimiter||".";if(-1!==name.indexOf(delimiter)){splitName=getComponentPropertyPath(name,delimiter);if(splitName.constructor===String){el.setAttribute(splitName,value)}else{el.setAttribute(splitName[0],splitName[1],value)}return}el.setAttribute(name,value)}},{}],171:[function(_dereq_,module){module.exports=function(canvasEl){var width=canvasEl.style.width,height=canvasEl.style.height;canvasEl.style.width=parseInt(width,10)+1+"px";canvasEl.style.height=parseInt(height,10)+1+"px";setTimeout(function(){canvasEl.style.width=width;canvasEl.style.height=height},200)}},{}],172:[function(_dereq_,module){var debug=_dereq_("./debug"),deepAssign=_dereq_("deep-assign"),device=_dereq_("./device"),objectAssign=_dereq_("object-assign"),objectPool=_dereq_("./object-pool"),warn=debug("utils:warn");module.exports.bind=_dereq_("./bind");module.exports.coordinates=_dereq_("./coordinates");module.exports.debug=debug;module.exports.device=device;module.exports.entity=_dereq_("./entity");module.exports.forceCanvasResizeSafariMobile=_dereq_("./forceCanvasResizeSafariMobile");module.exports.material=_dereq_("./material");module.exports.objectPool=objectPool;module.exports.split=_dereq_("./split").split;module.exports.styleParser=_dereq_("./styleParser");module.exports.trackedControls=_dereq_("./tracked-controls");module.exports.checkHeadsetConnected=function(){warn("`utils.checkHeadsetConnected` has moved to `utils.device.checkHeadsetConnected`");return device.checkHeadsetConnected(arguments)};module.exports.isGearVR=function(){warn("`utils.isGearVR` has moved to `utils.device.isGearVR`");return device.isGearVR(arguments)};module.exports.isIOS=function(){warn("`utils.isIOS` has moved to `utils.device.isIOS`");return device.isIOS(arguments)};module.exports.isMobile=function(){warn("`utils.isMobile has moved to `utils.device.isMobile`");return device.isMobile(arguments)};module.exports.throttle=function(functionToThrottle,minimumInterval,optionalContext){var lastTime;if(optionalContext){functionToThrottle=module.exports.bind(functionToThrottle,optionalContext)}return function(){var time=Date.now(),sinceLastTime="undefined"===typeof lastTime?minimumInterval:time-lastTime;if("undefined"===typeof lastTime||sinceLastTime>=minimumInterval){lastTime=time;functionToThrottle.apply(null,arguments)}}};module.exports.throttleTick=function(functionToThrottle,minimumInterval,optionalContext){var lastTime;if(optionalContext){functionToThrottle=module.exports.bind(functionToThrottle,optionalContext)}return function(time,delta){var sinceLastTime="undefined"===typeof lastTime?delta:time-lastTime;if("undefined"===typeof lastTime||sinceLastTime>=minimumInterval){lastTime=time;functionToThrottle(time,sinceLastTime)}}};module.exports.debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments,callNow=immediate&&!timeout;clearTimeout(timeout);timeout=setTimeout(function later(){timeout=null;if(!immediate)func.apply(context,args)},wait);if(callNow)func.apply(context,args)}};module.exports.extend=objectAssign;module.exports.extendDeep=deepAssign;module.exports.clone=function(obj){return JSON.parse(JSON.stringify(obj))};var deepEqual=function(){var arrayPool=objectPool.createPool(function(){return[]});return function(a,b){var key,keysA,keysB,i,valA,valB;if(a===void 0||b===void 0||null===a||null===b||!(a&&b&&a.constructor===Object&&b.constructor===Object||a.constructor===Array&&b.constructor===Array)){return a===b}keysA=arrayPool.use();keysB=arrayPool.use();keysA.length=0;keysB.length=0;for(key in a){keysA.push(key)}for(key in b){keysB.push(key)}if(keysA.length!==keysB.length){arrayPool.recycle(keysA);arrayPool.recycle(keysB);return!1}for(i=0;i<keysA.length;++i){valA=a[keysA[i]];valB=b[keysA[i]];if("object"===babelHelpers.typeof(valA)||"object"===babelHelpers.typeof(valB)||Array.isArray(valA)&&Array.isArray(valB)){if(valA===valB){continue}if(!deepEqual(valA,valB)){arrayPool.recycle(keysA);arrayPool.recycle(keysB);return!1}}else if(valA!==valB){arrayPool.recycle(keysA);arrayPool.recycle(keysB);return!1}}arrayPool.recycle(keysA);arrayPool.recycle(keysB);return!0}}();module.exports.deepEqual=deepEqual;module.exports.diff=function(){var keys=[];return function(a,b,targetObject){var aVal,bVal,bKey,diff,key,i,isComparingObjects;diff=targetObject||{};keys.length=0;for(key in a){keys.push(key)}if(!b){return diff}for(bKey in b){if(-1===keys.indexOf(bKey)){keys.push(bKey)}}for(i=0;i<keys.length;i++){key=keys[i];aVal=a[key];bVal=b[key];isComparingObjects=aVal&&bVal&&aVal.constructor===Object&&bVal.constructor===Object;if(isComparingObjects&&!deepEqual(aVal,bVal)||!isComparingObjects&&aVal!==bVal){diff[key]=bVal}}return diff}}();module.exports.shouldCaptureKeyEvent=function(event){if(event.metaKey){return!1}return document.activeElement===document.body};module.exports.splitString=function(str,delimiter){if("undefined"===typeof delimiter){delimiter=" "}var regex=new RegExp(delimiter,"g");str=(str||"").replace(regex,delimiter);return str.split(delimiter)};module.exports.getElData=function(el,defaults){defaults=defaults||{};var data={};Object.keys(defaults).forEach(function(key){if(el.hasAttribute(key)){data[key]=el.getAttribute(key)}});return data};module.exports.getUrlParameter=function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return null===results?"":decodeURIComponent(results[1].replace(/\+/g," "))};module.exports.isIframed=function(){return window.top!==window.self};module.exports.findAllScenes=function(el){for(var matchingElements=[],allElements=el.getElementsByTagName("*"),i=0,n=allElements.length;i<n;i++){if(allElements[i].isScene){matchingElements.push(allElements[i])}}return matchingElements};module.exports.srcLoader=_dereq_("./src-loader")},{"./bind":166,"./coordinates":167,"./debug":168,"./device":169,"./entity":170,"./forceCanvasResizeSafariMobile":171,"./material":173,"./object-pool":174,"./split":175,"./src-loader":176,"./styleParser":177,"./tracked-controls":178,"deep-assign":10,"object-assign":25}],173:[function(_dereq_,module){var THREE=_dereq_("../lib/three"),HLS_MIMETYPES=["application/x-mpegurl","application/vnd.apple.mpegurl"];module.exports.updateMapMaterialFromData=function(materialName,dataName,shader,data){var el=shader.el,material=shader.material,src=data[dataName];if(!shader.materialSrcs){shader.materialSrcs={}}if(!src){delete shader.materialSrcs[materialName];setMap(null);return}if(src===shader.materialSrcs[materialName]){return}shader.materialSrcs[materialName]=src;if(babelHelpers.instanceof(src,THREE.Texture)){setMap(src)}else{el.sceneEl.systems.material.loadTexture(src,{src:src,repeat:data.repeat,offset:data.offset,npot:data.npot},checkSetMap)}function checkSetMap(texture){if(shader.materialSrcs[materialName]!==src){return}setMap(texture)}function setMap(texture){material[materialName]=texture;material.needsUpdate=!0;handleTextureEvents(el,texture)}};module.exports.updateMap=function(shader,data){return module.exports.updateMapMaterialFromData("map","src",shader,data)};module.exports.updateDistortionMap=function(longType,shader,data){var shortType=longType;if("ambientOcclusion"===longType){shortType="ao"}var el=shader.el,material=shader.material,src=data[longType+"Map"],info={};info.src=src;info.offset=data[longType+"TextureOffset"];info.repeat=data[longType+"TextureRepeat"];info.wrap=data[longType+"TextureWrap"];if(src){if(src===shader[longType+"TextureSrc"]){return}shader[longType+"TextureSrc"]=src;el.sceneEl.systems.material.loadTexture(src,info,setMap);return}if(!material.map){return}setMap(null);function setMap(texture){material[shortType+"Map"]=texture;material.needsUpdate=!0;handleTextureEvents(el,texture)}};function handleTextureEvents(el,texture){if(!texture){return}el.emit("materialtextureloaded",{src:texture.image,texture:texture});if(!texture.image||"VIDEO"!==texture.image.tagName){return}texture.image.addEventListener("loadeddata",function(){if(!el.components||!el.components.material){return}if(texture.needsCorrectionBGRA&&texture.needsCorrectionFlipY&&-1!==["standard","flat"].indexOf(el.components.material.data.shader)){el.setAttribute("material","shader","ios10hls")}el.emit("materialvideoloadeddata",{src:texture.image,texture:texture})});texture.image.addEventListener("ended",function(){el.emit("materialvideoended",{src:texture.image,texture:texture})})}module.exports.handleTextureEvents=handleTextureEvents;module.exports.isHLS=function(src,type){if(type&&HLS_MIMETYPES.includes(type.toLowerCase())){return!0}if(src&&0<src.toLowerCase().indexOf(".m3u8")){return!0}return!1}},{"../lib/three":150}],174:[function(_dereq_,module){var EMPTY_SLOT=Object.freeze(Object.create(null));function defaultObjectFactory(){return{}}module.exports.createPool=function(objectFactory){var objPool=[],nextFreeSlot=null;objectFactory=objectFactory||defaultObjectFactory;function use(){var objToUse;if(null===nextFreeSlot||nextFreeSlot===objPool.length){grow(objPool.length||5)}objToUse=objPool[nextFreeSlot];objPool[nextFreeSlot++]=EMPTY_SLOT;clearObject(objToUse);return objToUse}function recycle(obj){if(!babelHelpers.instanceof(obj,Object)){return}if(null===nextFreeSlot||-1===nextFreeSlot){objPool[objPool.length]=obj;return}objPool[--nextFreeSlot]=obj}function grow(count){var currentLength,i;count=count===void 0?objPool.length:count;if(0<count&&null==nextFreeSlot){nextFreeSlot=0}if(0<count){currentLength=objPool.length;objPool.length+=+count;for(i=currentLength;i<objPool.length;i++){objPool[i]=objectFactory()}}return objPool.length}return{grow:grow,pool:objPool,recycle:recycle,size:function(){return objPool.length},use:use}};function clearObject(obj){if(!(obj.constructor===Object)){return}for(var key in obj){obj[key]=void 0}}module.exports.clearObject=clearObject},{}],175:[function(_dereq_,module){module.exports.split=function(){var splitCache={};return function(str,delimiter){if(!(delimiter in splitCache)){splitCache[delimiter]={}}if(str in splitCache[delimiter]){return splitCache[delimiter][str]}splitCache[delimiter][str]=str.split(delimiter);return splitCache[delimiter][str]}}()},{}],176:[function(_dereq_,module){var debug=_dereq_("./debug"),warn=debug("utils:src-loader:warn");function validateSrc(src,isImageCb,isVideoCb){checkIsImage(src,function(isImage){if(isImage){isImageCb(src);return}isVideoCb(src)})}function parseUrl(src){var parsedSrc=src.match(/\url\((.+)\)/);if(!parsedSrc){return}return parsedSrc[1]}function checkIsImage(src,onResult){var request;if(src.tagName){onResult("IMG"===src.tagName);return}request=new XMLHttpRequest;request.open("HEAD",src);request.addEventListener("load",function(){var contentType;if(200<=request.status&&300>request.status){contentType=request.getResponseHeader("Content-Type");if(null==contentType){checkIsImageFallback(src,onResult)}else{if(contentType.startsWith("image")){onResult(!0)}else{onResult(!1)}}}else{checkIsImageFallback(src,onResult)}request.abort()});request.send()}function checkIsImageFallback(src,onResult){var tester=new Image;tester.addEventListener("load",function(){onResult(!0)});tester.addEventListener("error",function(){onResult(!1)});tester.src=src}function validateAndGetQuerySelector(selector){try{var el=document.querySelector(selector);if(!el){warn("No element was found matching the selector: \"%s\"",selector)}return el}catch(e){warn("\"%s\" is not a valid selector",selector)}}module.exports={parseUrl:parseUrl,validateSrc:validateSrc,validateCubemapSrc:function(src,cb){var aCubemap,cubemapSrcRegex="",i,urls,validatedUrls=[];for(i=0;5>i;i++){cubemapSrcRegex+="(url\\((?:[^\\)]+)\\),\\s*)"}cubemapSrcRegex+="(url\\((?:[^\\)]+)\\)\\s*)";urls=src.match(new RegExp(cubemapSrcRegex));function isImageCb(url){validatedUrls.push(url);if(6===validatedUrls.length){cb(validatedUrls)}}if(urls){for(i=1;7>i;i++){validateSrc(parseUrl(urls[i]),isImageCb)}return}aCubemap=validateAndGetQuerySelector(src);if(!aCubemap){return}if("A-CUBEMAP"===aCubemap.tagName&&aCubemap.srcs){return cb(aCubemap.srcs)}warn("Selector \"%s\" does not point to <a-cubemap>",src)}}},{"./debug":168}],177:[function(_dereq_,module){var styleParser=_dereq_("style-attr");module.exports.parse=function(value){var parsedData;if("string"!==typeof value){return value}parsedData=styleParser.parse(value);if(parsedData[""]){return value}return transformKeysToCamelCase(parsedData)};module.exports.stringify=function(data){if("string"===typeof data){return data}return styleParser.stringify(data)};function toCamelCase(str){return str.replace(/-([a-z])/g,function(g){return g[1].toUpperCase()})}module.exports.toCamelCase=toCamelCase;function transformKeysToCamelCase(obj){var keys=Object.keys(obj),camelCaseObj={};keys.forEach(function(key){var camelCaseKey=toCamelCase(key);camelCaseObj[camelCaseKey]=obj[key]});return camelCaseObj}module.exports.transformKeysToCamelCase=transformKeysToCamelCase},{"style-attr":35}],178:[function(_dereq_,module){var split=_dereq_("./split").split,DEFAULT_HANDEDNESS=_dereq_("../constants").DEFAULT_HANDEDNESS,AXIS_LABELS=["x","y","z","w"];module.exports.checkControllerPresentAndSetup=function(component,idPrefix,queryObject){var el=component.el,isPresent=isControllerPresent(component,idPrefix,queryObject);if(component.controllerPresent&&!component.controllerEventsActive){component.addEventListeners()}if(isPresent===component.controllerPresent){return isPresent}component.controllerPresent=isPresent;if(isPresent){component.injectTrackedControls();component.addEventListeners();el.emit("controllerconnected",{name:component.name,component:component})}else{component.removeEventListeners();el.emit("controllerdisconnected",{name:component.name,component:component})}};function isControllerPresent(component,idPrefix,queryObject){var gamepads,sceneEl=component.el.sceneEl,trackedControlsSystem,filterControllerIndex=queryObject.index||0;if(!idPrefix){return!1}trackedControlsSystem=sceneEl&&sceneEl.systems["tracked-controls"];if(!trackedControlsSystem){return!1}gamepads=trackedControlsSystem.controllers;if(!gamepads.length){return!1}return!!findMatchingController(gamepads,null,idPrefix,queryObject.hand,filterControllerIndex)}module.exports.isControllerPresent=isControllerPresent;function findMatchingController(controllers,filterIdExact,filterIdPrefix,filterHand,filterControllerIndex){var controller,filterIdPrefixes,i,j,matches,matchingControllerOccurence=0,prefix,targetControllerMatch=filterControllerIndex||0;if(filterIdPrefix&&0<=filterIdPrefix.indexOf("|")){filterIdPrefixes=split(filterIdPrefix,"|")}for(i=0;i<controllers.length;i++){controller=controllers[i];if(filterIdPrefixes){matches=!1;for(j=0;j<filterIdPrefixes.length;j++){prefix=filterIdPrefixes[j];if(prefix&&controller.id.startsWith(prefix)){matches=!0;break}}if(!matches){continue}}else if(filterIdPrefix&&controller.id.indexOf(filterIdPrefix)){continue}if(!filterIdPrefix&&controller.id!==filterIdExact){continue}if(filterHand&&controller.hand&&filterHand!==controller.hand){continue}if(filterHand&&!controller.hand){targetControllerMatch=2*filterControllerIndex+(filterHand===DEFAULT_HANDEDNESS?0:1)}if(matchingControllerOccurence===targetControllerMatch){return controller}++matchingControllerOccurence}}module.exports.findMatchingController=findMatchingController;module.exports.emitIfAxesChanged=function(component,axesMapping,evt){var axes,buttonType,changed,detail,j;for(buttonType in axesMapping){axes=axesMapping[buttonType];changed=!1;for(j=0;j<axes.length;j++){if(evt.detail.changed[axes[j]]){changed=!0}}if(!changed){continue}detail={};for(j=0;j<axes.length;j++){detail[AXIS_LABELS[j]]=evt.detail.axis[axes[j]]}component.el.emit(buttonType+"moved",detail)}};module.exports.onButtonEvent=function(id,evtName,component,hand){var mapping=hand?component.mapping[hand]:component.mapping,buttonName=mapping.buttons[id];component.el.emit(buttonName+evtName);if(component.updateModel){component.updateModel(buttonName,evtName)}}},{"../constants":93,"./split":175}],179:[function(_dereq_,module){window.glStats=function(){var _rS=null,_totalDrawArraysCalls=0,_totalDrawElementsCalls=0,_totalUseProgramCalls=0,_totalFaces=0,_totalVertices=0,_totalPoints=0,_totalBindTexures=0;function _h(f,c){return function(){c.apply(this,arguments);f.apply(this,arguments)}}WebGLRenderingContext.prototype.drawArrays=_h(WebGLRenderingContext.prototype.drawArrays,function(){_totalDrawArraysCalls++;if(arguments[0]==this.POINTS)_totalPoints+=arguments[2];else _totalVertices+=arguments[2]});WebGLRenderingContext.prototype.drawElements=_h(WebGLRenderingContext.prototype.drawElements,function(){_totalDrawElementsCalls++;_totalFaces+=arguments[1]/3;_totalVertices+=arguments[1]});WebGLRenderingContext.prototype.useProgram=_h(WebGLRenderingContext.prototype.useProgram,function(){_totalUseProgramCalls++});WebGLRenderingContext.prototype.bindTexture=_h(WebGLRenderingContext.prototype.bindTexture,function(){_totalBindTexures++});function _update(){_rS("allcalls").set(_totalDrawArraysCalls+_totalDrawElementsCalls);_rS("drawElements").set(_totalDrawElementsCalls);_rS("drawArrays").set(_totalDrawArraysCalls);_rS("bindTexture").set(_totalBindTexures);_rS("useProgram").set(_totalUseProgramCalls);_rS("glfaces").set(_totalFaces);_rS("glvertices").set(_totalVertices);_rS("glpoints").set(_totalPoints)}return{update:_update,start:function(){_totalDrawArraysCalls=0;_totalDrawElementsCalls=0;_totalUseProgramCalls=0;_totalFaces=0;_totalVertices=0;_totalPoints=0;_totalBindTexures=0},end:function(){},attach:function(r){_rS=r},values:{allcalls:{over:3e3,caption:"Calls (hook)"},drawelements:{caption:"drawElements (hook)"},drawarrays:{caption:"drawArrays (hook)"}},groups:[{caption:"WebGL",values:["allcalls","drawelements","drawarrays","useprogram","bindtexture","glfaces","glvertices","glpoints"]}],fractions:[{base:"allcalls",steps:["drawelements","drawarrays"]}]}};window.threeStats=function(renderer){var _rS=null;function _update(){_rS("renderer.info.memory.geometries").set(renderer.info.memory.geometries);_rS("renderer.info.programs").set(renderer.info.programs.length);_rS("renderer.info.memory.textures").set(renderer.info.memory.textures);_rS("renderer.info.render.calls").set(renderer.info.render.calls);_rS("renderer.info.render.faces").set(renderer.info.render.faces);_rS("renderer.info.render.points").set(renderer.info.render.points);_rS("renderer.info.render.vertices").set(renderer.info.render.vertices)}return{update:_update,start:function(){},end:function(){},attach:function(r){_rS=r},values:{"renderer.info.memory.geometries":{caption:"Geometries"},"renderer.info.memory.textures":{caption:"Textures"},"renderer.info.programs":{caption:"Programs"},"renderer.info.render.calls":{caption:"Calls"},"renderer.info.render.faces":{caption:"Faces",over:1e3},"renderer.info.render.points":{caption:"Points"},"renderer.info.render.vertices":{caption:"Vertices"}},groups:[{caption:"Three.js - Memory",values:["renderer.info.memory.geometries","renderer.info.programs","renderer.info.memory.textures"]},{caption:"Three.js - Render",values:["renderer.info.render.calls","renderer.info.render.faces","renderer.info.render.points","renderer.info.render.vertices"]}],fractions:[]}};window.BrowserStats=function(){var _rS=null,_usedJSHeapSize=0,_totalJSHeapSize=0;if(window.performance&&!performance.memory){performance.memory={usedJSHeapSize:0,totalJSHeapSize:0}}if(0===performance.memory.totalJSHeapSize){console.warn("totalJSHeapSize === 0... performance.memory is only available in Chrome .")}function _size(v){var precision=100,i=_Mathfloor(_Mathlog(v)/6.931471805599453);return _Mathround(v*precision/_Mathpow(1024,i))/precision}function _update(){_usedJSHeapSize=_size(performance.memory.usedJSHeapSize);_totalJSHeapSize=_size(performance.memory.totalJSHeapSize);_rS("memory").set(_usedJSHeapSize);_rS("total").set(_totalJSHeapSize)}return{update:_update,start:function(){_usedJSHeapSize=0},end:function(){},attach:function(r){_rS=r},values:{memory:{caption:"Used Memory",average:!0,avgMs:1e3,over:22},total:{caption:"Total Memory"}},groups:[{caption:"Browser",values:["memory","total"]}],fractions:[{base:"total",steps:["memory"]}]}};if("object"===babelHelpers.typeof(module)){module.exports={glStats:window.glStats,threeStats:window.threeStats,BrowserStats:window.BrowserStats}}},{}],180:[function(_dereq_,module){"use strict";(function(){if(!1=="performance"in window){window.performance={}}var performance=window.performance;if(!1=="now"in performance){var nowOffset=Date.now();if(performance.timing&&performance.timing.navigationStart){nowOffset=performance.timing.navigationStart}performance.now=function(){return Date.now()-nowOffset}}if(!performance.mark){performance.mark=function(){}}if(!performance.measure){performance.measure=function(){}}})();window.rStats=function(settings){function iterateKeys(array,callback){for(var keys=Object.keys(array),j=0,l=keys.length;j<l;j++){callback(keys[j])}}function importCSS(url){var element=document.createElement("link");element.href=url;element.rel="stylesheet";element.type="text/css";document.getElementsByTagName("head")[0].appendChild(element)}var _settings=settings||{},_colours=_settings.colours||["#850700","#c74900","#fcb300","#284280","#4c7c0c"],_cssRStats=(_settings.CSSPath?_settings.CSSPath:"")+"rStats.css",_css=_settings.css||["https://fonts.googleapis.com/css?family=Roboto+Condensed:400,700,300",_cssRStats];_css.forEach(function(uri){importCSS(uri)});if(!_settings.values)_settings.values={};var _base,_div,_elHeight=10,_elWidth=200,_perfCounters={};function Graph(_dom,_id,_defArg){var _def=_defArg||{},_canvas=document.createElement("canvas"),_ctx=_canvas.getContext("2d"),_max=0,_current=0,c=_def.color?_def.color:"#666666",_dotCanvas=document.createElement("canvas"),_dotCtx=_dotCanvas.getContext("2d");_dotCanvas.width=1;_dotCanvas.height=2*_elHeight;_dotCtx.fillStyle="#444444";_dotCtx.fillRect(0,0,1,2*_elHeight);_dotCtx.fillStyle=c;_dotCtx.fillRect(0,_elHeight,1,_elHeight);_dotCtx.fillStyle="#ffffff";_dotCtx.globalAlpha=.5;_dotCtx.fillRect(0,_elHeight,1,1);_dotCtx.globalAlpha=1;var _alarmCanvas=document.createElement("canvas"),_alarmCtx=_alarmCanvas.getContext("2d");_alarmCanvas.width=1;_alarmCanvas.height=2*_elHeight;_alarmCtx.fillStyle="#444444";_alarmCtx.fillRect(0,0,1,2*_elHeight);_alarmCtx.fillStyle="#b70000";_alarmCtx.fillRect(0,_elHeight,1,_elHeight);_alarmCtx.globalAlpha=.5;_alarmCtx.fillStyle="#ffffff";_alarmCtx.fillRect(0,_elHeight,1,1);_alarmCtx.globalAlpha=1;function _draw(v,alarm){_current+=.1*(v-_current);_max*=.99;if(_current>_max)_max=_current;_ctx.drawImage(_canvas,1,0,_canvas.width-1,_canvas.height,0,0,_canvas.width-1,_canvas.height);if(alarm){_ctx.drawImage(_alarmCanvas,_canvas.width-1,_canvas.height-_current*_canvas.height/_max-_elHeight)}else{_ctx.drawImage(_dotCanvas,_canvas.width-1,_canvas.height-_current*_canvas.height/_max-_elHeight)}}(function(){_canvas.width=_elWidth;_canvas.height=_elHeight;_canvas.style.width=_canvas.width+"px";_canvas.style.height=_canvas.height+"px";_canvas.className="rs-canvas";_dom.appendChild(_canvas);_ctx.fillStyle="#444444";_ctx.fillRect(0,0,_canvas.width,_canvas.height)})();return{draw:_draw}}function StackGraph(_dom,_num){var _canvas=document.createElement("canvas"),_ctx=_canvas.getContext("2d");(function(){_canvas.width=_elWidth;_canvas.height=_elHeight*_num;_canvas.style.width=_canvas.width+"px";_canvas.style.height=_canvas.height+"px";_canvas.className="rs-canvas";_dom.appendChild(_canvas);_ctx.fillStyle="#444444";_ctx.fillRect(0,0,_canvas.width,_canvas.height)})();return{draw:function(v){_ctx.drawImage(_canvas,1,0,_canvas.width-1,_canvas.height,0,0,_canvas.width-1,_canvas.height);var th=0;iterateKeys(v,function(j){var h=v[j]*_canvas.height;_ctx.fillStyle=_colours[j];_ctx.fillRect(_canvas.width-1,th,1,h);th+=h})}}}function PerfCounter(id,group){var _id=id,_time,_value=0,_total=0,_averageValue=0,_accumValue=0,_accumStart=performance.now(),_accumSamples=0,_dom=document.createElement("div"),_spanId=document.createElement("span"),_spanValue=document.createElement("div"),_spanValueText=document.createTextNode(""),_def=_settings?_settings.values[_id.toLowerCase()]:null,_graph=new Graph(_dom,_id,_def),_started=!1;_spanId.className="rs-counter-id";_spanId.textContent=_def&&_def.caption?_def.caption:_id;_spanValue.className="rs-counter-value";_spanValue.appendChild(_spanValueText);_dom.appendChild(_spanId);_dom.appendChild(_spanValue);if(group)group.div.appendChild(_dom);else _div.appendChild(_dom);_time=performance.now();function _average(v){if(_def&&_def.average){_accumValue+=v;_accumSamples++;var t=performance.now();if(t-_accumStart>=(_def.avgMs||1e3)){_averageValue=_accumValue/_accumSamples;_accumValue=0;_accumStart=t;_accumSamples=0}}}function _start(){_time=performance.now();if(_settings.userTimingAPI)performance.mark(_id+"-start");_started=!0}function _end(){_value=performance.now()-_time;if(_settings.userTimingAPI){performance.mark(_id+"-end");if(_started){performance.measure(_id,_id+"-start",_id+"-end")}}_average(_value)}function _draw(){var v=_def&&_def.average?_averageValue:_value;_spanValueText.nodeValue=_Mathround(100*v)/100;var a=_def&&(_def.below&&_value<_def.below||_def.over&&_value>_def.over);_graph.draw(_value,a);_dom.className=a?"rs-counter-base alarm":"rs-counter-base"}function _frame(){var t=performance.now(),e=t-_time;_total++;if(1e3<e){if(_def&&!1===_def.interpolate){_value=_total}else{_value=1e3*_total/e}_total=0;_time=t;_average(_value)}}function _set(v){_value=v;_average(_value)}return{set:_set,start:_start,tick:function(){_end();_start()},end:_end,frame:_frame,value:function value(){return _value},draw:_draw}}function _perf(idArg){var id=idArg.toLowerCase();if(id===void 0)id="default";if(_perfCounters[id])return _perfCounters[id];var group=null;if(_settings&&_settings.groups){iterateKeys(_settings.groups,function(j){var g=_settings.groups[parseInt(j,10)];if(!group&&-1!==g.values.indexOf(id.toLowerCase())){group=g}})}var p=new PerfCounter(id,group);_perfCounters[id]=p;return p}function _init(){if(_settings.plugins){if(!_settings.values)_settings.values={};if(!_settings.groups)_settings.groups=[];if(!_settings.fractions)_settings.fractions=[];for(var j=0;j<_settings.plugins.length;j++){_settings.plugins[j].attach(_perf);iterateKeys(_settings.plugins[j].values,function(k){_settings.values[k]=_settings.plugins[j].values[k]});_settings.groups=_settings.groups.concat(_settings.plugins[j].groups);_settings.fractions=_settings.fractions.concat(_settings.plugins[j].fractions)}}else{_settings.plugins={}}_base=document.createElement("div");_base.className="rs-base";_div=document.createElement("div");_div.className="rs-container";_div.style.height="auto";_base.appendChild(_div);document.body.appendChild(_base);if(!_settings)return;if(_settings.groups){iterateKeys(_settings.groups,function(j){var g=_settings.groups[parseInt(j,10)],div=document.createElement("div");div.className="rs-group";g.div=div;var h1=document.createElement("h1");h1.textContent=g.caption;h1.addEventListener("click",function(e){this.classList.toggle("hidden");e.preventDefault()}.bind(div));_div.appendChild(h1);_div.appendChild(div)})}if(_settings.fractions){iterateKeys(_settings.fractions,function(j){var f=_settings.fractions[parseInt(j,10)],div=document.createElement("div");div.className="rs-fraction";var legend=document.createElement("div");legend.className="rs-legend";var h=0;iterateKeys(_settings.fractions[j].steps,function(k){var p=document.createElement("p");p.textContent=_settings.fractions[j].steps[k];p.style.color=_colours[h];legend.appendChild(p);h++});div.appendChild(legend);div.style.height=h*_elHeight+"px";f.div=div;var graph=new StackGraph(div,h);f.graph=graph;_div.appendChild(div)})}}function _update(){iterateKeys(_settings.plugins,function(j){_settings.plugins[j].update()});iterateKeys(_perfCounters,function(j){_perfCounters[j].draw()});if(_settings&&_settings.fractions){iterateKeys(_settings.fractions,function(j){var f=_settings.fractions[parseInt(j,10)],v=[],base=_perfCounters[f.base.toLowerCase()];if(base){base=base.value();iterateKeys(_settings.fractions[j].steps,function(k){var s=_settings.fractions[j].steps[parseInt(k,10)].toLowerCase(),val=_perfCounters[s];if(val){v.push(val.value()/base)}})}f.graph.draw(v)})}}_init();return function(id){if(id)return _perf(id);return{element:_base,update:_update}}};if("object"===babelHelpers.typeof(module)){module.exports=window.rStats}},{}],181:[function(_dereq_,module){module.exports={base64:function(mimeType,base64){return"data:"+mimeType+";base64,"+base64},isMobile:function(){var check=!1;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=!0})(navigator.userAgent||navigator.vendor||window.opera);return check},isIOS:function(){return /(iPad|iPhone|iPod)/g.test(navigator.userAgent)},isIFrame:function(){try{return window.self!==window.top}catch(e){return!0}},appendQueryParameter:function(url,key,value){var delimiter=0>url.indexOf("?")?"?":"&";url+=delimiter+key+"="+value;return url},getQueryParameter:function(name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(location.search);return null===results?"":decodeURIComponent(results[1].replace(/\+/g," "))},isLandscapeMode:function(){return 90==window.orientation||-90==window.orientation}}},{}],182:[function(_dereq_,module){var Util=_dereq_("./util.js");function AndroidWakeLock(){var video=document.createElement("video");video.addEventListener("ended",function(){video.play()});this.request=function(){if(video.paused){video.src=Util.base64("video/webm","GkXfowEAAAAAAAAfQoaBAUL3gQFC8oEEQvOBCEKChHdlYm1Ch4ECQoWBAhhTgGcBAAAAAAAH4xFNm3RALE27i1OrhBVJqWZTrIHfTbuMU6uEFlSua1OsggEwTbuMU6uEHFO7a1OsggfG7AEAAAAAAACkAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAVSalmAQAAAAAAAEUq17GDD0JATYCNTGF2ZjU2LjQwLjEwMVdBjUxhdmY1Ni40MC4xMDFzpJAGSJTMbsLpDt/ySkipgX1fRImIQO1MAAAAAAAWVK5rAQAAAAAAADuuAQAAAAAAADLXgQFzxYEBnIEAIrWcg3VuZIaFVl9WUDmDgQEj44OEO5rKAOABAAAAAAAABrCBsLqBkB9DtnUBAAAAAAAAo+eBAKOmgQAAgKJJg0IAAV4BHsAHBIODCoAACmH2MAAAZxgz4dPSTFi5JACjloED6ACmAECSnABMQAADYAAAWi0quoCjloEH0ACmAECSnABNwAADYAAAWi0quoCjloELuACmAECSnABNgAADYAAAWi0quoCjloEPoACmAECSnABNYAADYAAAWi0quoCjloETiACmAECSnABNIAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTnghdwo5aBAAAApgBAkpwATOAAA2AAAFotKrqAo5aBA+gApgBAkpwATMAAA2AAAFotKrqAo5aBB9AApgBAkpwATIAAA2AAAFotKrqAo5aBC7gApgBAkpwATEAAA2AAAFotKrqAo5aBD6AApgDAkpwAQ2AAA2AAAFotKrqAo5aBE4gApgBAkpwATCAAA2AAAFotKrqAH0O2dQEAAAAAAACU54Iu4KOWgQAAAKYAQJKcAEvAAANgAABaLSq6gKOWgQPoAKYAQJKcAEtgAANgAABaLSq6gKOWgQfQAKYAQJKcAEsAAANgAABaLSq6gKOWgQu4AKYAQJKcAEqAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEogAANgAABaLSq6gKOWgROIAKYAQJKcAEnAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCRlCjloEAAACmAECSnABJgAADYAAAWi0quoCjloED6ACmAECSnABJIAADYAAAWi0quoCjloEH0ACmAMCSnABDYAADYAAAWi0quoCjloELuACmAECSnABI4AADYAAAWi0quoCjloEPoACmAECSnABIoAADYAAAWi0quoCjloETiACmAECSnABIYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngl3Ao5aBAAAApgBAkpwASCAAA2AAAFotKrqAo5aBA+gApgBAkpwASAAAA2AAAFotKrqAo5aBB9AApgBAkpwAR8AAA2AAAFotKrqAo5aBC7gApgBAkpwAR4AAA2AAAFotKrqAo5aBD6AApgBAkpwAR2AAA2AAAFotKrqAo5aBE4gApgBAkpwARyAAA2AAAFotKrqAH0O2dQEAAAAAAACU54J1MKOWgQAAAKYAwJKcAENgAANgAABaLSq6gKOWgQPoAKYAQJKcAEbgAANgAABaLSq6gKOWgQfQAKYAQJKcAEagAANgAABaLSq6gKOWgQu4AKYAQJKcAEaAAANgAABaLSq6gKOWgQ+gAKYAQJKcAEZAAANgAABaLSq6gKOWgROIAKYAQJKcAEYAAANgAABaLSq6gB9DtnUBAAAAAAAAlOeCjKCjloEAAACmAECSnABF4AADYAAAWi0quoCjloED6ACmAECSnABFwAADYAAAWi0quoCjloEH0ACmAECSnABFoAADYAAAWi0quoCjloELuACmAECSnABFgAADYAAAWi0quoCjloEPoACmAMCSnABDYAADYAAAWi0quoCjloETiACmAECSnABFYAADYAAAWi0quoAfQ7Z1AQAAAAAAAJTngqQQo5aBAAAApgBAkpwARUAAA2AAAFotKrqAo5aBA+gApgBAkpwARSAAA2AAAFotKrqAo5aBB9AApgBAkpwARQAAA2AAAFotKrqAo5aBC7gApgBAkpwARQAAA2AAAFotKrqAo5aBD6AApgBAkpwAROAAA2AAAFotKrqAo5aBE4gApgBAkpwARMAAA2AAAFotKrqAH0O2dQEAAAAAAACU54K7gKOWgQAAAKYAQJKcAESgAANgAABaLSq6gKOWgQPoAKYAQJKcAESAAANgAABaLSq6gKOWgQfQAKYAwJKcAENgAANgAABaLSq6gKOWgQu4AKYAQJKcAERgAANgAABaLSq6gKOWgQ+gAKYAQJKcAERAAANgAABaLSq6gKOWgROIAKYAQJKcAEQgAANgAABaLSq6gB9DtnUBAAAAAAAAlOeC0vCjloEAAACmAECSnABEIAADYAAAWi0quoCjloED6ACmAECSnABEAAADYAAAWi0quoCjloEH0ACmAECSnABD4AADYAAAWi0quoCjloELuACmAECSnABDwAADYAAAWi0quoCjloEPoACmAECSnABDoAADYAAAWi0quoCjloETiACmAECSnABDgAADYAAAWi0quoAcU7trAQAAAAAAABG7j7OBALeK94EB8YIBd/CBAw==");video.play()}};this.release=function(){video.pause();video.src=""}}function iOSWakeLock(){var timer=null;this.request=function(){if(!timer){timer=setInterval(function(){window.location.href="/";setTimeout(window.stop,0)},15e3)}};this.release=function(){if(timer){clearInterval(timer);timer=null}}}module.exports=function(){var userAgent=navigator.userAgent||navigator.vendor||window.opera;if(userAgent.match(/iPhone/i)||userAgent.match(/iPod/i)){return iOSWakeLock}else{return AndroidWakeLock}}()},{"./util.js":181}]},{},[148])(148)});