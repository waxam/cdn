export class Undoer{constructor(callback,zero=null){this._duringUpdate=!1,this._stack=[zero],this._ctrl=document.createElement("div"),this._ctrl.setAttribute("aria-hidden","true"),this._ctrl.style.opacity=0,this._ctrl.style.position="fixed",this._ctrl.style.top="-1000px",this._ctrl.style.pointerEvents="none",this._ctrl.tabIndex=-1,this._ctrl.contentEditable=!0,this._ctrl.textContent="0",this._ctrl.style.visibility="hidden",this._ctrl.addEventListener("focus",ev=>{window.setTimeout(()=>{this._ctrl.blur()},0)}),this._ctrl.addEventListener("input",ev=>{this._duringUpdate||callback(this.data);const s=window.getSelection();s.containsNode(this._ctrl,!0)&&s.removeAllRanges()})}get _depth(){return+this._ctrl.textContent||0}get data(){return this._stack[this._depth]}push(data,parent){this._ctrl.parentNode||(parent||document.body).appendChild(this._ctrl);const nextID=this._depth+1;this._stack.splice(nextID,this._stack.length-nextID,data);const previousFocus=document.activeElement;try{this._duringUpdate=!0,this._ctrl.style.visibility=null,this._ctrl.focus(),document.execCommand("selectAll"),document.execCommand("insertText",!1,nextID)}finally{this._duringUpdate=!1,this._ctrl.style.visibility="hidden"}previousFocus&&previousFocus.focus()}}