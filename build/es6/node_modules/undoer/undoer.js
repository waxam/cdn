export class Undoer{constructor(t,e=null){this._duringUpdate=!1,this._stack=[e],this._ctrl=document.createElement("div"),this._ctrl.setAttribute("aria-hidden","true"),this._ctrl.style.opacity=0,this._ctrl.style.position="fixed",this._ctrl.style.top="-1000px",this._ctrl.style.pointerEvents="none",this._ctrl.tabIndex=-1,this._ctrl.contentEditable=!0,this._ctrl.textContent="0",this._ctrl.style.visibility="hidden",this._ctrl.addEventListener("focus",t=>{window.setTimeout(()=>{this._ctrl.blur()},0)}),this._ctrl.addEventListener("input",e=>{this._duringUpdate||t(this.data);const i=window.getSelection();i.containsNode(this._ctrl,!0)&&i.removeAllRanges()})}get _depth(){return+this._ctrl.textContent||0}get data(){return this._stack[this._depth]}push(t,e){this._ctrl.parentNode||(e||document.body).appendChild(this._ctrl);const i=this._depth+1;this._stack.splice(i,this._stack.length-i,t);const s=document.activeElement;try{this._duringUpdate=!0,this._ctrl.style.visibility=null,this._ctrl.focus(),document.execCommand("selectAll"),document.execCommand("insertText",!1,i)}finally{this._duringUpdate=!1,this._ctrl.style.visibility="hidden"}s&&s.focus()}}