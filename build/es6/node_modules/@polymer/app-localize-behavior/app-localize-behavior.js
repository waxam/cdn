import"../polymer/polymer-legacy.js";import"../iron-ajax/iron-ajax.js";import IntlMessageFormat from"../../intl-messageformat/src/main.js";window.IntlMessageFormat=IntlMessageFormat;var assign=Object.assign?Object.assign.bind(Object):function(destination,source){for(var prop in source)source.hasOwnProperty(prop)&&(destination[prop]=source[prop]);return destination};export const AppLocalizeBehavior={__localizationCache:{requests:{},messages:{},ajax:null},properties:{language:{type:String},resources:{type:Object},formats:{type:Object,value:function(){return{}}},useKeyIfMissing:{type:Boolean,value:!1},localize:{type:Function,computed:"__computeLocalize(language, resources, formats)"},bubbleEvent:{type:Boolean,value:!1}},loadResources:function(path,language,merge){var proto=this.constructor.prototype;this.__checkLocalizationCache(proto);var request,ajax=proto.__localizationCache.ajax;function onRequestResponse(event){this.__onRequestResponse(event,language,merge)}(ajax||(ajax=proto.__localizationCache.ajax=document.createElement("iron-ajax")),request=proto.__localizationCache.requests[path])?request.completes.then(onRequestResponse.bind(this),this.__onRequestError.bind(this)):(ajax.url=path,(request=ajax.generateRequest()).completes.then(onRequestResponse.bind(this),this.__onRequestError.bind(this)),proto.__localizationCache.requests[path]=request)},__computeLocalize:function(language,resources,formats){var proto=this.constructor.prototype;return this.__checkLocalizationCache(proto),proto.__localizationCache||(proto.__localizationCache={requests:{},messages:{},ajax:null}),proto.__localizationCache.messages={},function(){var key=arguments[0];if(key&&resources&&language&&resources[language]){var translatedValue=resources[language][key];if(!translatedValue)return this.useKeyIfMissing?key:"";var messageKey=key+translatedValue,translatedMessage=proto.__localizationCache.messages[messageKey];translatedMessage||(translatedMessage=new IntlMessageFormat(translatedValue,language,formats),proto.__localizationCache.messages[messageKey]=translatedMessage);for(var args={},i=1;i<arguments.length;i+=2)args[arguments[i]]=arguments[i+1];return translatedMessage.format(args)}}.bind(this)},__onRequestResponse:function(event,language,merge){var propertyUpdates={},newResources=event.response;if(merge?language?(propertyUpdates.resources=assign({},this.resources||{}),propertyUpdates["resources."+language]=assign(propertyUpdates.resources[language]||{},newResources)):propertyUpdates.resources=assign(this.resources,newResources):language?(propertyUpdates.resources={},propertyUpdates.resources[language]=newResources,propertyUpdates["resources."+language]=newResources):propertyUpdates.resources=newResources,this.setProperties)this.setProperties(propertyUpdates);else for(var key in propertyUpdates)this.set(key,propertyUpdates[key]);this.fire("app-localize-resources-loaded",event,{bubbles:this.bubbleEvent})},__onRequestError:function(event){this.fire("app-localize-resources-error")},__checkLocalizationCache:function(proto){void 0!==proto&&void 0===proto.__localizationCache&&(proto.__localizationCache={requests:{},messages:{},ajax:null})}};