import"../polymer/polymer-legacy.js";import{Polymer}from"../polymer/lib/legacy/polymer-fn.js";import{dom}from"../polymer/lib/legacy/polymer.dom.js";Polymer({is:"iron-location",properties:{path:{type:String,notify:!0,value:function(){return window.decodeURIComponent(window.location.pathname)}},query:{type:String,notify:!0,value:function(){return window.location.search.slice(1)}},hash:{type:String,notify:!0,value:function(){return window.decodeURIComponent(window.location.hash.slice(1))}},dwellTime:{type:Number,value:2e3},urlSpaceRegex:{type:String,value:""},encodeSpaceAsPlusInQuery:{type:Boolean,value:!1},_urlSpaceRegExp:{computed:"_makeRegExp(urlSpaceRegex)"},_lastChangedAt:{type:Number},_initialized:{type:Boolean,value:!1}},hostAttributes:{hidden:!0},observers:["_updateUrl(path, query, hash)"],created:function(){this.__location=window.location},attached:function(){this.listen(window,"hashchange","_hashChanged"),this.listen(window,"location-changed","_urlChanged"),this.listen(window,"popstate","_urlChanged"),this.listen(document.body,"click","_globalOnClick"),this._lastChangedAt=window.performance.now()-(this.dwellTime-200),this._initialized=!0,this._urlChanged()},detached:function(){this.unlisten(window,"hashchange","_hashChanged"),this.unlisten(window,"location-changed","_urlChanged"),this.unlisten(window,"popstate","_urlChanged"),this.unlisten(document.body,"click","_globalOnClick"),this._initialized=!1},_hashChanged:function(){this.hash=window.decodeURIComponent(this.__location.hash.substring(1))},_urlChanged:function(){this._dontUpdateUrl=!0,this._hashChanged(),this.path=window.decodeURIComponent(this.__location.pathname),this.query=this.__location.search.substring(1),this._dontUpdateUrl=!1,this._updateUrl()},_getUrl:function(){var partiallyEncodedPath=window.encodeURI(this.path).replace(/\#/g,"%23").replace(/\?/g,"%3F"),partiallyEncodedQuery="";this.query&&(partiallyEncodedQuery="?"+this.query.replace(/\#/g,"%23"),partiallyEncodedQuery=this.encodeSpaceAsPlusInQuery?partiallyEncodedQuery.replace(/\+/g,"%2B").replace(/ /g,"+").replace(/%20/g,"+"):partiallyEncodedQuery.replace(/\+/g,"%2B").replace(/ /g,"%20"));var partiallyEncodedHash="";return this.hash&&(partiallyEncodedHash="#"+window.encodeURI(this.hash)),partiallyEncodedPath+partiallyEncodedQuery+partiallyEncodedHash},_updateUrl:function(){if(!this._dontUpdateUrl&&this._initialized&&(this.path!==window.decodeURIComponent(this.__location.pathname)||this.query!==this.__location.search.substring(1)||this.hash!==window.decodeURIComponent(this.__location.hash.substring(1)))){var newUrl=this._getUrl(),fullNewUrl=new URL(newUrl,this.__location.protocol+"//"+this.__location.host).href,now=window.performance.now(),shouldReplace=this._lastChangedAt+this.dwellTime>now;this._lastChangedAt=now,shouldReplace?window.history.replaceState({},"",fullNewUrl):window.history.pushState({},"",fullNewUrl),this.fire("location-changed",{},{node:window})}},_globalOnClick:function(event){if(!event.defaultPrevented){var href=this._getSameOriginLinkHref(event);href&&(event.preventDefault(),href!==this.__location.href&&(window.history.pushState({},"",href),this.fire("location-changed",{},{node:window})))}},_getSameOriginLinkHref:function(event){if(0!==event.button)return null;if(event.metaKey||event.ctrlKey)return null;for(var eventPath=dom(event).path,anchor=null,i=0;i<eventPath.length;i++){var element=eventPath[i];if("A"===element.tagName&&element.href){anchor=element;break}}if(!anchor)return null;if("_blank"===anchor.target)return null;if(("_top"===anchor.target||"_parent"===anchor.target)&&window.top!==window)return null;if(anchor.download)return null;var url,origin,urlOrigin,href=anchor.href;if(url=null!=document.baseURI?new URL(href,document.baseURI):new URL(href),origin=this.__location.origin?this.__location.origin:this.__location.protocol+"//"+this.__location.host,url.origin)urlOrigin=url.origin;else{var urlHost=url.host,urlPort=url.port,urlProtocol=url.protocol;("https:"===urlProtocol&&"443"===urlPort||"http:"===urlProtocol&&"80"===urlPort)&&(urlHost=url.hostname),urlOrigin=urlProtocol+"//"+urlHost}if(urlOrigin!==origin)return null;var normalizedHref=url.pathname+url.search+url.hash;return"/"!==normalizedHref[0]&&(normalizedHref="/"+normalizedHref),this._urlSpaceRegExp&&!this._urlSpaceRegExp.test(normalizedHref)?null:new URL(normalizedHref,this.__location.href).href},_makeRegExp:function(urlSpaceRegex){return RegExp(urlSpaceRegex)}});