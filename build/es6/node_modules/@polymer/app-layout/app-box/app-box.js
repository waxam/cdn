import"../../polymer/polymer-legacy.js";import"../../iron-flex-layout/iron-flex-layout.js";import{IronResizableBehavior}from"../../iron-resizable-behavior/iron-resizable-behavior.js";import{Polymer}from"../../polymer/lib/legacy/polymer-fn.js";import{html}from"../../polymer/lib/utils/html-tag.js";import{AppScrollEffectsBehavior}from"../app-scroll-effects/app-scroll-effects-behavior.js";Polymer({_template:html`
    <style>
      :host {
        position: relative;
        display: block;
      }

      #background {
        @apply --layout-fit;
        overflow: hidden;
        height: 100%;
      }

      #backgroundFrontLayer {
        min-height: 100%;
        pointer-events: none;
        background-size: cover;
        @apply --app-box-background-front-layer;
      }

      #contentContainer {
        position: relative;
        width: 100%;
        height: 100%;
      }

      :host([disabled]),
      :host([disabled]) #backgroundFrontLayer {
        transition: none !important;
      }
    </style>

    <div id="background">
      <div id="backgroundFrontLayer">
        <slot name="background"></slot>
      </div>
    </div>
    <div id="contentContainer">
      <slot></slot>
    </div>
`,is:"app-box",behaviors:[AppScrollEffectsBehavior,IronResizableBehavior],listeners:{"iron-resize":"_resizeHandler"},_progress:0,attached:function(){this.resetLayout()},_debounceRaf:function(fn){var self=this;this._raf&&window.cancelAnimationFrame(this._raf),this._raf=window.requestAnimationFrame(function(){self._raf=null,fn.call(self)})},resetLayout:function(){this._debounceRaf(function(){if(0!==this.offsetWidth||0!==this.offsetHeight){var scrollTop=this._clampedScrollTop,savedDisabled=this.disabled;this.disabled=!0,this._elementTop=this._getElementTop(),this._elementHeight=this.offsetHeight,this._cachedScrollTargetHeight=this._scrollTargetHeight,this._setUpEffect(),this._updateScrollState(scrollTop),this.disabled=savedDisabled}})},_getElementTop:function(){for(var currentNode=this,top=0;currentNode&&currentNode!==this.scrollTarget;)top+=currentNode.offsetTop,currentNode=currentNode.offsetParent;return top},_updateScrollState:function(scrollTop){if(this.isOnScreen()){var viewportTop=this._elementTop-scrollTop;this._progress=1-(viewportTop+this._elementHeight)/this._cachedScrollTargetHeight,this._runEffects(this._progress,scrollTop)}},isOnScreen:function(){return this._elementTop<this._scrollTop+this._cachedScrollTargetHeight&&this._elementTop+this._elementHeight>this._scrollTop},_resizeHandler:function(){this.resetLayout()},_getDOMRef:function(id){return"background"===id?this.$.background:"backgroundFrontLayer"===id?this.$.backgroundFrontLayer:void 0},getScrollState:function(){return{progress:this._progress}}});