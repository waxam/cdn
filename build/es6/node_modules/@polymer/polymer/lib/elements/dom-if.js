/**
@license
Copyright (c) 2017 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
*/
import{PolymerElement as e}from"../../polymer-element.js";import{templatize as t}from"../utils/templatize.js";import{Debouncer as i}from"../utils/debounce.js";import{enqueueDebouncer as s,flush as n}from"../utils/flush.js";import{microTask as r}from"../utils/async.js";import{root as o}from"../utils/path.js";import{wrap as _}from"../utils/wrap.js";import{hideElementsGlobally as l}from"../utils/hide-template-controls.js";export class DomIf extends e{static get is(){return"dom-if"}static get template(){return null}static get properties(){return{if:{type:Boolean,observer:"__debounceRender"},restamp:{type:Boolean,observer:"__debounceRender"}}}constructor(){super(),this.__renderDebouncer=null,this.__invalidProps=null,this.__instance=null,this._lastIf=!1,this.__ctor=null,this.__hideTemplateChildren__=!1}__debounceRender(){this.__renderDebouncer=i.debounce(this.__renderDebouncer,r,()=>this.__render()),s(this.__renderDebouncer)}disconnectedCallback(){super.disconnectedCallback();const e=_(this).parentNode;e&&(e.nodeType!=Node.DOCUMENT_FRAGMENT_NODE||_(e).host)||this.__teardownInstance()}connectedCallback(){super.connectedCallback(),l()||(this.style.display="none"),this.if&&this.__debounceRender()}render(){n()}__render(){if(this.if){if(!this.__ensureInstance())return;this._showHideChildren()}else this.restamp&&this.__teardownInstance();!this.restamp&&this.__instance&&this._showHideChildren(),this.if!=this._lastIf&&(this.dispatchEvent(new CustomEvent("dom-change",{bubbles:!0,composed:!0})),this._lastIf=this.if)}__ensureInstance(){let e=_(this).parentNode;if(e){if(!this.__ctor){let e=_(this).querySelector("template");if(!e){let e=new MutationObserver(()=>{if(!_(this).querySelector("template"))throw new Error("dom-if requires a <template> child");e.disconnect(),this.__render()});return e.observe(this,{childList:!0}),!1}this.__ctor=t(e,this,{mutableData:!0,forwardHostProp:function(e,t){this.__instance&&(this.if?this.__instance.forwardHostProp(e,t):(this.__invalidProps=this.__invalidProps||Object.create(null),this.__invalidProps[o(e)]=!0))}})}if(this.__instance){this.__syncHostProperties();let t=this.__instance.children;if(t&&t.length){if(_(this).previousSibling!==t[t.length-1])for(let i,s=0;s<t.length&&(i=t[s]);s++)_(e).insertBefore(i,this)}}else this.__instance=new this.__ctor,_(e).insertBefore(this.__instance.root,this)}return!0}__syncHostProperties(){let e=this.__invalidProps;if(e){for(let t in e)this.__instance._setPendingProperty(t,this.__dataHost[t]);this.__invalidProps=null,this.__instance._flushProperties()}}__teardownInstance(){if(this.__instance){let e=this.__instance.children;if(e&&e.length){let t=_(e[0]).parentNode;if(t){t=_(t);for(let i,s=0;s<e.length&&(i=e[s]);s++)t.removeChild(i)}}this.__instance=null,this.__invalidProps=null}}_showHideChildren(){let e=this.__hideTemplateChildren__||!this.if;this.__instance&&this.__instance._showHideChildren(e)}}customElements.define(DomIf.is,DomIf);