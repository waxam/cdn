import{PolymerElement}from"../../polymer-element.js";import{templatize}from"../utils/templatize.js";import{Debouncer}from"../utils/debounce.js";import{enqueueDebouncer,flush}from"../utils/flush.js";import{microTask}from"../utils/async.js";import{root}from"../utils/path.js";import{wrap}from"../utils/wrap.js";export class DomIf extends PolymerElement{static get is(){return"dom-if"}static get template(){return null}static get properties(){return{if:{type:Boolean,observer:"__debounceRender"},restamp:{type:Boolean,observer:"__debounceRender"}}}constructor(){super(),this.__renderDebouncer=null,this.__invalidProps=null,this.__instance=null,this._lastIf=!1,this.__ctor=null,this.__hideTemplateChildren__=!1}__debounceRender(){this.__renderDebouncer=Debouncer.debounce(this.__renderDebouncer,microTask,()=>this.__render()),enqueueDebouncer(this.__renderDebouncer)}disconnectedCallback(){super.disconnectedCallback();const parent=wrap(this).parentNode;parent&&(parent.nodeType!=Node.DOCUMENT_FRAGMENT_NODE||wrap(parent).host)||this.__teardownInstance()}connectedCallback(){super.connectedCallback(),this.style.display="none",this.if&&this.__debounceRender()}render(){flush()}__render(){if(this.if){if(!this.__ensureInstance())return;this._showHideChildren()}else this.restamp&&this.__teardownInstance();!this.restamp&&this.__instance&&this._showHideChildren(),this.if!=this._lastIf&&(this.dispatchEvent(new CustomEvent("dom-change",{bubbles:!0,composed:!0})),this._lastIf=this.if)}__ensureInstance(){let parentNode=wrap(this).parentNode;if(parentNode){if(!this.__ctor){let template=wrap(this).querySelector("template");if(!template){let observer=new MutationObserver(()=>{if(!wrap(this).querySelector("template"))throw new Error("dom-if requires a <template> child");observer.disconnect(),this.__render()});return observer.observe(this,{childList:!0}),!1}this.__ctor=templatize(template,this,{mutableData:!0,forwardHostProp:function(prop,value){this.__instance&&(this.if?this.__instance.forwardHostProp(prop,value):(this.__invalidProps=this.__invalidProps||Object.create(null),this.__invalidProps[root(prop)]=!0))}})}if(this.__instance){this.__syncHostProperties();let c$=this.__instance.children;if(c$&&c$.length){if(wrap(this).previousSibling!==c$[c$.length-1])for(let n,i=0;i<c$.length&&(n=c$[i]);i++)wrap(parentNode).insertBefore(n,this)}}else this.__instance=new this.__ctor,wrap(parentNode).insertBefore(this.__instance.root,this)}return!0}__syncHostProperties(){let props=this.__invalidProps;if(props){for(let prop in props)this.__instance._setPendingProperty(prop,this.__dataHost[prop]);this.__invalidProps=null,this.__instance._flushProperties()}}__teardownInstance(){if(this.__instance){let c$=this.__instance.children;if(c$&&c$.length){let parent=wrap(c$[0]).parentNode;if(parent){parent=wrap(parent);for(let n,i=0;i<c$.length&&(n=c$[i]);i++)parent.removeChild(n)}}this.__instance=null,this.__invalidProps=null}}_showHideChildren(){let hidden=this.__hideTemplateChildren__||!this.if;this.__instance&&this.__instance._showHideChildren(hidden)}}customElements.define(DomIf.is,DomIf);