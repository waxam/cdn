/**
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at
http://polymer.github.io/LICENSE.txt The complete set of authors may be found at
http://polymer.github.io/AUTHORS.txt The complete set of contributors may be
found at http://polymer.github.io/CONTRIBUTORS.txt Code distributed by Google as
part of the polymer project is also subject to an additional IP rights grant
found at http://polymer.github.io/PATENTS.txt
*/
import"../polymer/polymer-legacy.js";import{Polymer}from"../polymer/lib/legacy/polymer-fn.js";Polymer({is:"app-route",properties:{route:{type:Object,notify:!0},pattern:{type:String},data:{type:Object,value:function(){return{}},notify:!0},autoActivate:{type:Boolean,value:!1},_queryParamsUpdating:{type:Boolean,value:!1},queryParams:{type:Object,value:function(){return{}},notify:!0},tail:{type:Object,value:function(){return{path:null,prefix:null,__queryParams:null}},notify:!0},active:{type:Boolean,notify:!0,readOnly:!0},_matched:{type:String,value:""}},observers:["__tryToMatch(route.path, pattern)","__updatePathOnDataChange(data.*)","__tailPathChanged(tail.path)","__routeQueryParamsChanged(route.__queryParams)","__tailQueryParamsChanged(tail.__queryParams)","__queryParamsChanged(queryParams.*)"],created:function(){this.linkPaths("route.__queryParams","tail.__queryParams"),this.linkPaths("tail.__queryParams","route.__queryParams")},__routeQueryParamsChanged:function(queryParams){if(queryParams&&this.tail){if(this.tail.__queryParams!==queryParams&&this.set("tail.__queryParams",queryParams),!this.active||this._queryParamsUpdating)return;var copyOfQueryParams={},anythingChanged=!1;for(var key in queryParams)copyOfQueryParams[key]=queryParams[key],!anythingChanged&&this.queryParams&&queryParams[key]===this.queryParams[key]||(anythingChanged=!0);for(var key in this.queryParams)if(anythingChanged||!(key in queryParams)){anythingChanged=!0;break}if(!anythingChanged)return;this._queryParamsUpdating=!0,this.set("queryParams",copyOfQueryParams),this._queryParamsUpdating=!1}},__tailQueryParamsChanged:function(queryParams){queryParams&&this.route&&this.route.__queryParams!=queryParams&&this.set("route.__queryParams",queryParams)},__queryParamsChanged:function(changes){this.active&&!this._queryParamsUpdating&&this.set("route.__"+changes.path,changes.value)},__resetProperties:function(){this._setActive(!1),this._matched=null},__tryToMatch:function(){if(this.route){var path=this.route.path,pattern=this.pattern;if(this.autoActivate&&""===path&&(path="/"),pattern)if(path){for(var remainingPieces=path.split("/"),patternPieces=pattern.split("/"),matched=[],namedMatches={},i=0;i<patternPieces.length;i++){var patternPiece=patternPieces[i];if(!patternPiece&&""!==patternPiece)break;var pathPiece=remainingPieces.shift();if(!pathPiece&&""!==pathPiece)return void this.__resetProperties();if(matched.push(pathPiece),":"==patternPiece.charAt(0))namedMatches[patternPiece.slice(1)]=pathPiece;else if(patternPiece!==pathPiece)return void this.__resetProperties()}this._matched=matched.join("/");var propertyUpdates={};this.active||(propertyUpdates.active=!0);var tailPrefix=this.route.prefix+this._matched,tailPath=remainingPieces.join("/");for(var key in remainingPieces.length>0&&(tailPath="/"+tailPath),this.tail&&this.tail.prefix===tailPrefix&&this.tail.path===tailPath||(propertyUpdates.tail={prefix:tailPrefix,path:tailPath,__queryParams:this.route.__queryParams}),propertyUpdates.data=namedMatches,this._dataInUrl={},namedMatches)this._dataInUrl[key]=namedMatches[key];this.setProperties?this.setProperties(propertyUpdates,!0):this.__setMulti(propertyUpdates)}else this.__resetProperties()}},__tailPathChanged:function(path){if(this.active){var tailPath=path,newPath=this._matched;tailPath&&("/"!==tailPath.charAt(0)&&(tailPath="/"+tailPath),newPath+=tailPath),this.set("route.path",newPath)}},__updatePathOnDataChange:function(){if(this.route&&this.active){var newPath=this.__getLink({});newPath!==this.__getLink(this._dataInUrl)&&this.set("route.path",newPath)}},__getLink:function(overrideValues){var values={tail:null};for(var key in this.data)values[key]=this.data[key];for(var key in overrideValues)values[key]=overrideValues[key];var interp=this.pattern.split("/").map((function(value){return":"==value[0]&&(value=values[value.slice(1)]),value}),this);return values.tail&&values.tail.path&&(interp.length>0&&"/"===values.tail.path.charAt(0)?interp.push(values.tail.path.slice(1)):interp.push(values.tail.path)),interp.join("/")},__setMulti:function(setObj){for(var property in setObj)this._propertySetter(property,setObj[property]);void 0!==setObj.data&&(this._pathEffector("data",this.data),this._notifyChange("data")),void 0!==setObj.active&&(this._pathEffector("active",this.active),this._notifyChange("active")),void 0!==setObj.tail&&(this._pathEffector("tail",this.tail),this._notifyChange("tail"))}});