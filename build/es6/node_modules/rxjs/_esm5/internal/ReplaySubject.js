import*as tslib_1 from"../../../tslib/tslib.es6.js";import{Subject}from"./Subject.js";import{queue}from"./scheduler/queue.js";import{Subscription}from"./Subscription.js";import{ObserveOnSubscriber}from"./operators/observeOn.js";import{ObjectUnsubscribedError}from"./util/ObjectUnsubscribedError.js";import{SubjectSubscription}from"./SubjectSubscription.js";var ReplaySubject=function(_super){tslib_1.__extends(ReplaySubject,_super);function ReplaySubject(bufferSize,windowTime,scheduler){var _NumberPOSITIVE_INFINITY=Number.POSITIVE_INFINITY;if(void 0===bufferSize){bufferSize=_NumberPOSITIVE_INFINITY}if(void 0===windowTime){windowTime=_NumberPOSITIVE_INFINITY}var _this=_super.call(this)||this;_this.scheduler=scheduler;_this._events=[];_this._infiniteTimeWindow=!1;_this._bufferSize=1>bufferSize?1:bufferSize;_this._windowTime=1>windowTime?1:windowTime;if(windowTime===_NumberPOSITIVE_INFINITY){_this._infiniteTimeWindow=!0;_this.next=_this.nextInfiniteTimeWindow}else{_this.next=_this.nextTimeWindow}return _this}ReplaySubject.prototype.nextInfiniteTimeWindow=function(value){var _events=this._events;_events.push(value);if(_events.length>this._bufferSize){_events.shift()}_super.prototype.next.call(this,value)};ReplaySubject.prototype.nextTimeWindow=function(value){this._events.push(new ReplayEvent(this._getNow(),value));this._trimBufferThenGetEvents();_super.prototype.next.call(this,value)};ReplaySubject.prototype._subscribe=function(subscriber){var _infiniteTimeWindow=this._infiniteTimeWindow,_events=_infiniteTimeWindow?this._events:this._trimBufferThenGetEvents(),scheduler=this.scheduler,len=_events.length,subscription;if(this.closed){throw new ObjectUnsubscribedError}else if(this.isStopped||this.hasError){subscription=Subscription.EMPTY}else{this.observers.push(subscriber);subscription=new SubjectSubscription(this,subscriber)}if(scheduler){subscriber.add(subscriber=new ObserveOnSubscriber(subscriber,scheduler))}if(_infiniteTimeWindow){for(var i=0;i<len&&!subscriber.closed;i++){subscriber.next(_events[i])}}else{for(var i=0;i<len&&!subscriber.closed;i++){subscriber.next(_events[i].value)}}if(this.hasError){subscriber.error(this.thrownError)}else if(this.isStopped){subscriber.complete()}return subscription};ReplaySubject.prototype._getNow=function(){return(this.scheduler||queue).now()};ReplaySubject.prototype._trimBufferThenGetEvents=function(){var now=this._getNow(),_bufferSize=this._bufferSize,_windowTime=this._windowTime,_events=this._events,eventsCount=_events.length,spliceCount=0;while(spliceCount<eventsCount){if(now-_events[spliceCount].time<_windowTime){break}spliceCount++}if(eventsCount>_bufferSize){spliceCount=Math.max(spliceCount,eventsCount-_bufferSize)}if(0<spliceCount){_events.splice(0,spliceCount)}return _events};return ReplaySubject}(Subject);export{ReplaySubject};var ReplayEvent=function(){return function(time,value){this.time=time;this.value=value}}();