import*as tslib_1 from"../../../../tslib/tslib.es6.js";import{isScheduler}from"../util/isScheduler.js";import{isArray}from"../util/isArray.js";import{OuterSubscriber}from"../OuterSubscriber.js";import{subscribeToResult}from"../util/subscribeToResult.js";import{fromArray}from"./fromArray.js";var NONE={};export function combineLatest(){for(var observables=[],_i=0;_i<arguments.length;_i++){observables[_i]=arguments[_i]}var resultSelector=null,scheduler=null;if(isScheduler(observables[observables.length-1])){scheduler=observables.pop()}if("function"===typeof observables[observables.length-1]){resultSelector=observables.pop()}if(1===observables.length&&isArray(observables[0])){observables=observables[0]}return fromArray(observables,scheduler).lift(new CombineLatestOperator(resultSelector))}var CombineLatestOperator=function(){function CombineLatestOperator(resultSelector){this.resultSelector=resultSelector}CombineLatestOperator.prototype.call=function(subscriber,source){return source.subscribe(new CombineLatestSubscriber(subscriber,this.resultSelector))};return CombineLatestOperator}();export{CombineLatestOperator};var CombineLatestSubscriber=function(_super){tslib_1.__extends(CombineLatestSubscriber,_super);function CombineLatestSubscriber(destination,resultSelector){var _this=_super.call(this,destination)||this;_this.resultSelector=resultSelector;_this.active=0;_this.values=[];_this.observables=[];return _this}CombineLatestSubscriber.prototype._next=function(observable){this.values.push(NONE);this.observables.push(observable)};CombineLatestSubscriber.prototype._complete=function(){var observables=this.observables,len=observables.length;if(0===len){this.destination.complete()}else{this.active=len;this.toRespond=len;for(var i=0,observable;i<len;i++){observable=observables[i];this.add(subscribeToResult(this,observable,observable,i))}}};CombineLatestSubscriber.prototype.notifyComplete=function(){if(0===(this.active-=1)){this.destination.complete()}};CombineLatestSubscriber.prototype.notifyNext=function(outerValue,innerValue,outerIndex){var values=this.values,oldVal=values[outerIndex],toRespond=!this.toRespond?0:oldVal===NONE?--this.toRespond:this.toRespond;values[outerIndex]=innerValue;if(0===toRespond){if(this.resultSelector){this._tryResultSelector(values)}else{this.destination.next(values.slice())}}};CombineLatestSubscriber.prototype._tryResultSelector=function(values){var result;try{result=this.resultSelector.apply(this,values)}catch(err){this.destination.error(err);return}this.destination.next(result)};return CombineLatestSubscriber}(OuterSubscriber);export{CombineLatestSubscriber};