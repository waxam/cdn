import*as tslib_1 from"../../../../tslib/tslib.es6.js";import{Subscriber}from"../Subscriber.js";export function refCount(){return function(source){return source.lift(new RefCountOperator(source))}}var RefCountOperator=function(){function RefCountOperator(connectable){this.connectable=connectable}RefCountOperator.prototype.call=function(subscriber,source){var connectable=this.connectable;connectable._refCount++;var refCounter=new RefCountSubscriber(subscriber,connectable),subscription=source.subscribe(refCounter);if(!refCounter.closed){refCounter.connection=connectable.connect()}return subscription};return RefCountOperator}(),RefCountSubscriber=function(_super){tslib_1.__extends(RefCountSubscriber,_super);function RefCountSubscriber(destination,connectable){var _this=_super.call(this,destination)||this;_this.connectable=connectable;return _this}RefCountSubscriber.prototype._unsubscribe=function(){var connectable=this.connectable;if(!connectable){this.connection=null;return}this.connectable=null;var refCount=connectable._refCount;if(0>=refCount){this.connection=null;return}connectable._refCount=refCount-1;if(1<refCount){this.connection=null;return}var connection=this.connection,sharedConnection=connectable._connection;this.connection=null;if(sharedConnection&&(!connection||sharedConnection===connection)){sharedConnection.unsubscribe()}};return RefCountSubscriber}(Subscriber);