import*as tslib_1 from"../../../../tslib/tslib.es6.js";import{Action}from"./Action.js";var AsyncAction=function(_super){tslib_1.__extends(AsyncAction,_super);function AsyncAction(scheduler,work){var _this=_super.call(this,scheduler,work)||this;_this.scheduler=scheduler;_this.work=work;_this.pending=!1;return _this}AsyncAction.prototype.schedule=function(state,delay){if(void 0===delay){delay=0}if(this.closed){return this}this.state=state;var id=this.id,scheduler=this.scheduler;if(null!=id){this.id=this.recycleAsyncId(scheduler,id,delay)}this.pending=!0;this.delay=delay;this.id=this.id||this.requestAsyncId(scheduler,this.id,delay);return this};AsyncAction.prototype.requestAsyncId=function(scheduler,id,delay){if(void 0===delay){delay=0}return setInterval(scheduler.flush.bind(scheduler,this),delay)};AsyncAction.prototype.recycleAsyncId=function(scheduler,id,delay){if(void 0===delay){delay=0}if(null!==delay&&this.delay===delay&&!1===this.pending){return id}clearInterval(id)};AsyncAction.prototype.execute=function(state,delay){if(this.closed){return new Error("executing a cancelled action")}this.pending=!1;var error=this._execute(state,delay);if(error){return error}else if(!1===this.pending&&null!=this.id){this.id=this.recycleAsyncId(this.scheduler,this.id,null)}};AsyncAction.prototype._execute=function(state){var errored=!1,errorValue=void 0;try{this.work(state)}catch(e){errored=!0;errorValue=!!e&&e||new Error(e)}if(errored){this.unsubscribe();return errorValue}};AsyncAction.prototype._unsubscribe=function(){var id=this.id,scheduler=this.scheduler,actions=scheduler.actions,index=actions.indexOf(this);this.work=null;this.state=null;this.pending=!1;this.scheduler=null;if(-1!==index){actions.splice(index,1)}if(null!=id){this.id=this.recycleAsyncId(scheduler,id,null)}this.delay=null};return AsyncAction}(Action);export{AsyncAction};