import*as tslib_1 from"../../../../tslib/tslib.es6.js";import{AsyncAction}from"./AsyncAction.js";import{AsyncScheduler}from"./AsyncScheduler.js";var VirtualTimeScheduler=function(_super){tslib_1.__extends(VirtualTimeScheduler,_super);function VirtualTimeScheduler(SchedulerAction,maxFrames){if(void 0===SchedulerAction){SchedulerAction=VirtualAction}if(void 0===maxFrames){maxFrames=Number.POSITIVE_INFINITY}var _this=_super.call(this,SchedulerAction,function(){return _this.frame})||this;_this.maxFrames=maxFrames;_this.frame=0;_this.index=-1;return _this}VirtualTimeScheduler.prototype.flush=function(){var _a=this,actions=_a.actions,maxFrames=_a.maxFrames,error,action;while((action=actions.shift())&&(this.frame=action.delay)<=maxFrames){if(error=action.execute(action.state,action.delay)){break}}if(error){while(action=actions.shift()){action.unsubscribe()}throw error}};VirtualTimeScheduler.frameTimeFactor=10;return VirtualTimeScheduler}(AsyncScheduler);export{VirtualTimeScheduler};var VirtualAction=function(_super){tslib_1.__extends(VirtualAction,_super);function VirtualAction(scheduler,work,index){if(void 0===index){index=scheduler.index+=1}var _this=_super.call(this,scheduler,work)||this;_this.scheduler=scheduler;_this.work=work;_this.index=index;_this.active=!0;_this.index=scheduler.index=index;return _this}VirtualAction.prototype.schedule=function(state,delay){if(void 0===delay){delay=0}if(!this.id){return _super.prototype.schedule.call(this,state,delay)}this.active=!1;var action=new VirtualAction(this.scheduler,this.work);this.add(action);return action.schedule(state,delay)};VirtualAction.prototype.requestAsyncId=function(scheduler,id,delay){if(void 0===delay){delay=0}this.delay=scheduler.frame+delay;var actions=scheduler.actions;actions.push(this);actions.sort(VirtualAction.sortActions);return!0};VirtualAction.prototype.recycleAsyncId=function(scheduler,id,delay){if(void 0===delay){delay=0}};VirtualAction.prototype._execute=function(state,delay){if(!0===this.active){return _super.prototype._execute.call(this,state,delay)}};VirtualAction.sortActions=function(a,b){if(a.delay===b.delay){if(a.index===b.index){return 0}else if(a.index>b.index){return 1}else{return-1}}else if(a.delay>b.delay){return 1}else{return-1}};return VirtualAction}(AsyncAction);export{VirtualAction};