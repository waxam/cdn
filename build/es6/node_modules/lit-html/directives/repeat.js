import{noChange as e}from"../lit-html.js";import{directive as t,Directive as s,PartType as r}from"../directive.js";import{getCommittedValue as l,setChildPartValue as i,insertPart as o,removePart as n,setCommittedValue as a}from"../directive-helpers.js";
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const u=(e,t,s)=>{const r=new Map;for(let l=t;l<=s;l++)r.set(e[l],l);return r},f=t(class extends s{constructor(e){if(super(e),e.type!==r.CHILD)throw Error("repeat() can only be used in text expressions")}Mt(e,t,s){let r;void 0===s?s=t:void 0!==t&&(r=t);const l=[],i=[];let o=0;for(const t of e)l[o]=r?r(t,o):o,i[o]=s(t,o),o++;return{values:i,keys:l}}render(e,t,s){return this.Mt(e,t,s).values}update(t,[s,r,f]){var c;const d=l(t),{values:h,keys:v}=this.Mt(s,r,f);if(!d)return this.Pt=v,h;const p=null!==(c=this.Pt)&&void 0!==c?c:this.Pt=[],m=[];let P,g,y=0,C=d.length-1,x=0,M=h.length-1;for(;y<=C&&x<=M;)if(null===d[y])y++;else if(null===d[C])C--;else if(p[y]===v[x])m[x]=i(d[y],h[x]),y++,x++;else if(p[C]===v[M])m[M]=i(d[C],h[M]),C--,M--;else if(p[y]===v[M])m[M]=i(d[y],h[M]),o(t,m[M+1],d[y]),y++,M--;else if(p[C]===v[x])m[x]=i(d[C],h[x]),o(t,d[y],d[C]),C--,x++;else if(void 0===P&&(P=u(v,x,M),g=u(p,y,C)),P.has(p[y]))if(P.has(p[C])){const e=g.get(v[x]),s=void 0!==e?d[e]:null;if(null===s){const e=o(t,d[y]);i(e,h[x]),m[x]=e}else m[x]=i(s,h[x]),o(t,d[y],s),d[e]=null;x++}else n(d[C]),C--;else n(d[y]),y++;for(;x<=M;){const e=o(t,m[M+1]);i(e,h[x]),m[x++]=e}for(;y<=C;){const e=d[y++];null!==e&&n(e)}return this.Pt=v,a(t,m),e}});export{f as repeat};