import{noChange as e}from"../lit-html.js";import{directive as t,Directive as s,PartType as r}from"../directive.js";import{getCommittedValue as i,setChildPartValue as l,insertPart as o,removePart as n,setCommittedValue as a}from"../directive-helpers.js";
/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const u=(e,t,s)=>{const r=new Map;for(let i=t;i<=s;i++)r.set(e[i],i);return r},f=t(class extends s{constructor(e){if(super(e),e.type!==r.CHILD)throw Error("repeat() can only be used in text expressions")}dt(e,t,s){let r;void 0===s?s=t:void 0!==t&&(r=t);const i=[],l=[];let o=0;for(const t of e)i[o]=r?r(t,o):o,l[o]=s(t,o),o++;return{values:l,keys:i}}render(e,t,s){return this.dt(e,t,s).values}update(t,[s,r,f]){var c;const d=i(t),{values:h,keys:v}=this.dt(s,r,f);if(!Array.isArray(d))return this.ut=v,h;const p=null!==(c=this.ut)&&void 0!==c?c:this.ut=[],m=[];let y,g,C=0,x=d.length-1,P=0,j=h.length-1;for(;C<=x&&P<=j;)if(null===d[C])C++;else if(null===d[x])x--;else if(p[C]===v[P])m[P]=l(d[C],h[P]),C++,P++;else if(p[x]===v[j])m[j]=l(d[x],h[j]),x--,j--;else if(p[C]===v[j])m[j]=l(d[C],h[j]),o(t,m[j+1],d[C]),C++,j--;else if(p[x]===v[P])m[P]=l(d[x],h[P]),o(t,d[C],d[x]),x--,P++;else if(void 0===y&&(y=u(v,P,j),g=u(p,C,x)),y.has(p[C]))if(y.has(p[x])){const e=g.get(v[P]),s=void 0!==e?d[e]:null;if(null===s){const e=o(t,d[C]);l(e,h[P]),m[P]=e}else m[P]=l(s,h[P]),o(t,d[C],s),d[e]=null;P++}else n(d[x]),x--;else n(d[C]),C++;for(;P<=j;){const e=o(t,m[j+1]);l(e,h[P]),m[P++]=e}for(;C<=x;){const e=d[C++];null!==e&&n(e)}return this.ut=v,a(t,m),e}});export{f as repeat};