import{extend as e,hop as r}from"./utils.js";import{defineProperty as o,objCreate as t}from"./es5.js";import a from"./compiler.js";import n from"../../intl-messageformat-parser/src/parser.js";export default MessageFormat;function MessageFormat(e,r,t){var a="string"==typeof e?MessageFormat.__parse(e):e;if(!a||"messageFormatPattern"!==a.type)throw new TypeError("A message must be provided as a String or AST.");t=this._mergeFormats(MessageFormat.formats,t),o(this,"_locale",{value:this._resolveLocale(r)});var n=this._findPluralRuleFunction(this._locale),s=this._compilePattern(a,r,t,n),l=this;this.format=function(r){try{return l._format(s,r)}catch(r){throw r.variableId?new Error("The intl string context variable '"+r.variableId+"' was not provided to the string '"+e+"'"):r}}}o(MessageFormat,"formats",{enumerable:!0,value:{number:{currency:{style:"currency"},percent:{style:"percent"}},date:{short:{month:"numeric",day:"numeric",year:"2-digit"},medium:{month:"short",day:"numeric",year:"numeric"},long:{month:"long",day:"numeric",year:"numeric"},full:{weekday:"long",month:"long",day:"numeric",year:"numeric"}},time:{short:{hour:"numeric",minute:"numeric"},medium:{hour:"numeric",minute:"numeric",second:"numeric"},long:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"},full:{hour:"numeric",minute:"numeric",second:"numeric",timeZoneName:"short"}}}}),o(MessageFormat,"__localeData__",{value:t(null)}),o(MessageFormat,"__addLocaleData",{value:function(e){if(!e||!e.locale)throw new Error("Locale data provided to IntlMessageFormat is missing a `locale` property");MessageFormat.__localeData__[e.locale.toLowerCase()]=e}}),o(MessageFormat,"__parse",{value:n.parse}),o(MessageFormat,"defaultLocale",{enumerable:!0,writable:!0,value:void 0}),MessageFormat.prototype.resolvedOptions=function(){return{locale:this._locale}},MessageFormat.prototype._compilePattern=function(e,r,o,t){return new a(r,o,t).compile(e)},MessageFormat.prototype._findPluralRuleFunction=function(e){for(var r=MessageFormat.__localeData__,o=r[e.toLowerCase()];o;){if(o.pluralRuleFunction)return o.pluralRuleFunction;o=o.parentLocale&&r[o.parentLocale.toLowerCase()]}throw new Error("Locale data added to IntlMessageFormat is missing a `pluralRuleFunction` for :"+e)},MessageFormat.prototype._format=function(e,o){var t,a,n,s,l,i,m="";for(t=0,a=e.length;t<a;t+=1)if("string"!=typeof(n=e[t])){if(s=n.id,!o||!r.call(o,s))throw(i=new Error("A value must be provided for: "+s)).variableId=s,i;l=o[s],n.options?m+=this._format(n.getOption(l),o):m+=n.format(l)}else m+=n;return m},MessageFormat.prototype._mergeFormats=function(o,a){var n,s,l={};for(n in o)r.call(o,n)&&(l[n]=s=t(o[n]),a&&r.call(a,n)&&e(s,a[n]));return l},MessageFormat.prototype._resolveLocale=function(e){"string"==typeof e&&(e=[e]),e=(e||[]).concat(MessageFormat.defaultLocale);var r,o,t,a,n=MessageFormat.__localeData__;for(r=0,o=e.length;r<o;r+=1)for(t=e[r].toLowerCase().split("-");t.length;){if(a=n[t.join("-")])return a.locale;t.pop()}var s=e.pop();throw new Error("No locale data has been added to IntlMessageFormat for: "+e.join(", ")+", or the default locale: "+s)};