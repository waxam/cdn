import{dom}from"@polymer/polymer/lib/legacy/polymer.dom.js";export class HAXWiring{constructor(){this.haxProperties={canScale:!1,canPosition:!1,canEditSource:!1,settings:{quick:[],configure:[],advanced:[]},wipeSlot:{}},this.setup=(a,b="",c=this)=>{return"undefined"!==typeof this.tagName&&(b=this.tagName.toLowerCase()),window.addEventListener("hax-store-ready",this._haxStoreReady.bind(this)),"undefined"!==typeof window.HaxStore&&null!=window.HaxStore.instance&&window.HaxStore.ready?this.setHaxProperties(a,b,c,!0):this.setHaxProperties(a,b,c,!1)},this._haxStoreReady=a=>{if(a.detail&&typeof this.tagName!==typeof void 0&&typeof this.haxProperties!==typeof void 0){let b=this.tagName,c=this.haxProperties,d=this;if(""!==b&&typeof window.HaxStore===typeof void 0){const f=new CustomEvent("hax-register-properties",{bubbles:!0,cancelable:!0,detail:{tag:b.toLowerCase(),properties:c,polymer:!1}});d.dispatchEvent(f)}else if(""!==b&&typeof window.HaxStore!==typeof void 0&&typeof window.HaxStore.instance!==typeof void 0&&null!=window.HaxStore.instance&&typeof window.HaxStore.instance.elementList!==typeof void 0&&typeof window.HaxStore.instance.elementList[b.toLowerCase()]===typeof void 0){const f=new CustomEvent("hax-register-properties",{bubbles:!0,cancelable:!0,detail:{tag:b.toLowerCase(),properties:c}});d.dispatchEvent(f)}else if(typeof this.tagName!==typeof void 0&&typeof window.HaxStore!==typeof void 0&&typeof window.HaxStore.instance!==typeof void 0&&null!=window.HaxStore.instance&&typeof window.HaxStore.instance.elementList!==typeof void 0&&typeof window.HaxStore.instance.elementList[this.tagName.toLowerCase()]===typeof void 0){const f=new CustomEvent("hax-register-properties",{bubbles:!0,cancelable:!0,detail:{tag:this.tagName.toLowerCase(),properties:c}});d.dispatchEvent(f)}}},this.setHaxProperties=(a,b="",c=document,d=!1)=>{if("undefined"===typeof a.api&&(a.api="1"),"1"==a.api){if("undefined"===typeof a.canPosition&&(a.canPosition=!0),"undefined"===typeof a.canScale&&(a.canScale=!0),"undefined"===typeof a.canEditSource&&(a.canEditSource=!1),"undefined"===typeof a.gizmo&&(a.gizmo=!1),"undefined"!==typeof a.settings){"undefined"===typeof a.settings.quick&&(a.settings.quick=[]);for(let f=0;f<a.settings.quick.length;f++)a.settings.quick[f]=this.validateSetting(a.settings.quick[f]),a.settings.quick[f]||a.settings.quick.splice(f,1);"undefined"===typeof a.settings.configure&&(a.settings.configure=[]);for(let f=0;f<a.settings.configure.length;f++)a.settings.configure[f]=this.validateSetting(a.settings.configure[f]),a.settings.configure[f]||a.settings.configure.splice(f,1);"undefined"===typeof a.settings.advanced&&(a.settings.advanced=[]);for(let f=0;f<a.settings.advanced.length;f++)a.settings.advanced[f]=this.validateSetting(a.settings.advanced[f]),a.settings.advanced[f]||a.settings.advanced.splice(f,1);a.settings.advanced.push({attribute:"class",title:"Classes",description:"CSS classes applied manually to the element",inputMethod:"textfield"}),a.settings.advanced.push({attribute:"style",title:"Styles",description:"Custom CSS styles as applied to the element",inputMethod:"textfield"}),a.settings.advanced.push({attribute:"prefix",title:"Schema: prefix",description:"Schema prefixes",inputMethod:"textfield"}),a.settings.advanced.push({attribute:"typeof",title:"Schema: TypeOf",description:"typeof definition for Schema usage",inputMethod:"textfield"}),a.settings.advanced.push({attribute:"property",title:"Schema: Property",description:"typeof definition for Schema usage",inputMethod:"textfield"}),a.settings.advanced.push({attribute:"resource",title:"Schema: Resource ID",description:"Schema resource identifier",inputMethod:"textfield"}),a.settings.advanced.push({attribute:"id",title:"ID",description:"element ID, only set this if you know why",inputMethod:"textfield"}),a.settings.advanced.push({attribute:"slot",title:"slot",description:"DOM slot area",inputMethod:"textfield"})}if("undefined"===typeof a.saveOptions&&(a.saveOptions={wipeSlot:!1}),d)if(""!==b&&"undefined"===typeof window.HaxStore){const f=new CustomEvent("hax-register-properties",{bubbles:!0,cancelable:!0,detail:{tag:b.toLowerCase(),properties:a,polymer:!1}});c.dispatchEvent(f)}else if(""!==b&&"undefined"!==typeof window.HaxStore&&"undefined"!==typeof window.HaxStore.instance&&null!=window.HaxStore.instance&&"undefined"!==typeof window.HaxStore.instance.elementList&&"undefined"===typeof window.HaxStore.instance.elementList[b.toLowerCase()]){const f=new CustomEvent("hax-register-properties",{bubbles:!0,cancelable:!0,detail:{tag:b.toLowerCase(),properties:a}});c.dispatchEvent(f)}else if("undefined"!==typeof this.tagName&&"undefined"!==typeof window.HaxStore&&"undefined"!==typeof window.HaxStore.instance&&null!=window.HaxStore.instance&&"undefined"!==typeof window.HaxStore.instance.elementList&&"undefined"===typeof window.HaxStore.instance.elementList[this.tagName.toLowerCase()]){const f=new CustomEvent("hax-register-properties",{bubbles:!0,cancelable:!0,detail:{tag:this.tagName.toLowerCase(),properties:a}});c.dispatchEvent(f)}""===b&&("function"===typeof this._setHaxProperties?this._setHaxProperties(a):this.haxProperties=a)}else console.warn("This is't a valid usage of hax API. See hax-body-behaviors/lib/HAXWiring.js for more details on how to implement the API. Most likely your hax item just was placed in an iframe as a fallback as opposed to a custom element.")},this.validateSetting=a=>{return"undefined"===typeof a.property&&"undefined"===typeof a.slot&&"undefined"===typeof a.attribute?!1:("undefined"===typeof a.title&&("undefined"===typeof a.attribute?a.title=a.property:a.title=a.attribute),"undefined"===typeof a.description&&(a.description=""),"undefined"===typeof a.inputMethod&&(a.inputMethod="textfield"),"undefined"===typeof a.type&&(a.type="settings"),"undefined"===typeof a.icon&&(a.icon="android"),"undefined"===typeof a.options&&(a.options={}),"undefined"===typeof a.required&&(a.required=!1),"undefined"===typeof a.validation&&(a.validation=".*"),"undefined"===typeof a.validationType&&(a.validationType=""),a)},this.getHaxProperties=()=>{return this.haxProperties},this.getHaxJSONSchema=(a,b,c=this)=>{typeof a==="undefined"&&(a="configure"),typeof b==="undefined"&&(b=c.haxProperties);let d=b.settings[a];var f={$schema:"http://json-schema.org/schema#",title:"HAX "+a+" form schema",type:"object",properties:{}};return f.properties=c._getHaxJSONSchemaProperty(d,c),f=c.postProcessgetHaxJSONSchema(f),f},this.postProcessgetHaxJSONSchema=a=>{return a},this._getHaxJSONSchemaProperty=(a,b)=>{var c={};for(var d in a)if(a.hasOwnProperty(d))if("undefined"!==typeof a[d].property)switch(c[a[d].property]={title:a[d].title,type:b.getHaxJSONSchemaType(a[d].inputMethod)},"undefined"!==typeof b[a[d].property]&&(c[a[d].property].value=b[a[d].property]),"url"==a[d].validationType&&(c[a[d].property].format="uri"),"datepicker"==a[d].inputMethod&&(c[a[d].property].format="date-time"),".*"!=a[d].validation&&(c[a[d].property].pattern=a[d].validation),a[d].inputMethod){case"number":c[a[d].property].component={name:"paper-input",valueProperty:"value",properties:{required:a[d].required},attributes:{type:"number"}};break;case"select":var f="";if("undefined"!==typeof a[d].options)for(var g in a[d].options)f+="<paper-item value=\""+g+"\">"+a[d].options[g]+"</paper-item>\n";c[a[d].property].component={name:"dropdown-select",valueProperty:"value",slot:f,properties:{required:a[d].required}};break;case"textarea":c[a[d].property].component={name:"paper-textarea",valueProperty:"value",properties:{required:a[d].required},attributes:{"auto-validate":"auto-validate","char-counter":"char-counter"}};break;case"code-editor":c[a[d].property].component={name:"code-editor",valueProperty:"editorValue",attributes:{id:"haxcodeeditor"},properties:{title:a[d].title,readOnly:!1,theme:"ace/theme/monokai",mode:"ace/mode/html",fontsize:"16px",className:"hax-code-editor"}};break;case"array":c[a[d].property].items={type:"object",properties:b._getHaxJSONSchemaProperty(a[d].properties,b)};break;case"textfield":c[a[d].property].component={name:"paper-input",valueProperty:"value",properties:{required:a[d].required},attributes:{"auto-validate":"auto-validate"}};break;case"alt":c[a[d].property].component={name:"paper-input-flagged",valueProperty:"value",properties:{required:a[d].required},attributes:{"auto-validate":"auto-validate"}};break;case"colorpicker":c[a[d].property].component={name:"paper-swatch-picker",valueProperty:"color",properties:{required:a[d].required}};break;case"iconpicker":c[a[d].property].component={name:"paper-icon-picker",valueProperty:"icon",properties:{required:a[d].required}},a[d].options.constructor===Array&&(c[a[d].property].component.properties.iconList=a[d].options);break;case"datepicker":c[a[d].property].component={name:"app-datepicker",valueProperty:"date",properties:{required:a[d].required,autoUpdateDate:!0}};}else if("undefined"!==typeof a[d].attribute)switch(c[a[d].attribute]={title:a[d].title,type:b.getHaxJSONSchemaType(a[d].inputMethod)},"class"===a[d].attribute?c[a[d].attribute].value=b.className:"style"===a[d].attribute?c[a[d].attribute].value=b.style.cssText:"undefined"!==typeof b.attributes[a[d].attribute]&&(c[a[d].attribute].value=b.getAttribute(a[d].attribute)),("href"==d||"src"==d)&&(c[a[d].attribute].format="uri"),"url"==a[d].validationType&&(c[a[d].attribute].format="uri"),"datepicker"==a[d].inputMethod&&(c[a[d].attribute].format="date-time"),".*"!=a[d].validation&&(c[a[d].attribute].pattern=a[d].validation),a[d].inputMethod){case"number":c[a[d].attribute].component={name:"paper-input",valueProperty:"value",properties:{required:a[d].required},attributes:{type:"number"}};break;case"select":var f="";if("undefined"!==typeof a[d].options)for(var g in a[d].options)f+="<paper-item value=\""+g+"\">"+a[d].options[g]+"</paper-item>\n";c[a[d].attribute].component={name:"dropdown-select",valueProperty:"value",slot:f,properties:{required:a[d].required}};break;case"textarea":c[a[d].attribute].component={name:"paper-textarea",valueProperty:"value",properties:{required:a[d].required},attributes:{"auto-validate":"auto-validate","char-counter":"char-counter"}};break;case"code-editor":c[a[d].attribute].component={name:"code-editor",valueProperty:"editorValue",attributes:{id:"haxcodeeditor"},properties:{title:a[d].title,readOnly:!1,theme:"ace/theme/monokai",mode:"ace/mode/html",fontsize:"16px",className:"hax-code-editor"}};break;case"textfield":c[a[d].attribute].component={name:"paper-input",valueProperty:"value",properties:{required:a[d].required},attributes:{"auto-validate":"auto-validate"}};break;case"alt":c[a[d].attribute].component={name:"paper-input-flagged",valueProperty:"value",properties:{required:a[d].required},attributes:{"auto-validate":"auto-validate"}};break;case"colorpicker":c[a[d].attribute].component={name:"paper-swatch-picker",valueProperty:"color",properties:{required:a[d].required}};}else{c[a[d].slot]={title:a[d].title,type:b.getHaxJSONSchemaType(a[d].inputMethod),value:"",component:{name:"code-editor",valueProperty:"editorValue",attributes:{id:"haxcodeeditor"},properties:{title:a[d].title,readOnly:!1,theme:"ace/theme/monokai",mode:"ace/mode/html",fontsize:"16px",className:"hax-code-editor"}}};var f="";for(var h in dom(b).childNodes)"undefined"!==typeof dom(b).childNodes[h]&&(1===dom(b).childNodes[h].nodeType?f+=dom(b).childNodes[h].innerHTML:1!==dom(b).childNodes[h].nodeType&&"undefined"!==typeof dom(b).childNodes[h].textContent&&""!==dom(b).childNodes[h].textContent&&(f+=dom(b).childNodes[h].textContent));c[a[d].slot].component.slot="<template>"+f+"</template>"}return c},this.getHaxJSONSchemaType=a=>{var b=this.validHAXPropertyInputMethod();if(b.includes(a))switch(a){case"flipboolean":case"boolean":return"boolean";break;case"number":return"number";break;case"select":case"textarea":case"colorpicker":case"iconpicker":case"datepicker":case"textfield":case"alt":return"string";break;case"array":return"array";break;default:return"string";}},this.validHAXPropertyInputMethod=()=>{return["flipboolean","boolean","select","textfield","textarea","datepicker","colorpicker","iconpicker","alt","number","code-editor","array"]},this.prototypeHaxProperties=()=>{return{api:"1",canScale:!0,canPosition:!0,canEditSource:!1,gizmo:{title:"Tag name",description:"A description",icon:"av:play-circle-filled",color:"blue",groups:["Content"],handles:[{type:"data",url:"src"}],meta:{author:""}},settings:{quick:[{property:"title",title:"Title",inputMethod:"textfield",icon:"android"},{property:"primaryColor",title:"Primary color",inputMethod:"colorpicker",icon:"color"}],configure:[{slot:"",title:"Inner content",description:"The slotted content that lives inside the tag",inputMethod:"textfield",icon:"android",required:!0,validationType:"text"},{slot:"button",title:"Button content",description:"The content that can override the button",inputMethod:"textfield",icon:"android",required:!0,validationType:"text"},{property:"title",title:"Title",description:"",inputMethod:"textfield",icon:"android",required:!0,validationType:"text"},{property:"primaryColor",title:"Title",description:"",inputMethod:"textfield",icon:"android",required:!1,validation:".*",validationType:"text"}],advanced:[{property:"secondaryColor",title:"Secondary color",description:"An optional secondary color used in certain edge cases.",inputMethod:"colorpicker",icon:"color"},{property:"endPoint",title:"API endpoint",description:"An optional endpoint to hit and load in more data dymaically.",inputMethod:"textfield",icon:"android",validation:"[a-z0-9]",validationType:"url"}]},saveOptions:{wipeSlot:!1,unsetAttributes:["end-point","secondary-color"]}}}}}window.HAXWiring=new HAXWiring,window.HAXBehaviors=window.HAXBehaviors||{},window.HAXBehaviors.PropertiesBehaviors={properties:{haxProperties:window.HAXWiring.haxProperties},setHaxProperties:function(a,b="",c=this){return"undefined"!==typeof this.tagName&&(b=this.tagName.toLowerCase()),window.addEventListener("hax-store-ready",this._haxStoreReady.bind(this)),"undefined"!==typeof window.HaxStore&&null!=window.HaxStore.instance&&window.HaxStore.ready?window.HAXWiring.setHaxProperties(a,b,c,!0):window.HAXWiring.setHaxProperties(a,b,c,!1)},_haxStoreReady:function(a){return window.HAXWiring._haxStoreReady(a)},validateSetting:function(a){return window.HAXWiring.validateSetting(a)},getHaxProperties:function(){return this.haxProperties},getHaxJSONSchema:function(a,b,c=this){return window.HAXWiring.getHaxJSONSchema(a,b,c)},postProcessgetHaxJSONSchema:function(a){return window.HAXWiring.postProcessgetHaxJSONSchema(a)},_getHaxJSONSchemaProperty:function(a,b){return window.HAXWiring._getHaxJSONSchemaProperty(a,b)},getHaxJSONSchemaType:function(a){return window.HAXWiring.getHaxJSONSchemaType(a)},validHAXPropertyInputMethod:function(){return window.HAXWiring.validHAXPropertyInputMethod()},prototypeHaxProperties:function(){return window.HAXWiring.prototypeHaxProperties()}};