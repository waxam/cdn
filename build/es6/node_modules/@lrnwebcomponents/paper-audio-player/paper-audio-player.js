import{html as e}from"../../@polymer/polymer/polymer-element.js";import{IronA11yKeysBehavior as o}from"../../@polymer/iron-a11y-keys-behavior/iron-a11y-keys-behavior.js";import{mixinBehaviors as t}from"../../@polymer/polymer/lib/legacy/class.js";import"../simple-progress/simple-progress.js";import"../simple-icon/simple-icon.js";import"../simple-icon/lib/simple-icons.js";import"../simple-icon/lib/simple-icon-button.js";import"../hax-iconset/lib/simple-hax-iconset.js";import{SimpleColorsPolymer as r}from"../simple-colors/lib/simple-colors-polymer.js";import{SchemaBehaviors as i}from"../schema-behaviors/schema-behaviors.js";class PaperAudioPlayer extends(t([o],i(r))){static get template(){return e`
      <style include="simple-colors-shared-styles-polymer">
        :host {
          display: block;
          box-sizing: border-box;
          font-family: var(
            --paper-audio-player-font-family,
            "Roboto",
            "Noto",
            sans-serif
          );
          --paper-audio-player-color: var(
            --simple-colors-default-theme-accent-9
          );
          --paper-audio-player-text-color: var(
            --simple-colors-default-theme-grey-1
          );
          --paper-audio-player-shadow: var(
            --simple-colors-default-theme-grey-2
          );
          --paper-audio-player-background: var(
            --simple-colors-default-theme-grey-1
          );
          background-color: var(--paper-audio-player-background);
        }
        #wrapper {
          position: relative;
          cursor: pointer;
          height: 50px;
          box-shadow: 0 1px 2px var(--paper-audio-player-shadow);
        }
        #left,
        #center {
          border-right: 1px solid var(--paper-audio-player-shadow);
        }
        #left,
        #right {
          height: 50px;
          width: 50px;
          position: relative;
        }

        #left {
          opacity: 0.8;
          background-color: var(--paper-audio-player-color);
          transition: opacity 0.25s;
        }
        #left:focus,
        #left:hover {
          opacity: 1;
        }

        #right {
          background-color: var(--paper-audio-player-background);
        }

        simple-icon-button,
        simple-icon {
          color: var(--paper-audio-player-text-color);
        }

        #duration,
        #title,
        #progress2 {
          text-align: center;
          line-height: 50px;
        }

        #duration {
          font-size: 11px;
          color: var(--paper-audio-player-color);
        }

        simple-icon-button,
        simple-icon {
          margin: auto;
        }

        #replay {
          opacity: 0;
          color: var(--paper-audio-player-color);
        }

        #title,
        #progress2 {
          pointer-events: none;
          font-size: 15px;
        }

        #title {
          z-index: 2;
          color: var(--paper-audio-player-color);
        }

        #progress2 {
          width: 0px;
          z-index: 5;
          color: var(--paper-audio-player-text-color);
          overflow: hidden;
        }

        #center {
          position: relative;
          overflow: hidden;
          background-color: var(--paper-audio-player-background);
        }

        #progress {
          width: 100%;
          transform-origin: left;
          transform: scaleX(0);
          background-color: var(--paper-audio-player-color);
        }

        /* On hover */

        :host(:not(.cantplay)) #right:hover #replay {
          opacity: 1;
        }

        #right:hover #duration {
          opacity: 0;
        }

        #left:hover #play,
        #left:hover #pause {
          transform: scale3d(1.1, 1.1, 1.1);
          -ms-transform: scale3d(1.1, 1.1, 1.1);
          -webkit-transform: scale3d(1.1, 1.1, 1.1);
        }

        /* On Error */

        :host(.cantplay) #title {
          font-size: 12px;
        }

        :host(.cantplay) #wrapper {
          cursor: default;
        }

        :host(.cantplay) #play {
          opacity: 0;
        }

        /* Flexbox Helpers */

        .layout-horizontal {
          display: flex;
          display: -webkit-flex;
          display: -ms-flexbox;
          -ms-flex-direction: row;
          -webkit-flex-direction: row;
          flex-direction: row;
        }

        .flex {
          -ms-flex: 1;
          -webkit-flex: 1;
          flex: 1;
        }

        .fit {
          position: absolute;
          top: 0;
          right: 0;
          bottom: 0;
          left: 0;
        }

        .self-start {
          -ms-align-self: flex-start;
          -webkit-align-self: flex-start;
          align-self: flex-start;
        }

        .self-end {
          -ms-align-self: flex-end;
          -webkit-align-self: flex-end;
          align-self: flex-end;
        }
      </style>
      <div id="wrapper" class="layout-horizontal">
        <div id="left" class="self-start" on-click="playPause">
          <!-- Icon -->
          <simple-icon-button
            id="play"
            icon="paper-audio-icons:play-arrow"
            class="fit"
            hidden$="[[ _hidePlayIcon(isPlaying, canBePlayed) ]]"
            role="button"
            aria-label="Play Audio"
            tabindex="-1"
          ></simple-icon-button>
          <simple-icon-button
            id="pause"
            icon="paper-audio-icons:pause"
            class="fit"
            hidden$="[[ !isPlaying ]]"
            role="button"
            aria-label="Pause Audio"
            tabindex="-1"
          ></simple-icon-button>
          <simple-icon
            id="error"
            icon="paper-audio-icons:error-outline"
            class="fit"
            hidden$="[[ !error ]]"
          ></simple-icon>
        </div>
        <div id="center" class="flex" on-down="_onDown">
          <!-- Title -->
          <div id="title" class="fit" role="alert">[[title]]</div>
          <!-- Audio HTML5 element -->
          <audio
            id="audio"
            src$="[[src]]"
            preload$="[[ _setPreload(autoPlay, preload) ]]"
          ></audio>
          <!-- Progress bar -->
          <div id="progress" class="fit"></div>
          <!-- Secondary white title -->
          <div id="progress2" class="fit">
            <div id="title2" aria-hidden="true">[[title]]</div>
          </div>
        </div>
        <div id="right" class="self-end" on-click="restart">
          <!-- Duration -->
          <div id="duration" class="fit" hidden$="[[ended]]">
            <span class="fit" role="timer" aria-label="Audio Track Length"
              >[[ _convertSecToMin(timeLeft) ]]</span
            >
          </div>
          <!-- Icon -->
          <simple-icon-button
            id="replay"
            class="fit"
            icon="paper-audio-icons:replay"
            tabindex="-1"
            role="button"
            aria-label="Replay Audio"
          ></simple-icon-button>
        </div>
      </div>
    `}static get tag(){return"paper-audio-player"}static get properties(){return{...super.properties,src:{type:String,observer:"_srcChanged"},title:{type:String,value:"Click to play this audio file"},autoPlay:{type:Boolean,value:!1},preload:{type:String,value:"auto"},currentTime:{type:Number,value:0,notify:!0},timeLeft:{type:Number,value:0},smallSkip:{type:Number,value:15},largeSkip:{type:Number,value:60},error:{type:Boolean},timeOffset:{type:Number,value:0}}}static get keyBindings(){return{space:"playPause",enter:"playPause",left:"_skipReverseByInterval",right:"_skipReverseByInterval",down:"_skipReverseByInterval",up:"_skipReverseByInterval"}}static get haxProperties(){return{canScale:!0,canPosition:!0,canEditSource:!0,gizmo:{title:"Mini Audio player",description:"A very small audio player good for MP3s.",icon:"image:music-note",color:"green",groups:["Audio","Media"],handles:[{type:"audio",source:"src",title:"title",color:"color"}],meta:{author:"ELMS:LN"}},settings:{configure:[{property:"src",title:"Source",description:"The URL for this audio file.",inputMethod:"haxupload",icon:"link",required:!0,validationType:"url"},{property:"title",title:"Title",description:"Title of this sound track.",inputMethod:"textfield",icon:"av:video-label",required:!1,validationType:"text"},{property:"accentColor",title:"Accent color",description:"Select the accent color use",inputMethod:"colorpicker",icon:"editor:format-color-fill"},{property:"dark",title:"Dark",description:"Use dark theme",inputMethod:"boolean",icon:"invert-colors"}],advanced:[]}}}connectedCallback(){super.connectedCallback(),this.shadowRoot.querySelector("#audio").addEventListener("loadedmetadata",this._onCanPlay.bind(this)),this.shadowRoot.querySelector("#audio").addEventListener("playing",this._onPlaying.bind(this)),this.shadowRoot.querySelector("#audio").addEventListener("pause",this._onPause.bind(this)),this.shadowRoot.querySelector("#audio").addEventListener("ended",this._onEnd.bind(this)),this.shadowRoot.querySelector("#audio").addEventListener("error",this._onError.bind(this)),this.setAttribute("tabindex","0"),this.setAttribute("role","application"),this.setAttribute("aria-label","Audio Player"),this.setAttribute("aria-describedby","title")}disconnectedCallback(){super.disconnectedCallback(),this.shadowRoot.querySelector("#audio").removeEventListener("loadedmetadata",this._onCanPlay.bind(this)),this.shadowRoot.querySelector("#audio").removeEventListener("playing",this._onPlaying.bind(this)),this.shadowRoot.querySelector("#audio").removeEventListener("pause",this._onPause.bind(this)),this.shadowRoot.querySelector("#audio").removeEventListener("ended",this._onEnd.bind(this)),this.shadowRoot.querySelector("#audio").removeEventListener("error",this._onError.bind(this))}ready(){super.ready();var e=this;e.canBePlayed=!1,e.isPlaying=!1,e.ended=!1,e.error=!1,e.shadowRoot.querySelector("#audio").currentTime=e.timeOffset}playPause(e){e&&e.preventDefault();var o=this;o.canBePlayed?o.isPlaying?o._pause():o._play():"none"===o.preload&&(o.shadowRoot.querySelector("#audio").load(),o._play())}_play(){this.shadowRoot.querySelector("#audio").play()}_pause(){this.shadowRoot.querySelector("#audio").pause()}restart(e){e&&e.preventDefault();var o=this;o.shadowRoot.querySelector("#audio").currentTime=0,o.isPlaying||o._play()}_onCanPlay(){var e=this;if(e.canBePlayed=!0,e.timeLeft=e.shadowRoot.querySelector("#audio").duration,e.timeOffset>0){var o=e.timeOffset/e.shadowRoot.querySelector("#audio").duration;e._updateVisualProgress(o)}e.autoPlay&&e._play()}_onPlaying(){var e=this;e.ended=!1,e.isPlaying=!0,e.shadowRoot.querySelector("#replay").style="",e._startProgressTimer()}_skipReverseByInterval(e){e&&e.preventDefault();var o=this,t=0;switch(e.detail.key){case"up":o.largeSkip<o.timeLeft&&(t=o.currentTime+o.largeSkip);break;case"down":o.currentTime-o.largeSkip>0&&(t=o.currentTime-o.largeSkip);break;case"right":o.smallSkip<o.timeLeft&&(t=o.currentTime+o.smallSkip);break;default:o.currentTime-o.smallSkip>0&&(t=o.currentTime-o.smallSkip)}o._updatePlayPosition(t),o.isPlaying||o._play()}_startProgressTimer(){var e=this;e.timer={},e.timer.sliderUpdateInterval&&clearInterval(e.timer.sliderUpdateInterval),e.timer.sliderUpdateInterval=setInterval((function(){if(e.isPlaying){e.currentTime=e.shadowRoot.querySelector("#audio").currentTime,e.timeLeft=e.shadowRoot.querySelector("#audio").duration-e.currentTime;var o=e.currentTime/e.shadowRoot.querySelector("#audio").duration;e._updateVisualProgress(o)}else clearInterval(e.timer.sliderUpdateInterval)}),60)}_onPause(){this.isPlaying=!1}_onEnd(){var e=this;e.ended=!0,e.isPlaying=!1,e.shadowRoot.querySelector("#replay").style.opacity=1}_onError(){var e=this;e.classList.add("cantplay"),e.title="Sorry, can't play track: "+e.title,e.error=!0,e.setAttribute("aria-invalid","true")}_convertSecToMin(e){if(0===e)return"";var o=Math.floor(e/60),t=Math.floor(e%60)+"";return o+":"+(t.length<2?"0"+t:t)}_onDown(e){e.preventDefault();var o=this;o.canBePlayed?(o._updateProgressBar(e),o.isPlaying||o._play()):"none"===o.preload&&(o.shadowRoot.querySelector("#audio").load(),o.shadowRoot.querySelector("#audio").addEventListener("loadedmetadata",(function(){o._updateProgressBar(e),o.isPlaying||o._play()}),!1))}_updateProgressBar(e){var o=this,t=(e.detail.x-o.shadowRoot.querySelector("#center").getBoundingClientRect().left)/o.shadowRoot.querySelector("#center").getBoundingClientRect().width*o.shadowRoot.querySelector("#audio").duration;this._updatePlayPosition(t)}_updatePlayPosition(e){var o=this;o.currentTime=o.shadowRoot.querySelector("#audio").currentTime=e;var t=o.currentTime/o.shadowRoot.querySelector("#audio").duration;o._updateVisualProgress(t)}_updateVisualProgress(e){var o=this;o.shadowRoot.querySelector("#progress").style.transform="scaleX("+e+")",o.shadowRoot.querySelector("#progress2").style.width=100*e+"%",o.shadowRoot.querySelector("#title2").style.width=1/e*100+"%"}_srcChanged(e,o){var t=this;t.isPlaying&&(t._pause(),t._play())}_changeColor(e){var o=this;o.shadowRoot.querySelector("#left").style.backgroundColor=e,o.shadowRoot.querySelector("#title").style.color=e,o.shadowRoot.querySelector("#duration").style.color=e,o.shadowRoot.querySelector("#progress").style.backgroundColor=e,o.shadowRoot.querySelector("#replay").style.color=e}_hidePlayIcon(e,o){return!!e||!(o||"none"===this.preload)}_setPreload(e,o){return e?"auto":o}}window.customElements.define(PaperAudioPlayer.tag,PaperAudioPlayer);export{PaperAudioPlayer};