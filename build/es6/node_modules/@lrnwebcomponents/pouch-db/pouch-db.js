import{html,PolymerElement}from"../../@polymer/polymer/polymer-element.js";import"./lib/pouchdb.min.js";window.PouchDb=window.PouchDb||{},window.PouchDb.requestAvailability=()=>(window.PouchDb.instance||(window.PouchDb.instance=document.createElement("pouch-db"),document.body.appendChild(window.PouchDb.instance)),window.PouchDb.instance);class PouchDb extends PolymerElement{static get template(){return html`
      <style>
        :host {
          display: block;
        }

        :host([hidden]) {
          display: none;
        }
      </style>
      <slot></slot>
      <div>[[title]]</div>
    `}static get properties(){return{title:{name:"title",type:"String",value:"pouch-db-default-value",reflectToAttribute:!1,observer:!1}}}static get tag(){return"pouch-db"}connectedCallback(){super.connectedCallback(),window.addEventListener("user-engagement",this.userEngagmentFunction.bind(this)),window.addEventListener("show-data",this.showDataFunction.bind(this))}userEngagmentFunction(e){var eventData=e.detail,db=new PouchDB(eventData.dbType),objectStatement={actor:{mbox:"mailto:dave@gmail.com",name:"Dave Fusco",objectType:"Agent"},verb:{id:eventData.activityId,display:{"en-US":eventData.activityDisplay}},object:{id:eventData.objectId,definition:{name:{"en-US":eventData.objectName},description:{"en-US":eventData.objectDescription}},objectType:"Activity"},result:{score:{scaled:eventData.resultScoreScaled,min:eventData.resultScoreMin,max:eventData.resultScoreMax,raw:eventData.resultScoreRaw},success:eventData.resultSuccess,completion:eventData.resultCompletion,response:eventData.resultResponse,duration:eventData.resultDuration}},xapistatement={_id:(new Date).toISOString(),title:JSON.stringify(objectStatement),completed:!1};db.put(xapistatement,function callback(err,result){err||console.log("Successfully posted a statement!")}),db.allDocs({include_docs:!0,descending:!0},function(err,doc){console.log(doc.rows)})}showDataFunction(e){var eventData=e.detail;new PouchDB(eventData.dbType).allDocs({include_docs:!0,descending:!0},function(err,doc){!function processxAPI(statements,callback){var arrayxAPI=[];statements.forEach(function(statement){var jsonStatement=JSON.parse(statement.doc.title).object.definition.name["en-US"];arrayxAPI.push(jsonStatement)}),callback(arrayxAPI)}(doc.rows,function displayxAPI(mapxAPI){!function processItems(statements,callback){var map={};statements.forEach(function(statement){map[statement]=(map[statement]||0)+1}),callback(map)}(mapxAPI,function display(backMap){var labelsArray=[],resultsArray=[];for(let key of Object.keys(backMap))labelsArray.push(key);for(let value of Object.values(backMap))resultsArray.push(value);var bardata={labels:labelsArray,series:[resultsArray]};document.getElementById("bar-chart").data=bardata})})})}disconnectedCallback(){window.removeEventListener("user-engagement",this.userEngagmentFunction.bind(this)),window.removeEventListener("show-data",this.showDataFunction.bind(this)),super.disconnectedCallback()}}window.customElements.define(PouchDb.tag,PouchDb);export{PouchDb};