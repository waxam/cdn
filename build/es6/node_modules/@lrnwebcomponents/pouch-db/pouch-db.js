/**
 * Copyright 2019
 * @license Apache-2.0, see License.md for full text.
 */
import"./lib/pouchdb.min.js";window.PouchDb=window.PouchDb||{},window.PouchDb.requestAvailability=()=>(window.PouchDb.instance||(window.PouchDb.instance=document.createElement("pouch-db"),document.body.appendChild(window.PouchDb.instance)),window.PouchDb.instance);export const PouchDBElement=window.PouchDb.requestAvailability();class PouchDb extends HTMLElement{constructor(){super()}static get tag(){return"pouch-db"}connectedCallback(){window.addEventListener("user-engagement",this.userEngagmentFunction.bind(this)),window.addEventListener("get-data",this.getDataFunction.bind(this))}disconnectedCallback(){window.removeEventListener("user-engagement",this.userEngagmentFunction.bind(this)),window.removeEventListener("get-data",this.getDataFunction.bind(this))}userEngagmentFunction(e){var t=e.detail;switch(e.target.tagName){case"MULTIPLE-CHOICE":var n="xapistatements",a=t.activityDisplay,i="http://adlnet.gov/expapi/verbs/"+a,s="http://haxcms.psu.edu/haxQuiz",o=t.objectName,c="HAX Quiz",u=1,d=0,l=100,r=100,b=t.resultSuccess,m=!0,p="sample",h="sample"}var w=new PouchDB(n),g={actor:{mbox:"mailto:dave@gmail.com",name:"Dave Fusco",objectType:"Agent"},verb:{id:i,display:{"en-US":a}},object:{id:s,definition:{name:{"en-US":o},description:{"en-US":c}},objectType:"Activity"},result:{score:{scaled:u,min:d,max:l,raw:r},success:b,completion:m,response:p,duration:h}},v={_id:(new Date).toISOString(),title:JSON.stringify(g),completed:!1};w.put(v,(function callback(e,t){e||console.log("Successfully posted a statement!")})),w.allDocs({include_docs:!0,descending:!0},(function(e,t){console.log(t.rows)}))}getDataFunction(e){var t=e.detail;e.target.tagName;switch(t.queryRequest){case"all-quizzes":var n="xapistatements";break;case"single-quiz":n="xapistatements",t.objectName;break;case"future-query":n="xapistatements",t.activityDisplay,t.objectName,t.resultSuccess,t.resultCompletion;break;default:n="xapistatements"}new PouchDB(n).allDocs({include_docs:!0,descending:!0},(function(e,t){!function processxAPI(e,t){var n=[];e.forEach((function(e){var t=JSON.parse(e.doc.title).object.definition.name["en-US"];n.push(t)})),t(n)}(t.rows,(function displayxAPI(e){!function processItems(e,t){var n={};e.forEach((function(e){n[e]=(n[e]||0)+1})),t(n)}(e,(function display(e){var t=[],n=[];for(let n of Object.keys(e))t.push(n);for(let t of Object.values(e))n.push(t);let a=[""];a={labels:t,series:[n]},window.dispatchEvent(new CustomEvent("show-data",{bubbles:!0,composed:!0,cancelable:!1,detail:a}))}))}))}))}}window.customElements.define(PouchDb.tag,PouchDb);export{PouchDb};