import{html,PolymerElement}from"../../@polymer/polymer/polymer-element.js";import"./lib/pouchdb.min.js";window.PouchDb=window.PouchDb||{},window.PouchDb.requestAvailability=()=>(window.PouchDb.instance||(window.PouchDb.instance=document.createElement("pouch-db"),document.body.appendChild(window.PouchDb.instance)),window.PouchDb.instance);class PouchDb extends PolymerElement{static get template(){return html`
      <style>
        :host {
          display: block;
        }

        :host([hidden]) {
          display: none;
        }
      </style>
      <slot></slot>
    `}static get properties(){return{title:{name:"title",type:String,value:"pouch-db-default-value",reflectToAttribute:!1,observer:!1}}}static get tag(){return"pouch-db"}connectedCallback(){super.connectedCallback(),window.addEventListener("user-engagement",this.userEngagmentFunction.bind(this)),window.addEventListener("get-data",this.getDataFunction.bind(this))}userEngagmentFunction(e){var eventData=e.detail;switch(event.target.tagName){case"MULTIPLE-CHOICE":var dbType="xapistatements",activityDisplay=eventData.activityDisplay,activityId="http://adlnet.gov/expapi/verbs/"+activityDisplay,objectId="http://haxcms.psu.edu/haxQuiz",objectName=eventData.objectName,objectDescription="HAX Quiz",resultScoreScaled=1,resultScoreMin=0,resultScoreMax=100,resultScoreRaw=100,resultSuccess=eventData.resultSuccess,resultCompletion=!0,resultResponse="sample",resultDuration="sample"}var db=new PouchDB(dbType),objectStatement={actor:{mbox:"mailto:dave@gmail.com",name:"Dave Fusco",objectType:"Agent"},verb:{id:activityId,display:{"en-US":activityDisplay}},object:{id:objectId,definition:{name:{"en-US":objectName},description:{"en-US":objectDescription}},objectType:"Activity"},result:{score:{scaled:resultScoreScaled,min:resultScoreMin,max:resultScoreMax,raw:resultScoreRaw},success:resultSuccess,completion:resultCompletion,response:resultResponse,duration:resultDuration}},xapistatement={_id:(new Date).toISOString(),title:JSON.stringify(objectStatement),completed:!1};db.put(xapistatement,function callback(err,result){err||console.log("Successfully posted a statement!")}),db.allDocs({include_docs:!0,descending:!0},function(err,doc){console.log(doc.rows)})}getDataFunction(e){var eventData=e.detail;event.target.tagName;switch(eventData.queryRequest){case"all-quizzes":var dbType="xapistatements";break;case"single-quiz":dbType="xapistatements",eventData.objectName;break;case"future-query":dbType="xapistatements",eventData.activityDisplay,eventData.objectName,eventData.resultSuccess,eventData.resultCompletion;break;default:dbType="xapistatements"}new PouchDB(dbType).allDocs({include_docs:!0,descending:!0},function(err,doc){!function processxAPI(statements,callback){var arrayxAPI=[];statements.forEach(function(statement){var jsonStatement=JSON.parse(statement.doc.title).object.definition.name["en-US"];arrayxAPI.push(jsonStatement)}),callback(arrayxAPI)}(doc.rows,function displayxAPI(mapxAPI){!function processItems(statements,callback){var map={};statements.forEach(function(statement){map[statement]=(map[statement]||0)+1}),callback(map)}(mapxAPI,function display(backMap){var labelsArray=[],resultsArray=[];for(let key of Object.keys(backMap))labelsArray.push(key);for(let value of Object.values(backMap))resultsArray.push(value);let queryData=[""];queryData={labels:labelsArray,series:[resultsArray]},window.dispatchEvent(new CustomEvent("show-data",{bubbles:!0,composed:!0,cancelable:!1,detail:queryData}))})})})}disconnectedCallback(){window.removeEventListener("user-engagement",this.userEngagmentFunction.bind(this)),window.removeEventListener("get-data",this.getDataFunction.bind(this)),super.disconnectedCallback()}}window.customElements.define(PouchDb.tag,PouchDb);export{PouchDb};