import{html,Polymer}from"@polymer/polymer/polymer-legacy.js";import{dom}from"@polymer/polymer/lib/legacy/polymer.dom.js";import*as async from"@polymer/polymer/lib/utils/async.js";import"@polymer/iron-ajax/iron-ajax.js";import"@polymer/paper-spinner/paper-spinner.js";import"@lrnwebcomponents/hax-body-behaviors/lib/HAXWiring.js";var $_documentContainer=document.createElement("div");$_documentContainer.setAttribute("style","display: none;"),$_documentContainer.innerHTML=`<dom-module id="cms-token">
    <template strip-whitespace="">
        <style>
            :host {
                display: inline;
                min-width: 112px;
                min-height: 112px;
                transition: .6s all ease;
                background-color: transparent;
            }

            paper-spinner {
                transition: .6s all ease;
                position: absolute;
                visibility: hidden;
                display: none;
                opacity: 0;
                height: 0;
                width: 0;
            }

            #replacementcontent {
                transition: .6s all ease;
                visibility: visible;
                opacity: 1;
                height: auto;
                width: auto;
            }

            :host([loading]) {
                text-align: center;
            }

            :host([loading]) paper-spinner {
                visibility: visible;
                opacity: 1;
                position: relative;
                height: 80px;
                width: 80px;
                padding: 16px;
                display: flex;
            }

            :host([loading]) #replacementcontent {
                opacity: 0;
                visibility: hidden;
                height: 0;
                width: 0;
            }
        </style>
        <iron-ajax id="tokenrequest" method="GET" params="[[bodyData]]" url="[[tokenEndPoint]]" handle-as="json" last-response="{{tokenData}}"></iron-ajax>
        <paper-spinner active="[[loading]]"></paper-spinner>
        <span id="replacementcontent">
            <slot></slot>
        </span>
    </template>

    
</dom-module>`,document.head.appendChild($_documentContainer),Polymer({is:"cms-token",behaviors:[HAXBehaviors.PropertiesBehaviors],properties:{loading:{type:Boolean,reflectToAttribute:!0,value:!1},token:{type:String,reflectToAttribute:!0},tokenEndPoint:{type:String},bodyData:{type:Object,computed:"_generateBodyData(token, _clickInvoked)",observer:"_tokenChanged"},_clickInvoked:{type:String,value:!1},tokenData:{type:String,observer:"_handleTokenResponse"},tokenPrefix:{type:String,value:"["},tokenSuffix:{type:String,value:"]"},_displayMode:{type:String,value:"full",observer:"_displayModeChanged"}},_displayModeChanged:function(a,b){typeof a!==typeof void 0&&""!=a&&typeof this.token!==typeof void 0&&(this.token=this.token.replace(b,a))},_generateBodyData:function(a,b){if(null!==a&&""!==a){let c=this.tokenPrefix,d=this.tokenSuffix;return{token:`${c}${a}${d}`,cachedResponse:b}}},_handleTokenResponse:function(a){null!==a&&typeof a.content!==typeof void 0&&(null!=document.getElementById("cmstokenidtolockonto")&&(document.getElementById("cmstokenidtolockonto").setAttribute("href",a.editEndpoint),document.getElementById("cmstokenidtolockonto").innerHTML=a.editText,document.getElementById("cmstokenidtolockonto").addEventListener("click",this.__tokenClicked.bind(this))),this.wipeSlot(dom(this)),async.microTask.run(()=>{let c=document.createElement("template");c.innerHTML=a.content,dom(this).appendChild(document.importNode(c.content,!0)),this.loading=!1}))},wipeSlot:function(a){for(;null!==a.firstChild;)a.removeChild(a.firstChild)},_tokenChanged:function(a){typeof a===typeof void 0||""===a||this.loading||(typeof this.tokenEndPoint===typeof void 0&&typeof window.cmstokenEndPoint!==typeof void 0&&(this.tokenEndPoint=window.cmstokenEndPoint),this.tokenEndPoint&&(this.loading=!0,async.microTask.run(()=>{this.$.tokenrequest.generateRequest()})))},_windowVisibilityChanged:function(){!this.loading&&this._clickInvoked&&(this.$.tokenrequest.generateRequest(),this._clickInvoked=!1)},__tokenClicked:function(){this._clickInvoked=!0},detached:function(){document.removeEventListener("visibilitychange",this._windowVisibilityChanged.bind(this))},attached:function(){if(document.addEventListener("visibilitychange",this._windowVisibilityChanged.bind(this)),typeof this.token!=="undefined"&&null!==this.token&&""!==this.token){let b=dom(this).getEffectiveChildNodes();0!==b.length||this.loading||(typeof this.tokenEndPoint==="undefined"&&typeof window.cmstokenEndPoint!=="undefined"&&(this.tokenEndPoint=window.cmstokenEndPoint),this.tokenEndPoint&&(this.loading=!0,async.microTask.run(()=>{this.$.tokenrequest.generateRequest()})))}this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!1,gizmo:{title:"CMS Token",description:"CMS token rendered on the backend",icon:"icons:code",color:"light-blue",groups:["CMS"],handles:[{type:"cmstoken",token:"token"}],meta:{author:"LRNWebComponents"}},settings:{quick:[],configure:[{property:"token",title:"Token",description:"Token from our CMS",inputMethod:"textfield",icon:"editor:title"}],advanced:[]},saveOptions:{wipeSlot:!0,unsetAttributes:["loading","token-data","body-data","token-end-point"]}})},postProcessgetHaxJSONSchema:function(a){let b="",c="Edit";if("undefined"!==typeof this.tokenData)for(var d in b=this.tokenData.editEndpoint,c=this.tokenData.editText,this.tokenData.schema)a.properties[d]=this.tokenData.schema[d];return a.properties.__editThis={type:"string",component:{name:"a",properties:{id:"cmstokenidtolockonto",href:b,target:"_blank"},slot:c}},a}});