import{html,PolymerElement}from"../../../@polymer/polymer/polymer-element.js";import"../../../@polymer/iron-resizable-behavior/iron-resizable-behavior.js";window.AbsolutePositionStateManager=window.AbsolutePositionStateManager||{},window.AbsolutePositionStateManager.requestAvailability=()=>(window.AbsolutePositionStateManager.instance||(window.AbsolutePositionStateManager.instance=document.createElement("absolute-position-state-manager"),document.body.appendChild(window.AbsolutePositionStateManager.instance)),window.AbsolutePositionStateManager.instance);class AbsolutePositionStateManager extends PolymerElement{static get tag(){return"absolute-position-state-manager"}static get properties(){return{els:{type:Array,value:[]}}}constructor(){super();if(!window.AbsolutePositionStateManager.instance)return window.AbsolutePositionStateManager.instance=this,this}connectedCallback(){super.connectedCallback()}loadElement(el){this.__on=void 0!==this.__on&&this.__on,this.els.push(el),this.positionElement(el),this.__on||this.addEventListeners(),this.__on=!0}unloadElement(el){this.els.filter(el=>el==el),this.__on=this.els>0,this.__on||this.removeEventListeners()}addEventListeners(){let root=this;root.__timeout=!1,root.updateElements(),document.addEventListener("load",root.updateElements()),window.addEventListener("resize",function(){clearTimeout(root.__timeout),root.__timeout=setTimeout(root.updateElements(),250)}),root.__observer=new MutationObserver(function(mutations){root.checkMutations(mutations)}),root.__observer.observe(document,{attributes:!0,childList:!0,subtree:!0,characterData:!0})}checkMutations(mutations){let update=!1;mutations.forEach(mutation=>{update||(update=update||!("attributes"===mutation.type&&"style"===mutation.attributeName&&this.els.includes(mutation.target)))}),update&&this.updateElements()}findTarget(el){let selector="#"+el.for,docQuery=1===document.querySelectorAll(selector).length?document.querySelector(selector):null,target=el.target||docQuery,ancestor=el;for(;void 0!==el.for&&null===target&&null!==ancestor&&ancestor!==document;)11===(ancestor=ancestor.parentNode).nodeType&&(ancestor=ancestor.host),target=ancestor?ancestor.querySelector(selector):null;return target}removeEventListeners(){let root=this;document.removeEventListener("load",root.updateElements()),window.removeEventListener("resize",function(){clearTimeout(root.__timeout),root.__timeout=setTimeout(root.updateElements(),250)}),root.__observer&&root.__observer.disconnect()}updateElements(){let root=this;root.els.forEach(el=>{root.positionElement(el)})}positionElement(el){let target=this.findTarget(el);if(!target||!el.offsetParent)return;let elLeft,elTop,styleLeft,styleTop,offset=el.offset,parentRect=el.offsetParent.getBoundingClientRect(),targetRect=target.getBoundingClientRect(),elRect=el.getBoundingClientRect(),centerOffset=(targetRect.width-elRect.width)/2,middleOffset=(targetRect.height-elRect.height)/2;switch(el.position){case"top":elLeft=targetRect.left+centerOffset,elTop=targetRect.top-elRect.height-offset;break;case"bottom":elLeft=targetRect.left+centerOffset,elTop=targetRect.top+targetRect.height+offset;break;case"left":elLeft=targetRect.left-elRect.width-offset,elTop=targetRect.top+middleOffset;break;case"right":elLeft=targetRect.left+targetRect.width+offset,elTop=targetRect.top+middleOffset}el.style.position="absolute",styleLeft=elLeft+"px",styleTop=elTop+"px",el.fitToVisibleBounds&&(elLeft-offset<parentRect.left||elRect.width>parentRect.width?styleLeft=parentRect.left+"px":elRect.right>parentRect.right&&(styleLeft=targetRect.right-elRect.width+"px"),elTop-offset<parentRect.top||elRect.height>parentRect.height?styleTop=parentRect.top+"px":elRect.bottom>parentRect.bottom&&(styleLeft=targetRect.bottom-elRect.height+"px")),el.style.left=styleLeft,el.style.top=styleTop,el.__positions={self:elRect,parent:parentRect,target:targetRect}}disconnectedCallback(){this.removeEventListeners(),super.disconnectedCallback()}}window.customElements.define(AbsolutePositionStateManager.tag,AbsolutePositionStateManager);export{AbsolutePositionStateManager};