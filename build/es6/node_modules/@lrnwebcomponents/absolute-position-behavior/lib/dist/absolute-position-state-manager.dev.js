Object.defineProperty(exports,"__esModule",{value:!0}),exports.AbsolutePositionStateManager=void 0;var t=require("lit");function _typeof(t){return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function _typeof(t){return typeof t}:function _typeof(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_typeof(t)}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function _get(t,e,o){return _get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(t,e,o){var n=function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}(t,e);if(n){var i=Object.getOwnPropertyDescriptor(n,e);return i.get?i.get.call(o):i.value}},_get(t,e,o||t)}function _getPrototypeOf(t){return _getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(t){return t.__proto__||Object.getPrototypeOf(t)},_getPrototypeOf(t)}function _defineProperties(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function _createClass(t,e,o){return e&&_defineProperties(t.prototype,e),o&&_defineProperties(t,o),t}function _setPrototypeOf(t,e){return _setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(t,e){return t.__proto__=e,t},_setPrototypeOf(t,e)}window.AbsolutePositionStateManager=window.AbsolutePositionStateManager||{},window.AbsolutePositionStateManager.requestAvailability=function(){if(!window.AbsolutePositionStateManager.instance){window.AbsolutePositionStateManager.instance=document.createElement("absolute-position-state-manager");var t=window.AbsolutePositionStateManager.instance;document.body.appendChild(t)}return window.AbsolutePositionStateManager.instance};var e=function(e){function AbsolutePositionStateManager(){var t;return function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,AbsolutePositionStateManager),(t=_possibleConstructorReturn(this,_getPrototypeOf(AbsolutePositionStateManager).call(this))).elements=[],t.__timeout=!1,t.__observer=new MutationObserver((function(e){return t.checkMutations(e)})),t}return function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}(AbsolutePositionStateManager,t.LitElement),_createClass(AbsolutePositionStateManager,null,[{key:"tag",get:function get(){return"absolute-position-state-manager"}},{key:"properties",get:function get(){return{elements:{type:Array},__observer:{type:Object},__timeout:{type:Object},__timeout2:{type:Object}}}}]),_createClass(AbsolutePositionStateManager,[{key:"loadElement",value:function loadElement(t){this.elements.length<1&&(this.__observer.observe(document,{attributes:!0,childList:!0,subtree:!0,characterData:!0}),this.updateElements(),document.addEventListener("load",this.updateElements),window.addEventListener("resize",this._handleResize)),this.elements.push(t),t.style.top=0,t.style.left=0,this.positionElement(t)}},{key:"unloadElement",value:function unloadElement(t){this.elements.filter((function(e){return e===t})),this.elements.length<1&&this.removeEventListeners()}},{key:"_handleScroll",value:function _handleScroll(){this.__timeout2&&clearTimeout(this.__timeout2),this.__timeout2=setTimeout(window.AbsolutePositionStateManager.instance.updateStickyElements(),1e3)}},{key:"_handleResize",value:function _handleResize(){this.__timeout&&clearTimeout(this.__timeout),this.__timeout=setTimeout(window.AbsolutePositionStateManager.instance.updateElements(),250)}},{key:"checkMutations",value:function checkMutations(t){var e=this,o=!1;t.forEach((function(t){o||(o=o||!("attributes"===t.type&&"style"===t.attributeName&&e.elements.includes(t.target)))})),o&&this.updateElements()}},{key:"findTarget",value:function findTarget(t){for(var e="#"+t.for,o=t.target,n=t;t.for&&!o&&n&&n.parentNode&&n!==document;)o=(n=n.parentNode)?n.querySelector(e):void 0,11===n.nodeType&&(n=n.host),o=!o&&n?n.querySelector(e):o;return o}},{key:"removeEventListeners",value:function removeEventListeners(){this.__observer&&this.__observer.disconnect&&this.__observer.disconnect(),document.removeEventListener("load",this.updateElements),window.removeEventListener("resize",this._handleResize),this.__watchSticky&&window.removeEventListener("scroll",this._handleScroll)}},{key:"updateElements",value:function updateElements(){var t=this;this.elements.forEach((function(e){return t.positionElement(e)})),this.loadSticky()}},{key:"updateStickyElements",value:function updateStickyElements(){var t=this;this.elements.forEach((function(e){e.sticky&&t.positionElement(e)}))}},{key:"loadSticky",value:function loadSticky(){!this.__watchSticky&&this.elements.filter((function(t){return t.sticky})).length>0?(this.__watchSticky=!0,window.addEventListener("scroll",this._handleScroll)):this.__watchSticky&&this.elements.filter((function(t){return t.sticky})).length<1&&(window.removeEventListener("scroll",this._handleScroll),this.__watchSticky=!1)}},{key:"_getParentNode",value:function _getParentNode(t){var e=t.parentNode;return null!=e&&e.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&(e=e.host),e}},{key:"positionElement",value:function positionElement(t){t.position||(t.position="bottom"),t.style.top||(t.style.top="0px"),t.style.left||(t.style.left="0px");var e=this.findTarget(t),o=t.offsetParent,n=!e||e.getBoundingClientRect();if(e&&o){t.justify&&(t.style.width="".concat(n.width,"px"));var i=parseFloat(t.offset),r=document.body.getBoundingClientRect(),s=o.getBoundingClientRect(),l=t.getBoundingClientRect(),a=function vertical(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.position;return"left"!==e&&"right"!==e},u=function before(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.position;return"left"===e||"top"===e},c=function setAlign(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a(t.position),o=function pxToNum(t){return parseFloat(t.replace("px",""))},i=e?o(t.style.left)-l.left:o(t.style.top)-l.top,s=e?"left":"top",u=function distance(t){return e?t.width:t.height},c=i+u(r)-u(l),p=i;return"end"===t.positionAlign?p+=n[s]-u(l)+u(n):"start"===t.positionAlign?p+=n[s]:p+=n[s]-u(l)/2+u(n)/2,t.fitToVisibleBounds?Math.max(i,Math.min(c,p)):p},p=function getCoord(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.position,o=function pxToNum(t){return parseFloat(t.replace("px",""))},r=a(e)?o(t.style.top)-l.top:o(t.style.left)-l.left,s="visible"==window.getComputedStyle(t,null).overflowY?Math.max(l.height,t.scrollHeight):l.height,u="visible"==window.getComputedStyle(t,null).overflowX?Math.max(l.width,t.scrollWidth):l.width;return"top"===e?n.top+r-s-i:"left"===e?n.left+r-u-i:n[e]+r+i},f=function isFit(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.position,o=function distance(t){return a(e)?l.height+i:l.width+i};return u(e)?n[e]-r[e]>o:r[e]-n[e]>o},h=!1!==t.fitToVisibleBounds&&!f(t.position),d={top:["bottom","left","right"],left:["right","top","bottom"],bottom:["top","right","left"],right:["left","bottom","top"]};t.style.position="absolute",h&&f(d[t.position][0])?t.position=d[t.position][0]:h&&f(d[t.position][1])?t.position=d[t.position][1]:h&&f(d[t.position][2])&&(t.position=d[t.position][2]);var y=a(t.position)?p():c(),g=a(t.position)?c():p();if(t.sticky){var _=window.pageYOffset||(document.documentElement||document.body.parentNode||document.body).scrollTop,m=window.innerHeight,b=0===l.height&&t.children&&t.children[0]?t.children[0].offsetHeight:l.height,v=n.top-l.height<0&&n.top+n.height>20+b,w=n.top+n.height+l.height>m&&n.top<m-b;"top"===t.position&&v&&(y=_-o.offsetTop+(b-l.height)),"bottom"===t.position&&w&&(y=_+m-o.offsetTop-b)}t.style.top=y+"px",t.style.left=g+"px",t.__positions={self:l,parent:s,target:n}}}},{key:"disconnectedCallback",value:function disconnectedCallback(){this.removeEventListeners(),_get(_getPrototypeOf(AbsolutePositionStateManager.prototype),"disconnectedCallback",this).call(this)}}]),AbsolutePositionStateManager}();exports.AbsolutePositionStateManager=e,window.customElements.define(e.tag,e);