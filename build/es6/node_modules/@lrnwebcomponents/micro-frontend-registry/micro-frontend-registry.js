/**
 * Copyright 2022 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
const t=["endpoint","name","title","description","params","callback"];export class MicroFrontend{constructor(n={}){t.map((t=>this[t]="params"===t?n[t]||{}:n[t]||null))}}class MicroFrontendRegistryEl extends HTMLElement{static get tag(){return"micro-frontend-registry"}constructor(){super(),this.list=[],this.MicroFrontend=MicroFrontend}add(t){this.define(new MicroFrontend(t))}define(n){if(n instanceof MicroFrontend||(console.warn("MicroFrontendRegistry: use class MicroFrontend instance but if keys match it will register still."),console.warn(n)),!Object.keys(n).every((n=>t.includes(n))))return!1;if(n.endpoint.startsWith("/api/")){var i="";i=window.MicroFrontendRegistryConfig.base?window.MicroFrontendRegistryConfig.base:window.location.origin.startsWith("http://localhost")?window.location.origin.replace(/localhost:8(.*)/,"localhost:3000"):"https://haxapi.vercel.app",n.endpoint=`${i}${n.endpoint}`}return window.MicroFrontendRegistryConfig[n.name]&&Object.keys(window.MicroFrontendRegistryConfig[n.name]).map((t=>{n[t]=window.MicroFrontendRegistryConfig[n.name][t]})),this.has(n.name)?void 0:(this.list.push(n),!0)}get(t,n=!1){if(t&&this.list.length>0){const n=this.list.find((n=>n.name===t));if(n)return n}return n||console.error(`call for ${t} but not found in micro-frontend-registry`),null}has(t){return null!==this.get(t,!0)}set(t,n={}){if(t&&this.list.length>0&&this.has(t)){const i=this.list.findIndex((n=>n.name===t));this.list[i]=n}return null}async call(t,n={},i=null,e=null){if(this.has(t)){const r=this.get(t),o=await fetch(r.endpoint,{method:"POST",body:n instanceof FormData?n:JSON.stringify(n)}).then((t=>t.ok?t.json():{status:t.status,data:null})).catch(((t,n)=>({status:500,data:null})));return r.callback&&await r.callback(o,e),i&&await i(o,e),o}return null}url(t,n={}){if(this.has(t)){const e=this.get(t);for(var i in n)n.hasOwnProperty(i)&&null==n[i]&&delete n[i];return new URL(e.endpoint).toString()+`?${new URLSearchParams(n).toString()}`}return""}}customElements.define(MicroFrontendRegistryEl.tag,MicroFrontendRegistryEl),window.MicroFrontendRegistry=window.MicroFrontendRegistry||{},window.MicroFrontendRegistryConfig=window.MicroFrontendRegistryConfig||{},window.MicroFrontendRegistry.requestAvailability=()=>(window.MicroFrontendRegistry.instance||(window.MicroFrontendRegistry.instance=document.createElement(MicroFrontendRegistryEl.tag),document.body.appendChild(window.MicroFrontendRegistry.instance)),window.MicroFrontendRegistry.instance);export const MicroFrontendRegistry=window.MicroFrontendRegistry.requestAvailability();