import"../es-global-bridge/es-global-bridge.js";class ExifData extends HTMLElement{static get tag(){return"exif-data"}pathFromUrl(url){return url.substring(0,url.lastIndexOf("/")+1)}get html(){return'\n    <style>\n      ul.showdata {\n        z-index: 1;\n        visibility: visible;\n        opacity: .9;\n      }\n      ul {\n        position: absolute;\n        transition: 0.3s linear all;\n        background-color: #000000;\n        opacity: 0;\n        visibility: hidden;\n        overflow: scroll;\n        padding: 0;\n        margin: 0;\n      }\n      ul li {\n        padding: 8px;\n        font-size: 14px;\n        color: white;\n      }\n    </style>\n    <slot></slot>\n    <ul id="data"></ul>'}render(){this.shadowRoot.innerHTML=null,this.template.innerHTML=this.html,this.shadowRoot.appendChild(this.template.content.cloneNode(!0))}constructor(){super();const basePath=this.pathFromUrl(decodeURIComponent(import.meta.url));window.ESGlobalBridge.requestAvailability(),window.ESGlobalBridge.instance.load("exif-js",`${basePath}lib/exif-js.js`),window.addEventListener("es-bridge-exif-js-loaded",this._onExifJsLoaded.bind(this)),this.template=document.createElement("template"),this.attachShadow({mode:"open"}),this.render(),this.getAttribute("no-events")||this.addEventListener("click",this.clickImage.bind(this))}_onExifJsLoaded(){window.removeEventListener("es-bridge-exif-js-loaded",this._onExifJsLoaded.bind(this)),this.__ready=!0,this.updateExif()}showDetails(item){let target=this.alignTarget;target||(target=item.node);const dim=target.getBoundingClientRect();var content="";for(var key in item.data)""!=item.data[key]&&0!=item.data[key]&&" "!=item.data[key]&&0!=item.data[key]&&null!=item.data[key]&&(content+=`<li><strong>${key}</strong>: ${item.data[key]}</li>`);this.dataElement.innerHTML=content,this.alignTargetTop?this.dataElement.style.top=this.alignTargetTop:this.dataElement.style.top=dim.top+"px",this.dataElement.style.height=dim.height+"px",this.dataElement.style.width=dim.width+"px",this.dataElement.style.left=dim.left+"px",this.dataElement.classList.add("showdata")}clickImage(e){"IMG"===e.target.tagName&&this.nodeData.forEach(item=>{item.node===e.target&&this.showDetails(item)})}getExifData(node){window.EXIF.getData(node,()=>{let data=window.EXIF.getAllTags(node);delete data.MakerNote,delete data.thumbnail,this.nodeData.push({node:node,data:data})})}updateExif(show=!1){this.nodeData=[],this.dataElement.innerHTML="",this.childNodes.forEach(node=>{this.__ready&&node.tagName&&"IMG"===node.tagName&&this.getExifData(node)}),show&&1===this.children.length&&this.showDetails(this.nodeData[0])}clickData(e){this.dataElement.classList.remove("showdata")}connectedCallback(){window.ShadyCSS&&window.ShadyCSS.styleElement(this),this.dataElement=this.shadowRoot.querySelector("#data"),this.getAttribute("no-events")||this.dataElement.addEventListener("click",this.clickData.bind(this)),this.observer=new MutationObserver(mutations=>{this.updateExif()}),this.observer.observe(this,{childList:!0})}disconnectedCallback(){this.getAttribute("no-events")||this.dataElement.removeEventListener("click",this.clickData.bind(this)),this.observer.disconnect()}}window.customElements.define(ExifData.tag,ExifData);export{ExifData};