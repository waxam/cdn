function OpenSeadragon(G){return new OpenSeadragon.Viewer(G)}var e,t;!function(G){G.version={versionStr:"2.4.0",major:parseInt("2",10),minor:parseInt("4",10),revision:parseInt("0",10)};var q={"[object Boolean]":"boolean","[object Number]":"number","[object String]":"string","[object Function]":"function","[object Array]":"array","[object Date]":"date","[object RegExp]":"regexp","[object Object]":"object"},Z=Object.prototype.toString,X=Object.prototype.hasOwnProperty;G.isFunction=function(q){return"function"===G.type(q)},G.isArray=Array.isArray||function(q){return"array"===G.type(q)},G.isWindow=function(G){return G&&"object"==typeof G&&"setInterval"in G},G.type=function(G){return null==G?String(G):q[Z.call(G)]||"object"},G.isPlainObject=function(q){if(!q||"object"!==OpenSeadragon.type(q)||q.nodeType||G.isWindow(q))return!1;if(q.constructor&&!X.call(q,"constructor")&&!X.call(q.constructor.prototype,"isPrototypeOf"))return!1;var Z;for(var K in q)Z=K;return void 0===Z||X.call(q,Z)},G.isEmptyObject=function(G){for(var q in G)return!1;return!0},G.freezeObject=function(q){return Object.freeze?G.freezeObject=Object.freeze:G.freezeObject=function(G){return G},G.freezeObject(q)},G.supportsCanvas=function(){var q=document.createElement("canvas");return!(!G.isFunction(q.getContext)||!q.getContext("2d"))}(),G.isCanvasTainted=function(G){var q=!1;try{G.getContext("2d").getImageData(0,0,1,1)}catch(G){q=!0}return q},G.pixelDensityRatio=function(){if(G.supportsCanvas){var q=document.createElement("canvas").getContext("2d"),Z=window.devicePixelRatio||1,X=q.webkitBackingStorePixelRatio||q.mozBackingStorePixelRatio||q.msBackingStorePixelRatio||q.oBackingStorePixelRatio||q.backingStorePixelRatio||1;return Math.max(Z,1)/X}return 1}()}(OpenSeadragon),function($){$.extend=function(){var G,q,Z,X,K,Y,Q=arguments[0]||{},J=arguments.length,ee=!1,te=1;for("boolean"==typeof Q&&(ee=Q,Q=arguments[1]||{},te=2),"object"==typeof Q||OpenSeadragon.isFunction(Q)||(Q={}),J===te&&(Q=this,--te);te<J;te++)if(null!==(G=arguments[te])||void 0!==G)for(q in G)Z=Q[q],Q!==(X=G[q])&&(ee&&X&&(OpenSeadragon.isPlainObject(X)||(K=OpenSeadragon.isArray(X)))?(K?(K=!1,Y=Z&&OpenSeadragon.isArray(Z)?Z:[]):Y=Z&&OpenSeadragon.isPlainObject(Z)?Z:{},Q[q]=OpenSeadragon.extend(ee,Y,X)):void 0!==X&&(Q[q]=X));return Q};var isIOSDevice=function(){if("object"!=typeof navigator)return!1;var G=navigator.userAgent;return"string"==typeof G&&(-1!==G.indexOf("iPhone")||-1!==G.indexOf("iPad")||-1!==G.indexOf("iPod"))};$.extend($,{DEFAULT_SETTINGS:{xmlPath:null,tileSources:null,tileHost:null,initialPage:0,crossOriginPolicy:!1,ajaxWithCredentials:!1,loadTilesWithAjax:!1,ajaxHeaders:{},panHorizontal:!0,panVertical:!0,constrainDuringPan:!1,wrapHorizontal:!1,wrapVertical:!1,visibilityRatio:.5,minPixelRatio:.5,defaultZoomLevel:0,minZoomLevel:null,maxZoomLevel:null,homeFillsViewer:!1,clickTimeThreshold:300,clickDistThreshold:5,dblClickTimeThreshold:300,dblClickDistThreshold:20,springStiffness:6.5,animationTime:1.2,gestureSettingsMouse:{scrollToZoom:!0,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsTouch:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsPen:{scrollToZoom:!1,clickToZoom:!0,dblClickToZoom:!1,pinchToZoom:!1,zoomToRefPoint:!0,flickEnabled:!1,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},gestureSettingsUnknown:{scrollToZoom:!1,clickToZoom:!1,dblClickToZoom:!0,pinchToZoom:!0,zoomToRefPoint:!0,flickEnabled:!0,flickMinSpeed:120,flickMomentum:.25,pinchRotate:!1},zoomPerClick:2,zoomPerScroll:1.2,zoomPerSecond:1,blendTime:0,alwaysBlend:!1,autoHideControls:!0,immediateRender:!1,minZoomImageRatio:.9,maxZoomPixelRatio:1.1,smoothTileEdgesMinZoom:1.1,iOSDevice:isIOSDevice(),pixelsPerWheelLine:40,pixelsPerArrowPress:40,autoResize:!0,preserveImageSizeOnResize:!1,minScrollDeltaTime:50,showSequenceControl:!0,sequenceControlAnchor:null,preserveViewport:!1,preserveOverlays:!1,navPrevNextWrap:!1,showNavigationControl:!0,navigationControlAnchor:null,showZoomControl:!0,showHomeControl:!0,showFullPageControl:!0,showRotationControl:!1,showFlipControl:!1,controlsFadeDelay:2e3,controlsFadeLength:1500,mouseNavEnabled:!0,showNavigator:!1,navigatorId:null,navigatorPosition:null,navigatorSizeRatio:.2,navigatorMaintainSizeRatio:!1,navigatorTop:null,navigatorLeft:null,navigatorHeight:null,navigatorWidth:null,navigatorAutoResize:!0,navigatorAutoFade:!0,navigatorRotate:!0,navigatorBackground:"#000",navigatorOpacity:.8,navigatorBorderColor:"#555",navigatorDisplayRegionColor:"#900",degrees:0,flipped:!1,opacity:1,preload:!1,compositeOperation:null,placeholderFillStyle:null,showReferenceStrip:!1,referenceStripScroll:"horizontal",referenceStripElement:null,referenceStripHeight:null,referenceStripWidth:null,referenceStripPosition:"BOTTOM_LEFT",referenceStripSizeRatio:.2,collectionRows:3,collectionColumns:0,collectionLayout:"horizontal",collectionMode:!1,collectionTileSize:800,collectionTileMargin:80,imageLoaderLimit:0,maxImageCacheCount:200,timeout:3e4,useCanvas:!0,prefixUrl:"/images/",navImages:{zoomIn:{REST:"zoomin_rest.png",GROUP:"zoomin_grouphover.png",HOVER:"zoomin_hover.png",DOWN:"zoomin_pressed.png"},zoomOut:{REST:"zoomout_rest.png",GROUP:"zoomout_grouphover.png",HOVER:"zoomout_hover.png",DOWN:"zoomout_pressed.png"},home:{REST:"home_rest.png",GROUP:"home_grouphover.png",HOVER:"home_hover.png",DOWN:"home_pressed.png"},fullpage:{REST:"fullpage_rest.png",GROUP:"fullpage_grouphover.png",HOVER:"fullpage_hover.png",DOWN:"fullpage_pressed.png"},rotateleft:{REST:"rotateleft_rest.png",GROUP:"rotateleft_grouphover.png",HOVER:"rotateleft_hover.png",DOWN:"rotateleft_pressed.png"},rotateright:{REST:"rotateright_rest.png",GROUP:"rotateright_grouphover.png",HOVER:"rotateright_hover.png",DOWN:"rotateright_pressed.png"},flip:{REST:"flip_rest.png",GROUP:"flip_grouphover.png",HOVER:"flip_hover.png",DOWN:"flip_pressed.png"},previous:{REST:"previous_rest.png",GROUP:"previous_grouphover.png",HOVER:"previous_hover.png",DOWN:"previous_pressed.png"},next:{REST:"next_rest.png",GROUP:"next_grouphover.png",HOVER:"next_hover.png",DOWN:"next_pressed.png"}},debugMode:!1,debugGridColor:["#437AB2","#1B9E77","#D95F02","#7570B3","#E7298A","#66A61E","#E6AB02","#A6761D","#666666"]},SIGNAL:"----seadragon----",delegate:function(G,q){return function(){var Z=arguments;return void 0===Z&&(Z=[]),q.apply(G,Z)}},BROWSERS:{UNKNOWN:0,IE:1,FIREFOX:2,SAFARI:3,CHROME:4,OPERA:5},getElement:function(G){return"string"==typeof G&&(G=document.getElementById(G)),G},getElementPosition:function(G){var q,Z,X=new $.Point;for(Z=getOffsetParent(G=$.getElement(G),q="fixed"==$.getElementStyle(G).position);Z;)X.x+=G.offsetLeft,X.y+=G.offsetTop,q&&(X=X.plus($.getPageScroll())),Z=getOffsetParent(G=Z,q="fixed"==$.getElementStyle(G).position);return X},getElementOffset:function(G){var q,Z,X=(G=$.getElement(G))&&G.ownerDocument,K={top:0,left:0};return X?(q=X.documentElement,void 0!==G.getBoundingClientRect&&(K=G.getBoundingClientRect()),Z=X==X.window?X:9===X.nodeType&&(X.defaultView||X.parentWindow),new $.Point(K.left+(Z.pageXOffset||q.scrollLeft)-(q.clientLeft||0),K.top+(Z.pageYOffset||q.scrollTop)-(q.clientTop||0))):new $.Point},getElementSize:function(G){return G=$.getElement(G),new $.Point(G.clientWidth,G.clientHeight)},getElementStyle:document.documentElement.currentStyle?function(G){return(G=$.getElement(G)).currentStyle}:function(G){return G=$.getElement(G),window.getComputedStyle(G,"")},getCssPropertyWithVendorPrefix:function(G){var q={};return $.getCssPropertyWithVendorPrefix=function(G){if(void 0!==q[G])return q[G];var Z=document.createElement("div").style,X=null;if(void 0!==Z[G])X=G;else for(var K=["Webkit","Moz","MS","O","webkit","moz","ms","o"],Y=$.capitalizeFirstLetter(G),Q=0;Q<K.length;Q++){var J=K[Q]+Y;if(void 0!==Z[J]){X=J;break}}return q[G]=X,X},$.getCssPropertyWithVendorPrefix(G)},capitalizeFirstLetter:function(G){return G.charAt(0).toUpperCase()+G.slice(1)},positiveModulo:function(G,q){var Z=G%q;return Z<0&&(Z+=q),Z},pointInElement:function(G,q){G=$.getElement(G);var Z=$.getElementOffset(G),X=$.getElementSize(G);return q.x>=Z.x&&q.x<Z.x+X.x&&q.y<Z.y+X.y&&q.y>=Z.y},getEvent:function(G){return $.getEvent=G?function(G){return G}:function(){return window.event},$.getEvent(G)},getMousePosition:function(G){if("number"==typeof G.pageX)$.getMousePosition=function(G){var q=new $.Point;return G=$.getEvent(G),q.x=G.pageX,q.y=G.pageY,q};else{if("number"!=typeof G.clientX)throw new Error("Unknown event mouse position, no known technique.");$.getMousePosition=function(G){var q=new $.Point;return G=$.getEvent(G),q.x=G.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,q.y=G.clientY+document.body.scrollTop+document.documentElement.scrollTop,q}}return $.getMousePosition(G)},getPageScroll:function(){var G=document.documentElement||{},q=document.body||{};if("number"==typeof window.pageXOffset)$.getPageScroll=function(){return new $.Point(window.pageXOffset,window.pageYOffset)};else if(q.scrollLeft||q.scrollTop)$.getPageScroll=function(){return new $.Point(document.body.scrollLeft,document.body.scrollTop)};else{if(!G.scrollLeft&&!G.scrollTop)return new $.Point(0,0);$.getPageScroll=function(){return new $.Point(document.documentElement.scrollLeft,document.documentElement.scrollTop)}}return $.getPageScroll()},setPageScroll:function(G){if(void 0!==window.scrollTo)$.setPageScroll=function(G){window.scrollTo(G.x,G.y)};else{var q=$.getPageScroll();if(q.x===G.x&&q.y===G.y)return;document.body.scrollLeft=G.x,document.body.scrollTop=G.y;var Z=$.getPageScroll();if(Z.x!==q.x&&Z.y!==q.y)return void($.setPageScroll=function(G){document.body.scrollLeft=G.x,document.body.scrollTop=G.y});if(document.documentElement.scrollLeft=G.x,document.documentElement.scrollTop=G.y,(Z=$.getPageScroll()).x!==q.x&&Z.y!==q.y)return void($.setPageScroll=function(G){document.documentElement.scrollLeft=G.x,document.documentElement.scrollTop=G.y});$.setPageScroll=function(G){}}return $.setPageScroll(G)},getWindowSize:function(){var G=document.documentElement||{},q=document.body||{};if("number"==typeof window.innerWidth)$.getWindowSize=function(){return new $.Point(window.innerWidth,window.innerHeight)};else if(G.clientWidth||G.clientHeight)$.getWindowSize=function(){return new $.Point(document.documentElement.clientWidth,document.documentElement.clientHeight)};else{if(!q.clientWidth&&!q.clientHeight)throw new Error("Unknown window size, no known technique.");$.getWindowSize=function(){return new $.Point(document.body.clientWidth,document.body.clientHeight)}}return $.getWindowSize()},makeCenteredNode:function(G){G=$.getElement(G);var q=[$.makeNeutralElement("div"),$.makeNeutralElement("div"),$.makeNeutralElement("div")];return $.extend(q[0].style,{display:"table",height:"100%",width:"100%"}),$.extend(q[1].style,{display:"table-row"}),$.extend(q[2].style,{display:"table-cell",verticalAlign:"middle",textAlign:"center"}),q[0].appendChild(q[1]),q[1].appendChild(q[2]),q[2].appendChild(G),q[0]},makeNeutralElement:function(G){var q=document.createElement(G),Z=q.style;return Z.background="transparent none",Z.border="none",Z.margin="0px",Z.padding="0px",Z.position="static",q},now:function(){return Date.now?$.now=Date.now:$.now=function(){return(new Date).getTime()},$.now()},makeTransparentImage:function(G){return $.makeTransparentImage=function(G){var q=$.makeNeutralElement("img");return q.src=G,q},$.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<7&&($.makeTransparentImage=function(G){var q=$.makeNeutralElement("img"),Z=null;return(Z=$.makeNeutralElement("span")).style.display="inline-block",q.onload=function(){Z.style.width=Z.style.width||q.width+"px",Z.style.height=Z.style.height||q.height+"px",q.onload=null,q=null},q.src=G,Z.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+G+"', sizingMethod='scale')",Z}),$.makeTransparentImage(G)},setElementOpacity:function(G,q,Z){var X;G=$.getElement(G),Z&&!$.Browser.alpha&&(q=Math.round(q)),$.Browser.opacity?G.style.opacity=q<1?q:"":q<1?(X="alpha(opacity="+Math.round(100*q)+")",G.style.filter=X):G.style.filter=""},setElementTouchActionNone:function(G){void 0!==(G=$.getElement(G)).style.touchAction?G.style.touchAction="none":void 0!==G.style.msTouchAction&&(G.style.msTouchAction="none")},addClass:function(G,q){(G=$.getElement(G)).className?-1===(" "+G.className+" ").indexOf(" "+q+" ")&&(G.className+=" "+q):G.className=q},indexOf:function(G,q,Z){return Array.prototype.indexOf?this.indexOf=function(G,q,Z){return G.indexOf(q,Z)}:this.indexOf=function(G,q,Z){var X,K,Y=Z||0;if(!G)throw new TypeError;if(0===(K=G.length)||Y>=K)return-1;for(Y<0&&(Y=K-Math.abs(Y)),X=Y;X<K;X++)if(G[X]===q)return X;return-1},this.indexOf(G,q,Z)},removeClass:function(G,q){var Z,X,K=[];for(Z=(G=$.getElement(G)).className.split(/\s+/),X=0;X<Z.length;X++)Z[X]&&Z[X]!==q&&K.push(Z[X]);G.className=K.join(" ")},addEvent:function(){if(window.addEventListener)return function(G,q,Z,X){(G=$.getElement(G)).addEventListener(q,Z,X)};if(window.attachEvent)return function(G,q,Z,X){(G=$.getElement(G)).attachEvent("on"+q,Z)};throw new Error("No known event model.")}(),removeEvent:function(){if(window.removeEventListener)return function(G,q,Z,X){(G=$.getElement(G)).removeEventListener(q,Z,X)};if(window.detachEvent)return function(G,q,Z,X){(G=$.getElement(G)).detachEvent("on"+q,Z)};throw new Error("No known event model.")}(),cancelEvent:function(G){(G=$.getEvent(G)).preventDefault?$.cancelEvent=function(G){G.preventDefault()}:$.cancelEvent=function(G){(G=$.getEvent(G)).cancel=!0,G.returnValue=!1},$.cancelEvent(G)},stopEvent:function(G){(G=$.getEvent(G)).stopPropagation?$.stopEvent=function(G){G.stopPropagation()}:$.stopEvent=function(G){(G=$.getEvent(G)).cancelBubble=!0},$.stopEvent(G)},createCallback:function(G,q){var Z,X=[];for(Z=2;Z<arguments.length;Z++)X.push(arguments[Z]);return function(){var Z,K=X.concat([]);for(Z=0;Z<arguments.length;Z++)K.push(arguments[Z]);return q.apply(G,K)}},getUrlParameter:function(G){return URLPARAMS[G]||null},getUrlProtocol:function(G){var q=G.match(/^([a-z]+:)\/\//i);return null===q?window.location.protocol:q[1].toLowerCase()},createAjaxRequest:function(G){var q;try{q=!!new ActiveXObject("Microsoft.XMLHTTP")}catch(G){q=!1}if(q)window.XMLHttpRequest?$.createAjaxRequest=function(G){return G?new ActiveXObject("Microsoft.XMLHTTP"):new XMLHttpRequest}:$.createAjaxRequest=function(){return new ActiveXObject("Microsoft.XMLHTTP")};else{if(!window.XMLHttpRequest)throw new Error("Browser doesn't support XMLHttpRequest.");$.createAjaxRequest=function(){return new XMLHttpRequest}}return $.createAjaxRequest(G)},makeAjaxRequest:function(G,q,Z){var X,K,Y;$.isPlainObject(G)&&(q=G.success,Z=G.error,X=G.withCredentials,K=G.headers,Y=G.responseType||null,G=G.url);var Q=$.getUrlProtocol(G),J=$.createAjaxRequest("file:"===Q);if(!$.isFunction(q))throw new Error("makeAjaxRequest requires a success callback");J.onreadystatechange=function(){4==J.readyState&&(J.onreadystatechange=function(){},J.status>=200&&J.status<300||0===J.status&&"http:"!==Q&&"https:"!==Q?q(J):($.console.log("AJAX request returned %d: %s",J.status,G),$.isFunction(Z)&&Z(J)))};try{if(J.open("GET",G,!0),Y&&(J.responseType=Y),K)for(var ee in K)K.hasOwnProperty(ee)&&K[ee]&&J.setRequestHeader(ee,K[ee]);X&&(J.withCredentials=!0),J.send(null)}catch(X){var te=X.message;if($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<10&&void 0!==X.number&&-2147024891==X.number&&(te+="\nSee http://msdn.microsoft.com/en-us/library/ms537505(v=vs.85).aspx#xdomain"),$.console.log("%s while making AJAX request: %s",X.name,te),J.onreadystatechange=function(){},window.XDomainRequest){var ie=new XDomainRequest;if(ie){ie.onload=function(G){$.isFunction(q)&&q({responseText:ie.responseText,status:200,statusText:"OK"})},ie.onerror=function(G){$.isFunction(Z)&&Z({responseText:ie.responseText,status:444,statusText:"An error happened. Due to an XDomainRequest deficiency we can not extract any information about this error. Upgrade your browser."})};try{ie.open("GET",G),ie.send()}catch(G){$.isFunction(Z)&&Z(J,X)}}}else $.isFunction(Z)&&Z(J,X)}return J},jsonp:function(G){var q,Z=G.url,X=document.head||document.getElementsByTagName("head")[0]||document.documentElement,K=G.callbackName||"openseadragon"+$.now(),Y=window[K],Q="$1"+K+"$2",J=G.param||"callback",ee=G.callback;Z=Z.replace(/(\=)\?(&|$)|\?\?/i,Q),Z+=(/\?/.test(Z)?"&":"?")+J+"="+K,window[K]=function(G){if(Y)window[K]=Y;else try{delete window[K]}catch(G){}ee&&$.isFunction(ee)&&ee(G)},q=document.createElement("script"),void 0===G.async&&!1===G.async||(q.async="async"),G.scriptCharset&&(q.charset=G.scriptCharset),q.src=Z,q.onload=q.onreadystatechange=function(G,Z){(Z||!q.readyState||/loaded|complete/.test(q.readyState))&&(q.onload=q.onreadystatechange=null,X&&q.parentNode&&X.removeChild(q),q=void 0)},X.insertBefore(q,X.firstChild)},createFromDZI:function(){throw"OpenSeadragon.createFromDZI is deprecated, use Viewer.open."},parseXml:function(G){if(window.DOMParser)$.parseXml=function(G){return(new DOMParser).parseFromString(G,"text/xml")};else{if(!window.ActiveXObject)throw new Error("Browser doesn't support XML DOM.");$.parseXml=function(G){var q=null;return(q=new ActiveXObject("Microsoft.XMLDOM")).async=!1,q.loadXML(G),q}}return $.parseXml(G)},parseJSON:function(string){return window.JSON&&window.JSON.parse?$.parseJSON=window.JSON.parse:$.parseJSON=function(string){return eval("("+string+")")},$.parseJSON(string)},imageFormatSupported:function(G){return!!FILEFORMATS[(G=G||"").toLowerCase()]}}),$.Browser={vendor:$.BROWSERS.UNKNOWN,version:0,alpha:!0};var FILEFORMATS={bmp:!1,jpeg:!0,jpg:!0,png:!0,tif:!1,wdp:!1},URLPARAMS={};!function(){var G=navigator.appVersion,q=navigator.userAgent;switch(navigator.appName){case"Microsoft Internet Explorer":window.attachEvent&&window.ActiveXObject&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(q.substring(q.indexOf("MSIE")+5,q.indexOf(";",q.indexOf("MSIE")))));break;case"Netscape":window.addEventListener&&(q.indexOf("Firefox")>=0?($.Browser.vendor=$.BROWSERS.FIREFOX,$.Browser.version=parseFloat(q.substring(q.indexOf("Firefox")+8))):q.indexOf("Safari")>=0?($.Browser.vendor=q.indexOf("Chrome")>=0?$.BROWSERS.CHROME:$.BROWSERS.SAFARI,$.Browser.version=parseFloat(q.substring(q.substring(0,q.indexOf("Safari")).lastIndexOf("/")+1,q.indexOf("Safari")))):null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(q)&&($.Browser.vendor=$.BROWSERS.IE,$.Browser.version=parseFloat(RegExp.$1)));break;case"Opera":$.Browser.vendor=$.BROWSERS.OPERA,$.Browser.version=parseFloat(G)}var Z,X,K,Y=window.location.search.substring(1).split("&");for(K=0;K<Y.length;K++)(X=(Z=Y[K]).indexOf("="))>0&&(URLPARAMS[Z.substring(0,X)]=decodeURIComponent(Z.substring(X+1)));$.Browser.alpha=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9||$.Browser.vendor==$.BROWSERS.CHROME&&$.Browser.version<2),$.Browser.opacity=!($.Browser.vendor==$.BROWSERS.IE&&$.Browser.version<9)}();var nullfunction=function(G){};function getOffsetParent(G,q){return q&&G!=document.body?document.body:G.offsetParent}$.console=window.console||{log:nullfunction,debug:nullfunction,info:nullfunction,warn:nullfunction,error:nullfunction,assert:nullfunction},function(G){var q=G.requestAnimationFrame||G.mozRequestAnimationFrame||G.webkitRequestAnimationFrame||G.msRequestAnimationFrame,Z=G.cancelAnimationFrame||G.mozCancelAnimationFrame||G.webkitCancelAnimationFrame||G.msCancelAnimationFrame;if(q&&Z)$.requestAnimationFrame=function(){return q.apply(G,arguments)},$.cancelAnimationFrame=function(){return Z.apply(G,arguments)};else{var X,K=[],Y=[],Q=0;$.requestAnimationFrame=function(G){return K.push([++Q,G]),X||(X=setInterval((function(){if(K.length){var G=$.now(),q=Y;for(Y=K,K=q;Y.length;)Y.shift()[1](G)}else clearInterval(X),X=void 0}),20)),Q},$.cancelAnimationFrame=function(G){var q,Z;for(q=0,Z=K.length;q<Z;q+=1)if(K[q][0]===G)return void K.splice(q,1);for(q=0,Z=Y.length;q<Z;q+=1)if(Y[q][0]===G)return void Y.splice(q,1)}}}(window)}(OpenSeadragon),e=this,t=function(){return OpenSeadragon},"function"==typeof define&&define.amd?define([],t):"object"==typeof module&&module.exports?module.exports=t():e.OpenSeadragon=t(),function(G){var q={supportsFullScreen:!1,isFullScreen:function(){return!1},getFullScreenElement:function(){return null},requestFullScreen:function(){},exitFullScreen:function(){},cancelFullScreen:function(){},fullScreenEventName:"",fullScreenErrorEventName:""};document.exitFullscreen?(q.supportsFullScreen=!0,q.getFullScreenElement=function(){return document.fullscreenElement},q.requestFullScreen=function(G){return G.requestFullscreen()},q.exitFullScreen=function(){document.exitFullscreen()},q.fullScreenEventName="fullscreenchange",q.fullScreenErrorEventName="fullscreenerror"):document.msExitFullscreen?(q.supportsFullScreen=!0,q.getFullScreenElement=function(){return document.msFullscreenElement},q.requestFullScreen=function(G){return G.msRequestFullscreen()},q.exitFullScreen=function(){document.msExitFullscreen()},q.fullScreenEventName="MSFullscreenChange",q.fullScreenErrorEventName="MSFullscreenError"):document.webkitExitFullscreen?(q.supportsFullScreen=!0,q.getFullScreenElement=function(){return document.webkitFullscreenElement},q.requestFullScreen=function(G){return G.webkitRequestFullscreen()},q.exitFullScreen=function(){document.webkitExitFullscreen()},q.fullScreenEventName="webkitfullscreenchange",q.fullScreenErrorEventName="webkitfullscreenerror"):document.webkitCancelFullScreen?(q.supportsFullScreen=!0,q.getFullScreenElement=function(){return document.webkitCurrentFullScreenElement},q.requestFullScreen=function(G){return G.webkitRequestFullScreen()},q.exitFullScreen=function(){document.webkitCancelFullScreen()},q.fullScreenEventName="webkitfullscreenchange",q.fullScreenErrorEventName="webkitfullscreenerror"):document.mozCancelFullScreen&&(q.supportsFullScreen=!0,q.getFullScreenElement=function(){return document.mozFullScreenElement},q.requestFullScreen=function(G){return G.mozRequestFullScreen()},q.exitFullScreen=function(){document.mozCancelFullScreen()},q.fullScreenEventName="mozfullscreenchange",q.fullScreenErrorEventName="mozfullscreenerror"),q.isFullScreen=function(){return null!==q.getFullScreenElement()},q.cancelFullScreen=function(){G.console.error("cancelFullScreen is deprecated. Use exitFullScreen instead."),q.exitFullScreen()},G.extend(G,q)}(OpenSeadragon),function(G){G.EventSource=function(){this.events={}},G.EventSource.prototype={addOnceHandler:function(G,q,Z,X){var K=this;X=X||1;var Y=0,s=function(Z){++Y===X&&K.removeHandler(G,s),q(Z)};this.addHandler(G,s,Z)},addHandler:function(q,Z,X){var K=this.events[q];K||(this.events[q]=K=[]),Z&&G.isFunction(Z)&&(K[K.length]={handler:Z,userData:X||null})},removeHandler:function(q,Z){var X,K=this.events[q],Y=[];if(K&&G.isArray(K)){for(X=0;X<K.length;X++)K[X].handler!==Z&&Y.push(K[X]);this.events[q]=Y}},removeAllHandlers:function(G){if(G)this.events[G]=[];else for(var q in this.events)this.events[q]=[]},getHandler:function(G){var q=this.events[G];return q&&q.length?(q=1===q.length?[q[0]]:Array.apply(null,q),function(G,Z){var X,K=q.length;for(X=0;X<K;X++)q[X]&&(Z.eventSource=G,Z.userData=q[X].userData,q[X].handler(Z))}):null},raiseEvent:function(G,q){var Z=this.getHandler(G);Z&&(q||(q={}),Z(this,q))}}}(OpenSeadragon),function(G){var q=[],Z={};function n(q){var X,K=Z[q.hash],Y=K.activePointersLists.length;for(X=0;X<Y;X++)K.activePointersLists[X].captureCount>0&&(G.removeEvent(G.MouseTracker.captureElement,"mousemove",K.mousemovecaptured,!0),G.removeEvent(G.MouseTracker.captureElement,"mouseup",K.mouseupcaptured,!0),G.removeEvent(G.MouseTracker.captureElement,G.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",K.pointermovecaptured,!0),G.removeEvent(G.MouseTracker.captureElement,G.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",K.pointerupcaptured,!0),G.removeEvent(G.MouseTracker.captureElement,"touchmove",K.touchmovecaptured,!0),G.removeEvent(G.MouseTracker.captureElement,"touchend",K.touchendcaptured,!0),K.activePointersLists[X].captureCount=0);for(X=0;X<Y;X++)K.activePointersLists.pop()}function o(q){var X,K,Y=Z[q.hash];if(Y.tracking){for(K=0;K<G.MouseTracker.subscribeEvents.length;K++)X=G.MouseTracker.subscribeEvents[K],G.removeEvent(q.element,X,Y[X],!1);n(q),Y.tracking=!1}}function r(q,X){var K=Z[q.hash];if("pointerevent"===X)return{upName:G.MouseTracker.unprefixedPointerEvents?"pointerup":"MSPointerUp",upHandler:K.pointerupcaptured,moveName:G.MouseTracker.unprefixedPointerEvents?"pointermove":"MSPointerMove",moveHandler:K.pointermovecaptured};if("mouse"===X)return{upName:"mouseup",upHandler:K.mouseupcaptured,moveName:"mousemove",moveHandler:K.mousemovecaptured};if("touch"===X)return{upName:"touchend",upHandler:K.touchendcaptured,moveName:"touchmove",moveHandler:K.touchmovecaptured};throw new Error("MouseTracker.getCaptureEventParams: Unknown pointer type.")}function s(q,Z,K){var Y,Q=q.getActivePointersListByType(Z);Q.captureCount+=K||1,1===Q.captureCount&&(G.Browser.vendor===G.BROWSERS.IE&&G.Browser.version<9?q.element.setCapture(!0):(Y=r(q,G.MouseTracker.havePointerEvents?"pointerevent":Z),X&&A(window.top)&&G.addEvent(window.top,Y.upName,Y.upHandler,!0),G.addEvent(G.MouseTracker.captureElement,Y.upName,Y.upHandler,!0),G.addEvent(G.MouseTracker.captureElement,Y.moveName,Y.moveHandler,!0)))}function a(q,Z,K){var Y,Q=q.getActivePointersListByType(Z);Q.captureCount-=K||1,0===Q.captureCount&&(G.Browser.vendor===G.BROWSERS.IE&&G.Browser.version<9?q.element.releaseCapture():(Y=r(q,G.MouseTracker.havePointerEvents?"pointerevent":Z),X&&A(window.top)&&G.removeEvent(window.top,Y.upName,Y.upHandler,!0),G.removeEvent(G.MouseTracker.captureElement,Y.moveName,Y.moveHandler,!0),G.removeEvent(G.MouseTracker.captureElement,Y.upName,Y.upHandler,!0)))}function l(q){var Z;if(G.MouseTracker.unprefixedPointerEvents)Z=q.pointerType;else switch(q.pointerType){case 2:Z="touch";break;case 3:Z="pen";break;case 4:Z="mouse";break;default:Z=""}return Z}function h(q){return G.getMousePosition(q)}function c(G,q){return u(h(G),q)}function u(q,Z){var X=G.getElementOffset(Z);return q.minus(X)}function d(q,Z){return new G.Point((q.x+Z.x)/2,(q.y+Z.y)/2)}function p(q,Z){var X={target:(Z=G.getEvent(Z)).target||Z.srcElement,type:"wheel",shiftKey:Z.shiftKey||!1,clientX:Z.clientX,clientY:Z.clientY,pageX:Z.pageX?Z.pageX:Z.clientX,pageY:Z.pageY?Z.pageY:Z.clientY,deltaMode:"MozMousePixelScroll"==Z.type?0:1,deltaX:0,deltaZ:0};"mousewheel"==G.MouseTracker.wheelEventName?X.deltaY=-Z.wheelDelta/G.DEFAULT_SETTINGS.pixelsPerWheelLine:X.deltaY=Z.detail,g(q,X,Z)}function g(q,Z,X){var K;K=Z.deltaY<0?1:-1,q.scrollHandler&&!1===q.scrollHandler({eventSource:q,pointerType:"mouse",position:c(Z,q.element),scroll:K,shift:Z.shiftKey,isTouchEvent:!1,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X)}function m(G,q){if(G===q)return!1;for(;q&&q!==G;)q=q.parentNode;return q===G}function v(q,Z){z(q,Z,[{id:G.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(Z),currentTime:G.now()}])}function f(q,Z){M(q,Z,[{id:G.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(Z),currentTime:G.now()}])}function w(q){return G.Browser.vendor===G.BROWSERS.IE&&G.Browser.version<9?1===q?0:2===q?2:4===q?1:-1:q}function y(q,Z){L(q,Z=G.getEvent(Z),[{id:G.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(Z),currentTime:G.now()}],w(Z.button))&&a(q,"mouse")}function T(q,Z){F(q,Z=G.getEvent(Z),[{id:G.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(Z),currentTime:G.now()}])}function x(G,q,Z){var X,K=Z.getLength(),Y=[];if("touch"===Z.type||Z.contacts>0){for(X=0;X<K;X++)Y.push(Z.getByIndex(X));Y.length>0&&(L(G,q,Y,0),Z.captureCount=1,a(G,Z.type),M(G,q,Y))}}function S(Z,X){var K,Y,Q,J,ee=X.changedTouches.length,te=[];for(K=G.now(),Y=0;Y<ee;Y++)te.push({id:X.changedTouches[Y].identifier,type:"touch",currentPos:h(X.changedTouches[Y]),currentTime:K});for(L(Z,X,te,0)&&a(Z,"touch",ee),M(Z,X,te),Y=0;Y<q.length;Y++)if(q[Y]!==Z&&q[Y].isTracking()&&m(q[Y].element,Z.element)){for(J=[],Q=0;Q<ee;Q++)J.push({id:X.changedTouches[Q].identifier,type:"touch",currentPos:h(X.changedTouches[Q]),currentTime:K});M(q[Y],X,J)}G.cancelEvent(X)}function E(q,Z){var X,K=Z.changedTouches.length,Y=[];for(X=0;X<K;X++)Y.push({id:Z.changedTouches[X].identifier,type:"touch",currentPos:h(Z.changedTouches[X]),currentTime:G.now()});F(q,Z,Y),G.cancelEvent(Z)}function P(q,Z){Z.currentTarget===Z.relatedTarget||m(Z.currentTarget,Z.relatedTarget)||z(q,Z,[{id:Z.pointerId,type:l(Z),isPrimary:Z.isPrimary,currentPos:h(Z),currentTime:G.now()}])}function R(q,Z){Z.currentTarget===Z.relatedTarget||m(Z.currentTarget,Z.relatedTarget)||M(q,Z,[{id:Z.pointerId,type:l(Z),isPrimary:Z.isPrimary,currentPos:h(Z),currentTime:G.now()}])}function _(q,Z){var X;H(q,Z,[X={id:Z.pointerId,type:l(Z),isPrimary:Z.isPrimary,currentPos:h(Z),currentTime:G.now()}],Z.button)&&(G.stopEvent(Z),s(q,X.type)),(q.clickHandler||q.dblClickHandler||q.pressHandler||q.dragHandler||q.dragEndHandler||q.pinchHandler)&&G.cancelEvent(Z)}function C(G,q){b(G,q)}function b(q,Z){var X;L(q,Z,[X={id:Z.pointerId,type:l(Z),isPrimary:Z.isPrimary,currentPos:h(Z),currentTime:G.now()}],Z.button)&&a(q,X.type)}function O(G,q){I(G,q)}function I(q,Z){F(q,Z,[{id:Z.pointerId,type:l(Z),isPrimary:Z.isPrimary,currentPos:h(Z),currentTime:G.now()}])}function k(G,q){!function(G,q,Z){L(G,q,Z,0),M(G,q,Z)}(G,q,[{id:q.pointerId,type:l(q)}])}function B(G,q){return q.hasOwnProperty("isPrimary")||(0===G.getLength()?q.isPrimary=!0:q.isPrimary=!1),q.speed=0,q.direction=0,q.contactPos=q.currentPos,q.contactTime=q.currentTime,q.lastPos=q.currentPos,q.lastTime=q.currentTime,G.add(q)}function D(G,q){var Z,X;return G.getById(q.id)?(Z=G.removeById(q.id),q.hasOwnProperty("isPrimary")||(X=G.getPrimary())||(X=G.getByIndex(0))&&(X.isPrimary=!0)):Z=G.getLength(),Z}function z(q,Z,X){var K,Y,Q,J=q.getActivePointersListByType(X[0].type),ee=X.length;for(K=0;K<ee;K++)Y=X[K],(Q=J.getById(Y.id))?(Q.insideElement=!0,Q.lastPos=Q.currentPos,Q.lastTime=Q.currentTime,Q.currentPos=Y.currentPos,Q.currentTime=Y.currentTime,Y=Q):(Y.captured=!1,Y.insideElementPressed=!1,Y.insideElement=!0,B(J,Y)),q.enterHandler&&!1===q.enterHandler({eventSource:q,pointerType:Y.type,position:u(Y.currentPos,q.element),buttons:J.buttons,pointers:q.getActivePointerCount(),insideElementPressed:Y.insideElementPressed,buttonDownAny:0!==J.buttons,isTouchEvent:"touch"===Y.type,originalEvent:Z,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(Z)}function M(q,Z,X){var K,Y,Q,J=q.getActivePointersListByType(X[0].type),ee=X.length;for(K=0;K<ee;K++)Y=X[K],(Q=J.getById(Y.id))&&(Q.captured?(Q.insideElement=!1,Q.lastPos=Q.currentPos,Q.lastTime=Q.currentTime,Q.currentPos=Y.currentPos,Q.currentTime=Y.currentTime):D(J,Q),Y=Q),q.exitHandler&&!1===q.exitHandler({eventSource:q,pointerType:Y.type,position:u(Y.currentPos,q.element),buttons:J.buttons,pointers:q.getActivePointerCount(),insideElementPressed:!!Q&&Q.insideElementPressed,buttonDownAny:0!==J.buttons,isTouchEvent:"touch"===Y.type,originalEvent:Z,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(Z)}function H(q,X,K,Y){var Q,J,ee,te=Z[q.hash],ie=q.getActivePointersListByType(K[0].type),ne=K.length;void 0!==X.buttons?ie.buttons=X.buttons:G.Browser.vendor===G.BROWSERS.IE&&G.Browser.version<9?0===Y?ie.buttons+=1:1===Y?ie.buttons+=4:2===Y?ie.buttons+=2:3===Y?ie.buttons+=8:4===Y?ie.buttons+=16:5===Y&&(ie.buttons+=32):0===Y?ie.buttons|=1:1===Y?ie.buttons|=4:2===Y?ie.buttons|=2:3===Y?ie.buttons|=8:4===Y?ie.buttons|=16:5===Y&&(ie.buttons|=32);var oe=q.getActivePointersListsExceptType(K[0].type);for(Q=0;Q<oe.length;Q++)x(q,X,oe[Q]);if(0!==Y)return q.nonPrimaryPressHandler&&!1===q.nonPrimaryPressHandler({eventSource:q,pointerType:K[0].type,position:u(K[0].currentPos,q.element),button:Y,buttons:ie.buttons,isTouchEvent:"touch"===K[0].type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X),!1;for(Q=0;Q<ne;Q++)J=K[Q],(ee=ie.getById(J.id))?(ee.captured=!0,ee.insideElementPressed=!0,ee.insideElement=!0,ee.contactPos=J.currentPos,ee.contactTime=J.currentTime,ee.lastPos=ee.currentPos,ee.lastTime=ee.currentTime,ee.currentPos=J.currentPos,ee.currentTime=J.currentTime,J=ee):(J.captured=!0,J.insideElementPressed=!0,J.insideElement=!0,B(ie,J)),ie.addContact(),(q.dragHandler||q.dragEndHandler||q.pinchHandler)&&G.MouseTracker.gesturePointVelocityTracker.addPoint(q,J),1===ie.contacts?q.pressHandler&&!1===q.pressHandler({eventSource:q,pointerType:J.type,position:u(J.contactPos,q.element),buttons:ie.buttons,isTouchEvent:"touch"===J.type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X):2===ie.contacts&&q.pinchHandler&&"touch"===J.type&&(te.pinchGPoints=ie.asArray(),te.lastPinchDist=te.currentPinchDist=te.pinchGPoints[0].currentPos.distanceTo(te.pinchGPoints[1].currentPos),te.lastPinchCenter=te.currentPinchCenter=d(te.pinchGPoints[0].currentPos,te.pinchGPoints[1].currentPos));return!0}function L(q,X,K,Y){var Q,J,ee,te,ie,ne,oe=Z[q.hash],re=q.getActivePointersListByType(K[0].type),se=K.length,ae=!1,le=!1;if(void 0!==X.buttons?re.buttons=X.buttons:G.Browser.vendor===G.BROWSERS.IE&&G.Browser.version<9?0===Y?re.buttons-=1:1===Y?re.buttons-=4:2===Y?re.buttons-=2:3===Y?re.buttons-=8:4===Y?re.buttons-=16:5===Y&&(re.buttons-=32):0===Y?re.buttons^=-2:1===Y?re.buttons^=-5:2===Y?re.buttons^=-3:3===Y?re.buttons^=-9:4===Y?re.buttons^=-17:5===Y&&(re.buttons^=-33),0!==Y)return q.nonPrimaryReleaseHandler&&!1===q.nonPrimaryReleaseHandler({eventSource:q,pointerType:K[0].type,position:u(K[0].currentPos,q.element),button:Y,buttons:re.buttons,isTouchEvent:"touch"===K[0].type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X),x(q,X,q.getActivePointersListByType("mouse")),!1;for(ee=0;ee<se;ee++)te=K[ee],(ie=re.getById(te.id))&&(ie.captured&&(ie.captured=!1,ae=!0,le=!0),ie.lastPos=ie.currentPos,ie.lastTime=ie.currentTime,ie.currentPos=te.currentPos,ie.currentTime=te.currentTime,ie.insideElement||D(re,ie),Q=ie.currentPos,J=ie.currentTime,le?(re.removeContact(),(q.dragHandler||q.dragEndHandler||q.pinchHandler)&&G.MouseTracker.gesturePointVelocityTracker.removePoint(q,ie),0===re.contacts?(q.releaseHandler&&!1===q.releaseHandler({eventSource:q,pointerType:ie.type,position:u(Q,q.element),buttons:re.buttons,insideElementPressed:ie.insideElementPressed,insideElementReleased:ie.insideElement,isTouchEvent:"touch"===ie.type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X),q.dragEndHandler&&!ie.currentPos.equals(ie.contactPos)&&!1===q.dragEndHandler({eventSource:q,pointerType:ie.type,position:u(ie.currentPos,q.element),speed:ie.speed,direction:ie.direction,shift:X.shiftKey,isTouchEvent:"touch"===ie.type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X),(q.clickHandler||q.dblClickHandler)&&ie.insideElement&&(ne=J-ie.contactTime<=q.clickTimeThreshold&&ie.contactPos.distanceTo(Q)<=q.clickDistThreshold,q.clickHandler&&!1===q.clickHandler({eventSource:q,pointerType:ie.type,position:u(ie.currentPos,q.element),quick:ne,shift:X.shiftKey,isTouchEvent:"touch"===ie.type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X),q.dblClickHandler&&ne&&(re.clicks++,1===re.clicks?(oe.lastClickPos=Q,oe.dblClickTimeOut=setTimeout((function(){re.clicks=0}),q.dblClickTimeThreshold)):2===re.clicks&&(clearTimeout(oe.dblClickTimeOut),re.clicks=0,oe.lastClickPos.distanceTo(Q)<=q.dblClickDistThreshold&&!1===q.dblClickHandler({eventSource:q,pointerType:ie.type,position:u(ie.currentPos,q.element),shift:X.shiftKey,isTouchEvent:"touch"===ie.type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X),oe.lastClickPos=null)))):2===re.contacts&&q.pinchHandler&&"touch"===ie.type&&(oe.pinchGPoints=re.asArray(),oe.lastPinchDist=oe.currentPinchDist=oe.pinchGPoints[0].currentPos.distanceTo(oe.pinchGPoints[1].currentPos),oe.lastPinchCenter=oe.currentPinchCenter=d(oe.pinchGPoints[0].currentPos,oe.pinchGPoints[1].currentPos))):q.releaseHandler&&!1===q.releaseHandler({eventSource:q,pointerType:ie.type,position:u(Q,q.element),buttons:re.buttons,insideElementPressed:ie.insideElementPressed,insideElementReleased:ie.insideElement,isTouchEvent:"touch"===ie.type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X));return ae}function F(q,X,K){var Y,Q,J,ee,te,ie=Z[q.hash],ne=q.getActivePointersListByType(K[0].type),oe=K.length;for(void 0!==X.buttons&&(ne.buttons=X.buttons),Y=0;Y<oe;Y++)Q=K[Y],(J=ne.getById(Q.id))?(Q.hasOwnProperty("isPrimary")&&(J.isPrimary=Q.isPrimary),J.lastPos=J.currentPos,J.lastTime=J.currentTime,J.currentPos=Q.currentPos,J.currentTime=Q.currentTime):(Q.captured=!1,Q.insideElementPressed=!1,Q.insideElement=!0,B(ne,Q));q.stopHandler&&"mouse"===K[0].type&&(clearTimeout(q.stopTimeOut),q.stopTimeOut=setTimeout((function(){var G,Z,Y;G=q,Z=X,Y=K[0].type,G.stopHandler&&G.stopHandler({eventSource:G,pointerType:Y,position:c(Z,G.element),buttons:G.getActivePointersListByType(Y).buttons,isTouchEvent:"touch"===Y,originalEvent:Z,preventDefaultAction:!1,userData:G.userData})}),q.stopDelay)),0===ne.contacts?q.moveHandler&&!1===q.moveHandler({eventSource:q,pointerType:K[0].type,position:u(K[0].currentPos,q.element),buttons:ne.buttons,isTouchEvent:"touch"===K[0].type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X):1===ne.contacts?(q.moveHandler&&(J=ne.asArray()[0],!1===q.moveHandler({eventSource:q,pointerType:J.type,position:u(J.currentPos,q.element),buttons:ne.buttons,isTouchEvent:"touch"===J.type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X)),q.dragHandler&&(te=(J=ne.asArray()[0]).currentPos.minus(J.lastPos),!1===q.dragHandler({eventSource:q,pointerType:J.type,position:u(J.currentPos,q.element),buttons:ne.buttons,delta:te,speed:J.speed,direction:J.direction,shift:X.shiftKey,isTouchEvent:"touch"===J.type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X))):2===ne.contacts&&(q.moveHandler&&(ee=ne.asArray(),!1===q.moveHandler({eventSource:q,pointerType:ee[0].type,position:u(d(ee[0].currentPos,ee[1].currentPos),q.element),buttons:ne.buttons,isTouchEvent:"touch"===ee[0].type,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X)),q.pinchHandler&&"touch"===K[0].type&&(te=ie.pinchGPoints[0].currentPos.distanceTo(ie.pinchGPoints[1].currentPos))!=ie.currentPinchDist&&(ie.lastPinchDist=ie.currentPinchDist,ie.currentPinchDist=te,ie.lastPinchCenter=ie.currentPinchCenter,ie.currentPinchCenter=d(ie.pinchGPoints[0].currentPos,ie.pinchGPoints[1].currentPos),!1===q.pinchHandler({eventSource:q,pointerType:"touch",gesturePoints:ie.pinchGPoints,lastCenter:u(ie.lastPinchCenter,q.element),center:u(ie.currentPinchCenter,q.element),lastDistance:ie.lastPinchDist,distance:ie.currentPinchDist,shift:X.shiftKey,originalEvent:X,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(X)))}G.MouseTracker=function(X){q.push(this);var K=arguments;G.isPlainObject(X)||(X={element:K[0],clickTimeThreshold:K[1],clickDistThreshold:K[2]}),this.hash=Math.random(),this.element=G.getElement(X.element),this.clickTimeThreshold=X.clickTimeThreshold||G.DEFAULT_SETTINGS.clickTimeThreshold,this.clickDistThreshold=X.clickDistThreshold||G.DEFAULT_SETTINGS.clickDistThreshold,this.dblClickTimeThreshold=X.dblClickTimeThreshold||G.DEFAULT_SETTINGS.dblClickTimeThreshold,this.dblClickDistThreshold=X.dblClickDistThreshold||G.DEFAULT_SETTINGS.dblClickDistThreshold,this.userData=X.userData||null,this.stopDelay=X.stopDelay||50,this.enterHandler=X.enterHandler||null,this.exitHandler=X.exitHandler||null,this.pressHandler=X.pressHandler||null,this.nonPrimaryPressHandler=X.nonPrimaryPressHandler||null,this.releaseHandler=X.releaseHandler||null,this.nonPrimaryReleaseHandler=X.nonPrimaryReleaseHandler||null,this.moveHandler=X.moveHandler||null,this.scrollHandler=X.scrollHandler||null,this.clickHandler=X.clickHandler||null,this.dblClickHandler=X.dblClickHandler||null,this.dragHandler=X.dragHandler||null,this.dragEndHandler=X.dragEndHandler||null,this.pinchHandler=X.pinchHandler||null,this.stopHandler=X.stopHandler||null,this.keyDownHandler=X.keyDownHandler||null,this.keyUpHandler=X.keyUpHandler||null,this.keyHandler=X.keyHandler||null,this.focusHandler=X.focusHandler||null,this.blurHandler=X.blurHandler||null;var Y=this;Z[this.hash]={click:function(q){var Z;Z=q,Y.clickHandler&&G.cancelEvent(Z)},dblclick:function(q){var Z;Z=q,Y.dblClickHandler&&G.cancelEvent(Z)},keydown:function(q){!function(q,Z){q.keyDownHandler&&(Z=G.getEvent(Z),q.keyDownHandler({eventSource:q,keyCode:Z.keyCode?Z.keyCode:Z.charCode,ctrl:Z.ctrlKey,shift:Z.shiftKey,alt:Z.altKey,meta:Z.metaKey,originalEvent:Z,preventDefaultAction:!1,userData:q.userData})||G.cancelEvent(Z))}(Y,q)},keyup:function(q){!function(q,Z){q.keyUpHandler&&(Z=G.getEvent(Z),q.keyUpHandler({eventSource:q,keyCode:Z.keyCode?Z.keyCode:Z.charCode,ctrl:Z.ctrlKey,shift:Z.shiftKey,alt:Z.altKey,meta:Z.metaKey,originalEvent:Z,preventDefaultAction:!1,userData:q.userData})||G.cancelEvent(Z))}(Y,q)},keypress:function(q){!function(q,Z){q.keyHandler&&(Z=G.getEvent(Z),q.keyHandler({eventSource:q,keyCode:Z.keyCode?Z.keyCode:Z.charCode,ctrl:Z.ctrlKey,shift:Z.shiftKey,alt:Z.altKey,meta:Z.metaKey,originalEvent:Z,preventDefaultAction:!1,userData:q.userData})||G.cancelEvent(Z))}(Y,q)},focus:function(q){!function(q,Z){q.focusHandler&&(Z=G.getEvent(Z),!1===q.focusHandler({eventSource:q,originalEvent:Z,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(Z))}(Y,q)},blur:function(q){!function(q,Z){q.blurHandler&&(Z=G.getEvent(Z),!1===q.blurHandler({eventSource:q,originalEvent:Z,preventDefaultAction:!1,userData:q.userData})&&G.cancelEvent(Z))}(Y,q)},wheel:function(G){var q;g(Y,q=G,q)},mousewheel:function(G){p(Y,G)},DOMMouseScroll:function(G){p(Y,G)},MozMousePixelScroll:function(G){p(Y,G)},mouseenter:function(q){!function(q,Z){v(q,Z=G.getEvent(Z))}(Y,q)},mouseleave:function(q){!function(q,Z){f(q,Z=G.getEvent(Z))}(Y,q)},mouseover:function(q){!function(q,Z){(Z=G.getEvent(Z)).currentTarget===Z.relatedTarget||m(Z.currentTarget,Z.relatedTarget)||v(q,Z)}(Y,q)},mouseout:function(q){!function(q,Z){(Z=G.getEvent(Z)).currentTarget===Z.relatedTarget||m(Z.currentTarget,Z.relatedTarget)||f(q,Z)}(Y,q)},mousedown:function(q){!function(q,Z){H(q,Z=G.getEvent(Z),[{id:G.MouseTracker.mousePointerId,type:"mouse",isPrimary:!0,currentPos:h(Z),currentTime:G.now()}],w(Z.button))&&(G.stopEvent(Z),s(q,"mouse")),(q.clickHandler||q.dblClickHandler||q.pressHandler||q.dragHandler||q.dragEndHandler)&&G.cancelEvent(Z)}(Y,q)},mouseup:function(G){y(Y,G)},mouseupcaptured:function(q){!function(q,Z){y(q,Z),G.stopEvent(Z)}(Y,q)},mousemove:function(G){T(Y,G)},mousemovecaptured:function(q){!function(q,Z){T(q,Z),G.stopEvent(Z)}(Y,q)},touchstart:function(Z){!function(Z,X){var K,Y,Q,J,ee=X.changedTouches.length,te=[],ie=Z.getActivePointersListByType("touch");for(K=G.now(),ie.getLength()>X.touches.length-ee&&(G.console.warn("Tracked touch contact count doesn't match event.touches.length. Removing all tracked touch pointers."),x(Z,X,ie)),Y=0;Y<ee;Y++)te.push({id:X.changedTouches[Y].identifier,type:"touch",currentPos:h(X.changedTouches[Y]),currentTime:K});for(z(Z,X,te),Y=0;Y<q.length;Y++)if(q[Y]!==Z&&q[Y].isTracking()&&m(q[Y].element,Z.element)){for(J=[],Q=0;Q<ee;Q++)J.push({id:X.changedTouches[Q].identifier,type:"touch",currentPos:h(X.changedTouches[Q]),currentTime:K});z(q[Y],X,J)}H(Z,X,te,0)&&(G.stopEvent(X),s(Z,"touch",ee)),G.cancelEvent(X)}(Y,Z)},touchend:function(G){S(Y,G)},touchendcaptured:function(q){!function(q,Z){S(q,Z),G.stopEvent(Z)}(Y,q)},touchmove:function(G){E(Y,G)},touchmovecaptured:function(q){!function(q,Z){E(q,Z),G.stopEvent(Z)}(Y,q)},touchcancel:function(G){!function(G,q){var Z=G.getActivePointersListByType("touch");x(G,q,Z)}(Y,G)},gesturestart:function(G){!function(G,q){q.stopPropagation(),q.preventDefault()}(0,G)},gesturechange:function(G){!function(G,q){q.stopPropagation(),q.preventDefault()}(0,G)},pointerover:function(G){P(Y,G)},MSPointerOver:function(G){P(Y,G)},pointerout:function(G){R(Y,G)},MSPointerOut:function(G){R(Y,G)},pointerdown:function(G){_(Y,G)},MSPointerDown:function(G){_(Y,G)},pointerup:function(G){C(Y,G)},MSPointerUp:function(G){C(Y,G)},pointermove:function(G){O(Y,G)},MSPointerMove:function(G){O(Y,G)},pointercancel:function(G){k(Y,G)},MSPointerCancel:function(G){k(Y,G)},pointerupcaptured:function(q){!function(q,Z){q.getActivePointersListByType(l(Z)).getById(Z.pointerId)&&b(q,Z),G.stopEvent(Z)}(Y,q)},pointermovecaptured:function(q){!function(q,Z){q.getActivePointersListByType(l(Z)).getById(Z.pointerId)&&I(q,Z),G.stopEvent(Z)}(Y,q)},tracking:!1,activePointersLists:[],lastClickPos:null,dblClickTimeOut:null,pinchGPoints:[],lastPinchDist:0,currentPinchDist:0,lastPinchCenter:null,currentPinchCenter:null},X.startDisabled||this.setTracking(!0)},G.MouseTracker.prototype={destroy:function(){var G;for(o(this),this.element=null,G=0;G<q.length;G++)if(q[G]===this){q.splice(G,1);break}Z[this.hash]=null,delete Z[this.hash]},isTracking:function(){return Z[this.hash].tracking},setTracking:function(q){return q?function(q){var X,K,Y=Z[q.hash];if(!Y.tracking){for(K=0;K<G.MouseTracker.subscribeEvents.length;K++)X=G.MouseTracker.subscribeEvents[K],G.addEvent(q.element,X,Y[X],!1);n(q),Y.tracking=!0}}(this):o(this),this},getActivePointersListsExceptType:function(G){for(var q=Z[this.hash],X=[],K=0;K<q.activePointersLists.length;++K)q.activePointersLists[K].type!==G&&X.push(q.activePointersLists[K]);return X},getActivePointersListByType:function(q){var X,K,Y=Z[this.hash],Q=Y.activePointersLists.length;for(X=0;X<Q;X++)if(Y.activePointersLists[X].type===q)return Y.activePointersLists[X];return K=new G.MouseTracker.GesturePointList(q),Y.activePointersLists.push(K),K},getActivePointerCount:function(){var G,q=Z[this.hash],X=q.activePointersLists.length,K=0;for(G=0;G<X;G++)K+=q.activePointersLists[G].getLength();return K},enterHandler:function(){},exitHandler:function(){},pressHandler:function(){},nonPrimaryPressHandler:function(){},releaseHandler:function(){},nonPrimaryReleaseHandler:function(){},moveHandler:function(){},scrollHandler:function(){},clickHandler:function(){},dblClickHandler:function(){},dragHandler:function(){},dragEndHandler:function(){},pinchHandler:function(){},stopHandler:function(){},keyDownHandler:function(){},keyUpHandler:function(){},keyHandler:function(){},focusHandler:function(){},blurHandler:function(){}},G.MouseTracker.resetAllMouseTrackers=function(){for(var G=0;G<q.length;G++)q[G].isTracking()&&(q[G].setTracking(!1),q[G].setTracking(!0))},G.MouseTracker.gesturePointVelocityTracker=function(){var q=[],Z=0,X=0,o=function(G,q){return G.hash.toString()+q.type+q.id.toString()},r=function(){var Z,K,Y,Q,J,ee,te=q.length,ie=G.now();for(Q=ie-X,X=ie,Z=0;Z<te;Z++)(Y=(K=q[Z]).gPoint).direction=Math.atan2(Y.currentPos.y-K.lastPos.y,Y.currentPos.x-K.lastPos.x),J=K.lastPos.distanceTo(Y.currentPos),K.lastPos=Y.currentPos,ee=1e3*J/(Q+1),Y.speed=.75*ee+.25*Y.speed};return{addPoint:function(K,Y){var Q=o(K,Y);q.push({guid:Q,gPoint:Y,lastPos:Y.currentPos}),1===q.length&&(X=G.now(),Z=window.setInterval(r,50))},removePoint:function(G,X){var K,Y=o(G,X),Q=q.length;for(K=0;K<Q;K++)if(q[K].guid===Y){q.splice(K,1),0==--Q&&window.clearInterval(Z);break}}}}(),G.MouseTracker.captureElement=document,G.MouseTracker.wheelEventName=G.Browser.vendor==G.BROWSERS.IE&&G.Browser.version>8||"onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll",G.MouseTracker.supportsMouseCapture=function(){var q=document.createElement("div");return G.isFunction(q.setCapture)&&G.isFunction(q.releaseCapture)}(),G.MouseTracker.subscribeEvents=["click","dblclick","keydown","keyup","keypress","focus","blur",G.MouseTracker.wheelEventName],"DOMMouseScroll"==G.MouseTracker.wheelEventName&&G.MouseTracker.subscribeEvents.push("MozMousePixelScroll"),window.PointerEvent&&(window.navigator.pointerEnabled||G.Browser.vendor!==G.BROWSERS.IE)?(G.MouseTracker.havePointerEvents=!0,G.MouseTracker.subscribeEvents.push("pointerover","pointerout","pointerdown","pointerup","pointermove","pointercancel"),G.MouseTracker.unprefixedPointerEvents=!0,navigator.maxTouchPoints?G.MouseTracker.maxTouchPoints=navigator.maxTouchPoints:G.MouseTracker.maxTouchPoints=0,G.MouseTracker.haveMouseEnter=!1):window.MSPointerEvent&&window.navigator.msPointerEnabled?(G.MouseTracker.havePointerEvents=!0,G.MouseTracker.subscribeEvents.push("MSPointerOver","MSPointerOut","MSPointerDown","MSPointerUp","MSPointerMove","MSPointerCancel"),G.MouseTracker.unprefixedPointerEvents=!1,navigator.msMaxTouchPoints?G.MouseTracker.maxTouchPoints=navigator.msMaxTouchPoints:G.MouseTracker.maxTouchPoints=0,G.MouseTracker.haveMouseEnter=!1):(G.MouseTracker.havePointerEvents=!1,G.Browser.vendor===G.BROWSERS.IE&&G.Browser.version<9?(G.MouseTracker.subscribeEvents.push("mouseenter","mouseleave"),G.MouseTracker.haveMouseEnter=!0):(G.MouseTracker.subscribeEvents.push("mouseover","mouseout"),G.MouseTracker.haveMouseEnter=!1),G.MouseTracker.subscribeEvents.push("mousedown","mouseup","mousemove"),"ontouchstart"in window&&G.MouseTracker.subscribeEvents.push("touchstart","touchend","touchmove","touchcancel"),"ongesturestart"in window&&G.MouseTracker.subscribeEvents.push("gesturestart","gesturechange"),G.MouseTracker.mousePointerId="legacy-mouse",G.MouseTracker.maxTouchPoints=10),G.MouseTracker.GesturePointList=function(G){this._gPoints=[],this.type=G,this.buttons=0,this.contacts=0,this.clicks=0,this.captureCount=0},G.MouseTracker.GesturePointList.prototype={getLength:function(){return this._gPoints.length},asArray:function(){return this._gPoints},add:function(G){return this._gPoints.push(G)},removeById:function(G){var q,Z=this._gPoints.length;for(q=0;q<Z;q++)if(this._gPoints[q].id===G){this._gPoints.splice(q,1);break}return this._gPoints.length},getByIndex:function(G){return G<this._gPoints.length?this._gPoints[G]:null},getById:function(G){var q,Z=this._gPoints.length;for(q=0;q<Z;q++)if(this._gPoints[q].id===G)return this._gPoints[q];return null},getPrimary:function(G){var q,Z=this._gPoints.length;for(q=0;q<Z;q++)if(this._gPoints[q].isPrimary)return this._gPoints[q];return null},addContact:function(){++this.contacts,this.contacts>1&&("mouse"===this.type||"pen"===this.type)&&(this.contacts=1)},removeContact:function(){--this.contacts,this.contacts<0&&(this.contacts=0)}};var X=function(){try{return window.self!==window.top}catch(G){return!0}}();function A(G){try{return G.addEventListener&&G.removeEventListener}catch(G){return!1}}}(OpenSeadragon),function(G){G.ControlAnchor={NONE:0,TOP_LEFT:1,TOP_RIGHT:2,BOTTOM_RIGHT:3,BOTTOM_LEFT:4,ABSOLUTE:5},G.Control=function(q,Z,X){var K=q.parentNode;"number"==typeof Z&&(G.console.error("Passing an anchor directly into the OpenSeadragon.Control constructor is deprecated; please use an options object instead.  Support for this deprecated variant is scheduled for removal in December 2013"),Z={anchor:Z}),Z.attachToViewer=void 0===Z.attachToViewer||Z.attachToViewer,this.autoFade=void 0===Z.autoFade||Z.autoFade,this.element=q,this.anchor=Z.anchor,this.container=X,this.anchor==G.ControlAnchor.ABSOLUTE?(this.wrapper=G.makeNeutralElement("div"),this.wrapper.style.position="absolute",this.wrapper.style.top="number"==typeof Z.top?Z.top+"px":Z.top,this.wrapper.style.left="number"==typeof Z.left?Z.left+"px":Z.left,this.wrapper.style.height="number"==typeof Z.height?Z.height+"px":Z.height,this.wrapper.style.width="number"==typeof Z.width?Z.width+"px":Z.width,this.wrapper.style.margin="0px",this.wrapper.style.padding="0px",this.element.style.position="relative",this.element.style.top="0px",this.element.style.left="0px",this.element.style.height="100%",this.element.style.width="100%"):(this.wrapper=G.makeNeutralElement("div"),this.wrapper.style.display="inline-block",this.anchor==G.ControlAnchor.NONE&&(this.wrapper.style.width=this.wrapper.style.height="100%")),this.wrapper.appendChild(this.element),Z.attachToViewer?this.anchor==G.ControlAnchor.TOP_RIGHT||this.anchor==G.ControlAnchor.BOTTOM_RIGHT?this.container.insertBefore(this.wrapper,this.container.firstChild):this.container.appendChild(this.wrapper):K.appendChild(this.wrapper)},G.Control.prototype={destroy:function(){this.wrapper.removeChild(this.element),this.container.removeChild(this.wrapper)},isVisible:function(){return"none"!=this.wrapper.style.display},setVisible:function(q){this.wrapper.style.display=q?this.anchor==G.ControlAnchor.ABSOLUTE?"block":"inline-block":"none"},setOpacity:function(q){this.element[G.SIGNAL]&&G.Browser.vendor==G.BROWSERS.IE?G.setElementOpacity(this.element,q,!0):G.setElementOpacity(this.wrapper,q,!0)}}}(OpenSeadragon),function(G){function t(G,q){var Z,X=G.controls;for(Z=X.length-1;Z>=0;Z--)if(X[Z].element==q)return Z;return-1}G.ControlDock=function(q){var Z,X,K=["topleft","topright","bottomright","bottomleft"];for(G.extend(!0,this,{id:"controldock-"+G.now()+"-"+Math.floor(1e6*Math.random()),container:G.makeNeutralElement("div"),controls:[]},q),this.container.onsubmit=function(){return!1},this.element&&(this.element=G.getElement(this.element),this.element.appendChild(this.container),this.element.style.position="relative",this.container.style.width="100%",this.container.style.height="100%"),X=0;X<K.length;X++)Z=K[X],this.controls[Z]=G.makeNeutralElement("div"),this.controls[Z].style.position="absolute",Z.match("left")&&(this.controls[Z].style.left="0px"),Z.match("right")&&(this.controls[Z].style.right="0px"),Z.match("top")&&(this.controls[Z].style.top="0px"),Z.match("bottom")&&(this.controls[Z].style.bottom="0px");this.container.appendChild(this.controls.topleft),this.container.appendChild(this.controls.topright),this.container.appendChild(this.controls.bottomright),this.container.appendChild(this.controls.bottomleft)},G.ControlDock.prototype={addControl:function(q,Z){var X=null;if(!(t(this,q=G.getElement(q))>=0)){switch(Z.anchor){case G.ControlAnchor.TOP_RIGHT:X=this.controls.topright,q.style.position="relative",q.style.paddingRight="0px",q.style.paddingTop="0px";break;case G.ControlAnchor.BOTTOM_RIGHT:X=this.controls.bottomright,q.style.position="relative",q.style.paddingRight="0px",q.style.paddingBottom="0px";break;case G.ControlAnchor.BOTTOM_LEFT:X=this.controls.bottomleft,q.style.position="relative",q.style.paddingLeft="0px",q.style.paddingBottom="0px";break;case G.ControlAnchor.TOP_LEFT:X=this.controls.topleft,q.style.position="relative",q.style.paddingLeft="0px",q.style.paddingTop="0px";break;case G.ControlAnchor.ABSOLUTE:X=this.container,q.style.margin="0px",q.style.padding="0px";break;default:case G.ControlAnchor.NONE:X=this.container,q.style.margin="0px",q.style.padding="0px"}this.controls.push(new G.Control(q,Z,X)),q.style.display="inline-block"}},removeControl:function(q){var Z=t(this,q=G.getElement(q));return Z>=0&&(this.controls[Z].destroy(),this.controls.splice(Z,1)),this},clearControls:function(){for(;this.controls.length>0;)this.controls.pop().destroy();return this},areControlsEnabled:function(){var G;for(G=this.controls.length-1;G>=0;G--)if(this.controls[G].isVisible())return!0;return!1},setControlsEnabled:function(G){var q;for(q=this.controls.length-1;q>=0;q--)this.controls[q].setVisible(G);return this}}}(OpenSeadragon),function(G){G.Placement=G.freezeObject({CENTER:0,TOP_LEFT:1,TOP:2,TOP_RIGHT:3,RIGHT:4,BOTTOM_RIGHT:5,BOTTOM:6,BOTTOM_LEFT:7,LEFT:8,properties:{0:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1},1:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},2:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!0,isVerticallyCentered:!1,isBottom:!1},3:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!0,isVerticallyCentered:!1,isBottom:!1},4:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!0,isBottom:!1},5:{isLeft:!1,isHorizontallyCentered:!1,isRight:!0,isTop:!1,isVerticallyCentered:!1,isBottom:!0},6:{isLeft:!1,isHorizontallyCentered:!0,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},7:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!1,isBottom:!0},8:{isLeft:!0,isHorizontallyCentered:!1,isRight:!1,isTop:!1,isVerticallyCentered:!0,isBottom:!1}}})}(OpenSeadragon),function(G){var q={},Z=1;function n(q){return q=G.getElement(q),new G.Point(0===q.clientWidth?1:q.clientWidth,0===q.clientHeight?1:q.clientHeight)}function o(q,Z){if(Z instanceof G.Overlay)return Z;var X=null;if(Z.element)X=G.getElement(Z.element);else{var K=Z.id?Z.id:"openseadragon-overlay-"+Math.floor(1e7*Math.random());(X=G.getElement(Z.id))||((X=document.createElement("a")).href="#/overlay/"+K),X.id=K,G.addClass(X,Z.className?Z.className:"openseadragon-overlay")}var Y=Z.location,Q=Z.width,J=Z.height;if(!Y){var ee=Z.x,te=Z.y;if(void 0!==Z.px){var ie=q.viewport.imageToViewportRectangle(new G.Rect(Z.px,Z.py,Q||0,J||0));ee=ie.x,te=ie.y,Q=void 0!==Q?ie.width:void 0,J=void 0!==J?ie.height:void 0}Y=new G.Point(ee,te)}var ne=Z.placement;return ne&&"string"===G.type(ne)&&(ne=G.Placement[Z.placement.toUpperCase()]),new G.Overlay({element:X,location:Y,placement:ne,onDraw:Z.onDraw,checkResize:Z.checkResize,width:Q,height:J,rotationMode:Z.rotationMode})}function r(G,q){var Z;for(Z=G.length-1;Z>=0;Z--)if(G[Z].element===q)return Z;return-1}function s(q,Z){return G.requestAnimationFrame((function(){Z(q)}))}function l(q){q.autoHideControls&&(q.controlsShouldFade=!0,q.controlsFadeBeginTime=G.now()+q.controlsFadeDelay,window.setTimeout((function(){!function a(q){G.requestAnimationFrame((function(){!function(q){var Z,X;if(q.controlsShouldFade){for(Z=1-(G.now()-q.controlsFadeBeginTime)/q.controlsFadeLength,Z=Math.min(1,Z),Z=Math.max(0,Z),X=q.controls.length-1;X>=0;X--)q.controls[X].autoFade&&q.controls[X].setOpacity(Z);Z>0&&a(q)}}(q)}))}(q)}),q.controlsFadeDelay))}function h(G){var q;for(G.controlsShouldFade=!1,q=G.controls.length-1;q>=0;q--)G.controls[q].setOpacity(1)}function c(){h(this)}function u(){l(this)}function d(q){var Z={originalEvent:q.originalEvent,preventDefaultAction:q.preventDefaultAction,preventVerticalPan:q.preventVerticalPan,preventHorizontalPan:q.preventHorizontalPan};if(this.raiseEvent("canvas-key",Z),Z.preventDefaultAction||q.ctrl||q.alt||q.meta)return!0;switch(q.keyCode){case 38:return Z.preventVerticalPan||(q.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new G.Point(0,-this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 40:return Z.preventVerticalPan||(q.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new G.Point(0,this.pixelsPerArrowPress))),this.viewport.applyConstraints()),!1;case 37:return Z.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new G.Point(-this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;case 39:return Z.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new G.Point(this.pixelsPerArrowPress,0))),this.viewport.applyConstraints()),!1;default:return!0}}function p(q){var Z={originalEvent:q.originalEvent,preventDefaultAction:q.preventDefaultAction,preventVerticalPan:q.preventVerticalPan,preventHorizontalPan:q.preventHorizontalPan};if(this.raiseEvent("canvas-key",Z),Z.preventDefaultAction||q.ctrl||q.alt||q.meta)return!0;switch(q.keyCode){case 43:case 61:return this.viewport.zoomBy(1.1),this.viewport.applyConstraints(),!1;case 45:return this.viewport.zoomBy(.9),this.viewport.applyConstraints(),!1;case 48:return this.viewport.goHome(),this.viewport.applyConstraints(),!1;case 119:case 87:return Z.preventVerticalPan||(q.shift?this.viewport.zoomBy(1.1):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new G.Point(0,-40))),this.viewport.applyConstraints()),!1;case 115:case 83:return Z.preventVerticalPan||(q.shift?this.viewport.zoomBy(.9):this.viewport.panBy(this.viewport.deltaPointsFromPixels(new G.Point(0,40))),this.viewport.applyConstraints()),!1;case 97:return Z.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new G.Point(-40,0))),this.viewport.applyConstraints()),!1;case 100:return Z.preventHorizontalPan||(this.viewport.panBy(this.viewport.deltaPointsFromPixels(new G.Point(40,0))),this.viewport.applyConstraints()),!1;case 114:return this.viewport.flipped?this.viewport.setRotation(this.viewport.degrees-90):this.viewport.setRotation(this.viewport.degrees+90),this.viewport.applyConstraints(),!1;case 82:return this.viewport.flipped?this.viewport.setRotation(this.viewport.degrees+90):this.viewport.setRotation(this.viewport.degrees-90),this.viewport.applyConstraints(),!1;case 102:return this.viewport.toggleFlip(),!1;default:return!0}}function g(G){var q;document.activeElement==this.canvas||this.canvas.focus(),this.viewport.flipped&&(G.position.x=this.viewport.getContainerSize().x-G.position.x);var Z={tracker:G.eventSource,position:G.position,quick:G.quick,shift:G.shift,originalEvent:G.originalEvent,preventDefaultAction:G.preventDefaultAction};this.raiseEvent("canvas-click",Z),!Z.preventDefaultAction&&this.viewport&&G.quick&&(q=this.gestureSettingsByDeviceType(G.pointerType)).clickToZoom&&(this.viewport.zoomBy(G.shift?1/this.zoomPerClick:this.zoomPerClick,q.zoomToRefPoint?this.viewport.pointFromPixel(G.position,!0):null),this.viewport.applyConstraints())}function m(G){var q,Z={tracker:G.eventSource,position:G.position,shift:G.shift,originalEvent:G.originalEvent,preventDefaultAction:G.preventDefaultAction};this.raiseEvent("canvas-double-click",Z),!Z.preventDefaultAction&&this.viewport&&(q=this.gestureSettingsByDeviceType(G.pointerType)).dblClickToZoom&&(this.viewport.zoomBy(G.shift?1/this.zoomPerClick:this.zoomPerClick,q.zoomToRefPoint?this.viewport.pointFromPixel(G.position,!0):null),this.viewport.applyConstraints())}function v(G){var q,Z={tracker:G.eventSource,position:G.position,delta:G.delta,speed:G.speed,direction:G.direction,shift:G.shift,originalEvent:G.originalEvent,preventDefaultAction:G.preventDefaultAction};if(this.raiseEvent("canvas-drag",Z),!Z.preventDefaultAction&&this.viewport){if(q=this.gestureSettingsByDeviceType(G.pointerType),this.panHorizontal||(G.delta.x=0),this.panVertical||(G.delta.y=0),this.viewport.flipped&&(G.delta.x=-G.delta.x),this.constrainDuringPan){var X=this.viewport.deltaPointsFromPixels(G.delta.negate());this.viewport.centerSpringX.target.value+=X.x,this.viewport.centerSpringY.target.value+=X.y;var K=this.viewport.getBounds(),Y=this.viewport.getConstrainedBounds();this.viewport.centerSpringX.target.value-=X.x,this.viewport.centerSpringY.target.value-=X.y,K.x!=Y.x&&(G.delta.x=0),K.y!=Y.y&&(G.delta.y=0)}this.viewport.panBy(this.viewport.deltaPointsFromPixels(G.delta.negate()),q.flickEnabled&&!this.constrainDuringPan)}}function f(q){if(!q.preventDefaultAction&&this.viewport){var Z=this.gestureSettingsByDeviceType(q.pointerType);if(Z.flickEnabled&&q.speed>=Z.flickMinSpeed){var X=0;this.panHorizontal&&(X=Z.flickMomentum*q.speed*Math.cos(q.direction));var K=0;this.panVertical&&(K=Z.flickMomentum*q.speed*Math.sin(q.direction));var Y=this.viewport.pixelFromPoint(this.viewport.getCenter(!0)),Q=this.viewport.pointFromPixel(new G.Point(Y.x-X,Y.y-K));this.viewport.panTo(Q,!1)}this.viewport.applyConstraints()}this.raiseEvent("canvas-drag-end",{tracker:q.eventSource,position:q.position,speed:q.speed,direction:q.direction,shift:q.shift,originalEvent:q.originalEvent})}function w(G){this.raiseEvent("canvas-enter",{tracker:G.eventSource,pointerType:G.pointerType,position:G.position,buttons:G.buttons,pointers:G.pointers,insideElementPressed:G.insideElementPressed,buttonDownAny:G.buttonDownAny,originalEvent:G.originalEvent})}function y(q){window.location!=window.parent.location&&G.MouseTracker.resetAllMouseTrackers(),this.raiseEvent("canvas-exit",{tracker:q.eventSource,pointerType:q.pointerType,position:q.position,buttons:q.buttons,pointers:q.pointers,insideElementPressed:q.insideElementPressed,buttonDownAny:q.buttonDownAny,originalEvent:q.originalEvent})}function T(G){this.raiseEvent("canvas-press",{tracker:G.eventSource,pointerType:G.pointerType,position:G.position,insideElementPressed:G.insideElementPressed,insideElementReleased:G.insideElementReleased,originalEvent:G.originalEvent})}function x(G){this.raiseEvent("canvas-release",{tracker:G.eventSource,pointerType:G.pointerType,position:G.position,insideElementPressed:G.insideElementPressed,insideElementReleased:G.insideElementReleased,originalEvent:G.originalEvent})}function S(G){this.raiseEvent("canvas-nonprimary-press",{tracker:G.eventSource,position:G.position,pointerType:G.pointerType,button:G.button,buttons:G.buttons,originalEvent:G.originalEvent})}function E(G){this.raiseEvent("canvas-nonprimary-release",{tracker:G.eventSource,position:G.position,pointerType:G.pointerType,button:G.button,buttons:G.buttons,originalEvent:G.originalEvent})}function P(G){var q,Z,X;if(!G.preventDefaultAction&&this.viewport&&((q=this.gestureSettingsByDeviceType(G.pointerType)).pinchToZoom&&(Z=this.viewport.pointFromPixel(G.center,!0),X=this.viewport.pointFromPixel(G.lastCenter,!0).minus(Z),this.panHorizontal||(X.x=0),this.panVertical||(X.y=0),this.viewport.zoomBy(G.distance/G.lastDistance,Z,!0),q.zoomToRefPoint&&this.viewport.panBy(X,!0),this.viewport.applyConstraints()),q.pinchRotate)){var K=Math.atan2(G.gesturePoints[0].currentPos.y-G.gesturePoints[1].currentPos.y,G.gesturePoints[0].currentPos.x-G.gesturePoints[1].currentPos.x),Y=Math.atan2(G.gesturePoints[0].lastPos.y-G.gesturePoints[1].lastPos.y,G.gesturePoints[0].lastPos.x-G.gesturePoints[1].lastPos.x);this.viewport.setRotation(this.viewport.getRotation()+(K-Y)*(180/Math.PI))}return this.raiseEvent("canvas-pinch",{tracker:G.eventSource,gesturePoints:G.gesturePoints,lastCenter:G.lastCenter,center:G.center,lastDistance:G.lastDistance,distance:G.distance,shift:G.shift,originalEvent:G.originalEvent}),!1}function R(q){var Z,X,K;if((K=G.now())-this._lastScrollTime>this.minScrollDeltaTime){if(this._lastScrollTime=K,this.viewport.flipped&&(q.position.x=this.viewport.getContainerSize().x-q.position.x),!q.preventDefaultAction&&this.viewport&&(Z=this.gestureSettingsByDeviceType(q.pointerType)).scrollToZoom&&(X=Math.pow(this.zoomPerScroll,q.scroll),this.viewport.zoomBy(X,Z.zoomToRefPoint?this.viewport.pointFromPixel(q.position,!0):null),this.viewport.applyConstraints()),this.raiseEvent("canvas-scroll",{tracker:q.eventSource,position:q.position,scroll:q.scroll,shift:q.shift,originalEvent:q.originalEvent}),Z&&Z.scrollToZoom)return!1}else if((Z=this.gestureSettingsByDeviceType(q.pointerType))&&Z.scrollToZoom)return!1}function _(G){q[this.hash].mouseInside=!0,h(this),this.raiseEvent("container-enter",{tracker:G.eventSource,position:G.position,buttons:G.buttons,pointers:G.pointers,insideElementPressed:G.insideElementPressed,buttonDownAny:G.buttonDownAny,originalEvent:G.originalEvent})}function C(G){G.pointers<1&&(q[this.hash].mouseInside=!1,q[this.hash].animating||l(this)),this.raiseEvent("container-exit",{tracker:G.eventSource,position:G.position,buttons:G.buttons,pointers:G.pointers,insideElementPressed:G.insideElementPressed,buttonDownAny:G.buttonDownAny,originalEvent:G.originalEvent})}function b(G){!function(G){if(!G._opening){if(G.autoResize){var Z=n(G.container),X=q[G.hash].prevContainerSize;if(!Z.equals(X)){var K=G.viewport;if(G.preserveImageSizeOnResize){var Y=X.x/Z.x,Q=K.getZoom()*Y,J=K.getCenter();K.resize(Z,!1),K.zoomTo(Q,null,!0),K.panTo(J,!0)}else{var ee=K.getBounds();K.resize(Z,!0),K.fitBoundsWithConstraints(ee,!0)}q[G.hash].prevContainerSize=Z,q[G.hash].forceRedraw=!0}}var te=G.viewport.update(),ie=G.world.update()||te;te&&G.raiseEvent("viewport-change"),G.referenceStrip&&(ie=G.referenceStrip.update(G.viewport)||ie),!q[G.hash].animating&&ie&&(G.raiseEvent("animation-start"),h(G)),(ie||q[G.hash].forceRedraw||G.world.needsDraw())&&(!function(G){G.imageLoader.clear(),G.drawer.clear(),G.world.draw(),G.raiseEvent("update-viewport",{})}(G),G._drawOverlays(),G.navigator&&G.navigator.update(G.viewport),q[G.hash].forceRedraw=!1,ie&&G.raiseEvent("animation")),q[G.hash].animating&&!ie&&(G.raiseEvent("animation-finish"),q[G.hash].mouseInside||l(G)),q[G.hash].animating=ie}}(G),G.isOpen()?G._updateRequestId=s(G,b):G._updateRequestId=!1}function O(G,q){return G?G+q:q}function I(){q[this.hash].lastZoomTime=G.now(),q[this.hash].zoomFactor=this.zoomPerSecond,q[this.hash].zooming=!0,D(this)}function k(){q[this.hash].lastZoomTime=G.now(),q[this.hash].zoomFactor=1/this.zoomPerSecond,q[this.hash].zooming=!0,D(this)}function B(){q[this.hash].zooming=!1}function D(q){G.requestAnimationFrame(G.delegate(q,z))}function z(){var Z,X,K;q[this.hash].zooming&&this.viewport&&(X=(Z=G.now())-q[this.hash].lastZoomTime,K=Math.pow(q[this.hash].zoomFactor,X/1e3),this.viewport.zoomBy(K),this.viewport.applyConstraints(),q[this.hash].lastZoomTime=Z,D(this))}function M(){this.viewport&&(q[this.hash].zooming=!1,this.viewport.zoomBy(this.zoomPerClick/1),this.viewport.applyConstraints())}function H(){this.viewport&&(q[this.hash].zooming=!1,this.viewport.zoomBy(1/this.zoomPerClick),this.viewport.applyConstraints())}function L(){this.buttons.emulateEnter(),this.buttons.emulateExit()}function F(){this.viewport&&this.viewport.goHome()}function N(){this.isFullPage()&&!G.isFullScreen()?this.setFullPage(!1):this.setFullScreen(!this.isFullPage()),this.buttons&&this.buttons.emulateExit(),this.fullPageButton.element.focus(),this.viewport&&this.viewport.applyConstraints()}function A(){if(this.viewport){var q=this.viewport.getRotation();q=this.viewport.flipped?G.positiveModulo(q+90,360):G.positiveModulo(q-90,360),this.viewport.setRotation(q)}}function W(){if(this.viewport){var q=this.viewport.getRotation();q=this.viewport.flipped?G.positiveModulo(q-90,360):G.positiveModulo(q+90,360),this.viewport.setRotation(q)}}function V(){this.viewport.toggleFlip()}function U(){var G=this._sequenceIndex-1;this.navPrevNextWrap&&G<0&&(G+=this.tileSources.length),this.goToPage(G)}function j(){var G=this._sequenceIndex+1;this.navPrevNextWrap&&G>=this.tileSources.length&&(G=0),this.goToPage(G)}G.Viewer=function(X){var K,Y=arguments,Q=this;if(G.isPlainObject(X)||(X={id:Y[0],xmlPath:Y.length>1?Y[1]:void 0,prefixUrl:Y.length>2?Y[2]:void 0,controls:Y.length>3?Y[3]:void 0,overlays:Y.length>4?Y[4]:void 0}),X.config&&(G.extend(!0,X,X.config),delete X.config),G.extend(!0,this,{id:X.id,hash:X.hash||Z++,initialPage:0,element:null,container:null,canvas:null,overlays:[],overlaysContainer:null,previousBody:[],customControls:[],source:null,drawer:null,world:null,viewport:null,navigator:null,collectionViewport:null,collectionDrawer:null,navImages:null,buttons:null,profiler:null},G.DEFAULT_SETTINGS,X),void 0===this.hash)throw new Error("A hash must be defined, either by specifying options.id or options.hash.");for(void 0!==q[this.hash]&&G.console.warn("Hash "+this.hash+" has already been used."),q[this.hash]={fsBoundsDelta:new G.Point(1,1),prevContainerSize:null,animating:!1,forceRedraw:!1,mouseInside:!1,group:null,zooming:!1,zoomFactor:null,lastZoomTime:null,fullPage:!1,onfullscreenchange:null},this._sequenceIndex=0,this._firstOpen=!0,this._updateRequestId=null,this._loadQueue=[],this.currentOverlays=[],this._lastScrollTime=G.now(),G.EventSource.call(this),this.addHandler("open-failed",(function(q){var Z=G.getString("Errors.OpenFailed",q.eventSource,q.message);Q._showMessage(Z)})),G.ControlDock.call(this,X),this.xmlPath&&(this.tileSources=[this.xmlPath]),this.element=this.element||document.getElementById(this.id),this.canvas=G.makeNeutralElement("div"),this.canvas.className="openseadragon-canvas",function(G){G.width="100%",G.height="100%",G.overflow="hidden",G.position="absolute",G.top="0px",G.left="0px"}(this.canvas.style),G.setElementTouchActionNone(this.canvas),""!==X.tabIndex&&(this.canvas.tabIndex=void 0===X.tabIndex?0:X.tabIndex),this.container.className="openseadragon-container",function(G){G.width="100%",G.height="100%",G.position="relative",G.overflow="hidden",G.left="0px",G.top="0px",G.textAlign="left"}(this.container.style),this.container.insertBefore(this.canvas,this.container.firstChild),this.element.appendChild(this.container),this.bodyWidth=document.body.style.width,this.bodyHeight=document.body.style.height,this.bodyOverflow=document.body.style.overflow,this.docOverflow=document.documentElement.style.overflow,this.innerTracker=new G.MouseTracker({element:this.canvas,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,keyDownHandler:G.delegate(this,d),keyHandler:G.delegate(this,p),clickHandler:G.delegate(this,g),dblClickHandler:G.delegate(this,m),dragHandler:G.delegate(this,v),dragEndHandler:G.delegate(this,f),enterHandler:G.delegate(this,w),exitHandler:G.delegate(this,y),pressHandler:G.delegate(this,T),releaseHandler:G.delegate(this,x),nonPrimaryPressHandler:G.delegate(this,S),nonPrimaryReleaseHandler:G.delegate(this,E),scrollHandler:G.delegate(this,R),pinchHandler:G.delegate(this,P)}),this.outerTracker=new G.MouseTracker({element:this.container,startDisabled:!this.mouseNavEnabled,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,dblClickTimeThreshold:this.dblClickTimeThreshold,dblClickDistThreshold:this.dblClickDistThreshold,enterHandler:G.delegate(this,_),exitHandler:G.delegate(this,C)}),this.toolbar&&(this.toolbar=new G.ControlDock({element:this.toolbar})),this.bindStandardControls(),q[this.hash].prevContainerSize=n(this.container),this.world=new G.World({viewer:this}),this.world.addHandler("add-item",(function(G){Q.source=Q.world.getItemAt(0).source,q[Q.hash].forceRedraw=!0,Q._updateRequestId||(Q._updateRequestId=s(Q,b))})),this.world.addHandler("remove-item",(function(G){Q.world.getItemCount()?Q.source=Q.world.getItemAt(0).source:Q.source=null,q[Q.hash].forceRedraw=!0})),this.world.addHandler("metrics-change",(function(G){Q.viewport&&Q.viewport._setContentBounds(Q.world.getHomeBounds(),Q.world.getContentFactor())})),this.world.addHandler("item-index-change",(function(G){Q.source=Q.world.getItemAt(0).source})),this.viewport=new G.Viewport({containerSize:q[this.hash].prevContainerSize,springStiffness:this.springStiffness,animationTime:this.animationTime,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,visibilityRatio:this.visibilityRatio,wrapHorizontal:this.wrapHorizontal,wrapVertical:this.wrapVertical,defaultZoomLevel:this.defaultZoomLevel,minZoomLevel:this.minZoomLevel,maxZoomLevel:this.maxZoomLevel,viewer:this,degrees:this.degrees,flipped:this.flipped,navigatorRotate:this.navigatorRotate,homeFillsViewer:this.homeFillsViewer,margins:this.viewportMargins}),this.viewport._setContentBounds(this.world.getHomeBounds(),this.world.getContentFactor()),this.imageLoader=new G.ImageLoader({jobLimit:this.imageLoaderLimit,timeout:X.timeout}),this.tileCache=new G.TileCache({maxImageCacheCount:this.maxImageCacheCount}),this.drawer=new G.Drawer({viewer:this,viewport:this.viewport,element:this.canvas,debugGridColor:this.debugGridColor}),this.overlaysContainer=G.makeNeutralElement("div"),this.canvas.appendChild(this.overlaysContainer),this.drawer.canRotate()||(this.rotateLeft&&(K=this.buttons.buttons.indexOf(this.rotateLeft),this.buttons.buttons.splice(K,1),this.buttons.element.removeChild(this.rotateLeft.element)),this.rotateRight&&(K=this.buttons.buttons.indexOf(this.rotateRight),this.buttons.buttons.splice(K,1),this.buttons.element.removeChild(this.rotateRight.element))),this.showNavigator&&(this.navigator=new G.Navigator({id:this.navigatorId,position:this.navigatorPosition,sizeRatio:this.navigatorSizeRatio,maintainSizeRatio:this.navigatorMaintainSizeRatio,top:this.navigatorTop,left:this.navigatorLeft,width:this.navigatorWidth,height:this.navigatorHeight,autoResize:this.navigatorAutoResize,autoFade:this.navigatorAutoFade,prefixUrl:this.prefixUrl,viewer:this,navigatorRotate:this.navigatorRotate,background:this.navigatorBackground,opacity:this.navigatorOpacity,borderColor:this.navigatorBorderColor,displayRegionColor:this.navigatorDisplayRegionColor,crossOriginPolicy:this.crossOriginPolicy})),this.sequenceMode&&this.bindSequenceControls(),this.tileSources&&this.open(this.tileSources),K=0;K<this.customControls.length;K++)this.addControl(this.customControls[K].id,{anchor:this.customControls[K].anchor});G.requestAnimationFrame((function(){l(Q)}))},G.extend(G.Viewer.prototype,G.EventSource.prototype,G.ControlDock.prototype,{isOpen:function(){return!!this.world.getItemCount()},openDzi:function(q){return G.console.error("[Viewer.openDzi] this function is deprecated; use Viewer.open() instead."),this.open(q)},openTileSource:function(q){return G.console.error("[Viewer.openTileSource] this function is deprecated; use Viewer.open() instead."),this.open(q)},open:function(q,Z){var X=this;if(this.close(),q)if(this.sequenceMode&&G.isArray(q))this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),void 0===Z||isNaN(Z)||(this.initialPage=Z),this.tileSources=q,this._sequenceIndex=Math.max(0,Math.min(this.tileSources.length-1,this.initialPage)),this.tileSources.length&&(this.open(this.tileSources[this._sequenceIndex]),this.showReferenceStrip&&this.addReferenceStrip()),this._updateSequenceButtons(this._sequenceIndex);else if(G.isArray(q)||(q=[q]),q.length){this._opening=!0;for(var K,Y=q.length,Q=0,J=0,h=function(){if(Q+J===Y)if(Q){!X._firstOpen&&X.preserveViewport||(X.viewport.goHome(!0),X.viewport.update()),X._firstOpen=!1;var G=q[0];if(G.tileSource&&(G=G.tileSource),X.overlays&&!X.preserveOverlays)for(var Z=0;Z<X.overlays.length;Z++)X.currentOverlays[Z]=o(X,X.overlays[Z]);X._drawOverlays(),X._opening=!1,X.raiseEvent("open",{source:G})}else X._opening=!1,X.raiseEvent("open-failed",K)},c=function(q){G.isPlainObject(q)&&q.tileSource||(q={tileSource:q}),void 0!==q.index&&(G.console.error("[Viewer.open] setting indexes here is not supported; use addTiledImage instead"),delete q.index),void 0===q.collectionImmediately&&(q.collectionImmediately=!0);var Z=q.success;q.success=function(G){if(Q++,q.tileSource.overlays)for(var K=0;K<q.tileSource.overlays.length;K++)X.addOverlay(q.tileSource.overlays[K]);Z&&Z(G),h()};var Y=q.error;q.error=function(G){J++,K||(K=G),Y&&Y(G),h()},X.addTiledImage(q)},ee=0;ee<q.length;ee++)c(q[ee]);return this}},close:function(){return q[this.hash]?(this._opening=!1,this.navigator&&this.navigator.close(),this.preserveOverlays||(this.clearOverlays(),this.overlaysContainer.innerHTML=""),q[this.hash].animating=!1,this.world.removeAll(),this.imageLoader.clear(),this.raiseEvent("close"),this):this},destroy:function(){if(q[this.hash]){if(this.close(),this.clearOverlays(),this.overlaysContainer.innerHTML="",this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null),null!==this._updateRequestId&&(G.cancelAnimationFrame(this._updateRequestId),this._updateRequestId=null),this.drawer&&this.drawer.destroy(),this.removeAllHandlers(),this.element)for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);this.innerTracker&&this.innerTracker.destroy(),this.outerTracker&&this.outerTracker.destroy(),q[this.hash]=null,delete q[this.hash],this.canvas=null,this.container=null,this.element=null}},isMouseNavEnabled:function(){return this.innerTracker.isTracking()},setMouseNavEnabled:function(G){return this.innerTracker.setTracking(G),this.outerTracker.setTracking(G),this.raiseEvent("mouse-enabled",{enabled:G}),this},areControlsEnabled:function(){var G,q=this.controls.length;for(G=0;G<this.controls.length;G++)q=q&&this.controls[G].isVisibile();return q},setControlsEnabled:function(G){return G?h(this):l(this),this.raiseEvent("controls-enabled",{enabled:G}),this},setDebugMode:function(G){for(var q=0;q<this.world.getItemCount();q++)this.world.getItemAt(q).debugMode=G;this.debugMode=G,this.forceRedraw()},isFullPage:function(){return q[this.hash].fullPage},setFullPage:function(Z){var X,K,Y=document.body,Q=Y.style,J=document.documentElement.style,ee=this;if(Z==this.isFullPage())return this;var te={fullPage:Z,preventDefaultAction:!1};if(this.raiseEvent("pre-full-page",te),te.preventDefaultAction)return this;if(Z){for(this.elementSize=G.getElementSize(this.element),this.pageScroll=G.getPageScroll(),this.elementMargin=this.element.style.margin,this.element.style.margin="0",this.elementPadding=this.element.style.padding,this.element.style.padding="0",this.bodyMargin=Q.margin,this.docMargin=J.margin,Q.margin="0",J.margin="0",this.bodyPadding=Q.padding,this.docPadding=J.padding,Q.padding="0",J.padding="0",this.bodyWidth=Q.width,this.docWidth=J.width,Q.width="100%",J.width="100%",this.bodyHeight=Q.height,this.docHeight=J.height,Q.height="100%",J.height="100%",this.previousBody=[],q[this.hash].prevElementParent=this.element.parentNode,q[this.hash].prevNextSibling=this.element.nextSibling,q[this.hash].prevElementWidth=this.element.style.width,q[this.hash].prevElementHeight=this.element.style.height,X=Y.childNodes.length,K=0;K<X;K++)this.previousBody.push(Y.childNodes[0]),Y.removeChild(Y.childNodes[0]);this.toolbar&&this.toolbar.element&&(this.toolbar.parentNode=this.toolbar.element.parentNode,this.toolbar.nextSibling=this.toolbar.element.nextSibling,Y.appendChild(this.toolbar.element),G.addClass(this.toolbar.element,"fullpage")),G.addClass(this.element,"fullpage"),Y.appendChild(this.element),this.element.style.height=G.getWindowSize().y+"px",this.element.style.width=G.getWindowSize().x+"px",this.toolbar&&this.toolbar.element&&(this.element.style.height=G.getElementSize(this.element).y-G.getElementSize(this.toolbar.element).y+"px"),q[this.hash].fullPage=!0,G.delegate(this,_)({})}else{for(this.element.style.margin=this.elementMargin,this.element.style.padding=this.elementPadding,Q.margin=this.bodyMargin,J.margin=this.docMargin,Q.padding=this.bodyPadding,J.padding=this.docPadding,Q.width=this.bodyWidth,J.width=this.docWidth,Q.height=this.bodyHeight,J.height=this.docHeight,Y.removeChild(this.element),X=this.previousBody.length,K=0;K<X;K++)Y.appendChild(this.previousBody.shift());G.removeClass(this.element,"fullpage"),q[this.hash].prevElementParent.insertBefore(this.element,q[this.hash].prevNextSibling),this.toolbar&&this.toolbar.element&&(Y.removeChild(this.toolbar.element),G.removeClass(this.toolbar.element,"fullpage"),this.toolbar.parentNode.insertBefore(this.toolbar.element,this.toolbar.nextSibling),delete this.toolbar.parentNode,delete this.toolbar.nextSibling),this.element.style.width=q[this.hash].prevElementWidth,this.element.style.height=q[this.hash].prevElementHeight;var ie=0,u=function(){G.setPageScroll(ee.pageScroll);var q=G.getPageScroll();++ie<10&&(q.x!==ee.pageScroll.x||q.y!==ee.pageScroll.y)&&G.requestAnimationFrame(u)};G.requestAnimationFrame(u),q[this.hash].fullPage=!1,G.delegate(this,C)({})}return this.navigator&&this.viewport&&this.navigator.update(this.viewport),this.raiseEvent("full-page",{fullPage:Z}),this},setFullScreen:function(q){var Z=this;if(!G.supportsFullScreen)return this.setFullPage(q);if(G.isFullScreen()===q)return this;var X={fullScreen:q,preventDefaultAction:!1};if(this.raiseEvent("pre-full-screen",X),X.preventDefaultAction)return this;if(q){if(this.setFullPage(!0),!this.isFullPage())return this;this.fullPageStyleWidth=this.element.style.width,this.fullPageStyleHeight=this.element.style.height,this.element.style.width="100%",this.element.style.height="100%";var o=function(){var q=G.isFullScreen();q||(G.removeEvent(document,G.fullScreenEventName,o),G.removeEvent(document,G.fullScreenErrorEventName,o),Z.setFullPage(!1),Z.isFullPage()&&(Z.element.style.width=Z.fullPageStyleWidth,Z.element.style.height=Z.fullPageStyleHeight)),Z.navigator&&Z.viewport&&Z.navigator.update(Z.viewport),Z.raiseEvent("full-screen",{fullScreen:q})};G.addEvent(document,G.fullScreenEventName,o),G.addEvent(document,G.fullScreenErrorEventName,o),G.requestFullScreen(document.body)}else G.exitFullScreen();return this},isVisible:function(){return"hidden"!=this.container.style.visibility},setVisible:function(G){return this.container.style.visibility=G?"":"hidden",this.raiseEvent("visible",{visible:G}),this},addTiledImage:function(q){G.console.assert(q,"[Viewer.addTiledImage] options is required"),G.console.assert(q.tileSource,"[Viewer.addTiledImage] options.tileSource is required"),G.console.assert(!q.replace||q.index>-1&&q.index<this.world.getItemCount(),"[Viewer.addTiledImage] if options.replace is used, options.index must be a valid index in Viewer.world");var Z=this;q.replace&&(q.replaceItem=Z.world.getItemAt(q.index)),this._hideMessage(),void 0===q.placeholderFillStyle&&(q.placeholderFillStyle=this.placeholderFillStyle),void 0===q.opacity&&(q.opacity=this.opacity),void 0===q.preload&&(q.preload=this.preload),void 0===q.compositeOperation&&(q.compositeOperation=this.compositeOperation),void 0===q.crossOriginPolicy&&(q.crossOriginPolicy=void 0!==q.tileSource.crossOriginPolicy?q.tileSource.crossOriginPolicy:this.crossOriginPolicy),void 0===q.ajaxWithCredentials&&(q.ajaxWithCredentials=this.ajaxWithCredentials),void 0===q.loadTilesWithAjax&&(q.loadTilesWithAjax=this.loadTilesWithAjax),void 0===q.ajaxHeaders||null===q.ajaxHeaders?q.ajaxHeaders=this.ajaxHeaders:G.isPlainObject(q.ajaxHeaders)&&G.isPlainObject(this.ajaxHeaders)&&(q.ajaxHeaders=G.extend({},this.ajaxHeaders,q.ajaxHeaders));var X={options:q};function o(G){for(var K=0;K<Z._loadQueue.length;K++)if(Z._loadQueue[K]===X){Z._loadQueue.splice(K,1);break}0===Z._loadQueue.length&&r(X),Z.raiseEvent("add-item-failed",G),q.error&&q.error(G)}function r(G){Z.collectionMode&&(Z.world.arrange({immediately:G.options.collectionImmediately,rows:Z.collectionRows,columns:Z.collectionColumns,layout:Z.collectionLayout,tileSize:Z.collectionTileSize,tileMargin:Z.collectionTileMargin}),Z.world.setAutoRefigureSizes(!0))}function s(){for(var q,X,K;Z._loadQueue.length&&(q=Z._loadQueue[0]).tileSource;){if(Z._loadQueue.splice(0,1),q.options.replace){var Y=Z.world.getIndexOfItem(q.options.replaceItem);-1!=Y&&(q.options.index=Y),Z.world.removeItem(q.options.replaceItem)}X=new G.TiledImage({viewer:Z,source:q.tileSource,viewport:Z.viewport,drawer:Z.drawer,tileCache:Z.tileCache,imageLoader:Z.imageLoader,x:q.options.x,y:q.options.y,width:q.options.width,height:q.options.height,fitBounds:q.options.fitBounds,fitBoundsPlacement:q.options.fitBoundsPlacement,clip:q.options.clip,placeholderFillStyle:q.options.placeholderFillStyle,opacity:q.options.opacity,preload:q.options.preload,degrees:q.options.degrees,compositeOperation:q.options.compositeOperation,springStiffness:Z.springStiffness,animationTime:Z.animationTime,minZoomImageRatio:Z.minZoomImageRatio,wrapHorizontal:Z.wrapHorizontal,wrapVertical:Z.wrapVertical,immediateRender:Z.immediateRender,blendTime:Z.blendTime,alwaysBlend:Z.alwaysBlend,minPixelRatio:Z.minPixelRatio,smoothTileEdgesMinZoom:Z.smoothTileEdgesMinZoom,iOSDevice:Z.iOSDevice,crossOriginPolicy:q.options.crossOriginPolicy,ajaxWithCredentials:q.options.ajaxWithCredentials,loadTilesWithAjax:q.options.loadTilesWithAjax,ajaxHeaders:q.options.ajaxHeaders,debugMode:Z.debugMode}),Z.collectionMode&&Z.world.setAutoRefigureSizes(!1),Z.world.addItem(X,{index:q.options.index}),0===Z._loadQueue.length&&r(q),1!==Z.world.getItemCount()||Z.preserveViewport||Z.viewport.goHome(!0),Z.navigator&&(K=G.extend({},q.options,{replace:!1,originalTiledImage:X,tileSource:q.tileSource}),Z.navigator.addTiledImage(K)),q.options.success&&q.options.success({item:X})}}G.isArray(q.tileSource)?setTimeout((function(){o({message:"[Viewer.addTiledImage] Sequences can not be added; add them one at a time instead.",source:q.tileSource,options:q})})):(this._loadQueue.push(X),function(q,Z,X,K,Y){var Q=q;if("string"==G.type(Z))if(Z.match(/^\s*<.*>\s*$/))Z=G.parseXml(Z);else if(Z.match(/^\s*[\{\[].*[\}\]]\s*$/))try{var J=G.parseJSON(Z);Z=J}catch(G){}function l(G,q){G.ready?K(G):(G.addHandler("ready",(function(){K(G)})),G.addHandler("open-failed",(function(G){Y({message:G.message,source:q})})))}setTimeout((function(){if("string"==G.type(Z))(Z=new G.TileSource({url:Z,crossOriginPolicy:void 0!==X.crossOriginPolicy?X.crossOriginPolicy:q.crossOriginPolicy,ajaxWithCredentials:q.ajaxWithCredentials,ajaxHeaders:q.ajaxHeaders,useCanvas:q.useCanvas,success:function(G){K(G.tileSource)}})).addHandler("open-failed",(function(G){Y(G)}));else if(G.isPlainObject(Z)||Z.nodeType)if(void 0!==Z.crossOriginPolicy||void 0===X.crossOriginPolicy&&void 0===q.crossOriginPolicy||(Z.crossOriginPolicy=void 0!==X.crossOriginPolicy?X.crossOriginPolicy:q.crossOriginPolicy),void 0===Z.ajaxWithCredentials&&(Z.ajaxWithCredentials=q.ajaxWithCredentials),void 0===Z.useCanvas&&(Z.useCanvas=q.useCanvas),G.isFunction(Z.getTileUrl)){var J=new G.TileSource(Z);J.getTileUrl=Z.getTileUrl,K(J)}else{var ee=G.TileSource.determineType(Q,Z);if(!ee)return void Y({message:"Unable to load TileSource",source:Z});var te=ee.prototype.configure.apply(Q,[Z]);l(new ee(te),Z)}else l(Z,Z)}))}(this,q.tileSource,q,(function(G){X.tileSource=G,s()}),(function(G){G.options=q,o(G),s()})))},addSimpleImage:function(q){G.console.assert(q,"[Viewer.addSimpleImage] options is required"),G.console.assert(q.url,"[Viewer.addSimpleImage] options.url is required");var Z=G.extend({},q,{tileSource:{type:"image",url:q.url}});delete Z.url,this.addTiledImage(Z)},addLayer:function(q){var Z=this;G.console.error("[Viewer.addLayer] this function is deprecated; use Viewer.addTiledImage() instead.");var X=G.extend({},q,{success:function(G){Z.raiseEvent("add-layer",{options:q,drawer:G.item})},error:function(G){Z.raiseEvent("add-layer-failed",G)}});return this.addTiledImage(X),this},getLayerAtLevel:function(q){return G.console.error("[Viewer.getLayerAtLevel] this function is deprecated; use World.getItemAt() instead."),this.world.getItemAt(q)},getLevelOfLayer:function(q){return G.console.error("[Viewer.getLevelOfLayer] this function is deprecated; use World.getIndexOfItem() instead."),this.world.getIndexOfItem(q)},getLayersCount:function(){return G.console.error("[Viewer.getLayersCount] this function is deprecated; use World.getItemCount() instead."),this.world.getItemCount()},setLayerLevel:function(q,Z){return G.console.error("[Viewer.setLayerLevel] this function is deprecated; use World.setItemIndex() instead."),this.world.setItemIndex(q,Z)},removeLayer:function(q){return G.console.error("[Viewer.removeLayer] this function is deprecated; use World.removeItem() instead."),this.world.removeItem(q)},forceRedraw:function(){return q[this.hash].forceRedraw=!0,this},bindSequenceControls:function(){var q=G.delegate(this,c),Z=G.delegate(this,u),X=G.delegate(this,j),K=G.delegate(this,U),Y=this.navImages,Q=!0;return this.showSequenceControl&&((this.previousButton||this.nextButton)&&(Q=!1),this.previousButton=new G.Button({element:this.previousButton?G.getElement(this.previousButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:G.getString("Tooltips.PreviousPage"),srcRest:O(this.prefixUrl,Y.previous.REST),srcGroup:O(this.prefixUrl,Y.previous.GROUP),srcHover:O(this.prefixUrl,Y.previous.HOVER),srcDown:O(this.prefixUrl,Y.previous.DOWN),onRelease:K,onFocus:q,onBlur:Z}),this.nextButton=new G.Button({element:this.nextButton?G.getElement(this.nextButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:G.getString("Tooltips.NextPage"),srcRest:O(this.prefixUrl,Y.next.REST),srcGroup:O(this.prefixUrl,Y.next.GROUP),srcHover:O(this.prefixUrl,Y.next.HOVER),srcDown:O(this.prefixUrl,Y.next.DOWN),onRelease:X,onFocus:q,onBlur:Z}),this.navPrevNextWrap||this.previousButton.disable(),this.tileSources&&this.tileSources.length||this.nextButton.disable(),Q&&(this.paging=new G.ButtonGroup({buttons:[this.previousButton,this.nextButton],clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.pagingControl=this.paging.element,this.toolbar?this.toolbar.addControl(this.pagingControl,{anchor:G.ControlAnchor.BOTTOM_RIGHT}):this.addControl(this.pagingControl,{anchor:this.sequenceControlAnchor||G.ControlAnchor.TOP_LEFT}))),this},bindStandardControls:function(){var q=G.delegate(this,I),Z=G.delegate(this,B),X=G.delegate(this,M),K=G.delegate(this,k),Y=G.delegate(this,H),Q=G.delegate(this,F),J=G.delegate(this,N),ee=G.delegate(this,A),te=G.delegate(this,W),ie=G.delegate(this,V),ne=G.delegate(this,c),oe=G.delegate(this,u),re=this.navImages,se=[],ae=!0;return this.showNavigationControl&&((this.zoomInButton||this.zoomOutButton||this.homeButton||this.fullPageButton||this.rotateLeftButton||this.rotateRightButton||this.flipButton)&&(ae=!1),this.showZoomControl&&(se.push(this.zoomInButton=new G.Button({element:this.zoomInButton?G.getElement(this.zoomInButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:G.getString("Tooltips.ZoomIn"),srcRest:O(this.prefixUrl,re.zoomIn.REST),srcGroup:O(this.prefixUrl,re.zoomIn.GROUP),srcHover:O(this.prefixUrl,re.zoomIn.HOVER),srcDown:O(this.prefixUrl,re.zoomIn.DOWN),onPress:q,onRelease:Z,onClick:X,onEnter:q,onExit:Z,onFocus:ne,onBlur:oe})),se.push(this.zoomOutButton=new G.Button({element:this.zoomOutButton?G.getElement(this.zoomOutButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:G.getString("Tooltips.ZoomOut"),srcRest:O(this.prefixUrl,re.zoomOut.REST),srcGroup:O(this.prefixUrl,re.zoomOut.GROUP),srcHover:O(this.prefixUrl,re.zoomOut.HOVER),srcDown:O(this.prefixUrl,re.zoomOut.DOWN),onPress:K,onRelease:Z,onClick:Y,onEnter:K,onExit:Z,onFocus:ne,onBlur:oe}))),this.showHomeControl&&se.push(this.homeButton=new G.Button({element:this.homeButton?G.getElement(this.homeButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:G.getString("Tooltips.Home"),srcRest:O(this.prefixUrl,re.home.REST),srcGroup:O(this.prefixUrl,re.home.GROUP),srcHover:O(this.prefixUrl,re.home.HOVER),srcDown:O(this.prefixUrl,re.home.DOWN),onRelease:Q,onFocus:ne,onBlur:oe})),this.showFullPageControl&&se.push(this.fullPageButton=new G.Button({element:this.fullPageButton?G.getElement(this.fullPageButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:G.getString("Tooltips.FullPage"),srcRest:O(this.prefixUrl,re.fullpage.REST),srcGroup:O(this.prefixUrl,re.fullpage.GROUP),srcHover:O(this.prefixUrl,re.fullpage.HOVER),srcDown:O(this.prefixUrl,re.fullpage.DOWN),onRelease:J,onFocus:ne,onBlur:oe})),this.showRotationControl&&(se.push(this.rotateLeftButton=new G.Button({element:this.rotateLeftButton?G.getElement(this.rotateLeftButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:G.getString("Tooltips.RotateLeft"),srcRest:O(this.prefixUrl,re.rotateleft.REST),srcGroup:O(this.prefixUrl,re.rotateleft.GROUP),srcHover:O(this.prefixUrl,re.rotateleft.HOVER),srcDown:O(this.prefixUrl,re.rotateleft.DOWN),onRelease:ee,onFocus:ne,onBlur:oe})),se.push(this.rotateRightButton=new G.Button({element:this.rotateRightButton?G.getElement(this.rotateRightButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:G.getString("Tooltips.RotateRight"),srcRest:O(this.prefixUrl,re.rotateright.REST),srcGroup:O(this.prefixUrl,re.rotateright.GROUP),srcHover:O(this.prefixUrl,re.rotateright.HOVER),srcDown:O(this.prefixUrl,re.rotateright.DOWN),onRelease:te,onFocus:ne,onBlur:oe}))),this.showFlipControl&&se.push(this.flipButton=new G.Button({element:this.flipButton?G.getElement(this.flipButton):null,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,tooltip:G.getString("Tooltips.Flip"),srcRest:O(this.prefixUrl,re.flip.REST),srcGroup:O(this.prefixUrl,re.flip.GROUP),srcHover:O(this.prefixUrl,re.flip.HOVER),srcDown:O(this.prefixUrl,re.flip.DOWN),onRelease:ie,onFocus:ne,onBlur:oe})),ae&&(this.buttons=new G.ButtonGroup({buttons:se,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold}),this.navControl=this.buttons.element,this.addHandler("open",G.delegate(this,L)),this.toolbar?this.toolbar.addControl(this.navControl,{anchor:this.navigationControlAnchor||G.ControlAnchor.TOP_LEFT}):this.addControl(this.navControl,{anchor:this.navigationControlAnchor||G.ControlAnchor.TOP_LEFT}))),this},currentPage:function(){return this._sequenceIndex},goToPage:function(G){return this.tileSources&&G>=0&&G<this.tileSources.length&&(this._sequenceIndex=G,this._updateSequenceButtons(G),this.open(this.tileSources[G]),this.referenceStrip&&this.referenceStrip.setFocus(G),this.raiseEvent("page",{page:G})),this},addOverlay:function(q,Z,X,K){var Y;if(Y=G.isPlainObject(q)?q:{element:q,location:Z,placement:X,onDraw:K},q=G.getElement(Y.element),r(this.currentOverlays,q)>=0)return this;var Q=o(this,Y);return this.currentOverlays.push(Q),Q.drawHTML(this.overlaysContainer,this.viewport),this.raiseEvent("add-overlay",{element:q,location:Y.location,placement:Y.placement}),this},updateOverlay:function(Z,X,K){var Y;return Z=G.getElement(Z),(Y=r(this.currentOverlays,Z))>=0&&(this.currentOverlays[Y].update(X,K),q[this.hash].forceRedraw=!0,this.raiseEvent("update-overlay",{element:Z,location:X,placement:K})),this},removeOverlay:function(Z){var X;return Z=G.getElement(Z),(X=r(this.currentOverlays,Z))>=0&&(this.currentOverlays[X].destroy(),this.currentOverlays.splice(X,1),q[this.hash].forceRedraw=!0,this.raiseEvent("remove-overlay",{element:Z})),this},clearOverlays:function(){for(;this.currentOverlays.length>0;)this.currentOverlays.pop().destroy();return q[this.hash].forceRedraw=!0,this.raiseEvent("clear-overlay",{}),this},getOverlayById:function(q){var Z;return q=G.getElement(q),(Z=r(this.currentOverlays,q))>=0?this.currentOverlays[Z]:null},_updateSequenceButtons:function(G){this.nextButton&&(this.tileSources&&this.tileSources.length-1!==G?this.nextButton.enable():this.navPrevNextWrap||this.nextButton.disable()),this.previousButton&&(G>0?this.previousButton.enable():this.navPrevNextWrap||this.previousButton.disable())},_showMessage:function(q){this._hideMessage();var Z=G.makeNeutralElement("div");Z.appendChild(document.createTextNode(q)),this.messageDiv=G.makeCenteredNode(Z),G.addClass(this.messageDiv,"openseadragon-message"),this.container.appendChild(this.messageDiv)},_hideMessage:function(){var G=this.messageDiv;G&&(G.parentNode.removeChild(G),delete this.messageDiv)},gestureSettingsByDeviceType:function(G){switch(G){case"mouse":return this.gestureSettingsMouse;case"touch":return this.gestureSettingsTouch;case"pen":return this.gestureSettingsPen;default:return this.gestureSettingsUnknown}},_drawOverlays:function(){var G,q=this.currentOverlays.length;for(G=0;G<q;G++)this.currentOverlays[G].drawHTML(this.overlaysContainer,this.viewport)},_cancelPendingImages:function(){this._loadQueue=[]},removeReferenceStrip:function(){this.showReferenceStrip=!1,this.referenceStrip&&(this.referenceStrip.destroy(),this.referenceStrip=null)},addReferenceStrip:function(){if(this.showReferenceStrip=!0,this.sequenceMode){if(this.referenceStrip)return;this.tileSources.length&&this.tileSources.length>1&&(this.referenceStrip=new G.ReferenceStrip({id:this.referenceStripElement,position:this.referenceStripPosition,sizeRatio:this.referenceStripSizeRatio,scroll:this.referenceStripScroll,height:this.referenceStripHeight,width:this.referenceStripWidth,tileSources:this.tileSources,prefixUrl:this.prefixUrl,viewer:this}),this.referenceStrip.setFocus(this._sequenceIndex))}else G.console.warn('Attempting to display a reference strip while "sequenceMode" is off.')}})}(OpenSeadragon),function(G){function t(G){var q={tracker:G.eventSource,position:G.position,quick:G.quick,shift:G.shift,originalEvent:G.originalEvent,preventDefaultAction:G.preventDefaultAction};if(this.viewer.raiseEvent("navigator-click",q),!q.preventDefaultAction&&G.quick&&this.viewer.viewport&&(this.panVertical||this.panHorizontal)){this.viewer.viewport.flipped&&(G.position.x=this.viewport.getContainerSize().x-G.position.x);var Z=this.viewport.pointFromPixel(G.position);this.panVertical?this.panHorizontal||(Z.x=this.viewer.viewport.getCenter(!0).x):Z.y=this.viewer.viewport.getCenter(!0).y,this.viewer.viewport.panTo(Z),this.viewer.viewport.applyConstraints()}}function i(G){var q={tracker:G.eventSource,position:G.position,delta:G.delta,speed:G.speed,direction:G.direction,shift:G.shift,originalEvent:G.originalEvent,preventDefaultAction:G.preventDefaultAction};this.viewer.raiseEvent("navigator-drag",q),!q.preventDefaultAction&&this.viewer.viewport&&(this.panHorizontal||(G.delta.x=0),this.panVertical||(G.delta.y=0),this.viewer.viewport.flipped&&(G.delta.x=-G.delta.x),this.viewer.viewport.panBy(this.viewport.deltaPointsFromPixels(G.delta)),this.viewer.constrainDuringPan&&this.viewer.viewport.applyConstraints())}function n(G){G.insideElementPressed&&this.viewer.viewport&&this.viewer.viewport.applyConstraints()}function o(G){return this.viewer.raiseEvent("navigator-scroll",{tracker:G.eventSource,position:G.position,scroll:G.scroll,shift:G.shift,originalEvent:G.originalEvent}),!1}function r(G,q){s(G,"rotate("+q+"deg)")}function s(G,q){G.style.webkitTransform=q,G.style.mozTransform=q,G.style.msTransform=q,G.style.oTransform=q,G.style.transform=q}G.Navigator=function(q){var Z,X,K=q.viewer,Y=this;function u(G){r(Y.displayRegionContainer,G),r(Y.displayRegion,-G),Y.viewport.setRotation(G)}q.id?(this.element=document.getElementById(q.id),q.controlOptions={anchor:G.ControlAnchor.NONE,attachToViewer:!1,autoFade:!1}):(q.id="navigator-"+G.now(),this.element=G.makeNeutralElement("div"),q.controlOptions={anchor:G.ControlAnchor.TOP_RIGHT,attachToViewer:!0,autoFade:q.autoFade},q.position&&("BOTTOM_RIGHT"==q.position?q.controlOptions.anchor=G.ControlAnchor.BOTTOM_RIGHT:"BOTTOM_LEFT"==q.position?q.controlOptions.anchor=G.ControlAnchor.BOTTOM_LEFT:"TOP_RIGHT"==q.position?q.controlOptions.anchor=G.ControlAnchor.TOP_RIGHT:"TOP_LEFT"==q.position?q.controlOptions.anchor=G.ControlAnchor.TOP_LEFT:"ABSOLUTE"==q.position&&(q.controlOptions.anchor=G.ControlAnchor.ABSOLUTE,q.controlOptions.top=q.top,q.controlOptions.left=q.left,q.controlOptions.height=q.height,q.controlOptions.width=q.width))),this.element.id=q.id,this.element.className+=" navigator",(q=G.extend(!0,{sizeRatio:G.DEFAULT_SETTINGS.navigatorSizeRatio},q,{element:this.element,tabIndex:-1,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0,autoResize:q.autoResize,minZoomImageRatio:1,background:q.background,opacity:q.opacity,borderColor:q.borderColor,displayRegionColor:q.displayRegionColor})).minPixelRatio=this.minPixelRatio=K.minPixelRatio,G.setElementTouchActionNone(this.element),this.borderWidth=2,this.fudge=new G.Point(1,1),this.totalBorderWidths=new G.Point(2*this.borderWidth,2*this.borderWidth).minus(this.fudge),q.controlOptions.anchor!=G.ControlAnchor.NONE&&function(G,Z){G.margin="0px",G.border=Z+"px solid "+q.borderColor,G.padding="0px",G.background=q.background,G.opacity=q.opacity,G.overflow="hidden"}(this.element.style,this.borderWidth),this.displayRegion=G.makeNeutralElement("div"),this.displayRegion.id=this.element.id+"-displayregion",this.displayRegion.className="displayregion",function(G,Z){G.position="relative",G.top="0px",G.left="0px",G.fontSize="0px",G.overflow="hidden",G.border=Z+"px solid "+q.displayRegionColor,G.margin="0px",G.padding="0px",G.background="transparent",G.float="left",G.cssFloat="left",G.styleFloat="left",G.zIndex=999999999,G.cursor="default"}(this.displayRegion.style,this.borderWidth),this.displayRegionContainer=G.makeNeutralElement("div"),this.displayRegionContainer.id=this.element.id+"-displayregioncontainer",this.displayRegionContainer.className="displayregioncontainer",this.displayRegionContainer.style.width="100%",this.displayRegionContainer.style.height="100%",K.addControl(this.element,q.controlOptions),this._resizeWithViewer=q.controlOptions.anchor!=G.ControlAnchor.ABSOLUTE&&q.controlOptions.anchor!=G.ControlAnchor.NONE,this._resizeWithViewer&&(q.width&&q.height?(this.element.style.height="number"==typeof q.height?q.height+"px":q.height,this.element.style.width="number"==typeof q.width?q.width+"px":q.width):(Z=G.getElementSize(K.element),this.element.style.height=Math.round(Z.y*q.sizeRatio)+"px",this.element.style.width=Math.round(Z.x*q.sizeRatio)+"px",this.oldViewerSize=Z),X=G.getElementSize(this.element),this.elementArea=X.x*X.y),this.oldContainerSize=new G.Point(0,0),G.Viewer.apply(this,[q]),this.displayRegionContainer.appendChild(this.displayRegion),this.element.getElementsByTagName("div")[0].appendChild(this.displayRegionContainer),q.navigatorRotate&&(u(q.viewer.viewport?q.viewer.viewport.getRotation():q.viewer.degrees||0),q.viewer.addHandler("rotate",(function(G){u(G.degrees)}))),this.innerTracker.destroy(),this.innerTracker=new G.MouseTracker({element:this.element,dragHandler:G.delegate(this,i),clickHandler:G.delegate(this,t),releaseHandler:G.delegate(this,n),scrollHandler:G.delegate(this,o)}),this.addHandler("reset-size",(function(){Y.viewport&&Y.viewport.goHome(!0)})),K.world.addHandler("item-index-change",(function(G){window.setTimeout((function(){var q=Y.world.getItemAt(G.previousIndex);Y.world.setItemIndex(q,G.newIndex)}),1)})),K.world.addHandler("remove-item",(function(G){var q=G.item,Z=Y._getMatchingItem(q);Z&&Y.world.removeItem(Z)})),this.update(K.viewport)},G.extend(G.Navigator.prototype,G.EventSource.prototype,G.Viewer.prototype,{updateSize:function(){if(this.viewport){var q=new G.Point(0===this.container.clientWidth?1:this.container.clientWidth,0===this.container.clientHeight?1:this.container.clientHeight);q.equals(this.oldContainerSize)||(this.viewport.resize(q,!0),this.viewport.goHome(!0),this.oldContainerSize=q,this.drawer.clear(),this.world.draw())}},setFlip:function(G){return this.viewport.setFlip(G),this.setDisplayTransform(this.viewer.viewport.getFlip()?"scale(-1,1)":"scale(1,1)"),this},setDisplayTransform:function(G){s(this.displayRegion,G),s(this.canvas,G),s(this.element,G)},update:function(q){var Z,X,K,Y,Q,J;if(Z=G.getElementSize(this.viewer.element),this._resizeWithViewer&&Z.x&&Z.y&&!Z.equals(this.oldViewerSize)&&(this.oldViewerSize=Z,this.maintainSizeRatio||!this.elementArea?(X=Z.x*this.sizeRatio,K=Z.y*this.sizeRatio):(X=Math.sqrt(this.elementArea*(Z.x/Z.y)),K=this.elementArea/X),this.element.style.width=Math.round(X)+"px",this.element.style.height=Math.round(K)+"px",this.elementArea||(this.elementArea=X*K),this.updateSize()),q&&this.viewport){Y=q.getBoundsNoRotate(!0),Q=this.viewport.pixelFromPointNoRotate(Y.getTopLeft(),!1),J=this.viewport.pixelFromPointNoRotate(Y.getBottomRight(),!1).minus(this.totalBorderWidths);var ee=this.displayRegion.style;ee.display=this.world.getItemCount()?"block":"none",ee.top=Math.round(Q.y)+"px",ee.left=Math.round(Q.x)+"px";var te=Math.abs(Q.x-J.x),ie=Math.abs(Q.y-J.y);ee.width=Math.round(Math.max(te,0))+"px",ee.height=Math.round(Math.max(ie,0))+"px"}},addTiledImage:function(q){var Z=this,X=q.originalTiledImage;delete q.original;var K=G.extend({},q,{success:function(G){var q=G.item;function o(){Z._matchBounds(q,X)}q._originalForNavigator=X,Z._matchBounds(q,X,!0),X.addHandler("bounds-change",o),X.addHandler("clip-change",o),X.addHandler("opacity-change",(function(){Z._matchOpacity(q,X)})),X.addHandler("composite-operation-change",(function(){Z._matchCompositeOperation(q,X)}))}});return G.Viewer.prototype.addTiledImage.apply(this,[K])},_getMatchingItem:function(G){for(var q,Z=this.world.getItemCount(),X=0;X<Z;X++)if((q=this.world.getItemAt(X))._originalForNavigator===G)return q;return null},_matchBounds:function(G,q,Z){var X=q.getBoundsNoRotate();G.setPosition(X.getTopLeft(),Z),G.setWidth(X.width,Z),G.setRotation(q.getRotation(),Z),G.setClip(q.getClip())},_matchOpacity:function(G,q){G.setOpacity(q.opacity)},_matchCompositeOperation:function(G,q){G.setCompositeOperation(q.compositeOperation)}})}(OpenSeadragon),function(G){var q={Errors:{Dzc:"Sorry, we don't support Deep Zoom Collections!",Dzi:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",Xml:"Hmm, this doesn't appear to be a valid Deep Zoom Image.",ImageFormat:"Sorry, we don't support {0}-based Deep Zoom Images.",Security:"It looks like a security restriction stopped us from loading this Deep Zoom Image.",Status:"This space unintentionally left blank ({0} {1}).",OpenFailed:"Unable to open {0}: {1}"},Tooltips:{FullPage:"Toggle full page",Home:"Go home",ZoomIn:"Zoom in",ZoomOut:"Zoom out",NextPage:"Next page",PreviousPage:"Previous page",RotateLeft:"Rotate left",RotateRight:"Rotate right",Flip:"Flip Horizontally"}};G.extend(G,{getString:function(Z){var X,K=Z.split("."),Y=null,Q=arguments,J=q;for(X=0;X<K.length-1;X++)J=J[K[X]]||{};return"string"!=typeof(Y=J[K[X]])&&(G.console.log("Untranslated source string:",Z),Y=""),Y.replace(/\{\d+\}/g,(function(G){var q=parseInt(G.match(/\d+/),10)+1;return q<Q.length?Q[q]:""}))},setString:function(G,Z){var X,K=G.split("."),Y=q;for(X=0;X<K.length-1;X++)Y[K[X]]||(Y[K[X]]={}),Y=Y[K[X]];Y[K[X]]=Z}})}(OpenSeadragon),function(G){G.Point=function(G,q){this.x="number"==typeof G?G:0,this.y="number"==typeof q?q:0},G.Point.prototype={clone:function(){return new G.Point(this.x,this.y)},plus:function(q){return new G.Point(this.x+q.x,this.y+q.y)},minus:function(q){return new G.Point(this.x-q.x,this.y-q.y)},times:function(q){return new G.Point(this.x*q,this.y*q)},divide:function(q){return new G.Point(this.x/q,this.y/q)},negate:function(){return new G.Point(-this.x,-this.y)},distanceTo:function(G){return Math.sqrt(Math.pow(this.x-G.x,2)+Math.pow(this.y-G.y,2))},squaredDistanceTo:function(G){return Math.pow(this.x-G.x,2)+Math.pow(this.y-G.y,2)},apply:function(q){return new G.Point(q(this.x),q(this.y))},equals:function(q){return q instanceof G.Point&&this.x===q.x&&this.y===q.y},rotate:function(q,Z){var X,K;if(Z=Z||new G.Point(0,0),q%90==0)switch(G.positiveModulo(q,360)){case 0:X=1,K=0;break;case 90:X=0,K=1;break;case 180:X=-1,K=0;break;case 270:X=0,K=-1}else{var Y=q*Math.PI/180;X=Math.cos(Y),K=Math.sin(Y)}var Q=X*(this.x-Z.x)-K*(this.y-Z.y)+Z.x,J=K*(this.x-Z.x)+X*(this.y-Z.y)+Z.y;return new G.Point(Q,J)},toString:function(){return"("+Math.round(100*this.x)/100+","+Math.round(100*this.y)/100+")"}}}(OpenSeadragon),function(G){G.TileSource=function(q,Z,X,K,Y,Q){var J,ee,te=this,ie=arguments;if(J=G.isPlainObject(q)?q:{width:ie[0],height:ie[1],tileSize:ie[2],tileOverlap:ie[3],minLevel:ie[4],maxLevel:ie[5]},G.EventSource.call(this),G.extend(!0,this,J),!this.success)for(ee=0;ee<arguments.length;ee++)if(G.isFunction(arguments[ee])){this.success=arguments[ee];break}this.success&&this.addHandler("ready",(function(G){te.success(G)})),"string"==G.type(arguments[0])&&(this.url=arguments[0]),this.url?(this.aspectRatio=1,this.dimensions=new G.Point(10,10),this._tileWidth=0,this._tileHeight=0,this.tileOverlap=0,this.minLevel=0,this.maxLevel=0,this.ready=!1,this.getImageInfo(this.url)):(this.ready=!0,this.aspectRatio=J.width&&J.height?J.width/J.height:1,this.dimensions=new G.Point(J.width,J.height),this.tileSize?(this._tileWidth=this._tileHeight=this.tileSize,delete this.tileSize):(this.tileWidth?(this._tileWidth=this.tileWidth,delete this.tileWidth):this._tileWidth=0,this.tileHeight?(this._tileHeight=this.tileHeight,delete this.tileHeight):this._tileHeight=0),this.tileOverlap=J.tileOverlap?J.tileOverlap:0,this.minLevel=J.minLevel?J.minLevel:0,this.maxLevel=void 0!==J.maxLevel&&null!==J.maxLevel?J.maxLevel:J.width&&J.height?Math.ceil(Math.log(Math.max(J.width,J.height))/Math.log(2)):0,this.success&&G.isFunction(this.success)&&this.success(this))},G.TileSource.prototype={getTileSize:function(q){return G.console.error("[TileSource.getTileSize] is deprecated.Use TileSource.getTileWidth() and TileSource.getTileHeight() instead"),this._tileWidth},getTileWidth:function(G){return this._tileWidth?this._tileWidth:this.getTileSize(G)},getTileHeight:function(G){return this._tileHeight?this._tileHeight:this.getTileSize(G)},getLevelScale:function(G){var q,Z={};for(q=0;q<=this.maxLevel;q++)Z[q]=1/Math.pow(2,this.maxLevel-q);return this.getLevelScale=function(G){return Z[G]},this.getLevelScale(G)},getNumTiles:function(q){var Z=this.getLevelScale(q),X=Math.ceil(Z*this.dimensions.x/this.getTileWidth(q)),K=Math.ceil(Z*this.dimensions.y/this.getTileHeight(q));return new G.Point(X,K)},getPixelRatio:function(q){var Z=this.dimensions.times(this.getLevelScale(q)),X=1/Z.x,K=1/Z.y;return new G.Point(X,K)},getClosestLevel:function(){var G,q;for(G=this.minLevel+1;G<=this.maxLevel&&!((q=this.getNumTiles(G)).x>1||q.y>1);G++);return G-1},getTileAtPoint:function(q,Z){var X=Z.x>=0&&Z.x<=1&&Z.y>=0&&Z.y<=1/this.aspectRatio;G.console.assert(X,"[TileSource.getTileAtPoint] must be called with a valid point.");var K=this.dimensions.x*this.getLevelScale(q),Y=Z.x*K,Q=Z.y*K,J=Math.floor(Y/this.getTileWidth(q)),ee=Math.floor(Q/this.getTileHeight(q));return Z.x>=1&&(J=this.getNumTiles(q).x-1),Z.y>=1/this.aspectRatio-1e-15&&(ee=this.getNumTiles(q).y-1),new G.Point(J,ee)},getTileBounds:function(q,Z,X,K){var Y=this.dimensions.times(this.getLevelScale(q)),Q=this.getTileWidth(q),J=this.getTileHeight(q),ee=0===Z?0:Q*Z-this.tileOverlap,te=0===X?0:J*X-this.tileOverlap,ie=Q+(0===Z?1:2)*this.tileOverlap,ne=J+(0===X?1:2)*this.tileOverlap,oe=1/Y.x;return ie=Math.min(ie,Y.x-ee),ne=Math.min(ne,Y.y-te),K?new G.Rect(0,0,ie,ne):new G.Rect(ee*oe,te*oe,ie*oe,ne*oe)},getImageInfo:function(q){var Z,X,K,Y,Q,J,ee,te=this;q&&(ee=(J=(Q=q.split("/"))[Q.length-1]).lastIndexOf("."))>-1&&(Q[Q.length-1]=J.slice(0,ee)),X=function(Z){"string"==typeof Z&&(Z=G.parseXml(Z));var X=G.TileSource.determineType(te,Z,q);X?(void 0===(Y=X.prototype.configure.apply(te,[Z,q])).ajaxWithCredentials&&(Y.ajaxWithCredentials=te.ajaxWithCredentials),K=new X(Y),te.ready=!0,te.raiseEvent("ready",{tileSource:K})):te.raiseEvent("open-failed",{message:"Unable to load TileSource",source:q})},q.match(/\.js$/)?(Z=q.split("/").pop().replace(".js",""),G.jsonp({url:q,async:!1,callbackName:Z,callback:X})):G.makeAjaxRequest({url:q,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,success:function(q){var Z=function(q){var Z,X,K=q.responseText,Y=q.status;if(!q)throw new Error(G.getString("Errors.Security"));if(200!==q.status&&0!==q.status)throw Z=404==(Y=q.status)?"Not Found":q.statusText,new Error(G.getString("Errors.Status",Y,Z));if(K.match(/\s*<.*/))try{X=q.responseXML&&q.responseXML.documentElement?q.responseXML:G.parseXml(K)}catch(G){X=q.responseText}else if(K.match(/\s*[\{\[].*/))try{X=G.parseJSON(K)}catch(G){X=K}else X=K;return X}(q);X(Z)},error:function(G,Z){var X;try{X="HTTP "+G.status+" attempting to load TileSource"}catch(G){X=(void 0!==Z&&Z.toString?Z.toString():"Unknown error")+" attempting to load TileSource"}te.raiseEvent("open-failed",{message:X,source:q})}})},supports:function(G,q){return!1},configure:function(G,q){throw new Error("Method not implemented.")},getTileUrl:function(G,q,Z){throw new Error("Method not implemented.")},getTileAjaxHeaders:function(G,q,Z){return{}},tileExists:function(G,q,Z){var X=this.getNumTiles(G);return G>=this.minLevel&&G<=this.maxLevel&&q>=0&&Z>=0&&q<X.x&&Z<X.y}},G.extend(!0,G.TileSource.prototype,G.EventSource.prototype),G.TileSource.determineType=function(q,Z,X){var K;for(K in OpenSeadragon)if(K.match(/.+TileSource$/)&&G.isFunction(OpenSeadragon[K])&&G.isFunction(OpenSeadragon[K].prototype.supports)&&OpenSeadragon[K].prototype.supports.call(q,Z,X))return OpenSeadragon[K];G.console.error("No TileSource was able to open %s %s",X,Z)}}(OpenSeadragon),function(G){function t(q,Z){var X,K,Y=Z.Image,Q=Y.Url,J=Y.Format,ee=Y.Size,te=Y.DisplayRect||[],ie=parseInt(ee.Width,10),ne=parseInt(ee.Height,10),oe=parseInt(Y.TileSize,10),re=parseInt(Y.Overlap,10),se=[];for(K=0;K<te.length;K++)X=te[K].Rect,se.push(new G.DisplayRect(parseInt(X.X,10),parseInt(X.Y,10),parseInt(X.Width,10),parseInt(X.Height,10),parseInt(X.MinLevel,10),parseInt(X.MaxLevel,10)));return G.extend(!0,{width:ie,height:ne,tileSize:oe,tileOverlap:re,minLevel:null,maxLevel:null,tilesUrl:Q,fileFormat:J,displayRects:se},Z)}G.DziTileSource=function(q,Z,X,K,Y,Q,J,ee,te){var ie,ne,oe,re;if(re=G.isPlainObject(q)?q:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4],fileFormat:arguments[5],displayRects:arguments[6],minLevel:arguments[7],maxLevel:arguments[8]},this._levelRects={},this.tilesUrl=re.tilesUrl,this.fileFormat=re.fileFormat,this.displayRects=re.displayRects,this.displayRects)for(ie=this.displayRects.length-1;ie>=0;ie--)for(oe=(ne=this.displayRects[ie]).minLevel;oe<=ne.maxLevel;oe++)this._levelRects[oe]||(this._levelRects[oe]=[]),this._levelRects[oe].push(ne);G.TileSource.apply(this,[re])},G.extend(G.DziTileSource.prototype,G.TileSource.prototype,{supports:function(G,q){var Z;return G.Image?Z=G.Image.xmlns:G.documentElement&&("Image"!=G.documentElement.localName&&"Image"!=G.documentElement.tagName||(Z=G.documentElement.namespaceURI)),-1!==(Z=(Z||"").toLowerCase()).indexOf("schemas.microsoft.com/deepzoom/2008")||-1!==Z.indexOf("schemas.microsoft.com/deepzoom/2009")},configure:function(q,Z){var X;return X=G.isPlainObject(q)?t(this,q):function(q,Z){if(!Z||!Z.documentElement)throw new Error(G.getString("Errors.Xml"));var X,K,Y,Q,J,ee=Z.documentElement,te=ee.localName||ee.tagName,ie=Z.documentElement.namespaceURI,ne=null,oe=[];if("Image"==te)try{if(void 0===(Q=ee.getElementsByTagName("Size")[0])&&(Q=ee.getElementsByTagNameNS(ie,"Size")[0]),ne={Image:{xmlns:"http://schemas.microsoft.com/deepzoom/2008",Url:ee.getAttribute("Url"),Format:ee.getAttribute("Format"),DisplayRect:null,Overlap:parseInt(ee.getAttribute("Overlap"),10),TileSize:parseInt(ee.getAttribute("TileSize"),10),Size:{Height:parseInt(Q.getAttribute("Height"),10),Width:parseInt(Q.getAttribute("Width"),10)}}},!G.imageFormatSupported(ne.Image.Format))throw new Error(G.getString("Errors.ImageFormat",ne.Image.Format.toUpperCase()));for(void 0===(X=ee.getElementsByTagName("DisplayRect"))&&(X=ee.getElementsByTagNameNS(ie,"DisplayRect")[0]),J=0;J<X.length;J++)void 0===(Y=(K=X[J]).getElementsByTagName("Rect")[0])&&(Y=K.getElementsByTagNameNS(ie,"Rect")[0]),oe.push({Rect:{X:parseInt(Y.getAttribute("X"),10),Y:parseInt(Y.getAttribute("Y"),10),Width:parseInt(Y.getAttribute("Width"),10),Height:parseInt(Y.getAttribute("Height"),10),MinLevel:parseInt(K.getAttribute("MinLevel"),10),MaxLevel:parseInt(K.getAttribute("MaxLevel"),10)}});return oe.length&&(ne.Image.DisplayRect=oe),t(q,ne)}catch(q){throw q instanceof Error?q:new Error(G.getString("Errors.Dzi"))}else{if("Collection"==te)throw new Error(G.getString("Errors.Dzc"));if("Error"==te){var re=ee.getElementsByTagName("Message")[0].firstChild.nodeValue;throw new Error(re)}}throw new Error(G.getString("Errors.Dzi"))}(this,q),Z&&!X.tilesUrl&&(X.tilesUrl=Z.replace(/([^\/]+?)(\.(dzi|xml|js)?(\?[^\/]*)?)?\/?$/,"$1_files/"),-1!=Z.search(/\.(dzi|xml|js)\?/)?X.queryParams=Z.match(/\?.*/):X.queryParams=""),X},getTileUrl:function(G,q,Z){return[this.tilesUrl,G,"/",q,"_",Z,".",this.fileFormat,this.queryParams].join("")},tileExists:function(G,q,Z){var X,K,Y,Q,J,ee,te,ie=this._levelRects[G];if(this.minLevel&&G<this.minLevel||this.maxLevel&&G>this.maxLevel)return!1;if(!ie||!ie.length)return!0;for(te=ie.length-1;te>=0;te--)if(!(G<(X=ie[te]).minLevel||G>X.maxLevel)&&(K=this.getLevelScale(G),Y=X.x*K,Q=X.y*K,J=Y+X.width*K,ee=Q+X.height*K,Y=Math.floor(Y/this._tileWidth),Q=Math.floor(Q/this._tileWidth),J=Math.ceil(J/this._tileWidth),ee=Math.ceil(ee/this._tileWidth),Y<=q&&q<J&&Q<=Z&&Z<ee))return!0;return!1}})}(OpenSeadragon),function(G){G.IIIFTileSource=function(q){if(G.extend(!0,this,q),!(this.height&&this.width&&this["@id"]))throw new Error("IIIF required parameters not provided.");if(q.tileSizePerScaleFactor={},this.tile_width&&this.tile_height)q.tileWidth=this.tile_width,q.tileHeight=this.tile_height;else if(this.tile_width)q.tileSize=this.tile_width;else if(this.tile_height)q.tileSize=this.tile_height;else if(this.tiles)if(1==this.tiles.length)q.tileWidth=this.tiles[0].width,q.tileHeight=this.tiles[0].height||this.tiles[0].width,this.scale_factors=this.tiles[0].scaleFactors;else{this.scale_factors=[];for(var Z=0;Z<this.tiles.length;Z++)for(var X=0;X<this.tiles[Z].scaleFactors.length;X++){var K=this.tiles[Z].scaleFactors[X];this.scale_factors.push(K),q.tileSizePerScaleFactor[K]={width:this.tiles[Z].width,height:this.tiles[Z].height||this.tiles[Z].width}}}else if(te=q.profile,-1==["http://library.stanford.edu/iiif/image-api/compliance.html#level0","http://library.stanford.edu/iiif/image-api/1.1/compliance.html#level0","http://iiif.io/api/image/2/level0.json"].indexOf(te[0])||-1!=te.indexOf("sizeByW")){for(var Y=Math.min(this.height,this.width),Q=[256,512,1024],J=[],ee=0;ee<Q.length;ee++)Q[ee]<=Y&&J.push(Q[ee]);J.length>0?q.tileSize=Math.max.apply(null,J):q.tileSize=Y}else this.sizes&&this.sizes.length>0?(this.emulateLegacyImagePyramid=!0,q.levels=function(G){for(var q=[],Z=0;Z<G.sizes.length;Z++)q.push({url:G["@id"]+"/full/"+G.sizes[Z].width+",/0/default.jpg",width:G.sizes[Z].width,height:G.sizes[Z].height});return q.sort((function(G,q){return G.width-q.width}))}(this),G.extend(!0,q,{width:q.levels[q.levels.length-1].width,height:q.levels[q.levels.length-1].height,tileSize:Math.max(q.height,q.width),tileOverlap:0,minLevel:0,maxLevel:q.levels.length-1}),this.levels=q.levels):G.console.error("Nothing in the info.json to construct image pyramids from");var te;if(!q.maxLevel&&!this.emulateLegacyImagePyramid)if(this.scale_factors){var ie=Math.max.apply(null,this.scale_factors);q.maxLevel=Math.round(Math.log(ie)*Math.LOG2E)}else q.maxLevel=Number(Math.ceil(Math.log(Math.max(this.width,this.height),2)));G.TileSource.apply(this,[q])},G.extend(G.IIIFTileSource.prototype,G.TileSource.prototype,{supports:function(G,q){return!!(G.protocol&&"http://iiif.io/api/image"==G.protocol||G["@context"]&&("http://library.stanford.edu/iiif/image-api/1.1/context.json"==G["@context"]||"http://iiif.io/api/image/1/context.json"==G["@context"])||G.profile&&0===G.profile.indexOf("http://library.stanford.edu/iiif/image-api/compliance.html")||G.identifier&&G.width&&G.height||G.documentElement&&"info"==G.documentElement.tagName&&"http://library.stanford.edu/iiif/image-api/ns/"==G.documentElement.namespaceURI)},configure:function(q,Z){if(G.isPlainObject(q))return q["@context"]?q:(q["@context"]="http://iiif.io/api/image/1.0/context.json",q["@id"]=Z.replace("/info.json",""),q);var X=function(q){if(!q||!q.documentElement)throw new Error(G.getString("Errors.Xml"));var Z=q.documentElement,X=null;if("info"==Z.tagName)try{return function t(q,Z,X){var K,Y;if(3==q.nodeType&&X)(Y=q.nodeValue.trim()).match(/^\d*$/)&&(Y=Number(Y)),Z[X]?(G.isArray(Z[X])||(Z[X]=[Z[X]]),Z[X].push(Y)):Z[X]=Y;else if(1==q.nodeType)for(K=0;K<q.childNodes.length;K++)t(q.childNodes[K],Z,q.nodeName)}(Z,X={}),X}catch(q){throw q instanceof Error?q:new Error(G.getString("Errors.IIIF"))}throw new Error(G.getString("Errors.IIIF"))}(q);return X["@context"]="http://iiif.io/api/image/1.0/context.json",X["@id"]=Z.replace("/info.xml",""),X},getTileWidth:function(q){if(this.emulateLegacyImagePyramid)return G.TileSource.prototype.getTileWidth.call(this,q);var Z=Math.pow(2,this.maxLevel-q);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[Z]?this.tileSizePerScaleFactor[Z].width:this._tileWidth},getTileHeight:function(q){if(this.emulateLegacyImagePyramid)return G.TileSource.prototype.getTileHeight.call(this,q);var Z=Math.pow(2,this.maxLevel-q);return this.tileSizePerScaleFactor&&this.tileSizePerScaleFactor[Z]?this.tileSizePerScaleFactor[Z].height:this._tileHeight},getLevelScale:function(q){if(this.emulateLegacyImagePyramid){var Z=NaN;return this.levels.length>0&&q>=this.minLevel&&q<=this.maxLevel&&(Z=this.levels[q].width/this.levels[this.maxLevel].width),Z}return G.TileSource.prototype.getLevelScale.call(this,q)},getNumTiles:function(q){return this.emulateLegacyImagePyramid?this.getLevelScale(q)?new G.Point(1,1):new G.Point(0,0):G.TileSource.prototype.getNumTiles.call(this,q)},getTileAtPoint:function(q,Z){return this.emulateLegacyImagePyramid?new G.Point(0,0):G.TileSource.prototype.getTileAtPoint.call(this,q,Z)},getTileUrl:function(G,q,Z){if(this.emulateLegacyImagePyramid){var X=null;return this.levels.length>0&&G>=this.minLevel&&G<=this.maxLevel&&(X=this.levels[G].url),X}var K,Y,Q,J,ee,te,ie,ne,oe,re,se,ae=Math.pow(.5,this.maxLevel-G),le=Math.ceil(this.width*ae),he=Math.ceil(this.height*ae);return K=this.getTileWidth(G),Y=this.getTileHeight(G),Q=Math.ceil(K/ae),J=Math.ceil(Y/ae),se=this["@context"].indexOf("/1.0/context.json")>-1||this["@context"].indexOf("/1.1/context.json")>-1||this["@context"].indexOf("/1/context.json")>-1?"native.jpg":"default.jpg",le<K&&he<Y?(re=le+",",ee="full"):(te=q*Q,ie=Z*J,ne=Math.min(Q,this.width-te),oe=Math.min(J,this.height-ie),re=Math.ceil(ne*ae)+",",ee=[te,ie,ne,oe].join(",")),[this["@id"],ee,re,"0",se].join("/")}})}(OpenSeadragon),function(G){G.OsmTileSource=function(q,Z,X,K,Y){var Q;(Q=G.isPlainObject(q)?q:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]}).width&&Q.height||(Q.width=65572864,Q.height=65572864),Q.tileSize||(Q.tileSize=256,Q.tileOverlap=0),Q.tilesUrl||(Q.tilesUrl="http://tile.openstreetmap.org/"),Q.minLevel=8,G.TileSource.apply(this,[Q])},G.extend(G.OsmTileSource.prototype,G.TileSource.prototype,{supports:function(G,q){return G.type&&"openstreetmaps"==G.type},configure:function(G,q){return G},getTileUrl:function(G,q,Z){return this.tilesUrl+(G-8)+"/"+q+"/"+Z+".png"}})}(OpenSeadragon),function(G){G.TmsTileSource=function(q,Z,X,K,Y){var Q;Q=G.isPlainObject(q)?q:{width:arguments[0],height:arguments[1],tileSize:arguments[2],tileOverlap:arguments[3],tilesUrl:arguments[4]};var J,ee=256*Math.ceil(Q.width/256),te=256*Math.ceil(Q.height/256);J=ee>te?ee/256:te/256,Q.maxLevel=Math.ceil(Math.log(J)/Math.log(2))-1,Q.tileSize=256,Q.width=ee,Q.height=te,G.TileSource.apply(this,[Q])},G.extend(G.TmsTileSource.prototype,G.TileSource.prototype,{supports:function(G,q){return G.type&&"tiledmapservice"==G.type},configure:function(G,q){return G},getTileUrl:function(G,q,Z){var X=this.getNumTiles(G).y-1;return this.tilesUrl+G+"/"+q+"/"+(X-Z)+".png"}})}(OpenSeadragon),function(G){G.ZoomifyTileSource=function(G){G.tileSize=256;var q={x:G.width,y:G.height};for(G.imageSizes=[{x:G.width,y:G.height}],G.gridSize=[this._getGridSize(G.width,G.height,G.tileSize)];parseInt(q.x,10)>G.tileSize||parseInt(q.y,10)>G.tileSize;)q.x=Math.floor(q.x/2),q.y=Math.floor(q.y/2),G.imageSizes.push({x:q.x,y:q.y}),G.gridSize.push(this._getGridSize(q.x,q.y,G.tileSize));G.imageSizes.reverse(),G.gridSize.reverse(),G.minLevel=0,G.maxLevel=G.gridSize.length-1,OpenSeadragon.TileSource.apply(this,[G])},G.extend(G.ZoomifyTileSource.prototype,G.TileSource.prototype,{_getGridSize:function(G,q,Z){return{x:Math.ceil(G/Z),y:Math.ceil(q/Z)}},_calculateAbsoluteTileNumber:function(G,q,Z){for(var X=0,K={},Y=0;Y<G;Y++)X+=(K=this.gridSize[Y]).x*K.y;return X+((K=this.gridSize[G]).x*Z+q)},supports:function(G,q){return G.type&&"zoomifytileservice"==G.type},configure:function(G,q){return G},getTileUrl:function(G,q,Z){var X,K=this._calculateAbsoluteTileNumber(G,q,Z);return X=Math.floor(K/256),this.tilesUrl+"TileGroup"+X+"/"+G+"-"+q+"-"+Z+".jpg"}})}(OpenSeadragon),function(G){function t(G,q){return q.levels}G.LegacyTileSource=function(q){var Z,X,K;G.isArray(q)&&(Z={type:"legacy-image-pyramid",levels:q}),Z.levels=function(q){var Z,X,K=[];for(X=0;X<q.length;X++)(Z=q[X]).height&&Z.width&&Z.url?K.push({url:Z.url,width:Number(Z.width),height:Number(Z.height)}):G.console.error("Unsupported image format: %s",Z.url?Z.url:"<no URL>");return K.sort((function(G,q){return G.height-q.height}))}(Z.levels),Z.levels.length>0?(X=Z.levels[Z.levels.length-1].width,K=Z.levels[Z.levels.length-1].height):(X=0,K=0,G.console.error("No supported image formats found")),G.extend(!0,Z,{width:X,height:K,tileSize:Math.max(K,X),tileOverlap:0,minLevel:0,maxLevel:Z.levels.length>0?Z.levels.length-1:0}),G.TileSource.apply(this,[Z]),this.levels=Z.levels},G.extend(G.LegacyTileSource.prototype,G.TileSource.prototype,{supports:function(G,q){return G.type&&"legacy-image-pyramid"==G.type||G.documentElement&&"legacy-image-pyramid"==G.documentElement.getAttribute("type")},configure:function(q,Z){return G.isPlainObject(q)?t(this,q):function(q,Z){if(!Z||!Z.documentElement)throw new Error(G.getString("Errors.Xml"));var X,K,Y=Z.documentElement,Q=Y.tagName,J=null,ee=[];if("image"==Q)try{for(J={type:Y.getAttribute("type"),levels:[]},ee=Y.getElementsByTagName("level"),K=0;K<ee.length;K++)X=ee[K],J.levels.push({url:X.getAttribute("url"),width:parseInt(X.getAttribute("width"),10),height:parseInt(X.getAttribute("height"),10)});return t(q,J)}catch(G){throw G instanceof Error?G:new Error("Unknown error parsing Legacy Image Pyramid XML.")}else{if("collection"==Q)throw new Error("Legacy Image Pyramid Collections not yet supported.");if("error"==Q)throw new Error("Error: "+Z)}throw new Error("Unknown element "+Q)}(this,q)},getLevelScale:function(G){var q=NaN;return this.levels.length>0&&G>=this.minLevel&&G<=this.maxLevel&&(q=this.levels[G].width/this.levels[this.maxLevel].width),q},getNumTiles:function(q){return this.getLevelScale(q)?new G.Point(1,1):new G.Point(0,0)},getTileUrl:function(G,q,Z){var X=null;return this.levels.length>0&&G>=this.minLevel&&G<=this.maxLevel&&(X=this.levels[G].url),X}})}(OpenSeadragon),function(G){G.ImageTileSource=function(q){q=G.extend({buildPyramid:!0,crossOriginPolicy:!1,ajaxWithCredentials:!1,useCanvas:!0},q),G.TileSource.apply(this,[q])},G.extend(G.ImageTileSource.prototype,G.TileSource.prototype,{supports:function(G,q){return G.type&&"image"===G.type},configure:function(G,q){return G},getImageInfo:function(q){var Z=this._image=new Image,X=this;this.crossOriginPolicy&&(Z.crossOrigin=this.crossOriginPolicy),this.ajaxWithCredentials&&(Z.useCredentials=this.ajaxWithCredentials),G.addEvent(Z,"load",(function(){X.width=Object.prototype.hasOwnProperty.call(Z,"naturalWidth")?Z.naturalWidth:Z.width,X.height=Object.prototype.hasOwnProperty.call(Z,"naturalHeight")?Z.naturalHeight:Z.height,X.aspectRatio=X.width/X.height,X.dimensions=new G.Point(X.width,X.height),X._tileWidth=X.width,X._tileHeight=X.height,X.tileOverlap=0,X.minLevel=0,X.levels=X._buildLevels(),X.maxLevel=X.levels.length-1,X.ready=!0,X.raiseEvent("ready",{tileSource:X})})),G.addEvent(Z,"error",(function(){X.raiseEvent("open-failed",{message:"Error loading image at "+q,source:q})})),Z.src=q},getLevelScale:function(G){var q=NaN;return G>=this.minLevel&&G<=this.maxLevel&&(q=this.levels[G].width/this.levels[this.maxLevel].width),q},getNumTiles:function(q){return this.getLevelScale(q)?new G.Point(1,1):new G.Point(0,0)},getTileUrl:function(G,q,Z){var X=null;return G>=this.minLevel&&G<=this.maxLevel&&(X=this.levels[G].url),X},getContext2D:function(G,q,Z){var X=null;return G>=this.minLevel&&G<=this.maxLevel&&(X=this.levels[G].context2D),X},_buildLevels:function(){var q=[{url:this._image.src,width:Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,height:Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height}];if(!this.buildPyramid||!G.supportsCanvas||!this.useCanvas)return delete this._image,q;var Z=Object.prototype.hasOwnProperty.call(this._image,"naturalWidth")?this._image.naturalWidth:this._image.width,X=Object.prototype.hasOwnProperty.call(this._image,"naturalHeight")?this._image.naturalHeight:this._image.height,K=document.createElement("canvas"),Y=K.getContext("2d");if(K.width=Z,K.height=X,Y.drawImage(this._image,0,0,Z,X),q[0].context2D=Y,delete this._image,G.isCanvasTainted(K))return q;for(;Z>=2&&X>=2;){Z=Math.floor(Z/2),X=Math.floor(X/2);var Q=document.createElement("canvas"),J=Q.getContext("2d");Q.width=Z,Q.height=X,J.drawImage(K,0,0,Z,X),q.splice(0,0,{context2D:J,width:Z,height:X}),K=Q,Y=J}return q}})}(OpenSeadragon),function(G){G.TileSourceCollection=function(q,Z,X,K){G.console.error("TileSourceCollection is deprecated; use World instead")}}(OpenSeadragon),function(G){function i(q,Z){q.element.disabled||(Z>=G.ButtonState.GROUP&&q.currentState==G.ButtonState.REST&&(!function(q){q.shouldFade=!1,q.imgGroup&&G.setElementOpacity(q.imgGroup,1,!0)}(q),q.currentState=G.ButtonState.GROUP),Z>=G.ButtonState.HOVER&&q.currentState==G.ButtonState.GROUP&&(q.imgHover&&(q.imgHover.style.visibility=""),q.currentState=G.ButtonState.HOVER),Z>=G.ButtonState.DOWN&&q.currentState==G.ButtonState.HOVER&&(q.imgDown&&(q.imgDown.style.visibility=""),q.currentState=G.ButtonState.DOWN))}function n(q,Z){q.element.disabled||(Z<=G.ButtonState.HOVER&&q.currentState==G.ButtonState.DOWN&&(q.imgDown&&(q.imgDown.style.visibility="hidden"),q.currentState=G.ButtonState.HOVER),Z<=G.ButtonState.GROUP&&q.currentState==G.ButtonState.HOVER&&(q.imgHover&&(q.imgHover.style.visibility="hidden"),q.currentState=G.ButtonState.GROUP),Z<=G.ButtonState.REST&&q.currentState==G.ButtonState.GROUP&&(!function(q){q.shouldFade=!0,q.fadeBeginTime=G.now()+q.fadeDelay,window.setTimeout((function(){!function t(q){G.requestAnimationFrame((function(){!function(q){var Z;q.shouldFade&&(Z=1-(G.now()-q.fadeBeginTime)/q.fadeLength,Z=Math.min(1,Z),Z=Math.max(0,Z),q.imgGroup&&G.setElementOpacity(q.imgGroup,Z,!0),Z>0&&t(q))}(q)}))}(q)}),q.fadeDelay)}(q),q.currentState=G.ButtonState.REST))}G.ButtonState={REST:0,GROUP:1,HOVER:2,DOWN:3},G.Button=function(q){var Z=this;G.EventSource.call(this),G.extend(!0,this,{tooltip:null,srcRest:null,srcGroup:null,srcHover:null,srcDown:null,clickTimeThreshold:G.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:G.DEFAULT_SETTINGS.clickDistThreshold,fadeDelay:0,fadeLength:2e3,onPress:null,onRelease:null,onClick:null,onEnter:null,onExit:null,onFocus:null,onBlur:null},q),this.element=q.element||G.makeNeutralElement("div"),q.element||(this.imgRest=G.makeTransparentImage(this.srcRest),this.imgGroup=G.makeTransparentImage(this.srcGroup),this.imgHover=G.makeTransparentImage(this.srcHover),this.imgDown=G.makeTransparentImage(this.srcDown),this.imgRest.alt=this.imgGroup.alt=this.imgHover.alt=this.imgDown.alt=this.tooltip,this.element.style.position="relative",G.setElementTouchActionNone(this.element),this.imgGroup.style.position=this.imgHover.style.position=this.imgDown.style.position="absolute",this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top="0px",this.imgGroup.style.left=this.imgHover.style.left=this.imgDown.style.left="0px",this.imgHover.style.visibility=this.imgDown.style.visibility="hidden",G.Browser.vendor==G.BROWSERS.FIREFOX&&G.Browser.version<3&&(this.imgGroup.style.top=this.imgHover.style.top=this.imgDown.style.top=""),this.element.appendChild(this.imgRest),this.element.appendChild(this.imgGroup),this.element.appendChild(this.imgHover),this.element.appendChild(this.imgDown)),this.addHandler("press",this.onPress),this.addHandler("release",this.onRelease),this.addHandler("click",this.onClick),this.addHandler("enter",this.onEnter),this.addHandler("exit",this.onExit),this.addHandler("focus",this.onFocus),this.addHandler("blur",this.onBlur),this.currentState=G.ButtonState.GROUP,this.fadeBeginTime=null,this.shouldFade=!1,this.element.style.display="inline-block",this.element.style.position="relative",this.element.title=this.tooltip,this.tracker=new G.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(q){q.insideElementPressed?(i(Z,G.ButtonState.DOWN),Z.raiseEvent("enter",{originalEvent:q.originalEvent})):q.buttonDownAny||i(Z,G.ButtonState.HOVER)},focusHandler:function(G){this.enterHandler(G),Z.raiseEvent("focus",{originalEvent:G.originalEvent})},exitHandler:function(q){n(Z,G.ButtonState.GROUP),q.insideElementPressed&&Z.raiseEvent("exit",{originalEvent:q.originalEvent})},blurHandler:function(G){this.exitHandler(G),Z.raiseEvent("blur",{originalEvent:G.originalEvent})},pressHandler:function(q){i(Z,G.ButtonState.DOWN),Z.raiseEvent("press",{originalEvent:q.originalEvent})},releaseHandler:function(q){q.insideElementPressed&&q.insideElementReleased?(n(Z,G.ButtonState.HOVER),Z.raiseEvent("release",{originalEvent:q.originalEvent})):q.insideElementPressed?n(Z,G.ButtonState.GROUP):i(Z,G.ButtonState.HOVER)},clickHandler:function(G){G.quick&&Z.raiseEvent("click",{originalEvent:G.originalEvent})},keyHandler:function(G){return 13!==G.keyCode||(Z.raiseEvent("click",{originalEvent:G.originalEvent}),Z.raiseEvent("release",{originalEvent:G.originalEvent}),!1)}}),n(this,G.ButtonState.REST)},G.extend(G.Button.prototype,G.EventSource.prototype,{notifyGroupEnter:function(){i(this,G.ButtonState.GROUP)},notifyGroupExit:function(){n(this,G.ButtonState.REST)},disable:function(){this.notifyGroupExit(),this.element.disabled=!0,G.setElementOpacity(this.element,.2,!0)},enable:function(){this.element.disabled=!1,G.setElementOpacity(this.element,1,!0),this.notifyGroupEnter()}})}(OpenSeadragon),function(G){G.ButtonGroup=function(q){G.extend(!0,this,{buttons:[],clickTimeThreshold:G.DEFAULT_SETTINGS.clickTimeThreshold,clickDistThreshold:G.DEFAULT_SETTINGS.clickDistThreshold,labelText:""},q);var Z,X=this.buttons.concat([]),K=this;if(this.element=q.element||G.makeNeutralElement("div"),!q.group)for(this.label=G.makeNeutralElement("label"),this.element.style.display="inline-block",this.element.appendChild(this.label),Z=0;Z<X.length;Z++)this.element.appendChild(X[Z].element);G.setElementTouchActionNone(this.element),this.tracker=new G.MouseTracker({element:this.element,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,enterHandler:function(G){var q;for(q=0;q<K.buttons.length;q++)K.buttons[q].notifyGroupEnter()},exitHandler:function(G){var q;if(!G.insideElementPressed)for(q=0;q<K.buttons.length;q++)K.buttons[q].notifyGroupExit()}})},G.ButtonGroup.prototype={emulateEnter:function(){this.tracker.enterHandler({eventSource:this.tracker})},emulateExit:function(){this.tracker.exitHandler({eventSource:this.tracker})}}}(OpenSeadragon),function(G){G.Rect=function(q,Z,X,K,Y){var Q,J;this.x="number"==typeof q?q:0,this.y="number"==typeof Z?Z:0,this.width="number"==typeof X?X:0,this.height="number"==typeof K?K:0,this.degrees="number"==typeof Y?Y:0,this.degrees=G.positiveModulo(this.degrees,360),this.degrees>=270?(Q=this.getTopRight(),this.x=Q.x,this.y=Q.y,J=this.height,this.height=this.width,this.width=J,this.degrees-=270):this.degrees>=180?(Q=this.getBottomRight(),this.x=Q.x,this.y=Q.y,this.degrees-=180):this.degrees>=90&&(Q=this.getBottomLeft(),this.x=Q.x,this.y=Q.y,J=this.height,this.height=this.width,this.width=J,this.degrees-=90)},G.Rect.fromSummits=function(q,Z,X){var K=q.distanceTo(Z),Y=q.distanceTo(X),Q=Z.minus(q),J=Math.atan(Q.y/Q.x);return Q.x<0?J+=Math.PI:Q.y<0&&(J+=2*Math.PI),new G.Rect(q.x,q.y,K,Y,J/Math.PI*180)},G.Rect.prototype={clone:function(){return new G.Rect(this.x,this.y,this.width,this.height,this.degrees)},getAspectRatio:function(){return this.width/this.height},getTopLeft:function(){return new G.Point(this.x,this.y)},getBottomRight:function(){return new G.Point(this.x+this.width,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getTopRight:function(){return new G.Point(this.x+this.width,this.y).rotate(this.degrees,this.getTopLeft())},getBottomLeft:function(){return new G.Point(this.x,this.y+this.height).rotate(this.degrees,this.getTopLeft())},getCenter:function(){return new G.Point(this.x+this.width/2,this.y+this.height/2).rotate(this.degrees,this.getTopLeft())},getSize:function(){return new G.Point(this.width,this.height)},equals:function(q){return q instanceof G.Rect&&this.x===q.x&&this.y===q.y&&this.width===q.width&&this.height===q.height&&this.degrees===q.degrees},times:function(q){return new G.Rect(this.x*q,this.y*q,this.width*q,this.height*q,this.degrees)},translate:function(q){return new G.Rect(this.x+q.x,this.y+q.y,this.width,this.height,this.degrees)},union:function(q){var Z=this.getBoundingBox(),X=q.getBoundingBox(),K=Math.min(Z.x,X.x),Y=Math.min(Z.y,X.y),Q=Math.max(Z.x+Z.width,X.x+X.width),J=Math.max(Z.y+Z.height,X.y+X.height);return new G.Rect(K,Y,Q-K,J-Y)},intersection:function(q){var Z=1e-10,X=[],K=this.getTopLeft();q.containsPoint(K,Z)&&X.push(K);var Y=this.getTopRight();q.containsPoint(Y,Z)&&X.push(Y);var Q=this.getBottomLeft();q.containsPoint(Q,Z)&&X.push(Q);var J=this.getBottomRight();q.containsPoint(J,Z)&&X.push(J);var ee=q.getTopLeft();this.containsPoint(ee,Z)&&X.push(ee);var te=q.getTopRight();this.containsPoint(te,Z)&&X.push(te);var ie=q.getBottomLeft();this.containsPoint(ie,Z)&&X.push(ie);var ne=q.getBottomRight();this.containsPoint(ne,Z)&&X.push(ne);for(var oe=this._getSegments(),re=q._getSegments(),se=0;se<oe.length;se++)for(var ae=oe[se],le=0;le<re.length;le++){var he=re[le],ce=y(ae[0],ae[1],he[0],he[1]);ce&&X.push(ce)}function y(q,X,K,Y){var Q=X.minus(q),J=Y.minus(K),ee=-J.x*Q.y+Q.x*J.y;if(0===ee)return null;var te=(Q.x*(q.y-K.y)-Q.y*(q.x-K.x))/ee,ie=(J.x*(q.y-K.y)-J.y*(q.x-K.x))/ee;return-Z<=te&&te<=1-Z&&-Z<=ie&&ie<=1-Z?new G.Point(q.x+ie*Q.x,q.y+ie*Q.y):null}if(0===X.length)return null;for(var ue=X[0].x,de=X[0].x,pe=X[0].y,ge=X[0].y,me=1;me<X.length;me++){var ve=X[me];ve.x<ue&&(ue=ve.x),ve.x>de&&(de=ve.x),ve.y<pe&&(pe=ve.y),ve.y>ge&&(ge=ve.y)}return new G.Rect(ue,pe,de-ue,ge-pe)},_getSegments:function(){var G=this.getTopLeft(),q=this.getTopRight(),Z=this.getBottomLeft(),X=this.getBottomRight();return[[G,q],[q,X],[X,Z],[Z,G]]},rotate:function(q,Z){if(0===(q=G.positiveModulo(q,360)))return this.clone();Z=Z||this.getCenter();var X=this.getTopLeft().rotate(q,Z),K=this.getTopRight().rotate(q,Z).minus(X);K=K.apply((function(G){return Math.abs(G)<1e-15?0:G}));var Y=Math.atan(K.y/K.x);return K.x<0?Y+=Math.PI:K.y<0&&(Y+=2*Math.PI),new G.Rect(X.x,X.y,this.width,this.height,Y/Math.PI*180)},getBoundingBox:function(){if(0===this.degrees)return this.clone();var q=this.getTopLeft(),Z=this.getTopRight(),X=this.getBottomLeft(),K=this.getBottomRight(),Y=Math.min(q.x,Z.x,X.x,K.x),Q=Math.max(q.x,Z.x,X.x,K.x),J=Math.min(q.y,Z.y,X.y,K.y),ee=Math.max(q.y,Z.y,X.y,K.y);return new G.Rect(Y,J,Q-Y,ee-J)},getIntegerBoundingBox:function(){var q=this.getBoundingBox(),Z=Math.floor(q.x),X=Math.floor(q.y),K=Math.ceil(q.width+q.x-Z),Y=Math.ceil(q.height+q.y-X);return new G.Rect(Z,X,K,Y)},containsPoint:function(G,q){q=q||0;var Z=this.getTopLeft(),X=this.getTopRight(),K=this.getBottomLeft(),Y=X.minus(Z),Q=K.minus(Z);return(G.x-Z.x)*Y.x+(G.y-Z.y)*Y.y>=-q&&(G.x-X.x)*Y.x+(G.y-X.y)*Y.y<=q&&(G.x-Z.x)*Q.x+(G.y-Z.y)*Q.y>=-q&&(G.x-K.x)*Q.x+(G.y-K.y)*Q.y<=q},toString:function(){return"["+Math.round(100*this.x)/100+", "+Math.round(100*this.y)/100+", "+Math.round(100*this.width)/100+"x"+Math.round(100*this.height)/100+", "+Math.round(100*this.degrees)/100+"deg]"}}}(OpenSeadragon),function(G){var q={};function i(q){var Z=Number(this.element.style.marginLeft.replace("px","")),X=Number(this.element.style.marginTop.replace("px","")),K=Number(this.element.style.width.replace("px","")),Y=Number(this.element.style.height.replace("px","")),Q=G.getElementSize(this.viewer.canvas);return this.dragging=!0,this.element&&("horizontal"==this.scroll?-q.delta.x>0?Z>-(K-Q.x)&&(this.element.style.marginLeft=Z+2*q.delta.x+"px",o(this,Q.x,Z+2*q.delta.x)):-q.delta.x<0&&Z<0&&(this.element.style.marginLeft=Z+2*q.delta.x+"px",o(this,Q.x,Z+2*q.delta.x)):-q.delta.y>0?X>-(Y-Q.y)&&(this.element.style.marginTop=X+2*q.delta.y+"px",o(this,Q.y,X+2*q.delta.y)):-q.delta.y<0&&X<0&&(this.element.style.marginTop=X+2*q.delta.y+"px",o(this,Q.y,X+2*q.delta.y))),!1}function n(q){var Z=Number(this.element.style.marginLeft.replace("px","")),X=Number(this.element.style.marginTop.replace("px","")),K=Number(this.element.style.width.replace("px","")),Y=Number(this.element.style.height.replace("px","")),Q=G.getElementSize(this.viewer.canvas);return this.element&&("horizontal"==this.scroll?q.scroll>0?Z>-(K-Q.x)&&(this.element.style.marginLeft=Z-60*q.scroll+"px",o(this,Q.x,Z-60*q.scroll)):q.scroll<0&&Z<0&&(this.element.style.marginLeft=Z-60*q.scroll+"px",o(this,Q.x,Z-60*q.scroll)):q.scroll<0?X>Q.y-Y&&(this.element.style.marginTop=X+60*q.scroll+"px",o(this,Q.y,X+60*q.scroll)):q.scroll>0&&X<0&&(this.element.style.marginTop=X+60*q.scroll+"px",o(this,Q.y,X+60*q.scroll))),!1}function o(q,Z,X){var K,Y,Q,J,ee,te,ie;for(K="horizontal"==q.scroll?q.panelWidth:q.panelHeight,Y=Math.ceil(Z/K)+5,te=Y=(Y=(Q=Math.ceil((Math.abs(X)+Z)/K)+1)-Y)<0?0:Y;te<Q&&te<q.panels.length;te++)if(!(ie=q.panels[te]).activePanel){var ne,oe=q.viewer.tileSources[te];ne=oe.referenceStripThumbnailUrl?{type:"image",url:oe.referenceStripThumbnailUrl}:oe,(J=new G.Viewer({id:ie.id,tileSources:[ne],element:ie,navigatorSizeRatio:q.sizeRatio,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1,immediateRender:!0,blendTime:0,animationTime:0})).displayRegion=G.makeNeutralElement("div"),J.displayRegion.id=ie.id+"-displayregion",J.displayRegion.className="displayregion",(ee=J.displayRegion.style).position="relative",ee.top="0px",ee.left="0px",ee.fontSize="0px",ee.overflow="hidden",ee.float="left",ee.cssFloat="left",ee.styleFloat="left",ee.zIndex=999999999,ee.cursor="default",ee.width=q.panelWidth-4+"px",ee.height=q.panelHeight-4+"px",J.displayRegion.innerTracker=new G.MouseTracker({element:J.displayRegion,startDisabled:!0}),ie.getElementsByTagName("div")[0].appendChild(J.displayRegion),q.miniViewers[ie.id]=J,ie.activePanel=!0}}function r(G){var q=G.eventSource.element;return"horizontal"==this.scroll?q.style.marginBottom="0px":q.style.marginLeft="0px",!1}function s(q){var Z=q.eventSource.element;return"horizontal"==this.scroll?Z.style.marginBottom="-"+G.getElementSize(Z).y/2+"px":Z.style.marginLeft="-"+G.getElementSize(Z).x/2+"px",!1}function a(G){if(G.preventDefaultAction||G.ctrl||G.alt||G.meta)return!0;switch(G.keyCode){case 38:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 40:case 37:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 39:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}function l(G){if(G.preventDefaultAction||G.ctrl||G.alt||G.meta)return!0;switch(G.keyCode){case 61:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 45:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 48:case 119:case 87:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;case 115:case 83:case 97:return n.call(this,{eventSource:this.tracker,position:null,scroll:-1,shift:null}),!1;case 100:return n.call(this,{eventSource:this.tracker,position:null,scroll:1,shift:null}),!1;default:return!0}}G.ReferenceStrip=function(Z){var X,K,Y,Q=Z.viewer,J=G.getElementSize(Q.element);for(Z.id||(Z.id="referencestrip-"+G.now(),this.element=G.makeNeutralElement("div"),this.element.id=Z.id,this.element.className="referencestrip"),Z=G.extend(!0,{sizeRatio:G.DEFAULT_SETTINGS.referenceStripSizeRatio,position:G.DEFAULT_SETTINGS.referenceStripPosition,scroll:G.DEFAULT_SETTINGS.referenceStripScroll,clickTimeThreshold:G.DEFAULT_SETTINGS.clickTimeThreshold},Z,{element:this.element,showNavigator:!1,mouseNavEnabled:!1,showNavigationControl:!1,showSequenceControl:!1}),G.extend(this,Z),q[this.id]={animating:!1},this.minPixelRatio=this.viewer.minPixelRatio,(K=this.element.style).marginTop="0px",K.marginRight="0px",K.marginBottom="0px",K.marginLeft="0px",K.left="0px",K.bottom="0px",K.border="0px",K.background="#000",K.position="relative",G.setElementTouchActionNone(this.element),G.setElementOpacity(this.element,.8),this.viewer=Q,this.innerTracker=new G.MouseTracker({element:this.element,dragHandler:G.delegate(this,i),scrollHandler:G.delegate(this,n),enterHandler:G.delegate(this,r),exitHandler:G.delegate(this,s),keyDownHandler:G.delegate(this,a),keyHandler:G.delegate(this,l)}),Z.width&&Z.height?(this.element.style.width=Z.width+"px",this.element.style.height=Z.height+"px",Q.addControl(this.element,{anchor:G.ControlAnchor.BOTTOM_LEFT})):"horizontal"==Z.scroll?(this.element.style.width=J.x*Z.sizeRatio*Q.tileSources.length+12*Q.tileSources.length+"px",this.element.style.height=J.y*Z.sizeRatio+"px",Q.addControl(this.element,{anchor:G.ControlAnchor.BOTTOM_LEFT})):(this.element.style.height=J.y*Z.sizeRatio*Q.tileSources.length+12*Q.tileSources.length+"px",this.element.style.width=J.x*Z.sizeRatio+"px",Q.addControl(this.element,{anchor:G.ControlAnchor.TOP_LEFT})),this.panelWidth=J.x*this.sizeRatio+8,this.panelHeight=J.y*this.sizeRatio+8,this.panels=[],this.miniViewers={},Y=0;Y<Q.tileSources.length;Y++)(X=G.makeNeutralElement("div")).id=this.element.id+"-"+Y,X.style.width=this.panelWidth+"px",X.style.height=this.panelHeight+"px",X.style.display="inline",X.style.float="left",X.style.cssFloat="left",X.style.styleFloat="left",X.style.padding="2px",G.setElementTouchActionNone(X),X.innerTracker=new G.MouseTracker({element:X,clickTimeThreshold:this.clickTimeThreshold,clickDistThreshold:this.clickDistThreshold,pressHandler:function(q){q.eventSource.dragging=G.now()},releaseHandler:function(q){var Z=q.eventSource,X=Z.element.id,K=Number(X.split("-")[2]),Y=G.now();q.insideElementPressed&&q.insideElementReleased&&Z.dragging&&Y-Z.dragging<Z.clickTimeThreshold&&(Z.dragging=null,Q.goToPage(K))}}),this.element.appendChild(X),X.activePanel=!1,this.panels.push(X);o(this,"vertical"==this.scroll?J.y:J.x,0),this.setFocus(0)},G.extend(G.ReferenceStrip.prototype,G.EventSource.prototype,G.Viewer.prototype,{setFocus:function(q){var Z,X=G.getElement(this.element.id+"-"+q),K=G.getElementSize(this.viewer.canvas),Y=Number(this.element.style.width.replace("px","")),Q=Number(this.element.style.height.replace("px","")),J=-Number(this.element.style.marginLeft.replace("px","")),ee=-Number(this.element.style.marginTop.replace("px",""));this.currentSelected!==X&&(this.currentSelected&&(this.currentSelected.style.background="#000"),this.currentSelected=X,this.currentSelected.style.background="#999","horizontal"==this.scroll?(Z=Number(q)*(this.panelWidth+3))>J+K.x-this.panelWidth?(Z=Math.min(Z,Y-K.x),this.element.style.marginLeft=-Z+"px",o(this,K.x,-Z)):Z<J&&(Z=Math.max(0,Z-K.x/2),this.element.style.marginLeft=-Z+"px",o(this,K.x,-Z)):(Z=Number(q)*(this.panelHeight+3))>ee+K.y-this.panelHeight?(Z=Math.min(Z,Q-K.y),this.element.style.marginTop=-Z+"px",o(this,K.y,-Z)):Z<ee&&(Z=Math.max(0,Z-K.y/2),this.element.style.marginTop=-Z+"px",o(this,K.y,-Z)),this.currentPage=q,r.call(this,{eventSource:this.innerTracker}))},update:function(){return!!q[this.id].animating&&(G.console.log("image reference strip update"),!0)},destroy:function(){if(this.miniViewers)for(var G in this.miniViewers)this.miniViewers[G].destroy();this.element&&this.element.parentNode.removeChild(this.element)}})}(OpenSeadragon),function(G){G.DisplayRect=function(q,Z,X,K,Y,Q){G.Rect.apply(this,[q,Z,X,K]),this.minLevel=Y,this.maxLevel=Q},G.extend(G.DisplayRect.prototype,G.Rect.prototype)}(OpenSeadragon),function(G){G.Spring=function(q){var Z=arguments;"object"!=typeof q&&(q={initial:Z.length&&"number"==typeof Z[0]?Z[0]:void 0,springStiffness:Z.length>1?Z[1].springStiffness:5,animationTime:Z.length>1?Z[1].animationTime:1.5}),G.console.assert("number"==typeof q.springStiffness&&0!==q.springStiffness,"[OpenSeadragon.Spring] options.springStiffness must be a non-zero number"),G.console.assert("number"==typeof q.animationTime&&q.animationTime>=0,"[OpenSeadragon.Spring] options.animationTime must be a number greater than or equal to 0"),q.exponential&&(this._exponential=!0,delete q.exponential),G.extend(!0,this,q),this.current={value:"number"==typeof this.initial?this.initial:this._exponential?0:1,time:G.now()},G.console.assert(!this._exponential||0!==this.current.value,"[OpenSeadragon.Spring] value must be non-zero for exponential springs"),this.start={value:this.current.value,time:this.current.time},this.target={value:this.current.value,time:this.current.time},this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},G.Spring.prototype={resetTo:function(q){G.console.assert(!this._exponential||0!==q,"[OpenSeadragon.Spring.resetTo] target must be non-zero for exponential springs"),this.start.value=this.target.value=this.current.value=q,this.start.time=this.target.time=this.current.time=G.now(),this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},springTo:function(q){G.console.assert(!this._exponential||0!==q,"[OpenSeadragon.Spring.springTo] target must be non-zero for exponential springs"),this.start.value=this.current.value,this.start.time=this.current.time,this.target.value=q,this.target.time=this.start.time+1e3*this.animationTime,this._exponential&&(this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},shiftBy:function(q){this.start.value+=q,this.target.value+=q,this._exponential&&(G.console.assert(0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.shiftBy] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value))},setExponential:function(q){this._exponential=q,this._exponential&&(G.console.assert(0!==this.current.value&&0!==this.target.value&&0!==this.start.value,"[OpenSeadragon.Spring.setExponential] spring value must be non-zero for exponential springs"),this.start._logValue=Math.log(this.start.value),this.target._logValue=Math.log(this.target.value),this.current._logValue=Math.log(this.current.value))},update:function(){var q,Z;this.current.time=G.now(),this._exponential?(q=this.start._logValue,Z=this.target._logValue):(q=this.start.value,Z=this.target.value);var X,K,Y=this.current.time>=this.target.time?Z:q+(Z-q)*(X=this.springStiffness,K=(this.current.time-this.start.time)/(this.target.time-this.start.time),(1-Math.exp(X*-K))/(1-Math.exp(-X))),Q=this.current.value;return this._exponential?this.current.value=Math.exp(Y):this.current.value=Y,Q!=this.current.value},isAtTargetValue:function(){return this.current.value===this.target.value}}}(OpenSeadragon),function(G){function t(q){G.extend(!0,this,{timeout:G.DEFAULT_SETTINGS.timeout,jobId:null},q),this.image=null}t.prototype={errorMsg:null,start:function(){var q=this,Z=this.abort;this.image=new Image,this.image.onload=function(){q.finish(!0)},this.image.onabort=this.image.onerror=function(){q.errorMsg="Image load aborted",q.finish(!1)},this.jobId=window.setTimeout((function(){q.errorMsg="Image load exceeded timeout",q.finish(!1)}),this.timeout),this.loadWithAjax?(this.request=G.makeAjaxRequest({url:this.src,withCredentials:this.ajaxWithCredentials,headers:this.ajaxHeaders,responseType:"arraybuffer",success:function(G){var Z;try{Z=new window.Blob([G.response])}catch(q){var X=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder||window.MSBlobBuilder;if("TypeError"===q.name&&X){var K=new X;K.append(G.response),Z=K.getBlob()}}0===Z.size&&(q.errorMsg="Empty image response.",q.finish(!1));var Y=(window.URL||window.webkitURL).createObjectURL(Z);q.image.src=Y},error:function(G){q.errorMsg="Image load aborted - XHR error",q.finish(!1)}}),this.abort=function(){q.request.abort(),"function"==typeof Z&&Z()}):(!1!==this.crossOriginPolicy&&(this.image.crossOrigin=this.crossOriginPolicy),this.image.src=this.src)},finish:function(G){this.image.onload=this.image.onerror=this.image.onabort=null,G||(this.image=null),this.jobId&&window.clearTimeout(this.jobId),this.callback(this)}},G.ImageLoader=function(q){G.extend(!0,this,{jobLimit:G.DEFAULT_SETTINGS.imageLoaderLimit,timeout:G.DEFAULT_SETTINGS.timeout,jobQueue:[],jobsInProgress:0},q)},G.ImageLoader.prototype={addJob:function(G){var q=this,Z=new t({src:G.src,loadWithAjax:G.loadWithAjax,ajaxHeaders:G.loadWithAjax?G.ajaxHeaders:null,crossOriginPolicy:G.crossOriginPolicy,ajaxWithCredentials:G.ajaxWithCredentials,callback:function(Z){!function(G,q,Z){G.jobsInProgress--,(!G.jobLimit||G.jobsInProgress<G.jobLimit)&&G.jobQueue.length>0&&(G.jobQueue.shift().start(),G.jobsInProgress++),Z(q.image,q.errorMsg,q.request)}(q,Z,G.callback)},abort:G.abort,timeout:this.timeout});!this.jobLimit||this.jobsInProgress<this.jobLimit?(Z.start(),this.jobsInProgress++):this.jobQueue.push(Z)},clear:function(){for(var G=0;G<this.jobQueue.length;G++){var q=this.jobQueue[G];"function"==typeof q.abort&&q.abort()}this.jobQueue=[]}}}(OpenSeadragon),function(G){G.Tile=function(G,q,Z,X,K,Y,Q,J,ee,te){this.level=G,this.x=q,this.y=Z,this.bounds=X,this.sourceBounds=te,this.exists=K,this.url=Y,this.context2D=Q,this.loadWithAjax=J,this.ajaxHeaders=ee,this.ajaxHeaders?this.cacheKey=this.url+"+"+JSON.stringify(this.ajaxHeaders):this.cacheKey=this.url,this.loaded=!1,this.loading=!1,this.element=null,this.imgElement=null,this.image=null,this.style=null,this.position=null,this.size=null,this.blendStart=null,this.opacity=null,this.squaredDistance=null,this.visibility=null,this.beingDrawn=!1,this.lastTouchTime=0,this.isRightMost=!1,this.isBottomMost=!1},G.Tile.prototype={toString:function(){return this.level+"/"+this.x+"_"+this.y},_hasTransparencyChannel:function(){return!!this.context2D||this.url.match(".png")},drawHTML:function(q){this.cacheImageRecord?this.loaded?(this.element||(this.element=G.makeNeutralElement("div"),this.imgElement=this.cacheImageRecord.getImage().cloneNode(),this.imgElement.style.msInterpolationMode="nearest-neighbor",this.imgElement.style.width="100%",this.imgElement.style.height="100%",this.style=this.element.style,this.style.position="absolute"),this.element.parentNode!=q&&q.appendChild(this.element),this.imgElement.parentNode!=this.element&&this.element.appendChild(this.imgElement),this.style.top=this.position.y+"px",this.style.left=this.position.x+"px",this.style.height=this.size.y+"px",this.style.width=this.size.x+"px",G.setElementOpacity(this.element,this.opacity)):G.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString()):G.console.warn("[Tile.drawHTML] attempting to draw tile %s when it's not cached",this.toString())},drawCanvas:function(q,Z,X,K){var Y,Q,J,ee=this.position.times(G.pixelDensityRatio),te=this.size.times(G.pixelDensityRatio);this.context2D||this.cacheImageRecord?(Y=this.context2D||this.cacheImageRecord.getRenderedContext(),this.loaded&&Y?(q.save(),q.globalAlpha=this.opacity,"number"==typeof X&&1!==X&&(ee=ee.times(X),te=te.times(X)),K instanceof G.Point&&(ee=ee.plus(K)),1===q.globalAlpha&&this._hasTransparencyChannel()&&q.clearRect(ee.x,ee.y,te.x,te.y),Z({context:q,tile:this,rendered:Y}),this.sourceBounds?(Q=Math.min(this.sourceBounds.width,Y.canvas.width),J=Math.min(this.sourceBounds.height,Y.canvas.height)):(Q=Y.canvas.width,J=Y.canvas.height),q.drawImage(Y.canvas,0,0,Q,J,ee.x,ee.y,te.x,te.y),q.restore()):G.console.warn("Attempting to draw tile %s when it's not yet loaded.",this.toString())):G.console.warn("[Tile.drawCanvas] attempting to draw tile %s when it's not cached",this.toString())},getScaleForEdgeSmoothing:function(){var q;if(this.cacheImageRecord)q=this.cacheImageRecord.getRenderedContext();else{if(!this.context2D)return G.console.warn("[Tile.drawCanvas] attempting to get tile scale %s when tile's not cached",this.toString()),1;q=this.context2D}return q.canvas.width/(this.size.x*G.pixelDensityRatio)},getTranslationForEdgeSmoothing:function(q,Z,X){var K=Math.max(1,Math.ceil((X.x-Z.x)/2)),Y=Math.max(1,Math.ceil((X.y-Z.y)/2));return new G.Point(K,Y).minus(this.position.times(G.pixelDensityRatio).times(q||1).apply((function(G){return G%1})))},unload:function(){this.imgElement&&this.imgElement.parentNode&&this.imgElement.parentNode.removeChild(this.imgElement),this.element&&this.element.parentNode&&this.element.parentNode.removeChild(this.element),this.element=null,this.imgElement=null,this.loaded=!1,this.loading=!1}}}(OpenSeadragon),function(G){G.OverlayPlacement=G.Placement,G.OverlayRotationMode=G.freezeObject({NO_ROTATION:1,EXACT:2,BOUNDING_BOX:3}),G.Overlay=function(q,Z,X){var K;K=G.isPlainObject(q)?q:{element:q,location:Z,placement:X},this.element=K.element,this.style=K.element.style,this._init(K)},G.Overlay.prototype={_init:function(q){this.location=q.location,this.placement=void 0===q.placement?G.Placement.TOP_LEFT:q.placement,this.onDraw=q.onDraw,this.checkResize=void 0===q.checkResize||q.checkResize,this.width=void 0===q.width?null:q.width,this.height=void 0===q.height?null:q.height,this.rotationMode=q.rotationMode||G.OverlayRotationMode.EXACT,this.location instanceof G.Rect&&(this.width=this.location.width,this.height=this.location.height,this.location=this.location.getTopLeft(),this.placement=G.Placement.TOP_LEFT),this.scales=null!==this.width&&null!==this.height,this.bounds=new G.Rect(this.location.x,this.location.y,this.width,this.height),this.position=this.location},adjust:function(q,Z){var X=G.Placement.properties[this.placement];X&&(X.isHorizontallyCentered?q.x-=Z.x/2:X.isRight&&(q.x-=Z.x),X.isVerticallyCentered?q.y-=Z.y/2:X.isBottom&&(q.y-=Z.y))},destroy:function(){var q=this.element,Z=this.style;q.parentNode&&(q.parentNode.removeChild(q),q.prevElementParent&&(Z.display="none",document.body.appendChild(q))),this.onDraw=null,Z.top="",Z.left="",Z.position="",null!==this.width&&(Z.width=""),null!==this.height&&(Z.height="");var X=G.getCssPropertyWithVendorPrefix("transformOrigin"),K=G.getCssPropertyWithVendorPrefix("transform");X&&K&&(Z[X]="",Z[K]="")},drawHTML:function(q,Z){var X=this.element;X.parentNode!==q&&(X.prevElementParent=X.parentNode,X.prevNextSibling=X.nextSibling,q.appendChild(X),this.style.position="absolute",this.size=G.getElementSize(X));var K=this._getOverlayPositionAndSize(Z),Y=K.position,Q=this.size=K.size,J=K.rotate;if(this.onDraw)this.onDraw(Y,Q,this.element);else{var ee=this.style;ee.left=Y.x+"px",ee.top=Y.y+"px",null!==this.width&&(ee.width=Q.x+"px"),null!==this.height&&(ee.height=Q.y+"px");var te=G.getCssPropertyWithVendorPrefix("transformOrigin"),ie=G.getCssPropertyWithVendorPrefix("transform");te&&ie&&(J?(ee[te]=this._getTransformOrigin(),ee[ie]="rotate("+J+"deg)"):(ee[te]="",ee[ie]="")),"none"!==ee.display&&(ee.display="block")}},_getOverlayPositionAndSize:function(q){var Z=q.pixelFromPoint(this.location,!0),X=this._getSizeInPixels(q);this.adjust(Z,X);var K=0;if(q.degrees&&this.rotationMode!==G.OverlayRotationMode.NO_ROTATION)if(this.rotationMode===G.OverlayRotationMode.BOUNDING_BOX&&null!==this.width&&null!==this.height){var Y=new G.Rect(Z.x,Z.y,X.x,X.y),Q=this._getBoundingBox(Y,q.degrees);Z=Q.getTopLeft(),X=Q.getSize()}else K=q.degrees;return{position:Z,size:X,rotate:K}},_getSizeInPixels:function(q){var Z=this.size.x,X=this.size.y;if(null!==this.width||null!==this.height){var K=q.deltaPixelsFromPointsNoRotate(new G.Point(this.width||0,this.height||0),!0);null!==this.width&&(Z=K.x),null!==this.height&&(X=K.y)}if(this.checkResize&&(null===this.width||null===this.height)){var Y=this.size=G.getElementSize(this.element);null===this.width&&(Z=Y.x),null===this.height&&(X=Y.y)}return new G.Point(Z,X)},_getBoundingBox:function(G,q){var Z=this._getPlacementPoint(G);return G.rotate(q,Z).getBoundingBox()},_getPlacementPoint:function(q){var Z=new G.Point(q.x,q.y),X=G.Placement.properties[this.placement];return X&&(X.isHorizontallyCentered?Z.x+=q.width/2:X.isRight&&(Z.x+=q.width),X.isVerticallyCentered?Z.y+=q.height/2:X.isBottom&&(Z.y+=q.height)),Z},_getTransformOrigin:function(){var q="",Z=G.Placement.properties[this.placement];return Z?(Z.isLeft?q="left":Z.isRight&&(q="right"),Z.isTop?q+=" top":Z.isBottom&&(q+=" bottom"),q):q},update:function(q,Z){var X=G.isPlainObject(q)?q:{location:q,placement:Z};this._init({location:X.location||this.location,placement:void 0!==X.placement?X.placement:this.placement,onDraw:X.onDraw||this.onDraw,checkResize:X.checkResize||this.checkResize,width:void 0!==X.width?X.width:this.width,height:void 0!==X.height?X.height:this.height,rotationMode:X.rotationMode||this.rotationMode})},getBounds:function(q){G.console.assert(q,"A viewport must now be passed to Overlay.getBounds.");var Z=this.width,X=this.height;if(null===Z||null===X){var K=q.deltaPointsFromPixelsNoRotate(this.size,!0);null===Z&&(Z=K.x),null===X&&(X=K.y)}var Y=this.location.clone();return this.adjust(Y,new G.Point(Z,X)),this._adjustBoundsForRotation(q,new G.Rect(Y.x,Y.y,Z,X))},_adjustBoundsForRotation:function(q,Z){if(!q||0===q.degrees||this.rotationMode===G.OverlayRotationMode.EXACT)return Z;if(this.rotationMode===G.OverlayRotationMode.BOUNDING_BOX){if(null===this.width||null===this.height)return Z;var X=this._getOverlayPositionAndSize(q);return q.viewerElementToViewportRectangle(new G.Rect(X.position.x,X.position.y,X.size.x,X.size.y))}return Z.rotate(-q.degrees,this._getPlacementPoint(Z))}}}(OpenSeadragon),function(G){G.Drawer=function(q){G.console.assert(q.viewer,"[Drawer] options.viewer is required");var Z=arguments;if(G.isPlainObject(q)||(q={source:Z[0],viewport:Z[1],element:Z[2]}),G.console.assert(q.viewport,"[Drawer] options.viewport is required"),G.console.assert(q.element,"[Drawer] options.element is required"),q.source&&G.console.error("[Drawer] options.source is no longer accepted; use TiledImage instead"),this.viewer=q.viewer,this.viewport=q.viewport,this.debugGridColor="string"==typeof q.debugGridColor?[q.debugGridColor]:q.debugGridColor||G.DEFAULT_SETTINGS.debugGridColor,q.opacity&&G.console.error("[Drawer] options.opacity is no longer accepted; set the opacity on the TiledImage instead"),this.useCanvas=G.supportsCanvas&&(!this.viewer||this.viewer.useCanvas),this.container=G.getElement(q.element),this.canvas=G.makeNeutralElement(this.useCanvas?"canvas":"div"),this.context=this.useCanvas?this.canvas.getContext("2d"):null,this.sketchCanvas=null,this.sketchContext=null,this.element=this.container,this.container.dir="ltr",this.useCanvas){var X=this._calculateCanvasSize();this.canvas.width=X.x,this.canvas.height=X.y}this.canvas.style.width="100%",this.canvas.style.height="100%",this.canvas.style.position="absolute",G.setElementOpacity(this.canvas,this.opacity,!0),this.container.style.textAlign="left",this.container.appendChild(this.canvas)},G.Drawer.prototype={addOverlay:function(q,Z,X,K){return G.console.error("drawer.addOverlay is deprecated. Use viewer.addOverlay instead."),this.viewer.addOverlay(q,Z,X,K),this},updateOverlay:function(q,Z,X){return G.console.error("drawer.updateOverlay is deprecated. Use viewer.updateOverlay instead."),this.viewer.updateOverlay(q,Z,X),this},removeOverlay:function(q){return G.console.error("drawer.removeOverlay is deprecated. Use viewer.removeOverlay instead."),this.viewer.removeOverlay(q),this},clearOverlays:function(){return G.console.error("drawer.clearOverlays is deprecated. Use viewer.clearOverlays instead."),this.viewer.clearOverlays(),this},setOpacity:function(q){G.console.error("drawer.setOpacity is deprecated. Use tiledImage.setOpacity instead.");for(var Z=this.viewer.world,X=0;X<Z.getItemCount();X++)Z.getItemAt(X).setOpacity(q);return this},getOpacity:function(){G.console.error("drawer.getOpacity is deprecated. Use tiledImage.getOpacity instead.");for(var q=this.viewer.world,Z=0,X=0;X<q.getItemCount();X++){var K=q.getItemAt(X).getOpacity();K>Z&&(Z=K)}return Z},needsUpdate:function(){return G.console.error("[Drawer.needsUpdate] this function is deprecated. Use World.needsDraw instead."),this.viewer.world.needsDraw()},numTilesLoaded:function(){return G.console.error("[Drawer.numTilesLoaded] this function is deprecated. Use TileCache.numTilesLoaded instead."),this.viewer.tileCache.numTilesLoaded()},reset:function(){return G.console.error("[Drawer.reset] this function is deprecated. Use World.resetItems instead."),this.viewer.world.resetItems(),this},update:function(){return G.console.error("[Drawer.update] this function is deprecated. Use Drawer.clear and World.draw instead."),this.clear(),this.viewer.world.draw(),this},canRotate:function(){return this.useCanvas},destroy:function(){this.canvas.width=1,this.canvas.height=1,this.sketchCanvas=null,this.sketchContext=null},clear:function(){if(this.canvas.innerHTML="",this.useCanvas){var G=this._calculateCanvasSize();if((this.canvas.width!=G.x||this.canvas.height!=G.y)&&(this.canvas.width=G.x,this.canvas.height=G.y,null!==this.sketchCanvas)){var q=this._calculateSketchCanvasSize();this.sketchCanvas.width=q.x,this.sketchCanvas.height=q.y}this._clear()}},_clear:function(G,q){if(this.useCanvas){var Z=this._getContext(G);if(q)Z.clearRect(q.x,q.y,q.width,q.height);else{var X=Z.canvas;Z.clearRect(0,0,X.width,X.height)}}},viewportToDrawerRectangle:function(q){var Z=this.viewport.pixelFromPointNoRotate(q.getTopLeft(),!0),X=this.viewport.deltaPixelsFromPointsNoRotate(q.getSize(),!0);return new G.Rect(Z.x*G.pixelDensityRatio,Z.y*G.pixelDensityRatio,X.x*G.pixelDensityRatio,X.y*G.pixelDensityRatio)},drawTile:function(q,Z,X,K,Y){if(G.console.assert(q,"[Drawer.drawTile] tile is required"),G.console.assert(Z,"[Drawer.drawTile] drawingHandler is required"),this.useCanvas){var Q=this._getContext(X);K=K||1,q.drawCanvas(Q,Z,K,Y)}else q.drawHTML(this.canvas)},_getContext:function(G){var q=this.context;if(G){if(null===this.sketchCanvas){this.sketchCanvas=document.createElement("canvas");var Z=this._calculateSketchCanvasSize();if(this.sketchCanvas.width=Z.x,this.sketchCanvas.height=Z.y,this.sketchContext=this.sketchCanvas.getContext("2d"),0===this.viewport.getRotation()){var X=this;this.viewer.addHandler("rotate",(function e(){if(0!==X.viewport.getRotation()){X.viewer.removeHandler("rotate",e);var G=X._calculateSketchCanvasSize();X.sketchCanvas.width=G.x,X.sketchCanvas.height=G.y}}))}}q=this.sketchContext}return q},saveContext:function(G){this.useCanvas&&this._getContext(G).save()},restoreContext:function(G){this.useCanvas&&this._getContext(G).restore()},setClip:function(G,q){if(this.useCanvas){var Z=this._getContext(q);Z.beginPath(),Z.rect(G.x,G.y,G.width,G.height),Z.clip()}},drawRectangle:function(G,q,Z){if(this.useCanvas){var X=this._getContext(Z);X.save(),X.fillStyle=q,X.fillRect(G.x,G.y,G.width,G.height),X.restore()}},blendSketch:function(q,Z,X,K){var Y=q;if(G.isPlainObject(Y)||(Y={opacity:q,scale:Z,translate:X,compositeOperation:K}),this.useCanvas&&this.sketchCanvas){q=Y.opacity,K=Y.compositeOperation;var Q=Y.bounds;if(this.context.save(),this.context.globalAlpha=q,K&&(this.context.globalCompositeOperation=K),Q)Q.x<0&&(Q.width+=Q.x,Q.x=0),Q.x+Q.width>this.canvas.width&&(Q.width=this.canvas.width-Q.x),Q.y<0&&(Q.height+=Q.y,Q.y=0),Q.y+Q.height>this.canvas.height&&(Q.height=this.canvas.height-Q.y),this.context.drawImage(this.sketchCanvas,Q.x,Q.y,Q.width,Q.height,Q.x,Q.y,Q.width,Q.height);else{Z=Y.scale||1;var J=(X=Y.translate)instanceof G.Point?X:new G.Point(0,0),ee=0,te=0;if(X){var ie=this.sketchCanvas.width-this.canvas.width,ne=this.sketchCanvas.height-this.canvas.height;ee=Math.round(ie/2),te=Math.round(ne/2)}this.context.drawImage(this.sketchCanvas,J.x-ee*Z,J.y-te*Z,(this.canvas.width+2*ee)*Z,(this.canvas.height+2*te)*Z,-ee,-te,this.canvas.width+2*ee,this.canvas.height+2*te)}this.context.restore()}},drawDebugInfo:function(q,Z,X,K){if(this.useCanvas){var Y=this.viewer.world.getIndexOfItem(K)%this.debugGridColor.length,Q=this.context;Q.save(),Q.lineWidth=2*G.pixelDensityRatio,Q.font="small-caps bold "+13*G.pixelDensityRatio+"px arial",Q.strokeStyle=this.debugGridColor[Y],Q.fillStyle=this.debugGridColor[Y],0!==this.viewport.degrees?this._offsetForRotation({degrees:this.viewport.degrees}):this.viewer.viewport.flipped&&this._flip(),K.getRotation(!0)%360!=0&&this._offsetForRotation({degrees:K.getRotation(!0),point:K.viewport.pixelFromPointNoRotate(K._getRotationPoint(!0),!0)}),Q.strokeRect(q.position.x*G.pixelDensityRatio,q.position.y*G.pixelDensityRatio,q.size.x*G.pixelDensityRatio,q.size.y*G.pixelDensityRatio);var J=(q.position.x+q.size.x/2)*G.pixelDensityRatio,ee=(q.position.y+q.size.y/2)*G.pixelDensityRatio;Q.translate(J,ee),Q.rotate(Math.PI/180*-this.viewport.degrees),Q.translate(-J,-ee),0===q.x&&0===q.y&&(Q.fillText("Zoom: "+this.viewport.getZoom(),q.position.x*G.pixelDensityRatio,(q.position.y-30)*G.pixelDensityRatio),Q.fillText("Pan: "+this.viewport.getBounds().toString(),q.position.x*G.pixelDensityRatio,(q.position.y-20)*G.pixelDensityRatio)),Q.fillText("Level: "+q.level,(q.position.x+10)*G.pixelDensityRatio,(q.position.y+20)*G.pixelDensityRatio),Q.fillText("Column: "+q.x,(q.position.x+10)*G.pixelDensityRatio,(q.position.y+30)*G.pixelDensityRatio),Q.fillText("Row: "+q.y,(q.position.x+10)*G.pixelDensityRatio,(q.position.y+40)*G.pixelDensityRatio),Q.fillText("Order: "+X+" of "+Z,(q.position.x+10)*G.pixelDensityRatio,(q.position.y+50)*G.pixelDensityRatio),Q.fillText("Size: "+q.size.toString(),(q.position.x+10)*G.pixelDensityRatio,(q.position.y+60)*G.pixelDensityRatio),Q.fillText("Position: "+q.position.toString(),(q.position.x+10)*G.pixelDensityRatio,(q.position.y+70)*G.pixelDensityRatio),0!==this.viewport.degrees&&this._restoreRotationChanges(),K.getRotation(!0)%360!=0&&this._restoreRotationChanges(),Q.restore()}},debugRect:function(q){if(this.useCanvas){var Z=this.context;Z.save(),Z.lineWidth=2*G.pixelDensityRatio,Z.strokeStyle=this.debugGridColor[0],Z.fillStyle=this.debugGridColor[0],Z.strokeRect(q.x*G.pixelDensityRatio,q.y*G.pixelDensityRatio,q.width*G.pixelDensityRatio,q.height*G.pixelDensityRatio),Z.restore()}},getCanvasSize:function(q){var Z=this._getContext(q).canvas;return new G.Point(Z.width,Z.height)},getCanvasCenter:function(){return new G.Point(this.canvas.width/2,this.canvas.height/2)},_offsetForRotation:function(q){var Z=q.point?q.point.times(G.pixelDensityRatio):this.getCanvasCenter(),X=this._getContext(q.useSketch);X.save(),X.translate(Z.x,Z.y),this.viewer.viewport.flipped?(X.rotate(Math.PI/180*-q.degrees),X.scale(-1,1)):X.rotate(Math.PI/180*q.degrees),X.translate(-Z.x,-Z.y)},_flip:function(q){var Z=(q=q||{}).point?q.point.times(G.pixelDensityRatio):this.getCanvasCenter(),X=this._getContext(q.useSketch);X.translate(Z.x,0),X.scale(-1,1),X.translate(-Z.x,0)},_restoreRotationChanges:function(G){this._getContext(G).restore()},_calculateCanvasSize:function(){var q=G.pixelDensityRatio,Z=this.viewport.getContainerSize();return{x:Z.x*q,y:Z.y*q}},_calculateSketchCanvasSize:function(){var G=this._calculateCanvasSize();if(0===this.viewport.getRotation())return G;var q=Math.ceil(Math.sqrt(G.x*G.x+G.y*G.y));return{x:q,y:q}}}}(OpenSeadragon),function(G){G.Viewport=function(q){var Z=arguments;Z.length&&Z[0]instanceof G.Point&&(q={containerSize:Z[0],contentSize:Z[1],config:Z[2]}),q.config&&(G.extend(!0,q,q.config),delete q.config),this._margins=G.extend({left:0,top:0,right:0,bottom:0},q.margins||{}),delete q.margins,G.extend(!0,this,{containerSize:null,contentSize:null,zoomPoint:null,viewer:null,springStiffness:G.DEFAULT_SETTINGS.springStiffness,animationTime:G.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:G.DEFAULT_SETTINGS.minZoomImageRatio,maxZoomPixelRatio:G.DEFAULT_SETTINGS.maxZoomPixelRatio,visibilityRatio:G.DEFAULT_SETTINGS.visibilityRatio,wrapHorizontal:G.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:G.DEFAULT_SETTINGS.wrapVertical,defaultZoomLevel:G.DEFAULT_SETTINGS.defaultZoomLevel,minZoomLevel:G.DEFAULT_SETTINGS.minZoomLevel,maxZoomLevel:G.DEFAULT_SETTINGS.maxZoomLevel,degrees:G.DEFAULT_SETTINGS.degrees,flipped:G.DEFAULT_SETTINGS.flipped,homeFillsViewer:G.DEFAULT_SETTINGS.homeFillsViewer},q),this._updateContainerInnerSize(),this.centerSpringX=new G.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.centerSpringY=new G.Spring({initial:0,springStiffness:this.springStiffness,animationTime:this.animationTime}),this.zoomSpring=new G.Spring({exponential:!0,initial:1,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,this._setContentBounds(new G.Rect(0,0,1,1),1),this.goHome(!0),this.update()},G.Viewport.prototype={resetContentSize:function(q){return G.console.assert(q,"[Viewport.resetContentSize] contentSize is required"),G.console.assert(q instanceof G.Point,"[Viewport.resetContentSize] contentSize must be an OpenSeadragon.Point"),G.console.assert(q.x>0,"[Viewport.resetContentSize] contentSize.x must be greater than 0"),G.console.assert(q.y>0,"[Viewport.resetContentSize] contentSize.y must be greater than 0"),this._setContentBounds(new G.Rect(0,0,1,q.y/q.x),q.x),this},setHomeBounds:function(q,Z){G.console.error("[Viewport.setHomeBounds] this function is deprecated; The content bounds should not be set manually."),this._setContentBounds(q,Z)},_setContentBounds:function(q,Z){G.console.assert(q,"[Viewport._setContentBounds] bounds is required"),G.console.assert(q instanceof G.Rect,"[Viewport._setContentBounds] bounds must be an OpenSeadragon.Rect"),G.console.assert(q.width>0,"[Viewport._setContentBounds] bounds.width must be greater than 0"),G.console.assert(q.height>0,"[Viewport._setContentBounds] bounds.height must be greater than 0"),this._contentBoundsNoRotate=q.clone(),this._contentSizeNoRotate=this._contentBoundsNoRotate.getSize().times(Z),this._contentBounds=q.rotate(this.degrees).getBoundingBox(),this._contentSize=this._contentBounds.getSize().times(Z),this._contentAspectRatio=this._contentSize.x/this._contentSize.y,this.viewer&&this.viewer.raiseEvent("reset-size",{contentSize:this._contentSizeNoRotate.clone(),contentFactor:Z,homeBounds:this._contentBoundsNoRotate.clone(),contentBounds:this._contentBounds.clone()})},getHomeZoom:function(){if(this.defaultZoomLevel)return this.defaultZoomLevel;var G=this._contentAspectRatio/this.getAspectRatio();return(this.homeFillsViewer?G>=1?G:1:G>=1?1:G)/this._contentBounds.width},getHomeBounds:function(){return this.getHomeBoundsNoRotate().rotate(-this.getRotation())},getHomeBoundsNoRotate:function(){var q=this._contentBounds.getCenter(),Z=1/this.getHomeZoom(),X=Z/this.getAspectRatio();return new G.Rect(q.x-Z/2,q.y-X/2,Z,X)},goHome:function(G){return this.viewer&&this.viewer.raiseEvent("home",{immediately:G}),this.fitBounds(this.getHomeBounds(),G)},getMinZoom:function(){var G=this.getHomeZoom();return this.minZoomLevel?this.minZoomLevel:this.minZoomImageRatio*G},getMaxZoom:function(){var G=this.maxZoomLevel;return G||(G=this._contentSize.x*this.maxZoomPixelRatio/this._containerInnerSize.x,G/=this._contentBounds.width),Math.max(G,this.getHomeZoom())},getAspectRatio:function(){return this._containerInnerSize.x/this._containerInnerSize.y},getContainerSize:function(){return new G.Point(this.containerSize.x,this.containerSize.y)},getMargins:function(){return G.extend({},this._margins)},setMargins:function(q){G.console.assert("object"===G.type(q),"[Viewport.setMargins] margins must be an object"),this._margins=G.extend({left:0,top:0,right:0,bottom:0},q),this._updateContainerInnerSize(),this.viewer&&this.viewer.forceRedraw()},getBounds:function(G){return this.getBoundsNoRotate(G).rotate(-this.getRotation())},getBoundsNoRotate:function(q){var Z=this.getCenter(q),X=1/this.getZoom(q),K=X/this.getAspectRatio();return new G.Rect(Z.x-X/2,Z.y-K/2,X,K)},getBoundsWithMargins:function(G){return this.getBoundsNoRotateWithMargins(G).rotate(-this.getRotation(),this.getCenter(G))},getBoundsNoRotateWithMargins:function(G){var q=this.getBoundsNoRotate(G),Z=this._containerInnerSize.x*this.getZoom(G);return q.x-=this._margins.left/Z,q.y-=this._margins.top/Z,q.width+=(this._margins.left+this._margins.right)/Z,q.height+=(this._margins.top+this._margins.bottom)/Z,q},getCenter:function(q){var Z,X,K,Y,Q,J,ee=new G.Point(this.centerSpringX.current.value,this.centerSpringY.current.value),te=new G.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return q?ee:this.zoomPoint?(Z=this.pixelFromPoint(this.zoomPoint,!0),Y=(K=1/(X=this.getZoom()))/this.getAspectRatio(),Q=new G.Rect(ee.x-K/2,ee.y-Y/2,K,Y),J=this._pixelFromPoint(this.zoomPoint,Q).minus(Z).divide(this._containerInnerSize.x*X),te.plus(J)):te},getZoom:function(G){return G?this.zoomSpring.current.value:this.zoomSpring.target.value},_applyZoomConstraints:function(G){return Math.max(Math.min(G,this.getMaxZoom()),this.getMinZoom())},_applyBoundaryConstraints:function(q){var Z=new G.Rect(q.x,q.y,q.width,q.height);if(this.wrapHorizontal);else{var X=this.visibilityRatio*Z.width,K=Z.x+Z.width,Y=this._contentBoundsNoRotate.x+this._contentBoundsNoRotate.width,Q=this._contentBoundsNoRotate.x-K+X,J=Y-Z.x-X;X>this._contentBoundsNoRotate.width?Z.x+=(Q+J)/2:J<0?Z.x+=J:Q>0&&(Z.x+=Q)}if(this.wrapVertical);else{var ee=this.visibilityRatio*Z.height,te=Z.y+Z.height,ie=this._contentBoundsNoRotate.y+this._contentBoundsNoRotate.height,ne=this._contentBoundsNoRotate.y-te+ee,oe=ie-Z.y-ee;ee>this._contentBoundsNoRotate.height?Z.y+=(ne+oe)/2:oe<0?Z.y+=oe:ne>0&&(Z.y+=ne)}return Z},_raiseConstraintsEvent:function(G){this.viewer&&this.viewer.raiseEvent("constrain",{immediately:G})},applyConstraints:function(G){var q=this.getZoom(),Z=this._applyZoomConstraints(q);q!==Z&&this.zoomTo(Z,this.zoomPoint,G);var X=this.getBoundsNoRotate(),K=this._applyBoundaryConstraints(X);return this._raiseConstraintsEvent(G),(X.x!==K.x||X.y!==K.y||G)&&this.fitBounds(K.rotate(-this.getRotation()),G),this},ensureVisible:function(G){return this.applyConstraints(G)},_fitBounds:function(q,Z){var X=(Z=Z||{}).immediately||!1,K=Z.constraints||!1,Y=this.getAspectRatio(),Q=q.getCenter(),J=new G.Rect(q.x,q.y,q.width,q.height,q.degrees+this.getRotation()).getBoundingBox();J.getAspectRatio()>=Y?J.height=J.width/Y:J.width=J.height*Y,J.x=Q.x-J.width/2,J.y=Q.y-J.height/2;var ee=1/J.width;if(K){var te=J.getAspectRatio(),ie=this._applyZoomConstraints(ee);ee!==ie&&(ee=ie,J.width=1/ee,J.x=Q.x-J.width/2,J.height=J.width/te,J.y=Q.y-J.height/2),Q=(J=this._applyBoundaryConstraints(J)).getCenter(),this._raiseConstraintsEvent(X)}if(X)return this.panTo(Q,!0),this.zoomTo(ee,null,!0);this.panTo(this.getCenter(!0),!0),this.zoomTo(this.getZoom(!0),null,!0);var ne=this.getBounds(),oe=this.getZoom();if(0===oe||Math.abs(ee/oe-1)<1e-8)return this.zoomTo(ee,!0),this.panTo(Q,X);var re=(J=J.rotate(-this.getRotation())).getTopLeft().times(ee).minus(ne.getTopLeft().times(oe)).divide(ee-oe);return this.zoomTo(ee,re,X)},fitBounds:function(G,q){return this._fitBounds(G,{immediately:q,constraints:!1})},fitBoundsWithConstraints:function(G,q){return this._fitBounds(G,{immediately:q,constraints:!0})},fitVertically:function(q){var Z=new G.Rect(this._contentBounds.x+this._contentBounds.width/2,this._contentBounds.y,0,this._contentBounds.height);return this.fitBounds(Z,q)},fitHorizontally:function(q){var Z=new G.Rect(this._contentBounds.x,this._contentBounds.y+this._contentBounds.height/2,this._contentBounds.width,0);return this.fitBounds(Z,q)},getConstrainedBounds:function(G){var q;return q=this.getBounds(G),this._applyBoundaryConstraints(q)},panBy:function(q,Z){var X=new G.Point(this.centerSpringX.target.value,this.centerSpringY.target.value);return this.panTo(X.plus(q),Z)},panTo:function(G,q){return q?(this.centerSpringX.resetTo(G.x),this.centerSpringY.resetTo(G.y)):(this.centerSpringX.springTo(G.x),this.centerSpringY.springTo(G.y)),this.viewer&&this.viewer.raiseEvent("pan",{center:G,immediately:q}),this},zoomBy:function(G,q,Z){return this.zoomTo(this.zoomSpring.target.value*G,q,Z)},zoomTo:function(q,Z,X){var K=this;return this.zoomPoint=Z instanceof G.Point&&!isNaN(Z.x)&&!isNaN(Z.y)?Z:null,X?this._adjustCenterSpringsForZoomPoint((function(){K.zoomSpring.resetTo(q)})):this.zoomSpring.springTo(q),this.viewer&&this.viewer.raiseEvent("zoom",{zoom:q,refPoint:Z,immediately:X}),this},setRotation:function(q){return this.viewer&&this.viewer.drawer.canRotate()?(this.degrees=G.positiveModulo(q,360),this._setContentBounds(this.viewer.world.getHomeBounds(),this.viewer.world.getContentFactor()),this.viewer.forceRedraw(),this.viewer.raiseEvent("rotate",{degrees:q}),this):this},getRotation:function(){return this.degrees},resize:function(G,q){var Z,X=this.getBoundsNoRotate(),K=X;return this.containerSize.x=G.x,this.containerSize.y=G.y,this._updateContainerInnerSize(),q&&(Z=G.x/this.containerSize.x,K.width=X.width*Z,K.height=K.width/this.getAspectRatio()),this.viewer&&this.viewer.raiseEvent("resize",{newContainerSize:G,maintain:q}),this.fitBounds(K,!0)},_updateContainerInnerSize:function(){this._containerInnerSize=new G.Point(Math.max(1,this.containerSize.x-(this._margins.left+this._margins.right)),Math.max(1,this.containerSize.y-(this._margins.top+this._margins.bottom)))},update:function(){var G=this;this._adjustCenterSpringsForZoomPoint((function(){G.zoomSpring.update()})),this.centerSpringX.update(),this.centerSpringY.update();var q=this.centerSpringX.current.value!==this._oldCenterX||this.centerSpringY.current.value!==this._oldCenterY||this.zoomSpring.current.value!==this._oldZoom;return this._oldCenterX=this.centerSpringX.current.value,this._oldCenterY=this.centerSpringY.current.value,this._oldZoom=this.zoomSpring.current.value,q},_adjustCenterSpringsForZoomPoint:function(G){if(this.zoomPoint){var q=this.pixelFromPoint(this.zoomPoint,!0);G();var Z=this.pixelFromPoint(this.zoomPoint,!0).minus(q),X=this.deltaPointsFromPixels(Z,!0);this.centerSpringX.shiftBy(X.x),this.centerSpringY.shiftBy(X.y),this.zoomSpring.isAtTargetValue()&&(this.zoomPoint=null)}else G()},deltaPixelsFromPointsNoRotate:function(G,q){return G.times(this._containerInnerSize.x*this.getZoom(q))},deltaPixelsFromPoints:function(G,q){return this.deltaPixelsFromPointsNoRotate(G.rotate(this.getRotation()),q)},deltaPointsFromPixelsNoRotate:function(G,q){return G.divide(this._containerInnerSize.x*this.getZoom(q))},deltaPointsFromPixels:function(G,q){return this.deltaPointsFromPixelsNoRotate(G,q).rotate(-this.getRotation())},pixelFromPointNoRotate:function(G,q){return this._pixelFromPointNoRotate(G,this.getBoundsNoRotate(q))},pixelFromPoint:function(G,q){return this._pixelFromPoint(G,this.getBoundsNoRotate(q))},_pixelFromPointNoRotate:function(q,Z){return q.minus(Z.getTopLeft()).times(this._containerInnerSize.x/Z.width).plus(new G.Point(this._margins.left,this._margins.top))},_pixelFromPoint:function(G,q){return this._pixelFromPointNoRotate(G.rotate(this.getRotation(),this.getCenter(!0)),q)},pointFromPixelNoRotate:function(q,Z){var X=this.getBoundsNoRotate(Z);return q.minus(new G.Point(this._margins.left,this._margins.top)).divide(this._containerInnerSize.x/X.width).plus(X.getTopLeft())},pointFromPixel:function(G,q){return this.pointFromPixelNoRotate(G,q).rotate(-this.getRotation(),this.getCenter(!0))},_viewportToImageDelta:function(q,Z){var X=this._contentBoundsNoRotate.width;return new G.Point(q*this._contentSizeNoRotate.x/X,Z*this._contentSizeNoRotate.x/X)},viewportToImageCoordinates:function(q,Z){if(q instanceof G.Point)return this.viewportToImageCoordinates(q.x,q.y);if(this.viewer){var X=this.viewer.world.getItemCount();if(X>1)G.console.error("[Viewport.viewportToImageCoordinates] is not accurate with multi-image; use TiledImage.viewportToImageCoordinates instead.");else if(1===X)return this.viewer.world.getItemAt(0).viewportToImageCoordinates(q,Z,!0)}return this._viewportToImageDelta(q-this._contentBoundsNoRotate.x,Z-this._contentBoundsNoRotate.y)},_imageToViewportDelta:function(q,Z){var X=this._contentBoundsNoRotate.width;return new G.Point(q/this._contentSizeNoRotate.x*X,Z/this._contentSizeNoRotate.x*X)},imageToViewportCoordinates:function(q,Z){if(q instanceof G.Point)return this.imageToViewportCoordinates(q.x,q.y);if(this.viewer){var X=this.viewer.world.getItemCount();if(X>1)G.console.error("[Viewport.imageToViewportCoordinates] is not accurate with multi-image; use TiledImage.imageToViewportCoordinates instead.");else if(1===X)return this.viewer.world.getItemAt(0).imageToViewportCoordinates(q,Z,!0)}var K=this._imageToViewportDelta(q,Z);return K.x+=this._contentBoundsNoRotate.x,K.y+=this._contentBoundsNoRotate.y,K},imageToViewportRectangle:function(q,Z,X,K){var Y=q;if(Y instanceof G.Rect||(Y=new G.Rect(q,Z,X,K)),this.viewer){var Q=this.viewer.world.getItemCount();if(Q>1)G.console.error("[Viewport.imageToViewportRectangle] is not accurate with multi-image; use TiledImage.imageToViewportRectangle instead.");else if(1===Q)return this.viewer.world.getItemAt(0).imageToViewportRectangle(q,Z,X,K,!0)}var J=this.imageToViewportCoordinates(Y.x,Y.y),ee=this._imageToViewportDelta(Y.width,Y.height);return new G.Rect(J.x,J.y,ee.x,ee.y,Y.degrees)},viewportToImageRectangle:function(q,Z,X,K){var Y=q;if(Y instanceof G.Rect||(Y=new G.Rect(q,Z,X,K)),this.viewer){var Q=this.viewer.world.getItemCount();if(Q>1)G.console.error("[Viewport.viewportToImageRectangle] is not accurate with multi-image; use TiledImage.viewportToImageRectangle instead.");else if(1===Q)return this.viewer.world.getItemAt(0).viewportToImageRectangle(q,Z,X,K,!0)}var J=this.viewportToImageCoordinates(Y.x,Y.y),ee=this._viewportToImageDelta(Y.width,Y.height);return new G.Rect(J.x,J.y,ee.x,ee.y,Y.degrees)},viewerElementToImageCoordinates:function(G){var q=this.pointFromPixel(G,!0);return this.viewportToImageCoordinates(q)},imageToViewerElementCoordinates:function(G){var q=this.imageToViewportCoordinates(G);return this.pixelFromPoint(q,!0)},windowToImageCoordinates:function(q){G.console.assert(this.viewer,"[Viewport.windowToImageCoordinates] the viewport must have a viewer.");var Z=q.minus(G.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(Z)},imageToWindowCoordinates:function(q){return G.console.assert(this.viewer,"[Viewport.imageToWindowCoordinates] the viewport must have a viewer."),this.imageToViewerElementCoordinates(q).plus(G.getElementPosition(this.viewer.element))},viewerElementToViewportCoordinates:function(G){return this.pointFromPixel(G,!0)},viewportToViewerElementCoordinates:function(G){return this.pixelFromPoint(G,!0)},viewerElementToViewportRectangle:function(q){return G.Rect.fromSummits(this.pointFromPixel(q.getTopLeft(),!0),this.pointFromPixel(q.getTopRight(),!0),this.pointFromPixel(q.getBottomLeft(),!0))},viewportToViewerElementRectangle:function(q){return G.Rect.fromSummits(this.pixelFromPoint(q.getTopLeft(),!0),this.pixelFromPoint(q.getTopRight(),!0),this.pixelFromPoint(q.getBottomLeft(),!0))},windowToViewportCoordinates:function(q){G.console.assert(this.viewer,"[Viewport.windowToViewportCoordinates] the viewport must have a viewer.");var Z=q.minus(G.getElementPosition(this.viewer.element));return this.viewerElementToViewportCoordinates(Z)},viewportToWindowCoordinates:function(q){return G.console.assert(this.viewer,"[Viewport.viewportToWindowCoordinates] the viewport must have a viewer."),this.viewportToViewerElementCoordinates(q).plus(G.getElementPosition(this.viewer.element))},viewportToImageZoom:function(q){if(this.viewer){var Z=this.viewer.world.getItemCount();if(Z>1)G.console.error("[Viewport.viewportToImageZoom] is not accurate with multi-image.");else if(1===Z)return this.viewer.world.getItemAt(0).viewportToImageZoom(q)}var X=this._contentSizeNoRotate.x;return q*(this._containerInnerSize.x/X*this._contentBoundsNoRotate.width)},imageToViewportZoom:function(q){if(this.viewer){var Z=this.viewer.world.getItemCount();if(Z>1)G.console.error("[Viewport.imageToViewportZoom] is not accurate with multi-image.");else if(1===Z)return this.viewer.world.getItemAt(0).imageToViewportZoom(q)}return q*(this._contentSizeNoRotate.x/this._containerInnerSize.x/this._contentBoundsNoRotate.width)},toggleFlip:function(){return this.setFlip(!this.getFlip()),this},getFlip:function(){return this.flipped},setFlip:function(G){return this.flipped===G?this:(this.flipped=G,this.viewer.navigator&&this.viewer.navigator.setFlip(this.getFlip()),this.viewer.forceRedraw(),this.viewer.raiseEvent("flip",{flipped:G}),this)}}}(OpenSeadragon),function(G){function t(G,q,Z,X,K,Y,Q,J,ee){var te=Q.getBoundingBox().getTopLeft(),ie=Q.getBoundingBox().getBottomRight();G.viewer&&G.viewer.raiseEvent("update-level",{tiledImage:G,havedrawn:q,level:X,opacity:K,visibility:Y,drawArea:Q,topleft:te,bottomright:ie,currenttime:J,best:ee}),a(G.coverage,X),a(G.loadingCoverage,X);for(var ne=G._getCornerTiles(X,te,ie),oe=ne.topLeft,re=ne.bottomRight,se=G.source.getNumTiles(X),ae=G.viewport.pixelFromPoint(G.viewport.getCenter()),le=oe.x;le<=re.x;le++)for(var he=oe.y;he<=re.y;he++){if(!G.wrapHorizontal&&!G.wrapVertical){var ce=G.source.getTileBounds(X,le,he);if(null===Q.intersection(ce))continue}ee=i(G,Z,q,le,he,X,K,Y,ae,se,J,ee)}return ee}function i(q,Z,X,K,Y,Q,J,ee,te,ie,ne,oe){var re=function(q,Z,X,K,Y,Q,J,ee,te,ie){var ne,oe,re,se,ae,le,he,ce,ue;return Q[X]||(Q[X]={}),Q[X][q]||(Q[X][q]={}),Q[X][q][Z]||(ne=(ee.x+q%ee.x)%ee.x,oe=(ee.y+Z%ee.y)%ee.y,re=Y.getTileBounds(X,ne,oe),se=Y.getTileBounds(X,ne,oe,!0),ae=Y.tileExists(X,ne,oe),le=Y.getTileUrl(X,ne,oe),K.loadTilesWithAjax?(he=Y.getTileAjaxHeaders(X,ne,oe),G.isPlainObject(K.ajaxHeaders)&&(he=G.extend({},K.ajaxHeaders,he))):he=null,ce=Y.getContext2D?Y.getContext2D(X,ne,oe):void 0,re.x+=(q-ne)/ee.x,re.y+=ie/te*((Z-oe)/ee.y),ue=new G.Tile(X,q,Z,re,ae,le,ce,K.loadTilesWithAjax,he,se),ne===ee.x-1&&(ue.isRightMost=!0),oe===ee.y-1&&(ue.isBottomMost=!0),Q[X][q][Z]=ue),(ue=Q[X][q][Z]).lastTouchTime=J,ue}(K,Y,Q,q,q.source,q.tilesMatrix,ne,ie,q._worldWidthCurrent,q._worldHeightCurrent),se=X;q.viewer&&q.viewer.raiseEvent("update-tile",{tiledImage:q,tile:re}),s(q.coverage,Q,K,Y,!1);var ae=re.loaded||re.loading||r(q.loadingCoverage,Q,K,Y);if(s(q.loadingCoverage,Q,K,Y,ae),!re.exists)return oe;if(Z&&!se&&(r(q.coverage,Q,K,Y)?s(q.coverage,Q,K,Y,!0):se=!0),!se)return oe;if(function(q,Z,X,K,Y,Q){var J=q.bounds.getTopLeft();J.x*=Q._scaleSpring.current.value,J.y*=Q._scaleSpring.current.value,J.x+=Q._xSpring.current.value,J.y+=Q._ySpring.current.value;var ee=q.bounds.getSize();ee.x*=Q._scaleSpring.current.value,ee.y*=Q._scaleSpring.current.value;var te=X.pixelFromPointNoRotate(J,!0),ie=X.pixelFromPointNoRotate(J,!1),ne=X.deltaPixelsFromPointsNoRotate(ee,!0),oe=X.deltaPixelsFromPointsNoRotate(ee,!1),re=ie.plus(oe.divide(2)),se=K.squaredDistanceTo(re);Z||(ne=ne.plus(new G.Point(1,1))),q.isRightMost&&Q.wrapHorizontal&&(ne.x+=.75),q.isBottomMost&&Q.wrapVertical&&(ne.y+=.75),q.position=te,q.size=ne,q.squaredDistance=se,q.visibility=Y}(re,q.source.tileOverlap,q.viewport,te,ee,q),!re.loaded)if(re.context2D)n(q,re);else{var le=q._tileCache.getImageRecord(re.cacheKey);le&&n(q,re,le.getImage())}return re.loaded?function(G,q,Z,X,K,Y,Q){var J,ee,te=1e3*G.blendTime;if(q.blendStart||(q.blendStart=Q),J=Q-q.blendStart,ee=te?Math.min(1,J/te):1,G.alwaysBlend&&(ee*=Y),q.opacity=ee,G.lastDrawn.push(q),1==ee)s(G.coverage,K,Z,X,!0),G._hasOpaqueTile=!0;else if(J<te)return!0;return!1}(q,re,K,Y,Q,J,ne)&&(q._needsDraw=!0):re.loading?q._tilesLoading++:ae||(oe=function(G,q){return G?q.visibility>G.visibility?q:q.visibility==G.visibility&&q.squaredDistance<G.squaredDistance?q:G:q}(oe,re)),oe}function n(G,q,Z,X,K){var Y=0;function s(){return Y++,a}function a(){0==--Y&&(q.loading=!1,q.loaded=!0,q.context2D||G._tileCache.cacheTile({image:Z,tile:q,cutoff:X,tiledImage:G}),G._needsDraw=!0)}G.viewer.raiseEvent("tile-loaded",{tile:q,tiledImage:G,tileRequest:K,image:Z,getCompletionCallback:s}),s()()}function o(G,q,Z,X){var K,Y,Q,J;if(!G[q])return!1;if(void 0===Z||void 0===X){for(Q in K=G[q])if(K.hasOwnProperty(Q))for(J in Y=K[Q])if(Y.hasOwnProperty(J)&&!Y[J])return!1;return!0}return void 0===G[q][Z]||void 0===G[q][Z][X]||!0===G[q][Z][X]}function r(G,q,Z,X){return void 0===Z||void 0===X?o(G,q+1):o(G,q+1,2*Z,2*X)&&o(G,q+1,2*Z,2*X+1)&&o(G,q+1,2*Z+1,2*X)&&o(G,q+1,2*Z+1,2*X+1)}function s(q,Z,X,K,Y){q[Z]?(q[Z][X]||(q[Z][X]={}),q[Z][X][K]=Y):G.console.warn("Setting coverage for a tile before its level's coverage has been reset: %s",Z)}function a(G,q){G[q]={}}G.TiledImage=function(q){var Z=this;G.console.assert(q.tileCache,"[TiledImage] options.tileCache is required"),G.console.assert(q.drawer,"[TiledImage] options.drawer is required"),G.console.assert(q.viewer,"[TiledImage] options.viewer is required"),G.console.assert(q.imageLoader,"[TiledImage] options.imageLoader is required"),G.console.assert(q.source,"[TiledImage] options.source is required"),G.console.assert(!q.clip||q.clip instanceof G.Rect,"[TiledImage] options.clip must be an OpenSeadragon.Rect if present"),G.EventSource.call(this),this._tileCache=q.tileCache,delete q.tileCache,this._drawer=q.drawer,delete q.drawer,this._imageLoader=q.imageLoader,delete q.imageLoader,q.clip instanceof G.Rect&&(this._clip=q.clip.clone()),delete q.clip;var X=q.x||0;delete q.x;var K=q.y||0;delete q.y,this.normHeight=q.source.dimensions.y/q.source.dimensions.x,this.contentAspectX=q.source.dimensions.x/q.source.dimensions.y;var Y=1;q.width?(Y=q.width,delete q.width,q.height&&(G.console.error("specifying both width and height to a tiledImage is not supported"),delete q.height)):q.height&&(Y=q.height/this.normHeight,delete q.height);var Q=q.fitBounds;delete q.fitBounds;var J=q.fitBoundsPlacement||OpenSeadragon.Placement.CENTER;delete q.fitBoundsPlacement;var ee=q.degrees||0;delete q.degrees,G.extend(!0,this,{viewer:null,tilesMatrix:{},coverage:{},loadingCoverage:{},lastDrawn:[],lastResetTime:0,_midDraw:!1,_needsDraw:!0,_hasOpaqueTile:!1,_tilesLoading:0,springStiffness:G.DEFAULT_SETTINGS.springStiffness,animationTime:G.DEFAULT_SETTINGS.animationTime,minZoomImageRatio:G.DEFAULT_SETTINGS.minZoomImageRatio,wrapHorizontal:G.DEFAULT_SETTINGS.wrapHorizontal,wrapVertical:G.DEFAULT_SETTINGS.wrapVertical,immediateRender:G.DEFAULT_SETTINGS.immediateRender,blendTime:G.DEFAULT_SETTINGS.blendTime,alwaysBlend:G.DEFAULT_SETTINGS.alwaysBlend,minPixelRatio:G.DEFAULT_SETTINGS.minPixelRatio,smoothTileEdgesMinZoom:G.DEFAULT_SETTINGS.smoothTileEdgesMinZoom,iOSDevice:G.DEFAULT_SETTINGS.iOSDevice,debugMode:G.DEFAULT_SETTINGS.debugMode,crossOriginPolicy:G.DEFAULT_SETTINGS.crossOriginPolicy,ajaxWithCredentials:G.DEFAULT_SETTINGS.ajaxWithCredentials,placeholderFillStyle:G.DEFAULT_SETTINGS.placeholderFillStyle,opacity:G.DEFAULT_SETTINGS.opacity,preload:G.DEFAULT_SETTINGS.preload,compositeOperation:G.DEFAULT_SETTINGS.compositeOperation},q),this._preload=this.preload,delete this.preload,this._fullyLoaded=!1,this._xSpring=new G.Spring({initial:X,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._ySpring=new G.Spring({initial:K,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._scaleSpring=new G.Spring({initial:Y,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._degreesSpring=new G.Spring({initial:ee,springStiffness:this.springStiffness,animationTime:this.animationTime}),this._updateForScale(),Q&&this.fitBounds(Q,J,!0),this._drawingHandler=function(q){Z.viewer.raiseEvent("tile-drawing",G.extend({tiledImage:Z},q))}},G.extend(G.TiledImage.prototype,G.EventSource.prototype,{needsDraw:function(){return this._needsDraw},getFullyLoaded:function(){return this._fullyLoaded},_setFullyLoaded:function(G){G!==this._fullyLoaded&&(this._fullyLoaded=G,this.raiseEvent("fully-loaded-change",{fullyLoaded:this._fullyLoaded}))},reset:function(){this._tileCache.clearTilesFor(this),this.lastResetTime=G.now(),this._needsDraw=!0},update:function(){var G=this._xSpring.update(),q=this._ySpring.update(),Z=this._scaleSpring.update(),X=this._degreesSpring.update();return!!(G||q||Z||X)&&(this._updateForScale(),this._needsDraw=!0,!0)},draw:function(){0!==this.opacity||this._preload?(this._midDraw=!0,this._updateViewport(),this._midDraw=!1):this._needsDraw=!1},destroy:function(){this.reset()},getBounds:function(G){return this.getBoundsNoRotate(G).rotate(this.getRotation(G),this._getRotationPoint(G))},getBoundsNoRotate:function(q){return q?new G.Rect(this._xSpring.current.value,this._ySpring.current.value,this._worldWidthCurrent,this._worldHeightCurrent):new G.Rect(this._xSpring.target.value,this._ySpring.target.value,this._worldWidthTarget,this._worldHeightTarget)},getWorldBounds:function(){return G.console.error("[TiledImage.getWorldBounds] is deprecated; use TiledImage.getBounds instead"),this.getBounds()},getClippedBounds:function(q){var Z=this.getBoundsNoRotate(q);if(this._clip){var X=(q?this._worldWidthCurrent:this._worldWidthTarget)/this.source.dimensions.x,K=this._clip.times(X);Z=new G.Rect(Z.x+K.x,Z.y+K.y,K.width,K.height)}return Z.rotate(this.getRotation(q),this._getRotationPoint(q))},getContentSize:function(){return new G.Point(this.source.dimensions.x,this.source.dimensions.y)},_viewportToImageDelta:function(q,Z,X){var K=X?this._scaleSpring.current.value:this._scaleSpring.target.value;return new G.Point(q*(this.source.dimensions.x/K),Z*(this.source.dimensions.y*this.contentAspectX/K))},viewportToImageCoordinates:function(q,Z,X){var K;return q instanceof G.Point?(X=Z,K=q):K=new G.Point(q,Z),K=K.rotate(-this.getRotation(X),this._getRotationPoint(X)),X?this._viewportToImageDelta(K.x-this._xSpring.current.value,K.y-this._ySpring.current.value):this._viewportToImageDelta(K.x-this._xSpring.target.value,K.y-this._ySpring.target.value)},_imageToViewportDelta:function(q,Z,X){var K=X?this._scaleSpring.current.value:this._scaleSpring.target.value;return new G.Point(q/this.source.dimensions.x*K,Z/this.source.dimensions.y/this.contentAspectX*K)},imageToViewportCoordinates:function(q,Z,X){q instanceof G.Point&&(X=Z,Z=q.y,q=q.x);var K=this._imageToViewportDelta(q,Z);return X?(K.x+=this._xSpring.current.value,K.y+=this._ySpring.current.value):(K.x+=this._xSpring.target.value,K.y+=this._ySpring.target.value),K.rotate(this.getRotation(X),this._getRotationPoint(X))},imageToViewportRectangle:function(q,Z,X,K,Y){var Q=q;Q instanceof G.Rect?Y=Z:Q=new G.Rect(q,Z,X,K);var J=this.imageToViewportCoordinates(Q.getTopLeft(),Y),ee=this._imageToViewportDelta(Q.width,Q.height,Y);return new G.Rect(J.x,J.y,ee.x,ee.y,Q.degrees+this.getRotation(Y))},viewportToImageRectangle:function(q,Z,X,K,Y){var Q=q;q instanceof G.Rect?Y=Z:Q=new G.Rect(q,Z,X,K);var J=this.viewportToImageCoordinates(Q.getTopLeft(),Y),ee=this._viewportToImageDelta(Q.width,Q.height,Y);return new G.Rect(J.x,J.y,ee.x,ee.y,Q.degrees-this.getRotation(Y))},viewerElementToImageCoordinates:function(G){var q=this.viewport.pointFromPixel(G,!0);return this.viewportToImageCoordinates(q)},imageToViewerElementCoordinates:function(G){var q=this.imageToViewportCoordinates(G);return this.viewport.pixelFromPoint(q,!0)},windowToImageCoordinates:function(G){var q=G.minus(OpenSeadragon.getElementPosition(this.viewer.element));return this.viewerElementToImageCoordinates(q)},imageToWindowCoordinates:function(G){return this.imageToViewerElementCoordinates(G).plus(OpenSeadragon.getElementPosition(this.viewer.element))},_viewportToTiledImageRectangle:function(q){var Z=this._scaleSpring.current.value;return q=q.rotate(-this.getRotation(!0),this._getRotationPoint(!0)),new G.Rect((q.x-this._xSpring.current.value)/Z,(q.y-this._ySpring.current.value)/Z,q.width/Z,q.height/Z,q.degrees)},viewportToImageZoom:function(G){return this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x*G},imageToViewportZoom:function(G){return G/(this._scaleSpring.current.value*this.viewport._containerInnerSize.x/this.source.dimensions.x)},setPosition:function(G,q){var Z=this._xSpring.target.value===G.x&&this._ySpring.target.value===G.y;if(q){if(Z&&this._xSpring.current.value===G.x&&this._ySpring.current.value===G.y)return;this._xSpring.resetTo(G.x),this._ySpring.resetTo(G.y),this._needsDraw=!0}else{if(Z)return;this._xSpring.springTo(G.x),this._ySpring.springTo(G.y),this._needsDraw=!0}Z||this._raiseBoundsChange()},setWidth:function(G,q){this._setScale(G,q)},setHeight:function(G,q){this._setScale(G/this.normHeight,q)},fitBounds:function(q,Z,X){Z=Z||G.Placement.CENTER;var K=G.Placement.properties[Z],Y=this.contentAspectX,Q=0,J=0,ee=1,te=1;if(this._clip&&(Y=this._clip.getAspectRatio(),ee=this._clip.width/this.source.dimensions.x,te=this._clip.height/this.source.dimensions.y,q.getAspectRatio()>Y?(Q=this._clip.x/this._clip.height*q.height,J=this._clip.y/this._clip.height*q.height):(Q=this._clip.x/this._clip.width*q.width,J=this._clip.y/this._clip.width*q.width)),q.getAspectRatio()>Y){var ie=q.height/te,ne=0;K.isHorizontallyCentered?ne=(q.width-q.height*Y)/2:K.isRight&&(ne=q.width-q.height*Y),this.setPosition(new G.Point(q.x-Q+ne,q.y-J),X),this.setHeight(ie,X)}else{var oe=q.width/ee,re=0;K.isVerticallyCentered?re=(q.height-q.width/Y)/2:K.isBottom&&(re=q.height-q.width/Y),this.setPosition(new G.Point(q.x-Q,q.y-J+re),X),this.setWidth(oe,X)}},getClip:function(){return this._clip?this._clip.clone():null},setClip:function(q){G.console.assert(!q||q instanceof G.Rect,"[TiledImage.setClip] newClip must be an OpenSeadragon.Rect or null"),q instanceof G.Rect?this._clip=q.clone():this._clip=null,this._needsDraw=!0,this.raiseEvent("clip-change")},getOpacity:function(){return this.opacity},setOpacity:function(G){G!==this.opacity&&(this.opacity=G,this._needsDraw=!0,this.raiseEvent("opacity-change",{opacity:this.opacity}))},getPreload:function(){return this._preload},setPreload:function(G){this._preload=!!G,this._needsDraw=!0},getRotation:function(G){return G?this._degreesSpring.current.value:this._degreesSpring.target.value},setRotation:function(G,q){this._degreesSpring.target.value===G&&this._degreesSpring.isAtTargetValue()||(q?this._degreesSpring.resetTo(G):this._degreesSpring.springTo(G),this._needsDraw=!0,this._raiseBoundsChange())},_getRotationPoint:function(G){return this.getBoundsNoRotate(G).getCenter()},getCompositeOperation:function(){return this.compositeOperation},setCompositeOperation:function(G){G!==this.compositeOperation&&(this.compositeOperation=G,this._needsDraw=!0,this.raiseEvent("composite-operation-change",{compositeOperation:this.compositeOperation}))},_setScale:function(G,q){var Z=this._scaleSpring.target.value===G;if(q){if(Z&&this._scaleSpring.current.value===G)return;this._scaleSpring.resetTo(G),this._updateForScale(),this._needsDraw=!0}else{if(Z)return;this._scaleSpring.springTo(G),this._updateForScale(),this._needsDraw=!0}Z||this._raiseBoundsChange()},_updateForScale:function(){this._worldWidthTarget=this._scaleSpring.target.value,this._worldHeightTarget=this.normHeight*this._scaleSpring.target.value,this._worldWidthCurrent=this._scaleSpring.current.value,this._worldHeightCurrent=this.normHeight*this._scaleSpring.current.value},_raiseBoundsChange:function(){this.raiseEvent("bounds-change")},_isBottomItem:function(){return this.viewer.world.getItemAt(0)===this},_getLevelsInterval:function(){var G=Math.max(this.source.minLevel,Math.floor(Math.log(this.minZoomImageRatio)/Math.log(2))),q=this.viewport.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(0),!0).x*this._scaleSpring.current.value,Z=Math.min(Math.abs(this.source.maxLevel),Math.abs(Math.floor(Math.log(q/this.minPixelRatio)/Math.log(2))));return Z=Math.max(Z,this.source.minLevel||0),{lowestLevel:G=Math.min(G,Z),highestLevel:Z}},_updateViewport:function(){for(this._needsDraw=!1,this._tilesLoading=0,this.loadingCoverage={};this.lastDrawn.length>0;)this.lastDrawn.pop().beingDrawn=!1;var q=this.viewport,Z=this._viewportToTiledImageRectangle(q.getBoundsWithMargins(!0));if(!this.wrapHorizontal&&!this.wrapVertical){var X=this._viewportToTiledImageRectangle(this.getClippedBounds(!0));if(null===(Z=Z.intersection(X)))return}for(var K=this._getLevelsInterval(),Y=K.lowestLevel,Q=K.highestLevel,J=null,ee=!1,te=G.now(),ie=Q;ie>=Y;ie--){var ne=!1,oe=q.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(ie),!0).x*this._scaleSpring.current.value;if(ie===Y||!ee&&oe>=this.minPixelRatio)ne=!0,ee=!0;else if(!ee)continue;var re=q.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(ie),!1).x*this._scaleSpring.current.value,se=q.deltaPixelsFromPointsNoRotate(this.source.getPixelRatio(Math.max(this.source.getClosestLevel(),0)),!1).x*this._scaleSpring.current.value,ae=this.immediateRender?1:se;if(J=t(this,ee,ne,ie,Math.min(1,(oe-.5)/.5),ae/Math.abs(ae-re),Z,te,J),o(this.coverage,ie))break}!function(q,Z){if(0!==q.opacity&&(0!==Z.length||q.placeholderFillStyle)){var X,K,Y,Q=Z[0];Q&&(X=q.opacity<1||q.compositeOperation&&"source-over"!==q.compositeOperation||!q._isBottomItem()&&Q._hasTransparencyChannel());var J,ee=q.viewport.getZoom(!0),te=q.viewportToImageZoom(ee);Z.length>1&&te>q.smoothTileEdgesMinZoom&&!q.iOSDevice&&q.getRotation(!0)%360==0&&G.supportsCanvas&&(X=!0,K=Q.getScaleForEdgeSmoothing(),Y=Q.getTranslationForEdgeSmoothing(K,q._drawer.getCanvasSize(!1),q._drawer.getCanvasSize(!0))),X&&(K||(J=q.viewport.viewportToViewerElementRectangle(q.getClippedBounds(!0)).getIntegerBoundingBox().times(G.pixelDensityRatio)),q._drawer._clear(!0,J)),K||(0!==q.viewport.degrees?q._drawer._offsetForRotation({degrees:q.viewport.degrees,useSketch:X}):q._drawer.viewer.viewport.flipped&&q._drawer._flip({}),q.getRotation(!0)%360!=0&&q._drawer._offsetForRotation({degrees:q.getRotation(!0),point:q.viewport.pixelFromPointNoRotate(q._getRotationPoint(!0),!0),useSketch:X}));var ie=!1;if(q._clip){q._drawer.saveContext(X);var ne=q.imageToViewportRectangle(q._clip,!0);ne=ne.rotate(-q.getRotation(!0),q._getRotationPoint(!0));var oe=q._drawer.viewportToDrawerRectangle(ne);K&&(oe=oe.times(K)),Y&&(oe=oe.translate(Y)),q._drawer.setClip(oe,X),ie=!0}if(q.placeholderFillStyle&&!1===q._hasOpaqueTile){var re=q._drawer.viewportToDrawerRectangle(q.getBounds(!0));K&&(re=re.times(K)),Y&&(re=re.translate(Y));var se;se="function"==typeof q.placeholderFillStyle?q.placeholderFillStyle(q,q._drawer.context):q.placeholderFillStyle,q._drawer.drawRectangle(re,se,X)}for(var ae=Z.length-1;ae>=0;ae--)Q=Z[ae],q._drawer.drawTile(Q,q._drawingHandler,X,K,Y),Q.beingDrawn=!0,q.viewer&&q.viewer.raiseEvent("tile-drawn",{tiledImage:q,tile:Q});ie&&q._drawer.restoreContext(X),K||(q.getRotation(!0)%360!=0&&q._drawer._restoreRotationChanges(X),0!==q.viewport.degrees?q._drawer._restoreRotationChanges(X):q._drawer.viewer.viewport.flipped&&q._drawer._flip({})),X&&(K&&(0!==q.viewport.degrees&&q._drawer._offsetForRotation({degrees:q.viewport.degrees,useSketch:!1}),q.getRotation(!0)%360!=0&&q._drawer._offsetForRotation({degrees:q.getRotation(!0),point:q.viewport.pixelFromPointNoRotate(q._getRotationPoint(!0),!0),useSketch:!1})),q._drawer.blendSketch({opacity:q.opacity,scale:K,translate:Y,compositeOperation:q.compositeOperation,bounds:J}),K&&(q.getRotation(!0)%360!=0&&q._drawer._restoreRotationChanges(!1),0!==q.viewport.degrees&&q._drawer._restoreRotationChanges(!1))),function(q,Z){if(q.debugMode)for(var X=Z.length-1;X>=0;X--){var K=Z[X];try{q._drawer.drawDebugInfo(K,Z.length,X,q)}catch(q){G.console.error(q)}}}(q,Z)}}(this,this.lastDrawn),J&&!J.context2D?(!function(q,Z,X){Z.loading=!0,q._imageLoader.addJob({src:Z.url,loadWithAjax:Z.loadWithAjax,ajaxHeaders:Z.ajaxHeaders,crossOriginPolicy:q.crossOriginPolicy,ajaxWithCredentials:q.ajaxWithCredentials,callback:function(K,Y,Q){!function(q,Z,X,K,Y,Q){if(!K)return G.console.log("Tile %s failed to load: %s - error: %s",Z,Z.url,Y),q.viewer.raiseEvent("tile-load-failed",{tile:Z,tiledImage:q,time:X,message:Y,tileRequest:Q}),Z.loading=!1,void(Z.exists=!1);if(X<q.lastResetTime)return G.console.log("Ignoring tile %s loaded before reset: %s",Z,Z.url),void(Z.loading=!1);var l=function(){var G=q.source.getClosestLevel();n(q,Z,K,G,Q)};q._midDraw?window.setTimeout(l,1):l()}(q,Z,X,K,Y,Q)},abort:function(){Z.loading=!1}})}(this,J,te),this._needsDraw=!0,this._setFullyLoaded(!1)):this._setFullyLoaded(0===this._tilesLoading)},_getCornerTiles:function(q,Z,X){var K,Y,Q,J;this.wrapHorizontal?(K=G.positiveModulo(Z.x,1),Y=G.positiveModulo(X.x,1)):(K=Math.max(0,Z.x),Y=Math.min(1,X.x));var ee=1/this.source.aspectRatio;this.wrapVertical?(Q=G.positiveModulo(Z.y,ee),J=G.positiveModulo(X.y,ee)):(Q=Math.max(0,Z.y),J=Math.min(ee,X.y));var te=this.source.getTileAtPoint(q,new G.Point(K,Q)),ie=this.source.getTileAtPoint(q,new G.Point(Y,J)),ne=this.source.getNumTiles(q);return this.wrapHorizontal&&(te.x+=ne.x*Math.floor(Z.x),ie.x+=ne.x*Math.floor(X.x)),this.wrapVertical&&(te.y+=ne.y*Math.floor(Z.y/ee),ie.y+=ne.y*Math.floor(X.y/ee)),{topLeft:te,bottomRight:ie}}})}(OpenSeadragon),function(G){var t=function(q){G.console.assert(q,"[ImageRecord] options is required"),G.console.assert(q.image,"[ImageRecord] options.image is required"),this._image=q.image,this._tiles=[]};t.prototype={destroy:function(){this._image=null,this._renderedContext=null,this._tiles=null},getImage:function(){return this._image},getRenderedContext:function(){if(!this._renderedContext){var G=document.createElement("canvas");G.width=this._image.width,G.height=this._image.height,this._renderedContext=G.getContext("2d"),this._renderedContext.drawImage(this._image,0,0),this._image=null}return this._renderedContext},setRenderedContext:function(q){G.console.error("ImageRecord.setRenderedContext is deprecated. The rendered context should be created by the ImageRecord itself when calling ImageRecord.getRenderedContext."),this._renderedContext=q},addTile:function(q){G.console.assert(q,"[ImageRecord.addTile] tile is required"),this._tiles.push(q)},removeTile:function(q){for(var Z=0;Z<this._tiles.length;Z++)if(this._tiles[Z]===q)return void this._tiles.splice(Z,1);G.console.warn("[ImageRecord.removeTile] trying to remove unknown tile",q)},getTileCount:function(){return this._tiles.length}},G.TileCache=function(q){q=q||{},this._maxImageCacheCount=q.maxImageCacheCount||G.DEFAULT_SETTINGS.maxImageCacheCount,this._tilesLoaded=[],this._imagesLoaded=[],this._imagesLoadedCount=0},G.TileCache.prototype={numTilesLoaded:function(){return this._tilesLoaded.length},cacheTile:function(q){G.console.assert(q,"[TileCache.cacheTile] options is required"),G.console.assert(q.tile,"[TileCache.cacheTile] options.tile is required"),G.console.assert(q.tile.cacheKey,"[TileCache.cacheTile] options.tile.cacheKey is required"),G.console.assert(q.tiledImage,"[TileCache.cacheTile] options.tiledImage is required");var Z=q.cutoff||0,X=this._tilesLoaded.length,K=this._imagesLoaded[q.tile.cacheKey];if(K||(G.console.assert(q.image,"[TileCache.cacheTile] options.image is required to create an ImageRecord"),K=this._imagesLoaded[q.tile.cacheKey]=new t({image:q.image}),this._imagesLoadedCount++),K.addTile(q.tile),q.tile.cacheImageRecord=K,this._imagesLoadedCount>this._maxImageCacheCount){for(var Y,Q,J,ee,te,ie,ne=null,oe=-1,re=null,se=this._tilesLoaded.length-1;se>=0;se--)(Y=(ie=this._tilesLoaded[se]).tile).level<=Z||Y.beingDrawn||(ne?(ee=Y.lastTouchTime,Q=ne.lastTouchTime,te=Y.level,J=ne.level,(ee<Q||ee==Q&&te>J)&&(ne=Y,oe=se,re=ie)):(ne=Y,oe=se,re=ie));ne&&oe>=0&&(this._unloadTile(re),X=oe)}this._tilesLoaded[X]=new function(q){G.console.assert(q,"[TileCache.cacheTile] options is required"),G.console.assert(q.tile,"[TileCache.cacheTile] options.tile is required"),G.console.assert(q.tiledImage,"[TileCache.cacheTile] options.tiledImage is required"),this.tile=q.tile,this.tiledImage=q.tiledImage}({tile:q.tile,tiledImage:q.tiledImage})},clearTilesFor:function(q){var Z;G.console.assert(q,"[TileCache.clearTilesFor] tiledImage is required");for(var X=0;X<this._tilesLoaded.length;++X)(Z=this._tilesLoaded[X]).tiledImage===q&&(this._unloadTile(Z),this._tilesLoaded.splice(X,1),X--)},getImageRecord:function(q){return G.console.assert(q,"[TileCache.getImageRecord] cacheKey is required"),this._imagesLoaded[q]},_unloadTile:function(q){G.console.assert(q,"[TileCache._unloadTile] tileRecord is required");var Z=q.tile,X=q.tiledImage;Z.unload(),Z.cacheImageRecord=null;var K=this._imagesLoaded[Z.cacheKey];K.removeTile(Z),K.getTileCount()||(K.destroy(),delete this._imagesLoaded[Z.cacheKey],this._imagesLoadedCount--),X.viewer.raiseEvent("tile-unloaded",{tile:Z,tiledImage:X})}}}(OpenSeadragon),function(G){G.World=function(q){var Z=this;G.console.assert(q.viewer,"[World] options.viewer is required"),G.EventSource.call(this),this.viewer=q.viewer,this._items=[],this._needsDraw=!1,this._autoRefigureSizes=!0,this._needsSizesFigured=!1,this._delegatedFigureSizes=function(G){Z._autoRefigureSizes?Z._figureSizes():Z._needsSizesFigured=!0},this._figureSizes()},G.extend(G.World.prototype,G.EventSource.prototype,{addItem:function(q,Z){if(G.console.assert(q,"[World.addItem] item is required"),G.console.assert(q instanceof G.TiledImage,"[World.addItem] only TiledImages supported at this time"),void 0!==(Z=Z||{}).index){var X=Math.max(0,Math.min(this._items.length,Z.index));this._items.splice(X,0,q)}else this._items.push(q);this._autoRefigureSizes?this._figureSizes():this._needsSizesFigured=!0,this._needsDraw=!0,q.addHandler("bounds-change",this._delegatedFigureSizes),q.addHandler("clip-change",this._delegatedFigureSizes),this.raiseEvent("add-item",{item:q})},getItemAt:function(q){return G.console.assert(void 0!==q,"[World.getItemAt] index is required"),this._items[q]},getIndexOfItem:function(q){return G.console.assert(q,"[World.getIndexOfItem] item is required"),G.indexOf(this._items,q)},getItemCount:function(){return this._items.length},setItemIndex:function(q,Z){G.console.assert(q,"[World.setItemIndex] item is required"),G.console.assert(void 0!==Z,"[World.setItemIndex] index is required");var X=this.getIndexOfItem(q);if(Z>=this._items.length)throw new Error("Index bigger than number of layers.");Z!==X&&-1!==X&&(this._items.splice(X,1),this._items.splice(Z,0,q),this._needsDraw=!0,this.raiseEvent("item-index-change",{item:q,previousIndex:X,newIndex:Z}))},removeItem:function(q){G.console.assert(q,"[World.removeItem] item is required");var Z=G.indexOf(this._items,q);-1!==Z&&(q.removeHandler("bounds-change",this._delegatedFigureSizes),q.removeHandler("clip-change",this._delegatedFigureSizes),q.destroy(),this._items.splice(Z,1),this._figureSizes(),this._needsDraw=!0,this._raiseRemoveItem(q))},removeAll:function(){var G,q;for(this.viewer._cancelPendingImages(),q=0;q<this._items.length;q++)(G=this._items[q]).removeHandler("bounds-change",this._delegatedFigureSizes),G.removeHandler("clip-change",this._delegatedFigureSizes),G.destroy();var Z=this._items;for(this._items=[],this._figureSizes(),this._needsDraw=!0,q=0;q<Z.length;q++)G=Z[q],this._raiseRemoveItem(G)},resetItems:function(){for(var G=0;G<this._items.length;G++)this._items[G].reset()},update:function(){for(var G=!1,q=0;q<this._items.length;q++)G=this._items[q].update()||G;return G},draw:function(){for(var G=0;G<this._items.length;G++)this._items[G].draw();this._needsDraw=!1},needsDraw:function(){for(var G=0;G<this._items.length;G++)if(this._items[G].needsDraw())return!0;return this._needsDraw},getHomeBounds:function(){return this._homeBounds.clone()},getContentFactor:function(){return this._contentFactor},setAutoRefigureSizes:function(G){this._autoRefigureSizes=G,G&this._needsSizesFigured&&(this._figureSizes(),this._needsSizesFigured=!1)},arrange:function(q){var Z,X=(q=q||{}).immediately||!1,K=q.layout||G.DEFAULT_SETTINGS.collectionLayout,Y=q.rows||G.DEFAULT_SETTINGS.collectionRows,Q=q.columns||G.DEFAULT_SETTINGS.collectionColumns,J=q.tileSize||G.DEFAULT_SETTINGS.collectionTileSize,ee=J+(q.tileMargin||G.DEFAULT_SETTINGS.collectionTileMargin);Z=!q.rows&&Q?Q:Math.ceil(this._items.length/Y);var te,ie,ne,oe,re,se=0,ae=0;this.setAutoRefigureSizes(!1);for(var le=0;le<this._items.length;le++)le&&le%Z==0&&("horizontal"===K?(ae+=ee,se=0):(se+=ee,ae=0)),oe=(ne=(ie=(te=this._items[le]).getBounds()).width>ie.height?J:J*(ie.width/ie.height))*(ie.height/ie.width),re=new G.Point(se+(J-ne)/2,ae+(J-oe)/2),te.setPosition(re,X),te.setWidth(ne,X),"horizontal"===K?se+=ee:ae+=ee;this.setAutoRefigureSizes(!0)},_figureSizes:function(){var q=this._homeBounds?this._homeBounds.clone():null,Z=this._contentSize?this._contentSize.clone():null,X=this._contentFactor||0;if(this._items.length){var K=this._items[0],Y=K.getBounds();this._contentFactor=K.getContentSize().x/Y.width;for(var Q=K.getClippedBounds().getBoundingBox(),J=Q.x,ee=Q.y,te=Q.x+Q.width,ie=Q.y+Q.height,ne=1;ne<this._items.length;ne++)Y=(K=this._items[ne]).getBounds(),this._contentFactor=Math.max(this._contentFactor,K.getContentSize().x/Y.width),Q=K.getClippedBounds().getBoundingBox(),J=Math.min(J,Q.x),ee=Math.min(ee,Q.y),te=Math.max(te,Q.x+Q.width),ie=Math.max(ie,Q.y+Q.height);this._homeBounds=new G.Rect(J,ee,te-J,ie-ee),this._contentSize=new G.Point(this._homeBounds.width*this._contentFactor,this._homeBounds.height*this._contentFactor)}else this._homeBounds=new G.Rect(0,0,1,1),this._contentSize=new G.Point(1,1),this._contentFactor=1;this._contentFactor===X&&this._homeBounds.equals(q)&&this._contentSize.equals(Z)||this.raiseEvent("metrics-change",{})},_raiseRemoveItem:function(G){this.raiseEvent("remove-item",{item:G})}})}(OpenSeadragon);