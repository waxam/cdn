import{LitElement as e,html as i,css as t}from"../../lit-element/lit-element.js";import"../es-global-bridge/es-global-bridge.js";class ImgPanZoom extends e{static get styles(){return[t`
        :host {
          display: block;
          position: relative;
          height: 500px;
        }
        #viewer {
          position: relative;
          height: 100%;
          width: 100%;
        }

        hexagon-loader {
          opacity: 0;
          display: block;
          transition: opacity 700ms;
          position: absolute;
          margin: auto;
          top: 0;
          left: 0;
          bottom: 0;
          right: 0;
          z-index: 1;
          height: 70px;
          width: 70px;
        }
        hexagon-loader[hidden] {
          display: none;
        }
        hexagon-loader[loading] {
          opacity: 1;
        }
      `]}render(){return i`
      <!-- Only preload regular images -->
      ${this.dzi?"":i`
            ${this.hideSpinner||this.loaded?"":i`
                  <hexagon-loader
                    ?loading=${this.loading||!this.loaded}
                    item-count="4"
                    size="small"
                  ></hexagon-loader>
                `}
            <img-loader
              loaded="${this.loaded}"
              @loaded-changed="${this.loadedChangedEvent}"
              ?loading="${this.loading}"
              @loading-changed="${this.loadingChangedEvent}"
              src="${this.src}"
              described-by="${this.describedBy||""}"
            ></img-loader>
          `}

      <!-- Openseadragon -->
      <div id="viewer"></div>
    `}static get tag(){return"img-pan-zoom"}static get properties(){return{src:{type:String},describedBy:{type:String,attribute:"described-by"},dzi:{type:Boolean},fadeIn:{type:Boolean,attribute:"fade-in"},loading:{type:Boolean},hideSpinner:{type:Boolean,attribute:"hide-spinner"},loaded:{type:Boolean},showNavigationControl:{type:Boolean,attribute:"show-navigation-control"},showNavigator:{type:Boolean,attribute:"show-navigator"},zoomPerClick:{type:Number,attribute:"zoom-per-click"},zoomPerScroll:{type:Number,attribute:"zoom-per-scroll"},animationTime:{type:Number,attribute:"animation-time"},navPrevNextWrap:{type:Boolean,attribute:"nav-prev-next-wrap"},showRotationControl:{type:Boolean,attribute:"show-rotation-control"},minZoomImageRatio:{type:Number,attribute:"min-zoom-image-ratio"},maxZoomPixelRatio:{type:Number,attribute:"max-zoom-pixel-ratio"},constrainDuringPan:{type:Boolean,attribute:"constrain-during-pan"},visibilityRatio:{type:Number,attribute:"visibility-ratio"}}}pathFromUrl(e){return e.substring(0,e.lastIndexOf("/")+1)}constructor(){super(),this.loading=!1,this.dzi=!1,this.fadeIn=!0,this.hideSpinner=!1,this.showNavigationControl=!1,this.showNavigator=!1,this.zoomPerClick=2,this.zoomPerScroll=1.2,this.animationTime=1.2,this.navPrevNextWrap=!1,this.showRotationControl=!1,this.minZoomImageRatio=1,this.maxZoomPixelRatio=1.1,this.constrainDuringPan=!1,this.visibilityRatio=1;let e=`${this.pathFromUrl(decodeURIComponent(import.meta.url))}lib/openseadragon/build/openseadragon/openseadragon.min.js`;window.addEventListener("es-bridge-openseadragon-loaded",this._openseadragonLoaded.bind(this)),window.ESGlobalBridge.requestAvailability(),window.ESGlobalBridge.instance.load("openseadragon",e),import("../hexagon-loader/hexagon-loader.js"),import("./lib/img-loader.js")}updated(e){e.forEach((e,i)=>{"loading"==i&&this.dispatchEvent(new CustomEvent("loading-changed",{detail:{value:this[i]}})),"loaded"==i&&(this._loadedChanged(this[i],e),this.dispatchEvent(new CustomEvent("loaded-changed",{detail:{value:this[i]}})))})}_openseadragonLoaded(){try{if(OpenSeadragon)this._initOpenSeadragon();else{let e=setInterval(()=>{console.log("OpenSeadragon",OpenSeadragon),OpenSeadragon&&(this._initOpenSeadragon(),clearInterval(e))},1)}}catch(e){console.warn(e)}}connectedCallback(){super.connectedCallback(),this.animationConfig={fade:{name:"fade-in-animation",node:this.shadowRoot.querySelector("#viewer")}},setTimeout(()=>{this.dzi&&this._initOpenSeadragon()},0)}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("es-bridge-openseadragon-loaded",this._openseadragonLoaded.bind(this))}_initOpenSeadragon(){setTimeout(()=>{var e=this.src;this.dzi||(e={type:"image",url:this.src,buildPyramid:!1}),this.viewer=new OpenSeadragon({element:this.shadowRoot.querySelector("#viewer"),visibilityRatio:this.visibilityRatio,constrainDuringPan:this.constrainDuringPan,showNavigationControl:this.showNavigationControl,showNavigator:this.showNavigator,zoomPerClick:this.zoomPerClick,zoomPerScroll:this.zoomPerScroll,animationTime:this.animationTime,navPrevNextWrap:this.navPrevNextWrap,showRotationControl:this.showRotationControl,minZoomImageRatio:this.minZoomImageRatio,maxZoomPixelRatio:this.maxZoomPixelRatio,tileSources:e}),this.init=!0},100)}destroy(){this.viewer.destroy()}zoomIn(){var e=this.viewer.viewport.getZoom()+.7;e<this.viewer.viewport.getMaxZoom()&&this.viewer.viewport.zoomTo(e)}zoomOut(){var e=this.viewer.viewport.getZoom(),i=this.viewer.viewport.getMinZoom(),t=e-.7;t>i?this.viewer.viewport.zoomTo(t):i!=e&&this.resetZoom()}resetZoom(){this.viewer.viewport.goHome()}_srcChanged(){this.dzi&&this.init&&this._addTiledImage()}loadedChangedEvent(e){this.loaded=e.detail.value,this.loaded&&(this.loading=!1)}loadingChangedEvent(e){this.loading=e.detail.value}_loadedChanged(){this.loaded&&(this.init?this._addImage():setTimeout(()=>{this._openseadragonLoaded()},100))}_addImage(){this.viewer.addSimpleImage({url:this.src,index:0,replace:!0})}_addTiledImage(){this.viewer.addTiledImage({tileSource:this.src,index:0,replace:!0})}}window.customElements.define(ImgPanZoom.tag,ImgPanZoom);export{ImgPanZoom};