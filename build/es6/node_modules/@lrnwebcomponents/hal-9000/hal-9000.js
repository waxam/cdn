import{html,PolymerElement}from"../../@polymer/polymer/polymer-element.js";import{ESGlobalBridge}from"../es-global-bridge/es-global-bridge.js";import{pathFromUrl}from"../../@polymer/polymer/lib/utils/resolve-url.js";class Hal9000 extends PolymerElement{static get template(){return html`
      <style>
        :host {
          display: block;
        }

        :host([hidden]) {
          display: none;
        }
        [hidden] {
          display: none;
        }
      </style>
      <slot></slot>
    `}static get properties(){return{commands:{name:"commands",type:"Object",value:{},observer:"_commandsChanged"},respondsTo:{name:"respondsTo",type:"String",value:"(hal)",observer:"_respondsToChanged"},debug:{name:"debug",type:"Boolean",value:!1,observer:"_debugChanged"},auto:{name:"auto",type:"Boolean",reflectToAttribute:!0,observer:"_autoChanged"},enabled:{name:"enabled",type:"Boolean",reflectToAttribute:!0,observer:"_enabledChanged"},pitch:{name:"pitch",type:"Number",reflectToAttribute:!0,value:.9},rate:{name:"rate",type:"Number",reflectToAttribute:!0,value:.9},language:{name:"language",type:"String",reflectToAttribute:!0,value:"en-US"}}}static get tag(){return"hal-9000"}constructor(){super();const location=`${pathFromUrl(decodeURIComponent(import.meta.url))}lib/annyang/annyang.min.js`;if(window.addEventListener("es-bridge-annyang-loaded",this._annyangLoaded.bind(this)),window.ESGlobalBridge.requestAvailability(),window.ESGlobalBridge.instance.load("annyang",location),void 0!==window.speechSynthesis){this.synth=window.speechSynthesis,this.voices=this.synth.getVoices();for(var i=0;i<this.voices.length;i++)this.voices[i].default&&(this.defaultVoice=this.voices[i].name)}}connectedCallback(){super.connectedCallback(),window.Hal9000=window.Hal9000||{},window.Hal9000.instance=this}clickObject(phrase){this.__text=phrase,this.commands[phrase].object.click(),this.commands[phrase].object.focus()}_commandsChanged(newValue){this.addCommands(newValue)}addCommands(commands){this.annyang&&this.annyang.addCommands(commands)}speak(text){this.__text=text,this.synth?(this.utter=new SpeechSynthesisUtterance(this.__text),this.utter.pitch=this.pitch,this.utter.rate=this.rate,this.utter.lang=this.language,this.utter.voice=this.defaultVoice,this.synth.speak(this.utter)):console.warn("I have no voice...")}_annyangLoaded(){if(this.annyang=window.annyang,this.annyang){this.annyang.addCommands(this.commands),this.annyang.debug(this.debug),this.auto?this.annyang.start({autoRestart:!0,continuous:!0}):this.enabled&&this.annyang.start();const evt=new CustomEvent("hal-9000-online",{bubbles:!0,cancelable:!1,detail:!0});this.dispatchEvent(evt)}}_respondsToChanged(newValue,oldValue){this.annyang&&this.annyang.removeCommands();var commands={};for(var i in this.commands)i.replace(oldValue,newValue)!==i?commands[i.replace(oldValue,newValue)]=this.commands[i]:commands[i]=this.commands[i];this.set("commands",commands)}_autoChanged(newValue){this.enabled=newValue}_enabledChanged(newValue){this.annyang&&(newValue?this.auto?this.annyang.start({autoRestart:!0,continuous:!0}):this.annyang.start():this.annyang.abort())}_debugChanged(newValue,oldValue){this.annyang&&this.annyang.debug(newValue)}disconnectedCallback(){window.removeEventListener("es-bridge-annyang-loaded",this._annyangLoaded.bind(this)),super.disconnectedCallback()}}window.customElements.define(Hal9000.tag,Hal9000);export{Hal9000};window.Hal9000=window.Hal9000||{},window.Hal9000.requestAvailability=()=>{window.Hal9000.instance||(window.Hal9000.instance=new Hal9000)};