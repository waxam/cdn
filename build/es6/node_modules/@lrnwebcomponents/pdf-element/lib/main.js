import{dom}from"@polymer/polymer/lib/legacy/polymer.dom.js";var _Mathround=Math.round,Reader=function(b){this.element=b,this.reader=dom(b.root).querySelector(".pdf-viewer"),this.viewportOut=this.reader.querySelector(".pdf-viewport-out"),this.element=this.reader.querySelector(".pdf-element"),this.container=this.reader.querySelector(".sidebar"),this.toolbar=this.reader.querySelector(".pdf-toolbar"),this.card=dom(b.root).querySelector(".style-scope"),this.toolbarHeight=0,this.title=this.toolbar.querySelector(".title"),this.enableTextSelection=b.enableTextSelection,this.fitWidth=b.fitWidth,this.HEIGHT=b.getAttribute("height"),this.WIDTH=b.getAttribute("width"),this.viewport=this.reader.querySelector(".pdf-viewport"),this.enableTextSelection&&(this.textLayerDiv=this.reader.querySelector(".textLayer"),this.textLayerDivStyle=this.textLayerDiv.style),this.spinner=this.reader.querySelector(".spinner"),this.totalPages=this.reader.querySelector("#totalPages"),this.viewportStyle=this.viewport.style,this.viewportOutStyle=this.viewportOut.style,this.ctx=this.viewport.getContext("2d"),this.SRC=b.src,this.pageRendering=!1,this.pageNumPending=null};Reader.prototype.setSize=function(b,c){this.WIDTH||(this.WIDTH=this.viewportOut.offsetWidth),this.HEIGHT||(this.HEIGHT=this.viewportOut.offsetHeight);var d=this.WIDTH,e=this.HEIGHT;"width"===b&&(d=c),"height"===b&&(e=c),this.viewportOutStyle.height=e+"px",this.spinner.style.top=(e-this.toolbarHeight)/2+"px"},Reader.prototype.setSrc=function(b){this.SRC=b},Reader.prototype.setFitWidth=function(b){this.fitWidth=b},Reader.prototype.queueRenderPage=function(b){this.pdfExists=!0,this.pageRendering?this.pageNumPending=b:this.renderPDF(b)},Reader.prototype.loadPDF=function(b){var c=this;this.setSize(),b=1;var d=this;PDFJS.getDocument(this.SRC).then(function(e){d.PDF=e,d.queueRenderPage(b),d.currentPage=b,d.totalPages.innerHTML=d.PDF.numPages,d.totalPagesNum=d.PDF.numPages,d.currentZoomVal=d.fitZoomVal=d.widthZoomVal=0,d.createDownloadLink()}).catch(function(){c.pdfExists=!1})},Reader.prototype.renderPages=function(){var b=this;b.viewportOut.innerHTML="",PDFJS.getDocument(this.SRC).then(function(c){b.PDF=c;for(var d=1;d<=b.PDF.numPages;d++)c.getPage(d).then(b.renderPDF(d,null,!0));b.currentPage=1,b.totalPages.innerHTML=b.PDF.numPages,b.totalPagesNum=b.PDF.numPages,b.currentZoomVal||(b.currentZoomVal=b.fitZoomVal=b.widthZoomVal=0),b.createDownloadLink()})},Reader.prototype.sidebarSetup=function(b){function c(i){var j=0.14,k=0,l=d.container;k=b.sidebarOpen?d.WIDTH:d.WIDTH,j=35e-5*k;var m=i.getViewport(j),n=document.createElement("div"),o=(i.pageIndex+1).toString(),p=e.split("/").pop();n.style.backgroundColor="gray";var q=document.querySelector("pdf-element"),r=document.createElement("canvas");n.appendChild(r),l.appendChild(n);var s=dom(d.container).childNodes[i.pageIndex];s.addEventListener("click",function(){var u=i.pageIndex+1;q.sideBarClick(u,b.instance,b)});var t=r.getContext("2d");r.height=m.height,r.width=m.width,i.render({canvasContext:t,viewport:m}),f++,null!==h&&f<=g&&h.getPage(f).then(c)}var d=this,e=b.src,f=1,g=0,h=null;0==d.container.innerHTML.length?(d.container.innerHTML="",PDFJS.getDocument(this.SRC).then(function(i){h=i,g=h.numPages;d.container;i.getPage(1).then(c)}),d.setViewportPos(!0)):b.changedSideBar&&(d.container.innerHTML="",PDFJS.getDocument(this.SRC).then(function(i){h=i,g=h.numPages;d.container;i.getPage(1).then(c)}),d.setViewportPos(!1))},Reader.prototype.renderPDF=function(b,c,d){var e=this;e.pageRendering=!0,e.spinner.active=!0,this.PDF.getPage(b).then(function(f){var j,k,l,m,n,g=Math.abs,h=Math.sin,i=Math.cos;if(n=f.pageInfo.rotate*Math.PI/180,e.pageW=g(f.view[2]*i(n)+f.view[3]*h(n)),e.pageH=g(f.view[3]*i(n)+f.view[2]*h(n)),0!==e.currentZoomVal&&!c||(j=_Mathround(100*(e.WIDTH/e.pageW))/100,k=_Mathround(100*((e.HEIGHT-e.toolbarHeight)/e.pageH))/100,m=Math.min(k,j),e.fitZoomVal=m,e.widthZoomVal=e.WIDTH/e.pageW,e.currentZoomVal=e.fitWidth?e.widthZoomVal:e.fitZoomVal),!!c)e.zoomPage({target:e.zoomLvl});else{if(m=e.currentZoomVal,l=f.getViewport(m),e.ctx.height=l.height,e.ctx.width=l.width,e.pageW*=m,e.pageH*=m,e.WIDTH==e.currentWidth||null==e.currentWidth?e.setViewportPos(!1):e.setViewportPos(!0),e.viewport.width=e.pageW,e.viewport.height=e.pageH,e.viewportStyle.width=e.pageW+"px",e.viewportStyle.height=e.pageH+"px",e.enableTextSelection&&(e.textLayerDivStyle.width=e.pageW+"px",e.textLayerDivStyle.height=e.pageH+"px"),e.ctx.clearRect(0,0,e.viewport.width,e.viewport.height),d){var o=document.createElement("div");o.setAttribute("style","position: relative");var p=document.createElement("canvas"),q=document.createElement("div");q.setAttribute("style","left: "+e.viewportStyle.left),q.className="textLayer";var r=p.getContext("2d");q.height=l.height,q.width=l.width,e.viewportOut.appendChild(o),o.appendChild(p),o.appendChild(q),f.render({canvasContext:r,viewport:l}),e.enableTextSelection&&(e.textLayerDiv.innerHTML="",f.getTextContent().then(function(t){PDFJS.renderTextLayer({textContent:t,container:q,pageIndex:b,viewport:l,textDivs:[]})}))}else{var s=f.render({canvasContext:e.ctx,viewport:l});s.promise.then(function(){e.pageRendering=!1,e.spinner.active=!1,null!==e.pageNumPending&&(e.renderPDF(e.pageNumPending),e.pageNumPending=null)})}e.enableTextSelection&&(e.textLayerDiv.innerHTML="",f.getTextContent().then(function(t){PDFJS.renderTextLayer({textContent:t,container:e.textLayerDiv,pageIndex:b,viewport:l,textDivs:[]})}))}})},Reader.prototype.setViewportPos=function(b){var c=Math.floor;this.currentWidth=b?0.75*this.WIDTH:this.WIDTH,this.viewportStyle.left=this.pageW<this.currentWidth?(this.currentWidth-this.pageW)/2+"px":0,this.pageH<this.HEIGHT?(this.viewportStyle.top=(this.HEIGHT-this.pageH-this.toolbarHeight)/2+"px",this.viewportStyle.topNum=c((this.HEIGHT-this.pageH-this.toolbarHeight)/2)+this.toolbarHeight,this.enableTextSelection&&(this.textLayerDivStyle.topNum=c((this.HEIGHT-this.pageH-this.toolbarHeight)/2)+this.toolbarHeight)):this.viewportStyle.top=0,this.enableTextSelection&&(this.textLayerDivStyle.left=this.viewportStyle.left,this.textLayerDivStyle.top=this.viewportStyle.top)},Reader.prototype.changePDFSource=function(b){this.setSrc(b),this.loadPDF(1)},Reader.prototype.zoomInOut=function(b){this.currentZoomVal=_Mathround(10*(_Mathround(10*this.currentZoomVal)/10+b))/10,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomIn=function(){this.currentZoomVal=_Mathround(10*(_Mathround(10*this.currentZoomVal)/10+0.1))/10,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomOut=function(){this.currentZoomVal=_Mathround(10*(_Mathround(10*this.currentZoomVal)/10+-0.1))/10,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomPageFit=function(){this.currentZoomVal=this.fitZoomVal,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomWidthFit=function(){this.currentZoomVal=this.widthZoomVal,this.queueRenderPage(this.currentPage)},Reader.prototype.getPageNum=function(){return this.PDF.numPages},Reader.prototype.createDownloadLink=function(){var b=this;this.PDF.getData().then(function(c){var d=PDFJS.createBlob(c,"application/pdf");b.downloadLink=URL.createObjectURL(d)})},Reader.prototype.download=function(){var b=document.createElement("a"),c=this.SRC.split("/");b.href=this.downloadLink,b.target="_parent","download"in b&&(b.download=decodeURIComponent(c[c.length-1])),this.reader.appendChild(b),b.click(),b.parentNode.removeChild(b)},window.Reader=Reader;