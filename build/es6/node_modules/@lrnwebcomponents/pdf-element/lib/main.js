var t=Math.round,Reader=function(t){this.element=t,this.reader=t.root.querySelector(".pdf-viewer"),this.viewportOut=this.reader.querySelector(".pdf-viewport-out"),this.element=this.reader.querySelector(".pdf-element"),this.container=this.reader.querySelector(".sidebar"),this.toolbar=this.reader.querySelector(".pdf-toolbar"),this.card=t.root.querySelector(".style-scope"),this.toolbarHeight=0,this.title=this.toolbar.querySelector(".title"),this.enableTextSelection=t.enableTextSelection,this.fitWidth=t.fitWidth,this.HEIGHT=t.getAttribute("height"),this.WIDTH=t.getAttribute("width"),this.viewport=this.reader.querySelector(".pdf-viewport"),this.enableTextSelection&&(this.textLayerDiv=this.reader.querySelector(".textLayer"),this.textLayerDivStyle=this.textLayerDiv.style),this.spinner=this.reader.querySelector(".spinner"),this.totalPages=this.reader.querySelector("#totalPages"),this.viewportStyle=this.viewport.style,this.viewportOutStyle=this.viewportOut.style,this.ctx=this.viewport.getContext("2d"),this.SRC=t.src,this.pageRendering=!1,this.pageNumPending=null};Reader.prototype.setSize=function(t,e){this.WIDTH||(this.WIDTH=this.viewportOut.offsetWidth),this.HEIGHT||(this.HEIGHT=this.viewportOut.offsetHeight);this.WIDTH;var i=this.HEIGHT;"height"===t&&(i=e),this.viewportOutStyle.height=i+"px",this.spinner.style.top=(i-this.toolbarHeight)/2+"px"},Reader.prototype.setSrc=function(t){this.SRC=t},Reader.prototype.setFitWidth=function(t){this.fitWidth=t},Reader.prototype.queueRenderPage=function(t){this.pdfExists=!0,this.pageRendering?this.pageNumPending=t:this.renderPDF(t)},Reader.prototype.loadPDF=function(t){var e=this;this.setSize();var i=this;PDFJS.getDocument(this.SRC).then((function(t){i.PDF=t,i.queueRenderPage(1),i.currentPage=1,i.totalPages.innerHTML=i.PDF.numPages,i.totalPagesNum=i.PDF.numPages,i.currentZoomVal=i.fitZoomVal=i.widthZoomVal=0,i.createDownloadLink()})).catch((function(){e.pdfExists=!1}))},Reader.prototype.renderPages=function(){var t=this;t.viewportOut.innerHTML="",PDFJS.getDocument(this.SRC).then((function(e){t.PDF=e;for(var i=1;i<=t.PDF.numPages;i++)e.getPage(i).then(t.renderPDF(i,null,!0));t.currentPage=1,t.totalPages.innerHTML=t.PDF.numPages,t.totalPagesNum=t.PDF.numPages,t.currentZoomVal||(t.currentZoomVal=t.fitZoomVal=t.widthZoomVal=0),t.createDownloadLink()}))},Reader.prototype.sidebarSetup=function(t){var e=this,i=t.src,o=1,n=0,r=null;function handlePages(a){var h,s=e.container;h=35e-5*(t.sidebarOpen,e.WIDTH);var l=a.getViewport(h),p=document.createElement("div");(a.pageIndex+1).toString(),i.split("/").pop();p.style.backgroundColor="gray";var c=document.querySelector("pdf-element"),d=document.createElement("canvas");p.appendChild(d),s.appendChild(p),e.container.childNodes[a.pageIndex].addEventListener("click",(function(){var e=a.pageIndex+1;c.sideBarClick(e,t.instance,t)}));var u=d.getContext("2d");d.height=l.height,d.width=l.width,a.render({canvasContext:u,viewport:l}),o++,null!==r&&o<=n&&r.getPage(o).then(handlePages)}0!=e.container.innerHTML.length?t.changedSideBar&&(e.container.innerHTML="",PDFJS.getDocument(this.SRC).then((function(t){n=(r=t).numPages;e.container;t.getPage(1).then(handlePages)})),e.setViewportPos(!1)):(e.container.innerHTML="",PDFJS.getDocument(this.SRC).then((function(t){n=(r=t).numPages;e.container;t.getPage(1).then(handlePages)})),e.setViewportPos(!0))},Reader.prototype.renderPDF=function(e,i,o){var n=this;n.pageRendering=!0,n.spinner.active=!0,this.PDF.getPage(e).then((function(r){var a,h,s,l,p,c=Math.abs,d=Math.sin,u=Math.cos;if(p=r.pageInfo.rotate*Math.PI/180,n.pageW=c(r.view[2]*u(p)+r.view[3]*d(p)),n.pageH=c(r.view[3]*u(p)+r.view[2]*d(p)),(0===n.currentZoomVal||i)&&(a=t(n.WIDTH/n.pageW*100)/100,h=t((n.HEIGHT-n.toolbarHeight)/n.pageH*100)/100,l=Math.min(h,a),n.fitZoomVal=l,n.widthZoomVal=n.WIDTH/n.pageW,n.currentZoomVal=n.fitWidth?n.widthZoomVal:n.fitZoomVal),i)n.zoomPage({target:n.zoomLvl});else{if(l=n.currentZoomVal,s=r.getViewport(l),n.ctx.height=s.height,n.ctx.width=s.width,n.pageW=n.pageW*l,n.pageH=n.pageH*l,n.WIDTH==n.currentWidth||null==n.currentWidth?n.setViewportPos(!1):n.setViewportPos(!0),n.viewport.width=n.pageW,n.viewport.height=n.pageH,n.viewportStyle.width=n.pageW+"px",n.viewportStyle.height=n.pageH+"px",n.enableTextSelection&&(n.textLayerDivStyle.width=n.pageW+"px",n.textLayerDivStyle.height=n.pageH+"px"),n.ctx.clearRect(0,0,n.viewport.width,n.viewport.height),o){var g=document.createElement("div");g.setAttribute("style","position: relative");var v=document.createElement("canvas"),P=document.createElement("div");P.setAttribute("style","left: "+n.viewportStyle.left),P.className="textLayer";var m=v.getContext("2d");P.height=s.height,P.width=s.width,n.viewportOut.appendChild(g),g.appendChild(v),g.appendChild(P),r.render({canvasContext:m,viewport:s}),n.enableTextSelection&&(n.textLayerDiv.innerHTML="",r.getTextContent().then((function(t){PDFJS.renderTextLayer({textContent:t,container:P,pageIndex:e,viewport:s,textDivs:[]})})))}else{r.render({canvasContext:n.ctx,viewport:s}).promise.then((function(){n.pageRendering=!1,n.spinner.active=!1,null!==n.pageNumPending&&(n.renderPDF(n.pageNumPending),n.pageNumPending=null)}))}n.enableTextSelection&&(n.textLayerDiv.innerHTML="",r.getTextContent().then((function(t){PDFJS.renderTextLayer({textContent:t,container:n.textLayerDiv,pageIndex:e,viewport:s,textDivs:[]})})))}}))},Reader.prototype.setViewportPos=function(t){var e=Math.floor;this.currentWidth=t?.75*this.WIDTH:this.WIDTH,this.pageW<this.currentWidth?this.viewportStyle.left=(this.currentWidth-this.pageW)/2+"px":this.viewportStyle.left=0,this.pageH<this.HEIGHT?(this.viewportStyle.top=(this.HEIGHT-this.pageH-this.toolbarHeight)/2+"px",this.viewportStyle.topNum=e((this.HEIGHT-this.pageH-this.toolbarHeight)/2)+this.toolbarHeight,this.enableTextSelection&&(this.textLayerDivStyle.topNum=e((this.HEIGHT-this.pageH-this.toolbarHeight)/2)+this.toolbarHeight)):this.viewportStyle.top=0,this.enableTextSelection&&(this.textLayerDivStyle.left=this.viewportStyle.left,this.textLayerDivStyle.top=this.viewportStyle.top)},Reader.prototype.changePDFSource=function(t){this.setSrc(t),this.loadPDF(1)},Reader.prototype.zoomInOut=function(e){this.currentZoomVal=t(10*(t(10*this.currentZoomVal)/10+e))/10,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomIn=function(){this.currentZoomVal=t(10*(t(10*this.currentZoomVal)/10+.1))/10,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomOut=function(){this.currentZoomVal=t(10*(t(10*this.currentZoomVal)/10-.1))/10,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomPageFit=function(){this.currentZoomVal=this.fitZoomVal,this.queueRenderPage(this.currentPage)},Reader.prototype.zoomWidthFit=function(){this.currentZoomVal=this.widthZoomVal,this.queueRenderPage(this.currentPage)},Reader.prototype.getPageNum=function(){return this.PDF.numPages},Reader.prototype.createDownloadLink=function(){var t=this;this.PDF.getData().then((function(e){var i=PDFJS.createBlob(e,"application/pdf");t.downloadLink=URL.createObjectURL(i)}))},Reader.prototype.download=function(){var t=document.createElement("a"),e=this.SRC.split("/");t.href=this.downloadLink,t.target="_parent","download"in t&&(t.download=decodeURIComponent(e[e.length-1])),this.reader.appendChild(t),t.click(),t.parentNode.removeChild(t)},window.Reader=Reader;