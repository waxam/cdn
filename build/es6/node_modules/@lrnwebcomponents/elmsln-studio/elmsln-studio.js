/**
 * Copyright 2020 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{LitElement as s,html as t,css as i}from"../../lit-element/lit-element.js";import{router as o}from"../../lit-element-router/lit-element-router.js";import{ElmslnStudioUtilities as e}from"./lib/elmsln-studio-utilities.js";import{ElmslnStudioStyles as r}from"./lib/elmsln-studio-styles.js";import"../../@polymer/iron-ajax/iron-ajax.js";import"./lib/elmsln-studio-main.js";import"./lib/elmsln-studio-link.js";import"./lib/elmsln-studio-button.js";import"./lib/elmsln-studio-dashboard.js";import"./lib/elmsln-studio-submissions.js";import"./lib/elmsln-studio-portfolio.js";class ElmslnStudio extends(o(e(r(s)))){static get tag(){return"elmsln-studio"}render(){return t`
      <iron-ajax
        auto
        url="${this.profileSource}"
        handle-as="json"
        @response="${this._profileLoaded}"
      ></iron-ajax>
      <iron-ajax
        auto
        url="${this.activitySource}"
        handle-as="json"
        @response="${this._activityLoaded}"
      ></iron-ajax>
      <iron-ajax
        auto
        url="${this.submissionsSource}"
        handle-as="json"
        @response="${this._submissionsLoaded}"
      ></iron-ajax>
      <iron-ajax
        auto
        url="${this.discussionSource}"
        handle-as="json"
        @response="${this._discussionLoaded}"
      ></iron-ajax>
      <iron-ajax
        auto
        url="${this.portfoliosSource}"
        handle-as="json"
        @response="${this._portfoliosLoaded}"
      ></iron-ajax>
      <div id="studio-nav">
        <elmsln-studio-link ?active="${"dashboard"===this.route}" href="/"
          >Dashboard</elmsln-studio-link
        >
        <elmsln-studio-link
          ?active="${"submissions"===this.route||"portfolios"===this.route}"
          href="/submissions"
          >Submissions</elmsln-studio-link
        >
        <elmsln-studio-link
          ?active="${"assignments"===this.route}"
          href="/assignments"
          >Assignments</elmsln-studio-link
        >
        <elmsln-studio-link
          ?active="${"activity"===this.route}"
          href="/activity"
          >Activity Index</elmsln-studio-link
        >
      </div>
      <br />
      <elmsln-studio-main active-route="${this.route}">
        <elmsln-studio-dashboard
          route="dashboard"
          .profile="${this.profile||{}}"
          .activity="${this.activity||[]}"
          route="dashboard"
        >
        </elmsln-studio-dashboard>
        <elmsln-studio-submissions
          route="submissions"
          .submissions="${this.submissions}"
          .comments="${Object.keys(this.discussion||{}).map(s=>this.discussion[s].feedback).flat()}"
          ?grid="${this.query.grid||!1}"
          student-filter="${this.query.student||""}"
          assignment-filter="${this.query.assignment||""}"
          project-filter="${this.query.project||""}"
        >
        </elmsln-studio-submissions>
        <elmsln-studio-portfolio
          route="portfolios"
          .portfolio="${this._filterBy(this.portfolios,this.params.portfolio,"portfolio-")}"
          .submission="${this._filterBy(this.discussion,this.query.submission)}"
          submission-filter="${this.query.submission||""}"
          comment="${this.query.comment||""}"
        >
        </elmsln-studio-portfolio>
      </elmsln-studio-main>
    `}static get properties(){return{activity:{type:Array},activitySource:{type:String,reflect:!0,attribute:"activity-source"},discussion:{type:Array},discussionSource:{type:String,reflect:!0,attribute:"discussion-source"},portfolios:{type:Object},portfoliosSource:{type:String,reflect:!0,attribute:"portfolios-source"},profile:{type:Object},profileSource:{type:String,reflect:!0,attribute:"profile-source"},sourcePath:{type:String,reflect:!0,attribute:"source-path"},submissions:{type:Array},submissionsSource:{type:String,reflect:!0,attribute:"submissions-source"},route:{type:String},params:{type:Object},query:{type:Object},data:{type:Object}}}static get routes(){return[{name:"submissions",pattern:"submissions"},{name:"portfolios",pattern:"portfolios/:portfolio"},{name:"dashboard",pattern:"*",data:{title:"Home"}}]}constructor(){document.getElementById("search").addEventListener("test",()=>{});super(),this.activity=[],this.discussion=[],this.portfolios={},this.profile={},this.submissions=[],this.route="",this.params={},this.query={},this.data={}}router(s,t,i,o){this.route=s,this.params=t,this.query=i,this.data=o}updated(s){super.updated&&super.updated(s),s.forEach((s,t)=>{"params"===t&&console.log("params",this.params),"query"===t&&console.log("query",this.query)})}_filterBy(s,t,i=""){return s&&t&&s[`${i}${t}`]?s[`${i}${t}`]:{}}_loadDiscussion(s){this.query.discussion=s.detail||!0}_profileLoaded(s){console.log("_profileLoaded",s.detail.__data.response),this.profile=s.detail.__data.response}_activityLoaded(s){console.log("_activityLoaded",s.detail.__data.response),this.activity=s.detail.__data.response}_submissionsLoaded(s){console.log("_submissionsLoaded",s.detail.__data.response),this.submissions=s.detail.__data.response}_discussionLoaded(s){console.log("_discussionLoaded",s.detail.__data.response),this.discussion=s.detail.__data.response}_portfoliosLoaded(s){console.log("_portfoliosLoaded",s.detail.__data.response),this.portfolios=s.detail.__data.response}}customElements.define(ElmslnStudio.tag,ElmslnStudio);export{ElmslnStudio};