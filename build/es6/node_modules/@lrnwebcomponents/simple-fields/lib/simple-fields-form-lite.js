import{LitElement as t,html as e,css as s}from"../../../lit-element/lit-element.js";import{SimpleFieldsLite as a}from"./simple-fields-lite.js";class SimpleFieldsFormLite extends a{static get styles(){return[s`
        :host {
          display: block;
        }
      `]}static get tag(){return"simple-fields-form-lite"}render(){return e`
      <form>
        <slot name="before"></slot>
        <simple-fields-lite id="sf" autofocus></simple-fields-lite>
        <slot></slot>
      </form>
    `}firstUpdated(t){t.forEach((t,e)=>{"loadEndpoint"===e&&this.autoload&&this.loadData()})}updated(t){t.forEach((t,e)=>{!this.autoload||this.loadResponse||this.loading||"loadEndpoint"!==e&&"autoload"!==e||this.loadData(),"loadResponse"===e&&this.loadResponse.data&&(this._applyLoadedData(),this.dispatchEvent(new CustomEvent("response",{bubbles:!0,composed:!0,cancelable:!1,detail:this.loadResponse})))})}_applyLoadedData(){let t=this.shadowRoot.querySelector("#sf");this.loadResponse.data.schema&&(t.schema=this.loadResponse.data.schema),this.loadResponse.data.value&&(t.value=this.loadResponse.data.value)}loadData(){this.loading=!0,this.fetchData(this.loadEndpoint,this.method,this.headers,this.body).then(t=>{this.loading=!1,this.loadResponse=t,this.dispatchEvent(new CustomEvent("simple-fields-form-data-loaded",{detail:{value:t}}))})}async fetchData(t,e,s,a){let o={};return o="GET"==e?await fetch(t,{method:e,headers:s}):await fetch(t,{method:e,headers:s,body:JSON.stringify(a)}),await o.json()}constructor(){super(),this.method="POST",this.loading=!1,this.autoload=!1,this.headers={Accept:"application/json","Content-Type":"application/json"},this.body={}}submit(){let t=this.shadowRoot.querySelector("#sf");return this.saveEndpoint&&fetch(this.saveEndpoint,{method:this.method,headers:this.headers,body:JSON.stringify(t.value)}),t.value}static get properties(){return{...super.properties,autoload:{type:Boolean,reflect:!0},loading:{type:Boolean,reflect:!0},loadEndpoint:{type:String,attribute:"load-endpoint"},saveEndpoint:{type:String,attribute:"save-endpoint"},method:{type:String},headers:{type:Object},body:{type:Object},loadResponse:{type:Object}}}}window.customElements.define(SimpleFieldsFormLite.tag,SimpleFieldsFormLite);export{SimpleFieldsFormLite};