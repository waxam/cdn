import{LitElement as e,html as t,css as i}from"../../../lit-element/lit-element.js";import{SimpleFieldsContainer as r}from"./simple-fields-container.js";class SimpleFieldsField extends r{static get tag(){return"simple-fields-field"}static get styles(){return[...super.styles,i`
        fieldset {
          margin: 0;
          padding: 0;
          border: none;
        }
        option {
          border-radius: 0;
        }
        legend {
          padding-inline-start: unset;
          padding-inline-end: unset;
        }
        #options {
          display: var(--simple-fields-radio-option-display, flex);
          flex-wrap: var(--simple-fields-radio-option-flex-wrap, wrap);
        }
        .option {
          display: flex;
          flex-wrap: wrap;
          align-items: stretch;
          justify-content: space-between;
          margin: 0 var(--simple-fields-margin-small, 8px);
        }
        .option:first-of-type {
          margin: 0 var(--simple-fields-margin-small, 8px) 0 0;
        }
        .option:last-of-type {
          margin: 0 0 0 var(--simple-fields-margin-small, 8px);
        }
        .option:focus-within label {
          color: var(--simple-fields-accent, #003f7d);
          transition: color ease-in-out;
        }
        :host([type]) fieldset .border-bottom {
          display: block;
        }
        .box-input:focus {
          outline: none;
        }
        textarea {
          margin: 0;
          transition: height 0.5s ease-in-out;
          box-sizing: border-box;
          vertical-align: bottom;
        }
        select.field {
          width: 100%;
          border: none;
          background: transparent;
          border-radius: 0;
          transition: color ease-in-out;
        }
        select:focus,
        select:focus-within {
          outline: none;
        }
        input[type="range"] {
          width: 100%;
          height: calc(
            var(--simple-fields-font-size, 16px) +
              var(--simple-fields-line-height, 22px)
          );
          padding: 0;
          margin: 0;
          box-sizing: border-box;
          -webkit-appearance: none;
        }
        input[type="range"]:focus {
          outline: none;
        }
        input[type="range"]::-webkit-slider-runnable-track {
          width: 100%;
          height: 16px;
          cursor: pointer;
          background: var(--simple-fields-border-color-light, #ccc);
          border-radius: 8px;
          transition: all 0.5ms ease-in-out;
        }
        :host([error]) input[type="range"]::-webkit-slider-runnable-track {
          background: var(--simple-fields-faded-error-color, #ff997f);
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"]::-webkit-slider-thumb {
          height: 20px;
          width: 20px;
          border-radius: 50%;
          background: var(--simple-fields-background-color, white);
          box-shadow: 0 1px 5px 0 rgba(0, 0, 0, 0.6);
          cursor: pointer;
          -webkit-appearance: none;
          margin-top: -2px;
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"][readonly]::-webkit-slider-thumb,
        input[type="range"][disabled]::-webkit-slider-thumb {
          cursor: not-allowed;
        }
        input[type="range"]:focus::-webkit-slider-thumb {
          background: var(--simple-fields-accent-color, #3f51b5);
          transition: all 0.5ms ease-in-out;
        }
        :host([error]) input[type="range"]::-webkit-slider-thumb {
          background: var(--simple-fields-error-color, #dd2c00);
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"][readonly]::-webkit-slider-thumb,
        input[type="range"][disabled]::-webkit-slider-thumb {
          background: var(--simple-fields-border-color, #999);
          cursor: not-allowed;
          box-shadow: none;
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"]::-moz-range-track {
          width: 100%;
          height: 16px;
          cursor: pointer;
          background: var(--simple-fields-border-color-light, #ccc);
          border-radius: 8px;
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"][readonly]::-moz-range-track,
        input[type="range"][disabled]::-moz-range-track {
          cursor: not-allowed;
        }
        :host([error]) input[type="range"]::-moz-range-track {
          background: var(--simple-fields-faded-error-color, #ff997f);
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"]::-moz-range-thumb {
          height: 20px;
          width: 20px;
          border-radius: 50%;
          background: var(--simple-fields-background-color, white);
          box-shadow: 0 1px 5px 0 rgba(0, 0, 0, 0.6);
          cursor: pointer;
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"]:focus::-moz-range-thumb {
          background: var(--simple-fields-accent-color, #3f51b5);
          transition: all 0.5ms ease-in-out;
        }
        :host([error]) input[type="range"]::-moz-range-thumb {
          background: var(--simple-fields-error-color, #dd2c00);
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"][readonly]::-moz-range-thumb,
        input[type="range"][disabled]::-moz-range-thumb {
          background: var(--simple-fields-border-color, #999);
          cursor: not-allowed;
          box-shadow: none;
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"]::-ms-track {
          width: 100%;
          height: 16px;
          cursor: pointer;
          background: transparent;
          border-color: transparent;
          color: transparent;
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"][readonly]::-ms-track,
        input[type="range"][disabled]::-ms-track {
          cursor: not-allowed;
        }
        :host([error]) input[type="range"]::-ms-track {
          background: var(--simple-fields-faded-error-color, #ff997f);
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"]::-ms-fill-lower {
          background: var(--simple-fields-border-color-light, #ccc);
          border-radius: 8px;
        }
        input[type="range"]::-ms-fill-upper {
          background: var(--simple-fields-border-color-light, #ccc);
          border-radius: 8px;
        }
        input[type="range"]::-ms-thumb {
          height: 20px;
          width: 20px;
          border-radius: 50%;
          background: var(--simple-fields-background-color, white);
          box-shadow: 0 1px 5px 0 rgba(0, 0, 0, 0.6);
          cursor: pointer;
        }
        input[type="range"][readonly]::-ms-thumb,
        input[type="range"][disabled]::-ms-thumb {
          cursor: not-allowed;
        }
        input[type="range"]:focus::-ms-thumb {
          background: var(--simple-fields-accent-color, #3f51b5);
        }
        :host([error]) input[type="range"]::-ms-thumb {
          background: var(--simple-fields-error-color, #dd2c00);
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"][redonly]::-ms-thumb,
        input[type="range"][disabled]::-ms-thumb {
          background: var(--simple-fields-border-color, #999);
          cursor: not-allowed;
          box-shadow: none;
          transition: all 0.5ms ease-in-out;
        }
        input[type="range"]:focus::-ms-fill-lower {
          background: var(--simple-fields-border-color-light, #ccc);
        }
        input[type="range"]:focus::-ms-fill-upper {
          background: var(--simple-fields-border-color-light, #ccc);
        }
      `]}render(){return this.hasFieldSet?this.fieldsetTemplate:super.render()}static get properties(){return{...super.properties,accept:{type:String},autocomplete:{type:String},autofocus:{type:Boolean},capture:{type:String},counter:{type:String},dirname:{type:String},list:{type:String},max:{type:Number},maxlength:{type:Number},min:{type:Number},minlength:{type:Number},multiple:{type:Boolean},numberMessage:{type:String},options:{type:Object},pattern:{type:String},patternMessage:{type:String},placeholder:{type:String},requiredMessage:{type:String},size:{type:Number},spellcheck:{type:String},step:{type:Number},type:{type:String},wrap:{type:Boolean}}}constructor(){super(),this.autocomplete="off",this.autofocus=!1,this.multiple=!1,this.readonly=!1,this.spellcheck=!1,this.id=this._generateUUID(),this.wrap=!1,this.options={}}updated(e){e.forEach((e,t)=>{"id"!==t||this.id||(this.id=this._generateUUID()),this._getAttributes(this.type).includes(t)&&this._updateAttribute(t),"value"===t&&this.value!==e&&("select"!==this.type&&this.field&&this._updateAttribute("value"),this._fireValueChanged()),["counter","maxlength","type"].includes(t)&&["text","textarea"].includes(this.type)&&this._updateCount(),"type"===t&&this.type!==e&&this._updateField()})}get hasFieldSet(){return Object.keys(this.options||{}).length>0&&("radio"===this.type||"checkbox"===this.type)}get fieldElementTag(){return"select"===this.type?"select":"textarea"===this.type?"textarea":this.hasFieldSet?"fieldset":"input"}get fieldMainTemplate(){return t`
      <div
        class="${this.inline||["checkbox","color","radio"].includes(this.type||"text")?"field-main inline":"field-main"}"
      >
        ${this.labelTemplate}
        <div>
          ${this.prefixTemplate}
          ${"input"===this.fieldElementTag?this.inputTemplate:"select"===this.fieldElementTag?this.selectTemplate:"textarea"===this.fieldElementTag?this.textareaTemplate:""}
          ${this.suffixTemplate}
        </div>
      </div>
    `}get fieldMeta(){return t`
      <div id="fieldmeta" aria-live="polite"></div>
    `}get fieldsetTemplate(){return t`
      <fieldset>
        <legend class="label-main" ?hidden="${!this.label}">
          ${this.label}${this.error||this.required?"*":""}
        </legend>
        <div id="options">
          ${Object.keys(this.options||{}).map(e=>t`
              <div class="option inline">
                <label for="${this.id}.${e}" class="radio-label"
                  >${this.options[e]}</label
                >
                <input
                  .id="${e}"
                  .name="${this.id}"
                  ?autofocus="${this.autofocus}"
                  aria-descrbedby="${this.describedBy}"
                  .aria-invalid="${this.error?"true":"false"}"
                  ?checked="${"radio"===this.type?this.value===e:(this.value||[]).includes(e)}"
                  class="field"
                  @click="${this._onMulticheckChange}"
                  ?disabled="${this.disabled}"
                  ?hidden="${this.hidden}"
                  ?readonly="${this.readonly}"
                  ?required="${this.required}"
                  type="${this.type}"
                  .value="${e}"
                />
              </div>
            `)}
        </div>
        ${this.fieldBottom}
      </fieldset>
    `}get inputTemplate(){return t`
      <input
        aria-descrbedby="${this.describedBy}"
        aria-invalid="${this.error?"true":"false"}"
        ?autofocus="${this.autofocus}"
        @change="${this._onInputChange}"
        ?checked="${!0===this.value}"
        class="field ${["checkbox","color","file","radio","range"].includes(this.type)?"":"box-input"}"
        ?disabled="${this.disabled}"
        ?hidden="${this.hidden}"
        @input="${this._onInputChange}"
        .name="${this.id}"
        .placeholder="${this.placeholder||""}"
        ?readonly="${this.readonly}"
        ?required="${this.required}"
        .type="${this.type}"
      />
    `}get selectTemplate(){return t`
      <select
        ?autofocus="${this.autofocus}"
        aria-descrbedby="${this.describedBy}"
        aria-invalid="${this.error?"true":"false"}"
        @change="${this._onSelectChange}"
        class="field"
        ?disabled="${this.disabled}"
        ?hidden="${this.hidden}"
        ?multiple="${this.multiple}"
        .name="${this.id}"
        ?readonly="${this.readonly}"
        ?required="${this.required}"
      >
        ${Object.keys(this.options||{}).map(e=>t`
            <option
              .id="${this.id}.${e}"
              ?selected="${this.multiple?this.value&&this.value.includes(e):this.value===e}"
              .value="${e}"
            >
              ${this.options[e]}
            </option>
          `)}
      </select>
    `}get slottedFieldObserver(){}get textareaTemplate(){return t`
      <textarea
        aria-invalid="${this.error?"true":"false"}"
        ?autofocus="${this.autofocus}"
        class="field box-input"
        @change="${this._onTextareaChange}"
        @keydown="${e=>e.stopPropagation()}"
        ?disabled="${this.disabled}"
        ?hidden="${this.hidden}"
        @input="${this._onTextareaChange}"
        .name="${this.id}"
        ?readonly="${this.readonly}"
        ?required="${this.required}"
        rows="1"
      >
${this.value||""}</textarea
      >
    `}get valueIsArray(){return this.multiple||"checkbox"===this.type&&this.options}get numberError(){let e=!!this.min&&this.value.length<this.min,t=!!this.max&&this.value.length>this.max;return this.valueIsArray&&(e||t)}get patternError(){return this.pattern&&""!==this.pattern&&this.value&&(this.multiple?this.value.filter(e=>!e.match(this.pattern)):!this.value.match(this.pattern))}get requiredError(){return!this.value&&this.required}validate(){if(this.requiredError)this.error=!0,this.errorMessage=this.requiredMessage||"required";else if(this.numberError){let e=this.value?this.value.length:0;this.error=!0,this.errorMessage=this.numberMessage||e<this.min?`select ${this.min-e} more`:`select ${e-this.max} fewer`}else this.patternError&&(this.error=!0,this.errorMessage=this.patternMessage||"invalid format")}_fireValueChanged(){this.dispatchEvent(new CustomEvent("value-changed",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}_getAttributes(e){return{checkbox:["autocomplete","form","list"],color:["autocomplete","form","list"],date:["autocomplete","form","list","max","min","step"],"datetime-local":["form","list","max","min","step"],email:["autocomplete","form","list","placeholder"],file:["autocomplete","accept","capture","form","list"],hidden:["autocomplete","form"],month:["autocomplete","form","list","max","min","step"],number:["autocomplete","form","list","max","min","step"],password:["autocomplete","form","list","maxlength","maxlength","pattern","placeholder"],radio:["autocomplete","form","list"],range:["autocomplete","form","list","max","min","step"],search:["autocomplete","dirname","form","list","maxlength","maxlength","placeholder"],select:["autocomplete","form","list","size"],tel:["autocomplete","form","list","maxlength","maxlength","pattern","placeholder"],text:["autocomplete","dirname","form","list","maxlength","maxlength","pattern","placeholder"],textarea:["autocomplete","autocomplete","form","maxlength","maxlength","placeholder","spellcheck","wrap"],time:["autocomplete","form","list","max","min","step"],url:["autocomplete","form","list","maxlength","maxlength","placeholder"],week:["autocomplete","form","list","max","min","step"]}[e]}_observeAndListen(e=!0){e?(this.addEventListener("click",this.focus),this.addEventListener("focusout",this._onFocusout),this.addEventListener("focusin",this._onFocusin)):(this.removeEventListener("click",this.focus),this.removeEventListener("focusout",this._onFocusout),this.removeEventListener("focusin",this._onFocusin))}_onInputChange(e){e.path[0]&&("radio"===this.type||"checkbox"===this.type?this.value=e.path[0].checked:(this.value=e.path[0].value,"text"===this.type&&this._updateCount()))}_onMulticheckChange(e){e.path[0]&&("radio"===this.type?this.value=e.path[0].value:(this.value=this.value||[],e.path[0].checked?this.value.push(e.path[0].value):this.value=this.value.filter(t=>t!==e.path[0].value)))}_onTextareaChange(e){e.path[0]&&(this.value=e.path[0].value,this._updateCount(),this.autoGrow(e.path[0]))}_onSelectChange(e){e.path[0]&&(this.value=this.multiple?Object.keys(e.path[0].selectedOptions).map(t=>e.path[0].selectedOptions[t].value):e.path[0].selectedOptions[0].value)}_updateAttribute(e){this.field&&this.type&&this[e]!==this.field.getAttribute(e)&&(this[e]?this.field.setAttribute(e,this[e]):this.field.removeAttribute(e,this[e]))}_updateCount(){let e="";if(("textarea"===this.type||"text"===this.type)&&this.counter&&this.field){let t="[\\w\\-\\']+",i=new RegExp(t,"gim"),r=`{0,${this.maxlength||1}}`,s=`(${t}\\W*)${r}`,a=this.value?"character"===this.counter?this.field.value.length:this.field.value.match(i)?this.field.value.match(i).length:0:0,l="character"===this.counter?new RegExp(`.${r}`,"g"):new RegExp(s,"g");this.value&&this.maxlength&&this.maxlength<a&&this.field.value.match(l)&&(this.field.value=this.field.value.match(l)[0],a=this.maxlength),e=a}this.shadowRoot&&this.shadowRoot.querySelector("#fieldmeta")&&(this.shadowRoot.querySelector("#fieldmeta").innerHTML=this.maxlength?`${e}/${this.maxlength}`:e),this.value=this.field.value}_updateField(){this.type=this._getValidType(this.type),this.field=this.shadowRoot&&this.shadowRoot.querySelector(this.fieldElementTag)?this.shadowRoot.querySelector(this.fieldElementTag):void 0,this._getAttributes(this.type).forEach(e=>this._updateAttribute(e)),"select"!==this.type&&this.field&&this._updateAttribute("value")}_generateUUID(){return"ss-s-s-s-sss".replace(/s/g,Math.floor(65536*(1+Math.random())).toString(16).substring(1))}}window.customElements.define(SimpleFieldsField.tag,SimpleFieldsField);export{SimpleFieldsField};