/**
 * Copyright 2019 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{UserActionBroker as e}from"./lib/UserActionBroker.js";class UserAction extends HTMLElement{get html(){return"\n<style>\n\n        </style>\n<slot></slot>"}static get haxProperties(){return{canScale:!0,canPosition:!0,canEditSource:!1,gizmo:{title:"User action",description:"track user actions and allow them to talk to xAPI stores easily",icon:"icons:touch-app",color:"green",groups:["Action"],handles:[{type:"inline",text:""}],meta:{author:"btopro",owner:"The Pennsylvania State University"}},settings:{quick:[],configure:[{attribute:"track",title:"Track when the user: ",description:"What event to react to",inputMethod:"select",options:{visibility:"Can see this",keypress:"Presses a key here",click:"Clicks this"},required:!0,icon:"icons:android"},{attribute:"every",title:"Track every event",description:"Default behavior is just to track the first occurance",inputMethod:"boolean",required:!1,icon:"icons:android"},{slot:"",title:"Content",description:"Content that can emit events",inputMethod:"code-editor",required:!1,icon:"icons:android"}],advanced:[]}}}static get properties(){return{...super.properties,track:{name:"track",type:String,value:"visibility"},eventname:{name:"eventname",type:String,value:"user-engagement"},every:{name:"every",type:Boolean,value:!1},visiblelimit:{name:"visiblelimit",type:Number,value:.5}}}static get tag(){return"user-action"}constructor(t=!1){super(),this.UserActionBroker=new e,this.tag=UserAction.tag;let i=UserAction.properties;for(let e in i)if(i.hasOwnProperty(e))if(this.hasAttribute(e)){let t=this.getAttribute(e);"Boolean"===i[e].type&&(t=!0),this[e]=t}else this[e]=i[e].value}connectedCallback(){this.__ready=!0}static get observedAttributes(){return["track","eventname"]}attributeChangedCallback(e,t,i){if("eventname"===e&&i&&(this.UserActionBroker.eventname=i),"track"===e&&i)switch(i){case"visibility":this.observer=new IntersectionObserver(this.handleIntersectionCallback.bind(this),{root:document.rootElement,rootMargin:"0px",threshold:[0,.25,.5,.75,1]}),this.observer.observe(this);break;default:this.addEventListener(i,this.userActionEvent.bind(this))}}handleIntersectionCallback(e){for(let t of e)Number(t.intersectionRatio).toFixed(2)>=this.visiblelimit&&this.__ready&&this.userActionEvent({detail:"visible"})}userActionEvent(e){this.fired&&!this.every||!this.UserActionBroker.valid(this.track)?this.UserActionBroker.valid(this.track)||console.warn(this.track+" was not valid"):(this.UserActionBroker.fireAction(this.track,e,this),this.fired=!0)}}window.customElements.define(UserAction.tag,UserAction);export{UserAction};