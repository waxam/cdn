import{html,Polymer}from"@polymer/polymer/polymer-legacy.js";import{dom}from"@polymer/polymer/lib/legacy/polymer.dom.js";import"@lrnwebcomponents/materializecss-styles/materializecss-styles.js";import"@lrnwebcomponents/hax-body-behaviors/lib/HAXWiring.js";import"@lrnwebcomponents/schema-behaviors/schema-behaviors.js";import"@lrnwebcomponents/a11y-behaviors/a11y-behaviors.js";import"@lrnwebcomponents/media-behaviors/media-behaviors.js";import"@lrnwebcomponents/simple-colors/simple-colors.js";import"@lrnwebcomponents/a11y-media-player/a11y-media-player.js";let VideoPlayer=Polymer({_template:html`
    <custom-style>
      <style>
        :host {
          display: block;
          margin: 0 0 15px;
        }
        .video-caption {
          font-style: italic;
          margin: 0;
          padding: 8px;
          @apply --video-player-caption-theme;
        }
      </style>
    </custom-style>

    <template is="dom-if" if="[[isA11yMedia]]" restamp="">
      <a11y-media-player
        accent-color\$="[[accentColor]]"
        dark\$="[[dark]]"
        dark-transcript\$="[[darkTranscript]]"
        disable-interactive\$="[[disableInteractive]]"
        hide-timestamps\$="[[hideTimestamps]]"
        lang\$="[[lang]]"
        media-type\$="[[sourceType]]"
        preload\$="[[preload]]"
        media-title\$="[[mediaTitle]]"
        stand-alone\$="[[__standAlone]]"
        sticky-corner\$="[[stickyCorner]]"
        thumbnail-src\$="[[thumbnailSrc]]"
        crossorigin\$="[[crossorigin]]"
        youtube-id\$="[[youtubeId]]"
      >
        <slot name="source"></slot> <slot name="track"></slot>
        <template id="sources" is="dom-repeat" items="[[sourceData]]" as="sd">
          <source src\$="[[sd.src]]" type\$="[[sd.type]]" />
        </template>
        <template id="tracks" is="dom-repeat" items="[[tracks]]" as="track">
          <track
            src\$="[[track.src]]"
            kind\$="[[track.kind]]"
            label\$="[[track.label]]"
            srclang\$="[[track.lang]]"
          />
        </template>
        <slot name="caption"></slot>
      </a11y-media-player>
    </template>
    <template is="dom-if" if="[[!isA11yMedia]]">
      <template is="dom-if" if="[[sandboxed]]">
        <div class="responsive-video-container" lang\$="[[lang]]">
          <webview
            resource\$="[[schemaResourceID]]-video"
            src\$="[[sourceData.0.src]]"
            width\$="[[width]]"
            height\$="[[height]]"
            frameborder="0"
          ></webview>
        </div>
      </template>
      <template is="dom-if" if="[[!sandboxed]]">
        <template is="dom-if" if="[[iframed]]">
          <div class="responsive-video-container" lang\$="[[lang]]">
            <iframe
              resource\$="[[schemaResourceID]]-video"
              src\$="[[sourceData.0.src]]"
              width\$="[[width]]"
              height\$="[[height]]"
              frameborder="0"
              webkitallowfullscreen=""
              mozallowfullscreen=""
              allowfullscreen=""
            ></iframe>
          </div>
        </template>
      </template>
      <div id="videocaption" class\$="video-caption">
        <p>
          [[mediaTitle]]
          <span class="media-type print-only">(embedded media)</span>
        </p>
        <slot name="caption"></slot>
      </div>
    </template>
  `,is:"video-player",behaviors:[HAXBehaviors.PropertiesBehaviors,MaterializeCSSBehaviors.ColorBehaviors,SchemaBehaviors.Schema,A11yBehaviors.A11y,MediaBehaviors.Video],properties:{accentColor:{type:String,value:null,reflectToAttribute:!0},dark:{type:Boolean,value:!1,reflectToAttribute:!0},darkTranscript:{type:Boolean,value:!1},disableInteractive:{type:Boolean,value:!1},height:{type:String,value:null},hideTimestamps:{type:Boolean,value:!1},iframed:{type:Boolean,computed:"_computeIframed(sourceData, sandboxed)"},isA11yMedia:{type:Boolean,computed:"_computeA11yMedia(sourceType, sandboxed)"},lang:{type:String,value:"en"},mediaTitle:{type:String},preload:{type:String,value:"metadata"},sandboxed:{type:Boolean,computed:"_computeSandboxed(sourceData)"},source:{type:String,value:null},sources:{type:Array,value:[]},sourceData:{type:Array,computed:"_getSourceData(source,sources,tracks)",reflectToAttribute:!0},sourceType:{type:String,computed:"_computeSourceType(sourceData)"},youtubeId:{type:String,computed:"_computeYoutubeId(source,sourceType)"},isYoutube:{type:Boolean,computed:"_computeYoutube(sourceType)"},stickyCorner:{type:String,value:"top-right",reflectToAttribute:!0},tracks:{type:Array,value:[]},thumbnailSrc:{type:String,value:null,reflectToAttribute:!0},width:{type:String,value:null},crossorigin:{type:Boolean,value:!1}},attached:function(){this.setHaxProperties({canScale:!0,canPosition:!0,canEditSource:!1,gizmo:{title:"Video player",description:"This can present video in a highly accessible manner regardless of source.",icon:"av:play-circle-filled",color:"red",groups:["Video","Media"],handles:[{type:"video",source:"source",title:"caption",caption:"caption",description:"caption",color:"primaryColor"}],meta:{author:"LRNWebComponents"}},settings:{quick:[{property:"accentColor",title:"Accent color",description:"Select the accent color for the player.",inputMethod:"colorpicker",icon:"editor:format-color-fill"},{property:"dark",title:"Dark theme",description:"Enable dark theme for the player.",inputMethod:"boolean",icon:"invert-colors"}],configure:[{property:"source",title:"Source",description:"The URL for this video.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"},{property:"track",title:"Closed captions",description:"The URL for the captions file.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"},{property:"thumbnailSrc",title:"Thumbnail image",description:"Optional. The URL for a thumbnail/poster image.",inputMethod:"textfield",icon:"link",required:!0,validationType:"url"},{property:"mediaTitle",title:"Title",description:"Simple title for under video",inputMethod:"textfield",icon:"av:video-label",required:!1,validationType:"text"},{property:"accentColor",title:"Accent color",description:"Select the accent color for the player.",inputMethod:"colorpicker",icon:"editor:format-color-fill"},{property:"dark",title:"Dark theme",description:"Enable dark theme for the player.",inputMethod:"boolean",icon:"invert-colors"}],advanced:[{property:"darkTranscript",title:"Dark theme for transcript",description:"Enable dark theme for the transcript.",inputMethod:"boolean"},{property:"hideTimestamps",title:"Hide timestamps",description:"Hide the time stamps on the transcript.",inputMethod:"boolean"},{property:"preload",title:"Preload source(s).",description:"How the sources should be preloaded, i.e. auto, metadata (default), or none.",inputMethod:"select",options:{preload:"Preload all media",metadata:"Preload media metadata only",none:"Don't preload anything"}},{property:"stickyCorner",title:"Sticky Corner",description:"Set the corner where a video plays when scrolled out of range, or choose none to disable sticky video.",inputMethod:"select",options:{none:"none","top-left":"top-left","top-right":"top-right","bottom-left":"bottom-left","bottom-right":"bottom-right"}},{property:"sources",title:"Other sources",description:"List of other sources",inputMethod:"array",properties:[{property:"src",title:"Source",description:"The URL for this video.",inputMethod:"textfield"},{property:"type",title:"Type",description:"Media type data",inputMethod:"select",options:{"audio/aac":"acc audio","audio/flac":"flac audio","audio/mp3":"mp3 audio","video/mp4":"mp4 video","video/mov":"mov video","audio/ogg":"ogg audio","video/ogg":"ogg video","audio/wav":"wav audio","audio/webm":"webm audio","video/webm":"webm video"}}]},{property:"tracks",title:"Track list",description:"Tracks of different languages of closed captions",inputMethod:"array",properties:[{property:"kind",title:"Kind",description:"Kind of track",inputMethod:"select",options:{subtitles:"subtitles"}},{property:"label",title:"Label",description:"The human-readable name for this track, eg. \"English Subtitles\"",inputMethod:"textfield"},{property:"src",title:"Source",description:"Source of the track",inputMethod:"textfield"},{property:"srclang",title:"Two letter, language code, eg. \"en\" for English, \"de\" for German, \"es\" for Spanish, etc.",description:"Label",inputMethod:"textfield"}]}]}})},_computeYoutubeId:function(a,b){return void 0!==a&&"youtube"===b&&this._computeSRC(a).replace(/(https?:\/\/)?(www.)?youtube(-nocookie)?.com\/embed\//,"")},_computeYoutube:function(a){return"youtube"===a},_computeA11yMedia:function(a,b){return b||"youtube"!=a&&"local"!=a?!1:!0},_computeIframed:function(a,b){return 0<a.length&&void 0!==a[0]&&this._sourceIsIframe(a[0].src)&&!b},_getSourceData:function(a,b,c){let d=this,e=dom(d).querySelector("track"),f=b.slice();for(let g=0;g<f.length;g++)f[g].type=void 0!==f[g].type&&null!==f[g].type?f[g].type:this._computeMediaType(f[g].src),f[g].src=this._computeSRC(f[g].src);if(null!==a){let g=this._computeSRC(a);this.sourceType=this._computeSourceType(g),"youtube"!==this.sourceType&&f.unshift({src:g,type:this._computeMediaType(g)})}return this.__standAlone=void 0===c||null===c||0===c.length&&null===e,f},_computeMediaType:function(a){let d="",e=function(f,g){for(let h=0;h<g.length;h++)""===d&&null!==a&&-1<a.toLowerCase().indexOf("."+g[h])&&(d=f+"/"+g[h])};return e("audio",["aac","flac","mp3","oga","wav"]),e("video",["mov","mp4","ogv","webm"]),d},_computeSandboxed:function(a){if(0<a.length&&a[0]!==void 0&&this._sourceIsIframe(a[0].src)){let b=document.createElement("webview");if("function"===typeof b.reload)return!0}return!1},_computeSourceType:function(a){let b=this,c=dom(b).querySelector("source");if(0<a.length&&a[0]!==void 0&&typeof a[0].src!==typeof void 0)return b.getVideoType(a[0].src);if(null!==c){let d=b._computeSRC(c.getAttribute("src"));return b.getVideoType(d)}return null},_computeSRC:function(a){if(null!==a&&typeof a!==void 0){let b=this.sourceType===void 0?this.getVideoType(a):this.sourceType;a=this.cleanVideoSource(a,b),"vimeo"==b?(a+=this.vimeoTitle?"?title=1":"?title=0",a+=this.vimeoByline?"&byline=1":"&byline=0",a+=this.vimeoPortrait?"&portrait=1":"&portrait=0",typeof this.videoColor!==typeof void 0&&(a+="&color="+this.videoColor)):"dailymotion"==b&&(a+="&ui-start-screen-info=false",a+="&ui-logo=false",a+="&sharing-enable=false",a+="&endscreen-enable=false",typeof this.videoColor!==typeof void 0&&(a+="&ui-highlight="+this.videoColor))}return a}});export{VideoPlayer};