import{html,Polymer}from"@polymer/polymer/polymer-legacy.js";import{dom}from"@polymer/polymer/lib/legacy/polymer.dom.js";import"@polymer/iron-flex-layout/iron-flex-layout-classes.js";import"@polymer/iron-icons/image-icons.js";import"@polymer/iron-icons/iron-icons.js";import"@polymer/iron-icons/editor-icons.js";import"@polymer/iron-pages/iron-pages.js";import"@polymer/app-layout/app-toolbar/app-toolbar.js";import"@polymer/paper-menu-button/paper-menu-button.js";import"@polymer/paper-icon-button/paper-icon-button.js";import"@polymer/paper-ripple/paper-ripple.js";import{AppLocalizeBehavior}from"@polymer/app-localize-behavior/app-localize-behavior.js";import"./eco-json-schema-object.js";import"./eco-json-schema-array.js";import"./eco-json-schema-boolean.js";import"./eco-json-schema-enum.js";import"./eco-json-schema-file.js";import"./eco-json-schema-input.js";Polymer({is:"eco-json-schema-wizard",behaviors:[AppLocalizeBehavior],_template:html`
    <style is="custom-style" include="iron-flex iron-flex-alignment">
      :host {
        display: block;
        @apply --layout-vertical;
      }

      paper-input {
        padding: 2px;
        --paper-input-container-label: {
          white-space: normal;
          position: static;
          font-size: 22px;
          color: #fff;
        }
      }

      .box,
      #form {
        display: -webkit-box;
        display: -webkit-flex;
        display: -moz-box;
        display: -ms-flexbox;
        display: flex;
        -webkit-flex-align: center;
        -ms-flex-align: center;
        -webkit-align-items: center;
        align-items: center;
      }

      .fullbleed {
        z-index: 1;
      }

      app-toolbar.bottom {
        --app-toolbar-color: var(--app-primary-color);
        --app-toolbar-background: var(--dark-theme-text-color);
      }

      app-toolbar.bottom paper-icon-button {
        --app-toolbar-color: var(--dark-theme-text-color);
        --app-toolbar-background: var(--app-primary-color);
      }
    </style>
    <div class="vertical flex layout fullbleed">
      <!--
        paper-icon-button id="camButton" icon="editor:insert-photo" raised>add photo</paper-icon-button
      -->
      <app-toolbar>
        <paper-icon-button
          id="prevButton"
          icon="arrow-back"
          hidden\$="{{!hasPrev}}"
          on-tap="prev"
          raised=""
          >{{localize('prev')}}</paper-icon-button
        ><span class="title layout horizontal flex" style="white-space: normal"
          >[[title]]</span
        >
        <paper-icon-button
          id="nextButton"
          icon="arrow-forward"
          hidden\$="{{!hasNext}}"
          on-tap="next"
          raised=""
          >{{localize('next')}}</paper-icon-button
        >
        <paper-icon-button
          id="submitButton"
          icon="cloud-upload"
          on-tap="submit"
          raised=""
          >{{localize('submit')}}</paper-icon-button
        >
      </app-toolbar>
      <iron-pages
        id="form"
        class="layout horizontal flex start-justified"
        role="main"
        selected="[[page]]"
        attr-for-selected="name"
      ></iron-pages>
      <app-toolbar class="bottom">
        <div hidden\$="{{!hasPrev}}" on-tap="prev">
          <paper-icon-button id="prevButton" icon="arrow-back" raised=""
            >{{localize('prev')}}</paper-icon-button
          >
          <span class="title layout" style="white-space: normal"
            >{{localize('prev')}}</span
          >
        </div>
        <span
          class="title layout horizontal flex"
          style="white-space: normal"
        ></span>
        <div hidden\$="{{!hasNext}}" on-tap="next">
          <span class="title layout" style="white-space: normal"
            >{{localize('next')}}</span
          >
          <paper-icon-button id="nextButton" icon="arrow-forward" raised=""
            >{{localize('next')}}</paper-icon-button
          >
        </div>
      </app-toolbar>
    </div>
  `,properties:{language:{type:String,notify:!0},resources:{type:Object,notify:!0},schema:{type:Object,notify:!0,observer:"_schemaChanged"},label:{type:String},value:{type:Object,notify:!0,value:function(){return{}}},page:{type:String,notify:!0,observer:"_pageChanged"},pages:{type:Array,notify:!0,value:[]},error:{type:Object,observer:"_errorChanged"},isReview:{type:Boolean,value:!1,notify:!0},canSubmit:{type:Boolean,notify:!0},hasNext:{type:Boolean,notify:!0},hasPrev:{type:Boolean,notify:!0},titles:{type:Array,notify:!0,value:[]},title:{type:String,value:"",notify:!0}},detached:function(){this._clearForm()},_buildSchemaProperties:function(){var a=this;this._schemaProperties=Object.keys(this.schema.properties||[]).map(function(b){var c=a.schema.properties[b],d={property:b,label:c.title||b,schema:c,component:c.component||{}};if(d.component.valueProperty||(d.component.valueProperty="value"),a._isSchemaEnum(c))d.component.name=d.component.name||"eco-json-schema-enum",d.value="";else if(a._isSchemaBoolean(c.type))d.component.name=d.component.name||"eco-json-schema-boolean",d.value=!1;else if(a._isSchemaFile(c.type))d.component.name=d.component.name||"eco-json-schema-file",d.value="";else if(a._isSchemaValue(c.type))d.component.name=d.component.name||"eco-json-schema-input",d.value="";else if(a._isSchemaObject(c.type))d.component.name=d.component.name||"eco-json-schema-object",d.component.wizard=!0,d.value={};else if(a._isSchemaArray(c.type))d.component.name=d.component.name||"eco-json-schema-array",d.value=[];else return console.error("Unknown property type %s",c.type);return a.push("pages",b),a.push("titles",c.title),d})},_schemaPropertyChanged:function(a,b){if(!(b.path&&/\.length$/.test(b.path))){var c=this,d=a.target.schemaProperty,e=["value",d.property];if(b.path&&/\.splices$/.test(b.path)){for(var f=b.path.split(".").slice(1,-1);f.length;)e.push(f.shift()),d.keyMap&&d.keyMap[e.join(".")]&&(e=d.keyMap[e.join(".")].split("."));b.value.keySplices&&d.keyMap&&b.value.keySplices.forEach(function(j){j.removed.forEach(function(l){delete d.keyMap[e.concat([l]).join(".")]})}),b.value.indexSplices.forEach(function(j){var l=[e.join("."),j.index,j.removed.length];if(j.addedCount)for(var m=0,n=j.addedCount;m<n;m++)j.addedKeys&&j.addedKeys[m]&&(d.keyMap=d.keyMap||{},d.keyMap[e.concat([j.addedKeys[m]]).join(".")]=e.concat([m+j.index]).join(".")),l.push(c._deepClone(j.object[m+j.index]));c.splice.apply(c,l)})}else if(b.path){var f=b.path.split(".").slice(1),g=this.value;for(g.hasOwnProperty(d.property)||this.set("value."+d.property,{});f.length;){var h=f.shift();e.push(h),d.keyMap&&d.keyMap[e.join(".")]&&(e=d.keyMap[e.join(".")].split("."))}this.set(e.join("."),this._deepClone(b.value)),console.log("value: "+JSON.stringify(this.value))}}},_setValue:function(){var a=this,b={};this._schemaProperties.forEach(function(c){b[c.property]=a._deepClone(c.value)}),this.value=b},_buildForm:function(){var a=this;this._schemaProperties.forEach(b=>{var c=a.create(b.component.name,{label:b.label,schema:b.schema,schemaProperty:b,language:this.language,resources:this.resources});c.setAttribute("name",b.property),c.className="flex start-justified",b.value=c[b.component.valueProperty],a.listen(c,b.component.valueProperty.replace(/([A-Z])/g,"-$1").toLowerCase()+"-changed","_schemaPropertyChanged"),dom(a.$.form).appendChild(c)})},_removePropertyEl:function(a){typeof a.schemaProperty!==typeof void 0&&this.unlisten(a,a.schemaProperty.component.valueProperty.replace(/([A-Z])/g,"-$1").toLowerCase()+"-changed","_schemaPropertyChanged"),a.schemaProperty=null,dom(this.$.form).removeChild(a)},_clearForm:function(){for(var a=dom(this.$.form);a.firstChild;)this._removePropertyEl(a.firstChild)},_schemaChanged:function(){this._clearForm(),this._buildSchemaProperties(),this._buildForm(),this._setValue(),0<this.pages.length&&this.set("page",this.pages[0]),this.set("title",this.titles[0])},next:function(){var a=this.pages.indexOf(this.page),b=a;-1===a?console.log("Invalid current page in wizard"):(a<this.pages.length-1&&(b=a+1),this.set("page",this.pages[b]),this.set("title",this.titles[b]))},prev:function(){var a=this.pages.indexOf(this.page),b=a;-1===a?console.log("Invalid current page in wizard"):(0<a&&(b=a-1),this.set("page",this.pages[b]),this.set("title",this.titles[b]))},submit:function(){this.fire("submit")},_pageChanged:function(){var a=this.pages.indexOf(this.page);0===a?this.set("hasPrev",!1):this.set("hasPrev",!0),a===this.pages.length-1?this.set("hasNext",!1):this.set("hasNext",!0)},_errorChanged:function(){var a=this;dom(this.$.form).childNodes.forEach(function(b){var c=b.getAttribute("name");b.error=a.error&&a.error[c]?a.error[c]:null})},_deepClone:function(a){return JSON.parse(JSON.stringify(a))},_isSchemaValue:function(a){return this._isSchemaBoolean(a)||this._isSchemaNumber(a)||this._isSchemaString(a)||this._isSchemaFile(a)},_isSchemaFile:function(a){return Array.isArray(a)?-1!==a.indexOf("file"):"file"===a},_isSchemaBoolean:function(a){return Array.isArray(a)?-1!==a.indexOf("boolean"):"boolean"===a},_isSchemaEnum:function(a){return!!a.enum},_isSchemaNumber:function(a){return Array.isArray(a)?-1!==a.indexOf("number")||-1!==a.indexOf("integer"):"number"===a||"integer"===a},_isSchemaString:function(a){return Array.isArray(a)?-1!==a.indexOf("string"):"string"===a},_isSchemaObject:function(a){return"object"===a},_isSchemaArray:function(a){return"array"===a}});