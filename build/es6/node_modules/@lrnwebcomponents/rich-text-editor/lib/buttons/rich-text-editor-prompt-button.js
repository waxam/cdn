/**
 * Copyright 2019 Penn State University
 * @license Apache-2.0, see License.md for full text.
 */
import{LitElement as t,html as e,css as i}from"../../../../lit-element/lit-element.js";import{RichTextEditorButtonBehaviors as n}from"./rich-text-editor-button.js";import"../singletons/rich-text-editor-selection.js";import"../singletons/rich-text-editor-prompt.js";const RichTextEditorPromptButtonBehaviors=function(t){return class extends(n(t)){static get tag(){return"rich-text-editor-prompt-button"}render(){return super.render()}static get properties(){return{...super.properties,fields:{type:Array},inlineWidget:{name:"inlineWidget",type:Boolean},tag:{name:"tag",type:String},value:{type:Object},__promptFields:{type:Array},__oldValue:{name:"__oldValue",type:Object},__prompt:{name:"__prompt",type:Object},__selectionContents:{name:"__selectionContents",type:Object}}}constructor(){super(),this.editableSelection=!1,this.inlineWidget=!1,this.fields=[{slot:"",title:"Text",description:"The inner text",inputMethod:"textfield"}],this.tag="span",this.value={"":null,id:null},this.__prompt=window.RichTextEditorPrompt.requestAvailability()}_buttonTap(t){t.preventDefault();let e=this._getSelectedBlock();this.__selection.selectRange(this.range),e?this.range.selectNode(e):this.__selection.wrap(),this.__selection.addHighlight(),this.range=this.__selection.range,this.open()}cancel(){this.__selection.removeHighlight()}confirm(){this.updateSelection(),this.__selection.removeHighlight()}_editorChanged(t,e){let i=t?document.getElementById(t):null,n=e?document.getElementById(e):null;i&&i.addEventListener("click",t=>this._editInlineWidget(i,t),!0),n&&n.removeEventListener("click",t=>this._editInlineWidget(n,t),!0),super._editorChanged(t,e)}_editInlineWidget(t,e){return!(t.getAttribute("contenteditable")&&this.inlineWidget&&e.target.tagName&&e.target.tagName.toLowerCase()===this.tag)||(e.stopPropagation(),e.preventDefault(),this.selectWidget(e.target),this.open(),!1)}selectWidget(t){this.__selection.selectNode(t),this.__selectionContents=t}open(){this.updatePrompt(),this.__prompt.setTarget(this)}updatePrompt(){this.__selectionContents=this.__selection.firstChild,this.__promptFields=JSON.parse(JSON.stringify(this.fields))}updateSelection(){this.__selectionContents=this._getSelectedBlock()||this.__selection,this.setRange(),this.toggled=!this.__prompt.value,this.commandVal=this.__prompt.value,this.execCommand()}setRange(){this.__selection.selectRange(this.range)}}};class RichTextEditorPromptButton extends(RichTextEditorPromptButtonBehaviors(t)){}window.customElements.define(RichTextEditorPromptButton.tag,RichTextEditorPromptButton);export{RichTextEditorPromptButton,RichTextEditorPromptButtonBehaviors};