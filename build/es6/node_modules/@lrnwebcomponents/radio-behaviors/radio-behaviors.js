/**
 * Copyright 2018 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
const RadioBehaviors=function(e){return class extends e{connectedCallback(){super.connectedCallback(),this.observer.observe(this,{attributes:!0,childList:!0,subtree:!0})}firstUpdated(e){super.firstUpdated&&super.firstUpdated(e),this.selectItem(this.selected)}attributeChangedCallback(e,t,s){super.attributeChangedCallback&&super.attributeChangedCallback(e,t,s),"selection"===e&&this.selection!==oldValue&&this._handleSelectionChange()}constructor(){super(),this.addEventListener(this._selectEvent,this._handleSelectItem)}render(){return""}get observer(){return new MutationObserver((e,t)=>this._handleItemChange(e,t))}static get properties(){return{...super.properties,itemData:{type:Array}}}get _query(){return"> item"}get _selected(){return"selected"}get _selectEvent(){return"select-item"}get selectedIndex(){let e=this.itemData.filter(e=>e.id===this.selection);return e&&e[0]?e[0].index:0}get selection(){return this.getAttribute("selection")}set selection(e){this.setAttribute("selection",e)}_getDataFromItems(){let e=this.querySelectorAll(`${this._query}`);return Object.keys(e||{}).map(t=>this._getDataFromItem(e[t],t,this.selected))}_getDataFromItem(e,t,s){return{id:e.id,index:parseInt(t),node:e,innerHTML:e.innerHTML,selected:e.getAttribute(s)}}selectItem(e){if("string"==typeof e&&(e=this.querySelector(`${this._query}#${e}`)),e&&e.id&&!e.disabled&&e.id!==this.selection)this.setAttribute("selection",e.id),this._handleSelectionChange();else if(this.querySelector(`${this._query}#${this.selection}`))this.querySelectorAll(`${this._query}[${this._selected}]`).length>1&&this._handleSelectionChange();else{let e=this.querySelector(`${this._query}[${this._selected}]`)||this.querySelector(`${this._query}`);this.setAttribute("selection",e?e.id:void 0),this._handleSelectionChange()}this._updateItemData()}_handleItemChange(e,t){let s=!1;e.forEach(e=>{let t="childList"===e.type&&e.addedNodes.length>0,i="childList"===e.type&&e.removedNodes.length>0&&Object.keys(e.removedNodes||{}).filter(t=>e.removedNodes[t].id===this.selection).length>0,r="attributes"===e.type&&"id"===e.attributeName;s=s||t||i||r}),s&&(this.querySelectorAll(`${this._query}`).forEach(e=>{e.id||(e.id=`item-${this._generateUUID()}`)}),this.selectItem(this.selection)),this._updateItemData()}_handleSelectItem(e){e.stopPropagation(),this.selectItem(e.detail.controls)}_handleSelectionChange(){this.querySelectorAll(`${this._query}`).forEach(e=>{e.id!==this.selection?e.removeAttribute(this._selected):e.setAttribute(this._selected,!0)}),this.dispatchEvent(new CustomEvent("selection-changed",{bubbles:!1,cancelable:!0,composed:!0,detail:this}))}_updateItemData(){this.itemData=this._getDataFromItems(),this.render&&this.render()}_generateUUID(){return"ss-s-s-s-sss".replace(/s/g,Math.floor(65536*(1+Math.random())).toString(16).substring(1))}disconnectedCallback(){this.observer&&this.observer.disconnect&&this.observer.disconnect(),this.removeEventListener(this._selectEvent,this._handleSelectItem),super.disconnectedCallback()}}};export{RadioBehaviors};