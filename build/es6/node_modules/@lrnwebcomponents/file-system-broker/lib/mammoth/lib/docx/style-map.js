var e=require("underscore"),t=require("../promises"),r=require("../xml");exports.writeStyleMap=function writeStyleMap(e,t){return e.write("mammoth/style-map",t),function updateRelationships(e){var t="word/_rels/document.xml.rels",a="http://schemas.openxmlformats.org/package/2006/relationships";return e.read(t,"utf8").then(r.readString).then((function(n){addOrUpdateElement(n.children,"{http://schemas.openxmlformats.org/package/2006/relationships}Relationship","Id",{Id:"rMammothStyleMap",Type:"http://schemas.zwobble.org/mammoth/style-map",Target:"/mammoth/style-map"});var m={"":a};return e.write(t,r.writeString(n,m))}))}(e).then((function(){return function updateContentTypes(e){var t="[Content_Types].xml",a="http://schemas.openxmlformats.org/package/2006/content-types",n="{"+a+"}Override";return e.read(t,"utf8").then(r.readString).then((function(m){addOrUpdateElement(m.children,n,"PartName",{PartName:"/mammoth/style-map",ContentType:"text/prs.mammoth.style-map"});var o={"":a};return e.write(t,r.writeString(m,o))}))}(e)}))},exports.readStyleMap=function readStyleMap(e){return e.exists("mammoth/style-map")?e.read("mammoth/style-map","utf8"):t.resolve(null)};function addOrUpdateElement(t,a,n,m){var o=e.find(t,(function(e){return e.name===a&&e.attributes[n]===m[n]}));o?o.attributes=m:t.push(r.element(a,m))}