import{ESGlobalBridgeStore as e}from"../../es-global-bridge/es-global-bridge.js";import{FileSystemBroker as t,FileSystemBrokerSingleton as s}from"../file-system-broker.js";class XLSXFileSystemBroker extends t{static get tag(){return"xlsx-file-system-broker"}constructor(){super(),this.XLSX=null,this.libPath=new URL("./",import.meta.url).href,this.libPath+="xlsx/",e.load("xlsx",this.libPath+"dist/xlsx.full.min.js").then((()=>{window.XLSX&&(this.XLSX=window.XLSX,this.dispatchEvent(new CustomEvent("xlsx-ready",{bubbles:!0,composed:!0,cancelable:!1,detail:this})))})),this.XW={msg:"xlsx",worker:this.libPath+"xlsxworker.js"}}workbookFromJSON(e){const t=this.XLSX.utils.book_new();for(const s in e){let r=this.XLSX.utils.json_to_sheet(e[s],{skipHeader:!0});this.XLSX.utils.book_append_sheet(t,r,s)}return this.XLSX.write(t,{bookType:"xlsx",bookSST:!1,type:"array"})}__toJSON(e,t){var s={};return e.SheetNames.forEach((t=>{var r=this.XLSX.utils.sheet_to_json(e.Sheets[t],{header:1,blankrows:!1,raw:!1,dateNF:"yyyy-mm-dd"});r.length&&(s[t]=r)})),t?JSON.stringify(s,null,2):s}__toCSV(e){var t=[];return e.SheetNames.forEach((s=>{var r=this.XLSX.utils.sheet_to_csv(e.Sheets[s]);r.length&&(t.push("SHEET: "+s),t.push(""),t.push(r))})),t.join("\n")}__toFMLA(e){var t=[];return e.SheetNames.forEach((s=>{var r=this.XLSX.utils.get_formulae(e.Sheets[s]);r.length&&(t.push("SHEET: "+s),t.push(""),t.push(r.join("\n")))})),t.join("\n")}__toHTML(e){var t="";return e.SheetNames.forEach((s=>{var r=this.XLSX.write(e,{sheet:s,type:"string",bookType:"html"});t+=r})),t}__toXLSX(e,t){return this.XLSX.write(e)}processWorker(e,t,s){var r="";switch(t){case"form":r=this.__toFMLA(e);break;case"html":r=this.__toHTML(e);break;case"jsonstringify":r=this.__toJSON(e,!0);break;case"json":r=this.__toJSON(e,!1);break;case"xlsx":r=this.__toXLSX(e,s);break;default:r=this.__toCSV(e)}return r}processFile(e,t,s){var r=new FileReader;r.onload=e=>{this.__executeWorker(e.target.result,t,"read",s)},r.readAsBinaryString(e)}__executeWorker(e,t,s="read",r=""){var o=new Worker(this.XW.worker);o.onmessage=e=>{switch(e.data.t){case"ready":break;case"e":console.error(e.data.d);break;case this.XW.msg:window.dispatchEvent(new CustomEvent("xlsx-file-system-data",{composed:!1,bubbles:!1,cancelable:!0,detail:{filename:r,format:t,operation:s,data:this.processWorker(JSON.parse(e.data.d),t,r)}}))}},o.postMessage({d:e,b:"binary"})}}customElements.define(XLSXFileSystemBroker.tag,XLSXFileSystemBroker),window.XLSXFileSystemBroker=window.XLSXFileSystemBroker||{},window.XLSXFileSystemBroker.requestAvailability=()=>(window.XLSXFileSystemBroker.instance||(window.XLSXFileSystemBroker.instance=document.createElement("xlsx-file-system-broker"),document.body.appendChild(window.XLSXFileSystemBroker.instance)),window.XLSXFileSystemBroker.instance);const r=window.XLSXFileSystemBroker.requestAvailability();export{r as XLSXFileSystemBrokerSingleton,XLSXFileSystemBroker,t as FileSystemBroker,s as FileSystemBrokerSingleton};