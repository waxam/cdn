import{store}from"./haxcms-site-store.js";import{autorun,toJS}from"../../../mobx/lib/mobx.module.js";export const HAXCMSTheme=function(SuperClass){return class extends SuperClass{constructor(){super();this.HAXCMSThemeWiring=new HAXCMSThemeWiring(this)}static get properties(){return{editMode:{type:Boolean,reflectToAttribute:!0},activeItem:{type:Object},manifest:{type:Object},contentContainer:{type:Object,value:null,observer:"_contentContainerChanged"},activeManifestIndex:{type:Number,value:-1}}}_contentContainerChanged(newValue,oldValue){if(newValue&&null===oldValue){this.HAXCMSThemeWiring.connect(this,newValue)}else if(newValue&&oldValue){this.HAXCMSThemeWiring.disconnect(this);this.HAXCMSThemeWiring.connect(this,newValue)}else if(oldValue&&null===newValue){this.HAXCMSThemeWiring.disconnect(this)}}connectedCallback(){super.connectedCallback();if(null===this.contentContainer){this.contentContainer=this.shadowRoot.querySelector("#contentcontainer")}this.__disposer=autorun(()=>{this.manifest=toJS(store.routerManifest)})}disconnectedCallback(){super.disconnectedCallback();delete this.contentContainer;this.__disposer()}setActiveItemFromID(activeId){let item=this.manifest.items.filter(d=>{if(activeId===d.id){return d}}).pop();this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:item}));return item}resetActive(){window.history.pushState(null,null,store.location.baseUrl);window.dispatchEvent(new PopStateEvent("popstate"));this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:{}}))}disablePrevPage(index){if(0===index||-1===index){return!0}return!1}disableNextPage(index){if(index>=this.manifest.items.length-1){return!0}return!1}prevPage(){this.changePage("previous")}nextPage(){this.changePage("next")}changePage(direction){if("next"==direction&&this.activeManifestIndex<this.manifest.items.length-1){window.history.pushState({},null,this.manifest.items[this.activeManifestIndex+1].location);window.dispatchEvent(new PopStateEvent("popstate"));this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:this.manifest.items[this.activeManifestIndex+1]}))}else if("previous"==direction&&0<this.activeManifestIndex){window.history.pushState({},null,this.manifest.items[this.activeManifestIndex-1].location);window.dispatchEvent(new PopStateEvent("popstate"));this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:this.manifest.items[this.activeManifestIndex-1]}))}}}};class HAXCMSThemeWiring{constructor(element,load=!0){if(load){document.body.addEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element));document.body.addEventListener("json-outline-schema-changed",this._manifestUpdate.bind(element));document.body.addEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element));document.body.addEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element));this.__disposer=autorun(()=>{this._manifestUpdate({detail:toJS(store.routerManifest)})})}}connect(element,injector){if(typeof window.cmsSiteEditor!==typeof void 0){window.cmsSiteEditor.requestAvailability(element,injector)}}disconnect(element){document.body.removeEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element));document.body.removeEventListener("json-outline-schema-changed",this._manifestUpdate.bind(element));document.body.removeEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element));document.body.removeEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element));this.__disposer()}_globalEditChanged(e){this.editMode=e.detail}_activeItemUpdate(e){let newValue=e.detail;if(newValue&&typeof newValue.id!==typeof void 0){const evt=new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,cancelable:!0,detail:newValue});this.dispatchEvent(evt);this.manifest.items.filter((d,i)=>{if(newValue.id===d.id){this.activeManifestIndex=i;return d}}).pop();if(typeof newValue.title!==typeof void 0){document.title=this.manifest.title+" - "+newValue.title}else{document.title=this.manifest.title}}else{this.activeManifestIndex=-1;document.title=this.manifest.title}}_triggerUpdate(){this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:{}}))}_manifestUpdate(e){let newValue=e.detail;if(typeof newValue.title!==typeof void 0){document.title=newValue.title}if(typeof newValue.metadata!==typeof void 0&&typeof newValue.metadata.cssVariable!==typeof void 0){let ary=newValue.metadata.cssVariable.replace("--simple-colors-default-theme-","").split("-");ary.pop();this.accentColor=ary.join("-");document.body.style.setProperty("--haxcms-color",newValue.metadata.hexCode)}}}export{HAXCMSThemeWiring};