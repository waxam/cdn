import{store}from"./haxcms-site-store.js";import{autorun,toJS}from"../../../mobx/lib/mobx.module.js";class HAXCMSThemeWiring{constructor(element,load=!0){if(load){document.body.addEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element));document.body.addEventListener("json-outline-schema-changed",this._manifestUpdate.bind(element));document.body.addEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element));document.body.addEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element));autorun(()=>{this._manifestUpdate({detail:toJS(store.routerManifest)})})}}connect(element,injector){if(typeof window.cmsSiteEditor!==typeof void 0){window.cmsSiteEditor.requestAvailability(element,injector)}}disconnect(element){document.body.removeEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element));document.body.removeEventListener("json-outline-schema-changed",this._manifestUpdate.bind(element));document.body.removeEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element));document.body.removeEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element))}_globalEditChanged(e){this.editMode=e.detail}_activeItemUpdate(e){let newValue=e.detail;if(newValue&&typeof newValue.id!==typeof void 0){const evt=new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,cancelable:!0,detail:newValue});this.dispatchEvent(evt);if(typeof newValue.title!==typeof void 0){document.title=newValue.title+" - "+newValue.title}else{document.title=newValue.title+" - "+newValue.description}}else{document.title=newValue.title+" - "+newValue.description}}_triggerUpdate(){const evt=new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,cancelable:!0,detail:{}});this.dispatchEvent(evt)}_manifestUpdate(e){let newValue=e.detail;if(typeof newValue.title!==typeof void 0){document.title=newValue.title+" - "+newValue.description}if(typeof newValue.metadata!==typeof void 0&&typeof newValue.metadata.cssVariable!==typeof void 0){let ary=newValue.metadata.cssVariable.replace("--simple-colors-default-theme-","").split("-");ary.pop();this.accentColor=ary.join("-");document.body.style.setProperty("--haxcms-color",newValue.metadata.hexCode)}}}export{HAXCMSThemeWiring};