import{store}from"./haxcms-site-store.js";import{autorun,toJS}from"../../../../mobx/lib/mobx.module.js";export const HAXCMSTheme=function(SuperClass){return class extends SuperClass{constructor(){super();this.HAXCMSThemeWiring=new HAXCMSThemeWiring(this)}static get properties(){return{editMode:{type:Boolean,reflectToAttribute:!0},activeItem:{type:Object},manifest:{type:Object},contentContainer:{type:Object,value:null,observer:"_contentContainerChanged"},activeManifestIndex:{type:Number,notify:!0},activeManifestIndexCounter:{type:Number,notify:!0},activeId:{type:String,notify:!0,observer:"_activeIdChanged"},_location:{type:Object,observer:"_locationChanged"}}}_activeIdChanged(){window.scrollTo({top:0,left:0,behavior:"smooth"})}_contentContainerChanged(newValue,oldValue){if(newValue&&null===oldValue){this.HAXCMSThemeWiring.connect(this,newValue)}else if(newValue&&oldValue){this.HAXCMSThemeWiring.disconnect(this);this.HAXCMSThemeWiring.connect(this,newValue)}else if(oldValue&&null===newValue){this.HAXCMSThemeWiring.disconnect(this)}}_locationChanged(newValue){if(!newValue||"undefined"===typeof newValue.route)return;const name=newValue.route.name;if("home"===name||"404"===name){const firstItem=this.manifest.items.find(i=>"undefined"!==typeof i.id);if(firstItem){store.activeId=firstItem.id}}}connectedCallback(){super.connectedCallback();if(null===this.contentContainer){this.contentContainer=this.shadowRoot.querySelector("#contentcontainer")}this.__disposer=autorun(()=>{this.manifest=toJS(store.routerManifest);if(typeof this.manifest.title!==typeof void 0){document.title=this.manifest.title}if(typeof this.manifest.metadata!==typeof void 0&&typeof this.manifest.metadata.cssVariable!==typeof void 0){let ary=this.manifest.metadata.cssVariable.replace("--simple-colors-default-theme-","").split("-");ary.pop();this.accentColor=ary.join("-");document.body.style.setProperty("--haxcms-color",this.manifest.metadata.hexCode)}});this.__disposer2=autorun(()=>{this._location=store.location});this.__disposer3=autorun(()=>{this.activeItem=toJS(store.activeItem)});this.__disposer4=autorun(()=>{this.activeId=toJS(store.activeId)});this.__disposer5=autorun(()=>{this.activeManifestIndex=toJS(store.activeManifestIndex)});this.__disposer6=autorun(()=>{this.pageTitle=toJS(store.pageTitle)});this.__disposer7=autorun(()=>{this.siteTitle=toJS(store.siteTitle)});this.__disposer8=autorun(()=>{this.homeLink=toJS(store.homeLink)});this.__disposer9=autorun(()=>{this.activeManifestIndexCounter=toJS(store.activeManifestIndexCounter)})}disconnectedCallback(){super.disconnectedCallback();delete this.contentContainer;this.__disposer();this.__disposer2();this.__disposer3();this.__disposer4();this.__disposer5();this.__disposer6();this.__disposer7();this.__disposer8();this.__disposer9()}resetActive(){window.history.pushState(null,null,store.location.baseUrl);window.dispatchEvent(new PopStateEvent("popstate"));this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:{}}))}}};class HAXCMSThemeWiring{constructor(element,load=!0){if(load){document.body.addEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element));document.body.addEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element));document.body.addEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element));if(null==window.localStorage.getItem("HAXCMSSystemData")){window.localStorage.setItem("HAXCMSSystemData",JSON.stringify({}))}}}connect(element,injector){if(typeof window.cmsSiteEditor!==typeof void 0){window.cmsSiteEditor.requestAvailability(element,injector)}}disconnect(element){document.body.removeEventListener("haxcms-active-item-changed",this._activeItemUpdate.bind(element));document.body.removeEventListener("haxcms-edit-mode-changed",this._globalEditChanged.bind(element));document.body.removeEventListener("haxcms-trigger-update",this._triggerUpdate.bind(element))}_globalEditChanged(e){this.editMode=e.detail}_activeItemUpdate(e){let newValue=e.detail;if(newValue&&typeof newValue.id!==typeof void 0){store.activeId=newValue.id;const evt=new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,cancelable:!0,detail:newValue});this.dispatchEvent(evt);if(typeof newValue.title!==typeof void 0){document.title=this.manifest.title+" - "+newValue.title}else{document.title=this.manifest.title}}else{document.title=this.manifest.title}}_triggerUpdate(){this.dispatchEvent(new CustomEvent("haxcms-active-item-changed",{bubbles:!0,cancelable:!0,detail:{}}))}}export{HAXCMSThemeWiring};