import{html,Polymer}from"../../../../@polymer/polymer/polymer-legacy.js";import{pathFromUrl}from"../../../../@polymer/polymer/lib/utils/resolve-url.js";import*as async from"../../../../@polymer/polymer/lib/utils/async.js";import"./haxcms-site-editor-ui.js";window.cmsSiteEditor=window.cmsSiteEditor||{};window.cmsSiteEditor.instance=null;Polymer({is:"haxcms-editor-builder",ready:function(){this.applyContext()},attached:function(){window.addEventListener("hax-store-ready",this.storeReady.bind(this))},detached:function(){window.removeEventListener("hax-store-ready",this.storeReady.bind(this))},storeReady:function(){if(!window.cmsSiteEditor.haxCmsSiteEditorUIElement){window.cmsSiteEditor.haxCmsSiteEditorUIElement=document.createElement("haxcms-site-editor-ui");document.body.appendChild(window.cmsSiteEditor.haxCmsSiteEditorUIElement);setTimeout(()=>{window.cmsSiteEditor.haxCmsSiteEditorUIElement.painting=!1},5)}},getContext:function(){let context="";if(typeof DatArchive!==typeof void 0){context="beaker"}else if(!0===window.__haxCMSContextPublished){context="published"}else if(!0===window.__haxCMSContextNode){context="nodejs"}else if(!0===window.__haxCMSContextDemo){context="demo"}else{context="php"}return context},applyContext:function(){let context=this.getContext();if("php"===context){let script=document.createElement("script");script.src=`/haxcms-jwt.php`;document.documentElement.appendChild(script)}if("published"!==context){const basePath=pathFromUrl(decodeURIComponent(import.meta.url));window.cmsSiteEditor.tag=`haxcms-backend-${context}`;async.microTask.run(()=>{setTimeout(()=>{import(`${basePath}backends/${window.cmsSiteEditor.tag}.js`)},50)})}}});window.cmsSiteEditor.requestAvailability=function(element=this,location=document.body){if(!window.cmsSiteEditor.instance){window.cmsSiteEditor.instance=document.createElement(window.cmsSiteEditor.tag);window.cmsSiteEditor.instance.appElement=element;window.cmsSiteEditor.instance.appendTarget=location;document.body.appendChild(window.cmsSiteEditor.instance)}else{if(element){window.cmsSiteEditor.instance.appElement=element;window.cmsSiteEditor.instance.appendTarget=location;if(typeof window.cmsSiteEditor.instance.haxCmsSiteEditorElement!==typeof void 0){window.cmsSiteEditor.instance.appendTarget.appendChild(window.cmsSiteEditor.instance.haxCmsSiteEditorElement)}}}return window.cmsSiteEditor.instance};