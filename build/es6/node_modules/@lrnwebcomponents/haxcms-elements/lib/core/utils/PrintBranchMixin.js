import{html as t}from"../../../../../lit/index.js";import{store as i}from"../haxcms-site-store.js";import"../../../../hax-iconset/lib/simple-hax-iconset.js";import{b64toBlob as e}from"../../../../utils/utils.js";import{MicroFrontendRegistry as o}from"../../../../micro-frontend-registry/micro-frontend-registry.js";import{HAXCMSI18NMixin as r}from"./HAXCMSI18NMixin.js";import"../../../../simple-icon/lib/simple-icon-button-lite.js";import"../../../../simple-tooltip/simple-tooltip.js";import{toJS as n}from"../../../../../mobx/dist/mobx.esm.js";import{enableServices as s}from"../../../../micro-frontend-registry/lib/microServices.js";export const PrintBranchMixin=function(a){return class extends(r(a)){constructor(){super(),s(["haxcms"]),this.t=this.t||{},this.t={...this.t,print:"Print"}}PrintBranchButton(){return t`
      ${o.has("@haxcms/siteToHtml")?t`
      <div class="print-branch-btn" part="${this.editMode?"edit-mode-active":""}">
        <simple-icon-button-lite
          part="print-branch-btn"
          icon="print"
          @click="${this.printBranchOfSite}"
          icon-position="top"
          id="print-branch-btn"
        >
        </simple-icon-button-lite>
        <simple-tooltip for="print-branch-btn">
          ${this.t.print}
        </simple-tooltip>
      </div>`:""}
      `}async printBranchOfSite(t){var r="";document.querySelector("base")&&(r=document.querySelector("base").href);const s=n(i.manifest),a={type:"site",site:{file:r+"site.json",id:s.id,title:s.title,author:s.author,description:s.description,license:s.license,metadata:s.metadata,items:s.items},ancestor:n(i.activeId),link:r,magic:window.__appCDN,base:r},c=await o.call("@haxcms/siteToHtml",a);if(200==c.status&&c.data){const t=document.createElement("a");t.href=window.URL.createObjectURL(e(btoa(unescape(encodeURIComponent(c.data))),"text/html")),t.download=`${n(i.activeTitle)}.html`,t.target="_blank",this.appendChild(t),t.click(),this.removeChild(t)}else window.open(window.location.href+"?format=print-page","","left=0,top=0,width=800,height=800,toolbar=0,scrollbars=0,status=0,noopener=1,noreferrer=1")}}};