import{observable as t,decorate as e,computed as i,autorun as a,action as s,toJS as n}from"../../../../mobx/lib/mobx.module.js";import{varExists as r,varGet as c}from"../../../utils/utils.js";class Store{constructor(){this.location=null,this.jwt=null,this.editMode=!1,this.manifest=null,this.activeItemContent="",this.themeElement=null,this.activeId=null,this.userData={},this.cmsSiteEditor={instance:null},this.cmsSiteEditorBackend={instance:null},this.dashboardOpened=!1}cmsSiteEditorAvailability(){return this.cmsSiteEditor.instance||(this.cmsSiteEditor.instance=document.createElement("haxcms-site-editor")),this.cmsSiteEditor.instance}get processedItems(){}_computeItems(t,e,i,a,s){if(s){let n,r=[],c=[];switch(s.items.forEach(t=>{t.parent||r.push(t)}),a){case"parent":n=s.items.find(t=>i===t.id),n&&(i=n.parent);break;case"ancestor":for(n=s.items.find(t=>i===t.id);n&&null!=n.parent;)n=s.items.find(t=>t.id==n.parent);n&&(i=n.id)}return r.forEach((a,s)=>{this._spiderChildren(a,c,t,e,i,!1)}),c}}_setChildren(t,e){const i=e.filter(e=>t.id===e.parent);t.children=i,t.children.length>0&&t.children.forEach(t=>{this._setChildren(t,e)})}get routerManifest(){const t=this.manifest;if(document.body.dispatchEvent(new CustomEvent("json-outline-schema-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:t})),t&&void 0!==t.items){let i=JSON.parse(window.localStorage.getItem("HAXCMSSystemData"));var e={};null==i&&(i={manifests:{}},i.manifests[t.id]={accessData:{}},window.localStorage.setItem("HAXCMSSystemData",JSON.stringify(i))),i&&void 0!==i.manifests&&void 0!==i.manifests[t.id]&&"undefined"!==i.manifests[t.id].accessData&&(e=i.manifests[t.id].accessData);let a=t.items.map(i=>{let a=null,s=t.items.find(t=>i.parent===t.id);s&&(a=s.location.replace("pages/","").replace("/index.html",""));let n=i.metadata;void 0!==e[i.id]&&(n.accessData=e[i.id]);let r=i.location.replace("pages/","").replace("/index.html","");return Object.assign({},i,{parentLocation:a,location:r,metadata:n})});if(a.forEach((t,e)=>{this._setChildren(t,a)}),!0===c(t,"metadata.site.settings.publishPagesOn",!1)){const filterHiddenParentsRecursive=t=>{if(!1===t.metadata.published)return!1;const e=a.find(e=>e.id===t.parent);return!e||filterHiddenParentsRecursive(e)};a=a.filter(t=>filterHiddenParentsRecursive(t))}return Object.assign({},t,{items:a,accessData:e})}}get siteTitle(){const t=this.manifest;return t&&t.title?t.title:""}get homeLink(){if(this.manifest){const t=this.manifest.items.find(t=>void 0!==t.id);if(t)return t.location.replace("pages/","").replace("/index.html","")}return"/"}get activeItem(){let t=this.findItem(this.activeId);return t||null}get activeItemFields(){if(this.activeItem&&this.activeItem.metadata){let t={title:this.activeItem.title,description:this.activeItem.description,location:this.activeItem.location,created:this.activeItem.metadata.created,updated:this.activeItem.metadata.created};if(this.activeItem.metadata.fields)return Object.assign({},t,this.activeItem.metadata.fields)}}get themeData(){if(this.manifest){var t={};return t=r(this.manifest,"metadata.theme")?this.manifest.metadata.theme:{"haxcms-basic-theme":{element:"haxcms-basic-theme",path:"@lrnwebcomponents/haxcms-elements/lib/core/themes/haxcms-basic-theme.js",name:"Basic theme",variables:{image:"assets/banner.jpg",icon:"icons:record-voice-over",hexCode:"#da004e",cssVariable:"pink"}}},this.activeItem&&r(this.activeItem,"metadata.theme")?this.activeItem.metadata.theme:t}}get activeManifestIndex(){if(this.manifest&&this.manifest.items&&this.activeId)for(var t in this.manifest.items)if(this.manifest.items[t].id===this.activeId)return parseInt(t);return-1}get activeRouterManifestIndex(){if(this.routerManifest&&this.routerManifest.items&&this.activeId)for(var t in this.routerManifest.items)if(this.routerManifest.items[t].id===this.activeId)return parseInt(t);return-1}get activeManifestIndexCounter(){return null!==this.activeManifestIndex?1+this.activeManifestIndex:0}get activeTitle(){return this.activeItem?this.activeItem.title:""}get parentTitle(){if(this.manifest&&this.activeItem){let t=this.manifest.items.find(t=>this.activeItem.parent===t.id);if(t)return t.title}return""}get isLoggedIn(){return!(!this.jwt||"null"==this.jwt)}get ancestorTitle(){if(this.manifest&&this.activeItem){let t=this.manifest.items.find(t=>this.activeItem.parent===t.id);for(;t&&null!=t.parent;)t=this.manifest.items.find(e=>e.id==t.parent);if(t)return t.title}return""}findItem(t){return this.manifest&&t?this.manifest.items.find(e=>e.id===t):null}spiderChildren(t,e,i,a,s,n,r){t.id===s||n?(n||(n=!0,!r&&t.indent>=i&&(i+=t.indent,a+=t.indent)),t.indent>=i&&t.indent<=a&&e.push(t),t.children.length>0&&t.children.forEach(t=>{this.spiderChildren(t,e,i,a,s,n,r)})):t.children.length>0&&t.children.forEach(t=>{this.spiderChildren(t,e,i,a,s,n,r)})}computeItems(t,e,i,a,s,n){if(s){let r,c=[],d=[];switch(s.items.forEach(t=>{t.parent||c.push(t)}),a){case"parent":r=s.items.find(t=>i===t.id),r&&(i=r.parent);break;case"ancestor":for(r=s.items.find(t=>i===t.id);r&&null!=r.parent;)r=s.items.find(t=>t.id==r.parent);r&&(i=r.id)}return s.items.forEach((a,s)=>{store.spiderChildren(a,d,t,e,i,!1,n)}),d}}}e(Store,{location:t.ref,editMode:t,jwt:t,dashboardOpened:t,userData:t,manifest:t,activeItemContent:t,themeElement:t,routerManifest:i,siteTitle:i,isLoggedIn:i,themeData:i,homeLink:i,activeId:t,activeItem:i,activeItemFields:i,activeManifestIndex:i,activeManifestIndexCounter:i,activeTitle:i,parentTitle:i,ancestorTitle:i,changeActiveItem:s.bound});export const store=new Store;a(()=>{if(store.location&&store.location.route&&store.location.route.component){const t=store.location.route.name;store.manifest.items.filter(e=>e.id===t)&&(store.activeId=t)}}),a(()=>{const t=n(store.findItem(store.activeId));t&&document.body.dispatchEvent(new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:t}))}),a(()=>{const t=n(store.editMode);window.HaxStore&&window.HaxStore.write&&(window.dispatchEvent(new CustomEvent("haxcms-edit-mode-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:t})),window.HaxStore.write("editMode",t,window.HaxStore.instance),window.HaxStore.instance&&window.HaxStore.instance.globalPreferences.haxVoiceCommands&&setTimeout(()=>{window.HaxStore.instance.__hal.auto=!0},10))});