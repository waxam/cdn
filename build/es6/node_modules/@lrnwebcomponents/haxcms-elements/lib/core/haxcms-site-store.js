import{observable,decorate,computed,autorun,action,toJS}from"../../../../mobx/lib/mobx.module.js";class Store{constructor(){this.location=null;this.editMode=!1;this.manifest=null;this.activeId=null;this.cmsSiteEditor={instance:null}}cmsSiteEditorAvailability(element=this,location=document.body){if(!store.cmsSiteEditor.instance){store.cmsSiteEditor.instance=document.createElement(store.cmsSiteEditor.tag);store.cmsSiteEditor.instance.appElement=element;store.cmsSiteEditor.instance.appendTarget=location;document.body.appendChild(store.cmsSiteEditor.instance)}else{if(element){store.cmsSiteEditor.instance.appElement=element;store.cmsSiteEditor.instance.appendTarget=location;if(typeof store.cmsSiteEditor.instance.haxCmsSiteEditorElement!==typeof void 0){store.cmsSiteEditor.instance.appendTarget.appendChild(store.cmsSiteEditor.instance.haxCmsSiteEditorElement)}}}return store.cmsSiteEditor.instance}get processedItems(){}_computeItems(start,end,parent,dynamicMethodology,_routerManifest){if(_routerManifest){let items=[],data=[],tmpItem;_routerManifest.items.forEach(element=>{if(!element.parent){items.push(element)}});switch(dynamicMethodology){case"parent":tmpItem=_routerManifest.items.find(d=>parent===d.id);if(tmpItem){parent=tmpItem.parent}break;case"ancestor":tmpItem=_routerManifest.items.find(d=>parent===d.id);while(tmpItem&&null!=tmpItem.parent){tmpItem=_routerManifest.items.find(i=>i.id==tmpItem.parent)}if(tmpItem){parent=tmpItem.id}break;}items.forEach(item=>{this._spiderChildren(item,data,start,end,parent,!1)});return data}}_setChildren(item,data){const children=data.filter(d=>item.id===d.parent);item.children=children;if(0<item.children.length){item.children.forEach(child=>{this._setChildren(child,data)})}}get routerManifest(){const manifest=this.manifest;document.body.dispatchEvent(new CustomEvent("json-outline-schema-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:manifest}));if(manifest&&"undefined"!==typeof manifest.items){let userData=JSON.parse(window.localStorage.getItem("HAXCMSSystemData"));var accessData={};if(null==userData){userData={manifests:{}};userData.manifests[manifest.id]={accessData:{}};window.localStorage.setItem("HAXCMSSystemData",JSON.stringify(userData))}if(userData&&typeof userData.manifests!==typeof void 0&&typeof userData.manifests[manifest.id]!==typeof void 0&&userData.manifests[manifest.id].accessData!==typeof void 0){accessData=userData.manifests[manifest.id].accessData}const manifestItems=manifest.items.map(i=>{let parentLocation=null,parent=manifest.items.find(d=>i.parent===d.id);if(parent){parentLocation=parent.location.replace("pages/","").replace("/index.html","")}let metadata=i.metadata;if(typeof accessData[i.id]!==typeof void 0){metadata.accessData=accessData[i.id]}let location=i.location.replace("pages/","").replace("/index.html","");return Object.assign({},i,{parentLocation:parentLocation,location:location,metadata:metadata})});manifestItems.forEach(item=>{this._setChildren(item,manifestItems)});return Object.assign({},manifest,{items:manifestItems,accessData:accessData})}}get siteTitle(){const manifest=this.manifest;if(manifest.title){return manifest.title}return""}get homeLink(){const firstItem=this.manifest.items.find(i=>"undefined"!==typeof i.id);if(firstItem){return firstItem.location.replace("pages/","").replace("/index.html","")}else{return"/"}}get activeItem(){let item=this.findItem(this.activeId);if(item){return item}return null}get activeItemFields(){if(this.activeItem&&this.activeItem.metadata){let fields={title:this.activeItem.title,description:this.activeItem.description,location:this.activeItem.location,created:this.activeItem.metadata.created,updated:this.activeItem.metadata.created};if(this.activeItem.metadata.fields){return Object.assign({},fields,this.activeItem.metadata.fields)}}}get themeData(){if(this.manifest){var themeData={};if(this.manifest.metadata.theme){themeData=this.manifest.metadata.theme}else{themeData={"haxcms-basic-theme":{element:"haxcms-basic-theme",path:"@lrnwebcomponents/haxcms-elements/lib/core/themes/haxcms-basic-theme.js",name:"Basic theme"}}}if(this.activeItem){if(this.activeItem.metadata.theme){return this.activeItem.metadata.theme}}return themeData}}get activeManifestIndex(){if(this.manifest&&this.manifest.items&&this.activeId){for(var index in this.manifest.items){if(this.manifest.items[index].id===this.activeId){return parseInt(index)}}}return-1}get activeManifestIndexCounter(){if(null!==this.activeManifestIndex){return 1+this.activeManifestIndex}return 0}get activeTitle(){if(this.activeItem){return this.activeItem.title}return""}get parentTitle(){if(this.manifest&&this.activeItem){let tmpItem=this.manifest.items.find(d=>this.activeItem.parent===d.id);if(tmpItem){return tmpItem.title}}return""}get ancestorTitle(){if(this.manifest&&this.activeItem){let tmpItem=this.manifest.items.find(d=>this.activeItem.parent===d.id);while(tmpItem&&null!=tmpItem.parent){tmpItem=this.manifest.items.find(i=>i.id==tmpItem.parent)}if(tmpItem){return tmpItem.title}}return""}findItem(id){if(this.manifest&&id){return this.manifest.items.find(item=>{if(item.id!==id){return!1}return!0})}else{return null}}spiderChildren(item,data,start,end,parent,parentFound,noDynamicLevel){if(item.id===parent||parentFound){if(!parentFound){parentFound=!0;if(!noDynamicLevel&&item.indent>=start){start+=item.indent;end+=item.indent}}if(item.indent>=start&&item.indent<=end){data.push(item)}if(0<item.children.length){item.children.forEach(child=>{this.spiderChildren(child,data,start,end,parent,parentFound,noDynamicLevel)})}}else{if(0<item.children.length){item.children.forEach(child=>{this.spiderChildren(child,data,start,end,parent,parentFound,noDynamicLevel)})}}}computeItems(start,end,parent,dynamicMethodology,_routerManifest,noDynamicLevel){if(_routerManifest){let items=[],data=[],tmpItem;_routerManifest.items.forEach(element=>{if(!element.parent){items.push(element)}});switch(dynamicMethodology){case"parent":tmpItem=_routerManifest.items.find(d=>parent===d.id);if(tmpItem){parent=tmpItem.parent}break;case"ancestor":tmpItem=_routerManifest.items.find(d=>parent===d.id);while(tmpItem&&null!=tmpItem.parent){tmpItem=_routerManifest.items.find(i=>i.id==tmpItem.parent)}if(tmpItem){parent=tmpItem.id}break;}_routerManifest.items.forEach(item=>{store.spiderChildren(item,data,start,end,parent,!1,noDynamicLevel)});return data}}}decorate(Store,{location:observable.ref,editMode:observable,manifest:observable,activeItemContent:observable,routerManifest:computed,siteTitle:computed,themeData:computed,homeLink:computed,activeId:observable,activeItem:computed,activeItemFields:computed,activeManifestIndex:computed,activeManifestIndexCounter:computed,activeTitle:computed,parentTitle:computed,ancestorTitle:computed,changeActiveItem:action.bound});export const store=new Store;autorun(()=>{if(store.location&&store.location.route&&store.location.route.component){const id=store.location.route.name;let found=store.manifest.items.filter(item=>{if(item.id!==id){return!1}return!0});if(found){store.activeId=id}}});autorun(()=>{const foundItem=toJS(store.findItem(store.activeId));if(foundItem){document.body.dispatchEvent(new CustomEvent("json-outline-schema-active-item-changed",{bubbles:!0,composed:!0,cancelable:!1,detail:foundItem}))}});