import{html,Polymer}from"@polymer/polymer/polymer-legacy.js";import"@polymer/paper-fab/paper-fab.js";import"@polymer/paper-toast/paper-toast.js";import"@polymer/paper-tooltip/paper-tooltip.js";import"@polymer/iron-ajax/iron-ajax.js";import"@polymer/iron-icons/editor-icons.js";import"@lrnwebcomponents/jwt-login/jwt-login.js";import"@lrnwebcomponents/hax-body/lib/hax-store.js";import"@lrnwebcomponents/hax-body/hax-body.js";import"@lrnwebcomponents/hax-body/lib/hax-autoloader.js";import"@lrnwebcomponents/hax-body/lib/hax-manager.js";import"@lrnwebcomponents/hax-body/lib/hax-app-picker.js";import"@lrnwebcomponents/hax-body/lib/hax-app.js";import"@lrnwebcomponents/hax-body/lib/hax-panel.js";import"@lrnwebcomponents/hax-body/lib/hax-export-dialog.js";import"@lrnwebcomponents/hax-body/lib/hax-toolbar.js";import"./haxcms-outline-editor-dialog.js";import"./haxcms-manifest-editor-dialog.js";import"./haxcms-site-editor-ui.js";Polymer({is:"haxcms-site-editor",_template:html`
    <style is="custom-style">
      :host {
        display: block;
      }
      #editbutton {
        position: fixed;
        bottom: 0;
        right: 0;
        margin: 16px;
        padding: 2px;
        width: 40px;
        height: 40px;
        visibility: visible;
        opacity: 1;
        transition: all 0.4s ease;
        z-index: 1000;
      }
      #outlinebutton {
        position: fixed;
        bottom: 0;
        right: 46px;
        margin: 16px;
        padding: 2px;
        width: 40px;
        height: 40px;
        visibility: visible;
        opacity: 1;
        transition: all 0.4s ease;
        z-index: 1000;
      }
      :host([edit-mode]) #editbutton {
        width: 100%;
        z-index: 100;
        right: 0;
        bottom: 0;
        border-radius: 0;
        height: 80px;
        margin: 0;
        padding: 8px;
        background-color: var(--paper-blue-500) !important;
      }
      hax-body {
        padding: 48px;
        max-width: 1040px;
        margin: auto;
        display: none;
      }
      :host([edit-mode]) hax-body {
        display: block;
        padding: 0 !important;
      }
    </style>
    <iron-ajax
      headers="{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}"
      id="pageupdateajax"
      url="[[savePagePath]]"
      method="POST"
      body="[[updatePageData]]"
      content-type="application/json"
      handle-as="json"
      on-response="_handlePageResponse"
    ></iron-ajax>
    <iron-ajax
      headers="{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}"
      id="outlineupdateajax"
      url="[[saveOutlinePath]]"
      method="POST"
      body="[[updateOutlineData]]"
      content-type="application/json"
      handle-as="json"
      on-response="_handleOutlineResponse"
    ></iron-ajax>
    <iron-ajax
      headers="{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}"
      id="manifestupdateajax"
      url="[[saveManifestPath]]"
      method="POST"
      body="[[updateManifestData]]"
      content-type="application/json"
      handle-as="json"
      on-response="_handleManifestResponse"
    ></iron-ajax>
    <iron-ajax
      headers="{&quot;Authorization&quot;: &quot;Bearer [[jwt]]&quot;}"
      id="publishajax"
      loading="{{publishing}}"
      url="[[publishPath]]"
      method="POST"
      body="[[publishSiteData]]"
      content-type="application/json"
      handle-as="json"
      on-response="_handlePublishResponse"
    ></iron-ajax>
    <hax-store app-store="[[appStore]]"></hax-store>
    <hax-app-picker></hax-app-picker>
    <hax-body id="body"></hax-body>
    <hax-autoloader hidden></hax-autoloader>
    <hax-panel align="left" hide-panel-ops></hax-panel>
    <hax-manager append-jwt="jwt" id="haxmanager"></hax-manager>
    <hax-export-dialog></hax-export-dialog>
    <haxcms-site-editor-ui
      id="ui"
      active-item="[[activeItem]]"
      manifest="[[manifest]]"
      edit-mode="{{editMode}}"
      outline-edit-mode="{{outlineEditMode}}"
      manifest-edit-mode="{{manifestEditMode}}"
    ></haxcms-site-editor-ui>
    <haxcms-outline-editor-dialog
      id="outlineeditor"
    ></haxcms-outline-editor-dialog>
    <haxcms-manifest-editor-dialog
      id="manifesteditor"
    ></haxcms-manifest-editor-dialog>
    <paper-toast id="toast"> </paper-toast>
    <paper-toast id="publishtoast" duration="0">
      <a href$="[[__publishLink]]" target="_blank"
        ><paper-button
          raised
          style="color:yellow;text-transform: none;font-weight: bold;"
          >[[__publishLabel]]</paper-button
        ></a
      >
    </paper-toast>
  `,listeners:{"haxcms-save-outline":"saveOutline","haxcms-save-site-data":"saveManifest","haxcms-publish-site":"publishSite"},properties:{jwt:{type:String},savePagePath:{type:String},saveManifestPath:{type:String},publishPath:{type:String},publishing:{type:Boolean,observer:"_publishingChanged"},saveOutlinePath:{type:String},appStore:{type:Object},editMode:{type:Boolean,reflectToAttribute:!0,observer:"_editModeChanged",value:!1},outlineEditMode:{type:Boolean,reflectToAttribute:!0,observer:"_outlineEditModeChanged",value:!1},manifestEditMode:{type:Boolean,reflectToAttribute:!0,observer:"_manifestEditModeChanged",value:!1},updatePageData:{type:Object,value:{}},publishSiteData:{type:Object,value:{}},updateOutlineData:{type:Object,value:{}},updateManifestData:{type:Object,value:{}},activeItem:{type:Object,notify:!0,observer:"_activeItemChanged"},manifest:{type:Object,notify:!0}},created:function(){document.body.addEventListener("json-outline-schema-active-item-changed",this._newActiveItem.bind(this)),document.body.addEventListener("json-outline-schema-changed",this._manifestChanged.bind(this)),document.body.addEventListener("json-outline-schema-active-body-changed",this._bodyChanged.bind(this))},ready:function(){document.body.appendChild(this.$.toast),document.body.appendChild(this.$.publishtoast),document.body.appendChild(this.$.ui),document.body.appendChild(this.$.outlineeditor),document.body.appendChild(this.$.manifesteditor)},attached:function(){this.$.toast.show("You are logged in, edit tools shown."),typeof this.__body!==typeof void 0&&this.$.body.importContent(this.__body),typeof window.cmsSiteEditor.jsonOutlineSchema!==typeof void 0&&this.set("manifest",window.cmsSiteEditor.jsonOutlineSchema),typeof window.cmsSiteEditor.initialActiveItem!==typeof void 0&&this.set("activeItem",window.cmsSiteEditor.initialActiveItem),this.updateStyles()},detached:function(){document.body.removeEventListener("json-outline-schema-active-item-changed",this._newActiveItem.bind(this)),document.body.removeEventListener("json-outline-schema-changed",this._manifestChanged.bind(this)),document.body.removeEventListener("json-outline-schema-active-body-changed",this._bodyChanged.bind(this))},_publishingChanged:function(a,b){a?(this.$.toast.duration=0,this.$.toast.show("Publishing...")):!a&&b&&(this.$.toast.duration=3e3)},_manifestChanged:function(a){this.set("manifest",{}),this.set("manifest",a.detail),this.notifyPath("manifest.*")},_newActiveItem:function(a){this.set("activeItem",a.detail),this.notifyPath("activeItem.*")},_activeItemChanged:function(a){if(a){let c=window.location.pathname.split("/");c.pop();let d=c.pop();this.$.haxmanager.appendUploadEndPoint="siteName="+d+"&page="+a.id}},_handlePageResponse:function(){this.$.toast.show("Page saved!"),this.fire("haxcms-trigger-update-page",!0)},_handleOutlineResponse:function(){this.$.toast.show("Outline saved!"),this.fire("haxcms-trigger-update",!0)},_handleManifestResponse:function(){this.$.toast.show("Site details saved!"),this.fire("haxcms-trigger-update",!0)},_handlePublishResponse:function(a){console.log(a.detail.response);let b=a.detail.response;this.__publishLink=b.url,this.__publishLabel=b.label,this.$.publishtoast.show(b.response)},_editModeChanged:function(a,b){if(!a&&b){let c=window.location.pathname.split("/");c.pop();let d=c.pop();this.set("updatePageData.siteName",d),this.set("updatePageData.body",window.HaxStore.instance.activeHaxBody.haxToContent()),this.set("updatePageData.page",this.activeItem.id),this.set("updatePageData.jwt",this.jwt),this.savePagePath&&this.$.pageupdateajax.generateRequest(),this.fire("haxcms-save-page",this.activeItem),this.notifyPath("updatePageData.*")}},_outlineEditModeChanged:function(a){this.$.outlineeditor.opened=!!a},_manifestEditModeChanged:function(a){this.$.manifesteditor.opened=!!a},saveOutline:function(a){let b=window.location.pathname.split("/");b.pop();let c=b.pop();this.set("updateOutlineData.siteName",c),this.set("updateOutlineData.items",a.detail),this.set("updateOutlineData.jwt",this.jwt),this.saveOutlinePath&&this.$.outlineupdateajax.generateRequest(),this.notifyPath("updateOutlineData.*")},saveManifest:function(a){let b=window.location.pathname.split("/");b.pop();let c=b.pop();this.set("updateManifestData.siteName",c),this.set("updateManifestData.manifest",a.detail),this.set("updateManifestData.jwt",this.jwt),this.saveManifestPath&&this.$.manifestupdateajax.generateRequest(),this.notifyPath("updateManifestData.*")},publishSite:function(){let b=window.location.pathname.split("/");b.pop();let c=b.pop();this.set("publishSiteData.siteName",c),this.set("publishSiteData.jwt",this.jwt),this.publishPath&&this.$.publishajax.generateRequest(),this.notifyPath("publishSiteData.*")},_bodyChanged:function(a){window.HaxStore.instance.activeHaxBody.importContent(a.detail)}});