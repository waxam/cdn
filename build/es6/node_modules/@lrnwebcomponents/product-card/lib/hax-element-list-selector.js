import{LitElement as e,html as t,css as o}from"../../../lit-element/lit-element.js";import"../../hexagon-loader/hexagon-loader.js";import"../../../@polymer/iron-icons/av-icons.js";import"../../../@polymer/iron-icons/communication-icons.js";import"../../../@polymer/iron-icons/device-icons.js";import"../../../@polymer/iron-icons/editor-icons.js";import"../../../@polymer/iron-icons/hardware-icons.js";import"../../../@polymer/iron-icons/image-icons.js";import"../../../@polymer/iron-icons/iron-icons.js";import"../../../@polymer/iron-icons/maps-icons.js";import"../../../@polymer/iron-icons/notification-icons.js";import"../../../@polymer/iron-icons/places-icons.js";import"../../../@polymer/iron-icons/social-icons.js";import"../../lrn-icons/lrn-icons.js";import"../../mdi-iconset-svg/mdi-iconset-svg.js";import"../../hax-iconset/hax-iconset.js";import"../../simple-fields/lib/simple-fields-form.js";import"./hax-element-card-list.js";class HaxElementListSelector extends e{static get tag(){return"hax-element-list-selector"}static get styles(){return[o`
        :host {
          display: block;
        }
        :host([loading]) hax-element-card-list {
          visibility: hidden;
          opacity: 0;
          transition: 1s ease-in-out all;
        }
        hax-element-card-list {
          visibility: visible;
          opacity: 1;
        }
        hexagon-loader[loading] {
          position: absolute;
          width: 100%;
        }
      `]}constructor(){super(),this.loading=!1,this.cols=3,this.imports=[],this.haxData=[],this.noSchema={},this.method="GET",this.basePath=this.pathFromUrl(decodeURIComponent(import.meta.url))+"../../../"}static get properties(){return{basePath:{type:String,attribute:"base-path"},imports:{type:Object},haxData:{type:Array},noSchema:{type:Object},filteredHaxData:{type:Array},cols:{type:Number},fieldsEndpoint:{type:String,attribute:"fields-endpoint"},wcRegistryEndpoint:{type:String,attribute:"wc-registry-endpoint"},method:{type:String},loading:{type:Boolean,reflect:!0}}}pathFromUrl(e){return e.substring(0,e.lastIndexOf("/")+1)}render(){return t`
      <simple-fields-form
        id="form"
        autoload
        load-endpoint="${this.fieldsEndpoint}"
        method="${this.method}"
        @response="${this._response}"
        @value-changed="${this._valueChanged}"
      >
      </simple-fields-form>
      <hexagon-loader
        item-count="4"
        color="blue"
        ?loading="${this.loading}"
        size="large"
      ></hexagon-loader>
      <hax-element-card-list
        id="productlist"
        cols="${this.cols}"
        .list="${this.filteredHaxData}"
      ></hax-element-card-list>
    `}updated(e){e.forEach(async(e,t)=>{if("wcRegistryEndpoint"==t&&(this.haxData=[],this.imports=[],fetch(this[t]).then(e=>(this.loading=!0,e.json())).then(e=>{this.imports=e})),"imports"==t){let e=this.haxData,i=this.noSchema;for(var o in this[t]){let s=this[t][o];try{await import(`${this.basePath}${s}`).then(t=>{if(t&&Object.keys(t)[0]&&t[Object.keys(t)[0]].haxProperties&&t[Object.keys(t)[0]].haxProperties.gizmo&&t[Object.keys(t)[0]].haxProperties.gizmo.title){let i={tag:o,file:s,status:!0,schema:t[Object.keys(t)[0]].haxProperties};e.push(i)}else i[o]=s})}catch(e){console.warn(e)}}this.haxData=[...e],this.noSchema={},this.noSchema=i,this.loading=!1}if("haxData"==t&&(this.filteredHaxData=[...this.haxData],this.haxData.length>0)){let e=this.shadowRoot.querySelector("#form").submit();e.haxcore.providerdetails["haxcore-providerdetails-haxtags"]=JSON.stringify(this.haxData,null,2),this.shadowRoot.querySelector("#form").setValue(e)}if("noSchema"==t&&Object.keys(this.noSchema).length>0){let e=this.shadowRoot.querySelector("#form").submit();e.haxcore.providerdetails["haxcore-providerdetails-othertags"]=JSON.stringify(this.noSchema,null,2),this.shadowRoot.querySelector("#form").setValue(e)}})}applyFilters(e){let t=[...this.haxData];return Object.keys(e).forEach(o=>{if(""!=e[o])switch(o){case"haxcore-search-search":t=t.filter(t=>!!t.schema.gizmo.title.toLowerCase().includes(e[o].toLowerCase()));break;case"haxcore-search-tags":t=t.filter(t=>!!t.schema.gizmo.groups.includes(e[o]));break;case"haxcore-search-hasdemo":e[o]&&(t=t.filter(e=>!!e.schema.demoSchema))}}),t}_response(e){let t=this.shadowRoot.querySelector("#form").submit();t.haxcore.extras["haxcore-extras-columns"]=this.cols,this.shadowRoot.querySelector("#form").setValue(t)}_valueChanged(e){clearTimeout(this.__valueDebounce),this.__valueDebounce=setTimeout(()=>{let e=this.shadowRoot.querySelector("#form").submit();e&&e.haxcore&&("other"==e.haxcore.providers["haxcore-providers-cdn"]?this.wcRegistryEndpoint=e.haxcore.providers["haxcore-providers-other"]+"wc-registry.json":this.wcRegistryEndpoint=e.haxcore.providers["haxcore-providers-cdn"]+"wc-registry.json",this.cols=parseInt(e.haxcore.extras["haxcore-extras-columns"]),this.filteredHaxData=[...this.applyFilters(e.haxcore.search)],this.shadowRoot.querySelector("#productlist").requestUpdate&&this.shadowRoot.querySelector("#productlist").requestUpdate())},50)}}window.customElements.define(HaxElementListSelector.tag,HaxElementListSelector);