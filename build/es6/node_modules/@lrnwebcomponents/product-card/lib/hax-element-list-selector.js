import{LitElement as e,html as t}from"../../../lit-element/lit-element.js";import"../../../@polymer/iron-icons/av-icons.js";import"../../../@polymer/iron-icons/communication-icons.js";import"../../../@polymer/iron-icons/device-icons.js";import"../../../@polymer/iron-icons/editor-icons.js";import"../../../@polymer/iron-icons/hardware-icons.js";import"../../../@polymer/iron-icons/image-icons.js";import"../../../@polymer/iron-icons/iron-icons.js";import"../../../@polymer/iron-icons/maps-icons.js";import"../../../@polymer/iron-icons/notification-icons.js";import"../../../@polymer/iron-icons/places-icons.js";import"../../../@polymer/iron-icons/social-icons.js";import"../../lrn-icons/lrn-icons.js";import"../../mdi-iconset-svg/mdi-iconset-svg.js";import"../../hax-iconset/hax-iconset.js";import"../../simple-fields/lib/simple-fields-form.js";import"./product-card-list.js";class HaxElementListSelector extends e{static get tag(){return"hax-element-list-selector"}constructor(){super(),this.cols=3,this.__loaded=!1,this.imports=[],this.haxData=[],this.method="GET",this.basePath=this.pathFromUrl(decodeURIComponent(import.meta.url))+"../../../"}static get properties(){return{imports:{type:Array},haxData:{type:Array},filteredHaxData:{type:Array},cols:{type:Number},loadEndpoint:{type:String,attribute:"load-endpoint"},method:{type:String}}}pathFromUrl(e){return e.substring(0,e.lastIndexOf("/")+1)}render(){return t`
      <simple-fields-form
        id="form"
        autoload
        load-endpoint="${this.loadEndpoint}"
        method="${this.method}"
        @response="${this._response}"
        @value-changed="${this._valueChanged}"
      >
      </simple-fields-form>
      <product-card-list
        id="productlist"
        cols="${this.cols}"
        .list="${this.filteredHaxData}"
      ></product-card-list>
    `}updated(e){e.forEach((e,t)=>{"imports"==t&&this[t].forEach(async e=>{try{await import(`${this.basePath}${e}`).then(t=>{if(t&&Object.keys(t)[0]&&t[Object.keys(t)[0]].tag&&t[Object.keys(t)[0]].haxProperties){let s={tag:t[Object.keys(t)[0]].tag,file:e,status:!0,schema:t[Object.keys(t)[0]].haxProperties},i=this.haxData;i.push(s),this.haxData=[...i]}})}catch(e){console.warn(e)}}),"haxData"==t&&(this.filteredHaxData=[...this[t]])})}applyFilters(e){let t=[...this.haxData];return Object.keys(e).forEach(s=>{if(""!=e[s])switch(s){case"haxelements-search-search":t=t.filter(t=>!!t.schema.gizmo.title.toLowerCase().includes(e[s].toLowerCase()));break;case"haxelements-search-tags":t=t.filter(t=>!!t.schema.gizmo.groups.includes(e[s]));break;case"haxelements-search-hasdemo":e[s]&&(t=t.filter(e=>!!e.schema.demoSchema))}}),t}_response(e){let t=this.shadowRoot.querySelector("#form").submit();t.haxelements.settings["haxelements-settings-columns"]=this.cols,this.shadowRoot.querySelector("#form").setValue(t)}_valueChanged(e){clearTimeout(this.__valueDebounce),this.__valueDebounce=setTimeout(()=>{let e=this.shadowRoot.querySelector("#form").submit();e&&e.haxelements&&(this.cols=parseInt(e.haxelements.settings["haxelements-settings-columns"]),this.filteredHaxData=[...this.applyFilters(e.haxelements.search)],this.shadowRoot.querySelector("#productlist").requestUpdate())},50)}}window.customElements.define(HaxElementListSelector.tag,HaxElementListSelector);