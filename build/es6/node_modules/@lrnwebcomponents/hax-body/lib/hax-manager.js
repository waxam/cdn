import{html,Polymer}from"@polymer/polymer/polymer-legacy.js";import{dom}from"@polymer/polymer/lib/legacy/polymer.dom.js";import"@polymer/app-layout/app-drawer/app-drawer.js";import"@polymer/paper-input/paper-input.js";import"@polymer/paper-styles/paper-styles.js";import"@polymer/paper-button/paper-button.js";import"@polymer/paper-icon-button/paper-icon-button.js";import"@polymer/iron-pages/iron-pages.js";import"@polymer/iron-icons/iron-icons.js";import"@polymer/iron-icon/iron-icon.js";import"@lrnwebcomponents/simple-colors/simple-colors.js";import"@vaadin/vaadin-upload/vaadin-upload.js";import"@lrnwebcomponents/materializecss-styles/materializecss-styles.js";import"./hax-preview.js";import"./hax-app-browser.js";import"./hax-gizmo-browser.js";Polymer({_template:html`
    <custom-style>
      <style is="custom-style" include="materializecss-styles simple-colors">
        :host {
          display: block;
          --hax-manager-steps-color: #ffffff;
          --hax-manager-ink-color: #ffffff;
          --hax-accent: var(--simple-colors-default-theme-light-green-1);
          color: #ffffff;
        }
        #dialog {
          color: #ffffff;
          z-index: 10000;
          padding: 56px 0;
          margin-top: 64px;
          --app-drawer-width: 400px;
          --app-drawer-content-container: {
            background-color: rgba(0, 0, 0, 0.7);
          }
        }
        #closedialog {
          float: right;
          top: 135px;
          right: 0;
          position: absolute;
          padding: 4px;
          margin: 0;
          color: var(--simple-colors-default-theme-light-green-1, green);
          background-color: transparent;
          width: 40px;
          height: 40px;
          min-width: unset;
        }
        :host([active-page="0"]) #dialog {
          --app-drawer-width: 400px;
        }
        :host([active-page="1"]) #dialog {
          --app-drawer-width: 800px;
        }
        :host([active-page="2"]) #dialog {
          --app-drawer-width: 800px;
        }
        :host([active-step]) #dialog {
          --app-drawer-width: 1000px;
        }
        :host([searching]) #dialog {
          --app-drawer-width: 1000px;
        }
        .title {
          text-align: center;
          padding: 16px;
          margin: 0;
          background-color: rgba(0, 0, 0, 0.5);
          font-size: 32px;
          font-weight: bold;
          font-family: sans-serif;
          text-transform: uppercase;
          color: var(--simple-colors-default-theme-light-green-1);
        }
        #activepage {
        }
        #preview {
          height: 100%;
        }
        vaadin-upload {
          --primary-color: var(--hax-accent);
          --primary-font-color: #ffffff;
          --dark-primary-color: #ffffff;
          --light-primary-color: var(--hax-accent);
          --error-color: darkred;
          color: #ffffff;
          display: block;
          padding: 32px !important;
          --vaadin-upload-button-add-wrapper: {
            border: 2px solid #ffffff;
            background-color: var(--hax-accent);
            color: #ffffff;
            display: block;
          }
          --vaadin-upload-buttons-primary: {
            display: block;
            width: 100%;
            flex: unset;
            -webkit-flex: unset;
          }
          --vaadin-upload-button-add: {
            color: #000000;
            display: block;
            flex: unset;
            -webkit-flex: unset;
            text-align: center;
          }
          --vaadin-upload-drop-label: {
            color: #ffffff;
            display: block;
            padding: 16px;
          }
          --vaadin-upload-drop-label-dragover: {
            color: #ffffff;
          }
          --vaadin-upload-file-list: {
            padding: 16px;
            margin: 0;
            color: #ffffff;
          }
          --vaadin-upload-file: {
            color: #ffffff;
          }
        }
        vaadin-upload[dragover] {
          border-color: #396;
        }
        vaadin-upload-file {
          --disabled-text-color: #222222;
        }
        .add-area-content-wrapper {
          padding: 0 16px;
        }
        .add-url-are,
        .add-upload-area {
          margin: 16px 0;
        }
        .url-description {
          font-size: 18px;
          color: #ffffff;
          line-height: 22px;
          font-family: sans-serif;
          letter-spacing: 1px;
        }
        #steppages {
          height: 100%;
        }
        #newassetconfigure {
          width: 100%;
          margin: 0;
          padding: 16px;
          background-color: var(--simple-colors-default-theme-light-green-1);
          color: #000000;
        }
        paper-input {
          color: #ffffff;
          --paper-input-container-invalid-color: var(
            --simple-colors-red-foreground3
          );
          --secondary-text-color: #ffffff;
          --primary-text-color: #ffffff;
          --paper-input-container-input-color: #ffffff;
          --paper-input-container-color: #ffffff;
          --paper-input-container-focus-color: var(
            --simple-colors-default-theme-light-green-1
          );
        }
        @media screen and (max-width: 550px) {
          .hide-on-mobile {
            opacity: 0;
            visibility: hidden;
            position: absolute;
            left: -9999px;
          }
          .page-area.hax-manager {
            padding: 6px;
          }
        }
      </style>
    </custom-style>
    <app-drawer id="dialog" opened="{{opened}}" disable-swipe="">
      <div
        class="dialog-contents"
        id="dialogcontent"
        style="height: 100%; overflow: auto;"
      >
        <iron-pages
          id="steppages"
          selected="{{activeStep}}"
          fallback-selection="select"
          role="main"
        >
          <div data-value="select">
            <iron-pages
              id="activepage"
              selected="{{activePage}}"
              fallback-selection="link"
            >
              <div class="page-area add-area">
                <h3 class="title">[[addTitle]]</h3>
                <div class="add-area-content-wrapper">
                  <div class="add-url-area">
                    <paper-input
                      id="url"
                      label="URL"
                      type="url"
                      auto-validate=""
                    ></paper-input>
                    <div class="url-description">
                      A full URL with https:// referencing a link that already
                      exists on the web.
                    </div>
                  </div>
                  <div class="add-upload-area">
                    <vaadin-upload
                      form-data-name="file-upload"
                      id="fileupload"
                      hidden\$="[[!canSupportUploads]]"
                    ></vaadin-upload>
                  </div>
                  <paper-button id="newassetconfigure" raised=""
                    >Configure item</paper-button
                  >
                </div>
              </div>
              <div class="page-area">
                <hax-app-browser id="appbrowser">
                  <slot></slot>
                </hax-app-browser>
              </div>
              <div class="page-area">
                <hax-gizmo-browser id="gizmobrowser"></hax-gizmo-browser>
              </div>
            </iron-pages>
          </div>
          <div style="height:100%;">
            <hax-preview
              id="preview"
              element="{{activeHaxElement}}"
            ></hax-preview>
          </div>
        </iron-pages>
        <paper-button id="closedialog" on-tap="cancel">
          <iron-icon icon="icons:cancel" title="Close dialog"></iron-icon>
        </paper-button>
      </div>
    </app-drawer>
  `,is:"hax-manager",properties:{opened:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_openedChanged"},editExistingNode:{type:Boolean,value:!1},editTitle:{type:String,computed:"_computeEditTitle(editExistingNode)"},addTitle:{type:String,value:"Add content"},activeStep:{type:Boolean,reflectToAttribute:!0,value:!1,observer:"_activeStepChanged"},searching:{type:Boolean,reflectToAttribute:!0,value:!1},activePage:{type:String,reflectToAttribute:!0,value:0,observer:"_activePageChanged"},canSupportUploads:{type:Boolean,value:!1},activeHaxElement:{type:Object,observer:"_activeHaxElementChanged"},appList:{type:Array,value:[]},__allowUpload:{type:Boolean,value:!1},appendJwt:{type:String,value:null},appendUploadEndPoint:{type:String,value:null}},created:function(){this.__attached=!1},attached:function(){this.__attached?(this.fire("hax-register-manager",this),document.body.addEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),document.body.addEventListener("hax-app-picker-selection",this._haxAppPickerSelection.bind(this)),document.body.addEventListener("place-holder-file-drop",this._placeHolderFileDrop.bind(this)),this.$.dialog.addEventListener("iron-overlay-canceled",this.close.bind(this)),this.$.dialog.addEventListener("iron-overlay-closed",this.close.bind(this)),this.$.closedialog.addEventListener("tap",this.close.bind(this)),this.$.newassetconfigure.addEventListener("tap",this.newAssetConfigure.bind(this)),this.$.fileupload.addEventListener("upload-before",this._fileAboutToUpload.bind(this)),this.$.fileupload.addEventListener("upload-response",this._fileUploadResponse.bind(this))):(this.__attached=!0,document.body.appendChild(this))},detached:function(){document.body.removeEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),document.body.removeEventListener("hax-app-picker-selection",this._haxAppPickerSelection.bind(this)),document.body.removeEventListener("place-holder-file-drop",this._placeHolderFileDrop.bind(this)),this.$.dialog.removeEventListener("iron-overlay-canceled",this.close.bind(this)),this.$.dialog.removeEventListener("iron-overlay-closed",this.close.bind(this)),this.$.closedialog.removeEventListener("tap",this.close.bind(this)),this.$.newassetconfigure.removeEventListener("tap",this.newAssetConfigure.bind(this)),this.$.fileupload.removeEventListener("upload-before",this._fileAboutToUpload.bind(this)),this.$.fileupload.removeEventListener("upload-response",this._fileUploadResponse.bind(this))},togglePanelSize:function(){this.$.dialog.classList.toggle("grow"),this.updateStyles(),window.dispatchEvent(new Event("resize"))},_computeEditTitle:function(a){return typeof this.activeHaxElement!=="undefined"&&a?"Update":"Insert"},_placeHolderFileDrop:function(a){this.resetManager(),this.open(),window.HaxStore.instance.activePlaceHolder=a.detail.placeHolderElement,this.$.fileupload._onDrop(a.detail)},_fileAboutToUpload:function(a){if(!this.__allowUpload){a.preventDefault(),a.stopPropagation();let c={source:a.detail.file.name,type:a.detail.file.type};var b=window.HaxStore.guessGizmoType(c);let d=window.HaxStore.getHaxAppStoreTargets(b);0==d.length?window.HaxStore.toast("Sorry, you don't have a storage location that can handle "+b+" uploads!",5e3):window.HaxStore.instance.haxAppPicker.presentOptions(d,b,"Where would you like to upload this "+b+"?","app")}else this.__allowUpload=!1},_haxAppPickerSelection:function(a){let b=a.detail.connection;this.__appUsed=a.detail,this.$.fileupload.method=b.operations.add.method;let c=b.protocol+"://"+b.url;"/"!=c.substr(c.length-1)&&(c+="/"),typeof b.operations.add.endPoint!==typeof void 0&&(c+=b.operations.add.endPoint),null!=this.appendUploadEndPoint&&(c+="?"+this.appendUploadEndPoint),null!=this.appendJwt&&(c+="&"+this.appendJwt+"="+localStorage.getItem(this.appendJwt)),this.$.fileupload.headers=b.headers,this.$.fileupload.target=c,this.__allowUpload=!0,this.$.fileupload.uploadFiles()},_fileUploadResponse:function(a){let b=JSON.parse(a.detail.xhr.response),c=this.__appUsed.connection.operations.add.resultMap,d={},f={};for(var g in"undefined"!==typeof this._resolveObjectPath(c.item,b)&&(d=this._resolveObjectPath(c.item,b)),f.type=c.defaultGizmoType,c.gizmo)f[g]=this._resolveObjectPath(c.gizmo[g],d);typeof f.url==="undefined"&&typeof f.source!=="undefined"&&(f.url=f.source),typeof c.gizmo.type!=="undefined"&&(f.type=this._resolveObjectPath(c.gizmo.type,d)),this.$.url.value=f.url,this.newAssetConfigure()},_activePageChanged:function(a){typeof a!==typeof void 0&&(this.searching=!1,this.updateStyles(),1===a?this.$.appbrowser.resetBrowser():2===a&&this.$.gizmobrowser.resetBrowser())},_haxStorePropertyUpdated:function(a){a.detail&&typeof a.detail.value!==typeof void 0&&a.detail.property&&this.set(a.detail.property,a.detail.value)},_activeHaxElementChanged:function(a,b){typeof b!==typeof void 0&&(this.$.preview.advancedForm=!1,typeof a.tag===typeof void 0?this.resetManager():(this.$.fileupload.set("files",[]),this.$.dialog.scrollTop=0,this.selectStep("configure")))},insertHaxElement:function(){let b=this.$.preview.previewNode,c=window.HaxStore.nodeToHaxElement(b);c.replace=this.editExistingNode,typeof this.activeHaxElement.__type!==typeof void 0&&(c.__type=this.activeHaxElement.__type),c.replacement=b,this.fire("hax-insert-content",c);let d="New element added!";this.editExistingNode&&(d="Element updated!"),window.HaxStore.toast(d,2e3),this.close()},resetManager:function(a=0){this.selectStep("select"),this.activePage=a,document.body.style.overflow=null,this.appList=window.HaxStore.instance.appList,this.searching=!1,window.HaxStore.write("activeApp",null,this),window.dispatchEvent(new Event("resize")),this.editExistingNode=!1,this.$.url.value="",this.$.fileupload.headers="",this.$.fileupload.method="",this.$.fileupload.target="",this.__allowUpload=!1},cancel:function(){this.close()},_openedChanged:function(a,b){b&&!a?document.body.style.overflow=null:a&&!b&&(document.body.style.overflow="hidden")},close:function(a){var b=dom(a),c=b.localTarget;(typeof a===typeof void 0||c===this.$.dialog||c===this.$.closedialog)&&(window.HaxStore.write("activeHaxElement",{},this),this.opened=!1,this.resetManager())},open:function(){this.opened=!0},newAssetConfigure:function(){let a={source:this.$.url.value};var b=window.HaxStore.guessGizmoType(a);let c=window.HaxStore.guessGizmo(b,a);0<c.length?1===c.length?typeof c[0].tag!==typeof void 0&&window.HaxStore.write("activeHaxElement",c[0],this):window.HaxStore.instance.haxAppPicker.presentOptions(c,b,"Pick how to present the "+b,"gizmo"):window.HaxStore.toast("Sorry, HAX doesn't know how to handle that type of link yet.")},toggleDialog:function(a=!0){this.opened&&a?this.close():window.HaxStore.instance.closeAllDrawers(this)},selectStep:function(a){this.activeStep=!("configure"!=a)},_activeStepChanged:function(a){(a||!a)&&(this.updateStyles(),window.dispatchEvent(new Event("resize")))},_resolveObjectPath:function(a,b){return a.split(".").reduce(function(c,d){return c?c[d]:null},b||self)}});