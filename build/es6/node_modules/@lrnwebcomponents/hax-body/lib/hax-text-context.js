import{LitElement as e,html as t,css as o}from"../../../lit-element/lit-element.js";import{winEventsElement as i}from"../../utils/utils.js";class HaxTextContext extends(i(e)){static get styles(){return[o`
        :host {
          display: block;
          pointer-events: none;
          --hax-contextual-action-color: var(
            --simple-colors-default-theme-cyan-8,
            #007999
          );
        }
        hax-context-item-textop:not(:defined),
        hax-context-item-menu:not(:defined),
        hax-context-item:not(:defined),
        hax-toolbar:not(:defined),
        paper-item:not(:defined),
        iron-icon:not(:defined) {
          display: none;
        }
        :host [hidden] {
          display: none;
        }
        .selected-buttons {
          transition: 0.1s all ease-in-out;
          width: 0;
        }
        :host([has-selected-text]) .selected-buttons {
          width: 100%;
        }
        #toolbar {
          overflow: hidden;
        }
        paper-item {
          color: white;
          background-color: var(--hax-contextual-action-color);
          -webkit-justify-content: flex-start;
          justify-content: flex-start;
          font-size: 11px;
          line-height: 24px;
          margin: 0;
          padding: 0 4px;
          min-height: 24px;
        }
        paper-item:hover {
          cursor: pointer;
          color: black;
        }
        iron-icon {
          width: 20px;
          height: 20px;
          padding: 4px;
        }
        paper-item strong {
          padding: 4px;
        }
        hax-context-item-textop,
        hax-context-item {
          transition: all 0.2s linear;
          visibility: visible;
          opacity: 1;
        }
        hax-context-item-textop[hidden],
        hax-context-item[hidden] {
          visibility: hidden;
          opacity: 0;
        }
        :host(.hax-context-pin-top) hax-toolbar {
          position: fixed;
          top: 40px;
          flex-direction: column;
        }
      `]}constructor(){super(),this.__winEvents={"hax-store-property-updated":"_haxStorePropertyUpdated"},import("../../../@polymer/paper-item/paper-item.js"),import("../../../@polymer/iron-icon/iron-icon.js"),import("./hax-context-item-menu.js"),import("./hax-context-item.js"),import("./hax-context-item-textop.js"),import("./hax-toolbar.js"),setTimeout(()=>{this.addEventListener("hax-context-item-selected",this._haxContextOperation.bind(this))},0),this.realSelectedValue="p",this.selection=!1,this.formatIcon="hax:format-textblock",this.isSafari=this._isSafari()}_haxStorePropertyUpdated(e){e.detail&&void 0!==e.detail.value&&e.detail.property&&(this[e.detail.property]=e.detail.value)}render(){return t`
      <hax-toolbar
        .selected="${this.selection}"
        ?hide-more="${!this.hasSelectedText}"
        id="toolbar"
      >
        <hax-context-item-menu
          action
          mini
          slot="primary"
          .selected-value="${this.selectedValue}"
          @selected-value-changed="${this.selectedValueChanged}"
          id="formatsize"
          icon="${this.formatIcon}"
          label="Text format"
          event-name="text-tag"
        >
          <paper-item hidden value=""></paper-item>
          <paper-item value="p"
            ><iron-icon icon="hax:paragraph"></iron-icon>Paragraph</paper-item
          >
          <paper-item value="ul"
            ><iron-icon icon="editor:format-list-bulleted"></iron-icon>Bulleted
            list</paper-item
          >
          <paper-item value="ol"
            ><iron-icon icon="editor:format-list-numbered"></iron-icon>Numbered
            list</paper-item
          >
          <paper-item value="h2"
            ><iron-icon icon="hax:h2"></iron-icon>Title
          </paper-item>
          <paper-item value="h3"
            ><iron-icon icon="hax:h3"></iron-icon>Content heading
          </paper-item>
          <paper-item value="h4"
            ><iron-icon icon="hax:h4"></iron-icon>Subheading
          </paper-item>
          <paper-item value="h5"
            ><iron-icon icon="hax:h5"></iron-icon>Deep subheading
          </paper-item>
          <paper-item value="blockquote"
            ><iron-icon icon="editor:format-quote"></iron-icon>Blockquote
          </paper-item>
          <paper-item value="code"
            ><iron-icon icon="icons:code"></iron-icon>Code
          </paper-item>
        </hax-context-item-menu>
        <hax-context-item-textop
          mini
          action
          slot="primary"
          icon="editor:format-list-bulleted"
          event-name="text-tag-ul"
          label="Bulleted list"
          .hidden="${!this._showLists}"
        ></hax-context-item-textop>
        <hax-context-item-textop
          mini
          action
          slot="primary"
          icon="editor:format-list-numbered"
          label="Numbered list"
          event-name="text-tag-ol"
          .hidden="${!this._showLists}"
        ></hax-context-item-textop>
        <hax-context-item-textop
          mini
          action
          slot="primary"
          icon="editor:format-indent-decrease"
          label="Outdent"
          event-name="text-outdent"
          .hidden="${!this._showIndent}"
        ></hax-context-item-textop>
        <hax-context-item-textop
          mini
          action
          slot="primary"
          icon="editor:format-indent-increase"
          label="Indent"
          event-name="text-indent"
          .hidden="${!this._showIndent}"
        ></hax-context-item-textop>
        <hax-context-item-textop
          mini
          action
          slot="primary"
          icon="editor:format-bold"
          label="Bold"
          class="selected-buttons"
          event-name="text-bold"
          ?disabled="${!this.hasSelectedText}"
        ></hax-context-item-textop>
        <hax-context-item-textop
          mini
          action
          slot="primary"
          icon="editor:format-italic"
          label="Italic"
          class="selected-buttons"
          event-name="text-italic"
          ?disabled="${!this.hasSelectedText}"
        ></hax-context-item-textop>
        <hax-context-item-textop
          mini
          action
          slot="primary"
          icon="editor:insert-link"
          label="Link"
          class="selected-buttons"
          event-name="text-link"
          ?disabled="${!this.hasSelectedText}"
        ></hax-context-item-textop>
        <hax-context-item-textop
          mini
          action
          slot="primary"
          icon="mdextra:unlink"
          label="Remove link"
          class="selected-buttons"
          event-name="text-unlink"
          ?disabled="${!this.hasSelectedText}"
        ></hax-context-item-textop>
        <hax-context-item-textop
          mini
          action
          slot="primary"
          icon="editor:format-clear"
          label="Remove format"
          class="selected-buttons"
          event-name="text-remove-format"
          ?disabled="${!this.hasSelectedText}"
        ></hax-context-item-textop>
        <hax-context-item
          mini
          action
          slot="primary"
          icon="hax:add-brick"
          label="Add element to selection"
          class="selected-buttons"
          event-name="insert-inline-gizmo"
          ?hidden="${this.isSafari||!this.hasSelectedText}"
        ></hax-context-item>
        <hax-context-item-textop
          mini
          action
          slot="primary"
          icon="hax:add-brick"
          label="Add element to selection"
          class="selected-buttons"
          event-name="insert-inline-gizmo"
          ?hidden="${!this.isSafari||!this.hasSelectedText}"
        ></hax-context-item-textop>
        <hax-context-item-textop
          action
          menu
          slot="more"
          icon="mdextra:subscript"
          event-name="text-subscript"
          >Subscript</hax-context-item-textop
        >
        <hax-context-item-textop
          action
          menu
          slot="more"
          icon="mdextra:superscript"
          event-name="text-superscript"
          >Superscript</hax-context-item-textop
        >
        <hax-context-item-textop
          action
          menu
          slot="more"
          icon="editor:format-underlined"
          event-name="text-underline"
          >Underline</hax-context-item-textop
        >
        <hax-context-item-textop
          action
          menu
          slot="more"
          icon="editor:format-strikethrough"
          event-name="text-strikethrough"
          >Cross out</hax-context-item-textop
        >
      </hax-toolbar>
    `}selectedValueChanged(e){this.selectedValue=e.detail}static get tag(){return"hax-text-context"}static get properties(){return{_showIndent:{type:Boolean},_showLists:{type:Boolean},realSelectedValue:{type:String},hasSelectedText:{type:Boolean,attribute:"has-selected-text",reflect:!0},haxSelectedText:{type:String},selectedValue:{type:Number,attribute:"selected-value"},selection:{type:Boolean},formatIcon:{type:String,attribute:"format-icon"},isSafari:{type:Boolean,attribute:"is-safari"}}}updated(e){e.forEach((e,t)=>{if(this.realSelectedValue&&"realSelectedValue"==t&&this.shadowRoot)for(var o in this._showIndent=this._computeShowIndent(this.realSelectedValue),this._showIndent||"p"==this.realSelectedValue?this._showLists=!0:this._showLists=!1,this.shadowRoot.querySelector("#formatsize").children)this.shadowRoot.querySelector("#formatsize").children[o]&&this.shadowRoot.querySelector("#formatsize").children[o].getAttribute&&this.shadowRoot.querySelector("#formatsize").children[o].getAttribute("value")==this.realSelectedValue&&(this.selectedValue=o);"haxSelectedText"==t&&(this.hasSelectedText=this[t].length>0),"selectedValue"==t&&""!=this.selectedValue&&(this.realSelectedValue=this.shadowRoot.querySelector("#formatsize").children[this.selectedValue].getAttribute("value"),this.formatIcon=this.shadowRoot.querySelector("#formatsize").children[this[t]].querySelector("iron-icon").icon,this.dispatchEvent(new CustomEvent("selected-value-changed",{detail:this[t]})))})}_computeShowIndent(e){return!(!window.HaxStore.instance.computePolyfillSafe()||"ol"!=e&&"ul"!=e)}_haxContextOperation(e){let t=e.detail,o=window.HaxStore.getSelection(),i=!1;switch(t.eventName){case"close-menu":setTimeout(()=>{this.shadowRoot.querySelector("#formatsize").shadowRoot.querySelector("#menu").hideMenu()},200);break;case"insert-inline-gizmo":if(window.HaxStore._tmpSelection&&window.HaxStore.instance.editMode)try{"HAX-BODY"!==window.HaxStore._tmpRange.startContainer.parentNode.parentNode.tagName&&"HAX-BODY"!==window.HaxStore._tmpRange.startContainer.parentNode.parentNode.parentNode.tagName||(window.HaxStore.instance.activePlaceHolder=window.HaxStore._tmpRange,window.HaxStore.write("activePlaceHolder",window.HaxStore._tmpRange,this))}catch(e){}if(null!=window.HaxStore.instance.activePlaceHolder){let e={text:window.HaxStore.instance.activePlaceHolder.toString()},t="inline",o=window.HaxStore.guessGizmo(t,e);o.length>0&&window.HaxStore.instance.haxAppPicker.presentOptions(o,t,"Transform selected text to..","gizmo")}break;case"text-bold":document.execCommand("bold"),i=!0;break;case"text-italic":document.execCommand("italic"),i=!0;break;case"text-underline":document.execCommand("underline"),i=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-subscript":document.execCommand("subscript"),i=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-superscript":document.execCommand("superscript"),i=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-remove-format":document.execCommand("removeFormat"),i=!0;break;case"text-strikethrough":document.execCommand("strikeThrough"),i=!0,this.shadowRoot.querySelector("#toolbar").shadowRoot.querySelector("#moremenu").shadowRoot.querySelector("#menu").hideMenu();break;case"text-link":var a="";o&&o.focusNode&&o.focusNode.parentNode&&void 0!==o.focusNode.parentNode.href&&(a=o.focusNode.parentNode.href);let e=prompt("Enter a URL:",a);e&&(document.execCommand("createLink",!1,e),o.focusNode.parentNode&&(o.focusNode.parentNode.setAttribute("contenteditable",!0),o.focusNode.parentNode.setAttribute("data-editable",!0),o.focusNode.parentNode.removeEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()}),o.focusNode.parentNode.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()})),i=!0);break;case"text-unlink":document.execCommand("unlink"),i=!0;break;case"text-indent":document.execCommand("indent"),i=!0;break;case"text-outdent":document.execCommand("outdent"),i=!0}i&&(e.preventDefault(),e.stopPropagation())}_isSafari(){let e=navigator.userAgent.toLowerCase();return!(-1==e.indexOf("safari")||e.indexOf("chrome")>-1)}}window.customElements.define(HaxTextContext.tag,HaxTextContext);export{HaxTextContext};