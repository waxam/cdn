import{html as e,css as t}from"../../lit-element/lit-element.js";import{SimpleColors as o}from"../simple-colors/simple-colors.js";import{encapScript as i,wipeSlot as a,generateResourceID as n,nodeToHaxElement as s,haxElementToNode as r}from"../utils/utils.js";var d=null;class HaxBody extends o{static get styles(){return[...super.styles,t`
        :host([edit-mode]),
        :host([edit-mode]) * ::slotted(*) {
          line-height: 1.8;
        }
        :host([edit-mode]) ul,
        :host([edit-mode]) ol {
          padding-left: 20px;
          margin-left: 20px;
        }
        :host([edit-mode]) ul {
          list-style-type: disc;
        }
        :host([edit-mode]) li {
          margin-bottom: 6px;
        }
        :host {
          display: block;
          position: relative;
          min-height: 32px;
          min-width: 32px;
          outline: none;
          --hax-contextual-action-text-color: var(
            --simple-colors-default-theme-grey-1,
            #fff
          );
          --hax-contextual-action-hover-color: var(
            --simple-colors-default-theme-cyan-7,
            #009dc7
          );
          --hax-contextual-action-color: var(
            --simple-colors-default-theme-cyan-8,
            #007999
          );
          --hax-body-editable-outline: 1px solid
            var(--simple-colors-default-theme-deep-orange, #ff8a64);
          --hax-body-active-outline-hover: 1px solid
            var(
              --hax-contextual-action-hover-color,
              var(--simple-colors-default-theme-cyan-7, #009dc7)
            );
          --hax-body-active-outline: 3px solid
            var(
              --hax-contextual-action-hover-color,
              var(--simple-colors-default-theme-cyan-7, #009dc7)
            );
          --hax-body-target-background-color: var(
            --simple-colors-default-theme-cyan-2,
            #9beaff
          );
          --hax-body-possible-target-background-color: var(
            --simple-colors-default-theme-grey-2,
            #dddddd;
          );
        }
        .hax-context-menu {
          padding: 0;
          margin-left: -5000px;
          position: fixed;
          visibility: hidden;
          opacity: 0;
          z-index: 1000;
          float: left;
          display: block;
          pointer-events: none;
          transition: 0.2s top ease-in-out, 0.2s left ease-in-out,
            0.2s visibility ease-in-out, 0.2s opacity ease-in-out;
        }
        #textcontextmenu.hax-context-menu {
          z-index: 1000;
        }
        .hax-context-visible {
          position: absolute;
          visibility: visible;
          pointer-events: all;
          opacity: 1;
        }
        .hax-context-visible.hax-active-hover {
          margin-left: unset;
        }
        :host([edit-mode]) #bodycontainer ::slotted(p) {
          min-height: var(--hax-base-styles-p-min-height, 1rem);
          font-size: var(--hax-base-styles-p-font-size);
          line-height: var(--hax-base-styles-p-line-height);
          letter-spacing: var(--hax-base-styles-p-letter-spacing);
        }
        :host([edit-mode]) #bodycontainer ::slotted(a) {
          color: var(--hax-base-styles-a-color);
          font-size: var(
            --hax-base-styles-a-font-size,
            var(--hax-base-styles-p-font-size)
          );
          font-weight: var(--hax-base-styles-a-font-weight);
        }
        :host([edit-mode]) #bodycontainer ::slotted(a:visited) {
          color: var(--hax-base-styles-a-color-visited);
        }
        :host([edit-mode]) #bodycontainer ::slotted(a:active),
        :host([edit-mode]) #bodycontainer ::slotted(a:focus),
        :host([edit-mode]) #bodycontainer ::slotted(a:hover) {
          color: var(--hax-base-styles-a-color-active);
          font-weight: var(--hax-base-styles-a-font-weight-active);
        }
        :host([edit-mode]) #bodycontainer ::slotted(ol),
        :host([edit-mode]) #bodycontainer ::slotted(ul),
        :host([edit-mode]) #bodycontainer ::slotted(li) {
          padding-bottom: var(--hax-base-styles-list-padding-bottom);
          line-height: var(
            --hax-base-styles-list-line-height,
            var(--hax-base-styles-p-line-height)
          );
          font-size: var(
            --hax-base-styles-list-font-size,
            var(--hax-base-styles-p-font-size)
          );
        }
        :host([edit-mode]) #bodycontainer ::slotted(ol > li:last-child),
        :host([edit-mode]) #bodycontainer ::slotted(ul > li:last-child) {
          padding-bottom: var(--hax-base-styles-list-last-child-padding-bottom);
        }
        :host([edit-mode]) #bodycontainer ::slotted(img[data-editable]) {
          max-width: 100%;
        }
        :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {
          outline: none;
          transition: 0.8s ease-in-out outline;
          caret-color: var(--hax-color-text);
        }
        :host([edit-mode]) #bodycontainer ::slotted(*.blinkfocus) {
          outline: 8px solid var(--hax-contextual-action-hover-color);
        }
        :host([edit-mode])
          #bodycontainer
          ::slotted(*:not(grid-plate)[data-editable]:hover) {
          outline: var(--hax-body-active-outline-hover);
          caret-color: #000000;
        }
        :host([edit-mode])
          #bodycontainer
          ::slotted(*.hax-active[data-editable]:hover) {
          cursor: text !important;
          outline: var(--hax-body-active-outline-hover);
        }
        :host([edit-mode])
          #bodycontainer
          ::slotted(*:not(grid-plate)[data-editable] .hax-active:hover) {
          cursor: text !important;
          outline: var(--hax-body-active-outline-hover);
        }
        :host([edit-mode])
          #bodycontainer
          ::slotted(code.hax-active[data-editable]) {
          display: block;
        }
        :host([edit-mode])
          #bodycontainer
          ::slotted(*.hax-active[data-editable]) {
          outline: var(--hax-body-active-outline) !important;
        }
        :host([edit-mode]) #bodycontainer ::slotted(hr[data-editable]) {
          height: 2px;
          background-color: #eeeeee;
          padding-top: 4px;
          padding-bottom: 4px;
        }
        /** Fix to support safari as it defaults to none */
        :host([edit-mode]) #bodycontainer ::slotted(*[data-editable]) {
          -webkit-user-select: text;
          cursor: pointer;
        }

        :host([edit-mode])
          #bodycontainer
          ::slotted(*[data-editable]::-moz-selection),
        :host([edit-mode])
          #bodycontainer
          ::slotted(*[data-editable] *::-moz-selection) {
          background-color: var(--hax-body-highlight, --paper-yellow-300);
          color: black;
        }
        :host([edit-mode])
          #bodycontainer
          ::slotted(*[data-editable]::selection),
        :host([edit-mode])
          #bodycontainer
          ::slotted(*[data-editable] *::selection) {
          background-color: var(--hax-body-highlight, --paper-yellow-300);
          color: black;
        }
        #bodycontainer {
          -webkit-user-select: text;
          user-select: text;
        }
        :host([edit-mode][hax-ray-mode])
          #bodycontainer
          ::slotted(*[data-editable]):before {
          content: attr(data-hax-ray) " " attr(resource) " " attr(typeof) " "
            attr(property) " " attr(content);
          font-size: 12px;
          line-height: 12px;
          left: unset;
          right: unset;
          top: unset;
          background-color: var(--simple-colors-default-theme-cyan-7, #3b97e3);
          color: #ffffff;
          bottom: unset;
          width: auto;
          padding: 6px;
          margin: -2px;
          z-index: 1;
          margin: 0;
          float: right;
        }
        .hax-context-menu:not(:defined) {
          display: none;
        }
        /* drag and drop */
        :host([edit-mode]) #bodycontainer ::slotted(*.hax-moving) {
          outline: var(--hax-body-active-outline);
          background-color: #eeeeee;
        }
        :host([edit-mode]) #bodycontainer ::slotted(*.hax-mover):before {
          outline: var(--hax-body-editable-outline);
          background-color: var(--hax-body-possible-target-background-color);
          content: " ";
          width: 100%;
          display: block;
          position: relative;
          margin: -30px 0 0 0;
          z-index: 2;
          height: 30px;
        }
        :host([edit-mode]) #bodycontainer ::slotted(*.hax-hovered):before {
          background-color: var(--hax-body-target-background-color) !important;
          outline: var(--hax-body-active-outline);
        }
        @media screen and (min-color-index: 0) and(-webkit-min-device-pixel-ratio:0) {
          /*
            Define here the CSS styles applied only to Safari browsers
            (any version and any device) via https://solvit.io/bcf61b6
          */
          :host([edit-mode]) #bodycontainer ::slotted(*.hax-mover) {
            outline: var(--hax-body-editable-outline);
            background-color: var(--hax-body-possible-target-background-color);
          }
          :host([edit-mode]) #bodycontainer ::slotted(*.hax-hovered) {
            background-color: var(
              --hax-body-target-background-color
            ) !important;
            outline: var(--hax-body-active-outline);
          }
        }
      `]}constructor(){super(),this.___moveLock=!1,this.editMode=!1,this.globalPreferences={},this.haxRayMode=!1,this.activeNode=null,this.haxSelectedText="",this.activeContainerNode=null,setTimeout(()=>{import("./lib/hax-text-context.js"),import("./lib/hax-ce-context.js"),import("./lib/hax-plate-context.js"),import("../grid-plate/grid-plate.js"),this.polyfillSafe=window.HaxStore.instance.computePolyfillSafe(),this.addEventListener("hax-context-item-selected",this._haxContextOperation.bind(this)),this.addEventListener("place-holder-replace",this.replacePlaceholder.bind(this)),this.addEventListener("focusin",this._focusIn.bind(this)),this.addEventListener("mousedown",this._focusIn.bind(this)),this.addEventListener("dragenter",this.dragEnterBody.bind(this)),this.addEventListener("drop",this.dropEvent.bind(this)),this.addEventListener("click",this.clickEvent.bind(this))},0)}static get tag(){return"hax-body"}clickEvent(e){clearTimeout(d)}dragEnterBody(e){const t=this.childNodes;for(var o in t)t[o].classList&&t[o]!==this.activeItem&&t[o].classList.add("hax-mover")}render(){return e`
      <div id="bodycontainer" class="ignore-activation">
        <slot id="body"></slot>
      </div>
      <hax-text-context
        id="textcontextmenu"
        class="hax-context-menu ignore-activation"
      ></hax-text-context>
      <hax-ce-context
        id="cecontextmenu"
        class="hax-context-menu ignore-activation"
      ></hax-ce-context>
      <hax-plate-context
        id="platecontextmenu"
        class="hax-context-menu ignore-activation"
      ></hax-plate-context>
    `}static get properties(){return{...super.properties,openDrawer:{type:Object},haxSelectedText:{type:String},editMode:{type:Boolean,reflect:!0,attribute:"edit-mode"},haxRayMode:{type:Boolean,reflect:!0,attribute:"hax-ray-mode"},globalPreferences:{type:Object},activeNode:{type:Object},activeContainerNode:{type:Object}}}firstUpdated(e){super.firstUpdated&&super.firstUpdated(e),this.dispatchEvent(new CustomEvent("hax-register-body",{bubbles:!0,cancelable:!0,composed:!0,detail:this}));try{document.execCommand("enableObjectResizing",!1,!1),document.execCommand("defaultParagraphSeparator",!1,"p")}catch(e){console.warn(e)}this.shadowRoot.querySelector("slot").addEventListener("mousemove",this.hoverEvent.bind(this)),this.shadowRoot.querySelector("slot").addEventListener("mouseup",e=>{!this.openDrawer&&this.editMode&&setTimeout(()=>{const e=window.HaxStore.getSelection();window.HaxStore._tmpSelection=e,window.HaxStore.write("haxSelectedText",e.toString(),this);try{const e=window.HaxStore.getRange();e.cloneRange&&(window.HaxStore._tmpRange=e.cloneRange())}catch(e){console.warn(e)}},10)}),this.editMode=window.HaxStore.instance.editMode,this.__tabTrap=!1,this.__ready=!0}updated(e){super.updated&&super.updated(e),e.forEach((e,t)=>{"editMode"==t&&this._editModeChanged(this[t],e),"globalPreferences"==t&&this._globalPreferencesUpdated(this[t],e),"activeNode"==t&&this.__ready&&(this._activeNodeChanged(this[t],e),this.dispatchEvent(new CustomEvent("active-node-changed",{detail:{value:this[t]}}))),"activeContainerNode"==t&&this.__ready&&(this._activeContainerNodeChanged(this[t],e),this.dispatchEvent(new CustomEvent("active-container-node-changed",{detail:{value:this[t]}})))})}connectedCallback(){super.connectedCallback(),this._observer=new MutationObserver(e=>{var t=!1;e.forEach(e=>{e.addedNodes.length>0&&e.addedNodes.forEach(e=>{this._validElementTest(e)&&(!this.editMode||"true"!=e.getAttribute("contenteditable")&&!0!==e.getAttribute("contenteditable")&&"contenteditable"!=e.getAttribute("contenteditable")||this.__applyNodeEditableState(e,!this.editMode),this.__applyNodeEditableState(e,this.editMode),this.dispatchEvent(new CustomEvent("hax-body-tag-added",{bubbles:!0,cancelable:!0,composed:!0,detail:{node:e}})),["H1","H2","H3","H4","H5","H6"].includes(e.tagName)&&null==e.getAttribute("id")&&e.setAttribute("id",n("header-")),this.___moveLock||t?this.___moveLock=!1:(t=!0,this.activeNode=e,window.HaxStore.write("activeNode",e,this)))}),e.removedNodes.length>0&&e.removedNodes.forEach(e=>{this._validElementTest(e)&&!e.classList.contains("hax-active")&&this.dispatchEvent(new CustomEvent("hax-body-tag-removed",{bubbles:!0,cancelable:!0,composed:!0,detail:{node:e}}))})})}),this._observer.observe(this,{childList:!0}),setTimeout(()=>{window.addEventListener("keydown",this._onKeyDown.bind(this)),window.addEventListener("keypress",this._onKeyPress.bind(this)),document.body.addEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),window.addEventListener("scroll",this._keepContextVisible.bind(this)),window.addEventListener("resize",this._keepContextVisible.bind(this))},0)}disconnectedCallback(){window.removeEventListener("keydown",this._onKeyDown.bind(this)),window.removeEventListener("keypress",this._onKeyPress.bind(this)),document.body.removeEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),window.removeEventListener("scroll",this._keepContextVisible.bind(this)),window.removeEventListener("resize",this._keepContextVisible.bind(this)),this._observer.disconnect(),super.disconnectedCallback()}_keepContextVisible(e=null){!this.openDrawer&&this.editMode&&(clearTimeout(this.__contextVisibleLock),this.__contextVisibleLock=setTimeout(()=>{let e=!1;this.shadowRoot.querySelector("#textcontextmenu").classList.contains("hax-context-visible")?e=this.shadowRoot.querySelector("#textcontextmenu"):this.shadowRoot.querySelector("#cecontextmenu").classList.contains("hax-context-visible")&&(e=this.shadowRoot.querySelector("#cecontextmenu")),e&&(this.elementMidViewport()?(e.classList.add("hax-context-pin-top"),this.shadowRoot.querySelector("#platecontextmenu").classList.add("hax-context-pin-top")):(e.classList.remove("hax-context-pin-top"),this.shadowRoot.querySelector("#platecontextmenu").classList.remove("hax-context-pin-top")),this.positionContextMenus())},50))}_onKeyDown(e){if(!this.openDrawer&&this.editMode&&this.getAttribute("contenteditable")){if(null!=window.HaxStore.getSelection().anchorNode){switch(e.key){case"Tab":window.HaxStore.instance.isTextElement(this.activeNode)&&(e.detail.keyboardEvent&&(e.detail.keyboardEvent.preventDefault(),e.detail.keyboardEvent.stopPropagation(),e.detail.keyboardEvent.stopImmediatePropagation()),e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),e.shiftKey?this._tabBackKeyPressed():this._tabKeyPressed());break;case"Enter":this.setAttribute("contenteditable",!0);case"Backspace":case"Delete":case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":clearTimeout(this.__keyPress),this.__keyPress=setTimeout(()=>{const e=window.HaxStore.getSelection();window.HaxStore._tmpSelection=e,window.HaxStore.write("haxSelectedText",e.toString(),this);const t=window.HaxStore.getRange();t.commonAncestorContainer&&this.activeNode!==t.commonAncestorContainer&&"function"==typeof t.commonAncestorContainer.focus?"HAX-BODY"!==t.commonAncestorContainer.tagName&&(window.HaxStore.instance.isTextElement(t.commonAncestorContainer)?this.setAttribute("contenteditable",!0):this.removeAttribute("contenteditable"),t.commonAncestorContainer.focus(),this.__focusLogic(t.commonAncestorContainer)):t.commonAncestorContainer&&t.commonAncestorContainer.parentNode&&this.activeNode!==t.commonAncestorContainer.parentNode&&"function"==typeof t.commonAncestorContainer.parentNode.focus&&("HAX-BODY"!==t.commonAncestorContainer.parentNode.tagName?(window.HaxStore.instance.isTextElement(t.commonAncestorContainer.parentNode)?this.setAttribute("contenteditable",!0):this.removeAttribute("contenteditable"),t.commonAncestorContainer.parentNode.focus(),this.__focusLogic(t.commonAncestorContainer.parentNode)):(this.activeNode=t.commonAncestorContainer,this.activeContainerNode=this.activeNode,window.HaxStore.write("activeNode",t.commonAncestorContainer,this),window.HaxStore.write("activeContainerNode",t.commonAncestorContainer,this),setTimeout(()=>{this.positionContextMenus()},0)))},50)}this.shadowRoot.querySelector("#platecontextmenu").classList.contains("hax-active-hover")&&this.__dropActiveHover()}}}_onKeyPress(e){clearTimeout(this.__keyPress),this.__keyPress=setTimeout(()=>{!this.openDrawer&&this.editMode&&this.shadowRoot.querySelector("#textcontextmenu").classList.contains("hax-active-hover")&&this.activeNode&&window.HaxStore.instance.isTextElement(this.activeNode)?this.__dropActiveHover():!this.openDrawer&&this.editMode&&this.activeNode&&window.HaxStore.instance.isTextElement(this.activeNode)&&(clearTimeout(this.__positionContextTimer),this.__positionContextTimer=setTimeout(()=>{this.positionContextMenus()},1500))},50)}hoverEvent(e){if(!this.openDrawer&&this.editMode&&(e.target&&null!=e.target.getAttribute("data-hax-ray")?this.__activeHover=e.target:e.target&&e.target.parentNode&&null!=e.target.parentNode.getAttribute("data-hax-ray")&&(this.__activeHover=e.target.parentNode),!this.shadowRoot.querySelector("#platecontextmenu").classList.contains("hax-active-hover"))){let t=e.target;e.target===this.shadowRoot.querySelector("#cecontextmenu")||e.target===this.shadowRoot.querySelector("#textcontextmenu")||e.target===this.shadowRoot.querySelector("#platecontextmenu")||t===this.activeNode||t===this.activeContainerNode||e.target===this.activeNode||e.target===this.activeContainerNode||t.parentNode===this.activeContainerNode||t.parentNode.parentNode===this.activeContainerNode||t.parentNode.parentNode.parentNode===this.activeContainerNode?(this.positionContextMenus(),this.__addActiveHover(),this.__typeLock=!1):this.__dropActiveHover()}}__addActiveHover(){this.shadowRoot.querySelector("#cecontextmenu").classList.add("hax-active-hover"),this.shadowRoot.querySelector("#textcontextmenu").classList.add("hax-active-hover"),this.shadowRoot.querySelector("#platecontextmenu").classList.add("hax-active-hover")}__dropActiveHover(){this.shadowRoot.querySelector("#cecontextmenu").classList.remove("hax-active-hover"),this.shadowRoot.querySelector("#textcontextmenu").classList.remove("hax-active-hover"),this.shadowRoot.querySelector("#platecontextmenu").classList.remove("hax-active-hover")}elementMidViewport(){const e=this.activeNode.getBoundingClientRect().y;return e<0&&e>-1*this.activeNode.offsetHeight+140}replacePlaceholder(e){if("text"===e.detail){let e=document.createElement("p");e.innerHTML="<br/>",this.haxReplaceNode(this.activeNode,e),setTimeout(()=>{this.activeNode=e,window.HaxStore.write("activeNode",e,this),this.activeContainerNode.setAttribute("contenteditable",!0),e.focus(),this.__focusLogic(e)},210)}else this.replaceElementWorkflow()}canTansformNode(e=null){return this.replaceElementWorkflow(e,!0).length>0}replaceElementWorkflow(e=null,t=!1){null==e&&(e=this.activeNode);let o=s(e,null),i="*",a=!1;"place-holder"===o.tag&&void 0!==o.properties.type&&(i=o.properties.type,a=!0);var n={};if(void 0!==window.HaxStore.instance.elementList[o.tag]&&!1!==window.HaxStore.instance.elementList[o.tag].gizmo&&void 0!==window.HaxStore.instance.elementList[o.tag].gizmo.handles&&window.HaxStore.instance.elementList[o.tag].gizmo.handles.length>0){let e=window.HaxStore.instance.elementList[o.tag].gizmo;for(var r=0;r<e.handles.length;r++)for(var d in e.handles[r])"type"!==d&&void 0!==o.properties[e.handles[r][d]]&&(n[d]=o.properties[e.handles[r][d]])}let l=window.HaxStore.guessGizmo(i,n,a);if(l.length>0){let o=e.tagName.toLowerCase(),i=o.replace("-"," ");void 0!==window.HaxStore.instance.elementList[o]&&!1!==window.HaxStore.instance.elementList[o].gizmo&&(i=window.HaxStore.instance.elementList[o].gizmo.title),t||(window.HaxStore.instance.activePlaceHolder=this.activeNode,window.HaxStore.instance.haxAppPicker.presentOptions(l,"__convert",`Transform ${i} to..`,"gizmo"))}else t||window.HaxStore.toast("Sorry, this can not be transformed!",5e3);return l}_globalPreferencesUpdated(e,t){void 0!==e&&null!=e&&(this.haxRayMode=e.haxRayMode)}_haxStorePropertyUpdated(e){e.detail&&void 0!==e.detail.value&&e.detail.property&&(this[e.detail.property]=e.detail.value)}haxClearBody(e=!0){let t=!0;e&&(t=prompt("Are you sure you want to delete all content?")),t&&a(this)}haxInsert(e,t,o={}){this.__activeHover=null;var i=document.createElement(e);i.innerHTML=t;const a=i.cloneNode(!0);for(var n in o){let e=window.HaxStore.camelToDash(n);o.hasOwnProperty(n)&&(!0===o[n]?a.setAttribute(e,e):!1===o[n]?a.removeAttribute(e):null!=o[n]&&o[n].constructor===Array?a.properties&&a.properties[n].readOnly||(a.set?a.set(e,o[n]):a[e]=o[n]):null!=o[n]&&o[n].constructor===Object?a.properties&&a.properties[n].readOnly||(a.set?a.set(e,o[n]):a[e]=o[n]):a.setAttribute(e,o[n]))}return null!==window.HaxStore.instance.activePlaceHolder&&void 0!==window.HaxStore.instance.activePlaceHolder.style?(a.style.width=window.HaxStore.instance.activePlaceHolder.style.width,a.style.float=window.HaxStore.instance.activePlaceHolder.style.float,a.style.margin=window.HaxStore.instance.activePlaceHolder.style.margin,a.style.display=window.HaxStore.instance.activePlaceHolder.style.display,this.haxReplaceNode(window.HaxStore.instance.activePlaceHolder,a),window.HaxStore.instance.activePlaceHolder=null):null!=this.activeContainerNode?"GRID-PLATE"===this.activeContainerNode.tagName&&this.activeContainerNode!==this.activeNode?(null!=this.activeNode.getAttribute("slot")&&a.setAttribute("slot",this.activeNode.getAttribute("slot")),this.activeNode.parentNode==this.activeContainerNode?this.activeContainerNode.insertBefore(a,this.activeNode):this.activeContainerNode.appendChild(a)):this.activeContainerNode&&this.activeContainerNode.nextElementSibling?this.activeContainerNode.nextElementSibling.parentNode.insertBefore(a,this.activeContainerNode.nextElementSibling):this.activeContainerNode.parentNode?this.activeContainerNode.parentNode.insertBefore(a,this.activeContainerNode):this.activeNode.parentNode?this.activeNode.parentNode.insertBefore(a,this.activeNode):this.appendChild(a):this.appendChild(a),this.shadowRoot.querySelector("#textcontextmenu").highlightOps=!1,this.activeContainerNode=a.parentNode,this.activeNode=a,window.HaxStore.write("activeContainerNode",a.parentNode,this),window.HaxStore.write("activeNode",a,this),setTimeout(()=>{"function"==typeof a.scrollIntoViewIfNeeded?a.scrollIntoViewIfNeeded(!0):a.scrollIntoView({behavior:"smooth",inline:"center"}),this.positionContextMenus()},10),!0}haxToContent(){this.hideContextMenus();var e=this.activeNode;this.activeNode=null,this.activeContainerNode=null,window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this);let t="slot"===this.shadowRoot.querySelector("#body").localName?this.shadowRoot.querySelector("#body").assignedNodes({flatten:!0}):[];for(var o="",a=0,n=t.length;a<n;a++)this._validElementTest(t[a])?(t[a].removeAttribute("data-editable"),t[a].removeAttribute("data-hax-ray"),t[a].classList.remove("hax-mover","hax-moving","hax-hovered","grid-plate-active-item"),t[a].contentEditable=!1,o+=window.HaxStore.nodeToContent(t[a]),"grid-plate"===t[a].tagName.toLowerCase()&&this._applyContentEditable(this.editMode,t[a])):8===t[a].nodeType?o+="\x3c!-- "+t[a].textContent+" --\x3e":1!==t[a].nodeType&&void 0!==t[a].textContent&&"undefined"!==t[a].textContent&&(o+=t[a].textContent);if(o=(o=(o=(o=(o=(o=(o=(o=o.replace(/\scontenteditable=\"false\"/g,"")).replace(/\sdata-editable=\"true\"/g,"")).replace(/\sdata-editable=\"false\"/g,"")).replace(/\sdata-editable=\""/g,"")).replace(/\sdata-editable/g,"")).replace(/\scontenteditable/g,"")).replace(/\sdraggable/g,"")).replace(/\sdata-hax-ray=\".*?\"/g,""),this.parentNode.tagName){let e=this.parentNode.tagName.toLowerCase(),t="style-scope "+e+" x-scope",i=new RegExp(t,"g");o=o.replace(i,""),t="style-scope "+e,i=new RegExp(t,"g"),o=o.replace(i,""),t="x-scope "+e+"-0",i=new RegExp(t,"g"),o=o.replace(i,"");let n=window.HaxStore.instance.validTagList;for(var a in n)t="style-scope "+n[a],i=new RegExp(t,"g"),o=o.replace(i,""),t="x-scope "+n[a]+"-0 ",i=new RegExp(t,"g"),o=o.replace(i,""),t="x-scope "+n[a]+"-0",i=new RegExp(t,"g"),o=o.replace(i,"")}return o=(o=o.replace(/\sclass=\"\"/g,"")).replace(/\sclass=\"\s\"/g,""),this._applyContentEditable(this.editMode),window.HaxStore.write("activeNode",e,this),window.HaxStore.write("activeContainerNode",e,this),o=i(o)}haxDuplicateNode(e,t=this){this.hideContextMenus(!1);let o=s(e,null);void 0!==e.preProcessHaxInsertContent&&(o=e.preProcessHaxInsertContent(o)),o.content==o.properties.innerHTML&&delete o.properties.innerHTML;var i=r({tag:o.tag,content:o.content,properties:o.properties});return"webview"===i.tagName.toLowerCase()&&window.HaxStore.instance._isSandboxed&&void 0!==i.guestinstance&&delete i.guestinstance,null!==e?t.insertBefore(i,e.nextSibling):t.appendChild(i),setTimeout(()=>{t===this&&window.HaxStore.write("activeContainerNode",i,this),window.HaxStore.write("activeNode",i,this)},100),!0}hideContextMenus(e=!0){clearTimeout(d),clearTimeout(this.__keyPress),clearTimeout(this.__contextVisibleLock),clearTimeout(this.__positionContextTimer),this._hideContextMenu(this.shadowRoot.querySelector("#textcontextmenu")),this._hideContextMenu(this.shadowRoot.querySelector("#cecontextmenu")),e&&this._hideContextMenu(this.shadowRoot.querySelector("#platecontextmenu")),this.shadowRoot.querySelector("#textcontextmenu").highlightOps=!1}positionContextMenus(e=this.activeNode,t=this.activeNode){clearTimeout(this.__positionContextTimer),this.__positionContextTimer=setTimeout(()=>{if(e&&!window.HaxStore.instance._lockContextPosition&&this.__ready){let o=140,i=e.tagName.toLowerCase();window.HaxStore.instance._isSandboxed&&"webview"===i&&(i="iframe");let a=window.HaxStore.instance.elementList[i];if(void 0===a||window.HaxStore.instance.isTextElement(e)){this._hideContextMenu(this.shadowRoot.querySelector("#cecontextmenu")),this._positionContextMenu(this.shadowRoot.querySelector("#textcontextmenu"),t,-1,-30),o+=this.shadowRoot.querySelector("#textcontextmenu").getBoundingClientRect().width}else this._hideContextMenu(this.shadowRoot.querySelector("#textcontextmenu")),a.element=e,this._positionContextMenu(this.shadowRoot.querySelector("#cecontextmenu"),t,-1,-30),o+=28;if(t){let e=t.getBoundingClientRect();Math.round(o)>=Math.round(e.width)?this._positionContextMenu(this.shadowRoot.querySelector("#platecontextmenu"),t,-1,-58):this._positionContextMenu(this.shadowRoot.querySelector("#platecontextmenu"),t,e.width-this.shadowRoot.querySelector("#platecontextmenu").getBoundingClientRect().width+2,-28)}t&&!window.HaxStore.instance.isTextElement(e)&&e!==t?t.removeAttribute("contenteditable"):t&&t.setAttribute("contenteditable",!0)}},10)}haxMoveGridPlate(e,t,o){switch(this.___moveLock=!0,e){case"first":null!==o.previousElementSibling&&this.insertBefore(o,this.firstChild);break;case"up":null!==o.previousElementSibling&&this.insertBefore(o,o.previousElementSibling);break;case"down":null!==o.nextElementSibling&&this.insertBefore(o.nextElementSibling,o);break;case"last":null!==o.nextElementSibling&&this.appendChild(o)}return setTimeout(()=>{"function"==typeof t.scrollIntoViewIfNeeded?t.scrollIntoViewIfNeeded(!0):t.scrollIntoView({behavior:"smooth",inline:"center"}),this.positionContextMenus(t,t)},10),!0}async haxGridPlateOps(e,t,o=!0){let i=!1;if("GRID-PLATE"===e.tagName){if(o)switch(e.layout){case"1":e.layout="1-1",i=!0;break;case"1-1":e.layout="1-1-1",i=!0;break;case"1-1-1":e.layout="1-1-1-1",i=!0;break;case"1-1-1-1":e.layout="1-1-1-1-1",i=!0;break;case"1-1-1-1-1":e.layout="1-1-1-1-1-1",i=!0}else switch(e.layout){case"1-1":let t;await e.childNodes.forEach(o=>{o.tagName&&(t=o.cloneNode(!0),t.removeAttribute("slot"),t.classList.remove("hax-mover"),t.classList.remove("hax-moving"),e.parentNode.insertBefore(t,e))}),this.activeNode=t,this.activeContainerNode=t,window.HaxStore.write("activeNode",t,this),window.HaxStore.write("activeContainerNode",t,this),setTimeout(()=>{e.remove()},0),i=!0;break;case"1-1-1":e.layout="1-1",i=!0;break;case"1-1-1-1":e.layout="1-1-1",i=!0;break;case"1-1-1-1-1":e.layout="1-1-1-1",i=!0;break;case"1-1-1-1-1-1":e.layout="1-1-1-1-1",i=!0}if(i){let o=this.shadowRoot.querySelector("#platecontextmenu"),i=o.shadowRoot.querySelector("#right"),a=o.shadowRoot.querySelector("#rightremove");i.disabled=!1,a.disabled=!1,"1-1-1-1-1-1"==e.layout&&(i.disabled=!0),"left"==t&&e.childNodes.forEach(e=>{if(e.tagName){let t=parseInt(e.getAttribute("slot").replace("col-",""),10)+1;e.setAttribute("slot",`col-${t}`)}})}}else{let o=document.createElement("grid-plate");o.layout="1-1",this.insertBefore(o,e);let i="2";"right"==t&&(i="1"),setTimeout(()=>{o.appendChild(e),this.activeContainerNode=o,window.HaxStore.write("activeContainerNode",o,this),e.setAttribute("slot","col-"+i)},0)}}haxReplaceNode(e,t){try{null==e&&(e=this.__oldActiveNode),e.replaceWith(t),e&&e.getAttribute&&null!=e.getAttribute("slot")&&t.setAttribute("slot",e.getAttribute("slot"))}catch(e){console.warn(e)}return t}haxChangeTagName(e,t){for(var o=document.createElement(t),i=0,a=e.attributes.length;i<a;++i){var n=e.attributes.item(i).nodeName,s=e.attributes.item(i).value;o.setAttribute(n,s)}o.innerHTML=e.innerHTML.trim(),"ul"==t||"ol"==t?""==o.innerHTML?o.innerHTML="<li></li>":"ul"!=e.tagName.toLowerCase()&&"ol"!=e.tagName.toLowerCase()&&(o.innerHTML="<li>"+e.innerHTML.trim().replace(/<br\/>/g,"</li>\n<li>").replace(/<br>/g,"</li>\n<li>")+"</li>"):"ul"!=e.tagName.toLowerCase()&&"ol"!=e.tagName.toLowerCase()||(o.innerHTML=o.innerHTML.replace(/<ul>/g,"").replace(/<\/ul>/g,"").replace(/<li><\/li>/g,"").replace(/<li>/g,"").replace(/<\/li>/g,"<br/>"));try{e.replaceWith(o),setTimeout(()=>{let e=o.children;e[0]&&e.tagName?e[0].focus():o.focus()},50)}catch(t){console.warn(t),console.warn(o),console.warn(e)}return o}haxDeleteNode(e,t=this){this.hideContextMenus(),this.activeNode=null,this.activeContainerNode=null,window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this);try{return e.remove()}catch(e){console.warn(e)}}importContent(e,t=!0){t&&a(this,"*"),setTimeout(()=>{e=i(e);let t=document.createElement("div");for(t.insertAdjacentHTML("beforeend",e);null!==t.firstChild;)if(void 0!==t.firstChild.tagName)if(window.HaxStore.instance._isSandboxed&&"iframe"===t.firstChild.tagName.toLowerCase()){for(var o=document.createElement("webview"),a=0,n=t.firstChild.attributes.length;a<n;++a){var s=t.firstChild.attributes.item(a).nodeName,r=t.firstChild.attributes.item(a).value;"height"!==s&&"width"!==s||o.style[s],o.setAttribute(s,r)}this.appendChild(o)}else this.appendChild(t.firstChild);else t.removeChild(t.firstChild)},50)}_haxContextOperation(e){let t=e.detail;switch(t.eventName){case"text-tag":this.shadowRoot.querySelector("#textcontextmenu").realSelectedValue=t.value,this.activeNode=this.haxChangeTagName(this.activeNode,t.value),window.HaxStore.write("activeNode",this.activeNode,this),setTimeout(()=>{this.positionContextMenus()},100);break;case"text-tag-ul":this.shadowRoot.querySelector("#textcontextmenu").realSelectedValue="ul",this.activeNode=this.haxChangeTagName(this.activeNode,"ul"),window.HaxStore.write("activeNode",this.activeNode,this),setTimeout(()=>{this.positionContextMenus()},100);break;case"text-tag-ol":this.shadowRoot.querySelector("#textcontextmenu").realSelectedValue="ol",this.activeNode=this.haxChangeTagName(this.activeNode,"ol"),window.HaxStore.write("activeNode",this.activeNode,this),setTimeout(()=>{this.positionContextMenus()},100);break;case"hax-plate-add-element":if("other"==t.value)return window.HaxStore.instance.haxInsertAnything({}),!0;let e=JSON.parse(t.value);this.haxInsert(e.tag,e.content,e.properties,!1),window.HaxStore.instance.isTextElement(e)&&setTimeout(()=>{try{var e=document.createRange(),t=window.HaxStore.getSelection();e.setStart(this.activeNode,0),e.collapse(!0),t.removeAllRanges(),t.addRange(e),this.activeNode.focus(),this.activeContainerNode=this.activeNode,window.HaxStore.write("activeContainerNode",this.activeContainerNode,this)}catch(e){console.warn(e)}},0);break;case"text-align-left":this.activeNode.style.textAlign=null;break;case"hax-transform-node":this.replaceElementWorkflow();break;case"hax-plate-create-right":this.haxGridPlateOps(this.activeContainerNode,"right");break;case"hax-plate-remove-right":this.haxGridPlateOps(this.activeContainerNode,"right",!1);break;case"hax-plate-duplicate":this.activeNode===this.activeContainerNode?this.haxDuplicateNode(this.activeNode):this.haxDuplicateNode(this.activeNode,this.activeContainerNode);break;case"hax-plate-delete":if(null!=this.activeNode){let e=[{icon:"thumb-up",color:"green",title:"Yes"},{icon:"thumb-down",color:"red",title:"No"}],t=this.activeNode.tagName.toLowerCase(),o=t.replace("-"," ");void 0!==window.HaxStore.instance.elementList[t]&&!1!==window.HaxStore.instance.elementList[t].gizmo&&(o=window.HaxStore.instance.elementList[t].gizmo.title),window.HaxStore.instance.haxAppPicker.presentOptions(e,"",`Remove this \`${o}\`?`,"delete")}break;case"hax-plate-first":this.haxMoveGridPlate("first",this.activeNode,this.activeContainerNode);break;case"hax-plate-up":this.haxMoveGridPlate("up",this.activeNode,this.activeContainerNode);break;case"hax-plate-down":this.haxMoveGridPlate("down",this.activeNode,this.activeContainerNode);break;case"hax-plate-last":this.haxMoveGridPlate("last",this.activeNode,this.activeContainerNode);break;case"close-menu":this.activeNode=null,this.activeContainerNode=null,window.HaxStore.write("activeNode",null,this),window.HaxStore.write("activeContainerNode",null,this)}}_focusIn(e){this.__focusLogic(e.target)&&e.stopPropagation()}__focusLogic(e){let t=!1;if(this.openDrawer||!this.editMode||this.__tabTrap)this.__tabTrap=!1;else{let o=e;"SPAN"===o.tagName&&window.HaxStore.instance.isTextElement(e.parentNode)&&(o=e.parentNode);let i=null;if(this._validElementTest(o)&&o.parentNode&&o.parentNode.tagName){for(;o.parentNode.tagName&&"HAX-BODY"!=o.parentNode.tagName;)null===i&&"LI"!==o.tagName&&"B"!==o.tagName&&"I"!==o.tagName&&"STRONG"!==o.tagName&&"EM"!==o.tagName&&(i=o),o=o.parentNode;null===i?i=o:window.HaxStore.instance.isGridPlateElement(o)||(i=o),this.activeContainerNode===o||o.classList.contains("ignore-activation")?o.classList.contains("ignore-activation")&&(t=!0):(this.activeContainerNode=o,window.HaxStore.write("activeContainerNode",o,this),t=!0),this.activeNode===i||i.classList.contains("ignore-activation")||(this.activeNode=i,window.HaxStore.write("activeNode",i,this),setTimeout(()=>{this.positionContextMenus(i,i)},0),t=!0)}}return t}_editModeChanged(e,t){void 0!==t&&(this._applyContentEditable(e),e&&setTimeout(()=>{this.children&&this.children[0]&&this.children[0].focus?(this.activeNode=this.children[0],this.activeContainerNode=this.activeNode,window.HaxStore.write("activeNode",this.children[0],this),window.HaxStore.write("activeContainerNode",this.children[0],this),setTimeout(()=>{if(window.HaxStore.instance.isTextElement(this.activeNode)){try{var e=document.createRange(),t=window.HaxStore.getSelection();e.setStart(this.activeNode,0),e.collapse(!0),t.removeAllRanges(),t.addRange(e),this.activeNode.focus()}catch(e){console.warn(e)}this.positionContextMenus()}},0)):(this.haxInsert("p","",{},!1),setTimeout(()=>{try{var e=document.createRange(),t=window.HaxStore.getSelection();e.setStart(this.activeNode,0),e.collapse(!0),t.removeAllRanges(),t.addRange(e),this.activeNode.focus(),this.activeContainerNode=this.activeNode,window.HaxStore.write("activeContainerNode",this.activeContainerNode,this)}catch(e){console.warn(e)}this.positionContextMenus()},0))},100)),0==e&&(this.removeAttribute("contenteditable"),setTimeout(()=>{this.hideContextMenus()},50))}_haxResolvePreviousElement(e){for(e=e.previousElementSibling;null!=e&&void 0!==e.tagName&&"HAX-"===e.tagName.substring(0,4);)e=e.previousElementSibling;return e}_validElementTest(e){return void 0!==e.tagName&&("HAX-"!==e.tagName.substring(0,4)||"HAX-LOGO"===e.tagName)}_HTMLPrimativeTest(e){return null!=e&&void 0!==e.tagName&&-1==e.tagName.indexOf("-")}_applyContentEditable(e,t=this.shadowRoot.querySelector("#body")){let o="slot"===t.localName?t.assignedNodes({flatten:!0}):[];0===o.length&&(o=t.children);for(var i=0,a=o.length;i<a;i++)this._validElementTest(o[i])&&(!e||!0!==o[i].getAttribute("contenteditable")&&"true"!=o[i].getAttribute("contenteditable")&&"contenteditable"!=o[i].getAttribute("contenteditable"))&&this.__applyNodeEditableState(o[i],e)}__applyNodeEditableState(e,t=!0){let o,i=e.tagName.replace("-"," ").toLowerCase(),a=window.HaxStore.instance.gizmoList.findIndex(t=>{if(t)return t.tag===e.tagName.toLowerCase()});if(-1!==a&&(i=window.HaxStore.instance.gizmoList[a].title),t?(e.setAttribute("data-editable",t),e.setAttribute("data-hax-ray",i),o="addEventListener"):(e.removeAttribute("data-editable"),e.removeAttribute("data-hax-ray"),o="removeEventListener"),e[o]("drop",this.dropEvent.bind(this)),e[o]("dragenter",this.dragEnter.bind(this)),e[o]("dragleave",this.dragLeave.bind(this)),e[o]("dragover",(function(e){e.preventDefault()})),this._HTMLPrimativeTest(e)&&(t?e.setAttribute("contenteditable",t):e.removeAttribute("contenteditable"),e.querySelectorAll("a").length>0)){let i=e.querySelectorAll("a");for(var n=0,s=i.length;n<s;n++)t?(i[n].setAttribute("contenteditable",t),i[n].setAttribute("data-editable",t)):(i[n].removeAttribute("contenteditable"),i[n].removeAttribute("data-editable")),i[n][o]("click",e=>{e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation()})}}dropEvent(e){if(!this.openDrawer&&this.editMode){clearTimeout(d),window.HaxStore.instance._lockContextPosition=!1,window.HaxStore.instance.haxTray.activeTab="item-1";var t=null;t=e.path&&e.path[0]?e.path[0]:e.originalTarget?e.originalTarget:e.target,this.activeNode=t,window.HaxStore.write("activeNode",t,this),t.parentNode&&"GRID-PLATE"===t.parentNode.tagName?(this.activeContainerNode=t.parentNode,window.HaxStore.write("activeContainerNode",t.parentNode,this)):(this.activeContainerNode=t.parentNode,window.HaxStore.write("activeContainerNode",t,this)),setTimeout(()=>{let t=this.querySelectorAll(".hax-mover, .hax-hovered, .hax-moving, .grid-plate-active-item");for(var o in t)if(void 0!==t[o].classList&&(t[o].classList.remove("hax-mover","hax-hovered","hax-moving","grid-plate-active-item"),"GRID-PLATE"===t[o].tagName)){t[o].dropEvent(e);for(var i=1;i<=t[o].columns;i++)void 0!==t[o].shadowRoot.querySelector("#col"+i)&&t[o].shadowRoot.querySelector("#col"+i).classList.remove("hax-mover")}},100);try{if(e.dataTransfer&&e.dataTransfer.items&&e.dataTransfer.items.length>0&&"file"===e.dataTransfer.items[0].kind){e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation();let t=document.createElement("p");this.activeNode.parentNode.insertBefore(t,this.activeNode),e.placeHolderElement=t,this.dispatchEvent(new CustomEvent("place-holder-file-drop",{bubbles:!0,cancelable:!0,composed:!0,detail:e}))}else{t=window.HaxStore.instance.__dragTarget;var o=e.target;if(t&&null!=t&&t.removeAttribute&&void 0!==o&&t!==o&&t!==o.parentNode&&t.parentNode===this||o.parentNode===this){t.removeAttribute("slot");try{o.parentNode.insertBefore(t,o)}catch(e){console.warn(e)}e.preventDefault(),e.stopPropagation()}t&&"function"==typeof t.focus&&(this.activeNode=t,this.activeNode&&this.activeNode.parentNode&&"GRID-PLATE"===this.activeNode.parentNode.tagName&&(this.activeContainerNode=this.activeNode.parentNode),window.HaxStore.write("activeNode",this.activeNode,this),window.HaxStore.write("activeContainerNode",this.activeContainerNode,this),setTimeout(()=>{this.positionContextMenus()},100))}}catch(e){console.warn(e)}}window.HaxStore.instance.__dragTarget=null}dragEnter(e){!this.openDrawer&&this.editMode&&e.target&&(e.preventDefault(),e.target&&e.target.classList&&e.target.classList.add("hax-hovered"),this.handleMousemove(e))}handleMousemove(e){var t=e.clientX,o=e.clientY,i=document.documentElement.clientWidth,a=document.documentElement.clientHeight,n=a-100,s=i-100,r=t<100,l=t>s,c=o<100,h=o>n;if(r||l||c||h){var u=Math.max(document.body.scrollWidth,document.body.offsetWidth,document.body.clientWidth,document.documentElement.scrollWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth),v=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.body.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight),m=u-i,x=v-a;!function checkForWindowScroll(){clearTimeout(d),function adjustWindowScroll(){var e=window.pageXOffset,i=window.pageYOffset,a=i>0,d=i<x,u=e>0,v=e<m,p=e,w=i;if(r&&u){p-=25*((100-t)/100)}else if(l&&v){p+=25*((t-s)/100)}if(c&&a){w-=25*((100-o)/100)}else if(h&&d){w+=25*((o-n)/100)}return p=Math.max(0,Math.min(m,p)),w=Math.max(0,Math.min(x,w)),(p!==e||w!==i)&&(window.scrollTo(p,w),!0)}()&&(d=setTimeout(checkForWindowScroll,30))}()}else clearTimeout(d)}dragLeave(e){!this.openDrawer&&this.editMode&&e.target&&e.target.classList&&e.target.classList.remove("hax-hovered")}_activeContainerNodeChanged(e,t){if(this.editMode&&void 0!==e&&null!=e&&null!=e.tagName){window.HaxStore.instance.isTextElement(e)||window.HaxStore.instance.isGridPlateElement(e)?(e.setAttribute("contenteditable",!0),this.setAttribute("contenteditable",!0)):(e.removeAttribute("contenteditable"),this.removeAttribute("contenteditable")),t&&"GRID-PLATE"==t.tagName&&(t.activeItem=null),"grid-plate"===e.tagName.toLowerCase()&&(e.editMode=this.editMode,this._applyContentEditable(this.editMode,e))}}_activeNodeChanged(e,t){if(this.querySelectorAll(".hax-active").forEach(e=>{e.classList.remove("hax-active")}),this.editMode&&null!=e&&e.parentNode){let t=e.tagName.toLowerCase();e.classList.add("hax-active"),window.HaxStore.instance.isTextElement(e)||window.HaxStore.instance.isGridPlateElement(e)?(e.setAttribute("contenteditable",!0),this.setAttribute("contenteditable",!0)):(e.removeAttribute("contenteditable"),this.removeAttribute("contenteditable")),this.positionContextMenus(),this.shadowRoot.querySelector("#textcontextmenu").realSelectedValue=t}else null===e&&(this.hideContextMenus(),this.__oldActiveNode=t)}_getPosition(e){return{x:e.offsetLeft-e.scrollLeft+e.clientLeft,y:e.offsetTop-e.scrollTop+e.clientTop}}_positionContextMenu(e,t,o,i){if(null!=t){let a=this._getPosition(t);e.style.left=null!=o?a.x+o+"px":a.x+"px",e.style.top=null!=i?a.y+i+"px":a.y+"px"}e.setAttribute("on-screen","on-screen"),e.classList.add("hax-context-visible"),this.__activeHover&&(e.classList.add("hax-active-hover"),e.style.marginLeft="",this.__typeLock=!1)}_hideContextMenu(e){e.removeAttribute("on-screen"),e.classList.remove("hax-context-visible","hax-active-hover","hax-context-pin-top")}_tabKeyPressed(){let e=!1,t=this.activeContainerNode;const o=this.activeContainerNode.tagName;if(window.HaxStore.getRange().cloneRange)try{let a=window.HaxStore.getRange().cloneRange();var i=a.commonAncestorContainer.tagName;if(void 0===i&&(i=a.commonAncestorContainer.parentNode.tagName),["UL","OL","LI"].includes(o)||["UL","OL","LI"].includes(i))this.polyfillSafe&&(document.execCommand("indent"),this.__tabTrap=!0);else for(;!e;)null==t.nextSibling?e=!0:"function"===t.nextSibling.focus?(t.nextSibling.focus(),e=!0):t=t.nextSibling}catch(e){console.warn(e)}}_tabBackKeyPressed(){let e=this.activeContainerNode;const t=this.activeContainerNode.tagName;if(window.HaxStore.getRange().cloneRange)try{let i=window.HaxStore.getRange().cloneRange();var o=i.commonAncestorContainer.tagName;if(void 0===o&&(o=i.commonAncestorContainer.parentNode.tagName),["UL","OL","LI"].includes(t)||["UL","OL","LI"].includes(o))this.polyfillSafe&&(document.execCommand("outdent"),this.__tabTrap=!0);else{if(null!=e)for(;null!=e&&!this._validElementTest(e);)e=e.previousSibling;null!=e&&setTimeout(()=>{e.focus()},50)}}catch(e){console.warn(e)}}}window.customElements.define(HaxBody.tag,HaxBody);export{HaxBody};