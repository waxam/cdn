/*!
 * wavesurfer.js 2.1.0 (Mon Oct 01 2018 11:34:43 GMT+0200 (Central European Summer Time))
 * https://github.com/katspaugh/wavesurfer.js
 * @license BSD-3-Clause
 */
!function webpackUniversalModuleDefinition(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("spectrogram",[],t):"object"==typeof exports?exports.spectrogram=t():(e.WaveSurfer=e.WaveSurfer||{},e.WaveSurfer.spectrogram=t())}(window,(function(){return function(e){var t={};function __webpack_require__(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,__webpack_require__),a.l=!0,a.exports}return __webpack_require__.m=e,__webpack_require__.c=t,__webpack_require__.d=function(e,t,r){__webpack_require__.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},__webpack_require__.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.t=function(e,t){if(1&t&&(e=__webpack_require__(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(__webpack_require__.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)__webpack_require__.d(r,a,function(t){return e[t]}.bind(null,a));return r},__webpack_require__.n=function(e){var t=e&&e.__esModule?function getDefault(){return e.default}:function getModuleExports(){return e};return __webpack_require__.d(t,"a",t),t},__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.p="localhost:8080/dist/plugin/",__webpack_require__(__webpack_require__.s="./src/plugin/spectrogram.js")}({"./src/plugin/spectrogram.js":
/*!***********************************!*\
      !*** ./src/plugin/spectrogram.js ***!
      \***********************************/
/*! no static exports found */
function(e,t,r){function _defineProperties(e,t){for(var r=0;r<t.length;r++){var a=t[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function _createClass(e,t,r){return t&&_defineProperties(e.prototype,t),r&&_defineProperties(e,r),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=function FFT(e,t,r,a){switch(this.bufferSize=e,this.sampleRate=t,this.bandwidth=2/e*(t/2),this.sinTable=new Float32Array(e),this.cosTable=new Float32Array(e),this.windowValues=new Float32Array(e),this.reverseTable=new Uint32Array(e),this.peakBand=0,this.peak=0,r){case"bartlett":for(var i=0;i<e;i++)this.windowValues[i]=2/(e-1)*((e-1)/2-Math.abs(i-(e-1)/2));break;case"bartlettHann":for(i=0;i<e;i++)this.windowValues[i]=.62-.48*Math.abs(i/(e-1)-.5)-.38*Math.cos(2*Math.PI*i/(e-1));break;case"blackman":a=a||.16;for(i=0;i<e;i++)this.windowValues[i]=(1-a)/2-.5*Math.cos(2*Math.PI*i/(e-1))+a/2*Math.cos(4*Math.PI*i/(e-1));break;case"cosine":for(i=0;i<e;i++)this.windowValues[i]=Math.cos(Math.PI*i/(e-1)-Math.PI/2);break;case"gauss":a=a||.25;for(i=0;i<e;i++)this.windowValues[i]=Math.pow(Math.E,-.5*Math.pow((i-(e-1)/2)/(a*(e-1)/2),2));break;case"hamming":for(i=0;i<e;i++)this.windowValues[i]=(.54-.46)*Math.cos(2*Math.PI*i/(e-1));break;case"hann":case void 0:for(i=0;i<e;i++)this.windowValues[i]=.5*(1-Math.cos(2*Math.PI*i/(e-1)));break;case"lanczoz":for(i=0;i<e;i++)this.windowValues[i]=Math.sin(Math.PI*(2*i/(e-1)-1))/(Math.PI*(2*i/(e-1)-1));break;case"rectangular":for(i=0;i<e;i++)this.windowValues[i]=1;break;case"triangular":for(i=0;i<e;i++)this.windowValues[i]=2/e*(e/2-Math.abs(i-(e-1)/2));break;default:throw Error("No such window function '"+r+"'")}for(var n=1,s=e>>1;n<e;){for(i=0;i<n;i++)this.reverseTable[i+n]=this.reverseTable[i]+s;n<<=1,s>>=1}for(i=0;i<e;i++)this.sinTable[i]=Math.sin(-Math.PI/i),this.cosTable[i]=Math.cos(-Math.PI/i);this.calculateSpectrum=function(e){var t,r,a,i=this.bufferSize,n=this.cosTable,s=this.sinTable,o=this.reverseTable,l=new Float32Array(i),h=new Float32Array(i),u=2/this.bufferSize,c=Math.sqrt,f=new Float32Array(i/2),p=Math.floor(Math.log(i)/Math.LN2);if(Math.pow(2,p)!==i)throw"Invalid buffer size, must be a power of 2.";if(i!==e.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+i+" Buffer Size: "+e.length;for(var d,w,v,_,b,g,m,y,k=1,S=0;S<i;S++)l[S]=e[o[S]]*this.windowValues[o[S]],h[S]=0;for(;k<i;){d=n[k],w=s[k],v=1,_=0;for(var M=0;M<k;M++){for(S=M;S<i;)g=v*l[b=S+k]-_*h[b],m=v*h[b]+_*l[b],l[b]=l[S]-g,h[b]=h[S]-m,l[S]+=g,h[S]+=m,S+=k<<1;v=(y=v)*d-_*w,_=y*w+_*d}k<<=1}S=0;for(var x=i/2;S<x;S++)(a=u*c((t=l[S])*t+(r=h[S])*r))>this.peak&&(this.peakBand=S,this.peak=a),f[S]=a;return f}},i=function(){function SpectrogramPlugin(e,t){var r=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,SpectrogramPlugin),this.params=e,this.wavesurfer=t,this.util=t.util,this.frequenciesDataUrl=e.frequenciesDataUrl,this._onScroll=function(e){r.updateScroll(e)},this._onReady=function(){var a=r.drawer=t.drawer;if(r.container="string"==typeof e.container?document.querySelector(e.container):e.container,!r.container)throw Error("No container for WaveSurfer spectrogram");r.width=a.width,r.pixelRatio=r.params.pixelRatio||t.params.pixelRatio,r.fftSamples=r.params.fftSamples||t.params.fftSamples||512,r.height=r.fftSamples/2,r.noverlap=e.noverlap,r.windowFunc=e.windowFunc,r.alpha=e.alpha,r.createWrapper(),r.createCanvas(),r.render(),a.wrapper.addEventListener("scroll",r._onScroll),t.on("redraw",(function(){return r.render()}))}}return _createClass(SpectrogramPlugin,null,[{key:"create",value:function create(e){return{name:"spectrogram",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{FFT:a},instance:SpectrogramPlugin}}}]),_createClass(SpectrogramPlugin,[{key:"init",value:function init(){this.wavesurfer.isReady&&this._onReady(),this.wavesurfer.on("ready",this._onReady)}},{key:"destroy",value:function destroy(){this.unAll(),this.wavesurfer.un("ready",this._onReady),this.drawer.wrapper.removeEventListener("scroll",this._onScroll),this.wavesurfer=null,this.util=null,this.params=null,this.wrapper&&(this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null)}},{key:"createWrapper",value:function createWrapper(){var e=this,t=this.container.querySelector("spectrogram");t&&this.container.removeChild(t);var r=this.wavesurfer.params;if(this.wrapper=document.createElement("spectrogram"),this.params.labels){var a=this.labelsEl=document.createElement("canvas");a.classList.add("spec-labels"),this.drawer.style(a,{left:0,position:"absolute",zIndex:9,height:"".concat(this.height/this.pixelRatio,"px"),width:"".concat(55/this.pixelRatio,"px")}),this.wrapper.appendChild(a),this.loadLabels("rgba(68,68,68,0.5)","12px","10px","","#fff","#f7f7f7","center","#specLabels")}this.drawer.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:"".concat(this.height/this.pixelRatio,"px")}),(r.fillParent||r.scrollParent)&&this.drawer.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"}),this.container.appendChild(this.wrapper),this.wrapper.addEventListener("click",(function(t){t.preventDefault();var r="offsetX"in t?t.offsetX:t.layerX;e.fireEvent("click",r/e.scrollWidth||0)}))}},{key:"createCanvas",value:function createCanvas(){var e=this.canvas=this.wrapper.appendChild(document.createElement("canvas"));this.spectrCc=e.getContext("2d"),this.util.style(e,{position:"absolute",zIndex:4})}},{key:"render",value:function render(){this.updateCanvasStyle(),this.frequenciesDataUrl?this.loadFrequenciesData(this.frequenciesDataUrl):this.getFrequencies(this.drawSpectrogram)}},{key:"updateCanvasStyle",value:function updateCanvasStyle(){var e=Math.round(this.width/this.pixelRatio)+"px";this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=e}},{key:"drawSpectrogram",value:function drawSpectrogram(e,t){t.spectrCc,t.wavesurfer.backend.getDuration();var r,a,i=t.height,n=t.resample(e),s=t.buffer?2/t.buffer.numberOfChannels:1;for(r=0;r<n.length;r++)for(a=0;a<n[r].length;a++){var o=255-n[r][a];t.spectrCc.fillStyle="rgb("+o+", "+o+", "+o+")",t.spectrCc.fillRect(r,i-a*s,1,s)}}},{key:"getFrequencies",value:function getFrequencies(e){var t=this.fftSamples,r=this.buffer=this.wavesurfer.backend.buffer,i=r.getChannelData(0),n=r.length,s=r.sampleRate,o=[];if(r){var l=this.noverlap;if(!l){var h=r.length/this.canvas.width;l=Math.max(0,Math.round(t-h))}for(var u=new a(t,s,this.windowFunc,this.alpha),c=(Math.floor(n/(t-l)),0);c+t<i.length;){var f=i.slice(c,c+t),p=u.calculateSpectrum(f),d=new Uint8Array(t/2),w=void 0;for(w=0;w<t/2;w++)d[w]=Math.max(-255,45*Math.log10(p[w]));o.push(d),c+=t-l}e(o,this)}else this.fireEvent("error","Web Audio buffer is not available")}},{key:"loadFrequenciesData",value:function loadFrequenciesData(e){var t=this,r=this.util.ajax({url:e});return r.on("success",(function(e){return t.drawSpectrogram(JSON.parse(e),t)})),r.on("error",(function(e){return t.fireEvent("error","XHR error: "+e.target.statusText)})),r}},{key:"freqType",value:function freqType(e){return e>=1e3?(e/1e3).toFixed(1):Math.round(e)}},{key:"unitType",value:function unitType(e){return e>=1e3?"KHz":"Hz"}},{key:"loadLabels",value:function loadLabels(e,t,r,a,i,n,s,o){e=e||"rgba(68,68,68,0)",t=t||"12px",r=r||"10px",a=a||"Helvetica",i=i||"#fff",n=n||"#fff",s=s||"center",o=o||"#specLabels";var l,h=this.height||512,u=h/256*5,c=(this.wavesurfer.backend.ac.sampleRate/2-0)/u,f=this.labelsEl.getContext("2d");for(this.labelsEl.height=this.height,this.labelsEl.width=55,f.fillStyle=e,f.fillRect(0,0,55,h),f.fill(),l=0;l<=u;l++){f.textAlign=s,f.textBaseline="middle";var p=0+c*l,d=(Math.round(p/(this.sampleRate/2)*this.fftSamples),this.freqType(p)),w=this.unitType(p);0==l?(f.fillStyle=n,f.font=r+" "+a,f.fillText(w,40,h+l-10),f.fillStyle=i,f.font=t+" "+a,f.fillText(d,16,h+l-10)):(f.fillStyle=n,f.font=r+" "+a,f.fillText(w,40,h-50*l+2),f.fillStyle=i,f.font=t+" "+a,f.fillText(d,16,h-50*l+2))}}},{key:"updateScroll",value:function updateScroll(e){this.wrapper&&(this.wrapper.scrollLeft=e.target.scrollLeft)}},{key:"resample",value:function resample(e){var t,r=this.width,a=[],i=1/e.length,n=1/r;for(t=0;t<r;t++){var s=new Array(e[0].length),o=void 0;for(o=0;o<e.length;o++){var l=o*i,h=l+i,u=t*n,c=u+n,f=h<=u||c<=l?0:Math.min(Math.max(h,u),Math.max(c,l))-Math.max(Math.min(h,u),Math.min(c,l)),p=void 0;if(f>0)for(p=0;p<e[0].length;p++)null==s[p]&&(s[p]=0),s[p]+=f/n*e[o][p]}var d=new Uint8Array(e[0].length),w=void 0;for(w=0;w<e[0].length;w++)d[w]=s[w];a.push(d)}return a}}]),SpectrogramPlugin}();t.default=i,e.exports=t.default}})}));