/*!
 * wavesurfer.js 2.1.0 (Mon Oct 01 2018 11:34:54 GMT+0200 (Central European Summer Time))
 * https://github.com/katspaugh/wavesurfer.js
 * @license BSD-3-Clause
 */
var e,t;e=window,t=function(){return function(e){var t={};function i(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,i),s.l=!0,s.exports}return i.m=e,i.c=t,i.d=function(e,t,r){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(i.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)i.d(r,s,function(t){return e[t]}.bind(null,s));return r},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="localhost:8080/dist/plugin/",i(i.s=3)}({3:function(e,t,r){function a(e,t){for(var r=0;r<t.length;r++){var s=t[r];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}function n(e,t,r){return t&&a(e.prototype,t),r&&a(e,r),e}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var v=function(e,t,r,s){switch(this.bufferSize=e,this.sampleRate=t,this.bandwidth=2/e*(t/2),this.sinTable=new Float32Array(e),this.cosTable=new Float32Array(e),this.windowValues=new Float32Array(e),this.reverseTable=new Uint32Array(e),this.peakBand=0,this.peak=0,r){case"bartlett":for(var o=0;o<e;o++)this.windowValues[o]=2/(e-1)*((e-1)/2-Math.abs(o-(e-1)/2));break;case"bartlettHann":for(o=0;o<e;o++)this.windowValues[o]=.62-.48*Math.abs(o/(e-1)-.5)-.38*Math.cos(2*Math.PI*o/(e-1));break;case"blackman":for(s=s||.16,o=0;o<e;o++)this.windowValues[o]=(1-s)/2-.5*Math.cos(2*Math.PI*o/(e-1))+s/2*Math.cos(4*Math.PI*o/(e-1));break;case"cosine":for(o=0;o<e;o++)this.windowValues[o]=Math.cos(Math.PI*o/(e-1)-Math.PI/2);break;case"gauss":for(s=s||.25,o=0;o<e;o++)this.windowValues[o]=Math.pow(Math.E,-.5*Math.pow((o-(e-1)/2)/(s*(e-1)/2),2));break;case"hamming":for(o=0;o<e;o++)this.windowValues[o]=(.54-.46)*Math.cos(2*Math.PI*o/(e-1));break;case"hann":case void 0:for(o=0;o<e;o++)this.windowValues[o]=.5*(1-Math.cos(2*Math.PI*o/(e-1)));break;case"lanczoz":for(o=0;o<e;o++)this.windowValues[o]=Math.sin(Math.PI*(2*o/(e-1)-1))/(Math.PI*(2*o/(e-1)-1));break;case"rectangular":for(o=0;o<e;o++)this.windowValues[o]=1;break;case"triangular":for(o=0;o<e;o++)this.windowValues[o]=2/e*(e/2-Math.abs(o-(e-1)/2));break;default:throw Error("No such window function '"+r+"'")}for(var l=1,h=e>>1;l<e;){for(o=0;o<l;o++)this.reverseTable[o+l]=this.reverseTable[o]+h;l<<=1,h>>=1}for(o=0;o<e;o++)this.sinTable[o]=Math.sin(-Math.PI/o),this.cosTable[o]=Math.cos(-Math.PI/o);this.calculateSpectrum=function(e){var t,r,s,o=this.bufferSize,l=this.cosTable,h=this.sinTable,f=this.reverseTable,u=new Float32Array(o),c=new Float32Array(o),p=2/this.bufferSize,d=Math.sqrt,w=new Float32Array(o/2),b=Math.floor(Math.log(o)/Math.LN2);if(Math.pow(2,b)!==o)throw"Invalid buffer size, must be a power of 2.";if(o!==e.length)throw"Supplied buffer is not the same size as defined FFT. FFT Size: "+o+" Buffer Size: "+e.length;for(var y,m,g,M,S,x,k,T,P=1,F=0;F<o;F++)u[F]=e[f[F]]*this.windowValues[f[F]],c[F]=0;for(;P<o;){y=l[P],m=h[P],g=1;for(var R=M=0;R<P;R++){for(F=R;F<o;)x=g*u[S=F+P]-M*c[S],k=g*c[S]+M*u[S],u[S]=u[F]-x,c[S]=c[F]-k,u[F]+=x,c[F]+=k,F+=P<<1;g=(T=g)*y-M*m,M=T*m+M*y}P<<=1}F=0;for(var C=o/2;F<C;F++)(s=p*d((t=u[F])*t+(r=c[F])*r))>this.peak&&(this.peakBand=F,this.peak=s),w[F]=s;return w}},s=function(){function i(e,t){var r=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,i),this.params=e,this.wavesurfer=t,this.util=t.util,this.frequenciesDataUrl=e.frequenciesDataUrl,this._onScroll=function(e){r.updateScroll(e)},this._onReady=function(){var s=r.drawer=t.drawer;if(r.container="string"==typeof e.container?document.querySelector(e.container):e.container,!r.container)throw Error("No container for WaveSurfer spectrogram");r.width=s.width,r.pixelRatio=r.params.pixelRatio||t.params.pixelRatio,r.fftSamples=r.params.fftSamples||t.params.fftSamples||512,r.height=r.fftSamples/2,r.noverlap=e.noverlap,r.windowFunc=e.windowFunc,r.alpha=e.alpha,r.createWrapper(),r.createCanvas(),r.render(),s.wrapper.addEventListener("scroll",r._onScroll),t.on("redraw",(function(){return r.render()}))}}return n(i,null,[{key:"create",value:function(e){return{name:"spectrogram",deferInit:!(!e||!e.deferInit)&&e.deferInit,params:e,staticProps:{FFT:v},instance:i}}}]),n(i,[{key:"init",value:function(){this.wavesurfer.isReady&&this._onReady(),this.wavesurfer.on("ready",this._onReady)}},{key:"destroy",value:function(){this.unAll(),this.wavesurfer.un("ready",this._onReady),this.drawer.wrapper.removeEventListener("scroll",this._onScroll),this.wavesurfer=null,this.util=null,this.params=null,this.wrapper&&(this.wrapper.parentNode.removeChild(this.wrapper),this.wrapper=null)}},{key:"createWrapper",value:function(){var e=this,t=this.container.querySelector("spectrogram");t&&this.container.removeChild(t);var r=this.wavesurfer.params;if(this.wrapper=document.createElement("spectrogram"),this.params.labels){var s=this.labelsEl=document.createElement("canvas");s.classList.add("spec-labels"),this.drawer.style(s,{left:0,position:"absolute",zIndex:9,height:"".concat(this.height/this.pixelRatio,"px"),width:"".concat(55/this.pixelRatio,"px")}),this.wrapper.appendChild(s),this.loadLabels("rgba(68,68,68,0.5)","12px","10px","","#fff","#f7f7f7","center","#specLabels")}this.drawer.style(this.wrapper,{display:"block",position:"relative",userSelect:"none",webkitUserSelect:"none",height:"".concat(this.height/this.pixelRatio,"px")}),(r.fillParent||r.scrollParent)&&this.drawer.style(this.wrapper,{width:"100%",overflowX:"hidden",overflowY:"hidden"}),this.container.appendChild(this.wrapper),this.wrapper.addEventListener("click",(function(t){t.preventDefault();var r="offsetX"in t?t.offsetX:t.layerX;e.fireEvent("click",r/e.scrollWidth||0)}))}},{key:"createCanvas",value:function(){var e=this.canvas=this.wrapper.appendChild(document.createElement("canvas"));this.spectrCc=e.getContext("2d"),this.util.style(e,{position:"absolute",zIndex:4})}},{key:"render",value:function(){this.updateCanvasStyle(),this.frequenciesDataUrl?this.loadFrequenciesData(this.frequenciesDataUrl):this.getFrequencies(this.drawSpectrogram)}},{key:"updateCanvasStyle",value:function(){var e=Math.round(this.width/this.pixelRatio)+"px";this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.style.width=e}},{key:"drawSpectrogram",value:function(e,t){t.spectrCc,t.wavesurfer.backend.getDuration();var r,s,o=t.height,l=t.resample(e),h=t.buffer?2/t.buffer.numberOfChannels:1;for(r=0;r<l.length;r++)for(s=0;s<l[r].length;s++){var f=255-l[r][s];t.spectrCc.fillStyle="rgb("+f+", "+f+", "+f+")",t.spectrCc.fillRect(r,o-s*h,1,h)}}},{key:"getFrequencies",value:function(e){var t=this.fftSamples,r=this.buffer=this.wavesurfer.backend.buffer,s=r.getChannelData(0),o=r.length,l=r.sampleRate,h=[];if(r){var f=this.noverlap;if(!f){var u=r.length/this.canvas.width;f=Math.max(0,Math.round(t-u))}for(var c=new v(t,l,this.windowFunc,this.alpha),p=(Math.floor(o/(t-f)),0);p+t<s.length;){var d=s.slice(p,p+t),w=c.calculateSpectrum(d),b=new Uint8Array(t/2),y=void 0;for(y=0;y<t/2;y++)b[y]=Math.max(-255,45*Math.log10(w[y]));h.push(b),p+=t-f}e(h,this)}else this.fireEvent("error","Web Audio buffer is not available")}},{key:"loadFrequenciesData",value:function(e){var t=this,r=this.util.ajax({url:e});return r.on("success",(function(e){return t.drawSpectrogram(JSON.parse(e),t)})),r.on("error",(function(e){return t.fireEvent("error","XHR error: "+e.target.statusText)})),r}},{key:"freqType",value:function(e){return 1e3<=e?(e/1e3).toFixed(1):Math.round(e)}},{key:"unitType",value:function(e){return 1e3<=e?"KHz":"Hz"}},{key:"loadLabels",value:function(e,t,r,s,o,l,h,f){e=e||"rgba(68,68,68,0)",t=t||"12px",r=r||"10px",s=s||"Helvetica",o=o||"#fff",l=l||"#fff",h=h||"center",f=f||"#specLabels";var u,c=this.height||512,p=c/256*5,d=(this.wavesurfer.backend.ac.sampleRate/2-0)/p,w=this.labelsEl.getContext("2d");for(this.labelsEl.height=this.height,this.labelsEl.width=55,w.fillStyle=e,w.fillRect(0,0,55,c),w.fill(),u=0;u<=p;u++){w.textAlign=h,w.textBaseline="middle";var b=0+d*u,y=(Math.round(b/(this.sampleRate/2)*this.fftSamples),this.freqType(b)),m=this.unitType(b);0==u?(w.fillStyle=l,w.font=r+" "+s,w.fillText(m,40,c+u-10),w.fillStyle=o,w.font=t+" "+s,w.fillText(y,16,c+u-10)):(w.fillStyle=l,w.font=r+" "+s,w.fillText(m,40,c-50*u+2),w.fillStyle=o,w.font=t+" "+s,w.fillText(y,16,c-50*u+2))}}},{key:"updateScroll",value:function(e){this.wrapper&&(this.wrapper.scrollLeft=e.target.scrollLeft)}},{key:"resample",value:function(e){var t,r=this.width,s=[],o=1/e.length,l=1/r;for(t=0;t<r;t++){var h=new Array(e[0].length),f=void 0;for(f=0;f<e.length;f++){var u=f*o,c=u+o,p=t*l,d=p+l,w=c<=p||d<=u?0:Math.min(Math.max(c,p),Math.max(d,u))-Math.max(Math.min(c,p),Math.min(d,u)),b=void 0;if(0<w)for(b=0;b<e[0].length;b++)null==h[b]&&(h[b]=0),h[b]+=w/l*e[f][b]}var y=new Uint8Array(e[0].length),m=void 0;for(m=0;m<e[0].length;m++)y[m]=h[m];s.push(y)}return s}}]),i}();t.default=s,e.exports=t.default}})},"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("spectrogram",[],t):"object"==typeof exports?exports.spectrogram=t():(e.WaveSurfer=e.WaveSurfer||{},e.WaveSurfer.spectrogram=t());