import e from"./observer.js";export default function ajax(r){const t=new e,s=new XMLHttpRequest;let n=!1;return s.open(r.method||"GET",r.url,!0),s.responseType=r.responseType||"json",r.xhr&&(r.xhr.requestHeaders&&r.xhr.requestHeaders.forEach((e=>{s.setRequestHeader(e.key,e.value)})),r.xhr.withCredentials&&(s.withCredentials=!0)),s.addEventListener("progress",(e=>{t.fireEvent("progress",e),e.lengthComputable&&e.loaded==e.total&&(n=!0)})),s.addEventListener("load",(e=>{n||t.fireEvent("progress",e),t.fireEvent("load",e),200==s.status||206==s.status?t.fireEvent("success",s.response,e):t.fireEvent("error",e)})),s.addEventListener("error",(e=>t.fireEvent("error",e))),s.send(),t.xhr=s,t}