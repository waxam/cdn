import{html,Polymer}from"../../../../@polymer/polymer/polymer-legacy.js";import"../../../../@polymer/iron-ajax/iron-ajax.js";import"../../../../@polymer/paper-toast/paper-toast.js";import"../../../lrnsys-button/lrnsys-button.js";Polymer({_template:html`
    <style>
      :host {
        display: block;
      }
    </style>

    <template is="dom-if" if="[[!submissionId]]">
      <lrnsys-button
        raised=""
        on-tap="_createSubmission"
        label="Create submission"
      ></lrnsys-button>
      <iron-ajax
        id="ajaxCreateStub"
        url="[[createStubUrl]]"
        method="POST"
        body="[[assignmentId]]"
        handle-as="json"
        on-response="_ajaxCreateStubHandler"
      ></iron-ajax>
    </template>
    <template is="dom-if" if="[[submissionId]]">
      <lrnsys-button
        raised=""
        label="View submission"
        show-href="[[_submissionUrl(submissionId)]]"
        href="[[_submissionUrl(submissionId)]]"
      ></lrnsys-button>
    </template>

    <template is="dom-if" if="[[displayErrors]]">
      <paper-toast id="toast"></paper-toast>
    </template>
  `,is:"lrnapp-studio-submission-button",properties:{auto:{type:Boolean,reflectToAttribute:!0,value:!1,notify:!0},assignmentId:{type:String,reflectToAttribute:!0},submissionId:{type:String,value:!1,reflectToAttribute:!0},endPoint:String,csrfToken:String,displayErrors:{type:Boolean,value:!0}},observers:["_requestUrlChanged(endPoint, csrfToken)"],_requestUrlChanged:function(endPoint,csrfToken){this.createStubUrl=endPoint+"/api/submissions/create-stub?token="+csrfToken},_createSubmission:function(){this.shadowRoot.querySelector("#ajaxCreateStub").generateRequest()},_ajaxCreateStubHandler:function(e){var status=e.detail.response.status,response=e.detail.response;if(201===status){var submissionId=e.detail.response.data.id;if(submissionId){this.submissionId=submissionId;if(this.auto){window.location.href=this._submissionUrl(submissionId)+"/edit"}}}if("undefined"!==typeof response.errors){var ul=document.createElement("ul"),text="";response.errors.forEach(function(error){text=text+" "+error});this.shadowRoot.querySelector("#toast").show(text)}},_submissionUrl:function(id){return this.endPoint+"/submissions/"+id}});