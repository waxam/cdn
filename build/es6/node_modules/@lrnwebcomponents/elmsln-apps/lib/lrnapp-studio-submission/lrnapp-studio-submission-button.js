import{html,PolymerElement}from"../../../../@polymer/polymer/polymer-element.js";import"../../../../@polymer/iron-ajax/iron-ajax.js";import"../../../../@polymer/polymer/lib/elements/dom-if.js";import"../../../../@polymer/paper-toast/paper-toast.js";import"../../../lrnsys-button/lrnsys-button.js";/**
 * `lrnapp-studio-submission-button`
 * `Allows users to either start a submission or link to a submission.`

Usage:
```
<lrnapp-studio-submission-button assignment-id="[[id]]" submission-id="{{submissionId}}" end-point="[[endPoint]]" csrf-token=[[csrfToken]]></lrnapp-studio-submission-button>
*/class LrnappStudioSubmissionButton extends PolymerElement{static get template(){return html`
      <style>
        :host {
          display: block;
        }
      </style>
      <template is="dom-if" if="[[!submissionId]]">
        <lrnsys-button
          raised
          on-click="_createSubmission"
          label="Create submission"
        ></lrnsys-button>
        <iron-ajax
          id="ajaxCreateStub"
          url="[[endPoint]]/api/submissions/create-stub?token=[[csrfToken]]"
          method="POST"
          body="[[assignmentId]]"
          handle-as="json"
          on-response="_ajaxCreateStubHandler"
        ></iron-ajax>
      </template>
      <template is="dom-if" if="[[submissionId]]">
        <lrnsys-button
          raised=""
          label="View submission"
          show-href="[[_submissionUrl(submissionId)]]"
          href="[[_submissionUrl(submissionId)]]"
        ></lrnsys-button>
      </template>
      <template is="dom-if" if="[[displayErrors]]">
        <paper-toast id="toast"></paper-toast>
      </template>
    `}static get tag(){return"lrnapp-studio-submission-button"}static get properties(){return{auto:{type:Boolean,reflectToAttribute:!0,value:!1,notify:!0},assignmentId:{type:String,reflectToAttribute:!0},submissionId:{type:String,value:!1,reflectToAttribute:!0},displayErrors:{type:Boolean,value:!0},elmslnCourse:{type:String},elmslnSection:{type:String},basePath:{type:String,notify:!0,reflectToAttribute:!0},csrfToken:{type:String,notify:!0,reflectToAttribute:!0},endPoint:{type:String,notify:!0,reflectToAttribute:!0}}}_createSubmission(){this.shadowRoot.querySelector("#ajaxCreateStub").generateRequest()}_ajaxCreateStubHandler(e){var status=e.detail.response.status,response=e.detail.response;if(201===status){var submissionId=e.detail.response.data.id;if(submissionId){this.submissionId=submissionId;// auto implies we should just go there to the edit form after creation
if(this.auto){window.location.href=this._submissionUrl(submissionId)+"/edit"}}}// if we have errors to display
if("undefined"!==typeof response.errors){var ul=document.createElement("ul"),text="";response.errors.forEach(function(error){text=text+" "+error});this.shadowRoot.querySelector("#toast").show(text)}}_submissionUrl(id){return this.endPoint+"/submissions/"+id}}window.customElements.define(LrnappStudioSubmissionButton.tag,LrnappStudioSubmissionButton);export{LrnappStudioSubmissionButton};