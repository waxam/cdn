import{html as t,PolymerElement as e}from"../../../../@polymer/polymer/polymer-element.js";import"../../../../@polymer/iron-ajax/iron-ajax.js";import"../../../../@polymer/iron-list/iron-list.js";import"../../../../@polymer/iron-pages/iron-pages.js";import"../elmsln-base-deps.js";import"../../../../@polymer/iron-selector/iron-selector.js";import"../../../../@polymer/app-layout/app-toolbar/app-toolbar.js";import"../../../../@polymer/polymer/lib/elements/dom-repeat.js";import"../../../../@polymer/app-route/app-location.js";import"../../../../@polymer/app-route/app-route.js";import"../../../../@polymer/paper-dropdown-menu/paper-dropdown-menu.js";import"../../../../@polymer/paper-listbox/paper-listbox.js";import"../../../../@polymer/paper-item/paper-item.js";import"../../../../@polymer/paper-toast/paper-toast.js";import"../../../lrndesign-gallerycard/lrndesign-gallerycard.js";import"../../../elmsln-loading/elmsln-loading.js";import"./lrnapp-open-studio-table.js";import"./lrnapp-open-studio-projects.js";import"./lrnapp-open-studio-assignments.js";class LrnappOpenStudio extends e{static get template(){return t`
      <style>
        [hidden] {
          display: none !important;
        }
        :host {
          display: block;
          align-content: center;
          margin-top: 26px;
        }
        #loading {
          width: 100%;
          z-index: 1000;
          opacity: 0.8;
          text-align: center;
          align-content: center;
          justify-content: center;
          height: 100vh;
          position: absolute;
          background-color: white;
        }
        iron-selector lrnsys-button {
          display: inline-flex;
        }
        iron-selector a {
          display: inline-block;
        }
        .gallerycard-wrapper {
          margin: 0;
          padding: 0;
        }
        .gallerycard-wrapper a {
          text-decoration: none;
        }
        lrndesign-gallerycard {
          padding: 0;
          margin: 16px;
          width: 268px;
          height: 268px;
        }
        app-toolbar {
          height: 64px;
          position: sticky;
          top: -1px;
          z-index: 1000000;
          background-color: white;
        }
        app-toolbar lrnsys-button::part(lrnsys-button-inner-div) {
          padding: 0 4px;
        }
        app-toolbar lrnsys-button::part(lrnsys-button-label) {
          font-size: 10px;
        }
        app-toolbar paper-dropdown-menu {
          max-width: 12vw;
        }
        @media (max-width: 900px) {
          app-toolbar lrnsys-button::part(lrnsys-button-label) {
            display: none;
          }
          app-toolbar paper-dropdown-menu {
            max-width: 15vw;
          }
        }
        .gallery-grid {
          margin: 0 auto;
          width: 95%;
        }
        .iron-selected .display-mode {
          background-color: var(--elmsln-system-color-dark);
          color: white;
          --lrnsys-button-link-color: white;
        }
        .iron-list-container {
          display: flex;
          flex-direction: column;
        }
        lrnsys-button {
          --lrnsys-button-height: 48px;
        }
        iron-list {
          flex: 1 1 auto;
        }
      </style>
      <iron-ajax
        auto
        url="[[sourcePath]]"
        params=""
        handle-as="json"
        last-response="{{studioResponse}}"
        on-response="_handleResponse"
      ></iron-ajax>

      <app-location
        route="{{route}}"
        query-params="{{queryParams}}"
      ></app-location>
      <app-route
        route="{{route}}"
        pattern="[[endPoint]]/:page"
        data="{{data}}"
        tail="{{tail}}"
        query-params="{{queryParams}}"
      >
      </app-route>

      <div id="loading">
        <h3>Loading..</h3>
        <elmsln-loading color="grey-text" size="large"></elmsln-loading>
      </div>
      <app-toolbar>
        <iron-selector
          selected="{{data.page}}"
          attr-for-selected="name"
          role="navigation"
        >
          <a tabindex="-1" name="submissions" on-click="_submissionsClicked"
            ><lrnsys-button
              icon="apps"
              label="Submission display"
              hover-class="amber darken-4 white-text"
              class="display-mode"
              button-class="display-mode style-scope lrnapp-open-studio x-scope lrnsys-button-0"
            ></lrnsys-button
          ></a>
          <a tabindex="-1" name="projects" on-click="_projectsClicked"
            ><lrnsys-button
              icon="folder"
              label="Project board"
              hover-class="amber darken-4 white-text"
              class="display-mode"
              button-class="display-mode style-scope lrnapp-open-studio x-scope lrnsys-button-0"
            ></lrnsys-button
          ></a>
          <a tabindex="-1" name="assignments" on-click="_assignmentsClicked"
            ><lrnsys-button
              icon="list"
              label="Assignment centric"
              hover-class="amber darken-4 white-text"
              class="display-mode"
              button-class="display-mode style-scope lrnapp-open-studio x-scope lrnsys-button-0"
            ></lrnsys-button
          ></a>
          <a tabindex="-1" name="table" on-click="_tableClicked"
            ><lrnsys-button
              icon="view-list"
              label="Table view"
              hover-class="amber darken-4 white-text"
              class="display-mode"
              button-class="display-mode style-scope lrnapp-open-studio x-scope lrnsys-button-0"
            ></lrnsys-button
          ></a>
        </iron-selector>
        <span main-title></span>
        <span
          top-item
          style="text-align:right;font-size:.5em;padding-right:1em;"
          >Displaying [[submissions.length]] of
          [[originalSubmissions.length]]</span
        >
        <paper-dropdown-menu label="Author" hidden$="[[!authors]]">
          <paper-listbox
            slot="dropdown-content"
            class="dropdown-content"
            selected="{{queryParams.author}}"
            attr-for-selected="item-id"
          >
            <paper-item></paper-item>
            <template is="dom-repeat" items="[[_toArray(authors)]]" as="author">
              <paper-item item-id="[[author.id]]"
                >[[author.display_name]]</paper-item
              >
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
        <paper-dropdown-menu label="Project" hidden$="[[!projects]]">
          <paper-listbox
            slot="dropdown-content"
            class="dropdown-content"
            selected="{{queryParams.project}}"
            attr-for-selected="item-id"
          >
            <paper-item></paper-item>
            <template
              is="dom-repeat"
              items="[[_toArray(projects)]]"
              as="project"
            >
              <paper-item item-id="[[project.id]]"
                >[[project.attributes.title]]</paper-item
              >
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
        <paper-dropdown-menu label="Assignment" hidden$="[[!assignments]]">
          <paper-listbox
            slot="dropdown-content"
            class="dropdown-content"
            selected="{{queryParams.assignment}}"
            attr-for-selected="item-id"
          >
            <paper-item></paper-item>
            <template
              is="dom-repeat"
              items="[[_toArray(assignments)]]"
              as="assignment"
            >
              <paper-item item-id="[[assignment.id]]"
                >[[assignment.attributes.title]]</paper-item
              >
            </template>
          </paper-listbox>
        </paper-dropdown-menu>
      </app-toolbar>
      <div class="gallery-grid">
        <iron-pages
          selected="{{data.page}}"
          attr-for-selected="name"
          fallback-selection="submissions"
          role="main"
        >
          <div class="iron-list-container" name="submissions">
            <iron-list
              id="ironlist"
              items="[[submissions]]"
              as="item"
              grid
              scroll-target="document"
            >
              <template>
                <div class="gallerycard-wrapper">
                  <a
                    href$="[[basePath]]lrnapp-studio-submission/submissions/[[item.id]]"
                  >
                    <lrndesign-gallerycard
                      elevation="2"
                      data-submission-id$="[[item.id]]"
                      title="[[item.attributes.title]]"
                      author="[[item.relationships.author.data]]"
                      comments="[[item.meta.comment_count]]"
                      image="[[item.display.image]]"
                      icon="[[item.display.icon]]"
                      date="[[item.meta.humandate]]"
                      class="ferpa-protect"
                    ></lrndesign-gallerycard>
                  </a>
                </div>
              </template>
            </iron-list>
          </div>
          <lrnapp-open-studio-assignments
            name="assignments"
            base-path="[[basePath]]"
            submissions="[[submissions]]"
            assignments="[[assignments]]"
            active-author-id="[[queryParams.author]]"
            active-assignment-id="[[queryParams.assignment]]"
          ></lrnapp-open-studio-assignments>
          <lrnapp-open-studio-projects
            name="projects"
            base-path="[[basePath]]"
            projects="[[projects]]"
            submissions="[[submissions]]"
            assignments="[[assignments]]"
            active-author-id="[[queryParams.author]]"
            active-project-id="[[queryParams.project]]"
          ></lrnapp-open-studio-projects>
          <lrnapp-open-studio-table
            name="table"
            base-path="[[basePath]]"
            submissions="[[submissions]]"
          ></lrnapp-open-studio-table>
        </iron-pages>
      </div>
      <paper-toast id="toast"></paper-toast>
    `}static get tag(){return"lrnapp-open-studio"}static get properties(){return{elmslnCourse:{type:String},elmslnSection:{type:String},basePath:{type:String},csrfToken:{type:String},endPoint:{type:String},studioResponse:{type:Object,notify:!0},submissions:{type:Array,notify:!0,computed:"_submissionsCompute(originalSubmissions, queryParams)"},originalSubmissions:{type:Array,notify:!0},projects:{type:Array,notify:!0,value:[]},assignments:{type:Array,notify:!0,value:[]},authors:{type:Array,notify:!0,value:[]},sourcePath:{type:String,notify:!0},endPoint:{type:String,notify:!0},basePath:{type:String,notify:!0},activeSubmission:{type:String,value:null,notify:!0},queryParams:{type:Object,notify:!0},_blockcycle:{type:Boolean,value:!1}}}ready(){super.ready(),setTimeout((()=>{window.dispatchEvent(new Event("resize"))}),0)}connectedCallback(){super.connectedCallback(),this.addEventListener("route-change",this._routeChange.bind(this)),setTimeout((()=>{window.dispatchEvent(new Event("resize"))}),1e3)}disconnectedCallback(){this.removeEventListener("route-change",this._routeChange.bind(this)),super.disconnectedCallback()}static get observers(){return["_routeChanged(route, endPoint)","_deleteToast(queryParams.deletetoast)","_assignmentFilterChanged(queryParams.assignment)","_projectFilterChanged(queryParams.project)"]}_routeChanged(t,e){if("string"==typeof t.path){if("string"==typeof e&&t.path.startsWith(e))return;window.location.reload()}}_routeChange(t){var e=t.detail;void 0!==e.queryParams.assignment&&this.set("queryParams.assignment",e.queryParams.assignment),void 0!==e.queryParams.project&&this.set("queryParams.project",e.queryParams.project),void 0!==e.queryParams.author&&this.set("queryParams.author",e.queryParams.author),void 0!==e.data.page&&this.set("data.page",e.data.page)}_submissionsCompute(t,e){if(void 0===t)return[];const s=this;let a=[];return a=t.filter((t=>(void 0===s.queryParams.author||t.relationships.author.data.id===s.queryParams.author)&&((void 0===s.queryParams.project||t.relationships.project.data.id===s.queryParams.project)&&(void 0===s.queryParams.assignment||t.relationships.assignment.id===s.queryParams.assignment)))),setTimeout((()=>{this.$.ironlist.fire("iron-resize"),window.dispatchEvent(new Event("resize"))}),200),a}_tableClicked(t){this.set("route.path",this.endPoint+"/table"),this.notifyPath("route.path")}_deleteToast(t,e){void 0!==t&&("error"==t?this.$.toast.show("That submission on longer exists!"):this.$.toast.show("Submission deleted successfully!"),this.set("queryParams.deletetoast",void 0),this.notifyPath("queryParams.deletetoast"))}_assignmentFilterChanged(t){void 0===t||this._blockcycle?this._blockcycle=!1:(this._blockcycle=!0,this.set("queryParams.project",void 0),this.notifyPath("queryParams.project"),this.set("queryParams.assignment",t),this.notifyPath("queryParams.assignment"))}_projectFilterChanged(t){void 0===t||this._blockcycle?this._blockcycle=!1:(this._blockcycle=!0,this.set("queryParams.project",t),this.notifyPath("queryParams.project"),this.set("queryParams.assignment",void 0),this.notifyPath("queryParams.assignment"))}_handleResponse(t){let e=this;var s={},a={},i={authors:[],assignments:[]},o={},r=[],n=[],p=[];null!=e.studioResponse.data.submissions&&(p=this._toArray(e.studioResponse.data.submissions));var l=[];null!=e.studioResponse.data.projects&&(l=this._toArray(e.studioResponse.data.projects)),this.set("projects",l),this.set("originalSubmissions",p);for(var d=0;d<p.length;d++)s=p[d].relationships.author.data,i.authors[s.id]=s,a=p[d].relationships.project.data,o=p[d].relationships.assignment,i.assignments[o.id]=o,i.assignments[o.id].project=a.id;i.authors.forEach((function(t){n.push(t)})),i.assignments.forEach((function(t){r.push(t)})),e.$.loading.hidden=!0,this.set("assignments",r),this.set("authors",n)}_submissionsClicked(t){this.set("route.path",this.endPoint+"/submissions"),this.notifyPath("route.path")}_projectsClicked(t){this.set("route.path",this.endPoint+"/projects"),this.notifyPath("route.path")}_assignmentsClicked(t){this.set("route.path",this.endPoint+"/assignments"),this.notifyPath("route.path")}_toArray(t){return null==t?[]:Object.keys(t).map((function(e){return t[e]}))}}window.customElements.define(LrnappOpenStudio.tag,LrnappOpenStudio);export{LrnappOpenStudio};