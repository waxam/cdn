/**
 * Copyright 2019 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
class ToElement extends HTMLElement{render(){return html` <style></style>
      <slot></slot>`}static get properties(){return{...super.properties,element:{name:"element",type:Object,value:{}},name:{name:"name",type:String,value:"new-element"},sourceUrl:{name:"sourceUrl",type:String,value:""},fileTypes:{type:Object,value:()=>({CSV:"text/csv",JSON:"text/json",PDF:"application/pdf",TXT:"text/plain"})}}}static get tag(){return"to-element"}constructor(e=!1){super(),this.tag=ToElement.tag;let t=ToElement.properties;for(let e in t)t.hasOwnProperty(e)&&(this.hasAttribute(e)?this[e]=this.getAttribute(e):(this.setAttribute(e,t[e].value),this[e]=t[e].value));this._queue=[],this.template=document.createElement("template"),this.attachShadow({mode:"open"}),e||this.render()}connectedCallback(){window.ShadyCSS&&window.ShadyCSS.styleElement(this),this._queue.length&&this._processQueue()}_copyAttribute(e,t){const n=this.shadowRoot.querySelectorAll(t),o=this.getAttribute(e),r=null==o?"removeAttribute":"setAttribute";for(const t of n)t[r](e,o)}_queueAction(e){this._queue.push(e)}_processQueue(){this._queue.forEach((e=>{this[`_${e.type}`](e.data)})),this._queue=[]}_setProperty({name:e,value:t}){this[e]=t}render(){this.shadowRoot.innerHTML=null,this.template.innerHTML=this.html,window.ShadyCSS&&window.ShadyCSS.prepareTemplate(this.template,this.tag),this.shadowRoot.appendChild(this.template.content.cloneNode(!0))}createNewElement(){this._tmp=this.element;let e=this.extractCSS(this._tmp).stylesheet;return{html:this._tmp.outerHTML,css:e}}generateUUID(){return"item-sss-ss-ss".replace(/s/g,this._uuidPart)}_uuidPart(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}getDefaultStyling(e,t=null){let n=e.tagName;var o=document.createElement("iframe");this.shadowRoot.appendChild(o);var r=o.contentDocument,a=r.createElement(n);r.body.appendChild(a);for(var s=o.contentWindow.getComputedStyle(a),i={},l=0,h=s.length;l<h;l++){var m=s[l];i[l]=m,i[m]=s[m]}return this.shadowRoot.removeChild(o),i}getStylesWithoutDefaults(e,t=null){for(var n=window.getComputedStyle(e,t),o=this.getDefaultStyling(e.tagName),r={},a=0,s=n.length;a<s;a++){var i=n[a],l=n[i];l!=o[i]&&"transform-origin"!==i&&"perspective-origin"!==i&&(r[i]=l)}return r}flatten(e){return e.reduce(((e,t)=>e.concat(Array.isArray(t)?this.flatten(t):t)),[])}recursiveExtract(e){const t=this.generateUUID(),n=this.getStylesWithoutDefaults(e);e.setAttribute("id",t);let o="";for(var r in n)o+=`      ${r}: ${n[r]};\n`;var a=Array.prototype.slice.call(e.children);return[{id:t,style:o}].concat(a.map(this.recursiveExtract.bind(this)))}extractCSS(e){if(!e)return{elements:[],stylesheet:""};var t=this.recursiveExtract(e),n=this.flatten(t);return{elements:n,stylesheet:n.reduce((function(e,t){return e+("    #"+t.id+" {\n"+t.style+"    }\n")}),"")}}dashToCamel(e){return e.replace(/-([a-z])/g,(function(e){return e[1].toUpperCase()}))}contentToFile(e){return`\n/**\n * Copyright 2019 {Your compay}\n * @license Apache-2.0, see License.md for full text.\n */\nimport { html, PolymerElement } from "@polymer/polymer/polymer-element.js";\n/**\n * \`${this.name}\`\n * \`An auto generated element via to-element\`\n *\n * @microcopy - language worth noting:\n *  - This element was made by someone else and then forked from their site\n *  - The point is not perfection but to rapidly generate boilerplate\n *\n * @originalSite - This code is based on work originally found on\n *   - ${this.sourceUrl}\n\n * @polymer\n */\nclass ${this.dashToCamel(this.name)} extends PolymerElement {\n  \n  // render function\n  static get template() {\n    return html\`\n    ${e}\n    \`;\n  }\n\n  // properties available to the custom element for data binding\n  static get properties() {\n    return {\n      "title": {\n        "name": "title",\n        "type": String,\n        "value": "",\n      }\n    };\n  }\n\n  /**\n   * Store the tag name to make it easier to obtain directly.\n   */\n  static get tag() {\n    return "${this.name}";\n  }\n  /**\n   * life cycle, element is afixed to the DOM\n   */\n  //connectedCallback() { super.connectedCallback(); }\n  /**\n   * life cycle, element is removed from the DOM\n   */\n  //disconnectedCallback() {super.disconnectedCallback();}\n}\nwindow.customElements.define(${this.dashToCamel(this.name)}.tag, ${this.dashToCamel(this.name)});\nexport { ${this.dashToCamel(this.name)} };\n    `}downloadNewComponent(e,t){e&&(this.element=e),t&&(this.name=t);let n=this.createNewElement(),o=`<style>\n${n.css}</style>\n    ${n.html}`,r=this.contentToFile(o);this.downloadFromData(r,"js",this.name)}downloadFromData(e,t,n="download",o=!0){const r=this.fileTypes[t.toUpperCase()],a=new Blob([decodeURIComponent(encodeURI(e))],{type:r}),s=n+"."+t.toLowerCase();if(window.navigator&&window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(a,s);else{const e=document.createElement("a");e.href=(window.URL||window.webkitURL).createObjectURL(a),e.download=s,e.target=o?"_blank":"_self",this.shadowRoot.appendChild(e),e.click(),this.shadowRoot.removeChild(e)}}downloadFromURI(e,t=!0){return window.open(e,t?"_blank":"_self"),!0}}window.customElements.define(ToElement.tag,ToElement);export{ToElement};