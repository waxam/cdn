import{html,PolymerElement}from"../../@polymer/polymer/polymer-element.js";import{afterNextRender}from"../../@polymer/polymer/lib/utils/render-status.js";import{dom}from"../../@polymer/polymer/lib/legacy/polymer.dom.js";import{microTask}from"../../@polymer/polymer/lib/utils/async.js";import{HAXWiring}from"../hax-body-behaviors/lib/HAXWiring.js";import"../../@polymer/iron-a11y-keys/iron-a11y-keys.js";import"../responsive-utility/responsive-utility.js";class GridPlate extends PolymerElement{constructor(){super(),import("../../@polymer/paper-icon-button/paper-icon-button.js"),import("../../@polymer/iron-icons/iron-icons.js")}static get template(){return html`
      <style include="simple-colors">
        :host {
          display: block;
          --grid-plate-row-margin: 0px;
          --grid-plate-row-padding: 0px;
          --grid-plate-item-margin: 15px;
          --grid-plate-editable-border-color: #ccc;
          --grid-plate-active-border-color: #6cd;
          --grid-plate-col-transition: all 0.2s ease-in-out;
        }
        :host .row {
          width: 100%;
          display: flex;
          flex-wrap: wrap;
          justify-content: space-between;
          align-items: stretch;
          margin: var(--grid-plate-row-margin);
          padding: var(--grid-plate-row-padding);
        }
        :host .column {
          width: 100%;
          flex: 0 0 auto;
          transition: var(--grid-plate-col-transition);
        }
        :host([edit-mode]) .column {
          min-height: 150px;
        }

        :host([edit-mode]) .column {
          outline: 1px dotted var(--grid-plate-editable-border-color);
        }
        :host .column[style="min-height: unset"] {
          display: none;
        }
        :host([edit-mode]) .column[style="min-height: unset"]:not(:empty) {
          display: block;
          outline: 1px solid red;
          width: 20%;
          margin-top: var(--grid-plate-item-margin);
        }
        :host([edit-mode])
          .column[style="min-height: unset"]:not(:empty):before {
          content: "Layout hides column (" attr(id) ")";
          color: red;
          margin: var(--grid-plate-item-margin);
          padding: 15px 0;
          min-height: 150px;
        }
        :host ::slotted(*) {
          margin: var(--grid-plate-item-margin);
          padding: 0;
        }
        :host ::slotted(*.mover) {
          outline: 2px dashed var(--grid-plate-editable-border-color);
          outline-offset: 4px;
        }
        :host ::slotted(*.active-item) {
          outline: 2px dashed var(--grid-plate-active-border-color);
          outline-offset: 4px;
        }
        :host ::slotted(*[data-draggable]:focus),
        :host ::slotted(*[data-draggable]:hover),
        :host ::slotted(*[data-draggable]:active) {
          cursor: move;
        }

        :host([edit-mode]) .column.mover {
          background-color: yellow;
        }
        :host .column[data-draggable].mover {
          background-color: pink;
        }

        paper-icon-button {
          display: none;
          position: absolute;
          margin: 0;
          padding: 0;
          outline: none;
          width: 20px;
          height: 20px;
          color: black;
          background-color: #eeeeee;
          border-radius: 50%;
          box-sizing: content-box !important;
          z-index: 1;
          min-width: unset;
        }

        paper-icon-button[disabled] {
          color: #aaa;
          background-color: #ddd;
        }
        paper-icon-button[disabled]:focus,
        paper-icon-button[disabled]:hover {
          cursor: not-allowed;
        }
        paper-icon-button.active {
          display: block;
        }

        .button-holding-pen {
          position: relative;
        }
      </style>
      <div class="button-holding-pen">
        <paper-icon-button
          icon="icons:arrow-upward"
          title="move item up"
          id="up"
          on-click="moveActiveElement"
        >
        </paper-icon-button>
        <paper-icon-button
          icon="icons:arrow-forward"
          title="move item right"
          id="right"
          on-click="moveActiveElement"
        >
        </paper-icon-button>
        <paper-icon-button
          icon="icons:arrow-downward"
          title="move item down"
          id="down"
          on-click="moveActiveElement"
        >
        </paper-icon-button>
        <paper-icon-button
          icon="icons:arrow-back"
          title="move item left"
          id="left"
          on-click="moveActiveElement"
        >
        </paper-icon-button>
      </div>
      <div class="row">
        <div
          class="column"
          id="col1"
          style$="[[_getColumnWidth(0,columnWidths)]]"
        >
          <slot name="col-1"></slot>
        </div>
        <div
          class="column"
          id="col2"
          style$="[[_getColumnWidth(1,columnWidths)]]"
        >
          <slot name="col-2"></slot>
        </div>
        <div
          class="column"
          id="col3"
          style$="[[_getColumnWidth(2,columnWidths)]]"
        >
          <slot name="col-3"></slot>
        </div>
        <div
          class="column"
          id="col4"
          style$="[[_getColumnWidth(3,columnWidths)]]"
        >
          <slot name="col-4"></slot>
        </div>
        <div
          class="column"
          id="col5"
          style$="[[_getColumnWidth(4,columnWidths)]]"
        >
          <slot name="col-5"></slot>
        </div>
        <div
          class="column"
          id="col6"
          style$="[[_getColumnWidth(5,columnWidths)]]"
        >
          <slot name="col-6"></slot>
        </div>
      </div>
      <iron-a11y-keys
        stop-keyboard-event-propagation
        target="[[__activeItem]]"
        keys="enter"
        on-keys-pressed="setActiveElement"
      ></iron-a11y-keys>
      <iron-a11y-keys
        target="[[__activeItem]]"
        keys="esc"
        on-keys-pressed="cancelActive"
      ></iron-a11y-keys>
    `}static get tag(){return"grid-plate"}connectedCallback(){super.connectedCallback(),afterNextRender(this,function(){this.addEventListener("focusin",this._focusIn.bind(this)),this.addEventListener("focusout",this._focusOut.bind(this)),document.body.addEventListener("hax-store-property-updated",this._haxStorePropertyUpdated.bind(this)),document.body.addEventListener("hax-insert-content",this.haxInsertContent.bind(this))}),window.ResponsiveUtility.requestAvailability(),window.dispatchEvent(new CustomEvent("responsive-element",{detail:{element:this,attribute:"responsive-size",relativeToParent:!0,sm:this.breakpointSm,md:this.breakpointMd,lg:this.breakpointLg,xl:this.breakpointXl}})),this.options={};let layouts=Object.keys(this.layouts);(()=>{for(let i=0;i<layouts.length;i++)this.options[layouts[i]]=this.layouts[layouts[i]].columnLayout})(),this.HAXWiring=new HAXWiring,this.HAXWiring.setup(GridPlate.haxProperties,GridPlate.tag,this)}static get haxProperties(){return{canScale:!0,canPosition:!0,canEditSource:!1,settings:{quick:[],configure:[{property:"layout",title:"Column Layout",description:"Style to present these items (may change for small screens)",inputMethod:"select",options:this.options}],advanced:[{property:"breakpointSm",title:"Small Breakpoint",description:"Anything less than this number (in pixels) will render with the smallest version of this layout",inputMethod:"textfield",validationType:"number"},{property:"breakpointMd",title:"Medium Breakpoint",description:"Anything less than this number (in pixels) will render with the small version of this layout",inputMethod:"textfield",validationType:"number"},{property:"breakpointLg",title:"Large Breakpoint",description:"Anything less than this number (in pixels) will render with the medium version of this layout.",inputMethod:"textfield",validationType:"number"},{property:"breakpointXl",title:"Extra-Large Breakpoint",description:"Anything less than this number (in pixels) will render with the large version of this layout. Anything greater than or equal to this number will display with the maximum number of columns for this layout.",inputMethod:"textfield",validationType:"number"}]},saveOptions:{unsetAttributes:["__active-item","edit-mode","layouts"]}}}static get properties(){return{droppable:{type:Boolean,value:!1,reflectToAttribute:!0,observer:"_droppableChanged"},ignoreHax:{type:Boolean,value:!1},breakpointSm:{type:Number,value:900},breakpointMd:{type:Number,value:1200},breakpointLg:{type:Number,value:1500},breakpointXl:{type:Number,value:1800},columns:{type:Number,computed:"_getColumns(columnWidths)",reflectToAttribute:!0},disableResponsive:{type:Boolean,value:!1,notify:!0},editMode:{reflectToAttribute:!0,type:Boolean,value:!1,observer:"_editModeChanged"},layout:{type:String,value:"1-1",reflectToAttribute:!0},layouts:{type:Object,readOnly:!0,value:{1:{columnLayout:"1: full width",xs:["100%"],sm:["100%"],md:["100%"],lg:["100%"],xl:["100%"]},"1-1":{columnLayout:"2: equal width",xs:["100%","100%"],sm:["50%","50%"],md:["50%","50%"],lg:["50%","50%"],xl:["50%","50%"]},"2-1":{columnLayout:"2: wide & narrow",xs:["100%","100%"],sm:["50%","50%"],md:["66.6666667%","33.3333337%"],lg:["66.6666667%","33.3333337%"],xl:["66.6666667%","33.3333337%"]},"1-2":{columnLayout:"2: narrow & wide",xs:["100%","100%"],sm:["50%","50%"],md:["33.3333333%","66.6666667%"],lg:["33.3333333%","66.6666667%"],xl:["33.3333333%","66.6666667%"]},"3-1":{columnLayout:"2: wider & narrower",xs:["100%","100%"],sm:["50%","50%"],md:["75%","25%"],lg:["75%","25%"],xl:["75%","25%"]},"1-3":{columnLayout:"2: narrower & wider",xs:["100%","100%"],sm:["50%","50%"],md:["25%","75%"],lg:["25%","75%"],xl:["25%","75%"]},"1-1-1":{columnLayout:"3: equal width",xs:["100%","100%","100%"],sm:["100%","100%","100%"],md:["33.3333333%","33.3333333%","33.3333333%"],lg:["33.3333333%","33.3333333%","33.3333333%"],xl:["33.3333333%","33.3333333%","33.3333333%"]},"2-1-1":{columnLayout:"3: wide, narrow, and narrow",xs:["100%","100%","100%"],sm:["100%","50%","50%"],md:["50%","25%","25%"],lg:["50%","25%","25%"],xl:["50%","25%","25%"]},"1-2-1":{columnLayout:"3: narrow, wide, and narrow",xs:["100%","100%","100%"],sm:["100%","100%","100%"],md:["25%","50%","25%"],lg:["25%","50%","25%"],xl:["25%","50%","25%"]},"1-1-2":{columnLayout:"3: narrow, narrow, and wide",xs:["100%","100%","100%"],sm:["50%","50%","100%"],md:["25%","25%","50%"],lg:["25%","25%","50%"],xl:["25%","25%","50%"]},"1-1-1-1":{columnLayout:"4: equal width",xs:["100%","100%","100%","100%"],sm:["50%","50%","50%","50%"],md:["25%","25%","25%","25%"],lg:["25%","25%","25%","25%"],xl:["25%","25%","25%","25%"]},"1-1-1-1-1":{columnLayout:"5: equal width",xs:["100%","100%","100%","100%","100%"],sm:["50%","50%","50%","50%","50%"],md:["20%","20%","20%","20%","20%"],lg:["20%","20%","20%","20%","20%"],xl:["20%","20%","20%","20%","20%"]},"1-1-1-1-1-1":{columnLayout:"6: equal width",xs:["100%","100%","100%","100%","100%","100%"],sm:["50%","50%","50%","50%","50%","50%"],md:["33.3333333%","33.3333333%","33.3333333%","33.3333333%","33.3333333%","33.3333333%"],lg:["16.6666667%","16.6666667%","16.6666667%","16.6666667%","16.6666667%","16.6666667%"],xl:["16.6666667%","16.6666667%","16.6666667%","16.6666667%","16.6666667%","16.6666667%"]}}},responsiveSize:{type:String,value:"xs",reflectToAttribute:!0},__activeItem:{type:Object,observer:"_activeItemChanged"},columnWidths:{type:String,computed:"_getColumnWidths(responsiveSize,layout,layouts,disableResponsive)"}}}_droppableChanged(newValue){newValue&&(this.editMode=!0)}cancelActive(e){this.__activeItem=null}canMoveSlot(item,before){let dir=before?-1:1,max=this.shadowRoot.querySelectorAll(".column").length,col=item.getAttribute("slot").split("-"),dest=parseInt(col[1])+dir;return dest>=1&&dest<=max}moveSlot(item,before){let dir=before?-1:1,col=item.getAttribute("slot").split("-"),dest=parseInt(col[1])+dir;this.canMoveSlot(item,dir)&&item.setAttribute("slot","col-"+dest)}canMoveOrder(item,before){let target=before?item.previousElementSibling:item.nextElementSibling;return null!==target&&target.getAttribute("slot")===item.getAttribute("slot")}moveOrder(item,before=!0){this.canMoveOrder(item,before)&&(before?dom(this).insertBefore(this.__activeItem,this.__activeItem.previousElementSibling):dom(this).insertBefore(this.__activeItem.nextElementSibling,this.__activeItem))}moveActiveElement(e){switch(dom(e).localTarget.id){case"up":this.moveOrder(this.__activeItem,!0);break;case"down":this.moveOrder(this.__activeItem,!1);break;case"left":this.moveSlot(this.__activeItem,!0);break;case"right":this.moveSlot(this.__activeItem,!1)}setTimeout(()=>{this.__activeItem&&"function"==typeof this.__activeItem.focus&&(this.positionArrows(this.__activeItem),this.__activeItem.focus())},100)}_activeItemChanged(newValue,oldValue){void 0!==newValue&&null!=newValue?(newValue.classList.add("active-item"),this.positionArrows(newValue)):null==newValue&&this.positionArrows(newValue),void 0!==oldValue&&null!=oldValue&&(oldValue.classList.remove("active-item"),oldValue.blur())}setActiveElement(e){this.shadowRoot.querySelector("#right").focus(),e.preventDefault(),e.stopPropagation()}_getColumnWidths(responsiveSize="sm",layout="1-1",layouts,disableResponsive){if(layouts){let newl=layouts[layout],size=!1!==disableResponsive?"xl":responsiveSize,oldl={12:"1","8/4":"2-1","6/6":"1-1","4/8":"1-2","4/4/4":"1-1-1","3/3/3/3":"1-1-1-1"}[layout];if(void 0!==newl&&void 0!==newl[size])return layouts[layout][size];if(void 0!==layouts[oldl]&&void 0!==layouts[oldl][size])return layouts[oldl][size];if(void 0!==layouts["1-1"])return layouts["1-1"][size]}}_getColumnWidth(column,columnWidths){return void 0!==columnWidths&&void 0!==columnWidths[column]?"width:"+columnWidths[column]:"min-height: unset"}_getColumns(columnWidths){return columnWidths.length}_focusIn(e){if(this.editMode){var local=dom(e).localTarget;dom(local).parentNode===this&&(this.__activeItem=local)}}_focusOut(e){this.editMode&&(dom(e).localTarget.parentNode===this||document.activeElement.parentNode===this||document.activeElement)}positionArrows(item){if(null==item)this.shadowRoot.querySelector("#up").classList.remove("active"),this.shadowRoot.querySelector("#down").classList.remove("active"),this.shadowRoot.querySelector("#left").classList.remove("active"),this.shadowRoot.querySelector("#right").classList.remove("active");else{this.shadowRoot.querySelector("#up").classList.add("active"),this.shadowRoot.querySelector("#down").classList.add("active"),this.shadowRoot.querySelector("#left").classList.add("active"),this.shadowRoot.querySelector("#right").classList.add("active"),this.shadowRoot.querySelector("#up").disabled=!this.canMoveOrder(item,!0),this.shadowRoot.querySelector("#down").disabled=!this.canMoveOrder(item,!1),this.shadowRoot.querySelector("#left").disabled=!this.canMoveSlot(item,!0),this.shadowRoot.querySelector("#right").disabled=!this.canMoveSlot(item,!1);let bodyRect=this.getBoundingClientRect(),elemRect=item.getBoundingClientRect(),topOffset=elemRect.top-bodyRect.top,leftOffset=elemRect.left-bodyRect.left;this.shadowRoot.querySelector("#up").style.top=topOffset-20+"px",this.shadowRoot.querySelector("#down").style.top=topOffset+elemRect.height+"px",this.shadowRoot.querySelector("#left").style.top=topOffset+elemRect.height/2+"px",this.shadowRoot.querySelector("#right").style.top=topOffset+elemRect.height/2+"px",this.shadowRoot.querySelector("#up").style.left=leftOffset+elemRect.width/2-10+"px",this.shadowRoot.querySelector("#down").style.left=leftOffset+elemRect.width/2-10+"px",this.shadowRoot.querySelector("#left").style.left=leftOffset-20+"px",this.shadowRoot.querySelector("#right").style.left=leftOffset+elemRect.width+"px"}}_editModeChanged(newValue,oldValue){let children=dom(this).getEffectiveChildNodes();if("object"==typeof children)if(newValue&&!oldValue){for(var i in children)void 0!==children[i].tagName&&(children[i].addEventListener("drop",this.dropEvent.bind(this)),children[i].addEventListener("dragstart",this.dragStart.bind(this)),children[i].addEventListener("dragend",this.dragEnd.bind(this)),children[i].addEventListener("dragover",function(e){e.preventDefault()}),children[i].setAttribute("draggable",!0),children[i].setAttribute("data-draggable",!0),children[i].setAttribute("tabindex",0));microTask.run(()=>{for(var j=1;j<=this.columns.length;j++)void 0!==this.shadowRoot.querySelector("#col"+j)&&(this.shadowRoot.querySelector("#col"+j).addEventListener("drop",this.dropEvent.bind(this)),this.shadowRoot.querySelector("#col"+j).addEventListener("dragstart",this.dragStart.bind(this)),this.shadowRoot.querySelector("#col"+j).addEventListener("dragend",this.dragEnd.bind(this)),this.shadowRoot.querySelector("#col"+j).addEventListener("dragover",function(e){e.preventDefault()}),this.shadowRoot.querySelector("#col"+j).setAttribute("data-draggable",!0))})}else if(!newValue&&oldValue){for(var i in children)void 0!==children[i].tagName&&(children[i].removeEventListener("drop",this.dropEvent.bind(this)),children[i].removeEventListener("dragstart",this.dragStart.bind(this)),children[i].removeEventListener("dragend",this.dragEnd.bind(this)),children[i].removeEventListener("dragover",function(e){e.preventDefault()}),children[i].removeAttribute("draggable"),children[i].removeAttribute("data-draggable"),children[i].removeAttribute("tabindex"));microTask.run(()=>{for(var j=1;j<=this.columns.length;j++)void 0!==this.shadowRoot.querySelector("#col"+j)&&(this.shadowRoot.querySelector("#col"+j).removeEventListener("drop",this.dropEvent.bind(this)),this.shadowRoot.querySelector("#col"+j).removeEventListener("dragstart",this.dragStart.bind(this)),this.shadowRoot.querySelector("#col"+j).removeEventListener("dragend",this.dragEnd.bind(this)),this.shadowRoot.querySelector("#col"+j).removeEventListener("dragover",function(e){e.preventDefault()}),this.shadowRoot.querySelector("#col"+j).removeAttribute("data-draggable"))})}}dropEvent(e){var local=dom(e).localTarget;if(void 0!==this.__activeItem&&void 0!==local&&null!=local.getAttribute("slot")&&this.__activeItem!==local)this.__activeItem.setAttribute("slot",local.getAttribute("slot")),dom(this).insertBefore(this.__activeItem,local),e.preventDefault(),e.stopPropagation();else if(".column"===local.tagName){var col=local.id.replace("col","");this.__activeItem.setAttribute("slot","col-"+col),dom(this).appendChild(this.__activeItem),e.preventDefault(),e.stopPropagation()}let children=dom(this).children;for(var i in children)void 0!==children[i].classList&&children[i].classList.remove("mover");for(var j=1;j<=this.columns.length;j++)void 0!==this.shadowRoot.querySelector("#col"+j)&&this.shadowRoot.querySelector("#col"+j).classList.remove("mover");setTimeout(()=>{this.__activeItem&&"function"==typeof this.__activeItem.focus&&(this.positionArrows(this.__activeItem),this.__activeItem.focus())},100)}dragStart(e){let children=dom(this).children;for(var i in children)void 0!==children[i].classList&&children[i].classList.add("mover");for(var j=1;j<=this.columns.length;j++)void 0!==this.shadowRoot.querySelector("#col"+j)&&this.shadowRoot.querySelector("#col"+j).classList.add("mover")}dragEnd(e){let children=dom(this).children;for(var i in children)void 0!==children[i].classList&&children[i].classList.remove("mover");for(var j=1;j<=this.columns.length;j++)void 0!==this.shadowRoot.querySelector("#col"+j)&&this.shadowRoot.querySelector("#col"+j).classList.remove("mover")}haxInsertContent(e){this===window.HaxStore.instance.activeContainerNode&&(this.editMode=!1,setTimeout(()=>{this.editMode=!0,this.__activeItem&&"function"==typeof this.__activeItem.focus&&(this.positionArrows(this.__activeItem),this.__activeItem.focus())},100))}_haxStorePropertyUpdated(e){e.detail&&void 0!==e.detail.value&&e.detail.property&&("object"==typeof e.detail.value&&this.set(e.detail.property,null),"editMode"===e.detail.property&&this.ignoreHax||this.set(e.detail.property,e.detail.value))}}window.customElements.define(GridPlate.tag,GridPlate);export{GridPlate};