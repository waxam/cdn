/**
 * Copyright 2019 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
class RandomItem extends HTMLElement{render(){return html` <style>
        :host {
          display: block;
        }

        :host([hidden]) {
          display: none;
        }
      </style>
      ${this.dataPoint}`}static get haxProperties(){return{canScale:!0,canPosition:!0,canEditSource:!0,gizmo:{title:"Random item",description:"Show a random item from a list of items",icon:"places:casino",color:"red",groups:["Item"],handles:[],meta:{author:"btopro",owner:"The Pennsylvania State University"}},settings:{configure:[{property:"field",title:"Field",description:"Field in the file to show",inputMethod:"textfield",required:!1},{property:"source",title:"Source",description:"URL pointing to a CSV file",inputMethod:"haxupload",required:!0}],advanced:[]}}}static get properties(){return{...super.properties,source:{name:"source",type:String},field:{name:"field",type:String}}}static get tag(){return"random-item"}constructor(t=!1){super(),this.tag=RandomItem.tag,this.template=document.createElement("template"),this.attachShadow({mode:"open"}),t||this.render()}connectedCallback(){window.ShadyCSS&&window.ShadyCSS.styleElement(this)}render(){this.shadowRoot.innerHTML=null,this.template.innerHTML=this.html,window.ShadyCSS&&window.ShadyCSS.prepareTemplate(this.template,this.tag),this.shadowRoot.appendChild(this.template.content.cloneNode(!0))}static get observedAttributes(){return["source","field"]}attributeChangedCallback(t,e,i){"source"===t&&i?(this.source=i,this.sourceChanged(i)):"field"===t&&i&&(this.field=i,this.source&&this.setDataWithRandom())}async sourceChanged(t){let e=await fetch(t).then((function(t){return t.text()}));this.items=this.CSVtoArray(e);var i=this.items.shift();this.qKey=i,this.entryPoint=0,this.setDataWithRandom()}setDataWithRandom(){for(let t in this.qKey)this.qKey[t]===this.field&&(this.entryPoint=Number(t));var t=Math.floor(Math.random()*this.items.length);this.dataPoint=this.items[t][this.entryPoint],this.render()}CSVtoArray(t){let e,i="",n=[""],o=[n],s=0,a=0,r=!0;for(e in t)e=t[e],'"'===e?(r&&e===i&&(n[s]+=e),r=!r):","===e&&r?e=n[++s]="":"\n"===e&&r?("\r"===i&&(n[s]=n[s].slice(0,-1)),n=o[++a]=[e=""],s=0):n[s]+=e,i=e;return o}}window.customElements.define(RandomItem.tag,RandomItem);export{RandomItem};