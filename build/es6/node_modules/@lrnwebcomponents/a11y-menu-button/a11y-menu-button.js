/**
 * Copyright 2018 Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{LitElement as t,html as e,css as o}from"../../lit/index.js";import"./lib/a11y-menu-button-item.js";import"../absolute-position-behavior/absolute-position-behavior.js";const A11yMenuButtonBehaviors=function(t){return class extends t{static get menuButtonCoreStyles(){return[o`
          :host {
            padding: 0;
            display: inline-flex;
            position: relative;
            z-index: 1;
          }
          :host([expanded]) {
            z-index: var(--a11y-menu-button-focus-z-index, 1000);
          }
          button[part="button"] {
            display: block;
            text-decoration: inherit;
            font-family: inherit;
            font-size: inherit;
            margin: 0;
            width: 100%;
          }
          absolute-position-behavior {
            z-index: -1;
            overflow: hidden;
            transition: z-index 0s;
          }
          :host([expanded]) absolute-position-behavior {
            z-index: var(--a11y-menu-button-focus-z-index, 1000);
            transition: z-index 0s;
          }
          :host(:not([expanded])) absolute-position-behavior {
            border-color: none !important;
          }
          ul {
            margin: 0;
            padding: 0;
            list-style: none;
          }
        `]}static get menuButtonThemeStyles(){return[o`
          button[part="button"] {
            padding: var(--a11y-menu-button-vertical-padding, 2px)
              var(--a11y-menu-button-horizontal-padding, 5px);
            text-align: var(--a11y-menu-button-text-align, center);
            background-color: var(--a11y-menu-button-bg-color, white);
            color: var(--a11y-menu-button-color, currentColor);
            background-color: var(--a11y-menu-button-bg-color, white);
            border-radius: var(--a11y-menu-button-border-radius, 0);
            border-left: var(--a11y-menu-button-border-left, unset);
            border-top: var(--a11y-menu-button-border-top, unset);
            border-right: var(--a11y-menu-button-border-right, unset);
            border-bottom: var(--a11y-menu-button-border-bottom, unset);
            border: var(--a11y-menu-button-border, 1px solid #ddd);
            box-shadow: var(--a11y-menu-button-box-shadow, unset);
            transition: all 0.25s ease-in-out;
          }
          button[part="button"]:focus,
          button[part="button"]:hover {
            color: var(
              --a11y-menu-button-focus-color,
              var(--a11y-menu-button-color, currentColor)
            );
            background-color: var(
              --a11y-menu-button-focus-bg-color,
              var(--a11y-menu-button-bg-color, white)
            );
            border-left: var(
              --a11y-menu-button-focus-border-left,
              var(--a11y-menu-button-border-left, unset)
            );
            border-top: var(
              --a11y-menu-button-focus-border-top,
              var(--a11y-menu-button-border-top, unset)
            );
            border-right: var(
              --a11y-menu-button-focus-border-right,
              var(--a11y-menu-button-border-right, unset)
            );
            border-bottom: var(
              --a11y-menu-button-focus-border-bottom,
              var(--a11y-menu-button-border-bottom, unset)
            );
            border: var(
              --a11y-menu-button-focus-border,
              var(--a11y-menu-button-border, 1px solid #ddd)
            );
            box-shadow: var(
              --a11y-menu-button-box-shadow,
              var(--a11y-menu-button-focus-box-shadow, unset)
            );
          }
          :host([expanded]) absolute-position-behavior {
            width: var(--a11y-menu-button-list-width, unset);
            height: var(--a11y-menu-button-list-height, unset);
            border: var(
              --a11y-menu-button-list-border,
              var(--a11y-menu-button-border, 1px solid #ddd)
            );
            background-color: var(
              --a11y-menu-button-bg-color,
              var(--a11y-menu-button-list-bg-color, white)
            );
            box-shadow: var(--a11y-menu-button-list-box-shadow, unset);
          }
        `]}static get styles(){return[...this.menuButtonCoreStyles,...this.menuButtonThemeStyles]}render(){return e` ${this.buttonTemplate} ${this.menuTemplate} `}static get tag(){return"a11y-menu-button"}static get properties(){return{currentItem:{type:Object},disabled:{attribute:"disabled",type:Boolean},expanded:{attribute:"expanded",type:Boolean,reflect:!0},focused:{attribute:"focused",type:Boolean},hovered:{attribute:"hovered",type:Boolean},offset:{type:Number,attribute:"offset"},position:{type:String,attribute:"position",reflect:!0},positionAlign:{type:String,attribute:"position-align",reflect:!0},__menuItems:{type:Array}}}constructor(){super(),this.__menuItems=[],this.position="bottom",this.positionAlign="start",this.offset=0,this.addEventListener("keydown",this._handleKeydown),this.addEventListener("click",this._handleClick),this.addEventListener("focus",this._handleFocus),this.addEventListener("blur",this._handleBlur),this.addEventListener("mouseover",this._handleMouseover),this.addEventListener("mouseout",this._handleMouseout),this.addEventListener("add-a11y-menu-button-item",this._handleAddItem),this.addEventListener("remove-a11y-menu-button-item",this._handleRemoveItem)}get menuTemplate(){return e`
        <absolute-position-behavior
          ?auto="${this.expanded}"
          for="menubutton"
          position="${this.position}"
          position-align="${this.positionAlign}"
          .offset="${this.offset}"
          fit-to-visible-bounds
          part="menu-outer"
        >
          <ul
            id="menu"
            role="menu"
            aria-labelledby="menubutton"
            ?hidden="${!this.expanded}"
            @mousover="${t=>this.hover=!0}"
            @mousout="${t=>this.hover=!1}"
            part="menu"
          >
            ${this.listItemTemplate}
          </ul>
        </absolute-position-behavior>
      `}get buttonTemplate(){return e`
        <button
          id="menubutton"
          aria-haspopup="true"
          aria-controls="menu"
          aria-expanded="${this.expanded?"true":"false"}"
          part="button"
        >
          <slot name="button"></slot>
        </button>
      `}get listItemTemplate(){return e`<slot></slot>`}get keyCode(){return{TAB:9,RETURN:13,ESC:27,SPACE:32,PAGEUP:33,PAGEDOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40}}close(t){(t||!this.focused&&!this.hovered)&&(this.expanded=!1,this.dispatchEvent(new CustomEvent("close",{bubbles:!0,cancelable:!0,composed:!0,detail:this})))}open(){this.expanded=!0,this.dispatchEvent(new CustomEvent("open",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}focus(){this.shadowRoot&&this.shadowRoot.querySelector("#menubutton")&&this.shadowRoot.querySelector("#menubutton").focus()}focusOn(t){(t=t||this.firstItem())&&(this.open(),this.focused=!0,this.currentItem=t,t.focus())}focusByCharacter(t){t=t.toLowerCase();var e,o,firstChars=(t,e)=>{for(var o=t;o<this.firstChars.length;o++)if(e===this.firstChars[o])return o;return-1};(e=this.__menuItems.indexOf(this.currentItem)+1)===this.__menuItems.length&&(e=0),-1===(o=firstChars(e,t))&&(o=firstChars(0,t)),o>-1&&this.__menuItems[o].focus()}firstItem(){return this.querySelector("a11y-menu-button-item")}previousItem(){return this.currentItem?this.currentItem.previousElementSibling:void 0}nextItem(){return this.currentItem?this.currentItem.nextElementSibling:void 0}lastItem(){return this.querySelector("a11y-menu-button-item:last-child")}_handleAddItem(t){t.stopPropagation(),this.__menuItems=this.querySelectorAll("a11y-menu-button-item"),t.detail&&(t.detail.addEventListener("keydown",(e=>this._handleItemKeydown(e,t.detail))),t.detail.addEventListener("click",this._handleItemClick.bind(this)),t.detail.addEventListener("focus",this._handleFocus.bind(this)),t.detail.addEventListener("blur",this._handleBlur.bind(this)),t.detail.addEventListener("mouseover",this._handleMouseover.bind(this)),t.detail.addEventListener("mouseout",this._handleMouseout.bind(this)))}_handleRemoveItem(t){t.stopPropagation(),this.__menuItems=this.querySelectorAll("a11y-menu-button-item"),t.detail&&(t.detail.removeEventListener("keydown",(e=>this._handleItemKeydown(e,t.detail))),t.detail.removeEventListener("click",this._handleItemClick.bind(this)),t.detail.removeEventListener("focus",this._handleFocus.bind(this)),t.detail.removeEventListener("blur",this._handleItemBlur.bind(this)),t.detail.removeEventListener("mouseover",this._handleMouseover.bind(this)),t.detail.removeEventListener("mouseout",this._handleMouseout.bind(this)))}_handleItemClick(t){this.focus(),this.close(!0),this.dispatchEvent(new CustomEvent("item-click",{bubbles:!0,cancelable:!0,composed:!0,detail:t}))}_handleItemKeydown(t,e){var o=!1,n=t.key,isPrintableCharacter=t=>1===t.length&&t.match(/\S/);if(!(t.ctrlKey||t.altKey||t.metaKey||t.keyCode===this.keyCode.SPACE||t.keyCode===this.keyCode.RETURN)){if(t.shiftKey)isPrintableCharacter(n)&&(this.menu.setFocusByFirstCharacter(this,n),o=!0),t.keyCode===this.keyCode.TAB&&(this.focus(),this.close(!0));else switch(t.keyCode){case this.keyCode.ESC:this.focus(),this.close(!0),o=!0;break;case this.keyCode.UP:this.focusOn(this.previousItem()||this.lastItem()),o=!0;break;case this.keyCode.DOWN:this.focusOn(this.nextItem()||this.firstItem()),o=!0;break;case this.keyCode.HOME:case this.keyCode.PAGEUP:this.currentItem=this.firstItem(),o=!0;break;case this.keyCode.END:case this.keyCode.PAGEDOWN:this.currentItem=this.lastItem(),o=!0;break;case this.keyCode.TAB:this.focus(),this.close(!0);break;default:isPrintableCharacter(n)&&this.menu.setFocusByFirstCharacter(this,n)}o&&(t.stopPropagation(),t.preventDefault())}}_handleItemBlur(t){this.focused=!1,setTimeout(this.close(),300)}_handleKeydown(t){var e=!1;switch(t.keyCode){case this.keyCode.SPACE:case this.keyCode.RETURN:case this.keyCode.DOWN:this.focusOn(this.firstItem()),e=!0;break;case this.keyCode.UP:this.popupMenu&&(this.focusOn(this.lastItem()),e=!0)}e&&(t.stopPropagation(),t.preventDefault())}_handleClick(t){this.expanded?this.close(!0):this.focusOn(this.firstItem())}_handleFocus(t){this.focused=!0}_handleBlur(t){this.focused=!1}_handleMouseover(t){this.hovered=!0,this.open()}_handleMouseout(t){this.hovered=!1,setTimeout(this.close(),300)}}};class A11yMenuButton extends(A11yMenuButtonBehaviors(t)){}window.customElements.define(A11yMenuButton.tag,A11yMenuButton);export{A11yMenuButton,A11yMenuButtonBehaviors};