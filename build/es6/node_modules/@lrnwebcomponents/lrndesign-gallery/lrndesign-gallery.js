/**
 * Copyright 2020 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{LitElement as e,html as t,css as i}from"../../lit-element/lit-element.js";import{LrndesignGalleryBehaviors as s}from"./lib/lrndesign-gallery-behaviors.js";import"../responsive-utility/responsive-utility.js";import"./lib/lrndesign-gallery-carousel.js";import"./lib/lrndesign-gallery-grid.js";class LrndesignGallery extends s{static get styles(){return[...super.styles,i`
        :host {
          display: block;
        }

        :host([hidden]) {
          display: none;
        }

        ::slotted(figure) {
          display: none;
        }
      `]}render(){return t`
      <div id="gallery">
        ${this.grid?t`
              <lrndesign-gallery-grid
                accent-color="${this.accentColor}"
                .aspect-ratio="${this.aspect}"
                .extra-wide="${this.extra}"
                ?dark="${this.dark}"
                .gallery-id="${this.id}"
                @item-changed="${e=>this.goToItem(e.detail)}"
                responsive-size="${this.responsiveSize}"
                .selected="${this.selected}"
                sizing="${this.sizing}"
                .sources="${this.items}"
                gallery-title="${this.galleryTitle}"
              >
                <slot></slot>
              </lrndesign-gallery-grid>
            `:t`
              <lrndesign-gallery-carousel
                accent-color="${this.accentColor}"
                .aspect-ratio="${this.aspect}"
                .extra-wide="${this.extra}"
                ?dark="${this.dark}"
                .gallery-id="${this.id}"
                @item-changed="${e=>this.goToItem(e.detail)}"
                responsive-size="${this.responsiveSize}"
                .selected="${this.selected}"
                sizing="${this.sizing}"
                .sources="${this.items}"
                gallery-title="${this.galleryTitle}"
              >
                <slot></slot>
              </lrndesign-gallery-carousel>
            `}
      </div>
    `}static get properties(){return{...super.properties,id:{type:String,reflect:!0,attribute:"id"},responsiveSize:{type:String,reflect:!0,attribute:"responsive-size"}}}tag(){return"lrndesign-gallery"}constructor(){super()}connectedCallback(){super.connectedCallback(),window.ResponsiveUtility.requestAvailability(),this.updateGallery(),this.observer.observe(this,{attributes:!1,childList:!0,subtree:!1})}firstUpdated(){super.firstUpdated(),window.dispatchEvent(new CustomEvent("responsive-element",{detail:{element:this,attribute:"responsive-size",sm:300,md:600,lg:1e3,xl:1500}})),this.anchorData=this._getAnchorData(),this.anchorData.gallery===this.id?this.goToItem(this.anchorData.id):this.goToItem()}updated(e){super.updated(e),e.forEach((e,t)=>{"id"!==t||this.id||(this.id=`gallery-${this._generateUUID()}`)})}get aspect(){let e=(this.items||[]).filter(e=>e.src&&""!=e.src),t=!(!e||!e[0])&&e[0].src;if(t){let e=new Image;return e.src=t,e.naturalWidth>0&&e.naturalHeight>0?e.naturalWidth/e.naturalHeight:1.33333333}return 1.33333333}get extra(){return this.aspect>2}get items(){let e=this.sources||[],t="string"==typeof e?JSON.parse(e):e,i=t.length;return(t||[]).map((e,t)=>({details:e.details,index:t,id:e.id||`gallery-${this.id}-item-${t}`,src:e.src,large:e.large&&""!==e.large?e.large:e.src,thumbnail:e.thumbnail&&""!=e.thumbnail?e.thumbnail:e.src,xofy:`${t+1} of ${i}`,next:t+1<i?t+1:-1,prev:t-1>-1?t-1:-1,sizing:e.sizing&&""!=e.sizing?e.sizing:this.sizing,title:e.title,tooltip:`${e.title||`Image ${t}`} (Zoom In)`,heading:`${e.title||`Image ${t}`} (Full-Sized)`}))}get observer(){return new MutationObserver(()=>this.updateGallery())}goToItem(e){let t=this.items[0]||{};if("number"==typeof e&&e>=0&&e<this.items.length)this.selected=this.items[e]||t;else{let i=this.items.filter(t=>t.id===e);this.selected=i.length>0?i[0]:t}}updateGallery(){let e=[];this.querySelectorAll("figure").forEach(t=>{let i=t.getAttribute("id"),s=t.querySelector("img"),r=t.getAttribute("sizing"),l=[1,2,3,4,5,6].map(e=>`h${e}:first-child`).join(","),a=s&&s.getAttribute("src")?s.getAttribute("src"):void 0,n=s&&s.getAttribute("srcset")?s.getAttribute("srcset").split(","):void 0,o=n&&n[0]?n[0].split(" "):void 0,d=n&&n[n.length-1]?n[n.length-1].split(" "):void 0,g=o&&o[0]?o[0]:void 0,h=d&&d[0]?d[0]:void 0,c=t.querySelector("figcaption")?t.querySelector("figcaption").cloneNode(!0):void 0,u=s&&s.getAttribute("alt")?s.getAttribute("alt"):void 0,p=c&&c.querySelector(l)?c.querySelector(l):void 0,m=p.innerHTML;p&&p.remove(),e.push({alt:u,id:i,src:a,thumbnail:g,large:h,title:m,details:c.innerHTML,sizing:r})}),e.length>0&&this.sources.length<1&&(this.sources=e),console.log(e,this.items)}_getAnchorData(){let e=null!==window.location.hash&&""!==window.location.hash&&window.location.hash.replace("#",""),t=e?e.split("---"):[];return{id:t.length>1?t[1]:-1,gallery:t.length>0?t[0]:-1,zoom:scroll&&t.length>2&&"zoom"===t[2]}}}customElements.define("lrndesign-gallery",LrndesignGallery);export{LrndesignGallery};