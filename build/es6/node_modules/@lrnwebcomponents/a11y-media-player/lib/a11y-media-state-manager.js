import{html,PolymerElement}from"../../../@polymer/polymer/polymer-element.js";import"../../../@polymer/iron-resizable-behavior/iron-resizable-behavior.js";window.A11yMediaStateManager=window.A11yMediaStateManager||{},window.A11yMediaStateManager.requestAvailability=()=>(window.A11yMediaStateManager.instance||(window.A11yMediaStateManager.instance=document.createElement("a11y-media-state-manager"),document.body.appendChild(window.A11yMediaStateManager.instance)),window.A11yMediaStateManager.instance);class A11yMediaStateManager extends PolymerElement{static get tag(){return"a11y-media-state-manager"}static get properties(){return{players:{type:Array,value:[]},screenfullLoaded:{type:Boolean,value:!1},stickyPlayer:{type:Object,value:null}}}constructor(){super();let root=this;root.__playerLoader=function(e){root.players.push(e.detail)},window.A11yMediaStateManager.instance||(window.A11yMediaStateManager.instance=this,window.addEventListener("a11y-player",root.__playerLoader))}connectedCallback(){super.connectedCallback();let root=this;this.__stickyManager=function(e){root.setStickyPlayer(e.detail)},this.__scrollChecker=function(e){root._checkScroll()},window.addEventListener("a11y-player-playing",root.__stickyManager),window.addEventListener("scroll",root.__scrollChecker)}checkConcurrentPlayers(){let root=this,player=root.stickyPlayer;for(let i=0;i<root.players.length;i++){let playeri=root.players[i];playeri===player||player.allowConcurrent&&playeri.allowConcurrent||playeri.pause()}}setStickyPlayer(player){let parent=this._getParentNode(player);this.__playerTop=parent.offsetTop,this.__playerUpperMiddle=this.__playerTop+.9*parent.offsetHeight,this.__playerLowerMiddle=this.__playerTop+.1*parent.offsetHeight,player!==this.stickyPlayer&&void 0!==this.stickyPlayer&&null!==this.stickyPlayer&&(this.stickyPlayer.toggleSticky(!1),this.__parent.style.height="unset"),parent.style.height=parent.offsetHeight+"px",this.__parent=parent,this.stickyPlayer=player,player.allowConcurrent||this.checkConcurrentPlayers(),this._checkScroll()}_checkScroll(){let wintop=window.pageYOffset,winbottom=wintop+window.innerHeight;void 0!==this.stickyPlayer&&null!==this.stickyPlayer&&(this.stickyPlayer.__playing&&(this.__playerLowerMiddle>winbottom||this.__playerUpperMiddle<wintop)?this.stickyPlayer.toggleSticky(!0):this.stickyPlayer.toggleSticky(!1))}_getParentNode(node){let parent=node.parentNode;return null!=parent&&parent.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&(parent=parent.host),parent}disconnectedCallback(){super.disconnectedCallback(),window.removeEventListener("a11y-player",this.__playerLoader),window.removeEventListener("a11y-player-playing",this.__stickyManager),window.removeEventListener("scroll",this.__scrollChecker)}}window.customElements.define(A11yMediaStateManager.tag,A11yMediaStateManager);export{A11yMediaStateManager};