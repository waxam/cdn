/**
 * Copyright 2018 The Pennsylvania State University
 * @license Apache-2.0, see License.md for full text.
 */
import{LitElement}from"../../../lit-element/lit-element.js";import"../../../@polymer/iron-resizable-behavior/iron-resizable-behavior.js";window.A11yMediaStateManager=window.A11yMediaStateManager||{},window.A11yMediaStateManager.requestAvailability=()=>(window.A11yMediaStateManager.instance||(window.A11yMediaStateManager.instance=document.createElement("a11y-media-state-manager"),document.body.appendChild(window.A11yMediaStateManager.instance)),window.A11yMediaStateManager.instance);class A11yMediaStateManager extends LitElement{static get tag(){return"a11y-media-state-manager"}static get properties(){return{...super.properties,players:{type:Array},screenfullLoaded:{type:Boolean},activePlayer:{type:Object}}}constructor(){super(),this.players=[],this.screenfullLoaded=!1,this.__stickyManager=e=>this.setStickyPlayer(e.detail),this.__activeManager=e=>this.setActivePlayer(e.detail),this.__scrollChecker=e=>this._checkScroll(e),this.__playerLoader=e=>this.players.push(e.detail),window.A11yMediaStateManager.instance||(window.A11yMediaStateManager.instance=this)}checkConcurrentPlayers(){let active=this.activePlayer;this.players.forEach(player=>{player!==active&&(player.toggleFullscreen(!1),(!player.allowConcurrent&&!active.allowConcurrent||active.fullscreen)&&player.pause())})}setActivePlayer(player){this.activePlayer=player,this.checkConcurrentPlayers()}setStickyPlayer(player){let parent=this._getParentNode(player);this.__playerTop=parent.offsetTop,this.__playerUpperMiddle=this.__playerTop+.9*parent.offsetHeight,this.__playerLowerMiddle=this.__playerTop+.1*parent.offsetHeight,player!==this.activePlayer&&void 0!==this.activePlayer&&null!==this.activePlayer&&(this.activePlayer.toggleSticky(!1),this.__parent.style.height="unset"),parent.style.height=parent.offsetHeight+"px",this.setActivePlayer(player),this._checkScroll()}_checkScroll(){let wintop=window.pageYOffset,winbottom=wintop+window.innerHeight;void 0!==this.activePlayer&&null!==this.activePlayer&&(this.activePlayer.__playing&&(this.__playerLowerMiddle>winbottom||this.__playerUpperMiddle<wintop)?this.activePlayer.toggleSticky(!0):this.activePlayer.toggleSticky(!1))}_getParentNode(node){let parent=node.parentNode;return null!=parent&&parent.nodeType===Node.DOCUMENT_FRAGMENT_NODE&&(parent=parent.host),parent}connectedCallback(){super.connectedCallback();window.addEventListener("a11y-player-playing",this.__stickyManager),window.addEventListener("a11y-player-fullscreen",this.__activeManager),window.addEventListener("scroll",this.__scrollChecker),window.addEventListener("a11y-player",this.__playerLoader)}disconnectedCallback(){window.removeEventListener("a11y-player",this.__playerLoader),window.removeEventListener("a11y-player-playing",this.__stickyManager),window.removeEventListener("a11y-player-fullscreen",this.__activeManager),window.removeEventListener("scroll",this.__scrollChecker),super.disconnectedCallback()}}window.customElements.define(A11yMediaStateManager.tag,A11yMediaStateManager);export{A11yMediaStateManager};