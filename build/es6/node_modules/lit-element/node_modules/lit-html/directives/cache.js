/**
 * @license
 * Copyright (c) 2018 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at
 * http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at
 * http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at
 * http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at
 * http://polymer.github.io/PATENTS.txt
 */
import{TemplateInstance as e}from"../lib/template-instance.js";import{directive as t,NodePart as n,reparentNodes as o,TemplateResult as a}from"../lit-html.js";const i=new WeakMap;export const cache=t(t=>s=>{if(!(s instanceof n))throw new Error("cache can only be used in text bindings");let c=i.get(s);void 0===c&&(c=new WeakMap,i.set(s,c));const l=s.value;if(l instanceof e){if(t instanceof a&&l.template===s.options.templateFactory(t))return void s.setValue(t);{let e=c.get(l.template);void 0===e&&(e={instance:l,nodes:document.createDocumentFragment()},c.set(l.template,e)),o(e.nodes,s.startNode.nextSibling,s.endNode)}}if(t instanceof a){const e=s.options.templateFactory(t),n=c.get(e);void 0!==n&&(s.setValue(n.nodes),s.commit(),s.value=n.instance)}s.setValue(t)});