import{DomModule}from"../../@polymer/polymer/lib/elements/dom-module.js";import{ThemePropertyMixin}from"./vaadin-theme-property-mixin.js";export const ThemableMixin=superClass=>class VaadinThemableMixin extends(ThemePropertyMixin(superClass)){static finalize(){super.finalize();const template=this.prototype._template,hasOwnTemplate=this.template&&this.template.parentElement&&this.template.parentElement.id===this.is,inheritedTemplate=Object.getPrototypeOf(this.prototype)._template;inheritedTemplate&&!hasOwnTemplate&&Array.from(inheritedTemplate.content.querySelectorAll("style[include]")).forEach(s=>{this._includeStyle(s.getAttribute("include"),template)}),this._includeMatchingThemes(template)}static _includeMatchingThemes(template){const modules=DomModule.prototype.modules;let hasThemes=!1;const defaultModuleName=this.is+"-default-theme";Object.keys(modules).sort((moduleNameA,moduleNameB)=>{const vaadinA=0===moduleNameA.indexOf("vaadin-"),vaadinB=0===moduleNameB.indexOf("vaadin-"),vaadinThemePrefixes=["lumo-","material-"],vaadinThemeA=vaadinThemePrefixes.filter(prefix=>0===moduleNameA.indexOf(prefix)).length>0,vaadinThemeB=vaadinThemePrefixes.filter(prefix=>0===moduleNameB.indexOf(prefix)).length>0;return vaadinA!==vaadinB?vaadinA?-1:1:vaadinThemeA!==vaadinThemeB?vaadinThemeA?-1:1:0}).forEach(moduleName=>{if(moduleName!==defaultModuleName){const themeFor=modules[moduleName].getAttribute("theme-for");themeFor&&themeFor.split(" ").forEach(themeForToken=>{new RegExp("^"+themeForToken.split("*").join(".*")+"$").test(this.is)&&(hasThemes=!0,this._includeStyle(moduleName,template))})}}),!hasThemes&&modules[defaultModuleName]&&this._includeStyle(defaultModuleName,template)}static _includeStyle(moduleName,template){if(template&&!template.content.querySelector(`style[include="${moduleName}"]`)){const styleEl=document.createElement("style");styleEl.setAttribute("include",moduleName),template.content.appendChild(styleEl)}}};