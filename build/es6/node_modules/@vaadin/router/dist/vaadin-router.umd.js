var global,factory;global=this,factory=function(exports){function _typeof(obj){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj})(obj)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}function _createClass(Constructor,protoProps,staticProps){return protoProps&&_defineProperties(Constructor.prototype,protoProps),staticProps&&_defineProperties(Constructor,staticProps),Constructor}function _getPrototypeOf(o){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o)})(o)}function _setPrototypeOf(o,p){return(_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){return o.__proto__=p,o})(o,p)}function _assertThisInitialized(self){if(void 0===self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return self}function _get(target,property,receiver){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function _get(target,property,receiver){var base=function _superPropBase(object,property){for(;!Object.prototype.hasOwnProperty.call(object,property)&&null!==(object=_getPrototypeOf(object)););return object}(target,property);if(base){var desc=Object.getOwnPropertyDescriptor(base,property);return desc.get?desc.get.call(receiver):desc.value}})(target,property,receiver||target)}function _toConsumableArray(arr){return function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++)arr2[i]=arr[i];return arr2}}(arr)||function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||"[object Arguments]"===Object.prototype.toString.call(iter))return Array.from(iter)}(arr)||function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function toArray(objectOrArray){return objectOrArray=objectOrArray||[],Array.isArray(objectOrArray)?objectOrArray:[objectOrArray]}function log(msg){return"[Vaadin.Router] ".concat(msg)}var MODULE="module",NOMODULE="nomodule",bundleKeys=[MODULE,NOMODULE];function ensureBundle(src){if(!src.match(/.+\.[m]?js$/))throw new Error(log('Unsupported type for bundle "'.concat(src,'": .js or .mjs expected.')))}function ensureRoute(route){if(!route||!isString(route.path))throw new Error(log('Expected route config to be an object with a "path" string property, or an array of such objects'));var bundle=route.bundle,stringKeys=["component","redirect","bundle"];if(!(isFunction(route.action)||Array.isArray(route.children)||isFunction(route.children)||isObject(bundle)||stringKeys.some((function(key){return isString(route[key])}))))throw new Error(log('Expected route config "'.concat(route.path,'" to include either "').concat(stringKeys.join('", "'),'" ')+'or "action" function but none found.'));if(bundle)if(isString(bundle))ensureBundle(bundle);else{if(!bundleKeys.some((function(key){return key in bundle})))throw new Error(log('Expected route bundle to include either "'+NOMODULE+'" or "'+MODULE+'" keys, or both'));bundleKeys.forEach((function(key){return key in bundle&&ensureBundle(bundle[key])}))}route.redirect&&["bundle","component"].forEach((function(overriddenProp){overriddenProp in route&&console.warn(log('Route config "'.concat(route.path,'" has both "redirect" and "').concat(overriddenProp,'" properties, ')+'and "redirect" will always override the latter. Did you mean to only use "'.concat(overriddenProp,'"?')))}))}function ensureRoutes(routes){toArray(routes).forEach((function(route){return ensureRoute(route)}))}function loadScript(src,key){var script=document.head.querySelector('script[src="'+src+'"][async]');return script||((script=document.createElement("script")).setAttribute("src",src),key===MODULE?script.setAttribute("type",MODULE):key===NOMODULE&&script.setAttribute(NOMODULE,""),script.async=!0),new Promise((function(resolve,reject){script.onreadystatechange=script.onload=function(e){script.__dynamicImportLoaded=!0,resolve(e)},script.onerror=function(e){script.parentNode&&script.parentNode.removeChild(script),reject(e)},null===script.parentNode?document.head.appendChild(script):script.__dynamicImportLoaded&&resolve()}))}function fireRouterEvent(type,detail){return!window.dispatchEvent(new CustomEvent("vaadin-router-".concat(type),{cancelable:"go"===type,detail}))}function isObject(o){return"object"===_typeof(o)&&!!o}function isFunction(f){return"function"==typeof f}function isString(s){return"string"==typeof s}function getNotFoundError(context){var error=new Error(log("Page not found (".concat(context.pathname,")")));return error.context=context,error.code=404,error}var notFoundResult=new function NotFoundResult(){_classCallCheck(this,NotFoundResult)};function vaadinRouterGlobalClickHandler(event){if(!event.defaultPrevented&&0===event.button&&!(event.shiftKey||event.ctrlKey||event.altKey||event.metaKey)){for(var anchor=event.target,path=event.composedPath?event.composedPath():event.path||[],i=0;i<path.length;i++){var target=path[i];if(target.nodeName&&"a"===target.nodeName.toLowerCase()){anchor=target;break}}for(;anchor&&"a"!==anchor.nodeName.toLowerCase();)anchor=anchor.parentNode;if(anchor&&"a"===anchor.nodeName.toLowerCase()&&!(anchor.target&&"_self"!==anchor.target.toLowerCase()||anchor.hasAttribute("download")||anchor.pathname===window.location.pathname&&""!==anchor.hash||(anchor.origin||function getAnchorOrigin(anchor){var port=anchor.port,protocol=anchor.protocol,host="http:"===protocol&&"80"===port||"https:"===protocol&&"443"===port?anchor.hostname:anchor.host;return"".concat(protocol,"//").concat(host)}(anchor))!==window.location.origin)){var _anchor=anchor;fireRouterEvent("go",{pathname:_anchor.pathname,search:_anchor.search,hash:_anchor.hash})&&event.preventDefault()}}}var CLICK={activate:function activate(){window.document.addEventListener("click",vaadinRouterGlobalClickHandler)},inactivate:function inactivate(){window.document.removeEventListener("click",vaadinRouterGlobalClickHandler)}};function vaadinRouterGlobalPopstateHandler(event){if("vaadin-router-ignore"!==event.state){var _window$location=window.location;fireRouterEvent("go",{pathname:_window$location.pathname,search:_window$location.search,hash:_window$location.hash})}}/Trident/.test(navigator.userAgent)&&!isFunction(window.PopStateEvent)&&(window.PopStateEvent=function(inType,params){params=params||{};var e=document.createEvent("Event");return e.initEvent(inType,Boolean(params.bubbles),Boolean(params.cancelable)),e.state=params.state||null,e},window.PopStateEvent.prototype=window.Event.prototype);var POPSTATE={activate:function activate(){window.addEventListener("popstate",vaadinRouterGlobalPopstateHandler)},inactivate:function inactivate(){window.removeEventListener("popstate",vaadinRouterGlobalPopstateHandler)}},pathToRegexp_1=pathToRegexp,parse_1=parse,compile_1=function compile(str,options){return tokensToFunction(parse(str,options))},tokensToFunction_1=tokensToFunction,tokensToRegExp_1=tokensToRegExp,DEFAULT_DELIMITER="/",DEFAULT_DELIMITERS="./",PATH_REGEXP=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function parse(str,options){for(var res,tokens=[],key=0,index=0,path="",defaultDelimiter=options&&options.delimiter||DEFAULT_DELIMITER,delimiters=options&&options.delimiters||DEFAULT_DELIMITERS,pathEscaped=!1;null!==(res=PATH_REGEXP.exec(str));){var m=res[0],escaped=res[1],offset=res.index;if(path+=str.slice(index,offset),index=offset+m.length,escaped)path+=escaped[1],pathEscaped=!0;else{var prev="",next=str[index],name=res[2],capture=res[3],group=res[4],modifier=res[5];if(!pathEscaped&&path.length){var k=path.length-1;delimiters.indexOf(path[k])>-1&&(prev=path[k],path=path.slice(0,k))}path&&(tokens.push(path),path="",pathEscaped=!1);var partial=""!==prev&&void 0!==next&&next!==prev,repeat="+"===modifier||"*"===modifier,optional="?"===modifier||"*"===modifier,delimiter=prev||defaultDelimiter,pattern=capture||group;tokens.push({name:name||key++,prefix:prev,delimiter,optional,repeat,partial,pattern:pattern?escapeGroup(pattern):"[^"+escapeString(delimiter)+"]+?"})}}return(path||index<str.length)&&tokens.push(path+str.substr(index)),tokens}function tokensToFunction(tokens){for(var matches=new Array(tokens.length),i=0;i<tokens.length;i++)"object"===_typeof(tokens[i])&&(matches[i]=new RegExp("^(?:"+tokens[i].pattern+")$"));return function(data,options){for(var path="",encode=options&&options.encode||encodeURIComponent,i=0;i<tokens.length;i++){var token=tokens[i];if("string"!=typeof token){var segment,value=data?data[token.name]:void 0;if(Array.isArray(value)){if(!token.repeat)throw new TypeError('Expected "'+token.name+'" to not repeat, but got array');if(0===value.length){if(token.optional)continue;throw new TypeError('Expected "'+token.name+'" to not be empty')}for(var j=0;j<value.length;j++){if(segment=encode(value[j],token),!matches[i].test(segment))throw new TypeError('Expected all "'+token.name+'" to match "'+token.pattern+'"');path+=(0===j?token.prefix:token.delimiter)+segment}}else if("string"!=typeof value&&"number"!=typeof value&&"boolean"!=typeof value){if(!token.optional)throw new TypeError('Expected "'+token.name+'" to be '+(token.repeat?"an array":"a string"));token.partial&&(path+=token.prefix)}else{if(segment=encode(String(value),token),!matches[i].test(segment))throw new TypeError('Expected "'+token.name+'" to match "'+token.pattern+'", but got "'+segment+'"');path+=token.prefix+segment}}else path+=token}return path}}function escapeString(str){return str.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function escapeGroup(group){return group.replace(/([=!:$/()])/g,"\\$1")}function flags(options){return options&&options.sensitive?"":"i"}function tokensToRegExp(tokens,keys,options){for(var strict=(options=options||{}).strict,start=!1!==options.start,end=!1!==options.end,delimiter=escapeString(options.delimiter||DEFAULT_DELIMITER),delimiters=options.delimiters||DEFAULT_DELIMITERS,endsWith=[].concat(options.endsWith||[]).map(escapeString).concat("$").join("|"),route=start?"^":"",isEndDelimited=0===tokens.length,i=0;i<tokens.length;i++){var token=tokens[i];if("string"==typeof token)route+=escapeString(token),isEndDelimited=i===tokens.length-1&&delimiters.indexOf(token[token.length-1])>-1;else{var capture=token.repeat?"(?:"+token.pattern+")(?:"+escapeString(token.delimiter)+"(?:"+token.pattern+"))*":token.pattern;keys&&keys.push(token),token.optional?token.partial?route+=escapeString(token.prefix)+"("+capture+")?":route+="(?:"+escapeString(token.prefix)+"("+capture+"))?":route+=escapeString(token.prefix)+"("+capture+")"}}return end?(strict||(route+="(?:"+delimiter+")?"),route+="$"===endsWith?"$":"(?="+endsWith+")"):(strict||(route+="(?:"+delimiter+"(?="+endsWith+"))?"),isEndDelimited||(route+="(?="+delimiter+"|"+endsWith+")")),new RegExp(route,flags(options))}function pathToRegexp(path,keys,options){return path instanceof RegExp?function regexpToRegexp(path,keys){if(!keys)return path;var groups=path.source.match(/\((?!\?)/g);if(groups)for(var i=0;i<groups.length;i++)keys.push({name:i,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return path}(path,keys):Array.isArray(path)?function arrayToRegexp(path,keys,options){for(var parts=[],i=0;i<path.length;i++)parts.push(pathToRegexp(path[i],keys,options).source);return new RegExp("(?:"+parts.join("|")+")",flags(options))}(path,keys,options):function stringToRegexp(path,keys,options){return tokensToRegExp(parse(path,options),keys,options)}(path,keys,options)}pathToRegexp_1.parse=parse_1,pathToRegexp_1.compile=compile_1,pathToRegexp_1.tokensToFunction=tokensToFunction_1,pathToRegexp_1.tokensToRegExp=tokensToRegExp_1;var hasOwnProperty=Object.prototype.hasOwnProperty,cache=new Map;function decodeParam(val){try{return decodeURIComponent(val)}catch(err){return val}}function matchRoute(route,pathname,ignoreLeadingSlash,parentKeys,parentParams){var match,childMatches,childIndex=0,routepath=route.path||"";return"/"===routepath.charAt(0)&&(ignoreLeadingSlash&&(routepath=routepath.substr(1)),ignoreLeadingSlash=!0),{next:function next(routeToSkip){if(route===routeToSkip)return{done:!0};var children=route.__children=route.__children||route.children;if(!match&&(match=function matchPath(routepath,path,exact,parentKeys,parentParams){exact=!!exact;var cacheKey="".concat(routepath,"|").concat(exact),regexp=cache.get(cacheKey);if(!regexp){var keys=[];regexp={keys,pattern:pathToRegexp_1(routepath,keys,{end:exact,strict:""===routepath})},cache.set(cacheKey,regexp)}var m=regexp.pattern.exec(path);if(!m)return null;for(var params=Object.assign({},parentParams),i=1;i<m.length;i++){var key=regexp.keys[i-1],prop=key.name,value=m[i];void 0===value&&hasOwnProperty.call(params,prop)||(key.repeat?params[prop]=value?value.split(key.delimiter).map(decodeParam):[]:params[prop]=value?decodeParam(value):value)}return{path:m[0],keys:(parentKeys||[]).concat(regexp.keys),params}}(routepath,pathname,!children,parentKeys,parentParams)))return{done:!1,value:{route,keys:match.keys,params:match.params,path:match.path}};if(match&&children)for(;childIndex<children.length;){if(!childMatches){var childRoute=children[childIndex];childRoute.parent=route;var matchedLength=match.path.length;matchedLength>0&&"/"===pathname.charAt(matchedLength)&&(matchedLength+=1),childMatches=matchRoute(childRoute,pathname.substr(matchedLength),ignoreLeadingSlash,match.keys,match.params)}var childMatch=childMatches.next(routeToSkip);if(!childMatch.done)return{done:!1,value:childMatch.value};childMatches=null,childIndex++}return{done:!0}}}}function resolveRoute(context){if(isFunction(context.route.action))return context.route.action(context)}cache.set("|false",{keys:[],pattern:/(?:)/});var Resolver=function(){function Resolver(routes){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(_classCallCheck(this,Resolver),Object(routes)!==routes)throw new TypeError("Invalid routes");this.baseUrl=options.baseUrl||"",this.errorHandler=options.errorHandler,this.resolveRoute=options.resolveRoute||resolveRoute,this.context=Object.assign({resolver:this},options.context),this.root=Array.isArray(routes)?{path:"",__children:routes,parent:null,__synthetic:!0}:routes,this.root.parent=null}return _createClass(Resolver,[{key:"getRoutes",value:function getRoutes(){return _toConsumableArray(this.root.__children)}},{key:"setRoutes",value:function setRoutes(routes){ensureRoutes(routes);var newRoutes=_toConsumableArray(toArray(routes));this.root.__children=newRoutes}},{key:"addRoutes",value:function addRoutes(routes){var _this$root$__children;return ensureRoutes(routes),(_this$root$__children=this.root.__children).push.apply(_this$root$__children,_toConsumableArray(toArray(routes))),this.getRoutes()}},{key:"removeRoutes",value:function removeRoutes(){this.setRoutes([])}},{key:"resolve",value:function resolve(pathnameOrContext){var _this=this,context=Object.assign({},this.context,isString(pathnameOrContext)?{pathname:pathnameOrContext}:pathnameOrContext),match=matchRoute(this.root,this.__normalizePathname(context.pathname),this.baseUrl),resolve=this.resolveRoute,matches=null,nextMatches=null,currentContext=context;function next(resume){var parent=arguments.length>1&&void 0!==arguments[1]?arguments[1]:matches.value.route,routeToSkip=null===(arguments.length>2?arguments[2]:void 0)&&matches.value.route;return matches=nextMatches||match.next(routeToSkip),nextMatches=null,resume||!matches.done&&function isChildRoute(parentRoute,childRoute){for(var route=childRoute;route;)if((route=route.parent)===parentRoute)return!0;return!1}(parent,matches.value.route)?matches.done?Promise.reject(getNotFoundError(context)):(function addRouteToChain(context,match){var route=match.route,path=match.path;if(route&&!route.__synthetic){var item={path,route};!function shouldDiscardOldChain(oldChain,route){return!route.parent||!oldChain||!oldChain.length||oldChain[oldChain.length-1].route!==route.parent}(context.chain,route)?context.chain.push(item):context.chain=[item]}}(context,matches.value),currentContext=Object.assign({},context,matches.value),Promise.resolve(resolve(currentContext)).then((function(resolution){return null!=resolution&&resolution!==notFoundResult?(currentContext.result=resolution.result||resolution,currentContext):next(resume,parent,resolution)}))):(nextMatches=matches,Promise.resolve(notFoundResult))}return context.next=next,Promise.resolve().then((function(){return next(!0,_this.root)})).catch((function(error){var errorMessage=function generateErrorMessage(currentContext){var errorMessage="Path '".concat(currentContext.pathname,"' is not properly resolved due to an error."),routePath=(currentContext.route||{}).path;return routePath&&(errorMessage+=" Resolution had failed on route: '".concat(routePath,"'")),errorMessage}(currentContext);if(error?console.warn(errorMessage):error=new Error(errorMessage),error.context=error.context||currentContext,error instanceof DOMException||(error.code=error.code||500),_this.errorHandler)return currentContext.result=_this.errorHandler(error),currentContext;throw error}))}},{key:"__normalizePathname",value:function __normalizePathname(pathname){if(!this.baseUrl)return pathname;var base=this.__effectiveBaseUrl,normalizedUrl=this.constructor.__createUrl(pathname,base).href;return normalizedUrl.slice(0,base.length)===base?normalizedUrl.slice(base.length):void 0}},{key:"__effectiveBaseUrl",get:function get(){return this.baseUrl?this.constructor.__createUrl(this.baseUrl,document.baseURI||document.URL).href.replace(/[^\/]*$/,""):""}}],[{key:"__createUrl",value:function __createUrl(url,base){return new URL(url,base)}}]),Resolver}();Resolver.pathToRegexp=pathToRegexp_1;var pathToRegexp$1=Resolver.pathToRegexp,cache$1=new Map;function getRouteByName(routesByName,routeName){var routes=routesByName.get(routeName);if(routes&&routes.length>1)throw new Error('Duplicate route with name "'.concat(routeName,'".')+" Try seting unique 'name' route properties.");return routes&&routes[0]}function getRoutePath(route){var path=route.path;return void 0!==(path=Array.isArray(path)?path[0]:path)?path:""}function generateUrls(router){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!(router instanceof Resolver))throw new TypeError("An instance of Resolver is expected");var routesByName=new Map;return function(routeName,params){var route=getRouteByName(routesByName,routeName);if(!(route||(routesByName.clear(),function cacheRoutes(routesByName,route,routes){var name=route.name||route.component;if(name&&(routesByName.has(name)?routesByName.get(name).push(route):routesByName.set(name,[route])),Array.isArray(routes))for(var i=0;i<routes.length;i++){var childRoute=routes[i];childRoute.parent=route,cacheRoutes(routesByName,childRoute,childRoute.__children||childRoute.children)}}(routesByName,router.root,router.root.__children),route=getRouteByName(routesByName,routeName))))throw new Error('Route "'.concat(routeName,'" not found'));var regexp=cache$1.get(route.fullPath);if(!regexp){for(var fullPath=getRoutePath(route),rt=route.parent;rt;){var path=getRoutePath(rt);path&&(fullPath=path.replace(/\/$/,"")+"/"+fullPath.replace(/^\//,"")),rt=rt.parent}for(var tokens=pathToRegexp$1.parse(fullPath),toPath=pathToRegexp$1.tokensToFunction(tokens),keys=Object.create(null),i=0;i<tokens.length;i++)isString(tokens[i])||(keys[tokens[i].name]=!0);regexp={toPath,keys},cache$1.set(fullPath,regexp),route.fullPath=fullPath}var url=regexp.toPath(params,options)||"/";if(options.stringifyQueryParams&&params){for(var queryParams={},_keys=Object.keys(params),_i=0;_i<_keys.length;_i++){var key=_keys[_i];regexp.keys[key]||(queryParams[key]=params[key])}var query=options.stringifyQueryParams(queryParams);query&&(url+="?"===query.charAt(0)?query:"?".concat(query))}return url}}var triggers=[];function setNavigationTriggers(newTriggers){triggers.forEach((function(trigger){return trigger.inactivate()})),newTriggers.forEach((function(trigger){return trigger.activate()})),triggers=newTriggers}var willAnimate=function willAnimate(elem){var name=getComputedStyle(elem).getPropertyValue("animation-name");return name&&"none"!==name},waitForAnimation=function waitForAnimation(elem,cb){elem.addEventListener("animationend",(function listener(){elem.removeEventListener("animationend",listener),cb()}))};function animate(elem,className){return elem.classList.add(className),new Promise((function(resolve){if(willAnimate(elem)){var rect=elem.getBoundingClientRect(),size="height: ".concat(rect.bottom-rect.top,"px; width: ").concat(rect.right-rect.left,"px");elem.setAttribute("style","position: absolute; ".concat(size)),waitForAnimation(elem,(function(){elem.classList.remove(className),elem.removeAttribute("style"),resolve()}))}else elem.classList.remove(className),resolve()}))}function isResultNotEmpty(result){return null!=result}function createLocation(_ref,route){var _ref$pathname=_ref.pathname,pathname=void 0===_ref$pathname?"":_ref$pathname,_ref$search=_ref.search,search=void 0===_ref$search?"":_ref$search,_ref$hash=_ref.hash,hash=void 0===_ref$hash?"":_ref$hash,_ref$chain=_ref.chain,chain=void 0===_ref$chain?[]:_ref$chain,_ref$params=_ref.params,params=void 0===_ref$params?{}:_ref$params,redirectFrom=_ref.redirectFrom,resolver=_ref.resolver,routes=chain.map((function(item){return item.route}));return{baseUrl:resolver&&resolver.baseUrl||"",pathname,search,hash,routes,route:route||routes.length&&routes[routes.length-1]||null,params,redirectFrom,getUrl:function getUrl(){var userParams=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return getPathnameForRouter(Router.pathToRegexp.compile(getMatchedPath(routes))(Object.assign({},params,userParams)),resolver)}}}function createRedirect(context,pathname){var params=Object.assign({},context.params);return{redirect:{pathname,from:context.pathname,params}}}function runCallbackIfPossible(callback,args,thisArg){if(isFunction(callback))return callback.apply(thisArg,args)}function amend(amendmentFunction,args,element){return function(amendmentResult){return amendmentResult&&(amendmentResult.cancel||amendmentResult.redirect)?amendmentResult:element?runCallbackIfPossible(element[amendmentFunction],args,element):void 0}}function removeDomNodes(nodes){if(nodes&&nodes.length)for(var parent=nodes[0].parentNode,i=0;i<nodes.length;i++)parent.removeChild(nodes[i])}function getPathnameForRouter(pathname,router){var base=router.__effectiveBaseUrl;return base?router.constructor.__createUrl(pathname.replace(/^\//,""),base).pathname:pathname}function getMatchedPath(chain){return chain.map((function(item){return item.path})).reduce((function(a,b){return b.length?a.replace(/\/$/,"")+"/"+b.replace(/^\//,""):a}),"")}var Router=function(_Resolver){function Router(outlet,options){var _this;_classCallCheck(this,Router);var baseElement=document.head.querySelector("base"),baseHref=baseElement&&baseElement.getAttribute("href");(_this=function _possibleConstructorReturn(self,call){return!call||"object"!=typeof call&&"function"!=typeof call?_assertThisInitialized(self):call}(this,_getPrototypeOf(Router).call(this,[],Object.assign({baseUrl:baseHref&&Resolver.__createUrl(baseHref,document.URL).pathname.replace(/[^\/]*$/,"")},options)))).resolveRoute=function(context){return _this.__resolveRoute(context)};var triggers=Router.NavigationTrigger;return Router.setTriggers.apply(Router,Object.keys(triggers).map((function(key){return triggers[key]}))),_this.baseUrl,_this.ready,_this.ready=Promise.resolve(outlet),_this.location,_this.location=createLocation({resolver:_assertThisInitialized(_this)}),_this.__lastStartedRenderId=0,_this.__navigationEventHandler=_this.__onNavigationEvent.bind(_assertThisInitialized(_this)),_this.setOutlet(outlet),_this.subscribe(),_this.__createdByRouter=new WeakMap,_this.__addedByRouter=new WeakMap,_this}return function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function");subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:!0,configurable:!0}}),superClass&&_setPrototypeOf(subClass,superClass)}(Router,_Resolver),_createClass(Router,[{key:"__resolveRoute",value:function __resolveRoute(context){var _this2=this,route=context.route,callbacks=Promise.resolve();isFunction(route.children)&&(callbacks=callbacks.then((function(){return route.children(function copyContextWithoutNext(context){var copy=Object.assign({},context);return delete copy.next,copy}(context))})).then((function(children){isResultNotEmpty(children)||isFunction(route.children)||(children=route.children),function processNewChildren(newChildren,route){if(!Array.isArray(newChildren)&&!isObject(newChildren))throw new Error(log('Incorrect "children" value for the route '.concat(route.path,": expected array or object, but got ").concat(newChildren)));route.__children=[];for(var childRoutes=toArray(newChildren),i=0;i<childRoutes.length;i++)ensureRoute(childRoutes[i]),route.__children.push(childRoutes[i])}(children,route)})));var commands={redirect:function redirect(path){return createRedirect(context,path)},component:function component(_component){var element=document.createElement(_component);return _this2.__createdByRouter.set(element,!0),element}};return callbacks.then((function(){if(_this2.__isLatestRender(context))return runCallbackIfPossible(route.action,[context,commands],route)})).then((function(result){return isResultNotEmpty(result)&&(result instanceof HTMLElement||result.redirect||result===notFoundResult)?result:isString(route.redirect)?commands.redirect(route.redirect):route.bundle?function loadBundle(bundle){return isString(bundle)?loadScript(bundle):Promise.race(bundleKeys.filter((function(key){return key in bundle})).map((function(key){return loadScript(bundle[key],key)})))}(route.bundle).then((function(){}),(function(){throw new Error(log("Bundle not found: ".concat(route.bundle,". Check if the file name is correct")))})):void 0})).then((function(result){return isResultNotEmpty(result)?result:isString(route.component)?commands.component(route.component):void 0}))}},{key:"setOutlet",value:function setOutlet(outlet){outlet&&this.__ensureOutlet(outlet),this.__outlet=outlet}},{key:"getOutlet",value:function getOutlet(){return this.__outlet}},{key:"setRoutes",value:function setRoutes(routes){var skipRender=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.__previousContext=void 0,this.__urlForName=void 0,_get(_getPrototypeOf(Router.prototype),"setRoutes",this).call(this,routes),skipRender||this.__onNavigationEvent(),this.ready}},{key:"render",value:function render(pathnameOrContext,shouldUpdateHistory){var _this3=this,renderId=++this.__lastStartedRenderId,context=Object.assign({search:"",hash:""},isString(pathnameOrContext)?{pathname:pathnameOrContext}:pathnameOrContext,{__renderId:renderId});return this.ready=this.resolve(context).then((function(context){return _this3.__fullyResolveChain(context)})).then((function(context){if(_this3.__isLatestRender(context)){var previousContext=_this3.__previousContext;if(context===previousContext)return _this3.__updateBrowserHistory(previousContext,!0),_this3.location;if(_this3.location=createLocation(context),shouldUpdateHistory&&_this3.__updateBrowserHistory(context,1===renderId),fireRouterEvent("location-changed",{router:_this3,location:_this3.location}),context.__skipAttach)return _this3.__copyUnchangedElements(context,previousContext),_this3.__previousContext=context,_this3.location;_this3.__addAppearingContent(context,previousContext);var animationDone=_this3.__animateIfNeeded(context);return _this3.__runOnAfterEnterCallbacks(context),_this3.__runOnAfterLeaveCallbacks(context,previousContext),animationDone.then((function(){if(_this3.__isLatestRender(context))return _this3.__removeDisappearingContent(),_this3.__previousContext=context,_this3.location}))}})).catch((function(error){if(renderId===_this3.__lastStartedRenderId)throw shouldUpdateHistory&&_this3.__updateBrowserHistory(context),removeDomNodes(_this3.__outlet&&_this3.__outlet.children),_this3.location=createLocation(Object.assign(context,{resolver:_this3})),fireRouterEvent("error",Object.assign({router:_this3,error},context)),error})),this.ready}},{key:"__fullyResolveChain",value:function __fullyResolveChain(topOfTheChainContextBeforeRedirects){var _this4=this,contextBeforeRedirects=arguments.length>1&&void 0!==arguments[1]?arguments[1]:topOfTheChainContextBeforeRedirects;return this.__findComponentContextAfterAllRedirects(contextBeforeRedirects).then((function(contextAfterRedirects){var topOfTheChainContextAfterRedirects=contextAfterRedirects!==contextBeforeRedirects?contextAfterRedirects:topOfTheChainContextBeforeRedirects;return contextAfterRedirects.next().then((function(nextChildContext){if((null===nextChildContext||nextChildContext===notFoundResult)&&getPathnameForRouter(getMatchedPath(contextAfterRedirects.chain),contextAfterRedirects.resolver)!==contextAfterRedirects.pathname)throw getNotFoundError(topOfTheChainContextAfterRedirects);return nextChildContext&&nextChildContext!==notFoundResult?_this4.__fullyResolveChain(topOfTheChainContextAfterRedirects,nextChildContext):_this4.__amendWithOnBeforeCallbacks(contextAfterRedirects)}))}))}},{key:"__findComponentContextAfterAllRedirects",value:function __findComponentContextAfterAllRedirects(context){var _this5=this,result=context.result;return result instanceof HTMLElement?(function renderElement(context,element){element.location=createLocation(context);var index=context.chain.map((function(item){return item.route})).indexOf(context.route);return context.chain[index].element=element,element}(context,result),Promise.resolve(context)):result.redirect?this.__redirect(result.redirect,context.__redirectCount,context.__renderId).then((function(context){return _this5.__findComponentContextAfterAllRedirects(context)})):result instanceof Error?Promise.reject(result):Promise.reject(new Error(log('Invalid route resolution result for path "'.concat(context.pathname,'". ')+'Expected redirect object or HTML element, but got: "'.concat(function logValue(value){if("object"!==_typeof(value))return String(value);var stringType=Object.prototype.toString.call(value).match(/ (.*)\]$/)[1];return"Object"===stringType||"Array"===stringType?"".concat(stringType," ").concat(JSON.stringify(value)):stringType}(result),'". ')+"Double check the action return value for the route.")))}},{key:"__amendWithOnBeforeCallbacks",value:function __amendWithOnBeforeCallbacks(contextWithFullChain){var _this6=this;return this.__runOnBeforeCallbacks(contextWithFullChain).then((function(amendedContext){return amendedContext===_this6.__previousContext||amendedContext===contextWithFullChain?amendedContext:_this6.__fullyResolveChain(amendedContext)}))}},{key:"__runOnBeforeCallbacks",value:function __runOnBeforeCallbacks(newContext){var _this7=this,previousContext=this.__previousContext||{},previousChain=previousContext.chain||[],newChain=newContext.chain,callbacks=Promise.resolve(),prevent=function prevent(){return{cancel:!0}},redirect=function redirect(pathname){return createRedirect(newContext,pathname)};if(newContext.__divergedChainIndex=0,newContext.__skipAttach=!1,previousChain.length){for(var i=0;i<Math.min(previousChain.length,newChain.length)&&previousChain[i].route===newChain[i].route&&(previousChain[i].path===newChain[i].path||previousChain[i].element===newChain[i].element)&&this.__isReusableElement(previousChain[i].element,newChain[i].element);i=++newContext.__divergedChainIndex);if(newContext.__skipAttach=newChain.length===previousChain.length&&newContext.__divergedChainIndex==newChain.length&&this.__isReusableElement(newContext.result,previousContext.result),newContext.__skipAttach){for(var _i=newChain.length-1;_i>=0;_i--)previousChain[_i].path===newChain[_i].path&&newContext.search===previousContext.search||(callbacks=this.__runOnBeforeLeaveCallbacks(callbacks,newContext,{prevent},previousChain[_i]));for(var _i2=0;_i2<newChain.length;_i2++)previousChain[_i2].path===newChain[_i2].path&&newContext.search===previousContext.search||(callbacks=this.__runOnBeforeEnterCallbacks(callbacks,newContext,{prevent,redirect},newChain[_i2])),previousChain[_i2].element.location=createLocation(newContext,previousChain[_i2].route)}else for(var _i3=previousChain.length-1;_i3>=newContext.__divergedChainIndex;_i3--)callbacks=this.__runOnBeforeLeaveCallbacks(callbacks,newContext,{prevent},previousChain[_i3])}for(var _i4=newContext.__divergedChainIndex;!newContext.__skipAttach&&_i4<newChain.length;_i4++)callbacks=this.__runOnBeforeEnterCallbacks(callbacks,newContext,{prevent,redirect},newChain[_i4]);return callbacks.then((function(amendmentResult){if(amendmentResult){if(amendmentResult.cancel)return _this7.__previousContext.__renderId=newContext.__renderId,_this7.__previousContext;if(amendmentResult.redirect)return _this7.__redirect(amendmentResult.redirect,newContext.__redirectCount,newContext.__renderId)}return newContext}))}},{key:"__runOnBeforeLeaveCallbacks",value:function __runOnBeforeLeaveCallbacks(callbacks,newContext,commands,chainElement){var _this8=this,location=createLocation(newContext);return callbacks.then((function(result){if(_this8.__isLatestRender(newContext))return amend("onBeforeLeave",[location,commands,_this8],chainElement.element)(result)})).then((function(result){if(!(result||{}).redirect)return result}))}},{key:"__runOnBeforeEnterCallbacks",value:function __runOnBeforeEnterCallbacks(callbacks,newContext,commands,chainElement){var _this9=this,location=createLocation(newContext,chainElement.route);return callbacks.then((function(result){if(_this9.__isLatestRender(newContext))return amend("onBeforeEnter",[location,commands,_this9],chainElement.element)(result)}))}},{key:"__isReusableElement",value:function __isReusableElement(element,otherElement){return!(!element||!otherElement)&&(this.__createdByRouter.get(element)&&this.__createdByRouter.get(otherElement)?element.localName===otherElement.localName:element===otherElement)}},{key:"__isLatestRender",value:function __isLatestRender(context){return context.__renderId===this.__lastStartedRenderId}},{key:"__redirect",value:function __redirect(redirectData,counter,renderId){if(counter>256)throw new Error(log("Too many redirects when rendering ".concat(redirectData.from)));return this.resolve({pathname:this.urlForPath(redirectData.pathname,redirectData.params),redirectFrom:redirectData.from,__redirectCount:(counter||0)+1,__renderId:renderId})}},{key:"__ensureOutlet",value:function __ensureOutlet(){var outlet=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.__outlet;if(!(outlet instanceof Node))throw new TypeError(log("Expected router outlet to be a valid DOM Node (but got ".concat(outlet,")")))}},{key:"__updateBrowserHistory",value:function __updateBrowserHistory(_ref2,replace){var pathname=_ref2.pathname,_ref2$search=_ref2.search,search=void 0===_ref2$search?"":_ref2$search,_ref2$hash=_ref2.hash,hash=void 0===_ref2$hash?"":_ref2$hash;if(window.location.pathname!==pathname||window.location.search!==search||window.location.hash!==hash){var changeState=replace?"replaceState":"pushState";window.history[changeState](null,document.title,pathname+search+hash),window.dispatchEvent(new PopStateEvent("popstate",{state:"vaadin-router-ignore"}))}}},{key:"__copyUnchangedElements",value:function __copyUnchangedElements(context,previousContext){for(var deepestCommonParent=this.__outlet,i=0;i<context.__divergedChainIndex;i++){var unchangedElement=previousContext&&previousContext.chain[i].element;if(unchangedElement){if(unchangedElement.parentNode!==deepestCommonParent)break;context.chain[i].element=unchangedElement,deepestCommonParent=unchangedElement}}return deepestCommonParent}},{key:"__addAppearingContent",value:function __addAppearingContent(context,previousContext){var _this10=this;this.__ensureOutlet(),this.__removeAppearingContent();var deepestCommonParent=this.__copyUnchangedElements(context,previousContext);this.__appearingContent=[],this.__disappearingContent=Array.from(deepestCommonParent.children).filter((function(e){return _this10.__addedByRouter.get(e)&&e!==context.result}));for(var parentElement=deepestCommonParent,i=context.__divergedChainIndex;i<context.chain.length;i++){var elementToAdd=context.chain[i].element;elementToAdd&&(parentElement.appendChild(elementToAdd),this.__addedByRouter.set(elementToAdd,!0),parentElement===deepestCommonParent&&this.__appearingContent.push(elementToAdd),parentElement=elementToAdd)}}},{key:"__removeDisappearingContent",value:function __removeDisappearingContent(){this.__disappearingContent&&removeDomNodes(this.__disappearingContent),this.__disappearingContent=null,this.__appearingContent=null}},{key:"__removeAppearingContent",value:function __removeAppearingContent(){this.__disappearingContent&&this.__appearingContent&&(removeDomNodes(this.__appearingContent),this.__disappearingContent=null,this.__appearingContent=null)}},{key:"__runOnAfterLeaveCallbacks",value:function __runOnAfterLeaveCallbacks(currentContext,targetContext){if(targetContext)for(var i=targetContext.chain.length-1;i>=currentContext.__divergedChainIndex&&this.__isLatestRender(currentContext);i--){var currentComponent=targetContext.chain[i].element;if(currentComponent)try{var location=createLocation(currentContext);runCallbackIfPossible(currentComponent.onAfterLeave,[location,{},targetContext.resolver],currentComponent)}finally{this.__disappearingContent.indexOf(currentComponent)>-1&&removeDomNodes(currentComponent.children)}}}},{key:"__runOnAfterEnterCallbacks",value:function __runOnAfterEnterCallbacks(currentContext){for(var i=currentContext.__divergedChainIndex;i<currentContext.chain.length&&this.__isLatestRender(currentContext);i++){var currentComponent=currentContext.chain[i].element||{},location=createLocation(currentContext,currentContext.chain[i].route);runCallbackIfPossible(currentComponent.onAfterEnter,[location,{},currentContext.resolver],currentComponent)}}},{key:"__animateIfNeeded",value:function __animateIfNeeded(context){for(var config,from=(this.__disappearingContent||[])[0],to=(this.__appearingContent||[])[0],promises=[],chain=context.chain,i=chain.length;i>0;i--)if(chain[i-1].route.animate){config=chain[i-1].route.animate;break}if(from&&to&&config){var leave=isObject(config)&&config.leave||"leaving",enter=isObject(config)&&config.enter||"entering";promises.push(animate(from,leave)),promises.push(animate(to,enter))}return Promise.all(promises).then((function(){return context}))}},{key:"subscribe",value:function subscribe(){window.addEventListener("vaadin-router-go",this.__navigationEventHandler)}},{key:"unsubscribe",value:function unsubscribe(){window.removeEventListener("vaadin-router-go",this.__navigationEventHandler)}},{key:"__onNavigationEvent",value:function __onNavigationEvent(event){var _ref3=event?event.detail:window.location,pathname=_ref3.pathname,search=_ref3.search,hash=_ref3.hash;isString(this.__normalizePathname(pathname))&&(event&&event.preventDefault&&event.preventDefault(),this.render({pathname,search,hash},!0))}},{key:"urlForName",value:function urlForName(name,params){return this.__urlForName||(this.__urlForName=generateUrls(this)),getPathnameForRouter(this.__urlForName(name,params),this)}},{key:"urlForPath",value:function urlForPath(path,params){return getPathnameForRouter(Router.pathToRegexp.compile(path)(params),this)}}],[{key:"setTriggers",value:function setTriggers(){for(var _len=arguments.length,triggers=new Array(_len),_key=0;_key<_len;_key++)triggers[_key]=arguments[_key];setNavigationTriggers(triggers)}},{key:"go",value:function go(path){var _ref4=isString(path)?this.__createUrl(path,"http://a"):path;return fireRouterEvent("go",{pathname:_ref4.pathname,search:_ref4.search,hash:_ref4.hash})}}]),Router}(Resolver),DEV_MODE_CODE_REGEXP=/\/\*\*\s+vaadin-dev-mode:start([\s\S]*)vaadin-dev-mode:end\s+\*\*\//i,FlowClients=window.Vaadin&&window.Vaadin.Flow&&window.Vaadin.Flow.clients;function uncommentAndRun(callback,args){if("function"==typeof callback){var match=DEV_MODE_CODE_REGEXP.exec(callback.toString());if(match)try{callback=new Function(match[1])}catch(e){console.log("vaadin-development-mode-detector: uncommentAndRun() failed",e)}return callback(args)}}window.Vaadin=window.Vaadin||{};var isUrlAvailable,urlDocument,urlBase,urlAnchor,runIfDevelopmentMode=function runIfDevelopmentMode(callback,args){if(window.Vaadin.developmentMode)return uncommentAndRun(callback,args)};function maybeGatherAndSendStats(){}void 0===window.Vaadin.developmentMode&&(window.Vaadin.developmentMode=function isDevelopmentMode(){try{return!!function isForcedDevelopmentMode(){return localStorage.getItem("vaadin.developmentmode.force")}()||!!function isLocalhost(){return["localhost","127.0.0.1"].indexOf(window.location.hostname)>=0}()&&(FlowClients?!function isFlowProductionMode(){return!!(FlowClients&&Object.keys(FlowClients).map((function(key){return FlowClients[key]})).filter((function(client){return client.productionMode})).length>0)}():!function isMinified(){return uncommentAndRun((function test(){return!0}))}())}catch(e){return!1}}()),window.Vaadin=window.Vaadin||{},window.Vaadin.registrations=window.Vaadin.registrations||[],window.Vaadin.registrations.push({is:"@vaadin/router",version:"1.5.2"}),function usageStatistics(){runIfDevelopmentMode(maybeGatherAndSendStats)}(),Router.NavigationTrigger={POPSTATE,CLICK},Resolver.__ensureUrlAvailableOrPolyfilled=function(){if(void 0===isUrlAvailable){try{var url=new URL("b","http://a");url.pathname="c",isUrlAvailable="http://a/c"===url.href}catch(e){isUrlAvailable=!1}if(!isUrlAvailable&&(urlDocument=document.implementation.createHTMLDocument("url"),urlBase=urlDocument.createElement("base"),urlDocument.head.appendChild(urlBase),!(urlAnchor=urlDocument.createElement("a")).origin)){Object.defineProperty(urlAnchor,"origin",{get:function get(){var protocol=urlAnchor.protocol,port=urlAnchor.port,host="http:"===protocol&&"80"===port||"https:"===protocol&&"443"===port?urlAnchor.hostname:urlAnchor.host;return"".concat(protocol,"//").concat(host)}});var getPathnameOrig=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(urlAnchor),"pathname").get;Object.defineProperty(urlAnchor,"pathname",{get:function get(){var pathname=getPathnameOrig.apply(urlAnchor);return"/"!==pathname.charAt(0)?"/"+pathname:pathname}})}}},Resolver.__createUrl=function(path,base){return Resolver.__ensureUrlAvailableOrPolyfilled(),isUrlAvailable?new URL(path,base):(urlBase.href=base,urlAnchor.href=path.replace(/ /g,"%20"),urlAnchor.href=urlAnchor.href,urlAnchor)},exports.Resolver=Resolver,exports.Router=Router,Object.defineProperty(exports,"__esModule",{value:!0})},"object"==typeof exports&&"undefined"!=typeof module?factory(exports):"function"==typeof define&&define.amd?define(["exports"],factory):factory((global=global||self).Vaadin=global.Vaadin||{});