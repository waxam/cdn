module.exports=pathToRegexp,module.exports.parse=parse,module.exports.compile=function compile(e,t){return tokensToFunction(parse(e,t))},module.exports.tokensToFunction=tokensToFunction,module.exports.tokensToRegExp=tokensToRegExp;var e=new RegExp(["(\\\\.)","(?:\\:(\\w+)(?:\\(((?:\\\\.|[^\\\\()])+)\\))?|\\(((?:\\\\.|[^\\\\()])+)\\))([+*?])?"].join("|"),"g");function parse(t,r){for(var n,o=[],p=0,a=0,i="",s=r&&r.delimiter||"/",l=r&&r.delimiters||"./",g=!1;null!==(n=e.exec(t));){var c=n[0],f=n[1],u=n.index;if(i+=t.slice(a,u),a=u+c.length,f)i+=f[1],g=!0;else{var x="",h=t[a],m=n[2],d=n[3],v=n[4],y=n[5];if(!g&&i.length){var E=i.length-1;l.indexOf(i[E])>-1&&(x=i[E],i=i.slice(0,E))}i&&(o.push(i),i="",g=!1);var T=""!==x&&void 0!==h&&h!==x,w="+"===y||"*"===y,R="?"===y||"*"===y,S=x||s,b=d||v;o.push({name:m||p++,prefix:x,delimiter:S,optional:R,repeat:w,partial:T,pattern:b?escapeGroup(b):"[^"+escapeString(S)+"]+?"})}}return(i||a<t.length)&&o.push(i+t.substr(a)),o}function tokensToFunction(e){for(var t=new Array(e.length),r=0;r<e.length;r++)"object"==typeof e[r]&&(t[r]=new RegExp("^(?:"+e[r].pattern+")$"));return function(r,n){for(var o="",p=n&&n.encode||encodeURIComponent,a=0;a<e.length;a++){var i=e[a];if("string"!=typeof i){var s,l=r?r[i.name]:void 0;if(Array.isArray(l)){if(!i.repeat)throw new TypeError('Expected "'+i.name+'" to not repeat, but got array');if(0===l.length){if(i.optional)continue;throw new TypeError('Expected "'+i.name+'" to not be empty')}for(var g=0;g<l.length;g++){if(s=p(l[g],i),!t[a].test(s))throw new TypeError('Expected all "'+i.name+'" to match "'+i.pattern+'"');o+=(0===g?i.prefix:i.delimiter)+s}}else if("string"!=typeof l&&"number"!=typeof l&&"boolean"!=typeof l){if(!i.optional)throw new TypeError('Expected "'+i.name+'" to be '+(i.repeat?"an array":"a string"));i.partial&&(o+=i.prefix)}else{if(s=p(String(l),i),!t[a].test(s))throw new TypeError('Expected "'+i.name+'" to match "'+i.pattern+'", but got "'+s+'"');o+=i.prefix+s}}else o+=i}return o}}function escapeString(e){return e.replace(/([.+*?=^!:${}()[\]|/\\])/g,"\\$1")}function escapeGroup(e){return e.replace(/([=!:$/()])/g,"\\$1")}function flags(e){return e&&e.sensitive?"":"i"}function tokensToRegExp(e,t,r){for(var n=(r=r||{}).strict,o=!1!==r.start,p=!1!==r.end,a=escapeString(r.delimiter||"/"),i=r.delimiters||"./",s=[].concat(r.endsWith||[]).map(escapeString).concat("$").join("|"),l=o?"^":"",g=0===e.length,c=0;c<e.length;c++){var f=e[c];if("string"==typeof f)l+=escapeString(f),g=c===e.length-1&&i.indexOf(f[f.length-1])>-1;else{var u=f.repeat?"(?:"+f.pattern+")(?:"+escapeString(f.delimiter)+"(?:"+f.pattern+"))*":f.pattern;t&&t.push(f),f.optional?f.partial?l+=escapeString(f.prefix)+"("+u+")?":l+="(?:"+escapeString(f.prefix)+"("+u+"))?":l+=escapeString(f.prefix)+"("+u+")"}}return p?(n||(l+="(?:"+a+")?"),l+="$"===s?"$":"(?="+s+")"):(n||(l+="(?:"+a+"(?="+s+"))?"),g||(l+="(?="+a+"|"+s+")")),new RegExp(l,flags(r))}function pathToRegexp(e,t,r){return e instanceof RegExp?function regexpToRegexp(e,t){if(!t)return e;var r=e.source.match(/\((?!\?)/g);if(r)for(var n=0;n<r.length;n++)t.push({name:n,prefix:null,delimiter:null,optional:!1,repeat:!1,partial:!1,pattern:null});return e}(e,t):Array.isArray(e)?function arrayToRegexp(e,t,r){for(var n=[],o=0;o<e.length;o++)n.push(pathToRegexp(e[o],t,r).source);return new RegExp("(?:"+n.join("|")+")",flags(r))}(e,t,r):function stringToRegexp(e,t,r){return tokensToRegExp(parse(e,r),t,r)}(e,t,r)}