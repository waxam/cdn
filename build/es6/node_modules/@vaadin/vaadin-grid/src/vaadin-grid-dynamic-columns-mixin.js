import{FlattenedNodesObserver}from"../../../@polymer/polymer/lib/utils/flattened-nodes-observer.js";import{Debouncer}from"../../../@polymer/polymer/lib/utils/debounce.js";import{timeOut}from"../../../@polymer/polymer/lib/utils/async.js";import{PolymerElement}from"../../../@polymer/polymer/polymer-element.js";export const DynamicColumnsMixin=superClass=>(class DynamicColumnsMixin extends superClass{ready(){super.ready(),this._addNodeObserver()}_hasColumnGroups(columns){for(let i=0;i<columns.length;i++)if("vaadin-grid-column-group"===columns[i].localName)return!0;return!1}_getChildColumns(el){return FlattenedNodesObserver.getFlattenedNodes(el).filter(this._isColumnElement)}_flattenColumnGroups(columns){return columns.map(col=>"vaadin-grid-column-group"===col.localName?this._getChildColumns(col):[col]).reduce((prev,curr)=>prev.concat(curr),[])}_getColumnTree(){for(var _columnTree=[],c=FlattenedNodesObserver.getFlattenedNodes(this).filter(this._isColumnElement);_columnTree.push(c),this._hasColumnGroups(c);)c=this._flattenColumnGroups(c);return _columnTree}_updateColumnTree(){var columnTree=this._getColumnTree();this._arrayEquals(columnTree,this._columnTree)||(this._columnTree=columnTree)}_addNodeObserver(){this._observer=new FlattenedNodesObserver(this,info=>{const rowDetailsTemplate=info.addedNodes.filter(n=>"template"===n.localName&&n.classList.contains("row-details"))[0];rowDetailsTemplate&&this._rowDetailsTemplate!==rowDetailsTemplate&&(this._rowDetailsTemplate=rowDetailsTemplate),(info.addedNodes.filter(this._isColumnElement).length>0||info.removedNodes.filter(this._isColumnElement).length>0)&&this._updateColumnTree(),this._debouncerCheckImports=Debouncer.debounce(this._debouncerCheckImports,timeOut.after(2e3),this._checkImports.bind(this)),this._ensureFirstPageLoaded()})}_arrayEquals(arr1,arr2){if(!arr1||!arr2||arr1.length!=arr2.length)return!1;for(var i=0,l=arr1.length;i<l;i++)if(arr1[i]instanceof Array&&arr2[i]instanceof Array){if(!this._arrayEquals(arr1[i],arr2[i]))return!1}else if(arr1[i]!=arr2[i])return!1;return!0}_checkImports(){["vaadin-grid-column-group","vaadin-grid-filter","vaadin-grid-filter-column","vaadin-grid-tree-toggle","vaadin-grid-selection-column","vaadin-grid-sort-column","vaadin-grid-sorter"].forEach(elementName=>{var element=this.querySelector(elementName);!element||element instanceof PolymerElement||console.warn(`Make sure you have imported the required module for <${elementName}> element.`)})}_updateFirstAndLastColumn(){Array.from(this.shadowRoot.querySelectorAll("tr")).forEach(row=>this._updateFirstAndLastColumnForRow(row))}_updateFirstAndLastColumnForRow(row){Array.from(row.querySelectorAll('[part~="cell"]:not([part~="details-cell"])')).sort((a,b)=>a._column._order-b._column._order).forEach((cell,cellIndex,children)=>{this._toggleAttribute("first-column",0===cellIndex,cell),this._toggleAttribute("last-column",cellIndex===children.length-1,cell)})}_isColumnElement(node){return node.nodeType===Node.ELEMENT_NODE&&/\bcolumn\b/.test(node.localName)}});