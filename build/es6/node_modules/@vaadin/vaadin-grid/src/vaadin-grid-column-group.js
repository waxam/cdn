import"../../../@polymer/polymer/polymer-legacy.js";import{microTask}from"../../../@polymer/polymer/lib/utils/async.js";import{FlattenedNodesObserver}from"../../../@polymer/polymer/lib/utils/flattened-nodes-observer.js";import{ColumnBaseMixin}from"./vaadin-grid-column.js";import{PolymerElement}from"../../../@polymer/polymer/polymer-element.js";class GridColumnGroupElement extends(ColumnBaseMixin(PolymerElement)){static get is(){return"vaadin-grid-column-group"}static get properties(){return{_childColumns:{value:function(){return this._getChildColumns(this)}},flexGrow:{type:Number,readOnly:!0},width:{type:String,readOnly:!0},_visibleChildColumns:Array,_colSpan:Number,_rootColumns:Array}}static get observers(){return["_updateVisibleChildColumns(_childColumns)","_childColumnsChanged(_childColumns)","_groupFrozenChanged(frozen, _rootColumns)","_groupHiddenChanged(hidden, _rootColumns)","_visibleChildColumnsChanged(_visibleChildColumns)","_colSpanChanged(_colSpan, _headerCell, _footerCell)","_groupOrderChanged(_order, _rootColumns)","_groupReorderStatusChanged(_reorderStatus, _rootColumns)","_groupResizableChanged(resizable, _rootColumns)"]}connectedCallback(){super.connectedCallback(),this._addNodeObserver(),this._updateFlexAndWidth()}disconnectedCallback(){super.disconnectedCallback(),this._observer&&this._observer.disconnect()}_columnPropChanged(path,value){"hidden"===path&&(this._preventHiddenCascade=!0,this._updateVisibleChildColumns(this._childColumns),this._preventHiddenCascade=!1),/flexGrow|width|hidden|_childColumns/.test(path)&&this._updateFlexAndWidth(),"frozen"===path&&(this.frozen=this.frozen||value),"lastFrozen"===path&&(this._lastFrozen=this._lastFrozen||value)}_groupOrderChanged(order,rootColumns){if(order&&rootColumns){const trailingZeros=/(0+)$/.exec(order).pop().length,childCountDigits=1+~~(Math.log(rootColumns.length)/Math.log(Math.LN10)),scope=Math.pow(10,trailingZeros-childCountDigits),_rootColumns=rootColumns.slice(0);_rootColumns[0]&&_rootColumns[0]._order&&_rootColumns.sort((a,b)=>a._order-b._order),_rootColumns.forEach((column,index)=>column._order=order+(index+1)*scope)}}_groupReorderStatusChanged(reorderStatus,rootColumns){void 0!==reorderStatus&&void 0!==rootColumns&&rootColumns.forEach(column=>column._reorderStatus=reorderStatus)}_groupResizableChanged(resizable,rootColumns){void 0!==rootColumns&&rootColumns.forEach(column=>column.resizable=resizable)}_updateVisibleChildColumns(childColumns){this._visibleChildColumns=Array.prototype.filter.call(childColumns,col=>!col.hidden)}_childColumnsChanged(childColumns){!this._autoHidden&&this.hidden&&(Array.prototype.forEach.call(childColumns,column=>column.hidden=!0),this._updateVisibleChildColumns(childColumns))}_updateFlexAndWidth(){this._visibleChildColumns&&(this._visibleChildColumns.length?this._setWidth("calc("+Array.prototype.reduce.call(this._visibleChildColumns,(prev,curr)=>prev+=" + "+(curr.width||"0px").replace("calc",""),"").substring(3)+")"):this._setWidth("0px"),this._setFlexGrow(Array.prototype.reduce.call(this._visibleChildColumns,(prev,curr)=>prev+curr.flexGrow,0)))}_groupFrozenChanged(frozen,rootColumns){void 0!==rootColumns&&void 0!==frozen&&!1!==frozen&&Array.from(rootColumns).forEach(col=>col.frozen=frozen)}_groupHiddenChanged(hidden,rootColumns){rootColumns&&!this._preventHiddenCascade&&(this._ignoreVisibleChildColumns=!0,rootColumns.forEach(column=>column.hidden=hidden),this._ignoreVisibleChildColumns=!1),this._columnPropChanged("hidden")}_visibleChildColumnsChanged(visibleChildColumns){this._colSpan=visibleChildColumns.length,this._ignoreVisibleChildColumns||(0===visibleChildColumns.length?this._autoHidden=this.hidden=!0:this.hidden&&this._autoHidden&&(this._autoHidden=this.hidden=!1))}_colSpanChanged(colSpan,headerCell,footerCell){headerCell&&(headerCell.setAttribute("colspan",colSpan),this._grid&&this._grid._a11yUpdateCellColspan(headerCell,colSpan)),footerCell&&(footerCell.setAttribute("colspan",colSpan),this._grid&&this._grid._a11yUpdateCellColspan(footerCell,colSpan))}_getChildColumns(el){return FlattenedNodesObserver.getFlattenedNodes(el).filter(this._isColumnElement)}_addNodeObserver(){this._observer=new FlattenedNodesObserver(this,info=>{(info.addedNodes.filter(this._isColumnElement).length>0||info.removedNodes.filter(this._isColumnElement).length>0)&&(this._preventHiddenCascade=!0,this._rootColumns=this._getChildColumns(this),this._childColumns=this._rootColumns,this._preventHiddenCascade=!1,microTask.run(()=>{this._grid&&this._grid._updateColumnTree&&this._grid._updateColumnTree()}))}),this._observer.flush()}_isColumnElement(node){return node.nodeType===Node.ELEMENT_NODE&&/\bcolumn\b/.test(node.localName)}}customElements.define(GridColumnGroupElement.is,GridColumnGroupElement);export{GridColumnGroupElement};